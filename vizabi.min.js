/**
 * vizabi - Vizabi Framework, Interactive charts and visualization tools animated through time
 * @version v0.18.4-3
 * @build timestamp Thu Feb 02 2017 12:36:28 GMT+0000 (UTC)
 * @link http://vizabi.org
 * @license BSD-3-Clause
 */

!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("Vizabi",[],e):"object"==typeof exports?exports.Vizabi=e():t.Vizabi=e()}(this,function(){return function(t){function e(n){if(i[n])return i[n].exports;var a=i[n]={i:n,l:!1,exports:{}};return t[n].call(a.exports,a,a.exports,e),a.l=!0,a.exports}var i={};return e.m=t,e.c=i,e.i=function(t){return t},e.d=function(t,e,i){Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:i})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=463)}([function(t,e,i){var n=i(4),a=i(35),r=i(17),s=i(18),o=i(36),l="prototype",c=function(t,e,i){var h,u,d,f,m=t&c.F,p=t&c.G,g=t&c.S,v=t&c.P,b=t&c.B,y=p?n:g?n[e]||(n[e]={}):(n[e]||{})[l],x=p?a:a[e]||(a[e]={}),_=x[l]||(x[l]={});p&&(i=e);for(h in i)u=!m&&y&&void 0!==y[h],d=(u?y:i)[h],f=b&&u?o(d,n):v&&"function"==typeof d?o(Function.call,d):d,y&&s(y,h,d,t&c.U),x[h]!=d&&r(x,h,f),v&&_[h]!=d&&(_[h]=d)};n.core=a,c.F=1,c.G=2,c.S=4,c.P=8,c.B=16,c.W=32,c.U=64,c.R=128,t.exports=c},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){return t instanceof Date||t instanceof RegExp}function r(t){if(t instanceof Date)return new Date(t.getTime());if(t instanceof RegExp)return new RegExp(t);throw new Error("Unexpected situation")}function s(t){var e=[];return y(t,function(t,i){"object"===("undefined"==typeof t?"undefined":c(t))&&null!==t?d(t)?e[i]=s(t):a(t)?e[i]=r(t):e[i]=x({},t):e[i]=t}),e}function o(t,e){return function(i,n){var a=e.getBoundingClientRect(),r=t.getScreenCTM();return{x:r.a*i+r.c*n+r.e-a.left,y:r.b*i+r.d*n+r.f-a.top}}}function l(){function t(t){return t}function e(t){return"string"==typeof t?t.toLowerCase():t}function i(i,n){if(n="number"==typeof n?{direction:n}:n||{},"function"!=typeof i){var a=i;i=function(t){return t[a]?t[a]:""}}if(1===i.length){var r=i,s=n.ignoreCase?e:t;i=function(t,e){return s(r(t))<s(r(e))?-1:s(r(t))>s(r(e))?1:0}}return n.direction===-1?function(t,e){return-i(t,e)}:i}function n(t,e){var a="function"==typeof this&&this,r=i(t,e),s=a?function(t,e){return a(t,e)||r(t,e)}:r;return s.thenBy=n,s}return n}Object.defineProperty(e,"__esModule",{value:!0}),e.setIcon=e.pruneTree=e.isTouchDevice=e.debounce=e.memoize=e.post=e.get=e.ajax=e.interpolatePoint=e.interpolateVector=e.nestArrayToObj=e.hashCode=e.clearDelay=e.delay=e.defer=e.diffObject=e.arrayLast=e.arrayMedian=e.arraySum=e.arrayMean=e.arrayMax=e.arrayMin=e.values=e.keys=e.throttle=e.hasClass=e.classed=e.removeClass=e.addClass=e.countDecimals=e.error=e.groupEnd=e.groupCollapsed=e.warn=e.timeStamp=e.areaToRadius=e.radiusToArea=e.mapRows=e.preventAncestorScrolling=e.matchAny=e.filterAny=e.filter=e.find=e.uniqueLast=e.unique=e.without=e.deepClone=e.clone=e.merge=e.deepExtend=e.extend=e.forEach=e.strToFloat=e.roundStep=e.findScrollableAncestor=e.getViewportPosition=e.comparePlainObjects=e.arrayEquals=e.isPlainObject=e.isNumber=e.isEmpty=e.isNaN=e.isString=e.isDate=e.isObject=e.isArray=e.isElement=e.uniqueId=e.approxEqual=void 0;var c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};e.makeAbsoluteContext=o,e.firstBy=l;var h=i(456),u=n(h),d=(e.approxEqual=function(t,e,i){return i=i||0,e>0?(1-i)*e<=t&&t<=e*(1+i):e<0?(1+i)*e<=t&&t<=e*(1-i):Math.abs(t)<=i},e.uniqueId=function(){var t=0;return function(e){return e?e+(t+=1):t+=1}}(),e.isElement=function(t){return!(!t||1!==t.nodeType)},e.isArray=Array.isArray||function(t){return"[object Array]"===toString.call(t)}),f=e.isObject=function(t){var e="undefined"==typeof t?"undefined":c(t);return"object"===e&&!!t},m=(e.isDate=function(t){return t instanceof Date},e.isString=function(t){return"string"==typeof t}),p=e.isNaN=function(t){return g(t)&&t!==+t},g=(e.isEmpty=function(t){return 0===Object.keys(t).length&&t.constructor===Object},e.isNumber=function(t){return"number"==typeof t||!!t&&"object"===("undefined"==typeof t?"undefined":c(t))&&"[object Number]"===Object.prototype.toString.call(t)}),v=e.isPlainObject=function(t){return null!==t&&"[object Object]"===Object.prototype.toString.call(t)},b=e.arrayEquals=function(t,e){if(t===e)return!0;if(null==t||null==e)return!1;if(t.length!=e.length)return!1;for(var i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0},y=(e.comparePlainObjects=function(t,e){var i=function(t){return Object.prototype.toString.call(t).match(/^\[object\s(.*)\]$/)[1]},n=function(t){if(void 0===t)return"undefined";if(null===t)return"null";var e="undefined"==typeof t?"undefined":c(t);return"object"===e&&(e=i(t).toLowerCase()),"number"===e?t.toString().indexOf(".")>0?"float":"integer":e},a=function(t,e){if(t===e)return!0;for(var i in t){if(!e.hasOwnProperty(i))return!1;if(!o(t[i],e[i]))return!1}for(var i in e)if(!t.hasOwnProperty(i))return!1;return!0},r=function(t,e){if(t===e)return!0;if(t.length!==e.length)return!1;for(var i=0;i<t.length;i++)if(!o(t[i],e[i]))return!1;return!0},s={};s.array=r,s.object=a,s.date=function(t,e){return t.getTime()===e.getTime()},s.regexp=function(t,e){return t.toString()===e.toString()};var o=function(t,e){if(t!==e){var i=n(t),a=n(e);return i===a&&(s.hasOwnProperty(i)?s[i](t,e):t==e)}return!0};return a(t,e)},e.getViewportPosition=function(t){for(var e=0,i=0;t;)e+=t.offsetLeft-t.scrollLeft+t.clientLeft,i+=t.offsetTop-t.scrollTop+t.clientTop,t=t.offsetParent;return{x:e,y:i}},e.findScrollableAncestor=function(t){for(var e=["scroll","auto"];t=t.parentNode;){var i=t.scrollHeight,n=t.clientHeight;if(i>n&&e.indexOf(d3.select(t).style("overflow"))!==-1)return t}return null},e.roundStep=function(t,e){return Math.round(t/e)*e},e.strToFloat=function(t){return+t.replace(/[^\d.-]/g,"")},e.forEach=function(t,e,i){if(t){var n,a;if(d(t))for(a=t.length,n=0;n<a&&e.apply(i,[t[n],n])!==!1;n+=1);else{var r=Object.keys(t);for(a=r.length,n=0;n<a&&e.apply(i,[t[r[n]],r[n]])!==!1;n+=1);}}}),x=(e.extend=function(t){var e=Array.prototype.slice.call(arguments,1);return y(e,function(e,i){y(e,function(i,n){e.hasOwnProperty(n)&&(t[n]=i)})}),t},e.deepExtend=function t(){if(arguments.length<1||"object"!==c(arguments[0]))return!1;if(arguments.length<2)return arguments[0];var e,i,n=arguments[0],o=Array.prototype.slice.call(arguments,1);return y(o,function(o){"object"!==("undefined"==typeof o?"undefined":c(o))||d(o)||y(Object.keys(o),function(l){return i=n[l],e=o[l],e===n?void 0:"object"!==("undefined"==typeof e?"undefined":c(e))||null===e||e._data?void(n[l]=e):d(e)?void(n[l]=s(e)):a(e)?void(n[l]=r(e)):"object"!==("undefined"==typeof i?"undefined":c(i))||null===i||d(i)?void(n[l]=t({},e)):void(n[l]=t(i,e))})}),n}),_=(e.merge=function(t){var e=Array.prototype.slice.call(arguments,1);return y(e,function(e,i){y(e,function(i,n){e.hasOwnProperty(n)&&(t.hasOwnProperty(n)?(d(t[n])||(t[n]=[t[n]]),t[n].push(i)):t[n]=i)})}),t},e.clone=function t(e,i,n){if(d(e))return e.slice(0);var t={};return y(e,function(a,r){i&&i.indexOf(r)===-1||n&&n.indexOf(r)!==-1||e.hasOwnProperty(r)&&(t[r]=a)}),t},e.deepClone=function t(e){var i={};return d(e)&&(i=[]),y(e,function(e,n){f(e)||d(e)?i[n]=t(e):i[n]=e}),i},e.without=function(t,e){var i=t.indexOf(e);return i!==-1&&t.splice(i,1),t},e.unique=function(t,e){var i={},n=[];e||(e=function(t){return t});for(var a=0,r=t.length;a<r;a+=1){var s=e(t[a]);i.hasOwnProperty(s)||(n.push(t[a]),i[s]=1)}return n},e.uniqueLast=function(t,e){var i={},n=[];e||(e=function(t){return t});for(var a=0,r=t.length;a<r;a+=1){var s=e(t[a]);i.hasOwnProperty(s)&&n.splice(i[s],1),n.push(t[a]),i[s]=n.length-1}return n},e.find=function(t,e){var i;return y(t,function(t){if(e(t))return i=t,!1}),i},e.filter=function(t,e){for(var i,n,a=-1,r=t.length,s=-1,o=[],l=Object.keys(e),c=l.length;(a+=1)<r;){var h=t[a],u=!0;for(i=0;i<c;i+=1)if(n=l[i],!h.hasOwnProperty(n)||h[n]!==e[n]){u=!1;break}u&&(o[s+=1]=h)}return o},e.filterAny=function(t,e,i){for(var n,a,r=-1,s=t.length,o=-1,l=[],c=Object.keys(e),h=c.length;(r+=1)<s;){var u=t[r],d=!0;for(n=0;n<h;n+=1)if(a=c[n],!u.hasOwnProperty(a)||!_(u[a],e[a],i)){d=!1;break}d&&(l[o+=1]=u)}return l},e.matchAny=function(t,e,i){d(t)||(t=[t]),i||(i="*");for(var n=!1,a=0;a<t.length;a++){var r=t[a];if(!d(e)&&r==e){n=!0;break}if(d(e)){for(var s=-1,o=0;o<e.length;o++){var l=e[o];if(!(d(l)||l!=r&&l!==i)){s=o;break}if(d(l)){var c=l[0],h=l[1]||c;if(r>=c&&r<=h){s=o;break}}}if(s!==-1){n=!0;break}}}return n}),M=(e.preventAncestorScrolling=function(t){var e=!1;t.on("mousewheel",function(i,n){var a=this.scrollTop,r=this.scrollHeight,s=t.node().offsetHeight,o=d3.event.wheelDelta,l=o>0,c=function(){return d3.event.stopPropagation(),d3.event.preventDefault(),d3.event.returnValue=!1,!1},h=function(t){return function(){var e=d3.interpolateNumber(this.scrollTop,t);return function(t){this.scrollTop=e(t)}}};if(l?l&&(o>a&&a>0?(t.transition().delay(0).duration(0).tween("scrolltween",h(0)),e=!0,setTimeout(function(){e=!1},2e3)):r==s+a&&(e=!1)):-o>r-s-a&&r!=s+a?(t.transition().delay(0).duration(0).tween("scrolltween",h(r)),e=!0,setTimeout(function(){e=!1},2e3)):0==a&&(e=!1),e)return c()})},e.mapRows=function(t,e){function i(t,e){if(d(t)){for(var n=[],a=0;a<t.length;a++)n[a]=i(t[a],e);return n}return e(t)}var n=function(t){var e=t;if(""===t)e=null;else{var i=parseFloat(t);!p(i)&&isFinite(t)&&(e=i)}return e};return t=t.map(function(t){for(var a=Object.keys(t),r=0;r<a.length;r++){var s=a[r];t[s]=i(t[s],e[s]||n)}return t})},e.radiusToArea=function(t){return t*t*Math.PI},e.areaToRadius=function(t){return Math.sqrt(t/Math.PI)},e.timeStamp=function(t){console&&"function"==typeof console.timeStamp&&console.timeStamp(t)},e.warn=function(t){return t=Array.prototype.slice.call(arguments).map(function(t){return t instanceof Object?JSON.stringify(t,null,4):t}).join(" "),console&&"function"==typeof console.warn&&console.warn(t),!0}),w=(e.groupCollapsed=function(t){t=Array.prototype.slice.call(arguments).join(" "),console&&"function"==typeof console.groupCollapsed&&console.groupCollapsed(t)},e.groupEnd=function(){console&&"function"==typeof console.groupEnd&&console.groupEnd()},e.error=function(t){console&&"function"==typeof console.error&&(t.stack?console.error(t.stack):console.error(t),arguments.length>1&&console.error.apply(this,Array.prototype.slice.call(arguments,1)))},e.countDecimals=function(t){return Math.floor(t.valueOf())===t.valueOf()?0:t.toString().split(".")[1].length||0},e.addClass=function(t,e){t.classList?t.classList.add(e):t.className+=" "+e}),z=e.removeClass=function(t,e){t.classList?t.classList.remove(e):t.className=t.className.replace(new RegExp("(^|\\b)"+e.split(" ").join("|")+"(\\b|$)","gi")," ")},S=(e.classed=function(t,e,i){if(i===!0)w(t,e);else{if(i!==!1)return S(t,e);z(t,e)}},e.hasClass=function(t,e){return t.classList?t.classList.contains(e):new RegExp("(^| )"+e+"( |$)","gi").test(t.className)}),k=(e.throttle=function(t,e){var i,n,a,r=!1,s=function(){return a>Date.now()?(r=!0,i=arguments,void(n=this)):(a=Date.now()+e,r=!1,t.apply(this,arguments),void setTimeout(function(){o()},e))},o=function(){r&&(r=!1,t.apply(n,i))};return s.recallLast=o,s},e.keys=function(t){return Object.keys(t)},e.values=function(t){for(var e=[],i=Object.keys(t),n=i.length,a=0;a<n;a+=1)e.push(t[i[a]]);return e},e.arrayMin=function(t){return t.reduce(function(t,e){return t<e?t:e})},e.arrayMax=function(t){return t.reduce(function(t,e){return t>e?t:e})},e.arrayMean=function(t){return k(t)/t.length},e.arraySum=function(t){return t.reduce(function(t,e){return t+e})}),E=(e.arrayMedian=function(t){t=t.sort(function(t,e){return t-e});var e=Math.floor((t.length-1)/2);return t.length%2?t[e]:(t[e]+t[e+1])/2},e.arrayLast=function(t){return t.length?t[t.length-1]:null},e.diffObject=function t(e,i){var n={};return y(e,function(e,a){if(i.hasOwnProperty(a)){if(e!==i[a])if(v(e)&&v(i[a])){var r=t(e,i[a]);Object.keys(r).length>0&&(n[a]=r)}else d(e)&&d(i[a])&&b(e,i[a])||(n[a]=e)}else n[a]=e}),n},e.defer=function(t){setTimeout(t,1)},e.delay=function(t){return new Promise(function(e){return setTimeout(e,t)})},e.clearDelay=function(t){return clearTimeout(t)},e.hashCode=function(t){m(t)||(t=JSON.stringify(t));var e,i=0,n=t.length;if(0===n)return i;for(var a=0;a<n;a+=1)e=t.charCodeAt(a),i=(i<<5)-i+e,i&=i;return i.toString()},e.nestArrayToObj=function t(e){if(!e||!e.length||!e[0].key)return e;for(var i={},n=0;n<e.length;n++)i[e[n].key]=t(e[n].values);return i},e.interpolateVector=function(){},e.interpolatePoint=function(t,e,i,n,a,r,s,o){if(!t||0===t.length)return M("interpolatePoint failed because incoming array is empty. It was "+i),null;if("constant"===e)return i;if("property"===e)return t[0][i];if(o){if(r-t[0][a]<=0)return t[0][i];if(r-t[t.length-1][a]>=0)return t[t.length-1][i]}else if(r<t[0][a]||r>t[t.length-1][a])return null;if(n||0===n||(n=d3.bisectLeft(t.map(function(t){return t[a]}),r)),0===n)return t[0][i];if(void 0===t[n]||null===t[n][i]||null===t[n-1][i]||""===t[n][i])return M("interpolatePoint failed because next/previous points are bad in "+i),null;var l=u.default[s||"linear"](t[n-1][a],t[n][a],t[n-1][i],t[n][i],r);return i===a&&(l=new Date(l)),p(l)&&(M("interpolatePoint failed because result is NaN. It was "+i),l=null),l},e.ajax=function(t){var e=new XMLHttpRequest;e.open(t.method,t.url,!0),"POST"!==t.method||t.json?"POST"===t.method&&t.json&&e.setRequestHeader("Content-Type","application/json; charset=UTF-8"):e.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),e.onload=function(){if(e.status>=200&&e.status<400){var i=t.json?JSON.parse(e.responseText):e.responseText;t.success&&t.success(i)}else t.error&&t.error()},e.onerror=function(){t.error&&t.error()},e.send(t.data)});e.get=function(t,e,i,n,a){e=e||[],y(e,function(t,i){e.push(i+"="+t)}),t=e.length?t+"?"+e.join("&"):t,E({method:"GET",url:t,success:i,error:n,json:a})},e.post=function(t,e,i,n,a){E({method:"POST",url:t,success:i,error:n,json:a,data:e})},e.memoize=function(t){return function(){for(var e=Array.prototype.slice.call(arguments),i="",n=e.length,a=null;n--;)a=e[n],i+=a===Object(a)?JSON.stringify(a):a,t.memoize||(t.memoize={});return i in t.memoize?t.memoize[i]:t.memoize[i]=t.apply(this,e)}},e.debounce=function(t,e,i){var n;return function(){var a=this,r=arguments,s=function(){n=null,i||t.apply(a,r)},o=i&&!n;clearTimeout(n),n=setTimeout(s,e),o&&t.apply(a,r)}},e.isTouchDevice=function(){return null!=((d3.event||{}).sourceCapabilities||{}).firesTouchEvents?d3.event.sourceCapabilities.firesTouchEvents:!!("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)},e.pruneTree=function t(e,i){var n={},a=[];return e.hasOwnProperty("children")&&(a=e.children.map(function(e){return t(e,i)}).filter(function(t){return 0!==Object.keys(t).length})),(0!=a.length||i(e))&&y(e,function(t,e){n[e]=t}),0!=a.length&&(n.children=a),n},e.setIcon=function(t,e){return t.selectAll("*").remove(),t.node().appendChild(t.node().ownerDocument.importNode((new DOMParser).parseFromString(e,"application/xml").documentElement,!0)),t}},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function r(t,e){var i=function(e){return t.replace(/<%=([^\%]*)%>/g,function(t){var i=t.match(/t\s*\(([^)]+)\)/g);return i.length?i=e.t(i[0].match(/\"([^"]+)\"/g)[0].split('"').join("")):(i=t.match(/([a-z\-A-Z]+([a-z\-A-Z0-9]?[a-zA-Z0-9]?)?)/g)[0],i=e[i]||i),i})},n=/<[a-z][\s\S]*>/i.test(t)?i:v[t]=v[t]||r(f.default.templates[t]);return e?n(e):n}Object.defineProperty(e,"__esModule",{value:!0});var s=i(1),o=a(s),l=i(46),c=n(l),h=i(47),u=n(h),d=i(45),f=n(d),m="vzb-loading-first",p="vzb-loading-data",g="vzb-error",v={},b=c.default.extend({init:function(t,e){if(this._id=this._id||o.uniqueId("c"),this._ready=!1,this._readyOnce=!1,this.name=this.name||t.name||this._id,this.template=this.template||"<div></div>",this.placeholder=this.placeholder||t.placeholder,this.template_data=this.template_data||{name:this.name},this.placeholder&&!o.isElement(this.placeholder))try{this.placeholder=e.placeholder.querySelector(this.placeholder)}catch(t){o.error("Error finding placeholder '"+this.placeholder+"' for component '"+this.name+"'")}this.parent=e||null,this.root=this.parent?this.parent.root:this,this.components=this.components||[],this._components_config=this.components.map(function(t){return o.clone(t)}),this.model_expects=this.model_expects||[],this.model_binds=this.model_binds||{},this.createModel(t.model),this.ui=this.model.ui||this.ui||t.ui,this._super(),this.registerListeners()},createModel:function(t){this.model=this._modelMapping(t)},registerListeners:function(){this.on({readyOnce:this.readyOnce,ready:this.ready,domReady:this.domReady,resize:this.resize})},startPreload:function(){var t=[];return t.push(this.preload()),o.forEach(this.components,function(e){return t.push(e.startPreload())}),Promise.all(t)},preload:function(){return Promise.resolve()},afterPreload:function(){this.model&&this.model.afterPreload(),o.forEach(this.components,function(t){t.afterPreload()})},render:function(){var t=this;this.loadTemplate(),this.loadSubComponents(),o.forEach(this.components,function(e){e.render(),t.on("resize",function(){e.trigger("resize")})}),this.startLoading()},startLoading:function(){var t=this;this.model.on("ready",function(){t.loadingDone()}),this.model&&this.model.isLoading()||this.loadingDone()},loadingDone:function(){o.removeClass(this.placeholder,m),o.removeClass(this.placeholder,p),this.setReady()},renderError:function(){o.removeClass(this.placeholder,m),o.removeClass(this.placeholder,p),o.addClass(this.placeholder,g),this.setError({type:"data"})},setError:function(t){"function"==typeof this.error&&this.error(t)},setReady:function(t){this._readyOnce||(this.trigger("readyOnce"),this._readyOnce=!0),this._ready=!0,this.trigger("ready")},loadTemplate:function(){var t=this.template,e=this.template_data,i="";if(this.placeholder){if(e=o.extend(e,{t:this.getTranslationFunction(!0)}),this.template)try{i=r(t,e)}catch(t){o.error("Templating error for component: '"+this.name+"' - Check if template name is unique and correct. E.g.: 'bubblechart'"),o.removeClass(this.placeholder,p),o.addClass(this.placeholder,g),this.setError({type:"template"})}o.addClass(this.placeholder,p),o.addClass(this.placeholder,m),this.placeholder.innerHTML=i,this.element=this.placeholder.children[0],this.trigger("domReady")}},getActiveProfile:function(t,e){var i=this.getLayoutProfile(),n=this.getPresentationMode(),a=o.deepClone(t[i]);return n&&(e||{})[i]&&o.deepExtend(a,e[i]),a},loadSubComponents:function(){var t,e,i=this;this.components=[],o.forEach(this._components_config,function(n){if(n.model=n.model||{},!n.component)return void o.error("Error loading component: name not provided");if(e=o.isString(n.component)?b.get(n.component):n.component){t=o.extend(n,{name:n.component,ui:i._uiMapping(n.placeholder,n.ui)});var a=new e(t,i);i.components.push(a)}})},findChildByName:function(t){return o.find(this.components,function(e){return e.name===t})},getLayoutProfile:function(){return this.model.ui?this.model.ui.currentProfile():this.parent.getLayoutProfile()},getPresentationMode:function(){return this.model.ui?this.model.ui.getPresentationMode():this.parent.getPresentationMode()},_uiMapping:function(t,e){if(e)return new u.default("ui",e);if(t&&this.ui){t=t.replace(".","");var i=this.ui[t];if(i)return i}return this.ui},_modelMapping:function(t){function e(t){for(var e=t.split("."),n=i.parent.model,a="";e.length;)a=e.shift(),n=n[a];return{name:t,model:n,type:n?n.getType():null}}var i=this,n={};if(o.isArray(t)&&o.isArray(this.model_expects)){this.model_expects.length!==t.length&&(o.groupCollapsed("DIFFERENCE IN NUMBER OF MODELS EXPECTED AND RECEIVED"),o.warn("Please, configure the 'model_expects' attribute accordingly in '"+this.name+"' or check the models passed in '"+i.parent.name+"'.\n\nComponent: '"+i.parent.name+"'\nSubcomponent: '"+this.name+"'\nNumber of Models Expected: "+this.model_expects.length+"\nNumber of Models Received: "+t.length),o.groupEnd()),o.forEach(t,function(a,r){var s,l=e(a);i.model_expects[r]?(s=i.model_expects[r].name,!i.model_expects[r].type||l.type===i.model_expects[r].type||o.isArray(i.model_expects[r].type)&&i.model_expects[r].type.indexOf(l.type)!==-1||(o.groupCollapsed("UNEXPECTED MODEL TYPE: '"+l.type+"' instead of '"+i.model_expects[r].type+"'"),o.warn("Please, configure the 'model_expects' attribute accordingly in '"+i.name+"' or check the models passed in '"+i.parent.name+"'.\n\nComponent: '"+i.parent.name+"'\nSubcomponent: '"+i.name+"'\nExpected Model: '"+i.model_expects[r].type+"'\nReceived Model: '"+l.type+"'\nModel order: "+r),o.groupEnd())):(o.groupCollapsed("UNEXPECTED MODEL: '"+t[r]+"'"),o.warn("Please, configure the 'model_expects' attribute accordingly in '"+i.name+"' or check the models passed in '"+i.parent.name+"'.\n\nComponent: '"+i.parent.name+"'\nSubcomponent: '"+i.name+"'\nNumber of Models Expected: "+i.model_expects.length+"\nNumber of Models Received: "+t.length),o.groupEnd(),s=l.name),n[s]=l.model});var a=t.length,r=this.model_expects.length;return r>a&&(this.model_expects.splice(0,a),o.forEach(r,function(t){n[t.name]={}})),new u.default(this.name,n,null,this.model_binds)}},getTranslationFunction:function(t){var e;try{e=this.model.get("locale").getTFunction()}catch(t){this.parent&&this.parent!==this&&(e=this.parent.getTranslationFunction())}return e||(e=function(t){return t}),t?this._translatedStringFunction(e):e},_translatedStringFunction:function(t){return function(e){var i=t(e);return'<span data-vzb-translate="'+e+'">'+i+"</span>"}},translateStrings:function(){var t=this.getTranslationFunction(),e=this.placeholder.querySelectorAll("[data-vzb-translate]");0!==e.length&&o.forEach(e,function(e){e&&e.getAttribute&&(e.innerHTML=t(e.getAttribute("data-vzb-translate")))})},readyOnce:function(){},ready:function(){},resize:function(){},domReady:function(){},clear:function(){this.freeze(),this.model&&this.model.freeze(),o.forEach(this.components,function(t){t.clear()})}});b.isComponent=function(t){return t._id&&("t"===t._id[0]||"c"===t._id[0])},e.default=b},function(t,e,i){var n=i(6);t.exports=function(t){if(!n(t))throw TypeError(t+" is not an object!");return t}},function(t,e){var i=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=i)},function(t,e){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,e){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,e,i){var n=i(81)("wks"),a=i(57),r=i(4).Symbol,s="function"==typeof r,o=t.exports=function(t){return n[t]||(n[t]=s&&r[t]||(s?r:a)("Symbol."+t))};o.store=n},function(t,e,i){t.exports=!i(5)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(t,e,i){var n=i(3),a=i(161),r=i(33),s=Object.defineProperty;e.f=i(8)?Object.defineProperty:function(t,e,i){if(n(t),e=r(e,!0),n(i),a)try{return s(t,e,i)}catch(t){}if("get"in i||"set"in i)throw TypeError("Accessors not supported!");return"value"in i&&(t[e]=i.value),t}},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.paintbrush='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M1615 0q70 0 122.5 46.5t52.5 116.5q0 63-45 151-332 629-465 752-97 91-218 91-126 0-216.5-92.5t-90.5-219.5q0-128 92-212l638-579q59-54 130-54zm-909 1034q39 76 106.5 130t150.5 76l1 71q4 213-129.5 347t-348.5 134q-123 0-218-46.5t-152.5-127.5-86.5-183-29-220q7 5 41 30t62 44.5 59 36.5 46 17q41 0 55-37 25-66 57.5-112.5t69.5-76 88-47.5 103-25.5 125-10.5z"/></svg>',e.search='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M1216 832q0-185-131.5-316.5t-316.5-131.5-316.5 131.5-131.5 316.5 131.5 316.5 316.5 131.5 316.5-131.5 131.5-316.5zm512 832q0 52-38 90t-90 38q-54 0-90-38l-343-342q-179 124-399 124-143 0-273.5-55.5t-225-150-150-225-55.5-273.5 55.5-273.5 150-225 225-150 273.5-55.5 273.5 55.5 225 150 150 225 55.5 273.5q0 220-124 399l343 343q37 37 37 90z"/></svg>',e.circle='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M1664 896q0 209-103 385.5t-279.5 279.5-385.5 103-385.5-103-279.5-279.5-103-385.5 103-385.5 279.5-279.5 385.5-103 385.5 103 279.5 279.5 103 385.5z"/></svg>',e.expand='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M883 1056q0 13-10 23l-332 332 144 144q19 19 19 45t-19 45-45 19h-448q-26 0-45-19t-19-45v-448q0-26 19-45t45-19 45 19l144 144 332-332q10-10 23-10t23 10l114 114q10 10 10 23zm781-864v448q0 26-19 45t-45 19-45-19l-144-144-332 332q-10 10-23 10t-23-10l-114-114q-10-10-10-23t10-23l332-332-144-144q-19-19-19-45t19-45 45-19h448q26 0 45 19t19 45z"/></svg>',e.asterisk='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M1546 1050q46 26 59.5 77.5t-12.5 97.5l-64 110q-26 46-77.5 59.5t-97.5-12.5l-266-153v307q0 52-38 90t-90 38h-128q-52 0-90-38t-38-90v-307l-266 153q-46 26-97.5 12.5t-77.5-59.5l-64-110q-26-46-12.5-97.5t59.5-77.5l266-154-266-154q-46-26-59.5-77.5t12.5-97.5l64-110q26-46 77.5-59.5t97.5 12.5l266 153v-307q0-52 38-90t90-38h128q52 0 90 38t38 90v307l266-153q46-26 97.5-12.5t77.5 59.5l64 110q26 46 12.5 97.5t-59.5 77.5l-266 154z"/></svg>',e.trails='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M 1381.375 17.1875 C 1375.7825 17.176804 1370.1216 17.316078 1364.4375 17.5625 C 1273.4913 21.505489 1197.0982 57.199956 1135.2188 124.6875 C 1076.5961 188.62338 1047.6964 263.96059 1048.5312 350.65625 L 835.71875 433 C 797.77288 391.67699 749.96961 361.96416 692.3125 343.84375 C 604.96227 316.39162 520.95691 323.70366 440.25 365.8125 C 359.5432 407.92133 305.45225 472.64985 278 560 C 250.54783 647.35004 257.89117 731.38694 300 812.09375 C 342.10886 892.80075 406.83755 946.89147 494.1875 974.34375 C 576.9404 1000.3512 657.38873 994.58645 735.5625 957.09375 L 959.28125 1171.4375 L 972.375 1184.4062 C 966.2931 1198.3454 961.94845 1209.2226 959.34375 1217.0625 C 956.73915 1224.9024 953.7186 1236.224 950.25 1251.0312 L 711.03125 1285.1875 C 669.59175 1209.0324 607.72526 1157.2863 525.40625 1129.9375 C 438.51381 1101.0693 354.34933 1107.021 272.96875 1147.8125 C 191.58796 1188.6039 136.49335 1252.4513 107.625 1339.3438 C 78.756758 1426.2362 84.708528 1510.3694 125.5 1591.75 C 166.29138 1673.1307 230.1387 1728.2567 317.03125 1757.125 C 403.92369 1785.9933 488.05682 1780.0415 569.4375 1739.25 C 650.81799 1698.4587 705.94425 1634.6111 734.8125 1547.7188 C 737.41718 1539.8788 740.43763 1528.5573 743.90625 1513.75 L 983.125 1479.5938 C 1024.5644 1555.7487 1086.4309 1607.4948 1168.75 1634.8438 C 1255.6425 1663.7119 1339.8069 1657.7603 1421.1875 1616.9688 C 1502.5682 1576.1772 1557.6631 1512.3299 1586.5312 1425.4375 C 1615.3996 1338.5451 1609.4477 1254.4119 1568.6562 1173.0312 C 1527.8647 1091.6506 1464.0174 1036.5244 1377.125 1007.6562 C 1294.9259 980.34721 1214.5066 984.74084 1135.8438 1020.8125 L 1120.2812 1005.9062 L 898.0625 785.96875 C 902.79653 774.40321 906.33847 765.03422 908.5 758.15625 C 920.42249 720.22 925.7916 682.90194 924.59375 646.21875 L 1130.9688 566.34375 C 1141.2015 577.59424 1149.3796 586.0106 1155.4688 591.59375 C 1222.9566 653.47326 1302.1474 682.44278 1393.0938 678.5 C 1484.04 674.55731 1560.4642 638.83151 1622.3438 571.34375 C 1684.2232 503.85591 1713.1929 424.6337 1709.25 333.6875 C 1705.3072 242.74139 1669.5816 166.34819 1602.0938 104.46875 C 1538.8238 46.456824 1465.2625 17.347946 1381.375 17.1875 z "/></svg>',e.lock='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M640 768h512v-192q0-106-75-181t-181-75-181 75-75 181v192zm832 96v576q0 40-28 68t-68 28h-960q-40 0-68-28t-28-68v-576q0-40 28-68t68-28h32v-192q0-184 132-316t316-132 316 132 132 316v192h32q40 0 68 28t28 68z"/></svg>',e.unlock='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M1376 768q40 0 68 28t28 68v576q0 40-28 68t-68 28h-960q-40 0-68-28t-28-68v-576q0-40 28-68t68-28h32v-320q0-185 131.5-316.5t316.5-131.5 316.5 131.5 131.5 316.5q0 26-19 45t-45 19h-64q-26 0-45-19t-19-45q0-106-75-181t-181-75-181 75-75 181v320h736z"/></svg>',e.unexpand='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M896 960v448q0 26-19 45t-45 19-45-19l-144-144-332 332q-10 10-23 10t-23-10l-114-114q-10-10-10-23t10-23l332-332-144-144q-19-19-19-45t19-45 45-19h448q26 0 45 19t19 45zm755-672q0 13-10 23l-332 332 144 144q19 19 19 45t-19 45-45 19h-448q-26 0-45-19t-19-45v-448q0-26 19-45t45-19 45 19l144 144 332-332q10-10 23-10t23 10l114 114q10 10 10 23z"/></svg>',e.axes='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 500 500"><path d="M430.25,379.655l-75.982-43.869v59.771H120.73V151.966h59.774l-43.869-75.983L92.767,0L48.898,75.983L5.029,151.966h59.775 v271.557c0,15.443,12.52,27.965,27.963,27.965h261.5v59.773l75.982-43.869l75.982-43.867L430.25,379.655z"/></svg>',e.gear='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M1152 896q0-106-75-181t-181-75-181 75-75 181 75 181 181 75 181-75 75-181zm512-109v222q0 12-8 23t-20 13l-185 28q-19 54-39 91 35 50 107 138 10 12 10 25t-9 23q-27 37-99 108t-94 71q-12 0-26-9l-138-108q-44 23-91 38-16 136-29 186-7 28-36 28h-222q-14 0-24.5-8.5t-11.5-21.5l-28-184q-49-16-90-37l-141 107q-10 9-25 9-14 0-25-11-126-114-165-168-7-10-7-23 0-12 8-23 15-21 51-66.5t54-70.5q-27-50-41-99l-183-27q-13-2-21-12.5t-8-23.5v-222q0-12 8-23t19-13l186-28q14-46 39-92-40-57-107-138-10-12-10-24 0-10 9-23 26-36 98.5-107.5t94.5-71.5q13 0 26 10l138 107q44-23 91-38 16-136 29-186 7-28 36-28h222q14 0 24.5 8.5t11.5 21.5l28 184q49 16 90 37l142-107q9-9 24-9 13 0 25 10 129 119 165 170 7 8 7 22 0 12-8 23-15 21-51 66.5t-54 70.5q26 50 41 98l183 28q13 2 21 12.5t8 23.5z"/></svg>',e.stack='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 54.849 54.849"><g><path d="M54.497,39.614l-10.363-4.49l-14.917,5.968c-0.537,0.214-1.165,0.319-1.793,0.319c-0.627,0-1.254-0.104-1.79-0.318     l-14.921-5.968L0.351,39.614c-0.472,0.203-0.467,0.524,0.01,0.716L26.56,50.81c0.477,0.191,1.251,0.191,1.729,0L54.488,40.33     C54.964,40.139,54.969,39.817,54.497,39.614z"/><path d="M54.497,27.512l-10.364-4.491l-14.916,5.966c-0.536,0.215-1.165,0.321-1.792,0.321c-0.628,0-1.256-0.106-1.793-0.321     l-14.918-5.966L0.351,27.512c-0.472,0.203-0.467,0.523,0.01,0.716L26.56,38.706c0.477,0.19,1.251,0.19,1.729,0l26.199-10.479     C54.964,28.036,54.969,27.716,54.497,27.512z"/><path d="M0.361,16.125l13.662,5.465l12.537,5.015c0.477,0.191,1.251,0.191,1.729,0l12.541-5.016l13.658-5.463     c0.477-0.191,0.48-0.511,0.01-0.716L28.277,4.048c-0.471-0.204-1.236-0.204-1.708,0L0.351,15.41     C-0.121,15.614-0.116,15.935,0.361,16.125z"/></g></svg>',e.drag='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M896 384q-53 0-90.5 37.5t-37.5 90.5v128h-32v-93q0-48-32-81.5t-80-33.5q-46 0-79 33t-33 79v429l-32-30v-172q0-48-32-81.5t-80-33.5q-46 0-79 33t-33 79v224q0 47 35 82l310 296q39 39 39 102 0 26 19 45t45 19h640q26 0 45-19t19-45v-25q0-41 10-77l108-436q10-36 10-77v-246q0-48-32-81.5t-80-33.5q-46 0-79 33t-33 79v32h-32v-125q0-40-25-72.5t-64-40.5q-14-2-23-2-46 0-79 33t-33 79v128h-32v-122q0-51-32.5-89.5t-82.5-43.5q-5-1-13-1zm0-128q84 0 149 50 57-34 123-34 59 0 111 27t86 76q27-7 59-7 100 0 170 71.5t70 171.5v246q0 51-13 108l-109 436q-6 24-6 71 0 80-56 136t-136 56h-640q-84 0-138-58.5t-54-142.5l-308-296q-76-73-76-175v-224q0-99 70.5-169.5t169.5-70.5q11 0 16 1 6-95 75.5-160t164.5-65q52 0 98 21 72-69 174-69z"/></svg>',e.warn='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512.209 512.209"><path d="M507.345,439.683L288.084,37.688c-3.237-5.899-7.71-10.564-13.429-13.988c-5.705-3.427-11.893-5.142-18.554-5.142   s-12.85,1.718-18.558,5.142c-5.708,3.424-10.184,8.089-13.418,13.988L4.859,439.683c-6.663,11.998-6.473,23.989,0.57,35.98   c3.239,5.517,7.664,9.897,13.278,13.128c5.618,3.237,11.66,4.859,18.132,4.859h438.529c6.479,0,12.519-1.622,18.134-4.859   c5.62-3.23,10.038-7.611,13.278-13.128C513.823,463.665,514.015,451.681,507.345,439.683z M292.655,411.132   c0,2.662-0.91,4.897-2.71,6.704c-1.807,1.811-3.949,2.71-6.427,2.71h-54.816c-2.474,0-4.616-0.899-6.423-2.71   c-1.809-1.807-2.713-4.042-2.713-6.704v-54.248c0-2.662,0.905-4.897,2.713-6.704c1.807-1.811,3.946-2.71,6.423-2.71h54.812   c2.479,0,4.62,0.899,6.428,2.71c1.803,1.807,2.71,4.042,2.71,6.704v54.248H292.655z M292.088,304.357   c-0.198,1.902-1.198,3.47-3.001,4.709c-1.811,1.238-4.046,1.854-6.711,1.854h-52.82c-2.663,0-4.947-0.62-6.849-1.854   c-1.908-1.243-2.858-2.807-2.858-4.716l-4.853-130.47c0-2.667,0.953-4.665,2.856-5.996c2.474-2.093,4.758-3.14,6.854-3.14h62.809   c2.098,0,4.38,1.043,6.854,3.14c1.902,1.331,2.851,3.14,2.851,5.424L292.088,304.357z"/></svg>',
e.pin='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M800 864v-448q0-14-9-23t-23-9-23 9-9 23v448q0 14 9 23t23 9 23-9 9-23zm672 352q0 26-19 45t-45 19h-429l-51 483q-2 12-10.5 20.5t-20.5 8.5h-1q-27 0-32-27l-76-485h-404q-26 0-45-19t-19-45q0-123 78.5-221.5t177.5-98.5v-512q-52 0-90-38t-38-90 38-90 90-38h640q52 0 90 38t38 90-38 90-90 38v512q99 0 177.5 98.5t78.5 221.5z"/></svg>',e.question='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="17 17 483 483"> <circle stroke-width="40" cx="258.57" cy="258.57" r="220"/> <path d="M299.756,413.021v-61.78c0-3.003-0.966-5.472-2.896-7.401s-4.398-2.896-7.401-2.896h-61.78 c-3.003,0-5.47,0.965-7.4,2.896c-1.932,1.931-2.896,4.398-2.896,7.401v61.78c0,3.002,0.965,5.47,2.896,7.399 c1.931,1.931,4.396,2.896,7.4,2.896h61.779c3.003,0,5.472-0.967,7.401-2.896S299.756,416.021,299.756,413.021z"/> <path d="M382.128,196.789c0-18.877-5.952-36.36-17.856-52.449c-11.905-16.088-26.762-28.53-44.566-37.325 c-17.804-8.795-36.037-13.192-54.7-13.192c-52.127,0-91.919,22.845-119.377,68.537c-3.218,5.148-2.359,9.653,2.574,13.514 l42.474,32.177c1.502,1.287,3.54,1.931,6.114,1.931c3.433,0,6.115-1.287,8.044-3.861c11.369-14.587,20.594-24.454,27.672-29.603 c7.294-5.148,16.519-7.723,27.673-7.723c10.297,0,19.468,2.789,27.513,8.366c8.044,5.578,12.065,11.906,12.065,18.985 c0,8.151-2.146,14.694-6.437,19.628c-4.29,4.934-11.583,9.76-21.881,14.479c-13.514,6.006-25.901,15.284-37.164,27.834 c-11.263,12.549-16.894,26.01-16.894,40.382v11.583c0,3.004,0.965,5.472,2.896,7.401c1.931,1.93,4.396,2.896,7.4,2.896h61.779 c3.003,0,5.471-0.965,7.401-2.896c1.93-1.931,2.896-4.397,2.896-7.401c0-4.075,2.306-9.385,6.917-15.928 c4.612-6.542,10.458-11.852,17.537-15.927c6.863-3.861,12.119-6.918,15.768-9.171c3.646-2.252,8.579-6.008,14.802-11.263 c6.22-5.255,10.993-10.402,14.317-15.443c3.325-5.042,6.328-11.53,9.01-19.467C380.788,214.916,382.128,206.228,382.128,196.789z"/> </svg>',e.close='<svg class="vzb-icon vzb-icon-pin" viewBox="-150 -250 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1149 414q0 26 -19 45l-181 181l181 181q19 19 19 45q0 27 -19 46l-90 90q-19 19 -46 19q-26 0 -45 -19l-181 -181l-181 181q-19 19 -45 19q-27 0 -46 -19l-90 -90q-19 -19 -19 -46q0 -26 19 -45l181 -181l-181 -181q-19 -19 -19 -45q0 -27 19 -46l90 -90q19 -19 46 -19 q26 0 45 19l181 181l181 -181q19 -19 45 -19q27 0 46 19l90 90q19 19 19 46z"/></svg>',e.presentation='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path id="flip-chart-1" d="M334.549,393.834l58.607,68.666h-45.096l-58.709-68.666H334.549z M240.333,462.5h34.333v-68.666h-34.333 V462.5z M360.5,153.5h-34.334v137.334H360.5V153.5z M121.566,462.5h45.113l58.709-68.666h-45.197L121.566,462.5z M206,273.666 h-34.333v17.168H206V273.666z M257.5,239.333h-34.333v51.5H257.5V239.333z M309,205h-34.334v85.834H309V205z M446.334,102h-17.168 v257.5H85.833V102H68.667V50.5h377.667V102z M394.834,102H120.167v223.166h274.667V102z"/></svg>',e.about='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M1088 1256v240q0 16-12 28t-28 12h-240q-16 0-28-12t-12-28v-240q0-16 12-28t28-12h240q16 0 28 12t12 28zm316-600q0 54-15.5 101t-35 76.5-55 59.5-57.5 43.5-61 35.5q-41 23-68.5 65t-27.5 67q0 17-12 32.5t-28 15.5h-240q-15 0-25.5-18.5t-10.5-37.5v-45q0-83 65-156.5t143-108.5q59-27 84-56t25-76q0-42-46.5-74t-107.5-32q-65 0-108 29-35 25-107 115-13 16-31 16-12 0-25-8l-164-125q-13-10-15.5-25t5.5-28q160-266 464-266 80 0 161 31t146 83 106 127.5 41 158.5z"/></svg>',e.cursorArrow='<svg class="vzb-icon" viewBox="-200 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1389 1043q31 30 14 69-17 40-59 40h-382l201 476q10 25 0 49t-34 35l-177 75q-25 10-49 0t-35-34l-191-452-312 312q-19 19-45 19-12 0-24-5-40-17-40-59v-1504q0-42 40-59 12-5 24-5 27 0 45 19z"/></svg>',e.cursorPlus='<svg class="vzb-icon" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1088 800v64q0 13-9.5 22.5t-22.5 9.5h-224v224q0 13-9.5 22.5t-22.5 9.5h-64q-13 0-22.5-9.5t-9.5-22.5v-224h-224q-13 0-22.5-9.5t-9.5-22.5v-64q0-13 9.5-22.5t22.5-9.5h224v-224q0-13 9.5-22.5t22.5-9.5h64q13 0 22.5 9.5t9.5 22.5v224h224q13 0 22.5 9.5t9.5 22.5zm128 32q0-185-131.5-316.5t-316.5-131.5-316.5 131.5-131.5 316.5 131.5 316.5 316.5 131.5 316.5-131.5 131.5-316.5zm512 832q0 53-37.5 90.5t-90.5 37.5q-54 0-90-38l-343-342q-179 124-399 124-143 0-273.5-55.5t-225-150-150-225-55.5-273.5 55.5-273.5 150-225 225-150 273.5-55.5 273.5 55.5 225 150 150 225 55.5 273.5q0 220-124 399l343 343q37 37 37 90z"/></svg>',e.cursorMinus='<svg class="vzb-icon" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1088 800v64q0 13-9.5 22.5t-22.5 9.5h-576q-13 0-22.5-9.5t-9.5-22.5v-64q0-13 9.5-22.5t22.5-9.5h576q13 0 22.5 9.5t9.5 22.5zm128 32q0-185-131.5-316.5t-316.5-131.5-316.5 131.5-131.5 316.5 131.5 316.5 316.5 131.5 316.5-131.5 131.5-316.5zm512 832q0 53-37.5 90.5t-90.5 37.5q-54 0-90-38l-343-342q-179 124-399 124-143 0-273.5-55.5t-225-150-150-225-55.5-273.5 55.5-273.5 150-225 225-150 273.5-55.5 273.5 55.5 225 150 150 225 55.5 273.5q0 220-124 399l343 343q37 37 37 90z"/></svg>',e.hundredPercent='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg"><g transform="translate(18 11)"><text transform="scale(0.9 1)" x="0" y="0">100</text><text transform="scale(0.6 1)" class="percent" x="0" y="0">%</text></g></svg>',e.percent='<svg class="vzb-icon" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1408 1280q0-52-38-90t-90-38-90 38-38 90 38 90 90 38 90-38 38-90zm-768-768q0-52-38-90t-90-38-90 38-38 90 38 90 90 38 90-38 38-90zm1024 768q0 159-112.5 271.5t-271.5 112.5-271.5-112.5-112.5-271.5 112.5-271.5 271.5-112.5 271.5 112.5 112.5 271.5zm-96-1088q0 20-13 38l-1056 1408q-19 26-51 26h-160q-26 0-45-19t-19-45q0-20 13-38l1056-1408q19-26 51-26h160q26 0 45 19t19 45zm-672 320q0 159-112.5 271.5t-271.5 112.5-271.5-112.5-112.5-271.5 112.5-271.5 271.5-112.5 271.5 112.5 112.5 271.5z"/></svg>',e.side='<svg class="vzb-icon" viewBox="-120 -1540 1792 1792" xmlns="http://www.w3.org/2000/svg"><path transform="rotate(-90) scale(1.2)" d="M1024 448q0 -26 -19 -45l-448 -448q-19 -19 -45 -19t-45 19l-448 448q-19 19 -19 45t19 45t45 19h896q26 0 45 -19t19 -45zM1024 832q0 -26 -19 -45t-45 -19h-896q-26 0 -45 19t-19 45t19 45l448 448q19 19 45 19t45 -19l448 -448q19 -19 19 -45z"/></svg>'},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function r(t,e,i){var n,a,r,s,l,c,h,u,d,f,m,p,g,v;return{move:function(e,i){t.style("right",e+"px"),t.style("top",i+"px")},dragStart:function(b){if(o.isTouchDevice()){var y=d3.touches(e.node());n=y[0][0],a=y[0][1]}else n=b.sourceEvent.clientX,a=b.sourceEvent.clientY;r=parseInt(t.style("top"))||0,s=parseInt(t.style("right"))||0,c=parseInt(t.style("margin-left"))||0,l=parseInt(t.style("margin-right"))||0,u=Math.min(i,c),h=Math.min(i,l),d=parseInt(t.style("width"))+c-u,f=parseInt(t.style("height")),m=parseInt(e.style("width"))-l,p=parseInt(e.style("height")),g=n+s,v=a-r},drag:function(t){if(o.isTouchDevice()){var i=d3.touches(e.node());n=i[0][0],a=i[0][1]}else n=t.sourceEvent.clientX,a=t.sourceEvent.clientY;var r=-n+g,s=a-v;r<-h&&(r=-h),s<0&&(s=0),r+d>m&&(r=m-d),s+f>p&&(s=p-f),this.move(r,s)}}}Object.defineProperty(e,"__esModule",{value:!0});var s=i(1),o=a(s),l=i(2),c=n(l),h=i(10),u=i(70),d=n(u),f=(0,d.default)(i(458)),m=c.default.extend({init:function(t,e){this.name=this.name||"",this.model_expects=this.model_expects||[{name:"state",type:"model"},{name:"ui",type:"ui"},{name:"locale",type:"locale"}],this.template=f[this.name],this._super(t,e)},readyOnce:function(){this.element=d3.select(this.element),this.titleEl=this.element.selectAll(".vzb-top-dialog > .vzb-dialog-modal > .vzb-dialog-title"),this.buttonsEl=this.element.selectAll(".vzb-top-dialog > .vzb-dialog-modal > .vzb-dialog-buttons"),this.contentEl=this.element.selectAll(".vzb-top-dialog > .vzb-dialog-modal > .vzb-dialog-content")},ready:function(){var t=this;this.placeholderEl=d3.select(this.placeholder),this.rootEl=this.root.element instanceof Array?this.root.element:d3.select(this.root.element),this.dragHandler=this.placeholderEl.select("[data-click='dragDialog']"),this.dragHandler.html(h.drag),this.pinIcon=this.placeholderEl.select("[data-click='pinDialog']"),this.pinIcon.html(h.pin),this.topPos="";var e=this.getLayoutProfile(),i=r(this.placeholderEl,this.rootEl,10),n=d3.behavior.drag().on("dragstart",function(){var e=t.placeholderEl.node().offsetTop;t.placeholderEl.style({top:e+"px",bottom:"auto"}),t.trigger("dragstart"),i.dragStart(d3.event)}).on("drag",function(){t.trigger("drag"),i.drag(d3.event)}).on("dragend",function(){t.rightPos=t.placeholderEl.style("right"),t.topPos=t.placeholderEl.style("top"),t.trigger("dragend")});this.dragHandler.call(n),this.dragHandler.classed("vzb-hidden","small"===e),this.pinIcon.classed("vzb-hidden","small"===e),this.resize()},resize:function(){if(this.placeholderEl&&this.rootEl&&this.placeholderEl.classed("vzb-top-dialog")){this.placeholderEl.classed("notransition",!0);var t=this.getLayoutProfile();if("small"!==t){var e=parseInt(this.rootEl.style("width"),10),i=parseInt(this.rightPos,10),n=parseInt(this.rootEl.style("height"),10),a=parseInt(this.topPos,10),r=parseInt(this.placeholderEl.style("width"),10),s=parseInt(this.placeholderEl.style("height"),10),l=parseInt(this.placeholderEl.style("margin-right"),10)||0;o.isNumber(i)&&i>e-r-l&&this.rightPos&&(this.rightPos=e-r-l+"px",this.isOpen&&this.placeholderEl.style("right",this.rightPos)),o.isNumber(a)&&o.isNumber(s)&&a>=0&&a>n-s&&this.topPos&&(this.topPos=(n-s>0?n-s:0)+"px",this.isOpen&&this.placeholderEl.style("top",this.topPos)),this.topPos&&"large"===this.getLayoutProfile()&&this.rootEl.classed("vzb-dialog-expand-true")&&this.placeholderEl.style("bottom","auto"),this.rootEl.classed("vzb-landscape"),this.element.style("max-height","")}else this.rightPos="",this.topPos="",this.placeholderEl.attr("style","");this.dragHandler.classed("vzb-hidden","small"===t),this.pinIcon.classed("vzb-hidden","small"===t),this._setMaxHeight()}},_setMaxHeight:function(){var t=this.root.element.offsetHeight;if("small"!==this.getLayoutProfile())if(!this.topPos&&"large"===this.getLayoutProfile()&&this.rootEl.classed("vzb-dialog-expand-true")){var e=parseInt(this.placeholderEl.style("bottom"),10);t-=e}else{var i=this.topPos?parseInt(this.topPos,10):this.placeholderEl[0][0].offsetTop;t-=i}else t=this.rootEl.classed("vzb-portrait")?t-50:t-10;this.element.style("max-height",t+"px");var n=t-this.titleEl.node().offsetHeight-this.buttonsEl.node().offsetHeight;this.contentEl.style("max-height",n+"px")},beforeOpen:function(){var t=this;if(this.transitionEvents=["webkitTransitionEnd","transitionend","msTransitionEnd","oTransitionEnd"],this.transitionEvents.forEach(function(e){t.placeholderEl.on(e,t.transitionEnd.bind(t,e))}),this.placeholderEl.classed("notransition",!0),this.placeholderEl.style({top:"",bottom:""}),this.topPos&&"large"===this.getLayoutProfile()&&this.rootEl.classed("vzb-dialog-expand-true")){var e=this.placeholderEl.node().offsetTop;this.placeholderEl.style({top:e+"px",bottom:"auto"})}else"small"!==this.getLayoutProfile();this.placeholderEl.node().offsetTop,this.placeholderEl.classed("notransition",!1),"small"===this.getLayoutProfile()?this.placeholderEl.style("top",""):this.rootEl.classed("vzb-landscape")},open:function(){this.isOpen=!0,"small"!==this.getLayoutProfile()&&this.topPos&&(this.placeholderEl.style("top",this.topPos),this.placeholderEl.style("right",this.rightPos))},beforeClose:function(){this.rootEl.classed("vzb-portrait")&&"small"===this.getLayoutProfile()&&this.placeholderEl.style("top","auto"),"large"===this.getLayoutProfile()&&this.rootEl.classed("vzb-dialog-expand-true")&&(this.topPos0=this.topPos?this.placeholderEl.node().parentNode.offsetHeight-this.placeholderEl.node().offsetHeight+"px":""),this.placeholderEl.classed("notransition",!1),this.placeholderEl.node().offsetHeight},close:function(){this.rootEl.classed("vzb-portrait")&&"small"===this.getLayoutProfile()||(this.placeholderEl.style("top",""),this.placeholderEl.style("right","")),"large"===this.getLayoutProfile()&&this.rootEl.classed("vzb-dialog-expand-true")&&this.placeholderEl.style({top:this.topPos0,right:""}),this.isOpen=!1,this.trigger("close")},transitionEnd:function(t){var e=this;this.transitionEvents.forEach(function(t){e.placeholderEl.on(t,null)}),this.isOpen&&this.placeholderEl.classed("notransition",!0)}});e.default=m},function(t,e,i){var n=i(44),a=Math.min;t.exports=function(t){return t>0?a(n(t),9007199254740991):0}},function(t,e,i){var n=i(29);t.exports=function(t){return Object(n(t))}},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s=i(1),o=a(s),l=i(47),c=n(l),h=i(2),u=n(h),d=i(46),f=n(d),m=i(10),p="vzb-loading-data",g="vzb-placeholder",v="vzb-buttonlist-off",b=c.default.extend({init:function(t,e){this._id=o.uniqueId("tm"),this._type="tool",this._component=t,this.getClassDefaults=function(){return t.default_model};var i=o.extend(t.getToolListeners(),e.bind);delete e.bind,this._super(t.name,e,null,i)},getDefaults:function(){return o.deepExtend({},this.getSubmodelDefaults(),this.getClassDefaults())},validate:function(){function t(i){var a=JSON.stringify(n.getPlainObject());n._component.validate(n);var r=JSON.stringify(n.getPlainObject());i>=e?o.error("Max validation loop."):a!==r&&t(i++)}var e=10,i=0,n=this;t(i)}}),y=u.default.extend({init:function(t,e){this._id=o.uniqueId("t"),this.template=this.getToolTemplate(),this._super({placeholder:t,model:e}),this.render(),this.setCSSClasses(),this.setResizeHandler()},createModel:function(t){t=t||{},t.bind=t.bind||{},this.model=new b(this,t),this.model.setInterModelListeners()},getToolTemplate:function(){return this.template||'<div class="vzb-tool vzb-tool-'+this.name+'"><div class="vzb-tool-stage"><div class="vzb-tool-viz"></div><div class="vzb-tool-time-speed-sliders"><div class="vzb-tool-timeslider"></div><div class="vzb-tool-stepped-speed-slider"></div></div></div><div class="vzb-tool-sidebar"><div class="vzb-tool-dialogs"></div><div class="vzb-tool-buttonlist"></div></div><div class="vzb-tool-datanotes vzb-hidden"></div><div class="vzb-tool-treemenu vzb-hidden"></div><div class="vzb-tool-datawarning vzb-hidden"></div><div class="vzb-tool-labels vzb-hidden"></div></div>'},getToolListeners:function(){var t=this,e=this;return o.extend(this.model_binds,{change:function(t,i){e._ready&&(e.model.validate(),t.source.persistent&&e.model.trigger(new d.DefaultEvent(t.source,"persistentChange")))},hook_change:function(){e.model.state.time.splash||e.beforeLoading()},"resize:ui":function(){e._ready&&e.triggerResize()},"translate:locale":function(){e.translateStrings(),e.model.ui.setRTL(e.model.locale.isRTL())},load_error:function(){t.renderError(),t.error.apply(t,arguments)}})},setResizeHandler:function(){this.model.ui.setContainer(this.element)},triggerResize:o.throttle(function(){this.trigger("resize")},100),startLoading:function(){var t=this;this._super(),Promise.all([this.model.startPreload(),this.startPreload()]).then(this.afterPreload.bind(this)).then(this.loadSplashScreen.bind(this)).then(function(){return o.delay(300)}).then(this.model.startLoading.bind(this.model)).then(this.finishLoading.bind(this)).catch(function(e){f.default.unfreezeAll(),t.model.triggerLoadError(e)})},loadSplashScreen:function(){return this.model.ui.splash?(this.model.state.time.splash=!0,this.model.startLoading({splashScreen:!0})):Promise.resolve()},finishLoading:function(){this.model.state.time.splash=!1},getPersistentModel:function(){var t=function t(e){for(var i in e)"function"==typeof e[i]?(delete e[i],o.warn("minModel validation. Function found in enumerable properties of "+i+". This key is deleted from minModel")):"object"===r(e[i])&&t(e[i])},e=this.model.getPlainObject(!0);return t(e),e},getPersistentMinimalModel:function(t){var e=this.model.getDefaults(),i=this.getPersistentModel(),n=o.deepExtend(e,t);return o.diffObject(i,n)},clear:function(){this.model.ui.clear(),this.setModel=this.getModel=function(){},this._super()},error:function(t,e){e||(e=t&&"data"===t.type?"Error loading chart data. <br>Please, try again later.":"Error loading chart"),this.placeholder.innerHTML='<div class="vzb-error-message"><h1>'+m.warn+"</h1><p>"+e+"</p></div>"},setModel:function(t,e){e?this.model.reset(t):this.model.set(t),this.setCSSClasses()},getModel:function(){return this.model.getPlainObject()||{}},beforeLoading:function(){o.addClass(this.placeholder,p)},validate:function(t){if(t=this.model||t,!t||!t.state)return o.warn("tool validation aborted: model.state looks wrong: "+t)},setCSSClasses:function(){o.addClass(this.placeholder,g),this.model.ui&&this.model.ui.buttons&&this.model.ui.buttons.length?o.removeClass(this.element,v):o.addClass(this.element,v)}});e.default=y},function(t,e){var i={}.hasOwnProperty;t.exports=function(t,e){return i.call(t,e)}},function(t,e){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},function(t,e,i){var n=i(9),a=i(43);t.exports=i(8)?function(t,e,i){return n.f(t,e,a(1,i))}:function(t,e,i){return t[e]=i,t}},function(t,e,i){var n=i(4),a=i(17),r=i(15),s=i(57)("src"),o="toString",l=Function[o],c=(""+l).split(o);i(35).inspectSource=function(t){return l.call(t)},(t.exports=function(t,e,i,o){var l="function"==typeof i;l&&(r(i,"name")||a(i,"name",e)),t[e]!==i&&(l&&(r(i,s)||a(i,s,t[e]?""+t[e]:c.join(String(e)))),t===n?t[e]=i:o?t[e]?t[e]=i:a(t,e,i):(delete t[e],a(t,e,i)))})(Function.prototype,o,function(){return"function"==typeof this&&this[s]||l.call(this)})},function(t,e,i){var n=i(0),a=i(5),r=i(29),s=/"/g,o=function(t,e,i,n){var a=String(r(t)),o="<"+e;return""!==i&&(o+=" "+i+'="'+String(n).replace(s,"&quot;")+'"'),o+">"+a+"</"+e+">"};t.exports=function(t,e){var i={};i[t]=e(o),n(n.P+n.F*a(function(){var e=""[t]('"');return e!==e.toLowerCase()||e.split('"').length>3}),"String",i)}},function(t,e,i){var n=i(68),a=i(29);t.exports=function(t){return n(a(t))}},function(t,e,i){"use strict";function n(t,e){function i(){this.trackInstances&&i.instances.push(this),!r&&this.init&&this.init.apply(this,arguments)}e=1===arguments.length?t:e;var o=this.prototype;r=!0;var l=new this;return r=!1,(0,a.forEach)(e,function(t,i){"function"==typeof e[i]&&"function"==typeof o[i]&&s.test(e[i])?l[i]=function(t,e){return function(){var i=this._super;this._super=o[t];var n=e.apply(this,arguments);return this._super=i,n}}(i,e[i]):l[i]=t}),i.prototype=l,i.prototype.constructor=i,i.extend=n,i._collection={},i.instances=[],i.register=function(t,e){"undefined"!=typeof this._collection[t]&&(0,a.warn)('"'+t+'" is already registered. Overwriting...'),this._collection[t]=e},i.unregister=function(t){this._collection[t]=void 0},i.getCollection=function(){return this._collection},i.define=function(t,e){this.prototype[t]=e},i.get=function(t,e){return this._collection.hasOwnProperty(t)?this._collection[t]:(e||(0,a.warn)('"'+t+'" was not found.'),!1)},arguments.length>1&&this.register&&this.register(t,i),i}Object.defineProperty(e,"__esModule",{value:!0});var a=i(1),r=!1,s=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/,o=function(){};o.extend=n,e.default=o},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function r(){return!!window&&(void 0!==window.document.webkitIsFullScreen?window.document.webkitIsFullScreen:void 0!==window.document.mozFullScreen?window.document.mozFullScreen:void 0!==window.document.msFullscreenElement&&window.document.msFullscreenElement)}function s(t){r()||(l.call(this),this.resizeInExitHandler?this.root.ui.resizeHandler():t())}function o(t){if(window){var e=window.document;this.exitFullscreenHandler=s.bind(this,t),e.addEventListener("webkitfullscreenchange",this.exitFullscreenHandler,!1),e.addEventListener("mozfullscreenchange",this.exitFullscreenHandler,!1),e.addEventListener("fullscreenchange",this.exitFullscreenHandler,!1),e.addEventListener("MSFullscreenChange",this.exitFullscreenHandler,!1)}}function l(){var t=window.document;t.removeEventListener("webkitfullscreenchange",this.exitFullscreenHandler),t.removeEventListener("mozfullscreenchange",this.exitFullscreenHandler),t.removeEventListener("fullscreenchange",this.exitFullscreenHandler),t.removeEventListener("MSFullscreenChange",this.exitFullscreenHandler)}function c(t){t.requestFullscreen?t.requestFullscreen():t.msRequestFullscreen?t.msRequestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen&&(navigator.vendor&&navigator.vendor.indexOf("Apple")>-1&&navigator.userAgent&&!navigator.userAgent.match("CriOS")||t.webkitRequestFullscreen())}function h(){document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():(l.call(this),this.resizeInExitHandler=!1)}Object.defineProperty(e,"__esModule",{value:!0});var u=i(1),d=a(u),f=i(2),m=n(f),p=i(10),g=a(p),v="vzb-active",b="vzb-hidden",y="vzb-active-locked",x="vzb-unavailable",_="vzb-force-fullscreen",M="vzb-container-fullscreen",w=m.default.extend({init:function(t,e){var i=this;this.name=this.name||"gapminder-buttonlist",this.model_expects=[{name:"state",type:"model"},{name:"ui",type:"ui"},{name:"locale",type:"locale"}],this._available_buttons={find:{title:"buttons/find",icon:"search",required:!1},show:{title:"buttons/show",icon:"asterisk",required:!1},moreoptions:{title:"buttons/more_options",icon:"gear",required:!0},colors:{title:"buttons/colors",icon:"paintbrush",required:!1},size:{title:"buttons/size",icon:"circle",required:!1},fullscreen:{title:"buttons/expand",icon:"expand",func:this.toggleFullScreen.bind(this),required:!0},trails:{title:"buttons/trails",icon:"trails",func:this.toggleBubbleTrails.bind(this),required:!1,statebind:"ui.chart.trails",statebindfunc:this.setBubbleTrails.bind(this)},lock:{title:"buttons/lock",icon:"lock",func:this.toggleBubbleLock.bind(this),required:!1,statebind:"ui.chart.lockNonSelected",statebindfunc:this.setBubbleLock.bind(this)},inpercent:{title:"buttons/inpercent",icon:"percent",func:this.toggleInpercent.bind(this),required:!1,statebind:"ui.chart.inpercent",statebindfunc:this.setInpercent.bind(this)},presentation:{title:"buttons/presentation",icon:"presentation",func:this.togglePresentationMode.bind(this),required:!1,statebind:"ui.presentation",statebindfunc:this.setPresentationMode.bind(this)},about:{title:"buttons/about",icon:"about",required:!1},axes:{title:"buttons/axes",icon:"axes",required:!1},axesmc:{title:"buttons/axesmc",icon:"axes",required:!1},stack:{title:"buttons/stack",icon:"stack",required:!1},side:{title:"buttons/side",icon:"side",required:!1},_default:{title:"Button",icon:"asterisk",required:!1}},this._active_comp=!1,this.model_binds={"change:state.marker.select":function(t){i._readyOnce&&(i.setBubbleTrails(),i.setBubbleLock(),i._toggleButtons())},"change:ui.chart":function(t,e){e.indexOf("lockActive")>-1&&i.setBubbleLock()}},t.ui.buttons.forEach(function(t){var e=i._available_buttons[t];e&&e.statebind&&(i.model_binds["change:"+e.statebind]=function(i){e.statebindfunc(t,i.source.value)})}),this._super(t,e),this.validatePopupButtons(this.model.ui.buttons,this.model.ui.dialogs)},readyOnce:function(){var t=this;this.element=d3.select(this.placeholder),this.element.selectAll("div").remove(),this.root.findChildByName("gapminder-dialogs").on("close",function(e,i){t.setButtonActive(i.id,!1)});var e=(this.model.ui.dialogs||{}).sidebar||[],i=[].concat(this.model.ui.buttons);this.model.ui.buttons=i,this._addButtons(i,e),this._prev_body_overflow=document.body.style.overflow,this.setBubbleTrails(),this.setBubbleLock(),this.setInpercent(),this.setPresentationMode(),this._toggleButtons()},proceedClick:function(t){var e=this,i=e.element.selectAll(".vzb-buttonlist-btn[data-btn='"+t+"']"),n=i.attr("class"),a=e._available_buttons[t];if(a&&a.func)a.func(t);else{var r=n.indexOf(v)===-1;i.classed(v,r);var s={};s.id=t,s.active=r,e.trigger("click",s)}},validatePopupButtons:function(t,e){for(var i=this,n=e.popup,a=t.filter(function(t){return i._available_buttons[t]&&!i._available_buttons[t].func}),r=0,s=a.length;r<s;r++)if(n.indexOf(a[r])==-1)return d.error('Buttonlist: bad buttons config: "'+a[r]+'" is missing in popups list');return!1},_showAllButtons:function(){var t=this.element.selectAll(".vzb-buttonlist-btn");t.each(function(t,e){var i=d3.select(this);i.style("display","")})},_toggleButtons:function(){var t=this,e=this.parent.element.node?this.parent.element:d3.select(this.parent.element),i=(this.model.ui.dialogs||{}).sidebar||[];t._showAllButtons();var n=this.element.selectAll(".vzb-buttonlist-btn"),a=(this.element.node().getBoundingClientRect(),[]),r=[],s=80,o=80,l=this.element.node().getBoundingClientRect().width,c=this.element.node().getBoundingClientRect().height,h=0,u=0;n.each(function(e,n){var l=e,c=d3.select(this),d=i.indexOf(l.id)!==-1,f={top:parseInt(c.style("margin-top")),right:parseInt(c.style("margin-right")),left:parseInt(c.style("margin-left")),bottom:parseInt(c.style("margin-bottom"))};s=c.node().getBoundingClientRect().width+f.right+f.left,o=c.node().getBoundingClientRect().height+f.top+f.bottom,c.classed(b)||(d&&"large"===t.getLayoutProfile()?c.style("display","none"):(h+=s,u+=o,l.required?r.push(c):a.push(c)))});var d=h-l,f=u-c,m=1;e.classed("vzb-large")&&e.classed("vzb-dialog-expand-true")||e.classed("vzb-small")&&e.classed("vzb-portrait")?(d>0&&d<=10&&(l+=d),m=Math.floor(l/s)-r.length,m<0&&(m=0)):(f>0&&f<=10&&(c+=f),m=Math.floor(c/o)-r.length,m<0&&(m=0)),a.reverse();for(var p=[],g=0,v=a.length-m;g<v;g++)a[g].style("display","none"),p.push(a[g].attr("data-btn"));var y={};y.hiddenButtons=p,t.trigger("toggle",y)},_addButtons:function(t,e){var i=this;this._components_config=[];var n=[];if(t.length){for(var a=0;a<t.length;a++){var r=t[a],s=this._available_buttons[r],o=s?r:"_default",l=d.clone(this._available_buttons[o]);"_default"==o&&(l.title="buttons/"+r),l.id=r,l.icon=g[l.icon],n.push(l)}var c=this.getTranslationFunction(!0);this.element.selectAll("button").data(n).enter().append("button").attr("class",function(t){var i="vzb-buttonlist-btn";return e.length>0&&e.indexOf(t.id)>-1&&(i+=" vzb-dialog-side-btn"),i}).attr("data-btn",function(t){return t.id}).html(function(t){return"<span class='vzb-buttonlist-btn-icon fa'>"+t.icon+"</span><span class='vzb-buttonlist-btn-title'>"+c(t.title)+"</span>"});var h=this.element.selectAll(".vzb-buttonlist-btn");h.on("click",function(){d3.event.preventDefault(),d3.event.stopPropagation();var t=d3.select(this).attr("data-btn");i.proceedClick(t)})}},scrollToEnd:function(){var t=0,e=d3.select(".vzb-tool");e.classed("vzb-portrait")&&e.classed("vzb-small")?(this.model.state.marker.select.length>0&&(t=this.element[0][0].scrollWidth),this.element[0][0].scrollLeft=t):(this.model.state.marker.select.length>0&&(t=this.element[0][0].scrollHeight),this.element[0][0].scrollTop=t)},resize:function(){"small"===this.getLayoutProfile()&&this.model.ui.presentation&&this.togglePresentationMode(),this._toggleButtons()},setButtonActive:function(t,e){var i=this.element.selectAll(".vzb-buttonlist-btn[data-btn='"+t+"']");i.classed(v,e)},toggleBubbleTrails:function(){this.model.ui.chart.trails=!this.model.ui.chart.trails,this.setBubbleTrails()},setBubbleTrails:function(){var t=(this.model.ui.chart||{}).trails;if(t||t===!1){var e="trails",i=this.element.selectAll(".vzb-buttonlist-btn[data-btn='"+e+"']");if(!i.node())return d.warn("setBubbleTrails: no button '"+e+"' found in DOM. doing nothing");i.classed(y,t),i.classed(b,0==this.model.state.marker.select.length)}},toggleBubbleLock:function(t){var e=(this.model.ui.chart||{}).lockActive;if(0!=this.model.state.marker.select.length||e){var i=this.model.ui.chart.lockNonSelected,n=this.model.state.time;i=i?0:n.formatDate(n.value),this.model.ui.chart.lockNonSelected=i,this.setBubbleLock()}},setBubbleLock:function(){var t=(this.model.ui.chart||{}).lockNonSelected,e=(this.model.ui.chart||{}).lockActive;if(t||0===t){0===t||0!==this.model.state.marker.select.length||e||(t=this.model.ui.chart.lockNonSelected=0);var i="lock",n=this.element.selectAll(".vzb-buttonlist-btn[data-btn='"+i+"']");if(!n.node())return d.warn("setBubbleLock: no button '"+i+"' found in DOM. doing nothing");var a=this.model.locale.getTFunction();n.classed(x,0==this.model.state.marker.select.length&&!e),"undefined"==typeof e?n.classed(b,0==this.model.state.marker.select.length):n.classed(b,!e),n.classed(y,t),n.select(".vzb-buttonlist-btn-title").text(t?t:a("buttons/lock")),n.select(".vzb-buttonlist-btn-icon").html(g[t?"lock":"unlock"])}},toggleInpercent:function(){this.model.ui.chart.inpercent=!this.model.ui.chart.inpercent,this.setInpercent()},setInpercent:function(){if("undefined"!=typeof(this.model.ui.chart||{}).inpercent){var t="inpercent",e=(this.model.locale.getTFunction(),this.element.selectAll(".vzb-buttonlist-btn[data-btn='"+t+"']"));e.classed(y,this.model.ui.chart.inpercent)}},togglePresentationMode:function(){this.model.ui.presentation=!this.model.ui.presentation,this.setPresentationMode()},setPresentationMode:function(){var t="presentation",e=(this.model.locale.getTFunction(),this.element.selectAll(".vzb-buttonlist-btn[data-btn='"+t+"']"));e.classed(y,this.model.ui.presentation)},toggleFullScreen:function(t,e){if(window){for(var i=this,n=i.placeholder,a=!1,r=this.element.selectAll(".vzb-buttonlist-btn[data-btn='"+t+"']"),s=!this.model.ui.fullscreen,l=s?"hidden":this._prev_body_overflow;!(a=d.hasClass(n,"vzb-placeholder"));)i=i.parent,n=i.placeholder;s?(this.resizeInExitHandler=!1,c(n),o.call(this,this.toggleFullScreen.bind(this,t,!0))):(this.resizeInExitHandler=!e,h.call(this)),d.classed(n,_,s),"undefined"!=typeof container&&d.classed(container,M,s),this.model.ui.fullscreen=s;var u=this.model.locale.getTFunction();r.classed(y,s),r.select(".vzb-buttonlist-btn-icon").html(g[s?"unexpand":"expand"]),r.select(".vzb-buttonlist-btn-title>span").text(u("buttons/"+(s?"unexpand":"expand"))).attr("data-vzb-translate","buttons/"+(s?"unexpand":"expand")),document.body.style.overflow=l,this.resizeInExitHandler||this.root.ui.resizeHandler()}}});e.default=w},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function a(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var r=i(70),s=a(r),o=i(1),l=n(o),c=i(2),h=a(c),u=i(10),d=(n(u),(0,s.default)(i(459),1)),f="vzb-active",m=h.default.extend({init:function(t,e){this.name="gapminder-dialogs",this._curr_dialog_index=20,this.model_expects=[{name:"state",type:"model"},{name:"ui",type:"ui"},{name:"locale",type:"locale"}],this._available_dialogs={timedisplay:{dialog:d.timedisplay},find:{dialog:d.find},show:{dialog:d.show},moreoptions:{dialog:d.moreoptions},colors:{dialog:d.colors},size:{dialog:d.size},side:{dialog:d.side},label:{dialog:d.label},zoom:{dialog:d.zoom},axes:{dialog:d.axes},axesmc:{dialog:d.axesmc},stack:{dialog:d.stack},speed:{dialog:d.speed},opacity:{dialog:d.opacity},presentation:{dialog:d.presentation},about:{dialog:d.about}},this._super(t,e)},domReady:function(){var t=(this.model.ui.dialogs||{}).popup||[],e=(this.model.ui.dialogs||{}).sidebar||[];
this.rootEl=this.root.element instanceof Array?this.root.element:d3.select(this.root.element),e===!0&&(e=t,(this.model.ui.dialogs||{}).sidebar=e),0!==e.length&&this.rootEl.classed("vzb-dialog-expand-true",!0),this.dialog_popup=t,this.dialog_sidebar=e},readyOnce:function(){var t=this;if(this.element=d3.select(this.placeholder),this.element.selectAll("div").remove(),this._addDialogs(this.dialog_popup,this.dialog_sidebar),this.resize(),0!==this.dialog_popup.length){this.root.findChildByName("gapminder-buttonlist").on("click",function(e,i){t._available_dialogs[i.id]&&(i.active?t.openDialog(i.id):t.closeDialog(i.id))});var e=this.element.selectAll(".vzb-top-dialog").filter(function(e){return t.dialog_popup.indexOf(e.id)>-1}),i=e.select(".vzb-top-dialog>.vzb-dialog-modal>.vzb-dialog-buttons>[data-click='closeDialog']");i.on("click",function(e,i){t.closeDialog(e.id)});var n=e.select(".vzb-top-dialog>.vzb-dialog-modal>[data-click='pinDialog']");n.on("click",function(e,i){t.pinDialog(e.id)}),this.rootEl.node().addEventListener("click",function(){t.closeAllDialogs()}),this.rootEl.on("mousedown",function(e){if(this._active_comp){for(var i=d3.event.target,n=!0;i;){if(i.classList.contains("vzb-dialog-modal")){n=!1;break}i=i.parentElement}n&&t.closeAllDialogs()}})}this.element.on("click",function(){d3.event.stopPropagation()})},resize:function(){var t=this,e=this.getLayoutProfile();this.element.selectAll(".vzb-top-dialog").each(function(i){var n=d3.select(this),a=n.attr("class").replace(" vzb-popup","").replace(" vzb-sidebar","");"large"===e&&t.dialog_sidebar.indexOf(i.id)>-1?a+=" vzb-sidebar":t.dialog_popup.indexOf(i.id)>-1&&(a+=" vzb-popup"),n.attr("class",a)})},_addDialogs:function(t,e){var i=(this.getLayoutProfile(),[]);i=t?i.concat(t):i,i=e?i.concat(e):i,i=l.unique(i),this._components_config=[];var n=[];if(i.length){for(var a=0;a<i.length;a++){var r=i[a],s=this._available_dialogs[r];if(s&&s.dialog){var o=this._components_config;o.push({component:s.dialog,placeholder:'.vzb-dialogs-dialog[data-dlg="'+r+'"]',model:["state","ui","locale"]}),s.component=o.length-1}s.id=r,n.push(s)}this.element.selectAll("div").data(n).enter().append("div").attr("data-dlg",function(t){return t.id}).attr("class","vzb-top-dialog vzb-dialogs-dialog vzb-dialog-shadow"),this.loadSubComponents();var c=this;l.forEach(this.components,function(t){t.render(),c.on("resize",function(){t.trigger("resize")}),t.on("dragstart",function(){c.bringForward(t.name)}),t.on("close",function(){this.placeholderEl.each(function(t){var e={};e.id=t.id,c.trigger("close",e)})})})}},bringForward:function(t){var e=this.element.select(".vzb-popup.vzb-dialogs-dialog[data-dlg='"+t+"']");e.style("z-index",this._curr_dialog_index),this._curr_dialog_index+=10},openDialog:function(t){var e="small"===this.getLayoutProfile();this.closeAllDialogs(e);var i=this.element.selectAll(".vzb-popup.vzb-dialogs-dialog[data-dlg='"+t+"']");this._active_comp=this.components[this._available_dialogs[t].component],this._active_comp.beforeOpen(),i.classed(f,!0),this.bringForward(t),this._active_comp.open()},pinDialog:function(t){var e=this.element.select(".vzb-popup.vzb-dialogs-dialog[data-dlg='"+t+"']");this._available_dialogs[t].ispin?(e.classed("pinned",!1),this._available_dialogs[t].ispin=!1):(e.classed("pinned",!0),this._available_dialogs[t].ispin=!0)},closeDialog:function(t){var e=this.element.selectAll(".vzb-popup.vzb-dialogs-dialog[data-dlg='"+t+"']");this._active_comp=this.components[this._available_dialogs[t].component],this._active_comp&&!this._active_comp.isOpen||(this._available_dialogs[t].ispin&&this.pinDialog(t),this._active_comp&&this._active_comp.beforeClose(),e.classed(f,!1),this._active_comp&&this._active_comp.close(),this._active_comp=!1)},closeAllDialogs:function(t){var e=this,i=t?".vzb-popup.vzb-dialogs-dialog.vzb-active":".vzb-popup.vzb-dialogs-dialog.vzb-active:not(.pinned)",n=this.element.selectAll(i);n.each(function(t){e.closeDialog(t.id)})}});e.default=m},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),s=a(r),o=i(2),l=n(o),c=1,h="vzb-playing",u="vzb-ts-loading",d="vzb-ts-hide-play-button",f="vzb-ts-dragging",m="vzb-ts-axis-aligned",p="vzb-ts-show-value",g="vzb-ts-show-value-when-drag-play",v={small:{margin:{top:7,right:15,bottom:10,left:15},radius:8,label_spacing:10},medium:{margin:{top:16,right:15,bottom:10,left:15},radius:9,label_spacing:12},large:{margin:{top:14,right:15,bottom:10,left:15},radius:11,label_spacing:14}},b={medium:{margin:{top:9}},large:{margin:{}}},y=l.default.extend({init:function(t,e){this.name="gapminder-timeslider",this.template=this.template||i(444),this.prevPosition=null,this.model_expects=[{name:"time",type:"time"},{name:"entities",type:"entities"},{name:"marker",type:"model"},{name:"ui",type:"ui"}];var n=this;this.model_binds={"change:time":function(t,e){if(n.slide){if(["time.start","time.end"].indexOf(e)!==-1){if(!n.xScale)return;n.changeLimits()}n._optionClasses(),n.model.time.dragging||n._setHandle(n.model.time.playing)}},"change:time.start":function(t,e){n.slide&&(n.model.time.dragging||n._setHandle(n.model.time.playing))},"change:time.end":function(t,e){n.slide&&(n.model.time.dragging||n._setHandle(n.model.time.playing))},"change:time.startSelected":function(t,e){n.slide&&n.updateSelectedStartLimiter()},"change:time.endSelected":function(t,e){n.slide&&n.updateSelectedEndLimiter()},"change:marker.select":function(t,e){n.setSelectedLimits()}},this._super(t,e),this.ui=s.extend({show_limits:!1,show_value:!1,show_value_when_drag_play:!0,show_button:!0,class_axis_aligned:!1},t.ui,this.ui),this.width=0,this.height=0,this.availableTimeFrames=[],this.completedTimeFrames=[],this.getValueWidth=s.memoize(this.getValueWidth),this._setTime=s.throttle(this._setTime,50)},readyOnce:function(){var t=this;this.element=s.isArray(this.element)?this.element:d3.select(this.element),this.slider_outer=this.element.select(".vzb-ts-slider"),this.slider=this.slider_outer.select("g"),this.axis=this.element.select(".vzb-ts-slider-axis"),this.select=this.element.select(".vzb-ts-slider-select"),this.progressBar=this.element.select(".vzb-ts-slider-progress"),this.slide=this.element.select(".vzb-ts-slider-slide"),this.handle=this.slide.select(".vzb-ts-slider-handle"),this.valueText=this.slide.select(".vzb-ts-slider-value"),this.xScale=d3.time.scale.utc().clamp(!0),this.xAxis=d3.svg.axis().orient("bottom").tickSize(0),this.valueText.attr("text-anchor","middle").attr("dy","-0.7em");var e=t._getBrushed(),i=t._getBrushedEnd();this.brush=d3.svg.brush().x(this.xScale).extent([0,0]).on("brush",function(){e.call(this)}).on("brushend",function(){i.call(this)}),this.slide.call(this.brush),this.slider_outer.on("mousewheel",function(){if(t.model.time.dragging)return d3.event.stopPropagation(),d3.event.preventDefault(),d3.event.returnValue=!1,!1}),this.slide.selectAll(".extent,.resize").remove(),this._setSelectedLimitsId=0,this.model.time.startSelected>this.model.time.start&&t.updateSelectedStartLimiter(),this.model.time.endSelected<this.model.time.end&&t.updateSelectedEndLimiter(),this.parent.on("myEvent",function(e,i){var n=t.getLayoutProfile();i.profile&&i.profile.margin&&(v[n].margin=i.profile.margin),t.element.select(".vzb-ts-slider-wrapper").style("right",i.mRight-v[n].margin.right+"px"),t.updateSize([0,i.rangeMax])}),this.on("resize",function(){t.updateSize()})},ready:function(){if(!this.model.time.splash){this.element.classed(u,!1);var t=this.element.select(".vzb-ts-btn-play"),e=this.element.select(".vzb-ts-btn-pause"),i=this;this.model.time;t.on("click",function(){i.model.time.play()}),e.on("click",function(){i.model.time.pause("soft")}),this.changeLimits(),this.changeTime(),this.updateSize(),i._updateProgressBar(),i.model.marker.listenFramesQueue(null,function(t){i._updateProgressBar(t)}),i.setSelectedLimits(!0)}},changeLimits:function(){var t=this.model.time.start,e=this.model.time.end;this.xScale.domain([t,e]),this.xAxis.tickValues([t,e]).tickFormat(this.model.time.getFormatter())},changeTime:function(){this.model.time.value;this._optionClasses()},updateSize:function(t){if(!this.model.time.splash){this.model.time.pause(),this.profile=this.getActiveProfile(v,b);var e=parseInt(this.slider_outer.style("width"),10)||0,i=parseInt(this.slider_outer.style("height"),10)||0;if(!i||!e)return s.warn("time slider resize() aborted because element is too small or has display:none");this.width=e-this.profile.margin.left-this.profile.margin.right,this.height=i-this.profile.margin.bottom-this.profile.margin.top;var n=this;this.slider.attr("transform","translate("+this.profile.margin.left+","+this.profile.margin.top+")"),this.xScale.range(t||[0,this.width]),this.xAxis=this.xAxis.scale(this.xScale).tickPadding(this.profile.label_spacing),this.axis.attr("transform","translate(0,"+this.height/2+")").call(this.xAxis),this.select.attr("transform","translate(0,"+this.height/2+")"),this.progressBar.attr("transform","translate(0,"+this.height/2+")"),this.slide.select(".background").attr("height",this.height),this.handle.attr("transform","translate(0,"+this.height/2+")").attr("r",this.profile.radius),this.sliderWidth=n.slider.node().getBoundingClientRect().width,this.resizeSelectedLimiters(),this._resizeProgressBar(),this._setHandle()}},setSelectedLimits:function(t){var e=this;this._setSelectedLimitsId++;var i=this._setSelectedLimitsId,n=e.model.marker.select;if(0==n.length)return void e.model.time.set({startSelected:new Date(e.model.time.start),endSelected:new Date(e.model.time.end)},null,!1);var a=e.model.entities.getDimension(),r=[];s.forEach(n,function(t){r.push(e.model.marker.getEntityLimits(t[a]))}),Promise.all(r).then(function(n){if(i==e._setSelectedLimitsId){var a=n.shift(),r=a.min,o=a.max;s.forEach(n,function(t){r-t.min>0&&(r=t.min),o-t.max<0&&(o=t.max)}),e.model.time.set({startSelected:d3.max([r,new Date(e.model.time.start)]),endSelected:d3.min([o,new Date(e.model.time.end)])},t,!1)}})},updateSelectedStartLimiter:function(){var t=this;this.select.select("#clip-start-"+t._id).remove(),this.select.select(".selected-start").remove(),this.model.time.startSelected&&this.model.time.startSelected>this.model.time.start&&(this.select.append("clipPath").attr("id","clip-start-"+t._id).append("rect"),this.select.append("path").attr("clip-path","url("+location.pathname+"#clip-start-"+t._id+")").classed("selected-start",!0),this.resizeSelectedLimiters())},updateSelectedEndLimiter:function(){var t=this;this.select.select("#clip-end-"+t._id).remove(),this.select.select(".selected-end").remove(),this.model.time.endSelected&&this.model.time.endSelected<this.model.time.end&&(this.select.append("clipPath").attr("id","clip-end-"+t._id).append("rect"),this.select.append("path").attr("clip-path","url("+location.pathname+"#clip-end-"+t._id+")").classed("selected-end",!0),this.resizeSelectedLimiters())},resizeSelectedLimiters:function(){var t=this;this.select.select(".selected-start").attr("d","M0,0H"+this.xScale(this.model.time.startSelected)),this.select.select("#clip-start-"+t._id).select("rect").attr("x",-this.height/2).attr("y",-this.height/2).attr("height",this.height).attr("width",this.xScale(this.model.time.startSelected)+this.height/2),this.select.select(".selected-end").attr("d","M"+this.xScale(this.model.time.endSelected)+",0H"+this.xScale(this.model.time.end)),this.select.select("#clip-end-"+t._id).select("rect").attr("x",this.xScale(this.model.time.endSelected)).attr("y",-this.height/2).attr("height",this.height).attr("width",this.xScale(this.model.time.end)-this.xScale(this.model.time.endSelected)+this.height/2)},_resizeProgressBar:function(){var t=this;this.progressBar.selectAll("path").each(function(e){d3.select(this).attr("d","M"+t.xScale(e[0])+",0H"+t.xScale(e[1]))})},_updateProgressBar:function(t){var e=this;if(t){if(e.completedTimeFrames.indexOf(t)!=-1)return;e.completedTimeFrames.push(t);var i=e.model.time.incrementTime(t),n=e.model.time.decrementTime(t);if(i>e.model.time.end){if(t-e.model.time.end!=0)return;i=t,t=n}if(0==e.availableTimeFrames.length||e.availableTimeFrames[e.availableTimeFrames.length-1][1]<t)e.availableTimeFrames.push([t,i]);else if(i<e.availableTimeFrames[0][0])e.availableTimeFrames.unshift([t,i]);else for(var a=0;a<e.availableTimeFrames.length;a++){if(t-e.availableTimeFrames[a][1]==0){a+1<e.availableTimeFrames.length&&i-e.availableTimeFrames[a+1][0]==0?(e.availableTimeFrames[a][1]=e.availableTimeFrames[a+1][1],e.availableTimeFrames.splice(a+1,1)):e.availableTimeFrames[a][1]=i;break}if(i-e.availableTimeFrames[a][0]==0){e.availableTimeFrames[a][0]=t;break}if(t-e.availableTimeFrames[a][1]>0&&i-e.availableTimeFrames[a+1][0]<0){e.availableTimeFrames.splice(a+1,0,[t,i]);break}}}else e.availableTimeFrames=[],e.completedTimeFrames=[];var r=this.progressBar.selectAll("path").data(e.availableTimeFrames);r.exit().remove(),r.enter().append("path").attr("class","domain"),r.each(function(t){var i=d3.select(this);i.attr("d","M"+e.xScale(t[0])+",0H"+e.xScale(t[1])).classed("rounded",1==e.availableTimeFrames.length)})},getValueWidth:function(t,e){return this.valueText.node().getBoundingClientRect().width},_getBrushed:function(){var t=this;return function(){t.model.time.playing&&t.model.time.pause(),t._optionClasses(),t.element.classed(f,!0);var e=t.brush.extent()[0];if(d3.event.sourceEvent){d3.event.sourceEvent.preventDefault(),t.model.time.dragStart();var i=s.roundStep(Math.round(d3.mouse(this)[0]),c);e=t.xScale.invert(i);var n=t.width;i>n?i=n:i<0&&(i=0),t.handle.attr("cx",i),t.valueText.attr("transform","translate("+i+","+t.height/2+")"),t.valueText.text(t.model.time.formatDate(e,"ui"))}e-t.model.time.value!==0&&t._setTime(e)}},_getBrushedEnd:function(){var t=this;return function(){t._setTime.recallLast(),t.element.classed(f,!1),t.model.time.dragStop(),t.model.time.snap()}},_setHandle:function(t){var e=this,i=this.model.time.value;this.slide.call(this.brush.extent([i,i])),this.element.classed("vzb-ts-disabled",this.model.time.end<=this.model.time.start);var n=this.xScale(i);null==e.prevPosition&&(e.prevPosition=n);var a=n>e.prevPosition?this.model.time.delayAnimations:0;t?(this.handle.attr("cx",e.prevPosition).transition().duration(a).ease("linear").attr("cx",n),this.valueText.attr("transform","translate("+e.prevPosition+","+this.height/2+")").transition("text").delay(a).text(this.model.time.formatDate(i,"ui")),this.valueText.transition().duration(a).ease("linear").attr("transform","translate("+n+","+this.height/2+")")):(this.handle.interrupt().attr("cx",n),this.valueText.interrupt().interrupt("text").transition("text"),this.valueText.attr("transform","translate("+n+","+this.height/2+")").text(this.model.time.formatDate(i,"ui"))),e.prevPosition=n},_setTime:function(t){var e=this,i=!this.model.time.dragging&&!this.model.time.playing;e.model.time.getModelObject("value").set(t,!1,i)},_optionClasses:function(){var t=this.ui.show_limits,e=this.ui.show_value,i=this.ui.show_value_when_drag_play,n=this.ui.axis_aligned,a=this.ui.show_button&&this.model.time.playable;t||this.xAxis.tickValues([]).ticks(0),this.element.classed(d,!a),this.element.classed(h,this.model.time.playing),this.element.classed(p,e),this.element.classed(g,i),this.element.classed(m,n)}});e.default=y},function(t,e,i){var n=i(69),a=i(43),r=i(20),s=i(33),o=i(15),l=i(161),c=Object.getOwnPropertyDescriptor;e.f=i(8)?c:function(t,e){if(t=r(t),e=s(e,!0),l)try{return c(t,e)}catch(t){}if(o(t,e))return a(!n.f.call(t,e),t[e])}},function(t,e,i){var n=i(15),a=i(13),r=i(104)("IE_PROTO"),s=Object.prototype;t.exports=Object.getPrototypeOf||function(t){return t=a(t),n(t,r)?t[r]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?s:null}},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),s=a(r),o=i(2),l=n(o),c=i(21),h=n(c),u=i(10),d=1,f=2,m={wrapper:"vzb-treemenu-wrap",wrapper_outer:"vzb-treemenu-wrap-outer",background:"vzb-treemenu-background",close:"vzb-treemenu-close",search:"vzb-treemenu-search",list:"vzb-treemenu-list",list_outer:"vzb-treemenu-list-outer",list_item:"vzb-treemenu-list-item",list_item_leaf:"vzb-treemenu-list-item-leaf",leaf:"vzb-treemenu-leaf",leaf_content:"vzb-treemenu-leaf-content",leaf_content_item:"vzb-treemenu-leaf-content-item",leaf_content_item_title:"vzb-treemenu-leaf-content-item-title",leaf_content_item_descr:"vzb-treemenu-leaf-content-item-descr",hasChild:"vzb-treemenu-list-item-children",list_item_label:"vzb-treemenu-list-item-label",list_top_level:"vzb-treemenu-list-top",search_wrap:"vzb-treemenu-search-wrap",isSpecial:"vzb-treemenu-list-item-special",hidden:"vzb-hidden",title:"vzb-treemenu-title",scaletypes:"vzb-treemenu-scaletypes",scaletypesDisabled:"vzb-treemenu-scaletypes-disabled",scaletypesActive:"vzb-treemenu-scaletypes-active",alignYt:"vzb-align-y-top",alignYb:"vzb-align-y-bottom",alignXl:"vzb-align-x-left",alignXr:"vzb-align-x-right",alignXc:"vzb-align-x-center",menuHorizontal:"vzb-treemenu-horizontal",menuVertical:"vzb-treemenu-vertical",absPosVert:"vzb-treemenu-abs-pos-vert",absPosHoriz:"vzb-treemenu-abs-pos-horiz",menuOpenLeftSide:"vzb-treemenu-open-left-side",noTransition:"notransition"},p={MOUSE_LOCS:[],MOUSE_LOCS_TRACKED:3,DELAY:200,TOLERANCE:150,LAST_DELAY_LOC:null,TIMEOUT:null,SEARCH_PROPERTY:"id",SUBMENUS:"children",SEARCH_MIN_STR:1,RESIZE_TIMEOUT:null,MOBILE_BREAKPOINT:400,CURRENT_PATH:[],MIN_COL_WIDTH:60,MENU_DIRECTION:d,MAX_MENU_WIDTH:320,MENU_OPEN_LEFTSIDE:!1},g=h.default.extend({init:function(t,e,i){var n=this;this.parent=t,this.entity=e,this.OPTIONS=i,this.width=this.OPTIONS.MIN_COL_WIDTH,this.direction=this.OPTIONS.MENU_DIRECTION,this._setDirectionClass(),this.menuItems=[];var a;return this.entity.empty()?this:(this.entity.each(function(){a=d3.selectAll(this.childNodes).filter(function(){return d3.select(this).classed(m.list)})}),a.empty()&&(a=this.entity),e.selectAll("."+m.list_item).filter(function(){return this.parentNode==a.node()}).each(function(){n.addSubmenu(d3.select(this))}),this)},setWidth:function(t,e,i){if(this.width!=t&&this.entity.node()){if(this.width=t,(this.entity.classed(m.list_top_level)||this.entity.classed("active"))&&this.direction==d&&(i?this.entity.style("width",this.width+"px"):this.entity.transition().delay(0).duration(100).style("width",this.width+"px")),this.entity.classed(m.list_top_level)&&this.entity.selectAll("."+m.leaf).style("width",this.width-1+"px"),e)for(var n=0;n<this.menuItems.length;n++)this.menuItems[n].setWidth(this.width,e,i);return this}},setDirection:function(t,e){if(this.direction=t,this.entity.style("width","").style("height",""),e)for(var i=0;i<this.menuItems.length;i++)this.menuItems[i].setDirection(this.direction,e);return this._setDirectionClass(),this},_setDirectionClass:function(){this.direction==d?(this.entity.classed(m.menuVertical,!1),this.entity.classed(m.menuHorizontal,!0)):(this.entity.classed(m.menuHorizontal,!1),this.entity.classed(m.menuVertical,!0))},addSubmenu:function(t){this.menuItems.push(new v(this,t,this.OPTIONS))},open:function(){var t=this;return this.isActive()||(t.parent.parentMenu.openSubmenuNow=!0,this.closeNeighbors(function(){t.direction==d?(t._openHorizontal(),t.calculateMissingWidth(0)):t._openVertical()}),t.parent.parentMenu.openSubmenuNow=!1),this},calculateMissingWidth:function(t,e){var i=this;this.entity.classed(m.list_top_level)?t>this.OPTIONS.MAX_MENU_WIDTH&&"function"==typeof e&&e(t-this.OPTIONS.MAX_MENU_WIDTH):this.parent.parentMenu.calculateMissingWidth(t+this.width,function(t){t>0?i.reduceWidth(t,function(t){"function"==typeof e&&e(t)}):"function"==typeof e&&e(t)})},restoreWidth:function(t,e,i){var n=this;if(e)this.parent.parentMenu.restoreWidth(t,!1,i);else if(t<=0)"function"==typeof i&&i();else if(this.entity.classed(m.list_top_level))"function"==typeof i&&i();else{var a=this.entity.node().offsetWidth,r=Math.min(t,n.width);if(a<r){var s=250*(a/r);this.entity.transition().delay(0).duration(s).style("width",r+"px").each("end",function(){}),n.parent.parentMenu.restoreWidth(t-r,!1,i)}else this.parent.parentMenu.restoreWidth(t,!1,i)}},reduceWidth:function(t,e){var i=this,n=this.entity.node().offsetWidth;if(n<=this.OPTIONS.MIN_COL_WIDTH)e(t-i.width+n);else{var a=Math.max(this.OPTIONS.MIN_COL_WIDTH,i.width-t),r=250/(i.width/a);this.entity.transition().delay(0).duration(r).style("width",a+"px").each("end",function(){e(t-i.width+a)})}},_openHorizontal:function(){var t=this;t.entity.classed("active",!0).transition().delay(0).duration(250).style("width",t.width+"px").each("end",function(){t.marqueeToggle(!0)})},_openVertical:function(){var t=this;t.entity.style("height","0px"),t.entity.transition().delay(0).duration(250).style("height",36*t.menuItems.length+"px").each("end",function(){t.entity.style("height","auto"),t.marqueeToggle(!0),t.scrollToFitView()}),t.entity.classed("active",!0)},closeAllChildren:function(t){for(var e=0,i=0;i<this.menuItems.length;i++)this.menuItems[i].isActive()&&(++e,this.menuItems[i].submenu.close(function(){0==--e&&"function"==typeof t&&t()}));0==e&&"function"==typeof t&&t()},closeNeighbors:function(t){this.parent?this.parent.closeNeighbors(t):t()},close:function(t){var e=this;this.closeAllChildren(function(){e.direction==d?e._closeHorizontal(t):e._closeVertical(t)})},_closeHorizontal:function(t){var e=(this.entity.node().offsetWidth,this),i=e.parent.parentMenu.openSubmenuNow;e.entity.transition().delay(0).duration(20).style("width","0px").each("end",function(){e.marqueeToggle(!1),e.entity.classed("active",!1),i?"function"==typeof t&&t():e.restoreWidth(e.OPTIONS.MAX_MENU_WIDTH,!0,function(){"function"==typeof t&&t()})})},_closeVertical:function(t){var e=this;e.entity.transition().delay(0).duration(100).style("height","0px").each("end",function(){e.marqueeToggle(!1),e.entity.classed("active",!1),"function"==typeof t&&t()})},isActive:function(){return this.entity.classed("active")},marqueeToggle:function(t){for(var e=0;e<this.menuItems.length;e++)this.menuItems[e].marqueeToggle(t)},marqueeToggleAll:function(t){for(var e=0;e<this.menuItems.length;e++)this.menuItems[e].marqueeToggleAll(t)},findItemById:function(t){for(var e=0;e<this.menuItems.length;e++){if(this.menuItems[e].entity.data().id==t)return this.menuItems[e];if(this.menuItems[e].submenu){var i=this.menuItems[e].submenu.findItemById(t);if(i)return i}}return null},getTopMenu:function(){return this.parent?this.parent.parentMenu.getTopMenu():this},scrollToFitView:function(){var t=this.getTopMenu().entity.node().parentNode,e=this.entity.node().parentNode,i=t.getBoundingClientRect(),n=e.getBoundingClientRect(),a=n.top-i.top;if(a+n.height>i.height){var r=n.height>i.height?i.height-10:n.height+10,s=t.scrollTop+r-i.height+a,o=function(t){return function(){var e=d3.interpolateNumber(this.scrollTop,t);return function(t){this.scrollTop=e(t)}}};d3.select(t).transition().duration(20).tween("scrolltoptween",o(s))}}}),v=h.default.extend({init:function(t,e,i){var n=this;this.parentMenu=t,this.entity=e;var a=e.select("."+m.list_outer);a.node()&&(this.submenu=new g(this,a,i));this.entity.select("."+m.list_item_label).on("mouseenter",function(){s.isTouchDevice()||n.parentMenu.direction!=d||d3.select(this).attr("children")||(n.openSubmenu(),n.marqueeToggle(!0))}).on("click.item",function(){if(!s.isTouchDevice())if(d3.event.stopPropagation(),n.parentMenu.direction==d)n.openSubmenu();else{var t=d3.select(this);if(!t.attr("children"))return;n.toggleSubmenu()}}).onTap(function(t){if(d3.event.stopPropagation(),n.parentMenu.direction==f){var e=n.entity.select("."+m.list_item_label);if(!e.attr("children"))return}n.toggleSubmenu()});return this},setWidth:function(t,e,i){return this.submenu&&e&&this.submenu.setWidth(t,e,i),this},setDirection:function(t,e){return this.submenu&&e&&this.submenu.setDirection(t,e),this},toggleSubmenu:function(){this.submenu&&(this.submenu.isActive()?this.submenu.close():this.submenu.open())},openSubmenu:function(){this.submenu?this.submenu.open():this.closeNeighbors()},closeNeighbors:function(t){this.parentMenu.closeAllChildren(t)},isActive:function(){return this.submenu&&this.submenu.isActive()},marqueeToggleAll:function(t){var e=this.entity.selectAll("."+m.list_item_label);e.each(function(){var e=d3.select(this).select("span"),i=d3.select(this.parentNode);if(i.classed("marquee",!1),e.style("left",""),e.style("right",""),t&&e.node().scrollWidth>e.node().offsetWidth){e.attr("data-content",e.text());var n=30;e.style("left",-n-e.node().scrollWidth+"px"),e.style("right",-n-e.node().scrollWidth+"px"),i.classed("marquee",!0)}})},marqueeToggle:function(t){var e=this.entity.select("."+m.list_item_label).select("span");if(this.entity.classed("marquee",!1),e.style("left",""),e.style("right",""),t&&e.node().scrollWidth>e.node().offsetWidth){e.attr("data-content",e.text());var i=30;e.style("left",-i-e.node().scrollWidth+"px"),e.style("right",-i-e.node().scrollWidth+"px"),this.entity.classed("marquee",!0)}}}),b=l.default.extend({tree:function(t){return arguments.length?(this._tree=t,this):this._tree},callback:function(t){return arguments.length?(this._callback=t,this):this._callback},markerID:function(t){return arguments.length?(this._markerID=t,this):this._markerID},alignX:function(t){return arguments.length?(this._alignX=t,this):this._alignX},alignY:function(t){return arguments.length?(this._alignY=t,this):this._alignY},top:function(t){return arguments.length?(this._top=t,this):this._top},left:function(t){return arguments.length?(this._left=t,this):this._left},init:function(t,e){var i=this;this.name="gapminder-treemenu",this.model_expects=[{name:"marker",type:"model"},{name:"marker_tags",type:"model"},{name:"time",type:"time"},{name:"locale",type:"locale"}],this.context=e,this.menuEntity=null,this.model_binds={"change:marker":function(t,e){e.indexOf(i._markerID+".which")==-1&&e.indexOf(i._markerID+".scaleType")==-1||i.updateView()}},this._super(t,e),this._callback=function(t){console.log("Indicator selector: stub callback fired. New indicator is ",t)},this._alignX="center",this._alignY="center",this.OPTIONS=s.deepClone(p)},ready:function(){this.updateView();var t=this.model.marker_tags.label.getData();this._buildIndicatorsTree(t)},readyOnce:function(){this.element=d3.select(this.placeholder);var t=this;this.element.selectAll("div").remove(),this.element.append("div").attr("class",m.background).on("click",function(){d3.event.stopPropagation(),t.toggle()}),this.wrapperOuter=this.element.append("div").classed(m.wrapper_outer,!0).classed(m.noTransition,!0),this.wrapper=this.wrapperOuter.append("div").classed(m.wrapper,!0).classed(m.noTransition,!0).classed("vzb-dialog-scrollable",!0),this.wrapper.on("click",function(){d3.event.stopPropagation()}),this.wrapper.append("div").attr("class",m.close).html(u.close).on("click",function(){d3.event.stopPropagation(),t.toggle()}).select("svg").attr("width","0px").attr("height","0px").attr("class",m.close+"-icon"),this.wrapper.append("div").classed(m.scaletypes,!0).append("span"),this.wrapper.append("div").classed(m.title,!0).append("span"),this.wrapper.append("div").classed(m.search_wrap,!0).append("input").classed(m.search,!0).attr("type","search").attr("id",m.search),d3.select("body").on("mousemove",t._mousemoveDocument),this.wrapper.on("mouseleave",function(){}),this.translator=this.model.locale.getTFunction(),t._enableSearch(),t.resize()},_buildIndicatorsTree:function(t){t!==!0&&t||(t=[]);var e,i=this,n="_root",a="_default",r="_unclassified",o={};o[n]={id:n,children:[]},o[r]={id:r,type:"folder",name:this.translator("buttons/unclassified"),children:[]},t.forEach(function(t){o[t.tag]={id:t.tag,name:t.name,type:"folder",children:[]}}),e=o[n],e.children.push({id:a}),e.children.push(o[r]),t.forEach(function(t){t.parent&&o[t.parent]?o[t.parent].children.push(o[t.tag]):e.children.push(o[t.tag])}),s.forEach(this.model.marker._root._data,function(t){if("data"===t._type){var e=t.getConceptprops(),a=t.getDatasetName();o[a]={id:a,type:"dataset",children:[]},o[n].children.push(o[a]),s.forEach(e,function(e,n){if("_none"!=e.tags){e.tags||(e.tags=a||r);var l={id:n,name:e.name,unit:e.unit,description:e.description,dataSource:t._name};e.tags.split(",").forEach(function(t){o[t.trim()]?o[t.trim()].children.push(l):(i.consoleGroupOpen||(console.groupCollapsed("Some tags were are not found, so indicators went under 'Unclassified' menu"),i.consoleGroupOpen=!0),s.warn("tag '"+t+"' for indicator '"+n+"'"),o[r].children.push(l))})}})}}),i.consoleGroupOpen&&(console.groupEnd(),delete i.consoleGroupOpen),this._sortChildren(e),this.indicatorsTree=e},_sortChildren:function(t,e){var i=this;t.children&&(t.children.sort(s.firstBy()(function(t,e){return t="dataset"===t.type?1:0,e="dataset"===e.type?1:0,e-t}).thenBy(function(t,e){return t=t.children?1:0,e=e.children?1:0,t-e}).thenBy(function(t,i){if(!e){if("time"==t.id)return-1;if("time"==i.id)return 1;if("advanced"==t.id)return 1;if("advanced"==i.id)return-1}return t.name>i.name?1:-1})),t.children.forEach(function(t){i._sortChildren(t,!0)}))},resize:function(){var t=this;this.profiles={small:{col_width:200},medium:{col_width:200},large:{col_width:200}};var e=this._top,i=this._left;this.wrapper.classed(m.noTransition,!0),this.wrapper.node().scrollTop=0,this.activeProfile=this.profiles[this.getLayoutProfile()],this.OPTIONS.IS_MOBILE="small"===this.getLayoutProfile(),this.menuEntity&&(this.menuEntity.setWidth(this.activeProfile.col_width,!0,!0),this.OPTIONS.IS_MOBILE?this.menuEntity.direction!=f&&(this.menuEntity.setDirection(f,!0),this.OPTIONS.MENU_DIRECTION=f):this.menuEntity.direction!=d&&(this.menuEntity.setDirection(d,!0),this.OPTIONS.MENU_DIRECTION=d)),this.width=t.element.node().offsetWidth,this.height=t.element.node().offsetHeight;var n=this.wrapperOuter.node().getBoundingClientRect(),a=n.width,r=n.height;if(a)if(this.OPTIONS.IS_MOBILE)this.clearPos();else{(e||i)&&(this.wrapperOuter.node().offsetTop<10&&this.wrapperOuter.style("top","10px"),this.height-t.wrapperOuter.node().offsetTop-r<0&&(r>this.height&&(r=this.height-20),this.wrapperOuter.style({top:this.height-r-10+"px",bottom:"auto"})),e&&(e=t.wrapperOuter.node().offsetTop));var s;s=this.wrapperOuter.classed(m.alignYb)?this.wrapperOuter.node().offsetTop+this.wrapperOuter.node().offsetHeight:this.height-this.wrapperOuter.node().offsetTop,this.wrapper.style("max-height",s-10+"px"),this.wrapperOuter.classed(m.alignXc,"center"===this._alignX),this.wrapperOuter.style("margin-left","center"===this._alignX?"-"+a/2+"px":null),"center"===this._alignX?this.OPTIONS.MAX_MENU_WIDTH=this.width/2-.5*a-10:this.OPTIONS.MAX_MENU_WIDTH=this.width-this.wrapperOuter.node().offsetLeft-a-10;var o=this.activeProfile.col_width+2*this.OPTIONS.MIN_COL_WIDTH,l=this.wrapperOuter.node().offsetLeft;this.OPTIONS.MENU_OPEN_LEFTSIDE=this.OPTIONS.MAX_MENU_WIDTH<o&&l>this.OPTIONS.MAX_MENU_WIDTH+10,this.OPTIONS.MENU_OPEN_LEFTSIDE?(l<o+10&&(l=o+10),this.OPTIONS.MAX_MENU_WIDTH=l-10):this.OPTIONS.MAX_MENU_WIDTH<o&&(l-=o-this.OPTIONS.MAX_MENU_WIDTH,this.OPTIONS.MAX_MENU_WIDTH=o),i?i=l:l!=this.wrapperOuter.node().offsetLeft&&this.wrapperOuter.style({left:"auto",right:this.width-l-n.width+"px"}),this._top=e,this._left=i,(i||e)&&this.setPos(),this.wrapperOuter.classed("vzb-treemenu-open-left-side",!this.OPTIONS.IS_MOBILE&&this.OPTIONS.MENU_OPEN_LEFTSIDE)}return this.wrapper.node().offsetHeight,this.wrapper.classed(m.noTransition,!1),this.setHorizontalMenuHeight(),this},toggle:function(){var t=this,e=!this.element.classed(m.hidden);this.element.classed(m.hidden,e),e?(this.clearPos(),this.menuEntity.marqueeToggle(!1)):((top||left)&&this.setPos(),this.resize(),this.scrollToSelected()),this.wrapper.classed(m.noTransition,e),
this.parent.components.forEach(function(i){"gapminder-dialogs"==i.name?d3.select(i.placeholder.parentNode).classed("vzb-blur",!e):i.element.classed?i.element.classed("vzb-blur",i!=t&&!e):d3.select(i.element).classed("vzb-blur",i!=t&&!e)}),this.width=t.element.node().offsetWidth},scrollToSelected:function(){var t=this,e=function(t,e){t.scrollTop=0;var i=t.getBoundingClientRect(),n=e.getBoundingClientRect(),a=n.bottom-i.top-t.offsetHeight+10;t.scrollTop=a};if(this.menuEntity.direction==f)e(this.wrapper.node(),this.selectedNode),t.menuEntity.marqueeToggleAll(!0);else{var i=this.menuEntity.findItemById(d3.select(this.selectedNode).data().id);i.submenu.calculateMissingWidth(0,function(){t.menuEntity.marqueeToggleAll(!0)});for(var n,a=this.selectedNode;!s.hasClass(a,m.list_top_level);)"LI"==a.tagName&&(n=s.hasClass(a.parentNode,m.list_top_level)?a.parentNode.parentNode:a.parentNode,e(n,a)),a=a.parentNode}},setPos:function(){var t=this._top,e=this._left,i=this.wrapperOuter.node().getBoundingClientRect();if(t&&(this.wrapperOuter.style({top:t+"px",bottom:"auto"}),this.wrapperOuter.classed(m.absPosVert,t)),e){var n=this.element.node().offsetWidth-e-i.width;n=n<10?10:n,this.wrapperOuter.style({right:n+"px",left:"auto"}),this.wrapperOuter.classed(m.absPosHoriz,n)}},clearPos:function(){this._top="",this._left="",this.wrapperOuter.attr("style",""),this.wrapperOuter.classed(m.absPosVert,""),this.wrapperOuter.classed(m.absPosHoriz,""),this.wrapperOuter.classed(m.menuOpenLeftSide,""),this.wrapper.style("max-height","")},setHorizontalMenuHeight:function(){var t=null;if(this.menuEntity&&this.OPTIONS.MENU_DIRECTION==d&&this.menuEntity.menuItems.length){var e=parseInt(this.menuEntity.menuItems[0].entity.style("height"),10),i=e*this._maxChildCount,n=Math.max(this.menuEntity.menuItems.length,3)*e+this.menuEntity.entity.node().offsetTop+parseInt(this.wrapper.style("padding-bottom"),10);t=""+Math.max(i,n)+"px"}this.wrapper.classed(m.noTransition,!0),this.wrapper.node().offsetHeight,this.wrapper.style("height",t),this.wrapper.node().offsetHeight,this.wrapper.classed(m.noTransition,!1)},_enableSearch:function(){var t=this,e=this.wrapper.select("."+m.search),i=function(e){var i={_id:"root",children:[]},n=function(e,i,n){var a=i[n].name;if(!a&&t.translator){var r=t.translator("indicator/"+i[n][t.OPTIONS.SEARCH_PROPERTY]+"/"+t.model.marker[t._markerID]._type);a=r||t.translator("indicator/"+i[n][t.OPTIONS.SEARCH_PROPERTY])}return a&&a.toLowerCase().indexOf(e.toLowerCase())>=0},a=function a(r){for(var s=t.OPTIONS.SUBMENUS,o=0;o<r.length;o++){var l=!1;l=n(e,r,o),l&&i.children.push(r[o]),!l&&r[o][s]&&a(r[o][s])}};return a(t.dataFiltered.children),i},n=!1,a=s.debounce(function(){var a=e.node().value;(n||""!=a)&&(n=""!=a,a.length>=t.OPTIONS.SEARCH_MIN_STR?t.redraw(i(a),!0):t.redraw())},250);e.on("input",a)},_selectIndicator:function(t){this._callback("which",t,this._markerID),this.toggle()},redraw:function(t,e){var i,n=this,a=this._markerID,r={};s.forEach(this.model.marker._root._data,function(t){"data"===t._type&&s.deepExtend(r,t.getConceptprops())});var o=n.model.marker[a]._type;if(e)i=t;else{null==t&&(t=this._tree);var l=s.keys(r).filter(function(t){if(n.model.marker[a].allow&&n.model.marker[a].allow.names&&n.model.marker[a].allow.names.indexOf("!"+t)!=-1)return!1;if(!n.model.marker[a].allow||!n.model.marker[a].allow.scales)return!0;if("*"==n.model.marker[a].allow.scales[0])return!0;if(!r[t].scales)return!0;for(var e=r[t].scales.length-1;e>=0;e--)if(n.model.marker[a].allow.scales.indexOf(r[t].scales[e])>-1)return!0;return!1});i=s.pruneTree(t,function(t){return l.indexOf(t.id)>-1}),this.dataFiltered=i}this.wrapper.select("ul").remove(),this.element.select("."+m.title).select("span").text(this.translator("buttons/"+a)),this.element.select("."+m.search).attr("placeholder",this.translator("placeholder/search")+"..."),this._maxChildCount=0;var c=function t(e,i,r){if(i.children){n._maxChildCount=Math.max(n._maxChildCount,i.children.length);var l=r?e:e.append("div").classed(m.list_outer,!0),c=l.append("ul").classed(m.list,!r).classed(m.list_top_level,r).classed("vzb-dialog-scrollable",!0).selectAll("li").data(i.children,function(t){return t.id}).enter().append("li");c.append("span").classed(m.list_item_label,!0).attr("children",function(t){return t.children?"true":null}).attr("type",function(t){return t.type?t.type:null}).on("click",function(t){var e=d3.select(this);e.attr("children")||(d3.event.stopPropagation(),n._selectIndicator({concept:t.id,dataSource:t.dataSource}))}).append("span").text(function(t){var e="_default"===t.id?n.translator("indicator/_default/"+o):t.name||t.id;return e||""===e||s.warn("translation missing: NAME of "+t.id),e||""}),c.classed(m.list_item,!0).classed(m.hasChild,function(t){return t.children}).classed(m.isSpecial,function(t){return t.special}).each(function(e){var i=d3.select(this);if(!e.children){var l=i.append("div").attr("class",m.menuHorizontal+" "+m.list_outer+" "+m.list_item_leaf);l.on("click",function(t){n._selectIndicator({concept:t.id,dataSource:t.dataSource})});var c=l.append("div").classed(m.leaf+" "+m.leaf_content+" vzb-dialog-scrollable",!0);c.append("span").classed(m.leaf_content_item+" "+m.leaf_content_item_title,!0).text(function(t){var e="_default"===t.id?n.translator("indicator/_default/"+o):t.name;return e||""});var h,u=c.append("span").classed(m.leaf_content_item,!0).text(function(t){var e="_default"===t.id?n.translator("unit/_default/"+o):t.unit;return h=!e,n.translator("hints/units")+": "+e||""});u.classed("vzb-hidden",h);var d,f=c.append("span").classed(m.leaf_content_item+" "+m.leaf_content_item_descr,!0).text(function(t){var e="_default"===t.id?n.translator("description/_default/"+o):t.description;return d=!e,h&&d?n.translator("hints/nodescr"):e||""});f.classed("vzb-hidden",d&&!h)}if(e.id==n.model.marker[a].which){var p;if(n.selectedNode&&r)for(p=n.selectedNode.parentNode,d3.select(n.selectedNode).select("."+m.list_item_leaf).classed("active",!1);!s.hasClass(p,m.list_top_level);)"UL"==p.tagName&&d3.select(p.parentNode).classed("active",!1),p=p.parentNode;if(!n.selectedNode||r){for(p=this.parentNode,d3.select(this).classed("item-active",!0).select("."+m.list_item_leaf).classed("active",!0);!s.hasClass(p,m.list_top_level);)"UL"==p.tagName&&d3.select(p.parentNode).classed("active",!0),"LI"==p.tagName&&d3.select(p).classed("item-active",!0),p=p.parentNode;n.selectedNode=this}}t(i,e)})}};if(this.OPTIONS.IS_MOBILE?this.OPTIONS.MENU_DIRECTION=f:this.OPTIONS.MENU_DIRECTION=d,this.selectedNode=null,c(this.wrapper,i,!0),this.menuEntity=new g(null,this.wrapper.selectAll("."+m.list_top_level),this.OPTIONS),this.menuEntity&&this.menuEntity.setDirection(this.OPTIONS.MENU_DIRECTION),this.menuEntity&&this.menuEntity.setWidth(this.activeProfile.col_width,!0,!0),this.setHorizontalMenuHeight(),!e){var h="_default";if(l.indexOf(this.model.marker[a].which)>-1&&(h=this.model.marker[a].which),r[h]||s.error("Concept properties of "+h+" are missing from the set, or the set is empty. Put a breakpoint here and check what you have in indicatorsDB"),!r[h].scales)return this.element.select("."+m.scaletypes).classed(m.hidden,!0),!0;var u=r[h].scales.filter(function(t){return!n.model.marker[a].allow||!n.model.marker[a].allow.scales||("*"==n.model.marker[a].allow.scales[0]||n.model.marker[a].allow.scales.indexOf(t)>-1)});if(0==u.length)this.element.select("."+m.scaletypes).classed(m.hidden,!0);else{var p=this.element.select("."+m.scaletypes).classed(m.hidden,!1).selectAll("span").data(u,function(t){return t});p.exit().remove(),p.enter().append("span").on("click",function(t){d3.event.stopPropagation(),n._setModel("scaleType",t,n._markerID)});var v=n.model.marker[a].scaleType;p.classed(m.scaletypesDisabled,u.length<2).classed(m.scaletypesActive,function(t){return(t==v||"log"===t&&"genericLog"===v)&&u.length>1}).text(function(t){return n.translator("scaletype/"+t)})}}return this},updateView:function(){if(this._markerID){this.wrapperOuter.classed(m.absPosVert,this._top),this.wrapperOuter.classed(m.alignYt,"top"===this._alignY),this.wrapperOuter.classed(m.alignYb,"bottom"===this._alignY),this.wrapperOuter.classed(m.absPosHoriz,this._left),this.wrapperOuter.classed(m.alignXl,"left"===this._alignX),this.wrapperOuter.classed(m.alignXr,"right"===this._alignX);var t=this._setModel.bind(this);return this.callback(t).tree(this.indicatorsTree).redraw(),this.wrapper.select("."+m.search).node().value="",this}},_setModel:function(t,e,i){var n=this.model.marker[i];"which"==t&&n.setWhich(e),"scaleType"==t&&n.setScaleType(e)}});e.default=b},function(t,e){var i={}.toString;t.exports=function(t){return i.call(t).slice(8,-1)}},function(t,e){t.exports=function(t){if(void 0==t)throw TypeError("Can't call method on  "+t);return t}},function(t,e,i){var n=i(5);t.exports=function(t,e){return!!t&&n(function(){e?t.call(null,function(){},1):t.call(null)})}},function(t,e,i){var n=i(36),a=i(68),r=i(13),s=i(12),o=i(232);t.exports=function(t,e){var i=1==t,l=2==t,c=3==t,h=4==t,u=6==t,d=5==t||u,f=e||o;return function(e,o,m){for(var p,g,v=r(e),b=a(v),y=n(o,m,3),x=s(b.length),_=0,M=i?f(e,x):l?f(e,0):void 0;x>_;_++)if((d||_ in b)&&(p=b[_],g=y(p,_,v),t))if(i)M[_]=g;else if(g)switch(t){case 3:return!0;case 5:return p;case 6:return _;case 2:M.push(p)}else if(h)return!1;return u?-1:c||h?h:M}}},function(t,e,i){var n=i(0),a=i(35),r=i(5);t.exports=function(t,e){var i=(a.Object||{})[t]||Object[t],s={};s[t]=e(i),n(n.S+n.F*r(function(){i(1)}),"Object",s)}},function(t,e,i){var n=i(6);t.exports=function(t,e){if(!n(t))return t;var i,a;if(e&&"function"==typeof(i=t.toString)&&!n(a=i.call(t)))return a;if("function"==typeof(i=t.valueOf)&&!n(a=i.call(t)))return a;if(!e&&"function"==typeof(i=t.toString)&&!n(a=i.call(t)))return a;throw TypeError("Can't convert object to primitive value")}},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),s=(a(r),i(2)),o=n(s),l=i(10),c=!0,h=!1,u=!1,d=0,f=0,m=null,p=null,g=o.default.extend({init:function(t,e){var i=this;this.name="gapminder-datanotes",this.model_expects=[{name:"marker",type:"model"},{name:"locale",type:"locale"}],this.context=e,this.model_binds={"translate:locale":function(t){i._ready&&i._readyOnce&&i.ready()}},this._super(t,e),this.close=this.close.bind(this)},ready:function(){this.setValues()},readyOnce:function(){var t=this;this.translator=this.model.locale.getTFunction(),this.element=d3.select(this.placeholder),this.element.selectAll("div").remove();var e=this.element;e.append("div").html(l.close).on("click",function(){d3.event.stopPropagation(),t.close()}).select("svg").attr("width","0px").attr("height","0px").attr("class","vzb-data-notes-close").classed("vzb-hidden",!0),e.append("div").attr("class","vzb-data-notes-body vzb-dialog-scrollable"),e.append("div").attr("class","vzb-data-notes-link")},resize:function(){this.close()},close:function(){c||this.pin(!1).hide()},setHook:function(t){return this._readyOnce?u?(p=t,this):(m&&this.model.marker[m].off("change:which",this.close),m=p=t,this.model.marker[m].on("change:which",this.close),this.setValues(),this):this},setValues:function(){if(m){var t=this.model.marker[m],e=t.getConceptprops();if(this.element.select(".vzb-data-notes-body").classed("vzb-hidden",!e.description).text(e.description||""),this.element.select(".vzb-data-notes-link").classed("vzb-hidden",!e.sourceLink),e.sourceLink){var i=this.translator("hints/source"),n=e.sourceName||"";this.element.select(".vzb-data-notes-link").html("<span>"+(n?i+":":"")+'<a href="'+e.sourceLink+'" target="_blank">'+(n?n:i)+"</a></span>")}h=e.sourceLink||e.description}},setPos:function(t,e,i){if(d=t,f=e,u&&!i)return this;var n,a,r=this.parent.element.offsetHeight,s=this.element.node().offsetWidth,o=this.element.node().offsetHeight,l=d-s,c=f;return l<10&&(l=10,n=!0),c+o+10>r&&(c=r-o-10,a=!0),n&&a&&(c=f-o-30),this.element.style({top:c+"px",left:l+"px"}),this},pin:function(t){return c?this:(u=!u,null!=t&&(u=t),this.element.select(".vzb-data-notes-close").classed("vzb-hidden",!u),this.element.classed("vzb-data-notes-pinned",u),m!=p&&this.setHook(p),this.element.select(".vzb-data-notes-body").node().scrollTop=0,h?this.setPos(d,f,!0):this.hide())},toggle:function(t){return u||!m?this:(null==t&&(t=!c),c=t,this.element.classed("vzb-hidden",c||!h),this)},show:function(){return this.toggle(!1)},hide:function(){return this.toggle(!0)}});e.default=g},function(t,e){var i=t.exports={version:"2.4.0"};"number"==typeof __e&&(__e=i)},function(t,e,i){var n=i(16);t.exports=function(t,e,i){if(n(t),void 0===e)return t;switch(i){case 1:return function(i){return t.call(e,i)};case 2:return function(i,n){return t.call(e,i,n)};case 3:return function(i,n,a){return t.call(e,i,n,a)}}return function(){return t.apply(e,arguments)}}},function(t,e,i){var n=i(177),a=i(0),r=i(81)("metadata"),s=r.store||(r.store=new(i(180))),o=function(t,e,i){var a=s.get(t);if(!a){if(!i)return;s.set(t,a=new n)}var r=a.get(e);if(!r){if(!i)return;a.set(e,r=new n)}return r},l=function(t,e,i){var n=o(e,i,!1);return void 0!==n&&n.has(t)},c=function(t,e,i){var n=o(e,i,!1);return void 0===n?void 0:n.get(t)},h=function(t,e,i,n){o(i,n,!0).set(t,e)},u=function(t,e){var i=o(t,e,!1),n=[];return i&&i.forEach(function(t,e){n.push(e)}),n},d=function(t){return void 0===t||"symbol"==typeof t?t:String(t)},f=function(t){a(a.S,"Reflect",t)};t.exports={store:s,map:o,has:l,get:c,set:h,keys:u,key:d,exp:f}},function(t,e,i){"use strict";if(i(8)){var n=i(50),a=i(4),r=i(5),s=i(0),o=i(82),l=i(111),c=i(36),h=i(49),u=i(43),d=i(17),f=i(54),m=i(44),p=i(12),g=i(56),v=i(33),b=i(15),y=i(174),x=i(67),_=i(6),M=i(13),w=i(96),z=i(51),S=i(26),k=i(52).f,E=i(113),O=i(57),T=i(7),P=i(31),D=i(72),I=i(105),C=i(114),A=i(62),L=i(78),R=i(55),j=i(89),N=i(154),F=i(9),B=i(25),q=F.f,H=B.f,Y=a.RangeError,V=a.TypeError,X=a.Uint8Array,W="ArrayBuffer",K="Shared"+W,U="BYTES_PER_ELEMENT",G="prototype",Q=Array[G],Z=l.ArrayBuffer,$=l.DataView,J=P(0),tt=P(2),et=P(3),it=P(4),nt=P(5),at=P(6),rt=D(!0),st=D(!1),ot=C.values,lt=C.keys,ct=C.entries,ht=Q.lastIndexOf,ut=Q.reduce,dt=Q.reduceRight,ft=Q.join,mt=Q.sort,pt=Q.slice,gt=Q.toString,vt=Q.toLocaleString,bt=T("iterator"),yt=T("toStringTag"),xt=O("typed_constructor"),_t=O("def_constructor"),Mt=o.CONSTR,wt=o.TYPED,zt=o.VIEW,St="Wrong length!",kt=P(1,function(t,e){return It(I(t,t[_t]),e)}),Et=r(function(){return 1===new X(new Uint16Array([1]).buffer)[0]}),Ot=!!X&&!!X[G].set&&r(function(){new X(1).set({})}),Tt=function(t,e){if(void 0===t)throw V(St);var i=+t,n=p(t);if(e&&!y(i,n))throw Y(St);return n},Pt=function(t,e){var i=m(t);if(i<0||i%e)throw Y("Wrong offset!");return i},Dt=function(t){if(_(t)&&wt in t)return t;throw V(t+" is not a typed array!")},It=function(t,e){if(!(_(t)&&xt in t))throw V("It is not a typed array constructor!");return new t(e)},Ct=function(t,e){return At(I(t,t[_t]),e)},At=function(t,e){for(var i=0,n=e.length,a=It(t,n);n>i;)a[i]=e[i++];return a},Lt=function(t,e,i){q(t,e,{get:function(){return this._d[i]}})},Rt=function(t){var e,i,n,a,r,s,o=M(t),l=arguments.length,h=l>1?arguments[1]:void 0,u=void 0!==h,d=E(o);if(void 0!=d&&!w(d)){for(s=d.call(o),n=[],e=0;!(r=s.next()).done;e++)n.push(r.value);o=n}for(u&&l>2&&(h=c(h,arguments[2],2)),e=0,i=p(o.length),a=It(this,i);i>e;e++)a[e]=u?h(o[e],e):o[e];return a},jt=function(){for(var t=0,e=arguments.length,i=It(this,e);e>t;)i[t]=arguments[t++];return i},Nt=!!X&&r(function(){vt.call(new X(1))}),Ft=function(){return vt.apply(Nt?pt.call(Dt(this)):Dt(this),arguments)},Bt={copyWithin:function(t,e){return N.call(Dt(this),t,e,arguments.length>2?arguments[2]:void 0)},every:function(t){return it(Dt(this),t,arguments.length>1?arguments[1]:void 0)},fill:function(t){return j.apply(Dt(this),arguments)},filter:function(t){return Ct(this,tt(Dt(this),t,arguments.length>1?arguments[1]:void 0))},find:function(t){return nt(Dt(this),t,arguments.length>1?arguments[1]:void 0)},findIndex:function(t){return at(Dt(this),t,arguments.length>1?arguments[1]:void 0)},forEach:function(t){J(Dt(this),t,arguments.length>1?arguments[1]:void 0)},indexOf:function(t){return st(Dt(this),t,arguments.length>1?arguments[1]:void 0)},includes:function(t){return rt(Dt(this),t,arguments.length>1?arguments[1]:void 0)},join:function(t){return ft.apply(Dt(this),arguments)},lastIndexOf:function(t){return ht.apply(Dt(this),arguments)},map:function(t){return kt(Dt(this),t,arguments.length>1?arguments[1]:void 0)},reduce:function(t){return ut.apply(Dt(this),arguments)},reduceRight:function(t){return dt.apply(Dt(this),arguments)},reverse:function(){for(var t,e=this,i=Dt(e).length,n=Math.floor(i/2),a=0;a<n;)t=e[a],e[a++]=e[--i],e[i]=t;return e},some:function(t){return et(Dt(this),t,arguments.length>1?arguments[1]:void 0)},sort:function(t){return mt.call(Dt(this),t)},subarray:function(t,e){var i=Dt(this),n=i.length,a=g(t,n);return new(I(i,i[_t]))(i.buffer,i.byteOffset+a*i.BYTES_PER_ELEMENT,p((void 0===e?n:g(e,n))-a))}},qt=function(t,e){return Ct(this,pt.call(Dt(this),t,e))},Ht=function(t){Dt(this);var e=Pt(arguments[1],1),i=this.length,n=M(t),a=p(n.length),r=0;if(a+e>i)throw Y(St);for(;r<a;)this[e+r]=n[r++]},Yt={entries:function(){return ct.call(Dt(this))},keys:function(){return lt.call(Dt(this))},values:function(){return ot.call(Dt(this))}},Vt=function(t,e){return _(t)&&t[wt]&&"symbol"!=typeof e&&e in t&&String(+e)==String(e)},Xt=function(t,e){return Vt(t,e=v(e,!0))?u(2,t[e]):H(t,e)},Wt=function(t,e,i){return!(Vt(t,e=v(e,!0))&&_(i)&&b(i,"value"))||b(i,"get")||b(i,"set")||i.configurable||b(i,"writable")&&!i.writable||b(i,"enumerable")&&!i.enumerable?q(t,e,i):(t[e]=i.value,t)};Mt||(B.f=Xt,F.f=Wt),s(s.S+s.F*!Mt,"Object",{getOwnPropertyDescriptor:Xt,defineProperty:Wt}),r(function(){gt.call({})})&&(gt=vt=function(){return ft.call(this)});var Kt=f({},Bt);f(Kt,Yt),d(Kt,bt,Yt.values),f(Kt,{slice:qt,set:Ht,constructor:function(){},toString:gt,toLocaleString:Ft}),Lt(Kt,"buffer","b"),Lt(Kt,"byteOffset","o"),Lt(Kt,"byteLength","l"),Lt(Kt,"length","e"),q(Kt,yt,{get:function(){return this[wt]}}),t.exports=function(t,e,i,l){l=!!l;var c=t+(l?"Clamped":"")+"Array",u="Uint8Array"!=c,f="get"+t,m="set"+t,g=a[c],v=g||{},b=g&&S(g),y=!g||!o.ABV,M={},w=g&&g[G],E=function(t,i){var n=t._d;return n.v[f](i*e+n.o,Et)},O=function(t,i,n){var a=t._d;l&&(n=(n=Math.round(n))<0?0:n>255?255:255&n),a.v[m](i*e+a.o,n,Et)},T=function(t,e){q(t,e,{get:function(){return E(this,e)},set:function(t){return O(this,e,t)},enumerable:!0})};y?(g=i(function(t,i,n,a){h(t,g,c,"_d");var r,s,o,l,u=0,f=0;if(_(i)){if(!(i instanceof Z||(l=x(i))==W||l==K))return wt in i?At(g,i):Rt.call(g,i);r=i,f=Pt(n,e);var m=i.byteLength;if(void 0===a){if(m%e)throw Y(St);if(s=m-f,s<0)throw Y(St)}else if(s=p(a)*e,s+f>m)throw Y(St);o=s/e}else o=Tt(i,!0),s=o*e,r=new Z(s);for(d(t,"_d",{b:r,o:f,l:s,e:o,v:new $(r)});u<o;)T(t,u++)}),w=g[G]=z(Kt),d(w,"constructor",g)):L(function(t){new g(null),new g(t)},!0)||(g=i(function(t,i,n,a){h(t,g,c);var r;return _(i)?i instanceof Z||(r=x(i))==W||r==K?void 0!==a?new v(i,Pt(n,e),a):void 0!==n?new v(i,Pt(n,e)):new v(i):wt in i?At(g,i):Rt.call(g,i):new v(Tt(i,u))}),J(b!==Function.prototype?k(v).concat(k(b)):k(v),function(t){t in g||d(g,t,v[t])}),g[G]=w,n||(w.constructor=g));var P=w[bt],D=!!P&&("values"==P.name||void 0==P.name),I=Yt.values;d(g,xt,!0),d(w,wt,c),d(w,zt,!0),d(w,_t,g),(l?new g(1)[yt]==c:yt in w)||q(w,yt,{get:function(){return c}}),M[c]=g,s(s.G+s.W+s.F*(g!=v),M),s(s.S,c,{BYTES_PER_ELEMENT:e,from:Rt,of:jt}),U in w||d(w,U,e),s(s.P,c,Bt),R(c),s(s.P+s.F*Ot,c,{set:Ht}),s(s.P+s.F*!D,c,Yt),s(s.P+s.F*(w.toString!=gt),c,{toString:gt}),s(s.P+s.F*r(function(){new g(1).slice()}),c,{slice:qt}),s(s.P+s.F*(r(function(){return[1,2].toLocaleString()!=new g([1,2]).toLocaleString()})||!r(function(){w.toLocaleString.call([1,2])})),c,{toLocaleString:Ft}),A[c]=D?P:I,n||D||d(w,bt,I)}}else t.exports=function(){}},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),s=(a(r),i(2)),o=n(s),l=i(10),c=!0,h=o.default.extend({init:function(t,e){var i=this;this.name="gapminder-datawarning",this.model_expects=[{name:"locale",type:"locale"}],this.context=e,this.model_binds={"translate:locale":function(t){i._ready&&i.redraw()}},this._super(t,e)},ready:function(){this.redraw()},readyOnce:function(){var t=this;this.element=d3.select(this.placeholder),this.element.selectAll("div").remove(),this.element.append("div").attr("class","vzb-data-warning-background").on("click",function(){t.toggle(!0)}),this.container=this.element.append("div").attr("class","vzb-data-warning-box"),this.container.append("div").html(l.close).on("click",function(){t.toggle()}).select("svg").attr("width","0px").attr("height","0px").attr("class","vzb-data-warning-close");var e=this.container.append("div").attr("class","vzb-data-warning-link").html(l.warn);e.append("div"),this.container.append("div").attr("class","vzb-data-warning-title"),this.container.append("div").attr("class","vzb-data-warning-body vzb-dialog-scrollable")},redraw:function(){this.translator=this.model.locale.getTFunction(),this.container.select(".vzb-data-warning-link div").text(this.translator("hints/dataWarning"));var t=this.translator("datawarning/title/"+this.parent.name);this.container.select(".vzb-data-warning-title").html(t).classed("vzb-hidden",!t||t=="datawarning/title/"+this.parent.name),this.container.select(".vzb-data-warning-body").html(this.translator("datawarning/body/"+this.parent.name))},toggle:function(t){null==t&&(t=!c),c=t,this.element.classed("vzb-hidden",c);var e=this;this.parent.components.forEach(function(t){t.element.classed("vzb-blur",t!=e&&!c)})}});e.default=h},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function a(){return function t(e){function i(t,e,i){return i.indexOf(t)===e}function n(t){var i=n.scale().domain(),a=n.scale().range();if(!i[0]&&0!==i[0]||!i[1]&&0!==i[1]||!a[0]&&0!==a[0]||!a[1]&&0!==a[1])return s.warn("d3.svg.axisSmart() skips action because of invalid domain "+JSON.stringify(i)+" or range "+JSON.stringify(a)+" of the attached scale");if(null!=g)return void n.highlightValueRun(t);var r=t.append("g").attr("class","tick widthSampling"),o=r.append("text").text("0");M.cssMargin||(M.cssMargin={}),M.cssMargin.top=o.style("margin-top"),M.cssMargin.bottom=o.style("margin-bottom"),M.cssMargin.left=o.style("margin-left"),M.cssMargin.right=o.style("margin-right"),M.widthOfOneDigit=o[0][0].getBBox().width,M.heightOfOneDigit=o[0][0].getBBox().height,r.remove(),n.labelFactory(M),e(M.transitionDuration>0?t.transition().duration(M.transitionDuration):t);var d="top"==n.orient()||"bottom"==n.orient()?c:l,f=d==c&&n.pivot()||d==l&&!n.pivot()?u:h;t.selectAll(".vzb-axis-value").data([null]).enter().append("g").attr("class","vzb-axis-value").classed("vzb-hidden",!0).append("text");var m=n.tickPadding();t.selectAll("text").each(function(t,e){if(null!=n.pivot()){var i=d3.select(this);i.attr("transform","rotate("+(n.pivot()?-90:0)+")"),i.style("text-anchor",f==h?"middle":"end"),i.attr("x",f==h?d==l?-m:0:-m),i.attr("y",f==h?d==l?0:m:0),i.attr("dx",f==h&&d==l?m:0),i.attr("dy",f==h?d==l?-m:".72em":".32em")}}),null!=n.repositionLabels()&&t.selectAll(".tick").each(function(t){var e=d3.select(this).select("text"),i=n.repositionLabels()[t]||{x:0,y:0};e.attr("x",+e.attr("x")+i.x),e.attr("y",+e.attr("y")+i.y)});var p=n.scale();M.viewportLength&&t.selectAll(".tick").classed("vzb-hidden",function(t){return p(t)<0||p(t)>M.viewportLength}),null==n.tickValuesMinor()&&n.tickValuesMinor([]);var v=t.selectAll(".tick-minor").data(x);v.exit().remove(),v.enter().append("line").attr("class","tick-minor");var b=n.tickSizeMinor().outbound,y=n.tickSizeMinor().inbound;v.classed("vzb-hidden",function(t){return p(t)<0||p(t)>M.viewportLength}).attr("y1",d==c?("top"==n.orient()?1:-1)*y:p).attr("y2",d==c?("top"==n.orient()?-1:1)*b:p).attr("x1",d==l?("right"==n.orient()?-1:1)*y:p).attr("x2",d==l?("right"==n.orient()?1:-1)*b:p),t.selectAll("path").remove();var _=t.selectAll(".vzb-axis-line").data([0]);_.exit().remove(),_.enter().append("line").attr("class","vzb-axis-line"),M.viewportLength?_.attr("x1",d==l?0:-1).attr("x2",d==l?0:M.viewportLength).attr("y1",0).attr("y2",d==c?0:M.viewportLength):_.attr("x1",d==l?0:d3.min(p.range())-(M.bump||0)-1).attr("x2",d==l?0:d3.max(p.range())+(M.bump||0)).attr("y1",d==c?0:d3.min(p.range())-(M.bump||0)).attr("y2",d==c?0:d3.max(p.range())+(M.bump||0))}function a(t,e){null==e&&(e=!0);var i=[],n=[];t.indexOf(0)!=-1&&(i.push([0]),n.push(t.indexOf(0)));for(var a=t.length;a>=1;a=a<4?a-1:a/2)i.push(t.filter(function(t,i){return!(i%Math.floor(a)!=0||n.indexOf(i)!=-1&&e)&&(n.push(i),!0)}));return i}function r(t,e,i,n,a){if(!t)return null;var r={},s=i==l?{head:e.toolMargin.top,tail:e.toolMargin.bottom}:{head:e.toolMargin.right,tail:e.toolMargin.left},o=n.range(),h=e.bump;return e.viewportLength&&(t=t.filter(function(t){return n(t)>=0&&n(t)<=e.viewportLength}),o=[0,e.viewportLength],h=0),t.forEach(function(u,d){if(0==d||d==t.length-1){var f=Math.min(s.head,.5*e.widthOfOneDigit)+h+(i==c?1:0)*d3.max(o)-(i==c?0:1)*d3.min(o)+(i==c?-1:1)*n(u)-("x"==a)*e.formatter(u).length*e.widthOfOneDigit/2-("y"==a)*e.heightOfOneDigit/2-("x"==a)*parseInt(e.cssMargin.right)-("y"==a)*parseInt(e.cssMargin.top),m=Math.min(s.tail,.5*e.widthOfOneDigit)+h+(i==l?1:0)*d3.max(o)-(i==l?0:1)*d3.min(o)+(i==l?-1:1)*n(u)-("x"==a)*e.formatter(u).length*e.widthOfOneDigit/2-("y"==a)*e.heightOfOneDigit/2-("x"==a)*parseInt(e.cssMargin.left)-("y"==a)*parseInt(e.cssMargin.bottom);f>0&&(f=0),m>0&&(m=0),r[u]={x:0,y:0},r[u][a]=("y"==a&&i==l?-1:1)*(f-m)}}),t.forEach(function(s,o){if(0!=o&&o!=t.length-1){var h=Math.abs(n(s)-n(t[t.length-1]))-("y"==a)*(i==c?-1:1)*r[t[t.length-1]][a]-("x"==a)*(i==c?1:-1)*r[t[t.length-1]][a]-("x"==a)*e.widthOfOneDigit/2*e.formatter(s).length-("x"==a)*e.widthOfOneDigit/2*e.formatter(t[t.length-1]).length-("y"==a)*e.heightOfOneDigit*.7-("x"==a)*parseInt(e.cssMargin.left)-("y"==a)*parseInt(e.cssMargin.bottom),u=Math.abs(n(s)-n(t[0]))-("y"==a)*(i==l?-1:1)*r[t[0]][a]-("x"==a)*(i==l?1:-1)*r[t[0]][a]-("x"==a)*e.widthOfOneDigit/2*e.formatter(s).length-("x"==a)*e.widthOfOneDigit/2*e.formatter(t[0]).length-("y"==a)*e.heightOfOneDigit*.7-("x"==a)*parseInt(e.cssMargin.left)-("y"==a)*parseInt(e.cssMargin.bottom);h>0&&(h=0),u>0&&(u=0),r[s]={x:0,y:0},r[s][a]=("y"==a&&i==l?-1:1)*(h-u)}}),r}function o(t,e,i,a,r){if(n.labelerOptions().isDevMode)return null!=r?void console.log(t,e,i,a,r):null!=a?void console.log(t,e,i,a):null!=i?void console.log(t,e,i):null!=e?void console.log(t,e):null!=t?void console.log(t):void 0}var l="vertical axis",c="horizontal axis",h="labels stack side by side",u="labels stack top to bottom",d="optimistic approximation: labels have different lengths",f="pessimistic approximation: all labels have the largest length",m=10;n.highlightValueRun=function(t){M.viewportLength&&"none"!=g&&(n.scale()(g)>M.viewportLength||n.scale()(g)<0)&&(g="none");var e="top"==n.orient()||"bottom"==n.orient()?c:l,i=e==c&&n.pivot()||e==l&&!n.pivot()?"y":"x",a=n.pivot()?-1:1;t.select(".vzb-axis-value").classed("vzb-hidden","none"==g);var s,o={};"none"!=g&&(s=t.select(".vzb-axis-value").node().getBBox(),o.bump=M.bump,o.formatter=M.formatter,o.viewportLength=M.viewportLength,o.toolMargin=M.toolMargin,o.cssMargin=M.cssMargin,o.widthOfOneDigit=s[n.pivot()?"height":"width"]/M.formatter(g).length,o.heightOfOneDigit=s[n.pivot()?"width":"height"]);var h=("none"==g?{x:0,y:0}:r([g],o,e,n.scale(),i)[g])[i],u=function(t){return"none"==g?"translate(0,0)":"translate("+(e==c?n.scale()(g)+h*a:0)+","+(e==l?n.scale()(g)+h*a:0)+")"},d=function(t,r,o){if("none"==g)return 1;var l=e==c?"width":"height",u=(n.repositionLabels()[t]||{x:0,y:0})[i];return n.hlOpacityScale()(Math.abs(n.scale()(t)+u*a-n.scale()(g)-h*a)-o.getBBox()[l]/2-s[l]/2)};v?(t.select(".vzb-axis-value").transition().duration(v).ease("linear").attr("transform",u),t.select(".vzb-axis-value").select("text").transition("text").delay(v).text("none"==g?"":M.formatter(g)),t.selectAll(".tick:not(.vzb-hidden)").each(function(t,e){d3.select(this).select("text").transition().duration(v).ease("linear").style("opacity",d(t,e,this))})):(t.select(".vzb-axis-value").interrupt().attr("transform",u).transition(),t.select(".vzb-axis-value").select("text").interrupt().text("none"==g?"":M.formatter(g)).transition(),t.selectAll(".tick:not(.vzb-hidden)").each(function(t,e){d3.select(this).select("text").interrupt().style("opacity",d(t,e,this)).transition()})),g=null};var p=d3.scale.linear().domain([0,5]).range([0,1]).clamp(!0);n.hlOpacityScale=function(t){return arguments.length?(p=t,n):p};var g=null;n.highlightValue=function(t){return arguments.length?(g=t,n):g};var v=0;n.highlightTransDuration=function(t){return arguments.length?(v=t,n):v};var b=null;n.repositionLabels=function(t){return arguments.length?(b=t,n):b};var y=!1;n.pivot=function(t){return arguments.length?(y=!!t,n):y};var x=[];n.tickValuesMinor=function(t){return arguments.length?(x=t,n):x};var _={outbound:0,inbound:0};n.tickSizeMinor=function(t,e){return arguments.length?(_={outbound:t,inbound:e||0},o("setting",_),n):_};var M={};return n.labelerOptions=function(t){return arguments.length?(M=t,n):M},n.METHOD_REPEATING="repeating specified powers",n.METHOD_DOUBLING="doubling the value",n.labelFactory=function(t){function e(e,i){return 0==e||0==i?0:(null==i&&(i=t.logBase),Math.log(e)/Math.log(i))}if(null==t&&(t={}),"linear"!=t.scaleType&&"time"!=t.scaleType&&"genericLog"!=t.scaleType&&"log"!=t.scaleType&&"ordinal"!=t.scaleType)return n.ticks(_).tickFormat(null).tickValues(null).tickValuesMinor(null).pivot(null).repositionLabels(null);if("ordinal"==t.scaleType)return n.tickValues(null);null==t.logBase&&(t.logBase=m),null==t.stops&&(t.stops=[1,2,5,3,7,4,6,8,9]),null==t.removeAllLabels&&(t.removeAllLabels=!1),null==t.formatter&&(t.formatter=n.tickFormat()?n.tickFormat():function(t){return t+""}),t.cssLabelMarginLimit=5,null==t.cssMargin&&(t.cssMargin={}),(null==t.cssMargin.left||parseInt(t.cssMargin.left)<t.cssLabelMarginLimit)&&(t.cssMargin.left=t.cssLabelMarginLimit+"px"),(null==t.cssMargin.right||parseInt(t.cssMargin.right)<t.cssLabelMarginLimit)&&(t.cssMargin.right=t.cssLabelMarginLimit+"px"),(null==t.cssMargin.top||parseInt(t.cssMargin.top)<t.cssLabelMarginLimit)&&(t.cssMargin.top=t.cssLabelMarginLimit+"px"),(null==t.cssMargin.bottom||parseInt(t.cssMargin.bottom)<t.cssLabelMarginLimit)&&(t.cssMargin.bottom=t.cssLabelMarginLimit+"px"),null==t.toolMargin&&(t.toolMargin={left:30,bottom:30,right:30,top:30}),null==t.bump&&(t.bump=0),null==t.viewportLength&&(t.viewportLength=0),null==t.pivotingLimit&&(t.pivotingLimit=t.toolMargin[this.orient()]),null==t.showOuter&&(t.showOuter=!1),null==t.limitMaxTickNumber&&(t.limitMaxTickNumber=0);var s="top"==this.orient()||"bottom"==this.orient()?c:l;null==t.isPivotAuto&&(t.isPivotAuto=s==l),null==t.cssFontSize&&(t.cssFontSize="13px"),null==t.widthToFontsizeRatio&&(t.widthToFontsizeRatio=.75),null==t.heightToFontsizeRatio&&(t.heightToFontsizeRatio=1.2),null==t.widthOfOneDigit&&(t.widthOfOneDigit=parseInt(t.cssFontSize)*t.widthToFontsizeRatio),null==t.heightOfOneDigit&&(t.heightOfOneDigit=parseInt(t.cssFontSize)*t.heightToFontsizeRatio),null!=t.fitIntoScale&&"pessimistic"!=t.fitIntoScale||(t.fitIntoScale=f),"optimistic"==t.fitIntoScale&&(t.fitIntoScale=d),o("********** "+s+" **********");var h=n.scale().domain(),u=n.scale().range(),p=(Math.abs(h[h.length-1]-h[0]),Math.abs(u[u.length-1]-u[0])),g=d3.min([h[0],h[h.length-1]]),v=d3.max([h[0],h[h.length-1]]),b=g<=0&&v>=0&&"time"!=t.scaleType,y=t.showOuter?[g,v]:[],x=[],_=5,M=d3.max(d3.range(g,v,(v-g)/17).concat(v).map(function(e){
return t.formatter(e).length}))*t.widthOfOneDigit+parseInt(t.cssMargin.left),w=t.isPivotAuto&&(M+n.tickPadding()>t.pivotingLimit&&s==l||!(M+n.tickPadding()>t.pivotingLimit)&&!(s==l)),z=s==c&&w||s==l&&!w,S=!z&&t.heightOfOneDigit>t.pivotingLimit;if(t.removeAllLabels)return n.tickValues([]);if(g==v)return n.tickValues([g]).ticks(1).tickFormat(t.formatter);var k=function(e,i,a,r){if(null==e||e.length<=1)return!0;if(null==a&&(a=f),null==r&&(scaleType="none"),z)return i>e.length*(t.heightOfOneDigit+parseInt(t.cssMargin.top)+parseInt(t.cssMargin.bottom));var s=parseInt(t.cssMargin.left)+parseInt(t.cssMargin.right),o=d3.max(e.map(function(e){return t.formatter(e).length}));return"log"==r?(i=Math.abs(n.scale()(d3.max(e))-n.scale()(d3.min(e))),i>d3.sum(e.map(function(e){return(t.widthOfOneDigit*(a==f?o:t.formatter(e).length)+s)*(1+Math.log(e.toString().replace(/([0\.])/g,"")[0])/Math.LN10)}))):i>e.length*s+(a==f?t.widthOfOneDigit*e.length*o:0)+(a==d?t.widthOfOneDigit*e.map(function(e){return t.formatter(e)}).join("").length:0)},E=function(e,i){if(null==i||0==i.length)return!1;i instanceof Array||(i=[i]);for(var a=0;a<i.length;a++)if(e!=i[a]&&0!=e&&Math.abs(n.scale()(e)-n.scale()(i[a]))<(z?t.heightOfOneDigit:(t.formatter(e).length+t.formatter(i[a]).length)*t.widthOfOneDigit/2))return!0;return!1};if("genericLog"==t.scaleType||"log"==t.scaleType){var O=n.scale().eps?n.scale().eps():0,T=b?[0]:[],P=v<O?[]:d3.range(Math.floor(e(Math.max(O,g))),Math.ceil(e(v)),1).concat(Math.ceil(e(v))).map(function(e){return Math.pow(t.logBase,e)}),D=g>-O?[]:d3.range(Math.floor(e(Math.max(O,-v))),Math.ceil(e(-g)),1).concat(Math.ceil(e(-g))).map(function(e){return-Math.pow(t.logBase,e)});if(null==t.method){var I=b?Math.max(Math.abs(v),Math.abs(g))/O:Math.max(Math.abs(v),Math.abs(g))/Math.min(Math.abs(v),Math.abs(g));t.method=10<=I&&I<=1024?this.METHOD_DOUBLING:this.METHOD_REPEATING}if(t.method==this.METHOD_DOUBLING){var C=[];b&&y.push(0);var A=[].concat(y),L=v<O?null:4*P[Math.floor(P.length/2)-1],R=g>-O?null:4*D[Math.floor(D.length/2)-1];if(L)for(var j=L;j<=v;j*=2)C.push(j);if(L)for(var j=L/2;j>=Math.max(g,O);j/=2)C.push(j);if(R)for(var j=R;j>=g;j*=2)C.push(j);if(R)for(var j=R/2;j<=Math.min(v,-O);j/=2)C.push(j);C=C.sort(d3.ascending).filter(function(t){return g<=t&&t<=v}),x=x.concat(C),C=a(C,!1);for(var N=y,F=0;F<C.length;F++){var B=N.concat(C[F]).filter(function(t){return!E(t,A)}).filter(i);if(!k(B,p,f,"none"))break;y=B}}if(t.method==this.METHOD_REPEATING){var q=T.concat(P).concat(D).sort(d3.ascending);t.stops.forEach(function(t,e){x=x.concat(q.map(function(e){return e*t}))}),q=a(q);var A=T.concat(y),H=!1;t.stops.forEach(function(e,n){if(0==n){for(var a=0;a<q.length;a++){var r=y.concat(q[a].map(function(t){return t*e})).filter(function(t){return!E(t,A)}).filter(function(t){return g<=t&&t<=v}).filter(i);if(!k(r,p,f,"none"))break;y=r}q=[].concat.apply([],q)}else{if(H)return;var r=y.concat(q.map(function(t){return t*e})).filter(function(t){return g<=t&&t<=v}).filter(i);if(!k(r,p,f,"log"))return void(H=!0);if(y.length>t.limitMaxTickNumber&&0!=t.limitMaxTickNumber)return void(H=!0);y=r}})}}if("linear"==t.scaleType||"time"==t.scaleType){b&&y.push(0);var A=[].concat(y);_=z?Math.max(Math.floor(p/(t.heightOfOneDigit+parseInt(t.cssMargin.top))),2):Math.max(Math.floor(p/M),2),0!=t.limitMaxTickNumber&&_>t.limitMaxTickNumber&&(_=t.limitMaxTickNumber);var Y=n.scale().ticks.apply(n.scale(),[_]).sort(d3.ascending).filter(function(t){return g<=t&&t<=v});x=x.concat(Y),Y=a(Y,!1);for(var N=y,F=0;F<Y.length;F++){var B=N.concat(Y[F]).filter(function(t){return!E(t,A)}).filter(i);if(!k(B,p,t.fitIntoScale,"none"))break;y=B}y=y.filter(function(t){return!E(t,A)}).filter(i)}return null!=y&&y.length<=2&&!b&&(y=[g,v]),null!=y&&y.length<=3&&b&&(y=E(0,[g,v])?[g,v]:[g,0,v]),null!=y&&y.sort(function(t,e){return(s==c?-1:1)*(n.scale()(e)-n.scale()(t))}),S&&(y=[]),x=x.filter(function(t){return y.indexOf(t)==-1&&g<=t&&t<=v}),o("final result",y),n.ticks(_).tickFormat(t.formatter).tickValues(y).tickValuesMinor(x).pivot(w).repositionLabels(r(y,t,s,n.scale(),z?"y":"x"))},n.copy=function(){return t(d3.svg.axis())},d3.rebind(n,e,"scale","orient","ticks","tickValues","tickFormat","tickSize","innerTickSize","outerTickSize","tickPadding","tickSubdivide")}(d3.svg.axis())}Object.defineProperty(e,"__esModule",{value:!0}),e.default=a;var r=i(1),s=n(r)},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),s=a(r),o=i(59),l=n(o),c=i(46),h=(n(c),l.default.extend({_important:!1,objectLeafs:["autogenerate"],dataConnectedChildren:["use","which"],getClassDefaults:function(){var t={data:"data",which:null};return s.deepExtend(this._super(),t)},buildScale:function(){},setInterModelListeners:function(){var t=this,e=this._parent.getSpace(this);s.forEach(e,function(e){t._space[e]=t.getClosestModel(e),t._space[e].on("dataConnectedChange",t.handleDataConnectedChange.bind(t))}),this.getClosestModel("locale").on("dataConnectedChange",this.handleDataConnectedChange.bind(this))},onSuccessfullLoad:function(){this.buildScale(),this._super()},setWhich:function(t){var e={which:t.concept};t.dataSource&&(e.data=t.dataSource);var i=this.getClosestModel(e.data||this.data),n=i.getConceptprops(t.concept);"_default"===t.which?e.use="constant":n.use&&(e.use=n.use),n.scales&&(e.scaleType=n.scales[0]),"axis"!==this.getType()&&"size"!==this.getType()||(e.domainMin=null,e.domainMax=null,e.zoomedMin=null,e.zoomedMax=null),this.set(e)},setScaleType:function(t){this.buildScale(t)},preloadData:function(){return this.dataSource=this.getClosestModel(this.data),this._super()},afterPreload:function(){this.autoGenerateModel()},autoGenerateModel:function(){null==this.which&&this.autogenerate&&(this.which=this.dataSource.getConceptByIndex(this.autogenerate.conceptIndex,this.autogenerate.conceptType).concept)},loadData:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this.which)return Promise.resolve();this.trigger("hook_change"),this.dataSource=this.getClosestModel(this.data);var e=this.getQuery(t.splashScreen);if(e===!0)return Promise.resolve();this._loadCall=!0,this.setReady(!1),s.timeStamp("Vizabi Model: Loading Data: "+this._id);var i=this._getAllParsers(),n=this.dataSource.load(e,i);return n.then(this.afterLoad.bind(this),function(t){return s.warn("Problem with query: ",t,JSON.stringify(e))}),n},handleDataConnectedChange:function(t){var e=this;s.defer(function(){e.startLoading().catch(s.warn)})},_isLoading:function(){return!this._loadedOnce||this._loadCall},afterLoad:function(t){this._dataId=t,s.timeStamp("Vizabi Model: Data loaded: "+this._id)},getQuery:function(t){var e,i,n,a,r;if(Object.keys(this._space).length<1)return s.error("Error:",this._id,"can't find the space"),!0;var o="property"===this.use||"constant"===this.use,l=o?{exceptType:"time"}:{},c=s.unique(this._getAllDimensions(l)),e=o&&c.length>1?[this.spaceRef?this._space[this.spaceRef].dim:this.which]:c;if(e=e.filter(function(t){return"_default"!==t}),!e||!e.length)return s.warn("getQuery() produced no query because no keys are available"),!0;if(n={key:e,value:e.indexOf(this.which)!=-1||"constant"===this.use?[]:[this.which]},r=this._getFirstDimension({type:"time"}),a=o?"entities":"datapoints",i=this._getAllFilters(l,t),o&&c.length>1){var h={};i[e]&&(h[e]=i[e]),i=h}var u={};if(Object.keys(i).length>0){u.$and=[];for(var d in i){var f={};f[d]=i[d],u.$and.push(f)}}var m=this._getAllJoins(l,t);if(o&&c.length>1){var p={};m["$"+e]&&(p["$"+e]=m["$"+e]),m=p}return{language:this.getClosestModel("locale").id,from:a,animatable:r,select:n,where:u,join:m,order_by:o?["rank"]:[this._space.time.dim]}},_getAllDimensions:function(t){return this._parent._getAllDimensions(t)},_getFirstDimension:function(t){return this._parent._getFirstDimension(t)},_getAllFilters:function(t,e){t=t||{};var i={},n=this;return s.forEach(this._space,function(a){if(t.exceptType&&a.getType()===t.exceptType)return!0;if(t.onlyType&&a.getType()!==t.onlyType)return!0;if(!a.skipFilter)if(s.arrayEquals(n._getAllDimensions(t),[a.getDimension()]))i=s.extend(i,a.getFilter(e));else{var r=a.getFilter(e);if(null!=r&&!s.isEmpty(r)){var o={};o[a.getDimension()]="$"+a.getDimension(),i=s.extend(i,o)}}}),i},_getAllJoins:function(t,e){var i={},n=this;return s.forEach(this._space,function(a){if(t.exceptType&&a.getType()===t.exceptType)return!0;if(t.onlyType&&a.getType()!==t.onlyType)return!0;if(s.arrayEquals(n._getAllDimensions(t),[a.getDimension()]))return!0;if(!a.skipFilter){var r=a.getFilter(e);null==r||s.isEmpty(r)||(i["$"+a.getDimension()]={key:a.getDimension(),where:a.getFilter(e)})}}),i},_getAllParsers:function(){function t(t){var i=t.getParser(),n=t.getDimensionOrWhich();i&&n&&(e[n]=i)}var e={};return s.forEach(this._space,function(e){t(e)}),t(this),e},getTickFormatter:function(){var t=this,e="share",i="percent";return function n(a,r,o,l){if(l=t.getConceptprops().format,l===e&&(a*=100),s.isDate(a))return t._space.time.formatDate(a);if("time"===t.scaleType&&!s.isDate(a))return t._space.time.formatDate(new Date(a));if(s.isString(a)||!a&&0!==a)return a;if(Math.abs(a)<1e-14)return"0";var n="r",c=3,h="";if(o)return d3.format("."+c+n)(a);switch(Math.floor(Math.log(Math.abs(a))/Math.LN10+1e-14)){case-13:a*=1e12,h="p";break;case-10:a*=1e9,h="n";break;case-7:a*=1e6,h="";break;case-6:a*=1e6,h="";break;case-5:a*=1e6,h="";break;case-4:break;case-3:break;case-2:break;case-1:break;case 0:break;case 1:break;case 2:break;case 3:break;case 4:a/=1e3,h="k";break;case 5:a/=1e3,h="k";break;case 6:a/=1e6,h="M";break;case 7:a/=1e6,h="M";break;case 8:a/=1e6,h="M";break;case 9:a/=1e9,h="B";break;case 10:a/=1e9,h="B";break;case 11:a/=1e9,h="B";break;case 12:a/=1e12,h="TR";break;case 13:a/=1e12,h="TR";break;case 14:a/=1e12,h="TR";break;default:return d3.format("."+c+"s")(a).replace("G","B")}var u=d3.format("."+c+n)(a);return u.indexOf(".")>-1&&(u=u.replace(/0+$/,"").replace(/\.$/,"")),u+h+(l===i||l===e?"%":"")}},getScale:function(){return null==this.scale&&console.warn("scale is null"),this.scale},getUnique:function(t){if(this.isHook())return t||(t=this._getFirstDimension({type:"time"})),this.dataSource.getData(this._dataId,"unique",t)},getData:function(){return this.dataSource.getData(this._dataId)},getValidItems:function(){return this.dataSource.getData(this._dataId,"valid",this.which)},getNestedItems:function(t){return t?this.dataSource.getData(this._dataId,"nested",t):s.warn("No keys provided to getNestedItems(<keys>)")},getHaveNoDataPointsPerKey:function(){return this.dataSource.getData(this._dataId,"haveNoDataPointsPerKey",this.which)},getLimits:function(t){return this.dataSource.getData(this._dataId,"limits",t)},getFrame:function(t,e,i){return this.dataSource.getFrame(this._dataId,t,e,i)},getFrames:function(t,e){return this.dataSource.getFrames(this._dataId,t,e)},getItems:function(){var t=this,e=this.spaceRef&&this._space[this.spaceRef]?this._space[this.spaceRef].dim:t._getFirstDimension({exceptType:"time"}),i={};return this.getValidItems().forEach(function(n){i[n[e]]=n[t.which]}),i},getLimitsByDimensions:function(t){var e=this.dataSource.getData(this._dataId,"nested",t),i={},n=this.which,a=function(t,e,i){for(var a,r,o=t.reduce(function(t,e){var i=s.isDate(e[n])?e[n]:parseFloat(e[n]);return isNaN(i)||t.push(i),t},[]),l={},c=0;c<o.length;c+=1){var h=o[c];("undefined"==typeof a||h<a)&&(a=h),("undefined"==typeof r||h>r)&&(r=h)}l.min=a||0,l.max=r||100,e[i]=l},r=function t(e,i,n,a){i--,s.forEach(e,function(e,r){i?(n[r]={},t(e,i,n[r],a)):a(e,n,r)})};return r(e,t.length,i,a),i},getConceptprops:function(){return"constant"!==this.use&&this.dataSource?this.dataSource.getConceptprops(this.which):{}},isDiscrete:function(){return"ordinal"===this.scaleType},validate:function(){this._super();var t=this.getConceptprops().scales;t&&t.length>0&&!t.includes(this.scaleType)&&this.set({scaleType:"nominal"===t[0]?"ordinal":t[0]},null,!1)},getEntity:function(){return this._space[this.spaceRef?this.spaceRef:this._parent.getSpace()[0]]}}));e.default=h},function(t,e,i){var n=i(57)("meta"),a=i(6),r=i(15),s=i(9).f,o=0,l=Object.isExtensible||function(){return!0},c=!i(5)(function(){return l(Object.preventExtensions({}))}),h=function(t){s(t,n,{value:{i:"O"+ ++o,w:{}}})},u=function(t,e){if(!a(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!r(t,n)){if(!l(t))return"F";if(!e)return"E";h(t)}return t[n].i},d=function(t,e){if(!r(t,n)){if(!l(t))return!0;if(!e)return!1;h(t)}return t[n].w},f=function(t){return c&&m.NEED&&l(t)&&!r(t,n)&&h(t),t},m=t.exports={KEY:n,NEED:!1,fastKey:u,getWeak:d,onFreeze:f}},function(t,e){t.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},function(t,e){var i=Math.ceil,n=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?n:i)(t)}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={ext_resources:{},build:1486038988752,version:"0.18.4-3"}},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function r(t){d=!0,t&&(c.isArray(t)||(t=[t]),c.forEach(t,function(t){m[t]=!0}))}function s(){d=!1,m={};for(var t=Object.keys(f),e=0;e<t.length;e++){var i=f[t[e]];i&&i.unfreeze()}f={}}Object.defineProperty(e,"__esModule",{value:!0}),e.ChangeEvent=e.DefaultEvent=void 0;var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},l=i(1),c=a(l),h=i(21),u=n(h),d=!1,f=[],m={},p=e.DefaultEvent=u.default.extend({source:"",type:"default",init:function(t,e){this.source=t,e&&(this.type=e)}}),g=(e.ChangeEvent=p.extend("change",{type:"change",init:function(t){this._super(t)}}),u.default.extend({init:function(){this._id=this._id||c.uniqueId("e"),this._events={},this._freeze=!1,this._freezer=[],this._freezeExceptions={}},on:function(t,e,i){if(!this.splitEventParameters(t,e,i,this.on)){var n=this.traversePath(e);n&&(n._events[t]=n._events[t]||[],"function"==typeof i?n._events[t].push(i):c.warn("Can't bind event '"+t+"'. It must be a function."))}},off:function(t,e,i){if(0==arguments.length)return void(this._events={});if(!this.splitEventParameters(t,e,i,this.off)){var n=this.traversePath(e);if(n&&n._events.hasOwnProperty(t)){if("undefined"==typeof i)return void(n._events[t]=[]);var a=n._events[t].indexOf(i);a>-1?n._events[t].splice(a,1):c.warn("Could not unbind function "+i.name+". Function not in bound function list.")}}},splitEventParameters:function(t,e,i,n){var a;if(c.isArray(t)){for(a=0;a<t.length;a+=1)n.call(this,t[a],i);return!0}if(c.isObject(t)){for(a in t)n.call(this,a,t[a]);return!0}if("function"==typeof e){if(i=e,t.indexOf(":")!==-1){var r=t.split(":");t=r[0],e=r[1]}else e=void 0;return n.call(this,t,e,i),!0}if(c.isArray(e)){for(a=0;a<e.length;a+=1)n.call(this,t,e[a],i);return!0}if(i&&c.isArray(i)){for(a=0;a<i.length;a+=1)n.call(this,t,e,i[a]);return!0}return!1},traversePath:function(t){if("undefined"==typeof t||c.isArray(t)&&0==t.length)return this;if("string"==typeof t&&(t=t.split(".")),!c.isArray(t))return c.error("Path is wrong type. Path should be a string or array but is "+("undefined"==typeof t?"undefined":o(t))+"."),null;var e=t.shift();return void 0!==this[e]?this.getModelObject(e).traversePath(t):void c.warn("Can't find child \""+e+'" of the model '+this._name+".")},createEventFromType:function(t){if(t instanceof p)return t;var e=p.get(t,!0);return e?new e(this):new p(this,t)},trigger:function(t,e){var i,n,a=this;if(c.isArray(t))for(i=0,n=t.length;i<n;i+=1)this.trigger(t[i],e);else{var r=this.createEventFromType(t);if(this._events.hasOwnProperty(r.type)){var s=this;c.forEach(this._events[r.type],function(t){var i=function(){var i="Vizabi Event: "+r.type;c.timeStamp(i),t.apply(s,[r,e])};a.allowExecution(r)?i():(a._freezer.push(i),d&&!f[a._id]&&(a.freeze(),f[a._id]=a))})}}},allowExecution:function(t){return!this._freeze&&!d||d&&m.hasOwnProperty(t.type)||!d&&this._freeze&&this._freezeExceptions.hasOwnProperty(t.type)},freeze:function(t){if(this._freeze=!0,t){c.isArray(t)||(t=[t]);for(var e=0;e<t.length;e+=1)this._freezeExceptions[t[e]]=!0}},unfreeze:function(){for(this._freeze=!1,this._freezeExceptions={};this._freezer.length;){var t=this._freezer.shift();t()}},clearFrozen:function(){this._freeze=!1,this._freezeExceptions={},this._freezer=[]}}));g.freezeAll=r,g.unfreezeAll=s,e.default=g},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function r(t,e){Object.defineProperty(t,e,{configurable:!0,get:function(e){return function(){return t.get(e)}}(e),set:function(e){return function(i){return t.set(e,i)}}(e)})}function s(t,e,n,a){function r(t,e){n._ready&&(e=n._name+"."+e,n.trigger(t,e))}function s(t,e){n.trigger(t,e)}function o(t,e){n.setReady(!1),c.defer(function(){n.setReady()})}var l;if(!c.isPlainObject(e)||c.isArray(e)||n.isObjectLeaf(t)){var h={change:r};l=new m(t,e,n,h,a)}else{var h={change:r,hook_change:s,load_error:function(){return n.trigger.apply(n,arguments)},ready:o};if(p.isModel(e,!0))l=e,l.on(h);else{var u=t.split("_")[0],d=p.get(u,!0);if(!d)try{d=i(460)("./"+u).default}catch(t){d=p}l=new d(t,e,n,h)}}return l}function o(t){return t._intervals?t._intervals:t._parent?o(t._parent):new f.default}Object.defineProperty(e,"__esModule",{value:!0});var l=i(1),c=a(l),h=i(46),u=n(h),d=i(209),f=n(d),m=u.default.extend({_name:"",_parent:null,_persistent:!0,init:function(t,e,i,n,a){Object.defineProperty(this,"value",{get:this.get,set:this.set}),Object.defineProperty(this,"persistent",{get:function(){return this._persistent}}),this._super(),this._name=t,this._parent=i,this._root=i._root,this.set(e,!1,a),this.on(n)},get:function(t){return t&&!this._persistent?this._persistentVal:this._val},set:function(t,e,i){return!!this.isSetAllowed(t,e)&&(i="undefined"==typeof i||i,i&&(this._persistentVal=t),this._previousVal=c.deepClone(this._val),this._val=t,this._persistent=i,this.trigger(new h.ChangeEvent(this),this._name),!0)},isSetAllowed:function(t,e){return e||this._val!==t&&JSON.stringify(this._val)!==JSON.stringify(t)},setTreeFreezer:function(t){t?this.freeze(["hook_change"]):this.unfreeze()}}),p=u.default.extend({getClassDefaults:function(){return{}},objectLeafs:[],init:function(t,e,i,n){this._type=this._type||"model",this._id=this._id||c.uniqueId("m"),this._data={},this._parent=i,this._root=i?i._root:this,this._name=t,this._ready=!1,this._readyOnce=!1,this._loadedOnce=!1,this._intervals=o(this),this._space={},this._dataId=!1,this._limits={},this._super();var a=c.deepExtend({},this.getClassDefaults(),e);this.set(a),n&&this.on(n)},get:function(t){return t?p.isModel(this._data[t])?this._data[t]:this._data[t].value:this._data},set:function(t,e,i,n){var a,o=this._setting,l=!1;if(c.isPlainObject(t)?(a=t,n=i,i=e):(a={})[t]=e,0!==Object.keys(a).length){this._setting=!0,this._freeze||(l=!0,this.setTreeFreezer(!0));var h=[];for(var u in a){e=a[u];var d=c.isPlainObject(e)&&this._data[u]instanceof p,f=(!c.isPlainObject(e)||this.isObjectLeaf(u))&&this._data[u]instanceof m;if(this._data[u]&&(d||f)){var g=this._data[u].set(e,i,n);f&&g&&h.push(u)}else this._data[u]=s(u,e,this,n),r(this,u)}o||(this.checkDataChanges(h),this.validate&&this.validate()),o&&!i||(this._setting=!1,!l||this.isHook()&&this.isLoading()||this.setTreeFreezer(!1),this.isHook()||this.isLoading()||this.setReady())}},checkDataChanges:function(){},setTreeFreezer:function(t){c.forEach(this._data,function(e){e.setTreeFreezer(t)}),t?this.freeze(["hook_change"]):this.unfreeze()},getType:function(){return this._type},getSubmodels:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments[1],i=t?{}:[],e=e||function(){return!0};return c.forEach(this._data,function(n,a){n&&"undefined"!=typeof n._id&&p.isModel(n)&&e(n)&&(t?i[a]=n:i.push(n))}),i},getPlainObject:function(t){var e={},i=this;return c.forEach(this._data,function(n,a){if(n instanceof p)e[a]=n.getPlainObject(t);else if(!t||n.persistent){var r=n.get(t);c.isDate(r)&&(r=i.formatDate(r)),e[a]=r}}),e},formatDate:function(t){return t.toString()},getModelObject:function(t){return t?this._data[t]:this},clear:function(){var t=this.getSubmodels();for(var e in t)t[e].clear();this.setReady(!1),this.off(),this._intervals.clearAllIntervals(),this._data={}},validate:function(){},_isLoading:function(){return!1},isLoading:function(){if(this._isLoading())return!0;var t,e=this.getSubmodels();for(t=0;t<e.length;t+=1)if(e[t].isLoading())return!0;return!1},setReady:function(t){if(t===!1)return this._ready=!1,void(this._parent&&this._parent.setReady&&this._parent.setReady(!1));var e=this._ready;this._ready=!this.isLoading()&&!this._setting,this._ready&&e!==this._ready&&(this._readyOnce||(this._readyOnce=!0,this.trigger("readyOnce")),this.trigger("ready"))},setInterModelListeners:function(){c.forEach(this.getSubmodels(),function(t){return t.setInterModelListeners()})},startPreload:function(){var t=[];return t.push(this.preloadData()),c.forEach(this.getSubmodels(),function(e){return t.push(e.startPreload())}),Promise.all(t)},preloadData:function(){return Promise.resolve()},startLoading:function(t){var e=[];return e.push(this.loadData(t)),c.forEach(this.getSubmodels(),function(i){return e.push(i.startLoading(t))}),Promise.all(e).then(this.onSuccessfullLoad.bind(this))},loadData:function(t){return this.isHook()&&c.warn("Hook "+this._name+" is not loading because it's not extending Hook prototype."),Promise.resolve()},loadSubmodels:function(t){var e=[],i=this.getSubmodels();return c.forEach(i,function(i){e.push(i.startLoading(t))}),e.length>0?Promise.all(e):Promise.resolve()},onSuccessfullLoad:function(){var t=this;this.validate(),c.timeStamp("Vizabi Model: Model loaded: "+this._name+"("+this._id+")"),this._loadedOnce=!0,this._loadCall=!1,this.setTreeFreezer(!1),c.defer(function(){return t.setReady()})},triggerLoadError:function(t){c.error(t),this.trigger("load_error",t)},afterPreload:function(){var t=this.getSubmodels();c.forEach(t,function(t){t.afterPreload()})},isHook:function(){return!!this.use},getSubhooks:function(t){return this.getSubmodels(t,function(t){return t.isHook()})},getHookWhich:function(t){var e=[];return this.use&&this.use===t&&e.push(this.which),c.forEach(this.getSubmodels(),function(i){e=c.unique(e.concat(i.getHookWhich(t)))}),e},getIndicators:function(){return this.getHookWhich("indicator")},getProperties:function(){return this.getHookWhich("property")},getDimension:function(){return this.dim||!1},getDimensionOrWhich:function(){return this.dim||"constant"!=this.use&&this.which},getFilter:function(){return{}},mapValue:function(t){return t},getParser:function(){return null},getDefaults:function(){return c.deepExtend({},this.getClassDefaults(),this.getSubmodelDefaults())},getSubmodelDefaults:function(){var t={};return c.forEach(this.getSubmodels(!0),function(e,i){t[i]=e.getDefaults()}),t},isObjectLeaf:function(t){return this.objectLeafs.indexOf(t)!==-1},getClosestModel:function(t){var e=this.findSubmodel(t);return e?e:this._parent?this._parent.getClosestModel(t):null},findSubmodel:function(t){for(var e in this._data)if(e===t&&p.isModel(this._data[e]))return this._data[e];return null}});p.isModel=function(t,e){return t&&(t.hasOwnProperty("_data")||e&&t.hasOwnProperty("_val"))},e.default=p},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),s=a(r),o=i(2),l=n(o),c=i(10),h=l.default.extend({init:function(t,e){this.name="gapminder-indicatorpicker",this.template='<span class="vzb-ip-holder"><span class="vzb-ip-select"></span><span class="vzb-ip-info"></span></span>';var i=this;this.model_expects=[{name:"time",type:"time"},{name:"entities",type:"entities"},{name:"marker",type:"model"},{name:"locale",type:"locale"}],this.markerID=t.markerID,this.showHoverValues=t.showHoverValues||!1,t.markerID||s.warn("indicatorpicker.js complains on 'markerID' property: "+t.markerID),this.model_binds={"translate:locale":function(t){i.updateView()},ready:function(t){i.updateView()}},this.markerID&&(this.model_binds["change:marker."+this.markerID+".which"]=function(t){i.updateView()}),this.showHoverValues&&(this.model_binds["change:marker.highlight"]=function(t,e){var n=i.model.marker[i.markerID];if(i.showHoverValues&&"constant"!=n.use){var a=i.model.marker.getHighlighted();a.length>1||(a.length?i.model.marker.getFrame(i.model.time.value,function(t){if(!i._highlighted&&t){var e=i.model.entities.getDimension(),a=i.model.marker.getHighlighted(e);if(a.length){var r=t[i.markerID][a[0]];if(r&&"color"===n._type&&n.isDiscrete()){var s=n.getColorlegendMarker();s.label.getItems()[r]&&(r=s.label.getItems()[r])}i._highlightedValue=r,i._highlighted=!i._highlightedValue&&0!==i._highlightedValue||"constant"!==n.use,i.updateView()}}}):(null!==e&&"highlight"!==e?e&&(i._highlightedValue=e[i.markerID],i._highlighted=!i._highlightedValue&&0!==i._highlightedValue||"constant"!==n.use):i._highlighted=!1,i.updateView()))}}),this._super(t,e)},ready:function(){this.updateView()},readyOnce:function(){var t=this;this.el_select=d3.select(this.element).select(".vzb-ip-select"),this.el_select.on("click",function(){var e=t.el_select.node().getBoundingClientRect(),i=t.root.element instanceof Array?t.root.element:d3.select(t.root.element),n=i.node().getBoundingClientRect(),a=t.root.findChildByName("gapminder-treemenu"),r=a.activeProfile.col_width,s=parseInt(a.wrapper.style("padding-left"),10)||0,o=parseInt(a.wrapper.style("padding-right"),10)||0,l=e.bottom-n.top,c=e.left-n.left-.5*(s+o+r-e.width);a.markerID(t.markerID).alignX("left").alignY("top").top(l).left(c).updateView().toggle()}),this.infoEl=d3.select(this.element).select(".vzb-ip-info"),s.setIcon(this.infoEl,c.question).select("svg").attr("width","0px").attr("height","0px"),this.infoEl.on("click",function(){t.root.findChildByName("gapminder-datanotes").pin()}),this.infoEl.on("mouseover",function(){var e=t.el_select.node().getBoundingClientRect(),i=t.root.element.getBoundingClientRect(),n=e.bottom-i.top,a=e.left-i.left+e.width;t.root.findChildByName("gapminder-datanotes").setHook(t.markerID).show().setPos(a,n)}),this.infoEl.on("mouseout",function(){t.root.findChildByName("gapminder-datanotes").hide()})},updateView:function(){if(this._readyOnce){var t,e=this,i=this.model.locale.getTFunction(),n=this.model.marker[this.markerID].which,a=this.model.marker[this.markerID]._type,r=this.model.marker[this.markerID].getConceptprops();if(this.showHoverValues&&this._highlighted){var s=r.unit?" "+r.unit:"",o=e.model.marker[this.markerID].getTickFormatter();t=this._highlightedValue||0===this._highlightedValue?o(this._highlightedValue)+s:i("hints/nodata")}else t="_default"===n?i("indicator/_default/"+a):r.name;this.el_select.text(t);var l=!r.description&&!r.sourceName&&!r.sourceLink;this.infoEl.classed("vzb-hidden",l)}}});e.default=h},function(t,e){t.exports=function(t,e,i,n){if(!(t instanceof e)||void 0!==n&&n in t)throw TypeError(i+": incorrect invocation!");return t}},function(t,e){t.exports=!1},function(t,e,i){var n=i(3),a=i(167),r=i(92),s=i(104)("IE_PROTO"),o=function(){},l="prototype",c=function(){var t,e=i(91)("iframe"),n=r.length,a="<",s=">";for(e.style.display="none",i(94).appendChild(e),e.src="javascript:",t=e.contentWindow.document,t.open(),t.write(a+"script"+s+"document.F=Object"+a+"/script"+s),t.close(),c=t.F;n--;)delete c[l][r[n]];return c()};t.exports=Object.create||function(t,e){var i;return null!==t?(o[l]=n(t),i=new o,o[l]=null,i[s]=t):i=c(),void 0===e?i:a(i,e)}},function(t,e,i){var n=i(169),a=i(92).concat("length","prototype");e.f=Object.getOwnPropertyNames||function(t){return n(t,a)}},function(t,e,i){var n=i(169),a=i(92);t.exports=Object.keys||function(t){return n(t,a)}},function(t,e,i){var n=i(18);t.exports=function(t,e,i){for(var a in e)n(t,a,e[a],i);return t}},function(t,e,i){"use strict";var n=i(4),a=i(9),r=i(8),s=i(7)("species");t.exports=function(t){var e=n[t];r&&e&&!e[s]&&a.f(e,s,{configurable:!0,get:function(){return this}})}},function(t,e,i){var n=i(44),a=Math.max,r=Math.min;t.exports=function(t,e){return t=n(t),t<0?a(t+e,0):r(t,e)}},function(t,e){var i=0,n=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++i+n).toString(36))}},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var a=i(2),r=n(a);e.default=r.default.extend({init:function(t,e){this.template='<span class="vzb-sc-holder vzb-dialog-checkbox"><input type="checkbox"><label></label></span>';var i=this;this.name="gapminder-simplecheckbox",this.checkbox=t.checkbox,this.submodel=t.submodel,this.model_expects=[{name:"mdl"},{name:"locale",type:"locale"}],this.model_binds={"change:mdl":function(t){i.updateView()},"translate:locale":function(t){i.updateView()}};var n=this.submodel?this.submodel+":":"";this.model_binds["change:mdl."+n+this.checkbox]=function(){i.updateView()},this._super(t,e)},ready:function(){this.parentModel=this.submodel?this.model.mdl[this.submodel]:this.model.mdl,this.updateView()},readyOnce:function(){var t=this;this.element=d3.select(this.element);var e="-check-"+t._id;this.labelEl=this.element.select("label").attr("for",e),this.checkEl=this.element.select("input").attr("id",e).on("change",function(){t._setModel(d3.select(this).property("checked"))})},updateView:function(){this.translator=this.model.locale.getTFunction(),this.labelEl.text(this.translator("check/"+this.checkbox)),this.checkEl.property("checked",!!this.parentModel[this.checkbox])},_setModel:function(t){this.parentModel[this.checkbox]=t}})},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),s=a(r),o=i(47),l=n(o),c=i(46),h=(n(c),l.default.extend({dataConnectedChildren:[],checkDataChanges:function(t){var e=this;if(t&&this.dataConnectedChildren&&(!s.isArray(t)&&s.isObject(t)&&(t=Object.keys(t)),0!=t.length&&0!=this.dataConnectedChildren.length)){var i=t.filter(function(t){return e.dataConnectedChildren.indexOf(t)!==-1});i.length>0&&(this.trigger("dataConnectedChange"),this.startLoading())}}}));e.default=h},function(t,e,i){var n=i(7)("unscopables"),a=Array.prototype;void 0==a[n]&&i(17)(a,n,{}),t.exports=function(t){a[n][t]=!0}},function(t,e,i){var n=i(36),a=i(163),r=i(96),s=i(3),o=i(12),l=i(113),c={},h={},e=t.exports=function(t,e,i,u,d){var f,m,p,g,v=d?function(){return t}:l(t),b=n(i,u,e?2:1),y=0;if("function"!=typeof v)throw TypeError(t+" is not iterable!");if(r(v)){for(f=o(t.length);f>y;y++)if(g=e?b(s(m=t[y])[0],m[1]):b(t[y]),g===c||g===h)return g}else for(p=v.call(t);!(m=p.next()).done;)if(g=a(p,b,m.value,e),g===c||g===h)return g};e.BREAK=c,e.RETURN=h},function(t,e){t.exports={}},function(t,e,i){var n=i(9).f,a=i(15),r=i(7)("toStringTag");t.exports=function(t,e,i){t&&!a(t=i?t:t.prototype,r)&&n(t,r,{configurable:!0,value:e})}},function(t,e,i){var n=i(0),a=i(29),r=i(5),s=i(109),o="["+s+"]",l="",c=RegExp("^"+o+o+"*"),h=RegExp(o+o+"*$"),u=function(t,e,i){var a={},o=r(function(){return!!s[t]()||l[t]()!=l}),c=a[t]=o?e(d):s[t];i&&(a[i]=c),n(n.P+n.F*o,"String",a)},d=u.trim=function(t,e){return t=String(a(t)),1&e&&(t=t.replace(c,"")),
2&e&&(t=t.replace(h,"")),t};t.exports=u},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function a(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var r=i(2),s=a(r),o=i(1),l=n(o),c=s.default.extend({init:function(t,e){this.template='<div class="vzb-ss-holder"><input type="range" class="vzb-ss-slider vzb-ss-slider-normal" step="1"></div>',this.model_expects=[{name:"submodel"}];var i=this;this.name="gapminder-simpleSlider",this.arg=t.arg,this.thumb_size=t.thumb_size,this.slider_properties=t.properties,this.model_binds={},this.model_binds["change:submodel."+this.arg]=function(t){i.updateView()},this._super(t,e),this._setModel=l.throttle(this._setModel,50)},readyOnce:function(){var t=0,e=1,i=.1,n=t,a=this;this.element=d3.select(this.element),this.slider=this.element.selectAll(".vzb-ss-slider"),this.elementSize=this.element.node().getBoundingClientRect(),this.sliderSize=this.slider.node().getBoundingClientRect(),this.slider.style("left",this.elementSize.left-this.sliderSize.left+"px"),this.slider_properties&&(null!=this.slider_properties.min&&(t=this.slider_properties.min),null!=this.slider_properties.max&&(e=this.slider_properties.max),null!=this.slider_properties.step&&(i=this.slider_properties.step),this.slider_properties.scale&&(n=this.slider_properties.scale(t))),this.roundTo=i>1?0:Math.round(Math.abs(Math.log(i)/Math.LN10)),this.thumb_size&&(this.slider.classed("vzb-ss-slider-normal",!1),this.slider.classed("vzb-ss-slider-"+this.thumb_size,!0)),this.slider.attr("min",t).attr("max",e).attr("step",i).attr("value",n).on("input",function(){var t=+d3.event.target.value;a._setModel(t,!1,!1)}).on("change",function(){var t=+d3.event.target.value;a._setModel(t,!0)}),this.updateView()},updateView:function(){var t,e=this.model.submodel[this.arg],i=this.slider_properties;i&&(t=i.scale),t&&(e=t.invert(e)),this.slider.node().value=e},_setModel:function(t,e,i){this.slider_properties&&this.slider_properties.scale&&(t=this.slider_properties.scale(t)),this.model.submodel.getModelObject(this.arg).set(t.toFixed(this.roundTo),e,i)}});e.default=c},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){var i=[],n=!0,a=!1,r=void 0;try{for(var s,o=t[Symbol.iterator]();!(n=(s=o.next()).done)&&(i.push(s.value),!e||i.length!==e);n=!0);}catch(t){a=!0,r=t}finally{try{!n&&o.return&&o.return()}finally{if(a)throw r}}return i}return function(e,i){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),r=i(21),s=n(r);e.default=s.default.extend({init:function(t,e){this.context=t,this.width=0,this.height=0,this.topOffset=0,this.leftOffset=0,this.bottomOffset=0,this.rightOffset=0,this.textWidth=0,this.textHeight=0,this.widthRatio=.9,this.heightRatio=.9,this.xAlign="center",this.yAlign="center",this.element=this.context.append("text").style("font-size","20px"),this.element.text("0"),this.letterBBox=this.element.node().getBBox(),this.element.text(""),e&&this.setConditions(e)},setConditions:function(t){return!isNaN(parseFloat(t.rightOffset))&&isFinite(t.rightOffset)&&(this.rightOffset=t.rightOffset),!isNaN(parseFloat(t.leftOffset))&&isFinite(t.leftOffset)&&(this.leftOffset=t.leftOffset),!isNaN(parseFloat(t.topOffset))&&isFinite(t.topOffset)&&(this.topOffset=t.topOffset),!isNaN(parseFloat(t.bottomOffset))&&isFinite(t.bottomOffset)&&(this.bottomOffset=t.bottomOffset),t.xAlign&&(this.xAlign=t.xAlign),t.yAlign&&(this.yAlign=t.yAlign),!isNaN(parseFloat(t.widthRatio))&&t.widthRatio>0&&t.widthRatio<=1&&(this.widthRatio=t.widthRatio),!isNaN(parseFloat(t.heightRatio))&&t.heightRatio>0&&t.heightRatio<=1&&(this.heightRatio=t.heightRatio),this},resize:function(t,e,i,n){var r=[t,e].map(function(t){return Number(String(t).replace("px",""))}),s=a(r,2);this.width=s[0],this.height=s[1],i&&(this.topOffset=i),n&&(this.leftOffset=n),this._resizeText()},setText:function(t,e){var i=this;return setTimeout(function(){i.element.selectAll("tspan").remove(),t.split("").forEach(function(e,n){i.element.append("tspan").text(e).attr("x",(n-t.length/2)*i.letterBBox.width+i.letterBBox.width/2)}),i._resizeText()},e),this},_resizeText:function(){var t={};if(t.height=this.element.node().getBBox().height,t.width=this.letterBBox.width*this.element.text().length,!(t.width&&t.height&&this.width&&this.height))return this;var e=this.width*this.widthRatio/t.width,i=this.height*this.heightRatio/t.height;switch(this.scalar=e<i?e:i,this.element.attr("transform","scale("+this.scalar+")"),this.textHeight=t.height*this.scalar,this.textWidth=t.width*this.scalar,this.yAlign){case"bottom":this.context.select("text").attr("dy",".325em");break;case"center":this.context.select("text").attr("dy",".325em");break;case"top":this.context.select("text").attr("dy","0")}return this.context.attr("transform","translate("+this._getLeftOffset()+","+this._getTopOffset()+")"),this},_getLeftOffset:function(){switch(this.xAlign){case"right":return this.width-this.textWidth/2-this.rightOffset;case"left":return this.textWidth/2+this.leftOffset;default:return this.width/2}},_getTopOffset:function(){switch(this.yAlign){case"top":return this.textHeight/2+this.topOffset;case"bottom":return this.height-this.textHeight/2-this.bottomOffset;default:return this.height/2}}})},function(t,e,i){var n=i(28),a=i(7)("toStringTag"),r="Arguments"==n(function(){return arguments}()),s=function(t,e){try{return t[e]}catch(t){}};t.exports=function(t){var e,i,o;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(i=s(e=Object(t),a))?i:r?n(e):"Object"==(o=n(e))&&"function"==typeof e.callee?"Arguments":o}},function(t,e,i){var n=i(28);t.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==n(t)?t.split(""):Object(t)}},function(t,e){e.f={}.propertyIsEnumerable},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(t){return t.match(/\//g).length},n=function(t,e){var n=t.keys();return e&&(n=n.filter("function"==typeof e?function(t){return e(i(t))}:function(t){return i(t)===e+1})),n.reduce(function(e,i){var n=/([^\/]+)\..+$/.exec(i)[1];try{var a=t(i);e[n]=a.default||a}catch(t){console.warn("Import error",i,t)}return e},{})};e.default=n},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s=function(){function t(t,e){var i=[],n=!0,a=!1,r=void 0;try{for(var s,o=t[Symbol.iterator]();!(n=(s=o.next()).done)&&(i.push(s.value),!e||i.length!==e);n=!0);}catch(t){a=!0,r=t}finally{try{!n&&o.return&&o.return()}finally{if(a)throw r}}return i}return function(e,i){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=i(1),l=a(o),c=i(21),h=n(c),u=h.default.extend({QUERY_FROM_CONCEPTS:"concepts",QUERY_FROM_DATAPOINTS:"datapoints",QUERY_FROM_ENTITIES:"entities",CONDITION_CALLBACKS:{$gt:function(t,e){return e>t},$gte:function(t,e){return e>=t},$lt:function(t,e){return e<t},$lte:function(t,e){return e<=t},$in:function(t,e){return t.includes(e)}},ERRORS:{GENERIC_ERROR:"reader/error/generic"},_name:"reader",load:function(){return Promise.resolve({data:[],columns:[]})},read:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t=this._normalizeQuery(t,i);var n=t,a=n.select,r=n.from,o=n.order_by,l=void 0===o?[]:o,c=s(l,1),h=c[0];return this.load().then(function(n){var s=n.data,o=n.columns;switch(e.ensureDataIsCorrect(n,i),!0){case r===e.QUERY_FROM_CONCEPTS:return e._getConcepts(o,s.map(e._getRowMapper(t,i)));case e._isDataQuery(r)&&a.key.length>0:return s.reduce(e._applyQuery(t,i),[]).sort(function(t,e){return t[h]-e[h]});default:return[]}}).catch(function(t){throw"[object Error]"==={}.toString.call(t)?e.error(e.ERRORS.GENERIC_ERROR,t):t})},ensureDataIsCorrect:function(){},_normalizeQuery:function(t,e){var i=Object.assign({},t),n=i.where,a=i.join;return n.$and&&(n.$and=n.$and.reduce(function(t,i){return Object.keys(i).forEach(function(n){var s=i[n];if("string"==typeof s&&s.startsWith("$"))!function(){var i=a[s].where;Object.keys(i).forEach(function(n){var a=i[n],s=e[n];t[n]=s?"object"===("undefined"==typeof a?"undefined":r(a))?Object.keys(a).reduce(function(t,e){return t[e]=s(a[e]),t},{}):s(a):a})}();else{var o=e[n];t[n]=o?o(s):s}}),t},{})),i},_getConcepts:function(t,e){var i=this;return t.map(function(n,a){var r={concept:n};if(a<i.keySize)r.concept_type="entity_domain";else if(a===i.keySize)r.concept_type="time";else{r.concept_type="measure";for(var o=e.length-1;o>=0;o--)if(l.isString(e[o][n])&&""!==e[o][n]){r.concept_type="entity_set";var c=s(t,1);r.domain=c[0];break}}return r})},_isDataQuery:function(t){return[this.QUERY_FROM_DATAPOINTS,this.QUERY_FROM_ENTITIES].includes(t)},_getRowMapper:function(t,e){var i=t.select;return function(t){var n=!0,a=Object.keys(t).reduce(function(a,r){if(n){var s=t[r],o=e[r],l=void 0;if(o)l=o(s);else{var c=parseFloat(s);l=!isNaN(c)&&isFinite(c)?parseFloat(s.replace(",",".")):s}l||0===l?a[r]=l:i.key.includes(r)&&(n=!1)}return a},{});return n&&a}},_applyQuery:function(t,e){var i=this,n=t.select,a=t.from,r=s(n.key,1),o=r[0],l=[],c=this._getRowMapper(t,e);return function(e,r){if(r=c(r)){var s=r[o],h=a!==i.QUERY_FROM_ENTITIES||!l.includes(s),u=i._isSuitableRow(t,r);if(u&&h){a===i.QUERY_FROM_ENTITIES&&l.push(s);var d=Object.keys(r).reduce(function(t,e){return(n.key.includes(e)||n.value.includes(e))&&(t[e]=r[e]),t},{});e.push(d)}}return e}},_isSuitableRow:function(t,e){var i=this,n=t.where;return!n.$and||Object.keys(n.$and).every(function(t){var a=n.$and[t],s=e[t];return void 0===s||("object"!==("undefined"==typeof a?"undefined":r(a))?s===a||a===!0&&l.isString(s)&&"true"===s.toLowerCase().trim()||a===!1&&l.isString(s)&&"false"===s.toLowerCase().trim():Object.keys(a).every(function(t){return i.CONDITION_CALLBACKS[t](a[t],s)}))})},error:function(t,e,i){return{code:t,message:e,payload:i}}});e.default=u},function(t,e,i){var n=i(20),a=i(12),r=i(56);t.exports=function(t){return function(e,i,s){var o,l=n(e),c=a(l.length),h=r(s,c);if(t&&i!=i){for(;c>h;)if(o=l[h++],o!=o)return!0}else for(;c>h;h++)if((t||h in l)&&l[h]===i)return t||h||0;return!t&&-1}}},function(t,e,i){"use strict";var n=i(4),a=i(0),r=i(18),s=i(54),o=i(42),l=i(61),c=i(49),h=i(6),u=i(5),d=i(78),f=i(63),m=i(95);t.exports=function(t,e,i,p,g,v){var b=n[t],y=b,x=g?"set":"add",_=y&&y.prototype,M={},w=function(t){var e=_[t];r(_,t,"delete"==t?function(t){return!(v&&!h(t))&&e.call(this,0===t?0:t)}:"has"==t?function(t){return!(v&&!h(t))&&e.call(this,0===t?0:t)}:"get"==t?function(t){return v&&!h(t)?void 0:e.call(this,0===t?0:t)}:"add"==t?function(t){return e.call(this,0===t?0:t),this}:function(t,i){return e.call(this,0===t?0:t,i),this})};if("function"==typeof y&&(v||_.forEach&&!u(function(){(new y).entries().next()}))){var z=new y,S=z[x](v?{}:-0,1)!=z,k=u(function(){z.has(1)}),E=d(function(t){new y(t)}),O=!v&&u(function(){for(var t=new y,e=5;e--;)t[x](e,e);return!t.has(-0)});E||(y=e(function(e,i){c(e,y,t);var n=m(new b,e,y);return void 0!=i&&l(i,g,n[x],n),n}),y.prototype=_,_.constructor=y),(k||O)&&(w("delete"),w("has"),g&&w("get")),(O||S)&&w(x),v&&_.clear&&delete _.clear}else y=p.getConstructor(e,t,g,x),s(y.prototype,i),o.NEED=!0;return f(y,t),M[t]=y,a(a.G+a.W+a.F*(y!=b),M),v||p.setStrong(y,t,g),y}},function(t,e,i){"use strict";var n=i(17),a=i(18),r=i(5),s=i(29),o=i(7);t.exports=function(t,e,i){var l=o(t),c=i(s,l,""[t]),h=c[0],u=c[1];r(function(){var e={};return e[l]=function(){return 7},7!=""[t](e)})&&(a(String.prototype,t,h),n(RegExp.prototype,l,2==e?function(t,e){return u.call(t,this,e)}:function(t){return u.call(t,this)}))}},function(t,e,i){"use strict";var n=i(3);t.exports=function(){var t=n(this),e="";return t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.unicode&&(e+="u"),t.sticky&&(e+="y"),e}},function(t,e){t.exports=function(t,e,i){var n=void 0===i;switch(e.length){case 0:return n?t():t.call(i);case 1:return n?t(e[0]):t.call(i,e[0]);case 2:return n?t(e[0],e[1]):t.call(i,e[0],e[1]);case 3:return n?t(e[0],e[1],e[2]):t.call(i,e[0],e[1],e[2]);case 4:return n?t(e[0],e[1],e[2],e[3]):t.call(i,e[0],e[1],e[2],e[3])}return t.apply(i,e)}},function(t,e,i){var n=i(6),a=i(28),r=i(7)("match");t.exports=function(t){var e;return n(t)&&(void 0!==(e=t[r])?!!e:"RegExp"==a(t))}},function(t,e,i){var n=i(7)("iterator"),a=!1;try{var r=[7][n]();r.return=function(){a=!0},Array.from(r,function(){throw 2})}catch(t){}t.exports=function(t,e){if(!e&&!a)return!1;var i=!1;try{var r=[7],s=r[n]();s.next=function(){return{done:i=!0}},r[n]=function(){return s},t(r)}catch(t){}return i}},function(t,e,i){t.exports=i(50)||!i(5)(function(){var t=Math.random();__defineSetter__.call(null,t,function(){}),delete i(4)[t]})},function(t,e){e.f=Object.getOwnPropertySymbols},function(t,e,i){var n=i(4),a="__core-js_shared__",r=n[a]||(n[a]={});t.exports=function(t){return r[t]||(r[t]={})}},function(t,e,i){for(var n,a=i(4),r=i(17),s=i(57),o=s("typed_array"),l=s("view"),c=!(!a.ArrayBuffer||!a.DataView),h=c,u=0,d=9,f="Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array".split(",");u<d;)(n=a[f[u++]])?(r(n.prototype,o,!0),r(n.prototype,l,!0)):h=!1;t.exports={ABV:c,CONSTR:h,TYPED:o,VIEW:l}},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),s=a(r),o=i(2),l=n(o),c={EXTENT_MIN:0,EXTENT_MAX:1,TEXT_PARAMS:{TOP:11,LEFT:10,MAX_WIDTH:42,MAX_HEIGHT:16},BAR_WIDTH:6,THUMB_RADIUS:10,THUMB_STROKE_WIDTH:4,INTRO_DURATION:250},h={small:{minRadius:.5,maxRadius:40},medium:{minRadius:1,maxRadius:55},large:{minRadius:1,maxRadius:65}},u=l.default.extend({init:function(t,e){function n(t,e){var i=r.model.size.extent||[c.EXTENT_MIN,c.EXTENT_MAX];r._updateLabels(i),r.sliderEl.call(r.brush.extent(i)),i[0]==i[1]&&r.sliderEl.selectAll(".resize").style("display","block")}function a(t){r.sizeScaleMinMax=r.model.size.getScale().domain(),r._setLabelsText()}this.name="bubblesize",this.template=this.template||i(424),this.model_expects=[{name:"size",type:"size"}];var r=this;this.model_binds={"change:size.domainMin":n,"change:size.domainMax":n,"change:size.extent":n,ready:a},this._setModel=s.throttle(this._setModel,50),this._super(t,e)},readyOnce:function(){var t=this,e=t.model.size.extent||[c.EXTENT_MIN,c.EXTENT_MAX];this.showArcs=t.model.size.showArcs!==!1,this.element=d3.select(this.element),this.sliderSvg=this.element.select(".vzb-bs-svg"),this.sliderWrap=this.sliderSvg.select(".vzb-bs-slider-wrap"),this.sliderEl=this.sliderWrap.select(".vzb-bs-slider");var i={v:c.TEXT_PARAMS.TOP,h:c.TEXT_PARAMS.LEFT},n=c.TEXT_PARAMS.MAX_WIDTH,a=c.TEXT_PARAMS.MAX_HEIGHT,r=c.BAR_WIDTH,s=c.THUMB_RADIUS,o=c.THUMB_STROKE_WIDTH,l={top:o,left:i.h+n,right:i.h+n,bottom:r+a};this.padding=l;var h=this.getMinMaxBubbleRadius();this.xScale=d3.scale.linear().domain([c.EXTENT_MIN,c.EXTENT_MAX]).range([2*h.min,2*h.max]).clamp(!0),this.brush=d3.svg.brush().x(this.xScale).extent([c.EXTENT_MIN,c.EXTENT_MIN]).on("brush",function(){t._setFromExtent(!0,!1,!1)}).on("brushend",function(){t.sliderEl.selectAll(".resize").style("display",null),t._setFromExtent(!0,!0)}),this.sliderEl.call(t.brush),this.sliderEl.selectAll(".background").attr("style",""),this.sliderThumbs=this.sliderEl.selectAll(".resize").sort(d3.descending).classed("vzb-bs-slider-thumb",!0),this.sliderThumbs.append("g").attr("class","vzb-bs-slider-thumb-badge").append("path").attr("d","M0 "+.5*r+"l"+-s+" "+1.5*s+"h"+2*s+"Z"),t.showArcs&&this.sliderThumbs.append("path").attr("class","vzb-bs-slider-thumb-arc"),this.sliderEl.selectAll("text").data([0,0]).enter().append("text").attr("class","vzb-bs-slider-thumb-label").attr("text-anchor",function(t,e){return e?"start":"end"}).attr("dy",function(t,e){return e?"-0.7em":"1.4em"}),this.sliderLabelsEl=this.sliderEl.selectAll("text.vzb-bs-slider-thumb-label"),this.sliderEl.selectAll("rect").attr("height",r).attr("rx",.25*r).attr("ry",.25*r).attr("transform","translate(0,"+.5*-r+")"),this.sliderEl.select(".extent").classed("vzb-bs-slider-extent",!0),this.on("resize",function(){t.xScale.range([2*t.getMinMaxBubbleRadius().min,2*t.getMinMaxBubbleRadius().max]),t._updateSize(),t.sliderEl.call(t.brush.extent(t.brush.extent())),t._setFromExtent(!1,!1,!1)}),this._updateSize(),this.sliderEl.call(this.brush.extent(e)),t._setFromExtent(!1,!1,!1),t.sizeScaleMinMax=t.model.size.getScale().domain(),t.sizeScaleMinMax&&t._setLabelsText()},getMinMaxBubbleRadius:function(){return{min:h[this.getLayoutProfile()].minRadius,max:h[this.getLayoutProfile()].maxRadius}},_updateSize:function(){var t=this.showArcs?this.getMinMaxBubbleRadius().max:2*c.TEXT_PARAMS.TOP;this.sliderSvg.attr("height",t+this.padding.top+this.padding.bottom).attr("width",2*this.getMinMaxBubbleRadius().max+this.padding.left+this.padding.right),this.sliderWrap.attr("transform","translate("+this.padding.left+","+(t+this.padding.top)+")")},_updateArcs:function(t){if(this.showArcs){var e=this,i=d3.svg.arc().outerRadius(function(t){return.5*e.xScale(t)}).innerRadius(function(t){return.5*e.xScale(t)}).startAngle(.5*-Math.PI).endAngle(.5*Math.PI);this.sliderThumbs.select(".vzb-bs-slider-thumb-arc").data(t).attr("d",i).attr("transform",function(t){return"translate("+.5*-e.xScale(t)+",0)"})}},_updateLabels:function(t){var e=this,i=function(t,i){var n={v:c.TEXT_PARAMS.TOP,h:c.TEXT_PARAMS.LEFT},a=n.h*(i?.5:-1)+e.xScale(t),r=0;return"translate("+a+","+r+")"};this.sliderLabelsEl.data(t).attr("transform",i)},_setLabelsText:function(){var t=this;t.sliderLabelsEl.data([t.model.size.getTickFormatter()(t.sizeScaleMinMax[0]),t.model.size.getTickFormatter()(t.sizeScaleMinMax[1])]).text(function(t){return t})},_setFromExtent:function(t,e,i){var n=this.brush.extent();this._updateArcs(n),this._updateLabels(n),t&&this._setModel(n,e,i)},_setModel:function(t,e,i){t=[+t[0].toFixed(2),+t[1].toFixed(2)],this.model.size.set({extent:t},e,i)}});e.default=u},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),s=a(r),o=i(2),l=n(o),c=i(211),h=n(c),u=i(40),d=n(u),f=l.default.extend({init:function(t,e){var i=this;this.template='<div class="vzb-cl-outer"></div>',this.name="colorlegend",this.model_expects=[{name:"time",type:"time"},{name:"entities",type:"entities"},{name:"marker",type:"model"},{name:"locale",type:"locale"}],this.model_binds={"change:marker.color.scaleType":function(t,e){i._readyOnce&&!i.colorModel.isDiscrete()&&i.updateView()},"change:marker.color.palette":function(t,e){i._readyOnce&&i.frame&&i.updateView()},"change:marker.highlight":function(t,e){i.colorModel.isDiscrete()&&i.model.marker.getFrame(i.model.time.value,function(t){if(t){var e=i.model.marker.getHighlighted(i.KEY);i.updateGroupsOpacity(e.map(function(e){return t[i.colorModel._name][e]}))}else i.updateGroupsOpacity()})},"translate:locale":function(){i.colorPicker.translate(i.model.locale.getTFunction())}},this._super(t,e)},readyOnce:function(){var t=this;this.element=d3.select(this.element),d3.select(this.placeholder.parentNode).classed("vzb-dialog-scrollable",!0),this.colorModel=this.model.marker.color,this.colorlegendMarker=this.colorModel.getColorlegendMarker(),this.colorlegendMarker&&this.colorlegendMarker.on("ready",function(){t.ready()}),this.listColorsEl=this.element.append("div").attr("class","vzb-cl-holder").append("div").attr("class","vzb-cl-colorlist"),this.rainbowEl=this.listColorsEl.append("div").attr("class","vzb-cl-rainbow"),this.minimapEl=this.listColorsEl.append("div").attr("class","vzb-cl-minimap"),this.rainbowLegendEl=this.listColorsEl.append("div").attr("class","vzb-cl-rainbow-legend"),this.rainbowLegendSVG=this.rainbowLegendEl.append("svg"),this.rainbowLegendG=this.rainbowLegendSVG.append("g"),this.rainbowLegend=null,this.labelScaleEl=this.listColorsEl.append("div").attr("class","vzb-cl-labelscale"),this.labelScaleSVG=this.labelScaleEl.append("svg"),this.labelScaleG=this.labelScaleSVG.append("g"),this.unitDiv=this.listColorsEl.append("div").attr("class","vzb-cl-unit"),this.unitText=this.unitDiv.append("span").attr("class","vzb-cl-unit-text"),this.minimapSVG=this.minimapEl.append("svg"),this.minimapG=this.minimapSVG.append("g"),this.colorPicker=(0,h.default)(),this.root.element instanceof Array?this.root.element:d3.select(this.root.element).call(this.colorPicker),this.colorPicker.translate(this.model.locale.getTFunction())},ready:function(){var t=this;if(this.KEY=this.model.entities.getDimension(),this.colorlegendDim=this.KEY,this.canShowMap=!1,this.colorModel.isDiscrete()&&"constant"!==this.colorModel.use&&this.colorlegendMarker){if(!this.colorlegendMarker._ready)return;return this.colorlegendDim=this.colorModel.getColorlegendEntities().getDimension(),void this.colorlegendMarker.getFrame(this.model.time.value,function(e){t.frame=e,t.canShowMap=s.keys((t.frame||{}).hook_geoshape||{}).length,t.colorlegendKeys=t.colorlegendMarker.getKeys(t.colorlegendDim),t.colorlegendKeys.forEach(function(e){((t.frame||{}).hook_geoshape||{})[e[t.colorlegendDim]]||(t.canShowMap=!1)}),t.updateView(),t.updateGroupsOpacity()})}t.updateView(),t.updateGroupsOpacity()},updateView:function(){var t=this,e=(this.KEY,this.colorModel.getPalette()),i=this.canShowMap,n=this.colorlegendKeys||[],a=this.listColorsEl.selectAll(".vzb-cl-option"),r=i||"_default"==this.colorModel.which||this.colorlegendMarker&&this.colorlegendDim==this.KEY&&s.comparePlainObjects(this.colorModel.getColorlegendEntities().getFilter(),this.model.entities.getFilter());a.classed("vzb-hidden",r),this.rainbowEl.classed("vzb-hidden",this.colorModel.isDiscrete()),this.labelScaleEl.classed("vzb-hidden",this.colorModel.isDiscrete()),this.rainbowLegendEl.classed("vzb-hidden",this.colorModel.isDiscrete()),this.minimapEl.classed("vzb-hidden",!i||!this.colorModel.isDiscrete()),this.unitDiv.classed("vzb-hidden",!0);var o=this.colorModel.getScale();if(this.colorModel.isDiscrete())if(i){var l=this.minimapEl.append("div").attr("class","vzb-temp");this.minimapSVG.attr("viewBox",null),this.minimapSVG.selectAll("g").remove(),this.minimapG=this.minimapSVG.append("g"),this.minimapG.selectAll("path").data(n,function(e){return e[t.colorlegendDim]}).enter().append("path").on("mouseover",t._interact().mouseover).on("mouseout",t._interact().mouseout).on("click",t._interact().clickToSelect).on("dblclick",t._interact().clickToShow).each(function(e){var i=t.frame.hook_geoshape[e[t.colorlegendDim]].trim();"<svg"==i.slice(0,4)&&(l.html(i),i=l.select("svg").select("path").attr("d")),d3.select(this).attr("d",i).style("fill",o(e[t.colorlegendDim])).append("title").html(t.frame.label[e[t.colorlegendDim]]),l.html("")});var c=this.minimapG.node().getBBox();this.minimapSVG.attr("viewBox","0 0 "+1.05*c.width+" "+1.05*c.height),l.remove()}else a="_default"==this.colorModel.which?a.data([]):a.data(r?[]:n.length?n:Object.keys(this.colorModel.getPalette()).map(function(e){var i={};return i[t.colorlegendDim]=e,i}),function(e){return e[t.colorlegendDim]}),a.exit().remove(),a.enter().append("div").attr("class","vzb-cl-option").each(function(){d3.select(this).append("div").attr("class","vzb-cl-color-sample").on("click",t._interact().clickToShow),d3.select(this).append("div").attr("class","vzb-cl-color-legend")}).on("mouseover",t._interact().mouseover).on("mouseout",t._interact().mouseout).on("click",t._interact().clickToSelect),a.each(function(e,i){d3.select(this).select(".vzb-cl-color-sample").style("background-color",o(e[t.colorlegendDim])).style("border","1px solid "+o(e[t.colorlegendDim]));var n=t.colorlegendMarker?t.frame.label[e[t.colorlegendDim]]:null;n||0===n||(n=e[t.colorlegendDim]),d3.select(this).select(".vzb-cl-color-legend").text(n)});else{var h,u,f,m=this.rainbowEl.node().getBoundingClientRect().width,p=Object.keys(e).map(parseFloat),g=this.colorModel.getTickFormatter(),v=null,b=this.colorModel.paletteLabels;if(b){v="optimistic",h=b.map(function(t){return parseFloat(t)});var y=d3.max(h);u=h.map(function(t){return t/y*m})}else{h=o.domain();var y=d3.max(p);u=p.map(function(t){return t/y*m})}var x=d3.min(h)<=0&&d3.max(h)>=0&&"log"===this.colorModel.scaleType?"genericLog":this.colorModel.scaleType;f=d3.scale["time"==x?"linear":x]().domain(h).range(u);var _=parseInt(this.rainbowEl.style("left"),10)||0,M=parseInt(this.rainbowEl.style("right"),10)||_;this.labelScaleSVG.style("width",_+m+M+"px"),this.labelScaleG.attr("transform","translate("+_+",0)"),this.rainbowLegendSVG.style("width",_+m+M+"px"),this.rainbowLegendG.attr("transform","translate("+_+", 7)");var w=(0,d.default)();w.scale(f).orient("bottom").tickSize(6,0).tickPadding(6).tickSizeMinor(3,0).labelerOptions({scaleType:this.colorModel.scaleType,toolMargin:{right:M,left:_},showOuter:!0,formatter:g,bump:_,cssFontSize:"11px",fitIntoScale:v}),this.labelScaleG.call(w);var z=o.range(),S=u.map(function(t,e){return{val:t,color:z[e],paletteKey:p[e]}});this.rainbowLegend=this.rainbowLegendG.selectAll("circle").data(S),this.rainbowLegend.exit().remove(),this.rainbowLegend.enter().append("circle").attr("r","6px").attr("stroke","#000").on("click",t._interact().clickToChangeColor),this.rainbowLegend.each(function(t,e){d3.select(this).attr("fill",t.color),d3.select(this).attr("cx",t.val)});var k=p.map(function(t,e){return z[e]+" "+d3.format("%")(.01*t)}).join(", ");this.rainbowEl.style("background","linear-gradient(90deg,"+k+")");var E=this.colorModel.getConceptprops().unit||"";this.unitDiv.classed("vzb-hidden",""==E),this.unitText.text(E),a.classed("vzb-hidden",!0)}},_interact:function(){var t=this,e=this.KEY,i=this.colorlegendDim;return{mouseover:function(n,a){if(t.colorModel.isDiscrete()){var r=(d3.select(this),n[i]),o=t.colorModel.getValidItems().filter(function(e){return e[t.colorModel.which]==r}).map(function(t){return s.clone(t,[e])});t.model.marker.setHighlight(o)}},mouseout:function(e,i){t.colorModel.isDiscrete()&&t.model.marker.clearHighlighted()},clickToChangeColor:function(e,n){if(t.colorModel.isUserSelectable()){var a=t.colorModel.getPalette(),r=t.colorModel.getDefaultPalette(),s=(d3.select(this),t.colorModel.isDiscrete()?e[i]:e.paletteKey);t.colorPicker.colorOld(a[s]).colorDef(r[s]).callback(function(e,i){t.colorModel.setColor(e,s)}).fitToScreen([d3.event.pageX,d3.event.pageY]).show(!0)}},clickToShow:function(e,n){if(t.colorModel.isDiscrete()){d3.select(this),e[i];if(t.model.entities.show[i]&&t.model.entities.show[i].$in)var a=s.clone(t.model.entities.show[i].$in);else var a=[];var r=a.indexOf(e[i]);r!==-1?a.splice(r,1):a.push(e[i]);var o={};a.length>0&&(o[i]={$in:a}),t.model.entities.set({show:o})}},clickToSelect:function(n,a){if(t.colorModel.isDiscrete()){var r=(d3.select(this),n[i]),o=t.colorModel.getValidItems().filter(function(e){return e[t.colorModel.which]==r}).map(function(t){return s.clone(t,[e])});o.filter(function(e){return t.model.marker.isSelected(e)}).length==o.length?t.model.marker.clearSelected():t.model.marker.setSelect(o)}}}},resize:function(){this.colorModel.isDiscrete()||this.updateView(),this.colorPicker.resize(d3.select(".vzb-colorpicker-svg"))},updateGroupsOpacity:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=this,i=this.colorModel.getColorlegendMarker()||{},n=i.opacityRegular||.8,a=i.opacityHighlightDim||.5,r=1,s=e.canShowMap?".vzb-cl-minimap path":".vzb-cl-option .vzb-cl-color-sample";this.listColorsEl.selectAll(s).style("opacity",function(i){return t.length?t.indexOf(i[e.colorlegendDim])>-1?r:a:n})}});e.default=f},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),s=a(r),o=i(2),l=n(o),c="domainMin",h="domainMax",u="zoomedMin",d="zoomedMax",f=l.default.extend({init:function(t,e){this.name="gapminder-minmaxinputs",this.template=i(441);var n=this;this.model_expects=[{name:"marker",type:"model"},{name:"time",type:"time"},{name:"locale",type:"locale"}],this.markerID=t.markerID,t.markerID||s.warn("minmaxinputs.js complains on 'markerID' property: "+t.markerID),this.model_binds={},this.model_binds["translate:locale"]=function(t){n.updateView()},this.model_binds["change:marker."+this.markerID]=function(t){n.updateView()},this.model_binds.ready=function(t){n.updateView()},this._super(t,e),this.ui=s.extend({selectDomainMinMax:!1,selectZoomedMinMax:!1},this.ui.getPlainObject())},ready:function(){this.updateView()},readyOnce:function(){var t=this;this.element=d3.select(this.element),this.el_domain_labelMin=this.element.select(".vzb-mmi-domainmin-label"),this.el_domain_labelMax=this.element.select(".vzb-mmi-domainmax-label"),this.el_domain_fieldMin=this.element.select(".vzb-mmi-domainmin"),this.el_domain_fieldMax=this.element.select(".vzb-mmi-domainmax"),this.el_break=this.element.select(".vzb-mmi-break"),this.el_zoomed_labelMin=this.element.select(".vzb-mmi-zoomedmin-label"),this.el_zoomed_labelMax=this.element.select(".vzb-mmi-zoomedmax-label"),this.el_zoomed_fieldMin=this.element.select(".vzb-mmi-zoomedmin"),this.el_zoomed_fieldMax=this.element.select(".vzb-mmi-zoomedmax"),t.el_domain_fieldMin.on("change",function(){t._setModel(c,this.value)}),t.el_domain_fieldMax.on("change",function(){t._setModel(h,this.value)}),t.el_zoomed_fieldMin.on("change",function(){t._setModel(u,this.value)}),t.el_zoomed_fieldMax.on("change",function(){t._setModel(d,this.value)}),this.element.selectAll("input").on("keypress",function(t){13==d3.event.which&&document.activeElement.blur()})},updateView:function(){var t=this;this.translator=this.model.locale.getTFunction(),this.el_domain_labelMin.text(this.translator("hints/min")+":"),this.el_domain_labelMax.text(this.translator("hints/max")+":"),this.el_zoomed_labelMin.text(this.translator("hints/min")+":"),this.el_zoomed_labelMax.text(this.translator("hints/max")+":"),this.el_domain_labelMin.classed("vzb-hidden",!this.ui.selectDomainMinMax),this.el_domain_labelMax.classed("vzb-hidden",!this.ui.selectDomainMinMax),this.el_domain_fieldMin.classed("vzb-hidden",!this.ui.selectDomainMinMax),this.el_domain_fieldMax.classed("vzb-hidden",!this.ui.selectDomainMinMax),this.el_break.classed("vzb-hidden",!(this.ui.selectDomainMinMax&&this.ui.selectZoomedMinMax)),this.el_zoomed_labelMin.classed("vzb-hidden",!this.ui.selectZoomedMinMax),this.el_zoomed_labelMax.classed("vzb-hidden",!this.ui.selectZoomedMinMax),this.el_zoomed_fieldMin.classed("vzb-hidden",!this.ui.selectZoomedMinMax),this.el_zoomed_fieldMax.classed("vzb-hidden",!this.ui.selectZoomedMinMax);var e=function(e){return e||0===e?s.isDate(e)?t.model.time.formatDate(e):d3.format(".2r")(e):e};this.el_domain_fieldMin.property("value",e(this.model.marker[this.markerID].getScale().domain()[0])),this.el_domain_fieldMax.property("value",e(this.model.marker[this.markerID].getScale().domain()[1])),this.el_zoomed_fieldMin.property("value",e(this.model.marker[this.markerID].zoomedMin)),this.el_zoomed_fieldMax.property("value",e(this.model.marker[this.markerID].zoomedMax));
},_setModel:function(t,e){this.model.marker[this.markerID][t]=s.strToFloat(e)}});e.default=f},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),s=a(r),o=i(21),l=n(o),c=i(10),h=function(t){return function(){function e(t){return t.call(o).each(function(t,e){var i=d3.select(this);i.append("rect").attr("class","vzb-label-glow").attr("filter","url("+location.pathname+"#vzb-glow-filter)"),i.append("rect").attr("class","vzb-label-fill vzb-tooltip-border"),i.append("text").attr("class",a+"-label-content "+a+"-label-shadow vzb-noexport"),i.append("text").attr("class",a+"-label-content");var n=i.append("g").attr("class",a+"-label-x vzb-transparent");s.setIcon(n,c.close),n.insert("circle","svg"),n.select("svg").attr("class",a+"-label-x-icon").attr("width","0px").attr("height","0px"),n.on("click",function(){d3.event.defaultPrevented||(r.model.marker.clearHighlighted(),r.model.marker.selectMarker(t))})}).on("mouseover",function(t){if(!s.isTouchDevice()){r.model.marker.highlightMarker(t);var e=r.KEY||r.model.entities.getDimension();r.entityLabels.sort(function(i,n){return i[e]!=t[e]?-1:1}),d3.select(this).selectAll("."+a+"-label-x").classed("vzb-transparent",!1)}}).on("mouseout",function(t){s.isTouchDevice()||(r.model.marker.clearHighlighted(),d3.select(this).selectAll("."+a+"-label-x").classed("vzb-transparent",!0))}).on("click",function(t){if(s.isTouchDevice()){var e=d3.select(this).selectAll("."+a+"-label-x"),i=r.KEY||r.model.entities.getDimension(),n=e.classed("vzb-transparent");n&&(r.entityLabels.sort(function(e,n){return e[i]!=t[i]?-1:1}),r.showCloseCross(null,!1)),e.classed("vzb-transparent",!n),r.options.SUPPRESS_HIGHLIGHT_DURING_PLAY&&r.model.time.playing||(n?r.model.marker.setHighlight(t):r.model.marker.clearHighlighted())}}),e}function i(t,e,i,a,s,o,l,c,h,u){var d=r.cached[t[r.KEY]],f=d3.select(i),m=!a&&0!==a||!s&&0!==s||!o&&0!==o||!l&&0!==l;if(m)return f.classed("vzb-invisible",m),void u.classed("vzb-invisible",m);var p=r.context.width,g=r.context.height,v=d.rectBBox,b=v.width,y=v.height;a-b<=0?(a=b,d.labelX_=(a-r.xScale(d.labelX0))/p):a+5>p&&(a=p-5,d.labelX_=(a-r.xScale(d.labelX0))/p),s-.75*y<=0?(s=.75*y,d.labelY_=(s-r.yScale(d.labelY0))/g):s+.35*y>g&&(s=g-.35*y,d.labelY_=(s-r.yScale(d.labelY0))/g),null==c&&(c=r.context.duration),d._new&&(c=0,delete d._new),c?h&&!t.hidden?(f.classed("vzb-invisible",t.hidden),f.attr("transform","translate("+a+","+s+")").style("opacity",0).transition().duration(c).ease("exp").style("opacity",1).each("interrupt",function(){f.style("opacity",1)}),u.classed("vzb-invisible",t.hidden),u.attr("transform","translate("+a+","+s+")").style("opacity",0).transition().duration(c).ease("exp").style("opacity",1).each("interrupt",function(){u.style("opacity",1)})):h&&t.hidden?(f.style("opacity",1).transition().duration(c).ease("exp").style("opacity",0).each("end",function(){f.style("opacity",1).classed("vzb-invisible",t.hidden)}),u.style("opacity",1).transition().duration(c).ease("exp").style("opacity",0).each("end",function(){u.style("opacity",1).classed("vzb-invisible",t.hidden)})):(f.transition().duration(c).ease("linear").attr("transform","translate("+a+","+s+")"),u.transition().duration(c).ease("linear").attr("transform","translate("+a+","+s+")")):(f.interrupt().attr("transform","translate("+a+","+s+")").transition(),u.interrupt().attr("transform","translate("+a+","+s+")").transition(),h&&f.classed("vzb-invisible",t.hidden),h&&u.classed("vzb-invisible",t.hidden));var x=o-a,_=l-s,M=f.select("text").node().getBBox(),w=.5*-M.width,z=.2*-y,S=r.model.ui.chart.labels,k=S.removeLabelBox?M:v,E=r.activeProfile.labelLeashCoeff||0,O=n({x:x,y:_,r:d.scaledS0},{x:w,y:z,width:2*k.height*E+k.width,height:k.height*(2*E+1)});if(u.select("line").classed("vzb-invisible",O),!O){if(S.removeLabelBox){var T=180*Math.atan2(x-w,_-z)/Math.PI,P=T>=0&&T<=180?.5*k.width:.5*-k.width,D=Math.abs(T)<=90?.55*k.height:.45*-k.height;w+=Math.abs(x-w)>.5*M.width?P:0,z+=Math.abs(_-z)>.5*M.height?D:.05*M.height}var I=Math.abs(x)>Math.abs(_)?Math.abs(x):Math.abs(_);u.select("line").style("stroke-dasharray","0 "+d.scaledS0+" "+2*~~I),u.selectAll("line").attr("x1",x).attr("y1",_).attr("x2",w).attr("y2",z)}}function n(t,e){var i=Math.abs(t.x-e.x),n=Math.abs(t.y-e.y),a=.5*e.width,r=.5*e.height;if(i>a+t.r)return!1;if(n>r+t.r)return!1;if(i<=a)return!0;if(n<=r)return!0;var s=Math.pow(i-a,2)+Math.pow(n-r,2);return s<=Math.pow(t.r,2)}var a,r=t;e.setCssPrefix=function(t){return a=t,e};var o=d3.behavior.drag().on("dragstart",function(t,e){d3.event.sourceEvent.stopPropagation();r.KEY}).on("drag",function(t,i){var n=r.KEY;if(r.model.ui.chart.labels.dragging){this.druging||(r.druging=t[n]);var a=r.cached[t[n]];a.labelFixed=!0;var s=r.context.width,o=r.context.height;a.labelX_+=d3.event.dx/s,a.labelY_+=d3.event.dy/o;var l=r.xScale(a.labelX0)+a.labelX_*s,c=r.yScale(a.labelY0)+a.labelY_*o,h=r.xScale(a.labelX0),u=r.yScale(a.labelY0),d=r.entityLines.filter(function(e){return e[n]==t[n]});e._repositionLabels(t,i,this,l,c,h,u,0,null,d)}}).on("dragend",function(t,e){var i=r.KEY;if(r.druging){var n=r.cached[t[i]];r.druging=null,n.labelOffset[0]=n.labelX_,n.labelOffset[1]=n.labelY_,r.model.marker.setLabelOffset(t,[n.labelX_,n.labelY_])}});return e.line=function(t){t.append("line").attr("class",a+"-label-line")},e._repositionLabels=i,e}()},u={LABELS_CONTAINER_CLASS:"",LINES_CONTAINER_CLASS:"",LINES_CONTAINER_SELECTOR:"",CSS_PREFIX:"",SUPPRESS_HIGHLIGHT_DURING_PLAY:!0},d=l.default.extend({init:function(t,e){this.context=t,this.options=s.extend({},u),this.label=h(this),this._xScale=null,this._yScale=null,this._closeCrossHeight=0,this.labelSizeTextScale=null},ready:function(){this.updateIndicators(),this.updateLabelSizeLimits()},readyOnce:function(){var t=this;this.model=this.context.model,this.model.on("change:marker.select",function(){t.context._readyOnce&&t.selectDataPoints()}),this.model.marker.size_label&&this.model.on("change:marker.size_label.extent",function(e,i){t.context._readyOnce&&(t.updateLabelSizeLimits(),t.model.time.splash||t.updateLabelsOnlyTextSize())}),this.model.ui.chart.labels.hasOwnProperty("removeLabelBox")&&this.model.on("change:ui.chart.labels.removeLabelBox",function(e,i){t.context._readyOnce&&t.updateLabelsOnlyTextSize()}),this.KEY=this.context.model.entities.getDimension(),this.cached={},this.label.setCssPrefix(this.options.CSS_PREFIX),this.rootEl=this.context.root.element instanceof Array?this.context.root.element:d3.select(this.context.root.element),this.labelsContainer=this.rootEl.select("."+this.options.LABELS_CONTAINER_CLASS),this.linesContainer=this.rootEl.select("."+this.options.LINES_CONTAINER_CLASS),this.updateIndicators(),this.updateSize(),this.selectDataPoints()},config:function(t){s.extend(this.options,t)},updateLabelSizeLimits:function(){var t=this;if(this.model.marker.size_label){var e=this.model.marker.size_label.extent||[0,1],i=this.activeProfile.minLabelTextSize,n=this.activeProfile.maxLabelTextSize,a=n-i;this.minLabelTextSize=Math.max(i+a*e[0],i),this.maxLabelTextSize=Math.max(i+a*e[1],i),"constant"==this.model.marker.size_label.use&&(this.minLabelTextSize=this.maxLabelTextSize),"ordinal"!==this.model.marker.size_label.scaleType||"constant"==this.model.marker.size_label.use?this.labelSizeTextScale.range([t.minLabelTextSize,t.maxLabelTextSize]):this.labelSizeTextScale.rangePoints([t.minLabelTextSize,t.maxLabelTextSize],0).range()}},updateIndicators:function(){this.model.marker.size_label&&(this.labelSizeTextScale=this.model.marker.size_label.getScale())},setScales:function(t,e){this._xScale=t,this._yScale=e},setCloseCrossHeight:function(t){this._closeCrossHeight!=t&&(this._closeCrossHeight=t,this.updateLabelCloseGroupSize(this.entityLabels.selectAll("."+this.options.CSS_PREFIX+"-label-x"),this._closeCrossHeight))},xScale:function(t){return this._xScale?this._xScale(t):t*this.context.width},yScale:function(t){return this._yScale?this._yScale(t):t*this.context.height},selectDataPoints:function(){var t=this,e=this.KEY,i=this.options.CSS_PREFIX;this.entityLabels=this.labelsContainer.selectAll("."+i+"-entity").data(t.model.marker.select,function(t){return t[e]}),this.entityLines=this.linesContainer.selectAll("g.entity-line."+i+"-entity").data(t.model.marker.select,function(t){return t[e]}),this.entityLabels.exit().each(function(i){null!=t.cached[i[e]]&&(t.cached[i[e]]=void 0)}).remove(),this.entityLines.exit().remove(),this.entityLines.enter().insert("g",function(i){return this.querySelector("."+t.options.LINES_CONTAINER_SELECTOR_PREFIX+i[e])}).attr("class",function(t,n){return i+"-entity entity-line line-"+t[e]}).each(function(e,i){t.label.line(d3.select(this))}),this.entityLabels.enter().append("g").attr("class",function(t,n){return i+"-entity label-"+t[e]}).each(function(i,n){t.cached[i[e]]={_new:!0},t.label(d3.select(this))})},showCloseCross:function(t,e){var i=this.KEY;this.entityLabels.filter(function(e){return!t||e[i]==t[i]}).select("."+this.options.CSS_PREFIX+"-label-x").classed("vzb-transparent",!e)},highlight:function(t,e){var i=this.KEY,n=this.entityLabels;t&&(n=n.filter(function(e){return!t||e[i]==t[i]})),n.classed("vzb-highlighted",e)},updateLabel:function(t,e,i,n,a,r,o,l,c,h,u){var d=this,f=this.KEY;if(t[f]!=d.druging){var m=this.options.CSS_PREFIX;if(d.model.marker.isSelected(t)&&null!=d.entityLabels){null==d.cached[t[f]]&&this.selectDataPoints();var p=d.cached[t[f]];if(i&&s.extend(p,i),null!=p.scaledS0&&null!=p.labelX0&&null!=p.labelY0||((r||0===r)&&(p.scaledS0=s.areaToRadius(this.context.sScale(r))),p.labelX0=n,p.labelY0=a,p.valueLST=c,p.scaledC0=null!=o?this.context.cScale(o):this.context.COLOR_WHITEISH),null==p.labelX_||null==p.labelY_){var g=s.find(d.model.marker.select,function(e){return e[f]==t[f]});p.labelOffset=g.labelOffset||[0,0]}var v=!p.labelX0&&0!==p.labelX0||!p.labelY0&&0!==p.labelY0||!p.scaledS0&&0!==p.scaledS0,b=d.entityLines.filter(function(e){return e[f]==t[f]});d.entityLabels.filter(function(e){return e[f]==t[f]}).each(function(i){var n=d3.select(this);if(v)return n.classed("vzb-invisible",v),void b.classed("vzb-invisible",v);var a=n.selectAll("."+m+"-label-content").text(l);d._updateLabelSize(t,e,n,c,a),d.positionLabel(t,e,this,h,u,b)})}}},_updateLabelSize:function(t,e,i,n,a){var r=this,s=this.KEY,o=r.cached[t[s]],l=this.options.CSS_PREFIX,c=r.model.ui.chart.labels||{};i.classed("vzb-label-boxremoved",c.removeLabelBox);var h=a||i.selectAll("."+l+"-label-content");if(r.labelSizeTextScale)if(null!=n){var u=r.labelSizeTextScale.range(),d=u[0]+Math.sqrt((r.labelSizeTextScale(n)-u[0])*(u[1]-u[0]));h.attr("font-size",d+"px")}else h.attr("font-size","");var f=h[0][0].getBBox(),m=i.selectAll("rect");if(!o.textWidth||o.textWidth!=f.width){o.textWidth=f.width;var p=r._closeCrossHeight||f.height,g=r.model.locale.isRTL(),v=i.select("."+l+"-label-x").attr("transform","translate("+(g?-f.width-4:4)+","+.85*-f.height+")");this.updateLabelCloseGroupSize(v,p),m.attr("width",f.width+8).attr("height",1.2*f.height).attr("x",-f.width-4).attr("y",.85*-f.height).attr("rx",.2*f.height).attr("ry",.2*f.height),o.rectBBox=m.node().getBBox()}var b=i.select(".vzb-label-glow");b.attr("stroke")!==o.scaledC0&&b.attr("stroke",o.scaledC0)},updateLabelCloseGroupSize:function(t,e){t.select("circle").attr("cx",0).attr("cy",0).attr("r",.5*e),t.select("svg").attr("x",.5*-e).attr("y",e*-.5).attr("width",e).attr("height",e)},updateLabelsOnlyTextSize:function(){var t=this,e=this.KEY;this.entityLabels.each(function(i,n){t.cached[i[e]];t._updateLabelSize(i,n,d3.select(this),t.context.frame.size_label[i[e]]);var a=t.entityLines.filter(function(t){return t[e]==i[e]});t.positionLabel(i,n,this,0,null,a)})},updateLabelOnlyPosition:function(t,e,i){var n=this,a=this.KEY,r=this.cached[t[a]];i&&s.extend(r,i);var o=n.entityLines.filter(function(e){return e[a]==t[a]});this.entityLabels.filter(function(e){return e[a]==t[a]}).each(function(i){n.positionLabel(t,e,this,0,null,o)})},updateLabelOnlyColor:function(t,e,i){var n=this,a=this.KEY,r=this.cached[t[a]];i&&s.extend(r,i);var o=n.entityLabels.filter(function(e){return e[a]==t[a]});n._updateLabelSize(t,e,o,null)},positionLabel:function(t,e,i,n,a,r){var s=this.KEY,o=this.cached[t[s]],l=this.context.width,c=this.context.height,h=this.xScale(o.labelX0),u=this.yScale(o.labelY0);o.labelOffset||(o.labelOffset=[0,0]),o.labelX_=o.labelOffset[0]||(.75*-o.scaledS0-5)/l,o.labelY_=o.labelOffset[1]||(.75*-o.scaledS0-11)/c;var d=h+o.labelX_*l;0==o.labelOffset[0]&&(d-o.rectBBox.width<=0?(o.labelX_=(.75*o.scaledS0+o.rectBBox.width)/l,d=h+o.labelX_*l):d+15>l&&(o.labelX_=(l-15-h)/l,d=h+o.labelX_*l));var f=u+o.labelY_*c;0==o.labelOffset[1]&&(f-o.rectBBox.height<=0?(o.labelY_=(.75*o.scaledS0+o.rectBBox.height)/c,f=u+o.labelY_*c):f+10>c&&(o.labelY_=(c-10-u)/c,f=u+o.labelY_*c)),this.label._repositionLabels(t,e,i,d,f,h,u,n,a,r)},updateSize:function(){var t={small:{minLabelTextSize:7,maxLabelTextSize:21,defaultLabelTextSize:12,labelLeashCoeff:.4},medium:{minLabelTextSize:7,maxLabelTextSize:30,defaultLabelTextSize:15,labelLeashCoeff:.3},large:{minLabelTextSize:6,maxLabelTextSize:48,defaultLabelTextSize:20,labelLeashCoeff:.2}},e={medium:{minLabelTextSize:15,maxLabelTextSize:35,defaultLabelTextSize:15,labelLeashCoeff:.3},large:{minLabelTextSize:20,maxLabelTextSize:55,defaultLabelTextSize:20,labelLeashCoeff:.2}};this.activeProfile=this.context.getActiveProfile(t,e),this.updateLabelSizeLimits()}});e.default=d},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),s=a(r),o=i(41),l=n(o),c=l.default.extend({_important:!0,getClassDefaults:function(){var t={use:null,which:null,domainMin:null,domainMax:null,zoomedMin:null,zoomedMax:null,scaleType:"linear",allow:{scales:["linear","log","genericLog","time","pow"]}};return s.deepExtend(this._super(),t)},autoGenerateModel:function(){if(null==this.which&&this.autogenerate){var t=this.dataSource.getConceptByIndex(this.autogenerate.conceptIndex,this.autogenerate.conceptType);t||(t=this.dataSource.getConceptByIndex(0,"time")),this.which=t.concept}},_type:"axis",validate:function(){if(this._super(),this.scale&&"time"==this.scaleType){var t={};null==this.zoomedMin||s.isDate(this.zoomedMin)||(t.zoomedMin=this._space.time.parse(this.zoomedMin.toString())),null==this.zoomedMax||s.isDate(this.zoomedMax)||(t.zoomedMax=this._space.time.parse(this.zoomedMax.toString())),this.set(t)}},buildScale:function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.scaleType;if("time"==e){var i=this._space.time,n=i.splash?{min:i.parse(i.startOrigin),max:i.parse(i.endOrigin)}:{min:i.start,max:i.end};t=[n.min,n.max],this.scale=d3.time.scale.utc().domain(t)}else{if(this.isDiscrete())t="constant"===this.use?[this.which]:this.getUnique(this.which);else{var n=this.getLimits(this.which);t=[n.min,n.max],t[0]=null!=this.domainMin?+this.domainMin:t[0],t[1]=null!=this.domainMax?+this.domainMax:t[1]}e=d3.min(t)<=0&&d3.max(t)>=0&&"log"===e?"genericLog":e,this.scale=d3.scale[e||"linear"]().domain(t)}this.scaleType=e},formatDate:function(t){return this._space.time.formatDate(t)}});e.default=c},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),s=a(r),o=i(2),l=n(o),c=i(40),h=n(c),u=i(210),d=n(u),f=i(10),m=l.default.extend({init:function(t,e){var n=this;this.name="linechart",this.template=i(452),this.model_expects=[{name:"time",type:"time"},{name:"entities",type:"entities"},{name:"marker",type:"model"},{name:"locale",type:"locale"},{name:"ui",type:"ui"}],this.model_binds={"change:time.value":function(){n._readyOnce&&n.model.marker.getFrame(n.model.time.value,function(t,e){return n._frameIsValid(t)?void n.frameChanged(t,e):s.warn("change:time.value: empty data received from marker.getFrame(). doing nothing")})},"change:time.playing":function(){n.model.time.playing&&s.isTouchDevice()&&!n.tooltip.classed("vzb-hidden")&&n.tooltip.classed("vzb-hidden",!0)},"change:time.start":function(){n._readyOnce&&n.updateShow()},"change:time.end":function(){n._readyOnce&&n.updateShow()},"change:marker":function(t,e){if(n._readyOnce){if(e.indexOf("domainMin")>-1||e.indexOf("domainMax")>-1||e.indexOf("zoomedMin")>-1||e.indexOf("zoomedMax")>-1){if(!n.yScale||!n.xScale)return;return n.updateShow(),n.zoomToMaxMin(),n.updateSize(),n.updateTime(),void n.redrawDataPoints()}e.indexOf("scaleType")>-1&&(n.updateShow(),n.zoomToMaxMin(),n.updateSize(),n.redrawDataPoints())}},"change:marker.highlight":function(){n._readyOnce&&n.highlightLines()},"change:marker.select":function(){n._readyOnce&&(n.updateDoubtOpacity(),n.highlightLines())},"change:marker.opacitySelectDim":function(){n._readyOnce&&n.highlightLines()},"change:marker.opacityRegular":function(){n._readyOnce&&n.highlightLines()}},this._super(t,e),this.xScale=null,this.yScale=null,this.rangeXRatio=1,this.rangeXShift=0,this.rangeYRatio=1,this.rangeYShift=0,this.lineWidthScale=d3.scale.linear().domain([0,20]).range([7,1]).clamp(!0),this.xAxis=(0,h.default)().orient("bottom"),this.yAxis=(0,h.default)().orient("left"),this.isDataPreprocessed=!1,this.timeUpdatedOnce=!1,this.sizeUpdatedOnce=!1,this.getNearestKey=s.memoize(this.getNearestKey)},readyOnce:function(){var t=this;this.element=d3.select(this.element),this.graph=this.element.select(".vzb-lc-graph"),this.yAxisElContainer=this.graph.select(".vzb-lc-axis-y"),this.yAxisEl=this.yAxisElContainer.select("g"),this.xAxisElContainer=this.graph.select(".vzb-lc-axis-x"),this.xAxisEl=this.xAxisElContainer.select("g"),this.xTitleEl=this.graph.select(".vzb-lc-axis-x-title"),this.yTitleEl=this.graph.select(".vzb-lc-axis-y-title"),this.yInfoEl=this.graph.select(".vzb-lc-axis-y-info"),this.linesContainerCrop=this.graph.select(".vzb-lc-lines-crop"),this.linesContainer=this.graph.select(".vzb-lc-lines"),this.labelsContainerCrop=this.graph.select(".vzb-lc-labels-crop"),this.labelsContainer=this.graph.select(".vzb-lc-labels"),this.dataWarningEl=this.graph.select(".vzb-data-warning"),this.verticalNow=this.labelsContainer.select(".vzb-lc-vertical-now"),this.tooltip=this.element.select(".vzb-tooltip"),this.projectionX=this.graph.select(".vzb-lc-projection-x"),this.projectionY=this.graph.select(".vzb-lc-projection-y"),this.entityLines=null,this.entityLabels=null,this.totalLength_1={},this.KEY=this.model.entities.getDimension(),this.collisionResolver=(0,d.default)().selector(".vzb-lc-label").value("valueY"),s.setIcon(this.yInfoEl,f.question).select("svg").attr("width","0px").attr("height","0px"),this.yInfoEl.on("click",function(){t.parent.findChildByName("gapminder-datanotes").pin()}),this.yInfoEl.on("mouseover",function(){var e=this.getBBox(),i=s.makeAbsoluteContext(this,this.farthestViewportElement)(e.x-10,e.y+e.height+10);t.parent.findChildByName("gapminder-datanotes").setHook("axis_y").show().setPos(i.x,i.y)}),this.yInfoEl.on("mouseout",function(){t.parent.findChildByName("gapminder-datanotes").hide()}),this.wScale=d3.scale.linear().domain(this.model.ui.datawarning.doubtDomain).range(this.model.ui.datawarning.doubtRange),this.on("resize",function(){t.updateSize()||(t.updateTime(),t.redrawDataPoints())})},ready:function(){this.all_steps=this.model.time.getAllSteps(),this.all_values=this.values=null,this.updateTime(),this.updateUIStrings(),this.updateShow();var t=this;this.model.marker.getFrame(null,function(e){t.all_values=e,t.model.marker.getFrame(t.model.time.value,function(e){t._frameIsValid(e)&&(t.values=e,t.updateShow(),t.updateSize(),t.updateDoubtOpacity(),t.zoomToMaxMin(),t.redrawDataPoints(),t.linesContainerCrop.on("mousemove",t.entityMousemove.bind(t,null,null,t)).on("mouseleave",t.entityMouseout.bind(t,null,null,t)))})})},_frameIsValid:function(t){return!(!t||0===Object.keys(t.axis_y).length||0===Object.keys(t.axis_x).length||0===Object.keys(t.color).length)},frameChanged:function(t,e){this.frame=t,this.updateTime(),this.all_values&&this.redrawDataPoints()},updateUIStrings:function(){var t=this,e=t.model.marker.axis_y.getConceptprops(),i=t.model.marker.axis_x.getConceptprops(),n=t.model.marker.color.getConceptprops();this.translator=this.model.locale.getTFunction(),this.strings={title:{Y:e.name,X:i.name,C:n.name},unit:{Y:e.unit||"",X:i.unit||"",C:n.unit||""}},this.strings.unit.Y==="unit/"+this.model.marker.axis_y.which&&(this.strings.unit.Y=""),this.strings.unit.X==="unit/"+this.model.marker.axis_x.which&&(this.strings.unit.X=""),this.strings.unit.C==="unit/"+this.model.marker.color.which&&(this.strings.unit.C=""),this.strings.unit.Y&&(this.strings.unit.Y=", "+this.strings.unit.Y),this.strings.unit.X&&(this.strings.unit.X=", "+this.strings.unit.X),this.strings.unit.C&&(this.strings.unit.C=", "+this.strings.unit.C),s.setIcon(this.dataWarningEl,f.warn).select("svg").attr("width","0px").attr("height","0px"),this.dataWarningEl.append("text").attr("text-anchor","end").text(this.translator("hints/dataWarning")),this.dataWarningEl.on("click",function(){t.parent.findChildByName("gapminder-datawarning").toggle()}).on("mouseover",function(){t.updateDoubtOpacity(1)}).on("mouseout",function(){t.updateDoubtOpacity()});var a=this.xTitleEl.selectAll("text").data([0]);a.enter().append("text");var r=this.yTitleEl.selectAll("text").data([0]);r.enter().append("text"),r.on("click",function(){t.parent.findChildByName("gapminder-treemenu").markerID("axis_y").alignX("left").alignY("top").updateView().toggle()})},updateDoubtOpacity:function(t){null==t&&(t=this.wScale(+this.time.getUTCFullYear().toString())),this.someSelected&&(t=1),this.dataWarningEl.style("opacity",t)},updateShow:function(){var t=this,e=this.KEY;if(this.cached={},this.yScale=this.model.marker.axis_y.getScale(),!this.splash){var i=this.model.marker.axis_y.getLimits(this.model.marker.axis_y.which);this.yScale.domain([i.min,i.max])}this.xScale=this.model.marker.axis_x.getScale(),this.cScale=this.model.marker.color.getScale(),this.yAxis.tickFormat(this.model.marker.axis_y.getTickFormatter()),this.xAxis.tickFormat(this.model.marker.axis_x.getTickFormatter()),this.collisionResolver.scale(this.yScale).KEY(e),this.data=this.model.marker.getKeys(),this.entityLines=this.linesContainer.selectAll(".vzb-lc-entity").data(this.data),this.entityLines.exit().remove(),this.entityLines.enter().append("g").attr("class","vzb-lc-entity").each(function(t,e){var i=d3.select(this);i.append("path").attr("class","vzb-lc-line-shadow"),i.append("path").attr("class","vzb-lc-line")}),this.entityLabels=this.labelsContainer.selectAll(".vzb-lc-entity").data(this.data),this.entityLabels.exit().remove(),this.entityLabels.enter().append("g").attr("class","vzb-lc-entity").each(function(t,e){var i=d3.select(this);i.append("circle").attr("class","vzb-lc-circle").attr("cx",0);var n=i.append("g").attr("class","vzb-lc-label");n.append("text").attr("class","vzb-lc-labelname").attr("dy",".35em"),n.append("text").attr("class","vzb-lc-label-value").attr("dy","1.6em")}),this.all_values&&this.values&&this.entityLabels.each(function(i,n){var a=d3.select(this),r=t.cScale(t.values.color[i[e]]),s="geo.world_4region"==t.model.marker.color.which?t.model.marker.color.getColorShade({colorID:t.values.color[i[e]],shadeID:"shade"}):d3.rgb(r).darker(.5).toString(),o=t.values.label[i[e]],l=t.yAxis.tickFormat()(t.values.axis_y[i[e]]),c=o.length<13?o:o.substring(0,10)+"...",h=t.ui.chart.labels.min_number_of_entities_when_values_hide;a.select("circle").style("fill",r),a.select(".vzb-lc-labelname").style("fill",s).text(c+" "+(t.data.length<h?l:"")),a.select(".vzb-lc-label-value").style("fill",s)}),this.line=d3.svg.line().interpolate("cardinal").x(function(e){return t.xScale(e[0])}).y(function(e){return t.yScale(e[1])})},updateTime:function(){var t=this,e=(this.KEY,null===this.time?this.model.time.value:this.time);this.time=this.model.time.value,this.duration=this.model.time.playing&&this.time-e>0?this.model.time.delayAnimations:0;var i=this.model.time.getDimension(),n={};n[i]=this.time,this.prev_steps=this.all_steps.filter(function(e){return e<t.time}),this.timeUpdatedOnce=!0},profiles:{small:{margin:{top:30,right:20,left:40,bottom:20},infoElHeight:16,yAxisTitleBottomMargin:6,tick_spacing:60,text_padding:12,lollipopRadius:6,limitMaxTickNumberX:5},medium:{margin:{top:40,right:60,left:60,bottom:25},infoElHeight:20,yAxisTitleBottomMargin:6,tick_spacing:80,text_padding:15,lollipopRadius:7,limitMaxTickNumberX:10},large:{margin:{top:50,right:60,left:60,bottom:30},infoElHeight:22,yAxisTitleBottomMargin:6,tick_spacing:100,text_padding:20,lollipopRadius:9,limitMaxTickNumberX:0}},presentationProfileChanges:{medium:{margin:{top:70,bottom:40,left:70},yAxisTitleBottomMargin:20,xAxisTitleBottomMargin:20,infoElHeight:26,text_padding:30},large:{margin:{top:70,bottom:50,left:70},yAxisTitleBottomMargin:20,xAxisTitleBottomMargin:20,infoElHeight:32,text_padding:36,hideSTitle:!0}},timeSliderProfiles:{small:{margin:{top:9,right:15,bottom:10,left:10}},medium:{margin:{top:9,right:15,bottom:10,left:20}},large:{margin:{top:9,right:15,bottom:10,left:25}}},updateSize:function(){var t=this;this.values,this.KEY;this.activeProfile=this.getActiveProfile(this.profiles,this.presentationProfileChanges),this.margin=this.activeProfile.margin,this.tick_spacing=this.activeProfile.tick_spacing;var e=this.activeProfile.infoElHeight,i=0;if(this.entityLabels.selectAll(".vzb-lc-labelname").attr("dx",t.activeProfile.text_padding).each(function(t,e){var n=this.getComputedTextLength();n>i&&(i=n)}),this.entityLabels.selectAll(".vzb-lc-circle").attr("r",t.activeProfile.lollipopRadius),this.margin.right=Math.max(this.margin.right,i+this.activeProfile.text_padding+20),this.height=parseInt(this.element.style("height"),10)-this.margin.top-this.margin.bottom||0,this.width=parseInt(this.element.style("width"),10)-this.margin.left-this.margin.right||0,this.linesContainerCrop.attr("width",this.width).attr("height",Math.max(0,this.height)),this.labelsContainerCrop.attr("width",this.width+this.margin.right).attr("height",Math.max(0,this.height)),this.height<=0||this.width<=0)return s.warn("Line chart updateSize() abort: vizabi container is too little or has display:none");this.collisionResolver.height(this.height),this.graph.attr("transform","translate("+this.margin.left+","+this.margin.top+")"),this.yScale.range([this.height-this.activeProfile.lollipopRadius,this.activeProfile.lollipopRadius]),this.xScale.range([this.rangeXShift,this.width*this.rangeXRatio+this.rangeXShift]),this.yAxis.scale(this.yScale).orient("left").tickSize(-this.width,0).tickPadding(6).tickSizeMinor(-this.width,0).labelerOptions({scaleType:this.model.marker.axis_y.scaleType,toolMargin:this.margin,limitMaxTickNumber:6,viewportLength:this.height,formatter:this.model.marker.axis_y.getTickFormatter()}),this.xAxis.scale(this.xScale).tickSize(-this.height,0).tickSizeMinor(-this.height,0).tickPadding(6).labelerOptions({scaleType:this.model.marker.axis_x.scaleType,limitMaxTickNumber:this.activeProfile.limitMaxTickNumberX,toolMargin:this.margin,bump:2*this.activeProfile.text_padding,formatter:this.model.marker.axis_x.getTickFormatter()}),this.xAxisElContainer.attr("width",this.width+2*this.activeProfile.text_padding).attr("height",this.activeProfile.margin.bottom+this.height).attr("y",-1).attr("x",-this.activeProfile.text_padding),this.xAxisEl.attr("transform","translate("+(this.activeProfile.text_padding-1)+","+(this.height+1)+")"),this.yAxisElContainer.attr("width",this.activeProfile.margin.left+this.width).attr("height",Math.max(0,this.height)).attr("x",-this.activeProfile.margin.left),this.yAxisEl.attr("transform","translate("+(this.activeProfile.margin.left-1)+",0)"),this.yAxisEl.call(this.yAxis),this.xAxisEl.call(this.xAxis),this.yTitleEl.style("font-size",e+"px").attr("transform","translate("+(10-this.activeProfile.margin.left)+", -"+this.activeProfile.yAxisTitleBottomMargin+")");var n=this.yTitleEl.select("text").text(this.strings.title.Y+this.strings.unit.Y);if(n.node().getBBox().width>this.width&&n.text(this.strings.title.Y),this.yInfoEl.select("svg").node()){var a=this.yTitleEl.node().getBBox(),r=d3.transform(this.yTitleEl.attr("transform")).translate;this.yInfoEl.select("svg").attr("width",e+"px").attr("height",e+"px"),this.yInfoEl.attr("transform","translate("+(a.x+r[0]+a.width+.4*e)+","+(r[1]-.8*e)+")")}var o=this.dataWarningEl.select("text").node().getBBox();this.dataWarningEl.select("svg").attr("width",.75*o.height).attr("height",.75*o.height).attr("x",-o.width-1.2*o.height).attr("y",.65*-o.height),this.dataWarningEl.attr("transform","translate("+(this.width+o.width+2*o.height)+",-"+this.activeProfile.yAxisTitleBottomMargin+")").select("text");var l=this.xTitleEl.select("text").text(this.strings.title.X+this.strings.unit.X);this.xTitleEl.style("font-size",e+"px").attr("transform","translate("+(this.width+this.activeProfile.text_padding+this.activeProfile.yAxisTitleBottomMargin)+","+(this.height+.72*l.node().getBBox().height)+")"),l.node().getBBox().width>this.width-100&&l.text(this.strings.title.X),this.verticalNow.attr("y1",this.yScale.range()[0]).attr("y2",this.yScale.range()[1]).attr("x1",0).attr("x2",0),this.projectionX.attr("y1",t.yScale.range()[0]),this.projectionY.attr("x2",t.xScale.range()[0]),s.isTouchDevice()&&(t.tooltip.classed("vzb-hidden",!0),t.verticalNow.style("opacity",1),t.projectionX.style("opacity",0),t.projectionY.style("opacity",0),t.xAxisEl.call(t.xAxis.highlightValue(t.time)),t.yAxisEl.call(t.yAxis.highlightValue("none")),t.graph.selectAll(".vzb-lc-entity").each(function(){d3.select(this).classed("vzb-dimmed",!1).classed("vzb-hovered",!1)}),t.hoveringNow=null);var c={rangeMax:this.xScale.range()[1],mRight:this.margin.right,profile:this.timeSliderProfiles[this.getLayoutProfile()]};this.parent.trigger("myEvent",c),this.sizeUpdatedOnce=!0},redrawDataPoints:function(){var t=this,e=this.KEY;t.all_values&&this.model.marker.getFrame(this.time,function(i,n){t._frameIsValid(i)&&(t.values=i,t.timeUpdatedOnce||t.updateTime(),t.sizeUpdatedOnce||t.updateSize(),t.updateDoubtOpacity(),t.lineWidth=t.lineWidthScale(t.data.length),t.shadowWidth=1.3*t.lineWidth,t.entityLines.each(function(n,a){var r=d3.select(this),s=(i.label[n[e]],t.cScale(i.color[n[e]])),o="geo.world_4region"==t.model.marker.color.which?t.model.marker.color.getColorShade({colorID:i.color[n[e]],shadeID:"shade"}):d3.rgb(s).darker(.5).toString(),l=t.prev_steps.map(function(i,a){return[i,t.all_values[i]?t.all_values[i].axis_y[n[e]]:null]}).filter(function(t){return t[1]||0===t[1]});i.axis_y[n[e]]&&l.push([i.axis_x[n[e]],i.axis_y[n[e]]]),l.length>0?t.cached[n[e]]={valueX:l[l.length-1][0],valueY:l[l.length-1][1]}:delete t.cached[n[e]];var c=r.select(".vzb-lc-line");t.model.time.playing&&null===t.totalLength_1[n[e]]&&(t.totalLength_1[n[e]]=c.node().getTotalLength());var h=r.select(".vzb-lc-line-shadow").style("stroke",o).style("stroke-width",t.shadowWidth+"px").attr("transform","translate(0, "+(t.shadowWidth-t.lineWidth)+")").attr("d",t.line(l));c.style("stroke",s).style("stroke-width",t.lineWidth+"px").attr("d",t.line(l));var u=c.node().getTotalLength();t.model.time.playing?(h.interrupt().attr("stroke-dasharray",u).attr("stroke-dashoffset",u-t.totalLength_1[n[e]]).transition().delay(0).duration(t.duration).ease("linear").attr("stroke-dashoffset",0),c.interrupt().attr("stroke-dasharray",u).attr("stroke-dashoffset",u-t.totalLength_1[n[e]]).transition().delay(0).duration(t.duration).ease("linear").attr("stroke-dashoffset",0),t.totalLength_1[n[e]]=u):(t.totalLength_1[n[e]]=null,h.attr("stroke-dasharray","none").attr("stroke-dashoffset","none"),
c.attr("stroke-dasharray","none").attr("stroke-dashoffset","none"))}),t.entityLabels.each(function(i,n){var a=d3.select(this);t.cached[i[e]]?(a.classed("vzb-hidden",!1).transition().duration(t.duration).ease("linear").attr("transform","translate("+t.xScale(d3.min([t.cached[i[e]].valueX]))+",0)"),a.select(".vzb-lc-circle").transition().duration(t.duration).ease("linear").attr("cy",t.yScale(t.cached[i[e]].valueY)+1),a.select(".vzb-lc-label").transition().duration(t.duration).ease("linear").attr("transform","translate(0,"+t.yScale(t.cached[i[e]].valueY)+")")):a.classed("vzb-hidden",!0)}),t.verticalNow.transition().duration(t.duration).ease("linear").attr("transform","translate("+t.xScale(d3.min([t.model.marker.axis_x.zoomedMax,t.time]))+",0)"),t.hoveringNow||t.time-t.model.time.start===0?t.verticalNow.style("opacity",0):(t.ui.chart.hideXAxisValue||t.xAxisEl.call(t.xAxis.highlightTransDuration(t.duration).highlightValue(t.time)),t.verticalNow.style("opacity",1)),0==t.duration&&d3.timer.flush(),clearTimeout(t.collisionTimeout),t.collisionTimeout=setTimeout(function(){t.entityLabels.call(t.collisionResolver.data(t.cached))},1.5*t.model.time.delayAnimations))})},entityMousemove:function(t,e,i,n){var a=i,r=a.KEY,o=(a.values,d3.mouse(a.element.node()).map(function(t){return parseInt(t)})),l=a.xScale.invert(o[0]-a.margin.left);a.time-l<0?l=a.time:l<this.model.time.start&&(l=this.model.time.start);var c,h=(a.model.time.getDimension(),o[1]-a.margin.top);s.isDate(l)||(l=this.model.time.parse(l)),this.model.marker.getFrame(l,function(e){if(a._frameIsValid(e)){var i=a.getNearestKey(h,e.axis_y,a.yScale.bind(a));if(c=e.axis_y[i],t||(t={}),t[r]=i,a.model.marker.isHighlighted(t)||(a.model.marker.clearHighlighted(),a.model.marker.highlightMarker(t)),a.hoveringNow=t,!s.isNaN(c)){var n=a.xScale(l),o=a.yScale(c);a.ui.chart.whenHovering.showTooltip&&a.tooltip.style("left",n+a.margin.left+"px").style("bottom",a.height-o+a.margin.bottom+"px").text(a.yAxis.tickFormat()(c)).classed("vzb-hidden",!1),a.ui.chart.whenHovering.hideVerticalNow&&a.verticalNow.style("opacity",0),a.ui.chart.whenHovering.showProjectionLineX&&a.projectionX.style("opacity",1).attr("y2",o).attr("x1",n).attr("x2",n),a.ui.chart.whenHovering.showProjectionLineY&&a.projectionY.style("opacity",1).attr("y1",o).attr("y2",o).attr("x1",n),a.ui.chart.whenHovering.higlightValueX&&a.xAxisEl.call(a.xAxis.highlightValue(l).highlightTransDuration(0)),a.ui.chart.whenHovering.higlightValueY&&a.yAxisEl.call(a.yAxis.highlightValue(c).highlightTransDuration(0)),clearTimeout(a.unhoverTimeout)}}})},entityMouseout:function(t,e,i){var n=i;d3.event.relatedTarget&&d3.select(d3.event.relatedTarget).classed("vzb-tooltip")||(n.unhoverTimeout=setTimeout(function(){n.tooltip.classed("vzb-hidden",!0),n.verticalNow.style("opacity",1),n.projectionX.style("opacity",0),n.projectionY.style("opacity",0),n.xAxisEl.call(n.xAxis.highlightValue(n.time)),n.yAxisEl.call(n.yAxis.highlightValue("none")),n.model.marker.clearHighlighted(),n.hoveringNow=null},300))},highlightLines:function(){var t=this,e=1,i=.3,n=this.model.marker.opacityRegular,a=this.model.marker.opacityRegular,r=this.model.marker.opacitySelectDim,s=this.model.marker.highlight.length>0,o=this.model.marker.select.length>0;this.graph.selectAll(".vzb-lc-entity").each(function(){d3.select(this).style("opacity",function(l){return t.model.marker.isHighlighted(l)?e:o?t.model.marker.isSelected(l)?n:r:s?i:a})})},zoomToMaxMin:function(){null!=this.model.marker.axis_x.zoomedMin&&null!=this.model.marker.axis_x.zoomedMax&&(this.xScale.domain([this.model.marker.axis_x.zoomedMin,this.model.marker.axis_x.zoomedMax]),this.xAxisEl.call(this.xAxis)),null!=this.model.marker.axis_y.zoomedMin&&null!=this.model.marker.axis_y.zoomedMax&&((this.model.marker.axis_y.zoomedMin<=0||this.model.marker.axis_y.zoomedMax<=0)&&"log"==this.model.marker.axis_y.scaleType?(this.yScale=d3.scale.genericLog().domain([this.model.marker.axis_y.zoomedMin,this.model.marker.axis_y.zoomedMax]).range(this.yScale.range()),this.model.marker.axis_y.scale=d3.scale.genericLog().domain([this.model.marker.axis_y.zoomedMin,this.model.marker.axis_y.zoomedMax]).range(this.yScale.range()),this.yScale=this.model.marker.axis_y.scale):this.yScale.domain([this.model.marker.axis_y.zoomedMin,this.model.marker.axis_y.zoomedMax]),this.yAxisEl.call(this.yAxis))},getNearestKey:function(t,e,i){for(var n=Object.keys(e),a=n[0],r=1;r<n.length;r++){var s=n[r];Math.abs((i?i(e[s]):e[s])-t)<Math.abs((i?i(e[a]):e[a])-t)&&(a=s)}return a}});e.default=m},function(t,e,i){"use strict";var n=i(13),a=i(56),r=i(12);t.exports=function(t){for(var e=n(this),i=r(e.length),s=arguments.length,o=a(s>1?arguments[1]:void 0,i),l=s>2?arguments[2]:void 0,c=void 0===l?i:a(l,i);c>o;)e[o++]=t;return e}},function(t,e,i){"use strict";var n=i(9),a=i(43);t.exports=function(t,e,i){e in t?n.f(t,e,a(0,i)):t[e]=i}},function(t,e,i){var n=i(6),a=i(4).document,r=n(a)&&n(a.createElement);t.exports=function(t){return r?a.createElement(t):{}}},function(t,e){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(t,e,i){var n=i(7)("match");t.exports=function(t){var e=/./;try{"/./"[t](e)}catch(i){try{return e[n]=!1,!"/./"[t](e)}catch(t){}}return!0}},function(t,e,i){t.exports=i(4).document&&document.documentElement},function(t,e,i){var n=i(6),a=i(103).set;t.exports=function(t,e,i){var r,s=e.constructor;return s!==i&&"function"==typeof s&&(r=s.prototype)!==i.prototype&&n(r)&&a&&a(t,r),t}},function(t,e,i){var n=i(62),a=i(7)("iterator"),r=Array.prototype;t.exports=function(t){return void 0!==t&&(n.Array===t||r[a]===t)}},function(t,e,i){var n=i(28);t.exports=Array.isArray||function(t){return"Array"==n(t)}},function(t,e,i){"use strict";var n=i(51),a=i(43),r=i(63),s={};i(17)(s,i(7)("iterator"),function(){return this}),t.exports=function(t,e,i){t.prototype=n(s,{next:a(1,i)}),r(t,e+" Iterator")}},function(t,e,i){"use strict";var n=i(50),a=i(0),r=i(18),s=i(17),o=i(15),l=i(62),c=i(98),h=i(63),u=i(26),d=i(7)("iterator"),f=!([].keys&&"next"in[].keys()),m="@@iterator",p="keys",g="values",v=function(){return this};t.exports=function(t,e,i,b,y,x,_){c(i,e,b);var M,w,z,S=function(t){if(!f&&t in T)return T[t];switch(t){case p:return function(){return new i(this,t)};case g:return function(){return new i(this,t)}}return function(){return new i(this,t)}},k=e+" Iterator",E=y==g,O=!1,T=t.prototype,P=T[d]||T[m]||y&&T[y],D=P||S(y),I=y?E?S("entries"):D:void 0,C="Array"==e?T.entries||P:P;if(C&&(z=u(C.call(new t)),z!==Object.prototype&&(h(z,k,!0),n||o(z,d)||s(z,d,v))),E&&P&&P.name!==g&&(O=!0,D=function(){return P.call(this)}),n&&!_||!f&&!O&&T[d]||s(T,d,D),l[e]=D,l[k]=v,y)if(M={values:E?D:S(g),keys:x?D:S(p),entries:I},_)for(w in M)w in T||r(T,w,M[w]);else a(a.P+a.F*(f||O),e,M);return M}},function(t,e){var i=Math.expm1;t.exports=!i||i(10)>22025.465794806718||i(10)<22025.465794806718||i(-2e-17)!=-2e-17?function(t){return 0==(t=+t)?t:t>-1e-6&&t<1e-6?t+t*t/2:Math.exp(t)-1}:i},function(t,e){t.exports=Math.sign||function(t){return 0==(t=+t)||t!=t?t:t<0?-1:1}},function(t,e,i){var n=i(4),a=i(110).set,r=n.MutationObserver||n.WebKitMutationObserver,s=n.process,o=n.Promise,l="process"==i(28)(s);t.exports=function(){var t,e,i,c=function(){var n,a;for(l&&(n=s.domain)&&n.exit();t;){a=t.fn,t=t.next;try{a()}catch(n){throw t?i():e=void 0,n}}e=void 0,n&&n.enter()};if(l)i=function(){s.nextTick(c)};else if(r){var h=!0,u=document.createTextNode("");new r(c).observe(u,{characterData:!0}),i=function(){u.data=h=!h}}else if(o&&o.resolve){var d=o.resolve();i=function(){d.then(c)}}else i=function(){a.call(n,c)};return function(n){var a={fn:n,next:void 0};e&&(e.next=a),t||(t=a,i()),e=a}}},function(t,e,i){var n=i(6),a=i(3),r=function(t,e){if(a(t),!n(e)&&null!==e)throw TypeError(e+": can't set as prototype!")};t.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(t,e,n){try{n=i(36)(Function.call,i(25).f(Object.prototype,"__proto__").set,2),n(t,[]),e=!(t instanceof Array)}catch(t){e=!0}return function(t,i){return r(t,i),e?t.__proto__=i:n(t,i),t}}({},!1):void 0),check:r}},function(t,e,i){var n=i(81)("keys"),a=i(57);t.exports=function(t){return n[t]||(n[t]=a(t))}},function(t,e,i){var n=i(3),a=i(16),r=i(7)("species");t.exports=function(t,e){var i,s=n(t).constructor;return void 0===s||void 0==(i=n(s)[r])?e:a(i)}},function(t,e,i){var n=i(44),a=i(29);t.exports=function(t){return function(e,i){var r,s,o=String(a(e)),l=n(i),c=o.length;return l<0||l>=c?t?"":void 0:(r=o.charCodeAt(l),r<55296||r>56319||l+1===c||(s=o.charCodeAt(l+1))<56320||s>57343?t?o.charAt(l):r:t?o.slice(l,l+2):(r-55296<<10)+(s-56320)+65536)}}},function(t,e,i){var n=i(77),a=i(29);t.exports=function(t,e,i){if(n(e))throw TypeError("String#"+i+" doesn't accept regex!");return String(a(t))}},function(t,e,i){"use strict";var n=i(44),a=i(29);t.exports=function(t){var e=String(a(this)),i="",r=n(t);if(r<0||r==1/0)throw RangeError("Count can't be negative");for(;r>0;(r>>>=1)&&(e+=e))1&r&&(i+=e);return i}},function(t,e){t.exports="\t\n\v\f\r \u2028\u2029\ufeff"},function(t,e,i){var n,a,r,s=i(36),o=i(76),l=i(94),c=i(91),h=i(4),u=h.process,d=h.setImmediate,f=h.clearImmediate,m=h.MessageChannel,p=0,g={},v="onreadystatechange",b=function(){var t=+this;if(g.hasOwnProperty(t)){var e=g[t];delete g[t],e()}},y=function(t){b.call(t.data)};d&&f||(d=function(t){for(var e=[],i=1;arguments.length>i;)e.push(arguments[i++]);return g[++p]=function(){o("function"==typeof t?t:Function(t),e)},n(p),p},f=function(t){delete g[t]},"process"==i(28)(u)?n=function(t){u.nextTick(s(b,t,1))}:m?(a=new m,r=a.port2,a.port1.onmessage=y,n=s(r.postMessage,r,1)):h.addEventListener&&"function"==typeof postMessage&&!h.importScripts?(n=function(t){h.postMessage(t+"","*")},h.addEventListener("message",y,!1)):n=v in c("script")?function(t){l.appendChild(c("script"))[v]=function(){l.removeChild(this),b.call(t)}}:function(t){setTimeout(s(b,t,1),0)}),t.exports={set:d,clear:f}},function(t,e,i){"use strict";var n=i(4),a=i(8),r=i(50),s=i(82),o=i(17),l=i(54),c=i(5),h=i(49),u=i(44),d=i(12),f=i(52).f,m=i(9).f,p=i(89),g=i(63),v="ArrayBuffer",b="DataView",y="prototype",x="Wrong length!",_="Wrong index!",M=n[v],w=n[b],z=n.Math,S=n.RangeError,k=n.Infinity,E=M,O=z.abs,T=z.pow,P=z.floor,D=z.log,I=z.LN2,C="buffer",A="byteLength",L="byteOffset",R=a?"_b":C,j=a?"_l":A,N=a?"_o":L,F=function(t,e,i){var n,a,r,s=Array(i),o=8*i-e-1,l=(1<<o)-1,c=l>>1,h=23===e?T(2,-24)-T(2,-77):0,u=0,d=t<0||0===t&&1/t<0?1:0;for(t=O(t),t!=t||t===k?(a=t!=t?1:0,n=l):(n=P(D(t)/I),t*(r=T(2,-n))<1&&(n--,r*=2),t+=n+c>=1?h/r:h*T(2,1-c),t*r>=2&&(n++,r/=2),n+c>=l?(a=0,n=l):n+c>=1?(a=(t*r-1)*T(2,e),n+=c):(a=t*T(2,c-1)*T(2,e),n=0));e>=8;s[u++]=255&a,a/=256,e-=8);for(n=n<<e|a,o+=e;o>0;s[u++]=255&n,n/=256,o-=8);return s[--u]|=128*d,s},B=function(t,e,i){var n,a=8*i-e-1,r=(1<<a)-1,s=r>>1,o=a-7,l=i-1,c=t[l--],h=127&c;for(c>>=7;o>0;h=256*h+t[l],l--,o-=8);for(n=h&(1<<-o)-1,h>>=-o,o+=e;o>0;n=256*n+t[l],l--,o-=8);if(0===h)h=1-s;else{if(h===r)return n?NaN:c?-k:k;n+=T(2,e),h-=s}return(c?-1:1)*n*T(2,h-e)},q=function(t){return t[3]<<24|t[2]<<16|t[1]<<8|t[0]},H=function(t){return[255&t]},Y=function(t){return[255&t,t>>8&255]},V=function(t){return[255&t,t>>8&255,t>>16&255,t>>24&255]},X=function(t){return F(t,52,8)},W=function(t){return F(t,23,4)},K=function(t,e,i){m(t[y],e,{get:function(){return this[i]}})},U=function(t,e,i,n){var a=+i,r=u(a);if(a!=r||r<0||r+e>t[j])throw S(_);var s=t[R]._b,o=r+t[N],l=s.slice(o,o+e);return n?l:l.reverse()},G=function(t,e,i,n,a,r){var s=+i,o=u(s);if(s!=o||o<0||o+e>t[j])throw S(_);for(var l=t[R]._b,c=o+t[N],h=n(+a),d=0;d<e;d++)l[c+d]=h[r?d:e-d-1]},Q=function(t,e){h(t,M,v);var i=+e,n=d(i);if(i!=n)throw S(x);return n};if(s.ABV){if(!c(function(){new M})||!c(function(){new M(.5)})){M=function(t){return new E(Q(this,t))};for(var Z,$=M[y]=E[y],J=f(E),tt=0;J.length>tt;)(Z=J[tt++])in M||o(M,Z,E[Z]);r||($.constructor=M)}var et=new w(new M(2)),it=w[y].setInt8;et.setInt8(0,2147483648),et.setInt8(1,2147483649),!et.getInt8(0)&&et.getInt8(1)||l(w[y],{setInt8:function(t,e){it.call(this,t,e<<24>>24)},setUint8:function(t,e){it.call(this,t,e<<24>>24)}},!0)}else M=function(t){var e=Q(this,t);this._b=p.call(Array(e),0),this[j]=e},w=function(t,e,i){h(this,w,b),h(t,M,b);var n=t[j],a=u(e);if(a<0||a>n)throw S("Wrong offset!");if(i=void 0===i?n-a:d(i),a+i>n)throw S(x);this[R]=t,this[N]=a,this[j]=i},a&&(K(M,A,"_l"),K(w,C,"_b"),K(w,A,"_l"),K(w,L,"_o")),l(w[y],{getInt8:function(t){return U(this,1,t)[0]<<24>>24},getUint8:function(t){return U(this,1,t)[0]},getInt16:function(t){var e=U(this,2,t,arguments[1]);return(e[1]<<8|e[0])<<16>>16},getUint16:function(t){var e=U(this,2,t,arguments[1]);return e[1]<<8|e[0]},getInt32:function(t){return q(U(this,4,t,arguments[1]))},getUint32:function(t){return q(U(this,4,t,arguments[1]))>>>0},getFloat32:function(t){return B(U(this,4,t,arguments[1]),23,4)},getFloat64:function(t){return B(U(this,8,t,arguments[1]),52,8)},setInt8:function(t,e){G(this,1,t,H,e)},setUint8:function(t,e){G(this,1,t,H,e)},setInt16:function(t,e){G(this,2,t,Y,e,arguments[2])},setUint16:function(t,e){G(this,2,t,Y,e,arguments[2])},setInt32:function(t,e){G(this,4,t,V,e,arguments[2])},setUint32:function(t,e){G(this,4,t,V,e,arguments[2])},setFloat32:function(t,e){G(this,4,t,W,e,arguments[2])},setFloat64:function(t,e){G(this,8,t,X,e,arguments[2])}});g(M,v),g(w,b),o(w[y],s.VIEW,!0),e[v]=M,e[b]=w},function(t,e,i){var n=i(4),a=i(35),r=i(50),s=i(176),o=i(9).f;t.exports=function(t){var e=a.Symbol||(a.Symbol=r?{}:n.Symbol||{});"_"==t.charAt(0)||t in e||o(e,t,{value:s.f(t)})}},function(t,e,i){var n=i(67),a=i(7)("iterator"),r=i(62);t.exports=i(35).getIteratorMethod=function(t){if(void 0!=t)return t[a]||t["@@iterator"]||r[n(t)]}},function(t,e,i){"use strict";var n=i(60),a=i(164),r=i(62),s=i(20);t.exports=i(99)(Array,"Array",function(t,e){this._t=s(t),this._i=0,this._k=e},function(){var t=this._t,e=this._k,i=this._i++;return!t||i>=t.length?(this._t=void 0,a(1)):"keys"==e?a(0,i):"values"==e?a(0,t[i]):a(0,[i,t[i]])},"values"),r.Arguments=r.Array,n("keys"),n("values"),n("entries")},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),s=(a(r),i(22)),o=n(s),l=i(10),c=(a(l),"vzb-active"),h=o.default.extend({init:function(t,e){this.name="gapminder-optionsbuttonlist",this._super(t,e)},readyOnce:function(){var t=this;Object.keys(this._available_buttons).forEach(function(e){var i=t._available_buttons[e];i.required=!i.required}),this.buttonListComp=this.root.findChildByName("gapminder-buttonlist"),this.buttonListComp.on("click",function(e,i){var n=t.element.selectAll(".vzb-buttonlist-btn[data-btn='"+i.id+"']");n.classed(c,i.active)}),this.buttonListComp.on("toggle",function(e,i){var n=t.element.selectAll(".vzb-buttonlist-btn"),a=0;n.each(function(t){var e=d3.select(this),n=i.hiddenButtons.indexOf(t.id)==-1;e.style("display",n?"none":""),n||a++})}),this._super()},proceedClick:function(t){var e=this;this.buttonListComp.proceedClick(t);var i=this.element.selectAll(".vzb-buttonlist-btn[data-btn='"+t+"']").datum();i.func&&setTimeout(function(){e.root.findChildByName("gapminder-dialogs").closeAllDialogs()},200)},_toggleButtons:function(){}});e.default=h},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),s=(a(r),i(11)),o=n(s),l=i(45),c=n(l),h=o.default.extend({init:function(t,e){this.name="about",this._super(t,e)},readyOnce:function(){var t=c.default.version,e=new Date(parseInt(c.default.build));this.element=d3.select(this.element),this.element.select(".vzb-about-text0").html("This chart is made with Vizabi,"),this.element.select(".vzb-about-text1").html("a project by <a href='http://gapminder.org'>Gapminder Foundation</a>"),this.element.select(".vzb-about-version").html("<a href='https://github.com/Gapminder/vizabi/releases/tag/v"+t+"'>Version: "+t+" (alpha)</a>"),this.element.select(".vzb-about-updated").html("Build: "+d3.time.format("%Y-%m-%d at %H:%M")(e)),this.element.select(".vzb-about-text2").html("Alpha version: don't expect too much!"),this.element.select(".vzb-about-report").html("<a href='https://getsatisfaction.com/gapminder/'>Report a problem</a>"),this.element.select(".vzb-about-credits").html("<a href='https://github.com/Gapminder/vizabi/graphs/contributors'>Contributors</a>")}});e.default=h},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),s=(a(r),i(2)),o=(n(s),i(11)),l=n(o),c=i(48),h=n(c),u=i(85),d=n(u),f=l.default.extend({init:function(t,e){this.name="axes";this.components=[{component:h.default,placeholder:".vzb-xaxis-selector",model:["state.time","state.entities","state.marker","locale"],markerID:"axis_x"},{component:d.default,placeholder:".vzb-xaxis-minmax",model:["state.marker","state.time","locale"],markerID:"axis_x",ui:{selectDomainMinMax:!1,selectZoomedMinMax:!0}},{component:h.default,placeholder:".vzb-yaxis-selector",model:["state.time","state.entities","state.marker","locale"],markerID:"axis_y"},{component:d.default,placeholder:".vzb-yaxis-minmax",model:["state.marker","state.time","locale"],markerID:"axis_y",ui:{selectDomainMinMax:!1,selectZoomedMinMax:!0}}],this._super(t,e)}});e.default=f},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),s=(a(r),i(2)),o=(n(s),i(11)),l=n(o),c=i(85),h=n(c),u=l.default.extend({init:function(t,e){this.name="axesmc";var i=this;this.model_binds={"change:ui.chart.xLogStops":function(){i.updateView()},"change:ui.chart.yMaxMethod":function(){i.updateView()}},this.components=[{component:h.default,placeholder:".vzb-xlimits-container",model:["state.marker","state.time","locale"],markerID:"axis_x",ui:{selectDomainMinMax:!1,selectZoomedMinMax:!0}}],this._super(t,e)},readyOnce:function(){this._super();var t=this;this.yMaxRadio=this.element.select(".vzb-yaxis-container").selectAll("input").on("change",function(){t.setModel("yMaxMethod",d3.select(this).node().value)}),this.xLogStops=this.element.select(".vzb-xaxis-container").selectAll("input").on("change",function(){t.setModel("xLogStops",d3.select(this).node().value)}),this.probeCheck=this.element.select(".vzb-probe-check").on("change",function(){t.setModel("showProbeX",d3.select(this).property("checked"))}),this.probeFieldEl=this.element.select(".vzb-probe-field").on("change",function(){var e=parseFloat(this.value.replace(",","."));return!e||e<=t.model.state.marker.axis_x.tailCutX?void(this.value=t.model.ui.chart.probeX):(e>t.model.state.marker.axis_x.domainMax&&(e=t.model.state.marker.axis_x.domainMax),this.value=e,void t.setModel("probeX",e))}),this.updateView()},updateView:function(){var t=this;this.yMaxRadio.property("checked",function(){return d3.select(this).node().value===t.model.ui.chart.yMaxMethod}),this.xLogStops.property("checked",function(){return t.model.ui.chart.xLogStops.indexOf(+d3.select(this).node().value)!==-1}),this.probeCheck.property("checked",this.model.ui.chart.showProbeX),this.probeFieldEl.property("value",this.model.ui.chart.probeX)},setModel:function(t,e){var i;"yMaxMethod"==t&&(i=e),"xLogStops"==t&&(i=[],this.xLogStops.each(function(){d3.select(this).property("checked")&&i.push(+d3.select(this).node().value)})),"probeX"!=t&&"showProbeX"!=t||(i=e),this.model.ui.chart[t]=i}});e.default=u},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),s=(a(r),i(2)),o=(n(s),i(11)),l=n(o),c=i(84),h=n(c),u=i(48),d=n(u),f=l.default.extend({init:function(t,e){this.name="colors",this.components=[{component:d.default,placeholder:".vzb-caxis-selector",model:["state.time","state.entities","state.marker","locale"],markerID:"color",showHoverValues:!0},{component:h.default,placeholder:".vzb-clegend-container",model:["state.time","state.entities","state.marker","locale"]}],this._super(t,e)}});e.default=f},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),s=a(r),o=i(2),l=(n(o),i(11)),c=n(l),h=i(65),u=n(h),d=c.default.extend({init:function(t,e){this.name="find";var i=this;this.components=[{component:u.default,placeholder:".vzb-dialog-bubbleopacity",model:["state.marker"],arg:"opacitySelectDim",properties:{step:.01}}],this.model_binds={"change:state.marker.select":function(t){i.selectDataPoints(),i.showHideDeselect()},"change:state.time.playing":function(t){i.model.state.time.playing||(i.time=i.model.state.time.value,i.model.state.marker.getFrame(i.time,function(t,e){!t||i.time-e||i.redrawDataPoints(t)}))},"change:state.time.value":function(t){(i.placeholderEl.classed("vzb-active")||i.placeholderEl.classed("vzb-sidebar"))&&(i.time=i.model.state.time.value,i.model.state.marker.getFrame(i.time,function(t){t&&i.redrawDataPoints(t)}))},"translate:locale":function(){i.input_search.attr("placeholder",i.translator("placeholder/search")+"...")}},this._super(t,e)},readyOnce:function(){this._super(),this.list=this.element.select(".vzb-find-list"),this.input_search=this.element.select(".vzb-find-search"),this.deselect_all=this.element.select(".vzb-find-deselect"),this.opacity_nonselected=this.element.select(".vzb-dialog-bubbleopacity"),this.KEY=this.model.state.entities.getDimension();var t=this;this.input_search.on("keyup",function(){var e=d3.event;13==e.keyCode&&"select all"==t.input_search.node().value&&(t.input_search.node().value="",s.isTouchDevice()||t.model.state.marker.clearHighlighted(),t.model.state.marker.selectAll())}),this.input_search.on("input",function(){t.showHideSearch()}),this.deselect_all.on("click",function(){t.deselectMarkers()}),this.translator=this.model.locale.getTFunction(),this.input_search.attr("placeholder",this.translator("placeholder/search")+"..."),this.root.on("ready",function(){t.ready()})},open:function(){var t=this;this._super(),this.input_search.node().value="",this.showHideSearch(),this.time=this.model.state.time.value,this.model.state.marker.getFrame(this.time,function(e){e&&t.redrawDataPoints(e)})},ready:function(){this._super();var t=this,e=this.KEY;this.time=this.model.state.time.value,this.model.state.marker.getFrame(this.time,function(i){if(i){var n=t.model.state.marker.getKeys().map(function(t){var n={};return n[e]=t[e],n.brokenData=!1,n.name=i.label[t[e]],n});n.sort(function(t,e){return t.name<e.name?-1:1}),t.list.html(""),t.items=t.list.selectAll(".vzb-find-item").data(n).enter().append("div").attr("class","vzb-find-item vzb-dialog-checkbox"),t.items.append("input").attr("type","checkbox").attr("class","vzb-find-item").attr("id",function(i){return"-find-"+i[e]+"-"+t._id}).on("change",function(e){s.isTouchDevice()||t.model.state.marker.clearHighlighted(),t.model.state.marker.selectMarker(e),s.isTouchDevice()||e.brokenData||t.model.state.marker.highlightMarker(e)}),t.items.append("label").attr("for",function(i){return"-find-"+i[e]+"-"+t._id}).text(function(t){return t.name}).on("mouseover",function(e){s.isTouchDevice()||e.brokenData||t.model.state.marker.highlightMarker(e)}).on("mouseout",function(e){s.isTouchDevice()||t.model.state.marker.clearHighlighted()}),s.preventAncestorScrolling(t.element.select(".vzb-dialog-scrollable")),t.redrawDataPoints(i),t.selectDataPoints(),t.showHideSearch(),t.showHideDeselect()}})},redrawDataPoints:function(t){var e=this,i=this.KEY;e.items.each(function(n){var a=d3.select(this).select("label");n.brokenData=!1,s.forEach(t,function(t,a){"color"===a||"size_label"===a||"constant"===e.model.state.marker[a].use||t[n[i]]||0===t[n[i]]||(n.brokenData=!0)}),a.classed("vzb-find-item-brokendata",n.brokenData).attr("title",n.brokenData?e.model.state.time.formatDate(e.time)+": "+e.translator("hints/nodata"):"")})},selectDataPoints:function(){var t=this.KEY,e=this.model.state.marker.getSelected(t);this.items.selectAll("input").property("checked",function(i){return e.indexOf(i[t])!==-1})},showHideSearch:function(){var t=this.input_search.node().value||"";t=t.toLowerCase(),this.list.selectAll(".vzb-find-item").classed("vzb-hidden",function(e){var i=(e.name||"").toLowerCase();return i.indexOf(t)===-1})},showHideDeselect:function(){var t=!!this.model.state.marker.select.length;this.deselect_all.classed("vzb-hidden",!t),this.opacity_nonselected.classed("vzb-hidden",!t)},deselectMarkers:function(){this.model.state.marker.clearSelected()},transitionEnd:function(t){this._super(t),s.isTouchDevice()||this.input_search.node().focus()}});e.default=d},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),s=(a(r),i(2)),o=(n(s),i(11)),l=n(o),c=i(133),h=n(c),u=i(48),d=n(u),f=i(58),m=n(f),p=l.default.extend({init:function(t,e){this.name="label",this.components=[{component:h.default,placeholder:".vzb-dialog-sizeslider",model:["state.marker.size_label","locale"],propertyname:"LabelTextSize",ui:{constantUnit:"unit/pixels"}},{component:d.default,placeholder:".vzb-saxis-selector",model:["state.time","state.entities","state.marker","locale"],markerID:"size_label",showHoverValues:!0},{component:m.default,placeholder:".vzb-removelabelbox-switch",model:["ui.chart","locale"],checkbox:"removeLabelBox",submodel:"labels"}],this._super(t,e)}});e.default=p},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),s=a(r),o=i(2),l=(n(o),i(11)),c=n(l),h=i(65),u=(n(h),i(83)),d=(n(u),i(84)),f=(n(d),i(48)),m=(n(f),i(58)),p=(n(m),i(115)),g=n(p),v=c.default.extend({init:function(t,e){this.name="moreoptions",this.components=[{component:g.default,placeholder:".vzb-dialog-options-buttonlist",model:["state","ui","locale"]}],this._super(t,e)},readyOnce:function(){this._super();var t=this;this.accordionEl=this.contentEl.select(".vzb-accordion"),this.on("dragend",function(){t._setMaxHeight()});var e=(this.model.ui.dialogs||{}).popup||[],i=(this.model.ui.dialogs||{}).moreoptions||[];if(i===!0&&(i=e,(this.model.ui.dialogs||{}).moreoptions=i),this._addDialogs(i),this.accordionEl){var n=this.accordionEl.selectAll(".vzb-accordion-section").select(".vzb-dialog-title>span:first-child");n.on("click",function(e){var i=(t.components[e.component].element,t.components[e.component].placeholderEl),n=t.accordionEl.select(".vzb-accordion-active");n&&n.classed("vzb-accordion-active",!1),i.node()!==n.node()&&i.classed("vzb-accordion-active",!0)})}},_addDialogs:function(t){this._components_config=[];var e=[];if(t.length){for(var i=0;i<t.length;i++)if("moreoptions"!==t[i]){var n=t[i],a=s.deepClone(this.parent._available_dialogs[n]);if(a&&a.dialog){var r=this._components_config;r.push({component:a.dialog,placeholder:'.vzb-dialogs-dialog[data-dlg="'+n+'"]',model:["state","ui","locale"]}),a.component=r.length-1,a.id=n,e.push(a)}}this.accordionEl.selectAll("div").data(e).enter().append("div").attr("class",function(t){var e="vzb-dialogs-dialog vzb-moreoptions vzb-accordion-section";return e}).attr("data-dlg",function(t){return t.id}),this.loadSubComponents();var o=this;s.forEach(this.components,function(t){t.render(),o.on("resize",function(){t.trigger("resize")})})}}});e.default=v},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),s=(a(r),i(2)),o=(n(s),i(11)),l=n(o),c=i(65),h=n(c),u=l.default.extend({init:function(t,e){this.name="opacity",this.components=[{component:h.default,placeholder:".vzb-dialog-bubbleopacity-regular",model:["state.marker"],arg:"opacityRegular",properties:{step:.01}},{component:h.default,placeholder:".vzb-dialog-bubbleopacity-selectdim",model:["state.marker"],arg:"opacitySelectDim",properties:{step:.01}}],this._super(t,e)}});e.default=u},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),s=(a(r),i(2)),o=(n(s),i(11)),l=n(o),c=i(58),h=n(c),u=l.default.extend({init:function(t,e){this.name="presentation",this.components=[{component:h.default,placeholder:".vzb-presentationmode-switch",model:["ui","locale"],checkbox:"presentation"}],this._super(t,e)}});e.default=u},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),s=a(r),o=i(2),l=(n(o),i(11)),c=n(l),h=c.default.extend({init:function(t,e){this.name="show";var i=this;this.model_binds={"change:state.entities.show":function(t){i.redraw()}},this._super(t,e)},readyOnce:function(){this._super(),this.list=this.element.select(".vzb-show-list"),this.input_search=this.element.select(".vzb-show-search"),this.deselect_all=this.element.select(".vzb-show-deselect"),this.KEY=this.model.state.entities.getDimension(),this.TIMEDIM=this.model.state.time.getDimension();var t=this;this.input_search.on("input",function(){t.showHideSearch()}),this.deselect_all.on("click",function(){t.deselectEntities()}),this.root.on("ready",function(){t.redraw()})},open:function(){this._super(),this.input_search.node().value="",this.showHideSearch()},ready:function(){this._super(),this.redraw(),s.preventAncestorScrolling(this.element.select(".vzb-dialog-scrollable"))},redraw:function(){var t=this;this.translator=this.model.locale.getTFunction(),this.model.state.marker_allpossible.getFrame(this.model.state.time.value,function(e){if(e){var i=s.keys(e.label).map(function(i){var n={};return n[t.KEY]=i,n.label=e.label[i],n});i.sort(function(t,e){return t.label<e.label?-1:1}),t.list.html("");var n=t.list.selectAll(".vzb-show-item").data(i).enter().append("div").attr("class","vzb-show-item vzb-dialog-checkbox");n.append("input").attr("type","checkbox").attr("class","vzb-show-item").attr("id",function(e){return"-show-"+e[t.KEY]+"-"+t._id}).property("checked",function(e){return t.model.state.entities.isShown(e)}).on("change",function(e){t.model.state.marker.clearSelected(),t.model.state.entities.showEntity(e),t.showHideDeselect()}),n.append("label").attr("for",function(e){return"-show-"+e[t.KEY]+"-"+t._id}).text(function(t){return t.label}),t.input_search.attr("placeholder",t.translator("placeholder/search")+"..."),t.showHideSearch(),t.showHideDeselect()}})},showHideSearch:function(){
var t=this.input_search.node().value||"";t=t.toLowerCase(),this.list.selectAll(".vzb-show-item").classed("vzb-hidden",function(e){var i=e.label.toLowerCase();return i.indexOf(t)===-1})},showHideDeselect:function(){var t=this.model.state.entities.show[this.KEY];this.deselect_all.classed("vzb-hidden",!t||0==t.length)},deselectEntities:function(){this.model.state.entities.clearShow(),this.showHideDeselect()},transitionEnd:function(t){this._super(t),s.isTouchDevice()||this.input_search.node().focus()}});e.default=h},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),s=a(r),o=i(2),l=(n(o),i(11)),c=n(l),h=i(48),u=n(h),d=i(58),f=(n(d),c.default.extend({init:function(t,e){this.name="side";var i=this;this.model_binds={"change:state.marker.side.which":function(t){if(i.model.state.entities_allpossibleside){var e="constant"==i.model.state.marker.side.use?null:i.model.state.marker.side.which;i.model.state.entities_allpossibleside.set("dim",e)}},"change:state.entities_side.show":function(t){i._readyOnce&&(i.updateState(),i.redraw())},"change:ui.chart.flipSides":function(t){i._readyOnce&&(i.updateState(),i.redraw())}},this.components=[{component:u.default,placeholder:".vzb-side-selector",model:["state.time","state.entities_side","state.marker","locale"],markerID:"side",showHoverValues:!1}],this._super(t,e)},readyOnce:function(){this._super(),this.listLeft=this.element.select(".vzb-side-list-left"),this.listRight=this.element.select(".vzb-side-list-right"),this.switchSides=this.element.select(".vzb-side-switch-sides"),this.TIMEDIM=this.model.state.time.getDimension(),this.state={};var t=this;this.switchSides.on("click",function(){t.model.ui.chart.flipSides=!t.model.ui.chart.flipSides}),this.root.on("ready",function(){t.redraw()})},ready:function(){this._super(),this.KEY=this.model.state.entities_side.getDimension(),this.updateState(),this.redraw(),s.preventAncestorScrolling(this.element.select(".vzb-dialog-scrollable"))},updateState:function(){var t=this,e=this.model.state.marker.side.getEntity().getDimension(),i=this.model.state.marker.side;if(this.state.right={},this.state.left={},i.state.left[e]&&i.state.right[e])this.state.left[e]=i.state.left[e],this.state.right[e]=i.state.right[e];else{var n=this.model.state.marker.getKeys(e),a=[],r=!!this.model.state.marker.side.getEntity().show[e];if(a=n.filter(function(e){return!r||t.model.state.marker.side.getEntity().isShown(e)}).map(function(t){return t[e]}),a.length>2&&(a.length=2),a.length>1){var s=this.ui.chart.flipSides?d3.ascending:d3.descending;a.sort(s)}this.state.right={},this.state.right[e]=a[0],this.state.left={},this.state.left[e]=a[1]?a[1]:a[0]}var o="constant"==this.model.state.marker.side.use;this.listLeft.classed("vzb-hidden",o),this.listRight.classed("vzb-hidden",o),this.switchSides.classed("vzb-hidden",o||this.state.left[e]==this.state.right[e])},redraw:function(){var t=this;this.translator=this.model.locale.getTFunction(),t.model.state.entities_allpossibleside.dim&&this.model.state.marker_allpossibleside.getFrame(this.model.state.time.value,function(e){if(e){var i=s.keys(e.label).map(function(i){var n={};return n[t.KEY]=i,n.label=e.label[i],n});i.sort(function(t,e){return t.label<e.label?-1:1}),t.listLeft.html(""),t.listRight.html(""),t.createList(t.listLeft,"left",i),t.createList(t.listRight,"right",i)}})},createList:function(t,e,i){var n=this,a=this.model.state.marker.side.getEntity().getDimension(),r=t.selectAll(".vzb-side-item").data(i).enter().append("div").attr("class","vzb-side-item vzb-dialog-radio");r.append("input").attr("type","radio").attr("name",e+"-"+n._id).attr("class","vzb-side-item").attr("id",function(t){return"-side-"+e+"-"+t[a]+"-"+n._id}).property("checked",function(t){return n.state[e][a]===t[a]}).on("change",function(t,i){var a=n.model.state.entities_side,r=a.getDimension(),s="left"==e?"right":"left",o=n.model.state.marker.side;o.state[e][r]=t[r],o.state[s][r]=n.state[s][r];var l=[];if(a.isShown(t)||l.push(t),t[r]===n.state[s][r]||a.isShown(n.state[s])||l.push(n.state[s]),n.state[e][r]!==n.state[s][r]&&a.isShown(n.state[e])&&l.push(n.state[e]),t[r]!==n.state[s][r]){var c=[t[r],n.state[s][r]],h=n.ui.chart.flipSides?d3.ascending:d3.descending;c.sort(h),c["left"==e?0:1]==t[r]&&(n.model.state.marker.side.switchSideState(),n.ui.chart.flipSides=!n.ui.chart.flipSides)}l.length&&a.showEntity(l)}),r.append("label").attr("for",function(t){return"-side-"+e+"-"+t[n.KEY]+"-"+n._id}).text(function(t){return t.label})}}));e.default=f},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),s=(a(r),i(2)),o=(n(s),i(11)),l=n(o),c=i(83),h=n(c),u=i(48),d=n(u),f=l.default.extend({init:function(t,e){this.name="size",this.components=[{component:d.default,placeholder:".vzb-saxis-selector",model:["state.time","state.entities","state.marker","locale"],markerID:"size",showHoverValues:!0}],t.ui.chart&&0===t.ui.chart.sizeSelectorActive||this.components.push({component:h.default,placeholder:".vzb-dialog-bubblesize",model:["state.marker.size"],ui:{show_button:!1}}),this._super(t,e)}});e.default=f},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),s=(a(r),i(2)),o=(n(s),i(11)),l=n(o),c=i(65),h=n(c),u=l.default.extend({init:function(t,e){this.name="speed",this.components=[{component:h.default,placeholder:".vzb-dialog-placeholder",model:["state.time"],arg:"delay",properties:{min:1,max:6,step:.1,scale:d3.scale.linear().domain([1,2,3,4,5,6]).range([1200,900,450,200,150,100])}}],this._super(t,e)}});e.default=u},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),s=(a(r),i(2)),o=(n(s),i(11)),l=n(o),c=i(132),h=n(c),u=l.default.extend({init:function(t,e){this.name="stack";var i=this;this.components=[{component:h.default,placeholder:".vzb-dialog-draggablelist",model:["state.marker.group","state.marker.color","locale","ui.chart"],groupID:"manualSorting",isEnabled:"manualSortingEnabled",dataArrFn:i.manualSorting.bind(i),lang:""}],this.model_binds={"change:state.marker.group":function(t){i._ready&&i.updateView()}},this._super(t,e)},readyOnce:function(){this._super();var t=this;this.group=this.model.state.marker.group,this.stack=this.model.state.marker.stack,this.howToStackEl=this.element.select(".vzb-howtostack").selectAll("input").on("change",function(){t.setModel("stack",d3.select(this).node().value)}),this.howToMergeEl=this.element.select(".vzb-howtomerge").selectAll("input").on("change",function(){t.setModel("merge",d3.select(this).node().value)}),this.updateView()},ready:function(){if(this._super(),!this.model.state.marker.color.isDiscrete()){if("property"==this.stack.use)return void this.setModel("stack","none");if(this.group.merge)return void this.setModel("merge","none")}this.updateView()},updateView:function(){var t=this;this.howToStackEl.property("checked",function(){return"none"===d3.select(this).node().value?"none"===t.stack.which:"bycolor"===d3.select(this).node().value?t.stack.which===t.model.state.marker.color.which:"all"===d3.select(this).node().value?"all"===t.stack.which:void 0}).attr("disabled",function(){return"none"===d3.select(this).node().value?null:"all"===d3.select(this).node().value?null:"bycolor"===d3.select(this).node().value?"property"!==t.model.state.marker.color.use||null:void 0}),t.model.ui.chart.manualSortingEnabled="all"==t.stack.which,this.howToMergeEl.property("checked",function(){return"none"===d3.select(this).node().value?!t.group.merge&&!t.stack.merge:"grouped"===d3.select(this).node().value?t.group.merge:"stacked"===d3.select(this).node().value?t.stack.merge:void 0}).attr("disabled",function(){return"none"===d3.select(this).node().value?null:"grouped"===d3.select(this).node().value?"none"===t.stack.which||"property"!==t.model.state.marker.color.use||null:"stacked"===d3.select(this).node().value?"all"!==t.stack.which||null:void 0})},manualSorting:function(t){return 0===arguments.length?this.model.state.marker.group.manualSorting:void(this.model.state.marker.group.manualSorting=t)},setModel:function(t,e){var i={stack:{},group:{}};if("merge"===t)switch(e){case"none":i.group.merge=!1,i.stack.merge=!1;break;case"grouped":i.group.merge=!0,i.stack.merge=!1;break;case"stacked":i.group.merge=!1,i.stack.merge=!0}if("stack"===t){switch(e){case"all":i.stack.use="constant",i.stack.which="all";break;case"none":i.stack.use="constant",i.stack.which="none";break;case"bycolor":i.stack.use="property",i.stack.which=this.model.state.marker.color.which}"none"===e&&this.group.merge&&(i.group.merge=!1),"all"!==e&&this.stack.merge&&(i.stack.merge=!1)}this.model.state.marker.set(i)}});e.default=u},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var a=i(11),r=n(a),s=i(66),o=n(s),l=r.default.extend({init:function(t,e){var i=this;this.name="timedisplay",this.model_binds={"change:state.time.value":function(){i.updateTime()}},this._super(t,e)},ready:function(){this.updateTime()},readyOnce:function(){this._super(),this.timeLabel=new o.default(this.element.select(".vzb-timedisplay")),this.timeLabel.setConditions({widthRatio:1,heightRatio:1}),this.timeLabel.resize(this.contentEl.style("width"),this.contentEl.style("height"))},updateTime:function(){var t=this.model.state.time;this.time_1=null==this.time?t.value:this.time,this.time=t.value;var e=t.playing&&this.time-this.time_1>0?t.delayAnimations:0;this.timeLabel.setText(t.formatDate(this.time,"ui"),e)}});e.default=l},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),s=(a(r),i(2)),o=(n(s),i(11)),l=n(o),c=i(135),h=n(c),u=i(58),d=n(u),f=l.default.extend({init:function(t,e){this.name="zoom",this.components=[{component:h.default,placeholder:".vzb-dialog-zoom-buttonlist",model:["state","ui","locale"]},{component:d.default,placeholder:".vzb-zoomonscrolling-switch",model:["ui","locale"],checkbox:"zoomOnScrolling"},{component:d.default,placeholder:".vzb-adaptminmaxzoom-switch",model:["ui","locale"],checkbox:"adaptMinMaxZoom"}],this._super(t,e)}});e.default=f},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),s=a(r),o=i(2),l=n(o),c=l.default.extend({init:function(t,e){this.template='<span class="vzb-dl-holder"><ul class="vzb-draggable list vzb-dialog-scrollable"></ul></span>';var i=this;this.name="draggableList",this.dataArrFn=t.dataArrFn,this.lang=t.lang,this.model_expects=[{name:"group",type:"model"},{name:"color",type:"color"},{name:"locale",type:"locale"},{name:"chart",type:"model"}],this.groupID=t.groupID,this.isEnabled=t.isEnabled,this.draggable=!0,t.groupID||s.warn("draggablelist.js complains on 'groupID' property: "+t.groupID),this.model_binds={"translate:locale":function(t){i.updateView()},"change:group.which":function(t){i.updateView()}},this.model_binds["change:group."+this.groupID]=function(t){i.updateView()},this.model_binds["change:chart."+this.isEnabled]=function(t){i.draggable=i.model.chart[i.isEnabled],i.updateView()},this._super(t,e),this.updateData=s.debounce(this.updateData,1e3),this.itemDragger=d3.behavior.drag().on("dragstart",function(t,e){!i.dataUpdateFlag&&i.draggable&&(d3.event.sourceEvent.stopPropagation(),i.parentBoundRect=i.element.node().getBoundingClientRect(),i.element.selectAll("div").each(function(e,n){var a=this.getBoundingClientRect();e._y=a.top,e._top=0,t.data===e.data&&(e._height=a.height,i.selectedNode=this)}),d3.select(i.selectedNode).classed("dragged",!0))}).on("drag",function(t,e){if(!i.dataUpdateFlag&&i.draggable){t._top+=d3.event.dy;var n=t._y+t._top;n>i.parentBoundRect.top&&n+t._height<i.parentBoundRect.top+i.parentBoundRect.height&&i.itemsEl.style("top",function(i,a){var r=0;return a<e&&i._y+.5*t._height>n?r=t._height:a>e&&i._y-.5*t._height<n&&(r=-t._height),a!=e&&(i._top=r),i._top+"px"})}}).on("dragend",function(t,e){!i.dataUpdateFlag&&i.draggable&&i.getData()})},ready:function(){var t=this,e=t.model.color.getColorlegendMarker().label.getItems();this.dataArrFn(s.keys(e)),this.updateView(),this.itemsEl=this.element.selectAll("div"),this.itemsEl.call(t.itemDragger);this.itemsEl.select("li").on("mouseover",function(){d3.select(this).classed("hover",!0)}).on("mouseout",function(){d3.select(this).classed("hover",!1)}).on("touchstart",function(){d3.event.preventDefault()})},updateView:function(){var t=this;this.items=this.element.selectAll("div").data(function(){return t.dataArrFn().map(function(t){return{data:t}})});var e=!!t.draggable||null;this.items.enter().append("div").append("li");var i=t.model.color.getColorlegendMarker().label.getItems();this.items.select("li").classed("hover",!1).each(function(t,e){d3.select(this).attr("data",t.data).text(i[t.data])}),this.items.exit().remove(),this.element.selectAll("div").style("top","").attr("draggable",e).classed("dragged",!1),this.dataUpdateFlag=!1},getData:function(){var t=[],e=this.element.selectAll("div").data();t=e.sort(function(t,e){return t._y+t._top-(e._y+e._top)}).map(function(t){return t.data}),s.arrayEquals(this.dataArrFn(),t)?this.updateView():(this.dataUpdateFlag=!0,this.updateData(t))},updateData:function(t){this.dataArrFn(t)},readyOnce:function(){this.element=d3.select(this.element).select(".list")}});e.default=c},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),s=a(r),o=i(2),l=n(o),c={EXTENT_MIN:0,EXTENT_MAX:1,TEXT_PARAMS:{TOP:18,LEFT:10,MAX_WIDTH:42,MAX_HEIGHT:16},BAR_WIDTH:6,THUMB_RADIUS:10,THUMB_STROKE_WIDTH:4,INTRO_DURATION:250,MARGIN:{TOP:2,LEFT:5,RIGHT:5}},h={small:{minLabelTextSize:7,maxLabelTextSize:21,defaultLabelTextSize:12},medium:{minLabelTextSize:7,maxLabelTextSize:30,defaultLabelTextSize:15},large:{minLabelTextSize:6,maxLabelTextSize:48,defaultLabelTextSize:20}},u=l.default.extend({init:function(t,e){function n(t,e){var i=a.model.size.extent||[c.EXTENT_MIN,c.EXTENT_MAX];a._updateLabels(i),a.sliderEl.call(a.brush.extent(i)),i[0]==i[1]&&a.sliderEl.selectAll(".resize").style("display","block")}this.name="sizeslider",this.template=this.template||i(442),this.propertyName=t.propertyname,this.model_expects=[{name:"size",type:"size"},{name:"locale",type:"locale"}];var a=this;this.model_binds={"change:size.domainMin":n,"change:size.domainMax":n,"change:size.extent":n,ready:function(){a.modelReady()}},this._setModel=s.throttle(this._setModel,50),this._super(t,e)},modelReady:function(){var t=this;t.modelUse=t.model.size.use;var e=t.model.size.extent||[c.EXTENT_MIN,c.EXTENT_MAX];if("constant"!=t.modelUse)t.sizeScaleMinMax=t.model.size.getScale().domain(),t.sliderEl.selectAll(".w").classed("vzb-hidden",!1),t.sliderEl.select(".extent").classed("vzb-hidden",!1),t.sliderEl.select(".background").classed("vzb-pointerevents-none",!1),t._setLabelsText();else if(t.sliderEl.selectAll(".w").classed("vzb-hidden",!0),t.sliderEl.select(".extent").classed("vzb-hidden",!0),t.sliderEl.select(".background").classed("vzb-pointerevents-none",!0),!t.model.size.which){var i=t.propertyActiveProfile;e[1]=(i.default-i.min)/(i.max-i.min),t.model.size.which="_default"}t.sliderEl.call(t.brush.extent([e[0],e[1]])),t.sliderEl.call(t.brush.event)},readyOnce:function(){var t=this,e=t.model.size.extent||[c.EXTENT_MIN,c.EXTENT_MAX];this.element=d3.select(this.element),this.sliderSvg=this.element.select(".vzb-szs-svg"),this.sliderWrap=this.sliderSvg.select(".vzb-szs-slider-wrap"),this.sliderEl=this.sliderWrap.select(".vzb-szs-slider");var i=({v:c.TEXT_PARAMS.TOP,h:c.TEXT_PARAMS.LEFT},c.TEXT_PARAMS.MAX_WIDTH,c.TEXT_PARAMS.MAX_HEIGHT),n=c.BAR_WIDTH,a=c.THUMB_RADIUS,r=(c.THUMB_STROKE_WIDTH,{top:c.MARGIN.TOP+1.25*n,left:a,right:a,bottom:n+i}),s=this.element.node().offsetWidth;this.padding=r,this.propertyActiveProfile=this.getPropertyActiveProfile(),this.translator=this.model.locale.getTFunction(),this.propertyScale=d3.scale.linear().domain([c.EXTENT_MIN,c.EXTENT_MAX]).range([this.propertyActiveProfile.min,this.propertyActiveProfile.max]).clamp(!0),this.xScale=d3.scale.linear().domain([c.EXTENT_MIN,c.EXTENT_MAX]).range([0,s-r.left-r.right]).clamp(!0),this.brush=d3.svg.brush().x(this.xScale).extent([c.EXTENT_MIN,c.EXTENT_MAX]).on("brush",function(){t._setFromExtent(!0,!1,!1)}).on("brushend",function(){t.sliderEl.selectAll(".resize").style("display",null),t._setFromExtent(!0,!0)}),this.sliderEl.call(t.brush),this.sliderEl.selectAll(".background").attr("style",""),this.sliderThumbs=this.sliderEl.selectAll(".resize").sort(d3.descending).classed("vzb-szs-slider-thumb",!0),this.sliderThumbs.append("g").attr("class","vzb-szs-slider-thumb-badge").append("path").attr("d",function(t,e){return"M0 "+.5*n+"l"+-a+" "+1.5*a+"h"+2*a+"Z"}),this.sliderThumbs.append("path").attr("class","vzb-szs-slider-thumb-arc"),this.sliderEl.selectAll("text").data([0,0]).enter().append("text").attr("class",function(t,e){return"vzb-szs-slider-thumb-label "+(e?"e":"w")}).attr("dy",1.25*-n+"px").attr("text-anchor",function(t,e){return 1-e?"start":"end"}),this.sliderLabelsEl=this.sliderEl.selectAll("text.vzb-szs-slider-thumb-label"),this.sliderEl.selectAll("rect").attr("height",n).attr("rx",.25*n).attr("ry",.25*n).attr("transform","translate(0,"+.5*-n+")"),this.sliderEl.select(".extent").classed("vzb-szs-slider-extent",!0),this.on("resize",function(){t.propertyActiveProfile=t.getPropertyActiveProfile(),t.propertyScale.range([t.propertyActiveProfile.min,t.propertyActiveProfile.max]);var e=t.element.node().offsetWidth;t.xScale.range([0,e-t.padding.left-t.padding.right]),t._updateSize(),t.sliderEl.call(t.brush.extent(t.brush.extent())),t._setFromExtent(!1,!1,!1)}),this._updateSize(),this.sliderEl.call(this.brush.extent(e)),t._setFromExtent(!1,!1,!1),t.sizeScaleMinMax=t.model.size.getScale().domain(),t.sizeScaleMinMax&&t._setLabelsText(),t.model._ready&&this.modelReady()},getPropertyActiveProfile:function(){var t=h[this.getLayoutProfile()];return{min:t["min"+this.propertyName],max:t["max"+this.propertyName],default:t["default"+this.propertyName]}},_updateSize:function(){this.sliderSvg.attr("height",this.propertyActiveProfile.max+this.padding.top+this.padding.bottom).attr("width","100%"),this.sliderWrap.attr("transform","translate("+this.padding.left+","+(this.propertyActiveProfile.max+this.padding.top)+")")},_updateLabels:function(t){var e=this,i=function(t,i){var n=e.xScale(i),a=0;return"translate("+n+","+a+")"};this.sliderLabelsEl.data(t).attr("transform",i).attr("font-size",function(t,i){return e.propertyScale(t)}),"constant"===e.model.size.use&&this.sliderLabelsEl.data(t).text(function(t){return~~e.propertyScale(t)+(e.translator(e.ui.constantUnit)||"")})},_setLabelsText:function(){var t=this;t.sliderLabelsEl.data([t.model.size.getTickFormatter()(t.sizeScaleMinMax[0]),t.model.size.getTickFormatter()(t.sizeScaleMinMax[1])]).text(function(t){return t})},_setFromExtent:function(t,e,i){var n=this.brush.extent();this._updateLabels(n),t&&this._setModel(n,e,i)},_setModel:function(t,e,i){t=[+t[0].toFixed(2),+t[1].toFixed(2)],this.model.size.set({extent:t},e,i)}});e.default=u},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){var i=[],n=!0,a=!1,r=void 0;try{for(var s,o=t[Symbol.iterator]();!(n=(s=o.next()).done)&&(i.push(s.value),!e||i.length!==e);n=!0);}catch(t){a=!0,r=t}finally{try{!n&&o.return&&o.return()}finally{if(a)throw r}}return i}return function(e,i){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),r=i(2),s=n(r),o=i(1),l=s.default.extend({init:function(t,e){var n=this;this.name="steppedSlider",this.template=i(443),this.config=Object.assign({triangleWidth:10,triangleHeight:10,height:31,lineWidth:10,domain:[1,2,3,4,5,6],range:[1200,900,450,200,150,100]},t),this.config.height-=this.config.triangleHeight/2,this.model_expects=[{name:"time",type:"time"},{name:"locale",type:"locale"}],this.model_binds={"change:time.delay":function(){n.redraw()}},this.setDelay=(0,o.throttle)(this.setDelay,50),this._super(t,e)},readyOnce:function(){var t=this.config,e=t.domain,i=t.range,n=t.height;this.element=d3.select(this.element),this.svg=this.element.select("svg"),this.axisScale=d3.scale.log().domain(d3.extent(e)).range([n,0]),this.delayScale=d3.scale.linear().domain(e).range(i),this.initTriangle(),this.initAxis(),this.redraw()},initAxis:function(){var t=this,e=this.config,i=e.lineWidth,n=e.triangleWidth,r=e.triangleHeight,s=e.height,o=d3.svg.axis().scale(this.axisScale).tickFormat(function(){return""}).orient("left").tickSize(i,0),l=n+i/2,c=r/2;this.svg.on("mousedown",function(){var e=d3.event.offsetY,i=Math.max(0,Math.min(e-c,s));t.setDelay(Math.round(t.delayScale(t.axisScale.invert(i))),!0,!0)}).select(".vzb-stepped-speed-slider-axis").attr("transform","translate("+l+", "+c+")").call(o),this.drag=d3.behavior.drag().on("drag",function(){var e=d3.event.dy,i=a(d3.transform(t.slide.attr("transform")).translate,2),n=i[1],r=Math.max(0,Math.min(e+n,s));t.setDelay(Math.round(t.delayScale(t.axisScale.invert(r)))),t.redraw(r)}).on("dragend",function(){t.setDelay(t.model.time.delay,!0,!0)}),this.svg.call(this.drag)},initTriangle:function(){var t=this.config;t.triangleWidth,t.triangleHeight,t.lineWidth;this.slide=this.svg.select(".vzb-stepped-speed-slider-triangle"),this.slide.append("g").append("path").attr("d",this.getTrianglePath())},getTrianglePath:function(){var t=this.config,e=t.triangleHeight,i=t.triangleWidth;return"M "+i+","+e/2+" 0,"+e+" 0,0 z"},setDelay:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.model.time.set("delay",t,e,i)},redraw:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.axisScale(this.delayScale.invert(this.model.time.delay));this.slide.attr("transform","translate(0, "+t+")")}});e.default=l},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),s=a(r),o=i(2),l=n(o),c=i(10),h=a(c),u="vzb-active",d=l.default.extend({init:function(t,e){var i=this;this.name="gapminder-zoombuttonlist",this.model_expects=[{name:"state",type:"model"},{name:"ui",type:"ui"},{name:"locale",type:"locale"}],this._available_buttons={arrow:{title:"buttons/cursorarrow",icon:"cursorArrow",func:this.toggleCursorMode.bind(this),required:!0,statebind:"ui.cursorMode",statebindfunc:this.setCursorMode.bind(this)},plus:{title:"buttons/cursorplus",icon:"cursorPlus",func:this.toggleCursorMode.bind(this),required:!0,statebind:"ui.cursorMode",statebindfunc:this.setCursorMode.bind(this)},minus:{title:"buttons/cursorminus",icon:"cursorMinus",func:this.toggleCursorMode.bind(this),required:!0,statebind:"ui.cursorMode",statebindfunc:this.setCursorMode.bind(this)},hundredpercent:{title:"buttons/hundredpercent",icon:"hundredPercent",func:this.toggleHundredPercent.bind(this),required:!0}},this.model_binds={},Object.keys(this._available_buttons).forEach(function(t){var e=i._available_buttons[t];e&&e.statebind&&(i.model_binds["change:"+e.statebind]=function(i){e.statebindfunc(t,i.source.value)})}),this._super(t,e)},readyOnce:function(){this.element=d3.select(this.placeholder),this.element.selectAll("div").remove(),this._addButtons(Object.keys(this._available_buttons),[]),this.setCursorMode("arrow")},_addButtons:function(t,e){var i=this;this._components_config=[];var n=[];if(t.length){for(var a=0;a<t.length;a++){var r=t[a],o=this._available_buttons[r],l=o?r:"_default",c=s.clone(this._available_buttons[l]);c.id=r,c.icon=h[c.icon],n.push(c)}var u=this.getTranslationFunction(!0);this.element.selectAll("button").data(n).enter().append("button").attr("class",function(t){var i="vzb-buttonlist-btn";return e.length>0&&e.indexOf(t.id)>-1&&(i+=" vzb-dialog-side-btn"),i}).attr("data-btn",function(t){return t.id}).html(function(t){return"<span class='vzb-buttonlist-btn-icon fa'>"+t.icon+"</span><span class='vzb-buttonlist-btn-title'>"+u(t.title)+"</span>"});var d=this.element.selectAll(".vzb-buttonlist-btn");d.on("click",function(){d3.event.preventDefault(),d3.event.stopPropagation();var t=d3.select(this).attr("data-btn");i.proceedClick(t)})}},proceedClick:function(t){var e=this,i=e.element.selectAll(".vzb-buttonlist-btn[data-btn='"+t+"']"),n=i.attr("class"),a=e._available_buttons[t];if(a&&a.func)a.func(t);else{var r=n.indexOf(u)===-1;i.classed(u,r);var s={};s.id=t,s.active=r,e.trigger("click",s)}},setButtonActive:function(t,e){var i=this.element.selectAll(".vzb-buttonlist-btn[data-btn='"+t+"']");i.classed(u,e)},toggleCursorMode:function(t){var e=t;this.model.ui.set("cursorMode",e,!1,!1)},setCursorMode:function(t){var e=this.model.ui.cursorMode?this.model.ui.cursorMode:"arrow";this.element.selectAll(".vzb-buttonlist-btn").classed(u,function(t){return t.id==e})},toggleHundredPercent:function(t){this.root.trigger("resetZoom")}});e.default=d},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){function t(t,i){return{type:"Feature",id:t.id,properties:t.properties,geometry:e(t.geometry,i)}}function e(t,i){if(!t)return null;if("GeometryCollection"===t.type)return{type:"GeometryCollection",geometries:object.geometries.map(function(t){return e(t,i)})};if(!fe.hasOwnProperty(t.type))return null;var n=fe[t.type];return d3.geo.stream(t,i(n)),n.result()}function i(){}function n(t){if((e=t.length)<4)return!1;for(var e,i=0,n=t[e-1][1]*t[0][0]-t[e-1][0]*t[0][1];++i<e;)n+=t[i-1][1]*t[i][0]-t[i-1][0]*t[i][1];return n<=0}function a(t,e){for(var i=e[0],n=e[1],a=!1,r=0,s=t.length,o=s-1;r<s;o=r++){var l=t[r],c=l[0],h=l[1],u=t[o],d=u[0],f=u[1];h>n^f>n&&i<(d-c)*(n-h)/(f-h)+c&&(a=!a)}return a}function r(t){return t?t/Math.sin(t):1}function s(t){return t>0?1:t<0?-1:0}function o(t){return t>1?ve:t<-1?-ve:Math.asin(t)}function l(t){return t>1?0:t<-1?ge:Math.acos(t)}function c(t){return t>0?Math.sqrt(t):0}function h(t){function e(t,e){var i=Math.cos(t),a=Math.cos(e),r=Math.sin(e),s=a*i,o=-((1-s?Math.log(.5*(1+s))/(1-s):-.5)+n/(1+s));return[o*a*Math.sin(t),o*r]}var i=Math.tan(.5*t),n=2*Math.log(Math.cos(.5*t))/(i*i);return e.invert=function(e,i){var a,r=Math.sqrt(e*e+i*i),s=t*-.5,l=50;if(!r)return[0,0];do{var c=.5*s,h=Math.cos(c),u=Math.sin(c),d=Math.tan(c),f=Math.log(1/h);s-=a=(2/d*f-n*d-r)/(-f/(u*u)+1-n/(2*h*h))}while(Math.abs(a)>me&&--l>0);var m=Math.sin(s);return[Math.atan2(e*m,r*Math.cos(s)),o(i*m/r)]},e}function u(){var t=ve,e=Me(h),i=e(t);return i.radius=function(i){return arguments.length?e(t=i*ge/180):t/ge*180},i}function d(t,e){var i=Math.cos(e),n=r(l(i*Math.cos(t/=2)));return[2*i*Math.sin(t)*n,Math.sin(e)*n]}function f(t){function e(t,e){var o=Math.cos(e),l=Math.cos(t/=2);return[(1+o)*Math.sin(t),(a*e>-Math.atan2(l,r)-.001?0:10*-a)+s+Math.sin(e)*n-(1+o)*i*l]}var i=Math.sin(t),n=Math.cos(t),a=t>0?1:-1,r=Math.tan(a*t),s=(1+i-n)/2;return e.invert=function(t,e){var o=0,l=0,c=50;do{var h=Math.cos(o),u=Math.sin(o),d=Math.cos(l),f=Math.sin(l),m=1+d,p=m*u-t,g=s+f*n-m*i*h-e,v=.5*m*h,b=-u*f,y=.5*i*m*u,x=n*d+i*h*f,_=b*y-x*v,M=.5*(g*b-p*x)/_,w=(p*y-g*v)/_;o-=M,l-=w}while((Math.abs(M)>me||Math.abs(w)>me)&&--c>0);return a*l>-Math.atan2(Math.cos(o),r)-.001?[2*o,l]:null},e}function m(){var t=ge/9,e=t>0?1:-1,i=Math.tan(e*t),n=Me(f),a=n(t),r=a.stream;return a.parallel=function(a){return arguments.length?(i=Math.tan((e=(t=a*ge/180)>0?1:-1)*t),n(t)):t/ge*180},a.stream=function(n){var s=a.rotate(),o=r(n),l=(a.rotate([0,0]),r(n));return a.rotate(s),o.sphere=function(){l.polygonStart(),l.lineStart();for(var n=e*-180;e*n<180;n+=90*e)l.point(n,90*e);for(;e*(n-=t)>=-180;)l.point(n,e*-Math.atan2(Math.cos(n*ye/2),i)*xe);l.lineEnd(),l.polygonEnd()},o},a}function p(t){return t=Math.exp(2*t),(t-1)/(t+1)}function g(t){return.5*(Math.exp(t)-Math.exp(-t))}function v(t){return.5*(Math.exp(t)+Math.exp(-t))}function b(t){return Math.log(t+c(t*t+1))}function y(t){return Math.log(t+c(t*t-1))}function x(t,e){var i=Math.tan(e/2),n=c(1-i*i),a=1+n*Math.cos(t/=2),r=Math.sin(t)*n/a,s=i/a,o=r*r,l=s*s;return[4/3*r*(3+o-3*l),4/3*s*(3+3*o-l)]}function _(t,e){var i=Math.abs(e);return i<ge/4?[t,Math.log(Math.tan(ge/4+e/2))]:[t*Math.cos(i)*(2*Math.SQRT2-1/Math.sin(i)),s(e)*(2*Math.SQRT2*(i-ge/4)-Math.log(Math.tan(i/2)))]}function M(t){function e(t,e){var n=ze(t,e);if(Math.abs(t)>ve){var a=Math.atan2(n[1],n[0]),r=Math.sqrt(n[0]*n[0]+n[1]*n[1]),s=i*Math.round((a-ve)/i)+ve,l=Math.atan2(Math.sin(a-=s),2-Math.cos(a));a=s+o(ge/r*Math.sin(l))-l,n[0]=r*Math.cos(a),n[1]=r*Math.sin(a)}return n}var i=2*ge/t;return e.invert=function(t,e){var n=Math.sqrt(t*t+e*e);if(n>ve){var a=Math.atan2(e,t),r=i*Math.round((a-ve)/i)+ve,s=a>r?-1:1,o=n*Math.cos(r-a),l=1/Math.tan(s*Math.acos((o-ge)/Math.sqrt(ge*(ge-2*o)+n*n)));a=r+2*Math.atan((l+s*Math.sqrt(l*l-3))/3),t=n*Math.cos(a),e=n*Math.sin(a)}return ze.invert(t,e)},e}function w(){var t=5,e=Me(M),i=e(t),n=i.stream,a=.01,r=-Math.cos(a*ye),s=Math.sin(a*ye);return i.lobes=function(i){return arguments.length?e(t=+i):t},i.stream=function(e){var l=i.rotate(),c=n(e),h=(i.rotate([0,0]),n(e));return i.rotate(l),c.sphere=function(){h.polygonStart(),h.lineStart();for(var e=0,i=360/t,n=2*ge/t,l=90-180/t,c=ve;e<t;++e,l-=i,c-=n)h.point(Math.atan2(s*Math.cos(c),r)*xe,o(s*Math.sin(c))*xe),l<-90?(h.point(-90,-180-l-a),h.point(-90,-180-l+a)):(h.point(90,l+a),h.point(90,l-a));h.lineEnd(),h.polygonEnd()},c},i}function z(t){return function(e){var i,n=t*Math.sin(e),a=30;do e-=i=(e+Math.sin(e)-n)/(1+Math.cos(e));while(Math.abs(i)>me&&--a>0);return e/2}}function S(t,e,i){function n(i,n){return[t*i*Math.cos(n=a(n)),e*Math.sin(n)]}var a=z(i);return n.invert=function(n,a){var r=o(a/e);return[n/(t*Math.cos(r)),o((2*r+Math.sin(2*r))/i)]},n}function k(t,e){var i=2.00276,n=Se(e);return[i*t/(1/Math.cos(e)+1.11072/Math.cos(n)),(e+Math.SQRT2*Math.sin(n))/i]}function E(t){var e=0,i=Me(t),n=i(e);return n.parallel=function(t){return arguments.length?i(e=t*ge/180):e/ge*180},n}function O(t,e){return[t*Math.cos(e),e]}function T(t){function e(e,n){var a=i+t-n,r=a?e*Math.cos(n)/a:a;return[a*Math.sin(r),i-a*Math.cos(r)]}if(!t)return O;var i=1/Math.tan(t);return e.invert=function(e,n){var a=Math.sqrt(e*e+(n=i-n)*n),r=i+t-a;return[a/Math.cos(r)*Math.atan2(e,n),r]},e}function P(t){function e(e,i){for(var n=Math.sin(i),a=Math.cos(i),r=new Array(3),c=0;c<3;++c){var h=t[c];if(r[c]=I(i-h[1],h[3],h[2],a,n,e-h[0]),!r[c][0])return h.point;r[c][1]=A(r[c][1]-h.v[1])}for(var u=l.slice(),c=0;c<3;++c){
var d=2==c?0:c+1,f=C(t[c].v[0],r[c][0],r[d][0]);r[c][1]<0&&(f=-f),c?1==c?(f=s-f,u[0]-=r[c][0]*Math.cos(f),u[1]-=r[c][0]*Math.sin(f)):(f=o-f,u[0]+=r[c][0]*Math.cos(f),u[1]+=r[c][0]*Math.sin(f)):(u[0]+=r[c][0]*Math.cos(f),u[1]-=r[c][0]*Math.sin(f))}return u[0]/=3,u[1]/=3,u}t=t.map(function(t){return[t[0],t[1],Math.sin(t[1]),Math.cos(t[1])]});for(var i,n=t[2],a=0;a<3;++a,n=i)i=t[a],n.v=I(i[1]-n[1],n[3],n[2],i[3],i[2],i[0]-n[0]),n.point=[0,0];var r=C(t[0].v[0],t[2].v[0],t[1].v[0]),s=C(t[0].v[0],t[1].v[0],t[2].v[0]),o=ge-r;t[2].point[1]=0,t[0].point[0]=-(t[1].point[0]=.5*t[0].v[0]);var l=[t[2].point[0]=t[0].point[0]+t[2].v[0]*Math.cos(r),2*(t[0].point[1]=t[1].point[1]=t[2].v[0]*Math.sin(r))];return e}function D(){var t=[[0,0],[0,0],[0,0]],e=Me(P),i=e(t),n=i.rotate;return delete i.rotate,i.points=function(a){if(!arguments.length)return t;t=a;var r=d3.geo.centroid({type:"MultiPoint",coordinates:t}),s=[-r[0],-r[1]];return n.call(i,s),e(t.map(d3.geo.rotation(s)).map(L))},i.points([[-150,55],[-35,55],[-92.5,10]])}function I(t,e,i,n,a,r){var s,c=Math.cos(r);if(Math.abs(t)>1||Math.abs(r)>1)s=l(i*a+e*n*c);else{var h=Math.sin(.5*t),u=Math.sin(.5*r);s=2*o(Math.sqrt(h*h+e*n*u*u))}return Math.abs(s)>me?[s,Math.atan2(n*Math.sin(r),e*a-i*n*c)]:[0,0]}function C(t,e,i){return l(.5*(t*t+e*e-i*i)/(t*e))}function A(t){return t-2*ge*Math.floor((t+ge)/(2*ge))}function L(t){return[t[0]*ye,t[1]*ye]}function R(t,e){var i=c(1-Math.sin(e));return[2/be*t*i,be*(1-i)]}function j(t){function e(t,e){return[t,(t?t/Math.sin(t):1)*(Math.sin(e)*Math.cos(t)-i*Math.cos(e))]}var i=Math.tan(t);return e.invert=i?function(t,e){t&&(e*=Math.sin(t)/t);var n=Math.cos(t);return[t,2*Math.atan2(Math.sqrt(n*n+i*i-e*e)-n,i-e)]}:function(t,e){return[t,o(t?e*Math.tan(t)/t:e)]},e}function N(t,e){var i=Math.sqrt(3);return[i*t*(2*Math.cos(2*e/3)-1)/be,i*be*Math.sin(e/3)]}function F(t){function e(t,e){return[t*i,Math.sin(e)/i]}var i=Math.cos(t);return e.invert=function(t,e){return[t/i,o(e*i)]},e}function B(t){function e(t,e){return[t*i,(1+i)*Math.tan(.5*e)]}var i=Math.cos(t);return e.invert=function(t,e){return[t/i,2*Math.atan(e/(1+i))]},e}function q(t,e){var i=Math.sqrt(8/(3*ge));return[i*t*(1-Math.abs(e)/ge),i*e]}function H(t,e){var i=Math.sqrt(4-3*Math.sin(Math.abs(e)));return[2/Math.sqrt(6*ge)*t*i,s(e)*Math.sqrt(2*ge/3)*(2-i)]}function Y(t,e){var i=Math.sqrt(ge*(4+ge));return[2/i*t*(1+Math.sqrt(1-4*e*e/(ge*ge))),4/i*e]}function V(t,e){var i=(2+ve)*Math.sin(e);e/=2;for(var n=0,a=1/0;n<10&&Math.abs(a)>me;n++){var r=Math.cos(e);e-=a=(e+Math.sin(e)*(r+2)-i)/(2*r*(1+r))}return[2/Math.sqrt(ge*(4+ge))*t*(1+Math.cos(e)),2*Math.sqrt(ge/(4+ge))*Math.sin(e)]}function X(t,e){return[t*(1+Math.cos(e))/Math.sqrt(2+ge),2*e/Math.sqrt(2+ge)]}function W(t,e){for(var i=(1+ve)*Math.sin(e),n=0,a=1/0;n<10&&Math.abs(a)>me;n++)e-=a=(e+Math.sin(e)-i)/(1+Math.cos(e));return i=Math.sqrt(2+ge),[t*(1+Math.cos(e))/i,2*e/i]}function K(t,e){var i=Math.sin(t/=2),n=Math.cos(t),a=Math.sqrt(Math.cos(e)),r=Math.cos(e/=2),s=Math.sin(e)/(r+Math.SQRT2*n*a),o=Math.sqrt(2/(1+s*s)),l=Math.sqrt((Math.SQRT2*r+(n+i)*a)/(Math.SQRT2*r+(n-i)*a));return[Oe*(o*(l-1/l)-2*Math.log(l)),Oe*(o*s*(l+1/l)-2*Math.atan(s))]}function U(t,e){var i=Math.tan(e/2);return[t*Te*c(1-i*i),(1+Te)*i]}function G(t,e){var i=e/2,n=Math.cos(i);return[2*t/be*Math.cos(e)*n*n,be*Math.tan(i)]}function Q(t,e){function i(e,i){var r=Pe(e,i),s=r[0],o=r[1],l=s*s+o*o;if(l>a){var c=Math.sqrt(l),h=Math.atan2(o,s),u=n*Math.round(h/n),d=h-u,f=t*Math.cos(d),m=(t*Math.sin(d)-d*Math.sin(f))/(ve-f),p=Z(d,m),g=(ge-t)/J(p,f,ge);s=c;var v,b=50;do s-=v=(t+J(p,f,s)*g-c)/(p(s)*g);while(Math.abs(v)>me&&--b>0);o=d*Math.sin(s),s<ve&&(o-=m*(s-ve));var y=Math.sin(u),x=Math.cos(u);r[0]=s*x-o*y,r[1]=s*y+o*x}return r}var n=2*ge/e,a=t*t;return i.invert=function(e,i){var r=e*e+i*i;if(r>a){var s=Math.sqrt(r),o=Math.atan2(i,e),l=n*Math.round(o/n),c=o-l,e=s*Math.cos(c);i=s*Math.sin(c);for(var h=e-ve,u=Math.sin(e),d=i/u,f=e<ve?1/0:0,m=10;;){var p=t*Math.sin(d),g=t*Math.cos(d),v=Math.sin(g),b=ve-g,y=(p-d*v)/b,x=Z(d,y);if(Math.abs(f)<pe||!--m)break;d-=f=(d*u-y*h-i)/(u-2*h*(b*(g+d*p*Math.cos(g)-v)-p*(p-d*v))/(b*b))}s=t+J(x,g,e)*(ge-t)/J(x,g,ge),o=l+d,e=s*Math.cos(o),i=s*Math.sin(o)}return Pe.invert(e,i)},i}function Z(t,e){return function(i){var n=t*Math.cos(i);return i<ve&&(n-=e),Math.sqrt(1+n*n)}}function $(){var t=6,e=30*ye,i=Math.cos(e),n=Math.sin(e),a=Me(Q),r=a(e,t),s=r.stream,o=.01,l=-Math.cos(o*ye),c=Math.sin(o*ye);return r.radius=function(r){return arguments.length?(i=Math.cos(e=r*ye),n=Math.sin(e),a(e,t)):e*xe},r.lobes=function(i){return arguments.length?a(e,t=+i):t},r.stream=function(e){var a=r.rotate(),o=s(e),h=(r.rotate([0,0]),s(e));return r.rotate(a),o.sphere=function(){h.polygonStart(),h.lineStart();for(var e=0,a=2*ge/t,r=0;e<t;++e,r-=a)h.point(Math.atan2(c*Math.cos(r),l)*xe,Math.asin(c*Math.sin(r))*xe),h.point(Math.atan2(n*Math.cos(r-a/2),i)*xe,Math.asin(n*Math.sin(r-a/2))*xe);h.lineEnd(),h.polygonEnd()},o},r}function J(t,e,i){for(var n=50,a=(i-e)/n,r=t(e)+t(i),s=1,o=e;s<n;++s)r+=2*t(o+=a);return.5*r*a}function tt(t,e,i,n,a,r,s,o){function l(l,c){if(!c)return[t*l/ge,0];var h=c*c,u=t+h*(e+h*(i+h*n)),d=c*(a-1+h*(r-o+h*s)),f=(u*u+d*d)/(2*d),m=l*Math.asin(u/f)/ge;return[f*Math.sin(m),c*(1+h*o)+f*(1-Math.cos(m))]}return arguments.length<8&&(o=0),l.invert=function(l,h){var u,d,f=ge*l/t,m=h,p=50;do{var g=m*m,v=t+g*(e+g*(i+g*n)),b=m*(a-1+g*(r-o+g*s)),y=v*v+b*b,x=2*b,_=y/x,M=_*_,w=Math.asin(v/_)/ge,z=f*w;if(xB2=v*v,dxBd=(2*e+g*(4*i+6*g*n))*m,dyBd=a+g*(3*r+5*g*s),dpd=2*(v*dxBd+b*(dyBd-1)),dqd=2*(dyBd-1),dmd=(dpd*x-y*dqd)/(x*x),cos=Math.cos(z),sin=Math.sin(z),mcos=_*cos,msin=_*sin,dd=f/ge*(1/c(1-xB2/M))*(dxBd*_-v*dmd)/M,fx=msin-l,fy=m*(1+g*o)+_-mcos-h,x=dmd*sin+mcos*dd,x=mcos*w,y=1+dmd-(dmd*cos-msin*dd),y=msin*w,denominator=x*y-y*x,!denominator)break;f-=u=(fy*x-fx*y)/denominator,m-=d=(fx*y-fy*x)/denominator}while((Math.abs(u)>me||Math.abs(d)>me)&&--p>0);return[f,m]},l}function et(t,e){var i=t*t,n=e*e;return[t*(1-.162388*n)*(.87-952426e-9*i*i),e*(1+n/12)]}function it(t){function e(){var t=!1,e=Me(i),n=e(t);return n.quincuncial=function(i){return arguments.length?e(t=!!i):t},n}function i(e){var i=e?function(e,i){var a=Math.abs(e)<ve,r=t(a?e:e>0?e-ge:e+ge,i),o=(r[0]-r[1])*Math.SQRT1_2,l=(r[0]+r[1])*Math.SQRT1_2;if(a)return[o,l];var c=n*Math.SQRT1_2,h=o>0^l>0?-1:1;return[h*o-s(l)*c,h*l-s(o)*c]}:function(e,i){var a=e>0?-.5:.5,r=t(e+a*ge,i);return r[0]-=a*n,r};return t.invert&&(i.invert=e?function(e,i){var a=(e+i)*Math.SQRT1_2,r=(i-e)*Math.SQRT1_2,s=Math.abs(a)<.5*n&&Math.abs(r)<.5*n;if(!s){var o=n*Math.SQRT1_2,l=a>0^r>0?-1:1,c=-l*(e+(r>0?1:-1)*o),h=-l*(i+(a>0?1:-1)*o);a=(-c-h)*Math.SQRT1_2,r=(c-h)*Math.SQRT1_2}var u=t.invert(a,r);return s||(u[0]+=a>0?ge:-ge),u}:function(e,i){var a=e>0?-.5:.5,r=t.invert(e+a*n,i),s=r[0]-a*ge;return s<-ge?s+=2*ge:s>ge&&(s-=2*ge),r[0]=s,r}),i}var n=t(ve,0)[0]-t(-ve,0)[0];return e.raw=i,e}function nt(t,e){var i=s(t),n=s(e),a=Math.cos(e),r=Math.cos(t)*a,l=Math.sin(t)*a,c=Math.sin(n*e);t=Math.abs(Math.atan2(l,c)),e=o(r),Math.abs(t-ve)>me&&(t%=ve);var h=at(t>ge/4?ve-t:t,e);return t>ge/4&&(c=h[0],h[0]=-h[1],h[1]=-c),h[0]*=i,h[1]*=-n,h}function at(t,e){if(e===ve)return[0,0];var i=Math.sin(e),n=i*i,a=n*n,r=1+a,s=1+3*a,l=1-a,h=o(1/Math.sqrt(r)),u=l+n*r*h,d=(1-i)/u,f=Math.sqrt(d),m=d*r,p=Math.sqrt(m),g=f*l;if(0===t)return[0,-(g+n*p)];var v=Math.cos(e),b=1/v,y=2*i*v,x=(-3*n+h*s)*y,_=(-u*v-(1-i)*x)/(u*u),M=.5*_/f,w=l*M-2*n*f*y,z=n*r*_+d*s*y,S=-b*y,k=-b*z,E=-2*b*w,O=4*t/ge;if(t>.222*ge||e<ge/4&&t>.175*ge){var T=(g+n*c(m*(1+a)-g*g))/(1+a);if(t>ge/4)return[T,T];var P=T,D=.5*T,I=50;T=.5*(D+P);do{var C=Math.sqrt(m-T*T),A=T*(E+S*C)+k*o(T/p)-O;if(!A)break;A<0?D=T:P=T,T=.5*(D+P)}while(Math.abs(P-D)>me&&--I>0)}else{var L,T=me,I=25;do{var R=T*T,C=c(m-R),j=E+S*C,A=T*j+k*o(T/p)-O,N=j+(k-S*R)/C;T-=L=C?A/N:0}while(Math.abs(L)>me&&--I>0)}return[T,-g-n*c(m-T*T)]}function rt(t,e){for(var i=0,n=1,a=.5,r=50;;){var s=a*a,o=Math.sqrt(a),l=Math.asin(1/Math.sqrt(1+s)),c=1-s+a*(1+s)*l,h=(1-o)/c,u=Math.sqrt(h),d=h*(1+s),f=u*(1-s),m=d-t*t,p=Math.sqrt(m),g=e+f+a*p;if(Math.abs(n-i)<pe||0===--r||0===g)break;g>0?i=a:n=a,a=.5*(i+n)}if(!r)return null;var v=Math.asin(o),b=Math.cos(v),y=1/b,x=2*o*b,_=(-3*a+l*(1+3*s))*x,M=(-c*b-(1-o)*_)/(c*c),w=.5*M/u,z=(1-s)*w-2*a*u*x,S=-2*y*z,k=-y*x,E=-y*(a*(1+s)*M+h*(1+3*s)*x);return[ge/4*(t*(S+k*p)+E*Math.asin(t/Math.sqrt(d))),v]}function st(t,e,i){if(!t){var n=ot(e,1-i);return[[0,n[0]/n[1]],[1/n[1],0],[n[2]/n[1],0]]}var a=ot(t,i);if(!e)return[[a[0],0],[a[1],0],[a[2],0]];var n=ot(e,1-i),r=n[1]*n[1]+i*a[0]*a[0]*n[0]*n[0];return[[a[0]*n[2]/r,a[1]*a[2]*n[0]*n[1]/r],[a[1]*n[1]/r,-a[0]*a[2]*n[0]*n[2]/r],[a[2]*n[1]*n[2]/r,-i*a[0]*a[1]*n[0]/r]]}function ot(t,e){var i,n,a,r,s;if(e<me)return r=Math.sin(t),n=Math.cos(t),i=.25*e*(t-r*n),[r-i*n,n+i*r,1-.5*e*r*r,t-i];if(e>=1-me)return i=.25*(1-e),n=v(t),r=p(t),a=1/n,s=n*g(t),[r+i*(s-t)/(n*n),a-i*r*a*(s-t),a+i*r*a*(s+t),2*Math.atan(Math.exp(t))-ve+i*(s-t)/n];var l=[1,0,0,0,0,0,0,0,0],h=[Math.sqrt(e),0,0,0,0,0,0,0,0],u=0;for(n=Math.sqrt(1-e),s=1;Math.abs(h[u]/l[u])>me&&u<8;)i=l[u++],h[u]=.5*(i-n),l[u]=.5*(i+n),n=c(i*n),s*=2;a=s*l[u]*t;do r=h[u]*Math.sin(n=a)/l[u],a=.5*(o(r)+a);while(--u);return[Math.sin(a),r=Math.cos(a),r/Math.cos(a-n),a]}function lt(t,e,i){var n=Math.abs(t),a=Math.abs(e),r=g(a);if(n){var o=1/Math.sin(n),l=1/(Math.tan(n)*Math.tan(n)),h=-(l+i*r*r*o*o-1+i),u=(i-1)*l,d=.5*(-h+Math.sqrt(h*h-4*u));return[ct(Math.atan(1/Math.sqrt(d)),i)*s(t),ct(Math.atan(c((d/l-1)/i)),1-i)*s(e)]}return[0,ct(Math.atan(r),1-i)*s(e)]}function ct(t,e){if(!e)return t;if(1===e)return Math.log(Math.tan(t/2+ge/4));for(var i=1,n=Math.sqrt(1-e),a=Math.sqrt(e),r=0;Math.abs(a)>me;r++){if(t%ge){var s=Math.atan(n*Math.tan(t)/i);s<0&&(s+=ge),t+=s+~~(t/ge)*ge}else t+=t;a=(i+n)/2,n=Math.sqrt(i*n),a=((i=a)-n)/2}return t/(Math.pow(2,r)*i)}function ht(t,e){var i=(Math.SQRT2-1)/(Math.SQRT2+1),n=Math.sqrt(1-i*i),a=ct(ve,n*n),r=-1,s=Math.log(Math.tan(ge/4+Math.abs(e)/2)),o=Math.exp(r*s)/Math.sqrt(i),l=ut(o*Math.cos(r*t),o*Math.sin(r*t)),c=lt(l[0],l[1],n*n);return[-c[1],(e>=0?1:-1)*(.5*a-c[0])]}function ut(t,e){var i=t*t,n=e+1,a=1-i-e*e;return[.5*((t>=0?ve:-ve)-Math.atan2(a,2*t)),-.25*Math.log(a*a+4*i)+.5*Math.log(n*n+i)]}function dt(t,e){var i=e[0]*e[0]+e[1]*e[1];return[(t[0]*e[0]+t[1]*e[1])/i,(t[1]*e[0]-t[0]*e[1])/i]}function ft(t){function e(t,e){var r=a(t,e);t=r[0],e=r[1];var s=Math.sin(e),o=Math.cos(e),c=Math.cos(t),h=l(i*s+n*o*c),u=Math.sin(h),d=Math.abs(u)>me?h/u:1;return[d*n*Math.sin(t),(Math.abs(t)>ve?d:-d)*(i*o-n*s*c)]}var i=Math.sin(t),n=Math.cos(t),a=mt(t);return a.invert=mt(-t),e.invert=function(t,e){var n=Math.sqrt(t*t+e*e),r=-Math.sin(n),s=Math.cos(n),o=n*s,l=-e*r,h=n*i,u=c(o*o+l*l-h*h),d=Math.atan2(o*h+l*u,l*h-o*u),f=(n>ve?-1:1)*Math.atan2(t*r,n*Math.cos(d)*s+e*Math.sin(d)*r);return a.invert(f,d)},e}function mt(t){var e=Math.sin(t),i=Math.cos(t);return function(t,n){var a=Math.cos(n),r=Math.cos(t)*a,s=Math.sin(t)*a,l=Math.sin(n);return[Math.atan2(s,r*i-l*e),o(l*i+r*e)]}}function pt(){var t=0,e=Me(ft),i=e(t),n=i.rotate,a=i.stream,r=d3.geo.circle();return i.parallel=function(n){if(!arguments.length)return t/ge*180;var a=i.rotate();return e(t=n*ge/180).rotate(a)},i.rotate=function(e){return arguments.length?(n.call(i,[e[0],e[1]-t/ge*180]),r.origin([-e[0],-e[1]]),i):(e=n.call(i),e[1]+=t/ge*180,e)},i.stream=function(t){return t=a(t),t.sphere=function(){t.polygonStart();var e,i=.01,n=r.angle(90-i)().coordinates[0],a=n.length-1,s=-1;for(t.lineStart();++s<a;)t.point((e=n[s])[0],e[1]);for(t.lineEnd(),n=r.angle(90+i)().coordinates[0],a=n.length-1,t.lineStart();--s>=0;)t.point((e=n[s])[0],e[1]);t.lineEnd(),t.polygonEnd()},t},i}function gt(t,e){function i(i,n){var a=Le(i/e,n);return a[0]*=t,a}return arguments.length<2&&(e=t),1===e?Le:e===1/0?bt:(i.invert=function(i,n){var a=Le.invert(i/t,n);return a[0]*=e,a},i)}function vt(){var t=2,e=Me(gt),i=e(t);return i.coefficient=function(i){return arguments.length?e(t=+i):t},i}function bt(t,e){return[t*Math.cos(e)/Math.cos(e/=2),2*Math.sin(e)]}function yt(t,e){for(var i,n=Math.sin(e)*(e<0?2.43763:2.67595),a=0;a<20&&(e-=i=(e+Math.sin(e)-n)/(1+Math.cos(e)),!(Math.abs(i)<me));a++);return[.85*t*Math.cos(e*=.5),Math.sin(e)*(e<0?1.93052:1.75859)]}function xt(t){function e(e,h){var u,d=Math.abs(h);if(d>n){var f=Math.min(t-1,Math.max(0,Math.floor((e+ge)/c)));e+=ge*(t-1)/t-f*c,u=d3.geo.collignon.raw(e,d),u[0]=u[0]*a/r-a*(t-1)/(2*t)+f*a/t,u[1]=s+4*(u[1]-o)*l/a,h<0&&(u[1]=-u[1])}else u=i(e,h);return u[0]/=2,u}var i=d3.geo.cylindricalEqualArea.raw(0),n=Re*ge/180,a=2*ge,r=d3.geo.collignon.raw(ge,n)[0]-d3.geo.collignon.raw(-ge,n)[0],s=i(0,n)[1],o=d3.geo.collignon.raw(0,n)[1],l=d3.geo.collignon.raw(0,ve)[1]-o,c=2*ge/t;return e.invert=function(e,n){e*=2;var h=Math.abs(n);if(h>s){var u=Math.min(t-1,Math.max(0,Math.floor((e+ge)/c)));e=(e+ge*(t-1)/t-u*c)*r/a;var d=d3.geo.collignon.raw.invert(e,.25*(h-s)*a/l+o);return d[0]-=ge*(t-1)/t-u*c,n<0&&(d[1]=-d[1]),d}return i.invert(e,n)},e}function _t(){function t(){var t=180/e;return{type:"Polygon",coordinates:[d3.range(-180,180+t/2,t).map(function(t,e){return[t,1&e?90-1e-6:Re]}).concat(d3.range(180,-180-t/2,-t).map(function(t,e){return[t,1&e?-90+1e-6:-Re]}))]}}var e=2,i=Me(xt),n=i(e),a=n.stream;return n.lobes=function(t){return arguments.length?i(e=+t):e},n.stream=function(e){var i=n.rotate(),r=a(e),s=(n.rotate([0,0]),a(e));return n.rotate(i),r.sphere=function(){d3.geo.stream(t(),s)},r},n}function Mt(t){function e(e,a){var o,l,d=1-Math.sin(a);if(d&&d<2){var f,m=ve-a,p=25;do{var g=Math.sin(m),v=Math.cos(m),b=r+Math.atan2(g,n-v),y=1+u-2*n*v;m-=f=(m-h*r-n*g+y*b-.5*d*i)/(2*n*g*b)}while(Math.abs(f)>pe&&--p>0);o=s*Math.sqrt(y),l=e*b/ge}else o=s*(t+d),l=e*r/ge;return[o*Math.sin(l),c-o*Math.cos(l)]}var i,n=1+t,a=Math.sin(1/n),r=o(a),s=2*Math.sqrt(ge/(i=ge+4*r*n)),c=.5*s*(n+Math.sqrt(t*(2+t))),h=t*t,u=n*n;return e.invert=function(t,e){var a=t*t+(e-=c)*e,d=(1+u-a/(s*s))/(2*n),f=l(d),m=Math.sin(f),p=r+Math.atan2(m,n-d);return[o(t/Math.sqrt(a))*ge/p,o(1-2*(f-h*r-n*m+(1+u-2*n*d)*p)/i)]},e}function wt(){var t=1,e=Me(Mt),i=e(t);return i.ratio=function(i){return arguments.length?e(t=+i):t},i}function zt(t,e){return e>-je?(t=ke(t,e),t[1]+=Ne,t):O(t,e)}function St(t,e){return Math.abs(e)>je?(t=ke(t,e),t[1]-=e>0?Ne:-Ne,t):O(t,e)}function kt(t,e){return[3*t/(2*ge)*Math.sqrt(ge*ge/3-e*e),e]}function Et(t){function e(e,i){if(Math.abs(Math.abs(i)-ve)<me)return[0,i<0?-2:2];var n=Math.sin(i),a=Math.pow((1+n)/(1-n),t/2),r=.5*(a+1/a)+Math.cos(e*=t);return[2*Math.sin(e)/r,(a-1/a)/r]}return e.invert=function(e,i){var n=Math.abs(i);if(Math.abs(n-2)<me)return e?null:[0,s(i)*ve];if(n>2)return null;e/=2,i/=2;var a=e*e,r=i*i,l=2*i/(1+a+r);return l=Math.pow((1+l)/(1-l),1/t),[Math.atan2(2*e,1-a-r)/t,o((l-1)/(l+1))]},e}function Ot(){var t=.5,e=Me(Et),i=e(t);return i.spacing=function(i){return arguments.length?e(t=+i):t},i}function Tt(t,e){return[t*(1+Math.sqrt(Math.cos(e)))/2,e/(Math.cos(e/2)*Math.cos(t/6))]}function Pt(t,e){var i=t*t,n=e*e;return[t*(.975534+n*(-.119161+i*-.0143059+n*-.0547009)),e*(1.00384+i*(.0802894+n*-.02855+199025e-9*i)+n*(.0998909+n*-.0491032))]}function Dt(t,e){return[Math.sin(t)/Math.cos(e),Math.tan(e)*Math.cos(t)]}function It(t){function e(e,a){var r=a-t,s=Math.abs(r)<me?e*i:Math.abs(s=ge/4+a/2)<me||Math.abs(Math.abs(s)-ve)<me?0:e*r/Math.log(Math.tan(s)/n);return[s,r]}var i=Math.cos(t),n=Math.tan(ge/4+t/2);return e.invert=function(e,a){var r,s=a+t;return[Math.abs(a)<me?e/i:Math.abs(r=ge/4+s/2)<me||Math.abs(Math.abs(r)-ve)<me?0:e*Math.log(Math.tan(r)/n)/a,s]},e}function Ct(t,e){return[t,1.25*Math.log(Math.tan(ge/4+.4*e))]}function At(t){function e(e,n){for(var a,r=Math.cos(n),s=2/(1+r*Math.cos(e)),o=s*r*Math.sin(e),l=s*Math.sin(n),c=i,h=t[c],u=h[0],d=h[1];--c>=0;)h=t[c],u=h[0]+o*(a=u)-l*d,d=h[1]+o*d+l*a;return u=o*(a=u)-l*d,d=o*d+l*a,[u,d]}var i=t.length-1;return e.invert=function(e,n){var a=20,r=e,s=n;do{for(var l,c=i,h=t[c],u=h[0],d=h[1],f=0,m=0;--c>=0;)h=t[c],f=u+r*(l=f)-s*m,m=d+r*m+s*l,u=h[0]+r*(l=u)-s*d,d=h[1]+r*d+s*l;f=u+r*(l=f)-s*m,m=d+r*m+s*l,u=r*(l=u)-s*d-e,d=r*d+s*l-n;var p,g,v=f*f+m*m;r-=p=(u*f+d*m)/v,s-=g=(d*f-u*m)/v}while(Math.abs(p)+Math.abs(g)>me*me&&--a>0);if(a){var b=Math.sqrt(r*r+s*s),y=2*Math.atan(.5*b),x=Math.sin(y);return[Math.atan2(r*x,b*Math.cos(y)),b?o(s*x/b):0]}},e}function Lt(){var t=Fe.miller,e=Me(At),i=e(t);return i.coefficients=function(i){return arguments.length?e(t="string"==typeof i?Fe[i]:i):t},i}function Rt(t,e){var i=Math.sqrt(6),n=Math.sqrt(7),a=Math.asin(7*Math.sin(e)/(3*i));return[i*t*(2*Math.cos(2*a/3)-1)/n,9*Math.sin(a/3)/n]}function jt(t,e){for(var i,n=(1+Math.SQRT1_2)*Math.sin(e),a=e,r=0;r<25&&(a-=i=(Math.sin(a/2)+Math.sin(a)-n)/(.5*Math.cos(a/2)+Math.cos(a)),!(Math.abs(i)<me));r++);return[t*(1+2*Math.cos(a)/Math.cos(a/2))/(3*Math.SQRT2),2*Math.sqrt(3)*Math.sin(a/2)/Math.sqrt(2+Math.SQRT2)]}function Nt(t,e){for(var i,n=Math.sqrt(6/(4+ge)),a=(1+ge/4)*Math.sin(e),r=e/2,s=0;s<25&&(r-=i=(r/2+Math.sin(r)-a)/(.5+Math.cos(r)),!(Math.abs(i)<me));s++);return[n*(.5+Math.cos(r))*t/1.5,n*r]}function Ft(t,e){var i=e*e,n=i*i;return[t*(.8707-.131979*i+n*(-.013791+n*(.003971*i-.001529*n))),e*(1.007226+i*(.015085+n*(-.044475+.028874*i-.005916*n)))]}function Bt(t,e){return[t*(1+Math.cos(e))/2,2*(e-Math.tan(e/2))]}function qt(t,e){var i=e*e;return[t,e*(Be+i*i*(qe+i*(He+Ye*i)))]}function Ht(t,e){if(Math.abs(e)<me)return[t,0];var i=Math.tan(e),n=t*Math.sin(e);return[Math.sin(n)/i,e+(1-Math.cos(n))/i]}function Yt(t){function e(e,n){var a=i?Math.tan(e*i/2)/i:e/2;if(!n)return[2*a,-t];var r=2*Math.atan(a*Math.sin(n)),s=1/Math.tan(n);return[Math.sin(r)*s,n+(1-Math.cos(r))*s-t]}var i=Math.sin(t);return e.invert=function(e,n){if(Math.abs(n+=t)<me)return[i?2*Math.atan(i*e/2)/i:e,0];var a,r=e*e+n*n,s=0,c=10;do{var h=Math.tan(s),u=1/Math.cos(s),d=r-2*n*s+s*s;s-=a=(h*d+2*(s-n))/(2+d*u*u+2*(s-n)*h)}while(Math.abs(a)>me&&--c>0);var f=e*(h=Math.tan(s)),m=Math.tan(Math.abs(n)<Math.abs(s+1/h)?.5*o(f):.5*l(f)+ge/4)/Math.sin(s);return[i?2*Math.atan(i*m)/i:2*m,s]},e}function Vt(t,e){var i,n=Math.min(18,36*Math.abs(e)/ge),a=Math.floor(n),r=n-a,s=(i=Qe[a])[0],o=i[1],l=(i=Qe[++a])[0],c=i[1],h=(i=Qe[Math.min(19,++a)])[0],u=i[1];return[t*(l+r*(h-s)/2+r*r*(h-2*l+s)/2),(e>0?ve:-ve)*(c+r*(u-o)/2+r*r*(u-2*c+o)/2)]}function Xt(t){function e(e,i){var n=Math.cos(i),a=(t-1)/(t-n*Math.cos(e));return[a*n*Math.sin(e),a*Math.sin(i)]}return e.invert=function(e,i){var n=e*e+i*i,a=Math.sqrt(n),r=(t-Math.sqrt(1-n*(t+1)/(t-1)))/((t-1)/a+a/(t-1));return[Math.atan2(e*r,a*Math.sqrt(1-r*r)),a?o(i*r/a):0]},e}function Wt(t,e){function i(e,i){var s=n(e,i),o=s[1],l=o*r/(t-1)+a;return[s[0]*a/l,o/l]}var n=Xt(t);if(!e)return n;var a=Math.cos(e),r=Math.sin(e);return i.invert=function(e,i){var s=(t-1)/(t-1-i*r);return n.invert(s*e,s*i*a)},i}function Kt(){var t=1.4,e=0,i=Me(Wt),n=i(t,e);return n.distance=function(n){return arguments.length?i(t=+n,e):t},n.tilt=function(n){return arguments.length?i(t,e=n*ge/180):180*e/ge},n}function Ut(t,e){var i=Math.tan(e/2),n=Math.sin(ge/4*i);return[t*(.74482-.34588*n*n),1.70711*i]}function Gt(t){function e(e,r){var s=l(Math.cos(r)*Math.cos(e-i)),o=l(Math.cos(r)*Math.cos(e-n)),h=r<0?-1:1;return s*=s,o*=o,[(s-o)/(2*t),h*c(4*a*o-(a-s+o)*(a-s+o))/(2*t)]}if(!t)return d3.geo.azimuthalEquidistant.raw;var i=-t/2,n=-i,a=t*t,r=Math.tan(n),s=.5/Math.sin(n);return e.invert=function(t,e){var a,o,c=e*e,h=Math.cos(Math.sqrt(c+(a=t+i)*a)),u=Math.cos(Math.sqrt(c+(a=t+n)*a));return[Math.atan2(o=h-u,a=(h+u)*r),(e<0?-1:1)*l(Math.sqrt(a*a+o*o)*s)]},e}function Qt(){var t=[[0,0],[0,0]],e=Me(Gt),i=e(0),n=i.rotate;return delete i.rotate,i.points=function(i){if(!arguments.length)return t;t=i;var a=d3.geo.interpolate(i[0],i[1]),r=a(.5),s=d3.geo.rotation([-r[0],-r[1]])(i[0]),l=.5*a.distance,c=-o(Math.sin(s[1]*ye)/Math.sin(l));return s[0]>0&&(c=ge-c),n.call(s,[-r[0],-r[1],-c*xe]),e(2*l)},i}function Zt(t){function e(t,e){var n=d3.geo.gnomonic.raw(t,e);return n[0]*=i,n}var i=Math.cos(t);return e.invert=function(t,e){return d3.geo.gnomonic.raw.invert(t/i,e)},e}function $t(){var t=[[0,0],[0,0]],e=Me(Zt),i=e(0),n=i.rotate;return delete i.rotate,i.points=function(i){if(!arguments.length)return t;t=i;var a=d3.geo.interpolate(i[0],i[1]),r=a(.5),s=d3.geo.rotation([-r[0],-r[1]])(i[0]),l=.5*a.distance,c=-o(Math.sin(s[1]*ye)/Math.sin(l));return s[0]>0&&(c=ge-c),n.call(s,[-r[0],-r[1],-c*xe]),e(l)},i}function Jt(t,e){if(Math.abs(e)<me)return[t,0];var i=Math.abs(e/ve),n=o(i);if(Math.abs(t)<me||Math.abs(Math.abs(e)-ve)<me)return[0,s(e)*ge*Math.tan(n/2)];var a=Math.cos(n),r=Math.abs(ge/t-t/ge)/2,l=r*r,c=a/(i+a-1),h=c*(2/i-1),u=h*h,d=u+l,f=c-u,m=l+c;return[s(t)*ge*(r*f+Math.sqrt(l*f*f-d*(c*c-u)))/d,s(e)*ge*(h*m-r*Math.sqrt((l+1)*d-m*m))/d]}function te(t,e){if(Math.abs(e)<me)return[t,0];var i=Math.abs(e/ve),n=o(i);if(Math.abs(t)<me||Math.abs(Math.abs(e)-ve)<me)return[0,s(e)*ge*Math.tan(n/2)];var a=Math.cos(n),r=Math.abs(ge/t-t/ge)/2,l=r*r,h=a*(Math.sqrt(1+l)-r*a)/(1+l*i*i);return[s(t)*ge*h,s(e)*ge*c(1-h*(2*r+h))]}function ee(t,e){if(Math.abs(e)<me)return[t,0];var i=e/ve,n=o(i);if(Math.abs(t)<me||Math.abs(Math.abs(e)-ve)<me)return[0,ge*Math.tan(n/2)];var a=(ge/t-t/ge)/2,r=i/(1+Math.cos(n));return[ge*(s(t)*c(a*a+1-r*r)-a),ge*r]}function ie(t,e){if(!e)return[t,0];var i=Math.abs(e);if(!t||i===ve)return[0,e];var n=i/ve,a=n*n,r=(8*n-a*(a+2)-5)/(2*a*(n-1)),o=r*r,l=n*r,h=a+o+2*l,u=n+3*r,d=t/ve,f=d+1/d,m=s(Math.abs(t)-ve)*Math.sqrt(f*f-4),p=m*m,g=h*(a+o*p-1)+(1-a)*(a*(u*u+4*o)+12*l*o+4*o*o),v=(m*(h+o-1)+2*c(g))/(4*h+p);return[s(t)*ve*v,s(e)*ve*c(1+m*Math.abs(v)-v*v)]}function ne(t,e){return[t*Math.sqrt(1-3*e*e/(ge*ge)),e]}function ae(t,e){var i=.90631*Math.sin(e),n=Math.sqrt(1-i*i),a=Math.sqrt(2/(1+n*Math.cos(t/=3)));return[2.66723*n*a*Math.sin(t),1.24104*i*a]}function re(t,e){var i=Math.cos(e),n=Math.cos(t)*i,a=1-n,r=Math.cos(t=Math.atan2(Math.sin(t)*i,-Math.sin(e))),s=Math.sin(t);return i=c(1-n*n),[s*i-r*a,-r*i-s*a]}function se(t,e){var i=d(t,e);return[(i[0]+t/ve)/2,(i[1]+e)/2]}d3.geo.project=function(t,i){var n=i.stream;if(!n)throw new Error("not yet supported");return(t&&oe.hasOwnProperty(t.type)?oe[t.type]:e)(t,n)};var oe={Feature:t,FeatureCollection:function(e,i){return{type:"FeatureCollection",features:e.features.map(function(e){return t(e,i)})}}},le=[],ce=[],he={point:function(t,e){le.push([t,e])},result:function t(){var t=le.length?le.length<2?{type:"Point",coordinates:le[0]}:{type:"MultiPoint",coordinates:le}:null;return le=[],t}},ue={lineStart:i,point:function(t,e){le.push([t,e])},lineEnd:function(){le.length&&(ce.push(le),le=[])},result:function t(){var t=ce.length?ce.length<2?{type:"LineString",coordinates:ce[0]}:{type:"MultiLineString",coordinates:ce}:null;return ce=[],t}},de={polygonStart:i,lineStart:i,point:function(t,e){le.push([t,e])},lineEnd:function(){var t=le.length;if(t){do le.push(le[0].slice());while(++t<4);ce.push(le),le=[]}},polygonEnd:i,result:function(){if(!ce.length)return null;var t=[],e=[];return ce.forEach(function(i){n(i)?t.push([i]):e.push(i)}),e.forEach(function(e){var i=e[0];t.some(function(t){if(a(t[0],i))return t.push(e),!0})||t.push([e])}),ce=[],t.length?t.length>1?{type:"MultiPolygon",coordinates:t}:{type:"Polygon",coordinates:t[0]}:null}},fe={Point:he,MultiPoint:he,LineString:ue,MultiLineString:ue,Polygon:de,MultiPolygon:de,Sphere:de},me=1e-6,pe=me*me,ge=Math.PI,ve=ge/2,be=Math.sqrt(ge),ye=ge/180,xe=180/ge,_e=d3.geo.projection,Me=d3.geo.projectionMutator;d3.geo.interrupt=function(t){function e(e,i){for(var n=i<0?-1:1,a=o[+(i<0)],r=0,s=a.length-1;r<s&&e>a[r][2][0];++r);var l=t(e-a[r][1][0],i);return l[0]+=t(a[r][1][0],n*i>n*a[r][0][1]?a[r][0][1]:i)[0],l}function i(){s=o.map(function(e){return e.map(function(e){var i,n=t(e[0][0],e[0][1])[0],a=t(e[2][0],e[2][1])[0],r=t(e[1][0],e[0][1])[1],s=t(e[1][0],e[1][1])[1];return r>s&&(i=r,r=s,s=i),[[n,r],[a,s]]})})}function n(){for(var t=1e-6,e=[],i=0,n=o[0].length;i<n;++i){var r=o[0][i],s=180*r[0][0]/ge,l=180*r[0][1]/ge,c=180*r[1][1]/ge,h=180*r[2][0]/ge,u=180*r[2][1]/ge;e.push(a([[s+t,l+t],[s+t,c-t],[h-t,c-t],[h-t,u+t]],30))}for(var i=o[1].length-1;i>=0;--i){var r=o[1][i],s=180*r[0][0]/ge,l=180*r[0][1]/ge,c=180*r[1][1]/ge,h=180*r[2][0]/ge,u=180*r[2][1]/ge;e.push(a([[h-t,u-t],[h-t,c+t],[s+t,c+t],[s+t,l-t]],30))}return{type:"Polygon",coordinates:[d3.merge(e)]}}function a(t,e){for(var i,n,a,r=-1,s=t.length,o=t[0],l=[];++r<s;){i=t[r],n=(i[0]-o[0])/e,a=(i[1]-o[1])/e;for(var c=0;c<e;++c)l.push([o[0]+c*n,o[1]+c*a]);o=i}return l.push(i),l}function r(t,e){return Math.abs(t[0]-e[0])<me&&Math.abs(t[1]-e[1])<me}var s,o=[[[[-ge,0],[0,ve],[ge,0]]],[[[-ge,0],[0,-ve],[ge,0]]]];t.invert&&(e.invert=function(i,n){for(var a=s[+(n<0)],l=o[+(n<0)],c=0,h=a.length;c<h;++c){var u=a[c];if(u[0][0]<=i&&i<u[1][0]&&u[0][1]<=n&&n<u[1][1]){var d=t.invert(i-t(l[c][1][0],0)[0],n);return d[0]+=l[c][1][0],r(e(d[0],d[1]),[i,n])?d:null}}});var l=d3.geo.projection(e),c=l.stream;return l.stream=function(t){var e=l.rotate(),i=c(t),a=(l.rotate([0,0]),c(t));return l.rotate(e),i.sphere=function(){d3.geo.stream(n(),a)},i},l.lobes=function(t){return arguments.length?(o=t.map(function(t){return t.map(function(t){return[[t[0][0]*ge/180,t[0][1]*ge/180],[t[1][0]*ge/180,t[1][1]*ge/180],[t[2][0]*ge/180,t[2][1]*ge/180]]})}),i(),l):o.map(function(t){return t.map(function(t){return[[180*t[0][0]/ge,180*t[0][1]/ge],[180*t[1][0]/ge,180*t[1][1]/ge],[180*t[2][0]/ge,180*t[2][1]/ge]]})})},l},(d3.geo.airy=u).raw=h,d.invert=function(t,e){if(!(t*t+4*e*e>ge*ge+me)){var i=t,n=e,a=25;do{var r,s=Math.sin(i),o=Math.sin(i/2),c=Math.cos(i/2),h=Math.sin(n),u=Math.cos(n),d=Math.sin(2*n),f=h*h,m=u*u,p=o*o,g=1-m*c*c,v=g?l(u*c)*Math.sqrt(r=1/g):r=0,b=2*v*u*o-t,y=v*h-e,x=r*(m*p+v*u*c*f),_=r*(.5*s*d-2*v*h*o),M=.25*r*(d*o-v*h*m*s),w=r*(f*c+v*p*u),z=_*M-w*x;if(!z)break;var S=(y*_-b*w)/z,k=(b*M-y*x)/z;i-=S,n-=k}while((Math.abs(S)>me||Math.abs(k)>me)&&--a>0);return[i,n]}},(d3.geo.aitoff=function(){return _e(d)}).raw=d,(d3.geo.armadillo=m).raw=f,x.invert=function(t,e){if(t*=3/8,e*=3/8,!t&&Math.abs(e)>1)return null;var i=t*t,n=e*e,a=1+i+n,r=Math.sqrt(.5*(a-Math.sqrt(a*a-4*e*e))),l=o(r)/3,c=r?y(Math.abs(e/r))/3:b(Math.abs(t))/3,h=Math.cos(l),u=v(c),d=u*u-h*h;return[2*s(t)*Math.atan2(g(c)*h,.25-d),2*s(e)*Math.atan2(u*Math.sin(l),.25+d)]},(d3.geo.august=function(){return _e(x)}).raw=x;var we=Math.log(1+Math.SQRT2);_.invert=function(t,e){if((n=Math.abs(e))<we)return[t,2*Math.atan(Math.exp(e))-ve];var i,n,a=Math.sqrt(8),r=ge/4,o=25;do{var l=Math.cos(r/2),c=Math.tan(r/2);r-=i=(a*(r-ge/4)-Math.log(c)-n)/(a-.5*l*l/c)}while(Math.abs(i)>pe&&--o>0);return[t/(Math.cos(r)*(a-1/Math.sin(r))),s(e)*r]},(d3.geo.baker=function(){return _e(_)}).raw=_;var ze=d3.geo.azimuthalEquidistant.raw;(d3.geo.berghaus=w).raw=M;var Se=z(ge),ke=S(Math.SQRT2/ve,Math.SQRT2,ge);(d3.geo.mollweide=function(){return _e(ke)}).raw=ke,k.invert=function(t,e){var i,n,a=2.00276,r=a*e,s=e<0?-ge/4:ge/4,o=25;do n=r-Math.SQRT2*Math.sin(s),s-=i=(Math.sin(2*s)+2*s-ge*Math.sin(n))/(2*Math.cos(2*s)+2+ge*Math.cos(n)*Math.SQRT2*Math.cos(s));while(Math.abs(i)>me&&--o>0);return n=r-Math.SQRT2*Math.sin(s),[t*(1/Math.cos(n)+1.11072/Math.cos(s))/a,n]},(d3.geo.boggs=function(){return _e(k)}).raw=k,O.invert=function(t,e){return[t/Math.cos(e),e]},(d3.geo.sinusoidal=function(){return _e(O)}).raw=O,(d3.geo.bonne=function(){return E(T).parallel(45)}).raw=T;var Ee=S(1,4/ge,ge);(d3.geo.bromley=function(){return _e(Ee)}).raw=Ee,(d3.geo.chamberlin=D).raw=P,R.invert=function(t,e){var i=(i=e/be-1)*i;return[i>0?t*Math.sqrt(ge/i)/2:0,o(1-i)]},(d3.geo.collignon=function(){return _e(R)}).raw=R,(d3.geo.craig=function(){return E(j)}).raw=j,N.invert=function(t,e){var i=Math.sqrt(3),n=3*o(e/(i*be));return[be*t/(i*(2*Math.cos(2*n/3)-1)),n]},(d3.geo.craster=function(){return _e(N)}).raw=N,(d3.geo.cylindricalEqualArea=function(){return E(F)}).raw=F,(d3.geo.cylindricalStereographic=function(){return E(B)}).raw=B,q.invert=function(t,e){var i=Math.sqrt(8/(3*ge)),n=e/i;return[t/(i*(1-Math.abs(n)/ge)),n]},(d3.geo.eckert1=function(){return _e(q)}).raw=q,H.invert=function(t,e){var i=2-Math.abs(e)/Math.sqrt(2*ge/3);return[t*Math.sqrt(6*ge)/(2*i),s(e)*o((4-i*i)/3)]},(d3.geo.eckert2=function(){return _e(H)}).raw=H,Y.invert=function(t,e){var i=Math.sqrt(ge*(4+ge))/2;return[t*i/(1+c(1-e*e*(4+ge)/(4*ge))),e*i/2]},(d3.geo.eckert3=function(){return _e(Y)}).raw=Y,V.invert=function(t,e){var i=.5*e*Math.sqrt((4+ge)/ge),n=o(i),a=Math.cos(n);return[t/(2/Math.sqrt(ge*(4+ge))*(1+a)),o((n+i*(a+2))/(2+ve))]},(d3.geo.eckert4=function(){return _e(V)}).raw=V,X.invert=function(t,e){var i=Math.sqrt(2+ge),n=e*i/2;return[i*t/(1+Math.cos(n)),n]},(d3.geo.eckert5=function(){return _e(X)}).raw=X,W.invert=function(t,e){var i=1+ve,n=Math.sqrt(i/2);return[2*t*n/(1+Math.cos(e*=n)),o((e+Math.sin(e))/i)]},(d3.geo.eckert6=function(){return _e(W)}).raw=W,K.invert=function(t,e){var i=d3.geo.august.raw.invert(t/1.2,1.065*e);if(!i)return null;var n=i[0],a=i[1],r=20;t/=Oe,e/=Oe;do{var s=n/2,o=a/2,l=Math.sin(s),c=Math.cos(s),h=Math.sin(o),u=Math.cos(o),d=Math.cos(a),f=Math.sqrt(d),m=h/(u+Math.SQRT2*c*f),p=m*m,g=Math.sqrt(2/(1+p)),v=Math.SQRT2*u+(c+l)*f,b=Math.SQRT2*u+(c-l)*f,y=v/b,x=Math.sqrt(y),_=x-1/x,M=x+1/x,w=g*_-2*Math.log(x)-t,z=g*m*M-2*Math.atan(m)-e,S=h&&Math.SQRT1_2*f*l*p/h,k=(Math.SQRT2*c*u+f)/(2*(u+Math.SQRT2*c*f)*(u+Math.SQRT2*c*f)*f),E=-.5*m*g*g*g,O=E*S,T=E*k,P=(P=2*u+Math.SQRT2*f*(c-l))*P*x,D=(Math.SQRT2*c*u*f+d)/P,I=-(Math.SQRT2*l*h)/(f*P),C=_*O-2*D/x+g*(D+D/y),A=_*T-2*I/x+g*(I+I/y),L=m*M*O-2*S/(1+p)+g*M*S+g*m*(D-D/y),R=m*M*T-2*k/(1+p)+g*M*k+g*m*(I-I/y),j=A*L-R*C;if(!j)break;var N=(z*A-w*R)/j,F=(w*L-z*C)/j;n-=N,a=Math.max(-ve,Math.min(ve,a-F))}while((Math.abs(N)>me||Math.abs(F)>me)&&--r>0);return Math.abs(Math.abs(a)-ve)<me?[0,a]:r&&[n,a]};var Oe=3+2*Math.SQRT2;(d3.geo.eisenlohr=function(){return _e(K)}).raw=K,U.invert=function(t,e){var i=e/(1+Te);return[t?t/(Te*c(1-i*i)):0,2*Math.atan(i)]};var Te=Math.cos(35*ye);(d3.geo.fahey=function(){return _e(U)}).raw=U,G.invert=function(t,e){var i=Math.atan(e/be),n=Math.cos(i),a=2*i;return[t*be*.5/(Math.cos(a)*n*n),a]},(d3.geo.foucaut=function(){return _e(G)}).raw=G,d3.geo.gilbert=function(t){function e(e){return t([.5*e[0],o(Math.tan(.5*e[1]*ye))*xe])}var i=d3.geo.equirectangular().scale(xe).translate([0,0]);return t.invert&&(e.invert=function(e){return e=t.invert(e),e[0]*=2,e[1]=2*Math.atan(Math.sin(e[1]*ye))*xe,e}),e.stream=function(e){e=t.stream(e);var n=i.stream({point:function(t,i){e.point(.5*t,o(Math.tan(.5*-i*ye))*xe)},lineStart:function(){e.lineStart()},lineEnd:function(){e.lineEnd()},polygonStart:function(){e.polygonStart()},polygonEnd:function(){e.polygonEnd()}});return n.sphere=function(){e.sphere()},n.valid=!1,n},e};var Pe=d3.geo.azimuthalEquidistant.raw;(d3.geo.gingery=$).raw=Q;var De=tt(2.8284,-1.6988,.75432,-.18071,1.76003,-.38914,.042555);(d3.geo.ginzburg4=function(){return _e(De)}).raw=De;var Ie=tt(2.583819,-.835827,.170354,-.038094,1.543313,-.411435,.082742);(d3.geo.ginzburg5=function(){return _e(Ie)}).raw=Ie;var Ce=tt(5/6*ge,-.62636,-.0344,0,1.3493,-.05524,0,.045);(d3.geo.ginzburg6=function(){return _e(Ce)}).raw=Ce,et.invert=function(t,e){var i,n=t,a=e,r=50;do{var s=a*a;a-=i=(a*(1+s/12)-e)/(1+s/4)}while(Math.abs(i)>me&&--r>0);r=50,t/=1-.162388*s;do{var o=(o=n*n)*o;n-=i=(n*(.87-952426e-9*o)-t)/(.87-.00476213*o)}while(Math.abs(i)>me&&--r>0);return[n,a]},(d3.geo.ginzburg8=function(){return _e(et)}).raw=et;var Ae=tt(2.6516,-.76534,.19123,-.047094,1.36289,-.13965,.031762);(d3.geo.ginzburg9=function(){return _e(Ae)}).raw=Ae,nt.invert=function(t,e){var i=s(t),n=s(e),a=-i*t,r=-n*e,l=r/a<1,c=rt(l?r:a,l?a:r),h=c[0],u=c[1];l&&(h=-ve-h);var d=Math.cos(u),t=Math.cos(h)*d,e=Math.sin(h)*d,f=Math.sin(u);return[i*(Math.atan2(e,-f)+ge),n*o(t)]},d3.geo.gringorten=it(nt),ht.invert=function(t,e){var i=(Math.SQRT2-1)/(Math.SQRT2+1),n=Math.sqrt(1-i*i),a=ct(ve,n*n),r=-1,s=st(.5*a-e,-t,n*n),o=dt(s[0],s[1]),l=Math.atan2(o[1],o[0])/r;return[l,2*Math.atan(Math.exp(.5/r*Math.log(i*o[0]*o[0]+i*o[1]*o[1])))-ve]},d3.geo.guyou=it(ht),(d3.geo.hammerRetroazimuthal=pt).raw=ft;var Le=d3.geo.azimuthalEqualArea.raw;bt.invert=function(t,e){var i=2*o(e/2);
return[t*Math.cos(i/2)/Math.cos(i),i]},(d3.geo.hammer=vt).raw=gt,yt.invert=function(t,e){var i=Math.abs(i=e*(e<0?.5179951515653813:.5686373742600607))>1-me?i>0?ve:-ve:o(i);return[1.1764705882352942*t/Math.cos(i),Math.abs(i=((i+=i)+Math.sin(i))*(e<0?.4102345310814193:.3736990601468637))>1-me?i>0?ve:-ve:o(i)]},(d3.geo.hatano=function(){return _e(yt)}).raw=yt;var Re=41+48/36+37/3600;(d3.geo.healpix=_t).raw=xt,(d3.geo.hill=wt).raw=Mt;var je=.7109889596207567,Ne=.0528035274542;zt.invert=function(t,e){return e>-je?ke.invert(t,e-Ne):O.invert(t,e)},(d3.geo.sinuMollweide=function(){return _e(zt).rotate([-20,-55])}).raw=zt,St.invert=function(t,e){return Math.abs(e)>je?ke.invert(t,e+(e>0?Ne:-Ne)):O.invert(t,e)},(d3.geo.homolosine=function(){return _e(St)}).raw=St,kt.invert=function(t,e){return[2/3*ge*t/Math.sqrt(ge*ge/3-e*e),e]},(d3.geo.kavrayskiy7=function(){return _e(kt)}).raw=kt,(d3.geo.lagrange=Ot).raw=Et,Tt.invert=function(t,e){var i=Math.abs(t),n=Math.abs(e),a=ge/Math.SQRT2,r=me,s=ve;n<a?s*=n/a:r+=6*l(a/n);for(var o=0;o<25;o++){var h=Math.sin(s),u=c(Math.cos(s)),d=Math.sin(s/2),f=Math.cos(s/2),m=Math.sin(r/6),p=Math.cos(r/6),g=.5*r*(1+u)-i,v=s/(f*p)-n,b=u?-.25*r*h/u:0,y=.5*(1+u),x=(1+.5*s*d/f)/(f*p),_=s/f*(m/6)/(p*p),M=b*_-x*y,w=(g*_-v*y)/M,z=(v*b-g*x)/M;if(s-=w,r-=z,Math.abs(w)<me&&Math.abs(z)<me)break}return[t<0?-r:r,e<0?-s:s]},(d3.geo.larrivee=function(){return _e(Tt)}).raw=Tt,Pt.invert=function(t,e){var i=s(t)*ge,n=e/2,a=50;do{var r=i*i,o=n*n,l=i*n,c=i*(.975534+o*(-.119161+r*-.0143059+o*-.0547009))-t,h=n*(1.00384+r*(.0802894+o*-.02855+199025e-9*r)+o*(.0998909+o*-.0491032))-e,u=.975534-o*(.119161+3*r*.0143059+.0547009*o),d=-l*(.238322+.2188036*o+.0286118*r),f=l*(.1605788+7961e-7*r+-.0571*o),m=1.00384+r*(.0802894+199025e-9*r)+o*(3*(.0998909-.02855*r)-.245516*o),p=d*f-m*u,g=(h*d-c*m)/p,v=(c*f-h*u)/p;i-=g,n-=v}while((Math.abs(g)>me||Math.abs(v)>me)&&--a>0);return a&&[i,n]},(d3.geo.laskowski=function(){return _e(Pt)}).raw=Pt,Dt.invert=function(t,e){var i=t*t,n=e*e,a=n+1,r=t?Math.SQRT1_2*Math.sqrt((a-Math.sqrt(i*i+2*i*(n-1)+a*a))/i+1):1/Math.sqrt(a);return[o(t*r),s(e)*l(r)]},(d3.geo.littrow=function(){return _e(Dt)}).raw=Dt,(d3.geo.loximuthal=function(){return E(It).parallel(40)}).raw=It,Ct.invert=function(t,e){return[t,2.5*Math.atan(Math.exp(.8*e))-.625*ge]},(d3.geo.miller=function(){return _e(Ct)}).raw=Ct;var Fe={alaska:[[.9972523,0],[.0052513,-.0041175],[.0074606,.0048125],[-.0153783,-.1968253],[.0636871,-.1408027],[.3660976,-.2937382]],gs48:[[.98879,0],[0,0],[-.050909,0],[0,0],[.075528,0]],gs50:[[.984299,0],[.0211642,.0037608],[-.1036018,-.0575102],[-.0329095,-.0320119],[.0499471,.1223335],[.026046,.0899805],[7388e-7,-.1435792],[.0075848,-.1334108],[-.0216473,.0776645],[-.0225161,.0853673]],miller:[[.9245,0],[0,0],[.01943,0]],lee:[[.721316,0],[0,0],[-.00881625,-.00617325]]};(d3.geo.modifiedStereographic=Lt).raw=At,Rt.invert=function(t,e){var i=Math.sqrt(6),n=Math.sqrt(7),a=3*o(e*n/9);return[t*n/(i*(2*Math.cos(2*a/3)-1)),o(3*Math.sin(a)*i/7)]},(d3.geo.mtFlatPolarParabolic=function(){return _e(Rt)}).raw=Rt,jt.invert=function(t,e){var i=e*Math.sqrt(2+Math.SQRT2)/(2*Math.sqrt(3)),n=2*o(i);return[3*Math.SQRT2*t/(1+2*Math.cos(n)/Math.cos(n/2)),o((i+Math.sin(n))/(1+Math.SQRT1_2))]},(d3.geo.mtFlatPolarQuartic=function(){return _e(jt)}).raw=jt,Nt.invert=function(t,e){var i=Math.sqrt(6/(4+ge)),n=e/i;return Math.abs(Math.abs(n)-ve)<me&&(n=n<0?-ve:ve),[1.5*t/(i*(.5+Math.cos(n))),o((n/2+Math.sin(n))/(1+ge/4))]},(d3.geo.mtFlatPolarSinusoidal=function(){return _e(Nt)}).raw=Nt,Ft.invert=function(t,e){var i,n=e,a=25;do{var r=n*n,s=r*r;n-=i=(n*(1.007226+r*(.015085+s*(-.044475+.028874*r-.005916*s)))-e)/(1.007226+r*(.045255+s*(-.311325+.259866*r-.005916*11*s)))}while(Math.abs(i)>me&&--a>0);return[t/(.8707+(r=n*n)*(-.131979+r*(-.013791+r*r*r*(.003971-.001529*r)))),n]},(d3.geo.naturalEarth=function(){return _e(Ft)}).raw=Ft,Bt.invert=function(t,e){for(var i=e/2,n=0,a=1/0;n<10&&Math.abs(a)>me;n++){var r=Math.cos(e/2);e-=a=(e-Math.tan(e/2)-i)/(1-.5/(r*r))}return[2*t/(1+Math.cos(e)),e]},(d3.geo.nellHammer=function(){return _e(Bt)}).raw=Bt;var Be=1.0148,qe=.23185,He=-.14499,Ye=.02406,Ve=Be,Xe=5*qe,We=7*He,Ke=9*Ye,Ue=1.790857183;qt.invert=function(t,e){e>Ue?e=Ue:e<-Ue&&(e=-Ue);var i,n=e;do{var a=n*n;n-=i=(n*(Be+a*a*(qe+a*(He+Ye*a)))-e)/(Ve+a*a*(Xe+a*(We+Ke*a)))}while(Math.abs(i)>me);return[t,n]},(d3.geo.patterson=function(){return _e(qt)}).raw=qt;var Ge=it(ht);(d3.geo.peirceQuincuncial=function(){return Ge().quincuncial(!0).rotate([-90,-90,45]).clipAngle(180-1e-6)}).raw=Ge.raw,Ht.invert=function(t,e){if(Math.abs(e)<me)return[t,0];var i,n=t*t+e*e,a=.5*e,r=10;do{var c=Math.tan(a),h=1/Math.cos(a),u=n-2*e*a+a*a;a-=i=(c*u+2*(a-e))/(2+u*h*h+2*(a-e)*c)}while(Math.abs(i)>me&&--r>0);return c=Math.tan(a),[(Math.abs(e)<Math.abs(a+1/c)?o(t*c):s(t)*(l(Math.abs(t*c))+ve))/Math.sin(a),a]},(d3.geo.polyconic=function(){return _e(Ht)}).raw=Ht,(d3.geo.rectangularPolyconic=function(){return E(Yt)}).raw=Yt;var Qe=[[.9986,-.062],[1,0],[.9986,.062],[.9954,.124],[.99,.186],[.9822,.248],[.973,.31],[.96,.372],[.9427,.434],[.9216,.4958],[.8962,.5571],[.8679,.6176],[.835,.6769],[.7986,.7346],[.7597,.7903],[.7186,.8435],[.6732,.8936],[.6213,.9394],[.5722,.9761],[.5322,1]];Qe.forEach(function(t){t[1]*=1.0144}),Vt.invert=function(t,e){var i=e/ve,n=90*i,a=Math.min(18,Math.abs(n/5)),r=Math.max(0,Math.floor(a));do{var s=Qe[r][1],o=Qe[r+1][1],l=Qe[Math.min(19,r+2)][1],c=l-s,h=l-2*o+s,u=2*(Math.abs(i)-o)/c,d=h/c,f=u*(1-d*u*(1-2*d*u));if(f>=0||1===r){n=(e>=0?5:-5)*(f+a);var m,p=50;do a=Math.min(18,Math.abs(n)/5),r=Math.floor(a),f=a-r,s=Qe[r][1],o=Qe[r+1][1],l=Qe[Math.min(19,r+2)][1],n-=(m=(e>=0?ve:-ve)*(o+f*(l-s)/2+f*f*(l-2*o+s)/2)-e)*xe;while(Math.abs(m)>pe&&--p>0);break}}while(--r>=0);var g=Qe[r][0],v=Qe[r+1][0],b=Qe[Math.min(19,r+2)][0];return[t/(v+f*(b-g)/2+f*f*(b-2*v+g)/2),n*ye]},(d3.geo.robinson=function(){return _e(Vt)}).raw=Vt,(d3.geo.satellite=Kt).raw=Wt,Ut.invert=function(t,e){var i=e/1.70711,n=Math.sin(ge/4*i);return[t/(.74482-.34588*n*n),2*Math.atan(i)]},(d3.geo.times=function(){return _e(Ut)}).raw=Ut,(d3.geo.twoPointEquidistant=Qt).raw=Gt,(d3.geo.twoPointAzimuthal=$t).raw=Zt,Jt.invert=function(t,e){if(Math.abs(e)<me)return[t,0];if(Math.abs(t)<me)return[0,ve*Math.sin(2*Math.atan(e/ge))];var i=(t/=ge)*t,n=(e/=ge)*e,a=i+n,r=a*a,o=-Math.abs(e)*(1+a),c=o-2*n+i,h=-2*o+1+2*n+r,u=n/h+(2*c*c*c/(h*h*h)-9*o*c/(h*h))/27,d=(o-c*c/(3*h))/h,f=2*Math.sqrt(-d/3),m=l(3*u/(d*f))/3;return[ge*(a-1+Math.sqrt(1+2*(i-n)+r))/(2*t),s(e)*ge*(-f*Math.cos(m+ge/3)-c/(3*h))]},(d3.geo.vanDerGrinten=function(){return _e(Jt)}).raw=Jt,te.invert=function(t,e){if(!t)return[0,ve*Math.sin(2*Math.atan(e/ge))];var i=Math.abs(t/ge),n=(1-i*i-(e/=ge)*e)/(2*i),a=n*n,r=Math.sqrt(a+1);return[s(t)*ge*(r-n),s(e)*ve*Math.sin(2*Math.atan2(Math.sqrt((1-2*n*i)*(n+r)-i),Math.sqrt(r+n+i)))]},(d3.geo.vanDerGrinten2=function(){return _e(te)}).raw=te,ee.invert=function(t,e){if(!e)return[t,0];var i=e/ge,n=(ge*ge*(1-i*i)-t*t)/(2*ge*t);return[t?ge*(s(t)*Math.sqrt(n*n+1)-n):0,ve*Math.sin(2*Math.atan(i))]},(d3.geo.vanDerGrinten3=function(){return _e(ee)}).raw=ee,ie.invert=function(t,e){if(!t||!e)return[t,e];e/=ge;var i=s(t)*t/ve,n=(i*i-1+4*e*e)/Math.abs(i),a=n*n,r=2*e,o=50;do{var l=r*r,c=(8*r-l*(l+2)-5)/(2*l*(r-1)),h=(3*r-l*r-10)/(2*l*r),u=c*c,d=r*c,f=r+c,m=f*f,p=r+3*c,g=m*(l+u*a-1)+(1-l)*(l*(p*p+4*u)+u*(12*d+4*u)),v=-2*f*(4*d*u+(1-4*l+3*l*l)*(1+h)+u*(-6+14*l-a+(-8+8*l-2*a)*h)+d*(-8+12*l+(-10+10*l-a)*h)),b=Math.sqrt(g),y=n*(m+u-1)+2*b-i*(4*m+a),x=n*(2*c*h+2*f*(1+h))+v/b-8*f*(n*(-1+u+m)+2*b)*(1+h)/(a+4*m);r-==y/x}while(>me&&--o>0);return[s(t)*(Math.sqrt(n*n+4)+n)*ge/4,ve*r]},(d3.geo.vanDerGrinten4=function(){return _e(ie)}).raw=ie;var Ze=function(){var t=4*ge+3*Math.sqrt(3),e=2*Math.sqrt(2*ge*Math.sqrt(3)/t);return S(e*Math.sqrt(3)/ge,e,t/6)}();(d3.geo.wagner4=function(){return _e(Ze)}).raw=Ze,ne.invert=function(t,e){return[t/Math.sqrt(1-3*e*e/(ge*ge)),e]},(d3.geo.wagner6=function(){return _e(ne)}).raw=ne,ae.invert=function(t,e){var i=t/2.66723,n=e/1.24104,a=Math.sqrt(i*i+n*n),r=2*o(a/2);return[3*Math.atan2(t*Math.tan(r),2.66723*a),a&&o(e*Math.sin(r)/(1.24104*.90631*a))]},(d3.geo.wagner7=function(){return _e(ae)}).raw=ae,re.invert=function(t,e){var i=-.5*(t*t+e*e),n=Math.sqrt(-i*(2+i)),a=e*i+t*n,r=t*i-e*n,s=Math.sqrt(r*r+a*a);return[Math.atan2(n*a,s*(1+i)),s?-o(n*r/s):0]},(d3.geo.wiechel=function(){return _e(re)}).raw=re,se.invert=function(t,e){var i=t,n=e,a=25;do{var r,s=Math.cos(n),o=Math.sin(n),c=Math.sin(2*n),h=o*o,u=s*s,d=Math.sin(i),f=Math.cos(i/2),m=Math.sin(i/2),p=m*m,g=1-u*f*f,v=g?l(s*f)*Math.sqrt(r=1/g):r=0,b=.5*(2*v*s*m+i/ve)-t,y=.5*(v*o+n)-e,x=.5*r*(u*p+v*s*f*h)+.5/ve,_=r*(d*c/4-v*o*m),M=.125*r*(c*m-v*o*u*d),w=.5*r*(h*f+v*p*s)+.5,z=_*M-w*x,S=(y*_-b*w)/z,k=(b*M-y*x)/z;i-=S,n-=k}while((Math.abs(S)>me||Math.abs(k)>me)&&--a>0);return[i,n]},(d3.geo.winkel3=function(){return _e(se)}).raw=se}},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var a=i(21),r=n(a),s="",o=[],l='<?xml version="1.0" encoding="utf-8"?>';e.default=r.default.extend({init:function(t){this.context=t,this.shapes=[],this.groups=[],this.counter=0,this.name="",this.label=""},reset:function(){this.container.remove(),this.context.element.selectAll(".vzb-export-redball").remove(),this.context.element.selectAll(".vzb-export-counter").remove(),this.counter=0},prefix:function(t){return arguments.length?(s=t,this):s},deleteClasses:function(t){return arguments.length?(o=t,this):o},open:function(t,e){var i=this;this.svg&&this.reset(),t||(t=this.context.element),e||(e=this.context.name),this.name=e;var n=parseInt(t.style("width"),10)||0,a=parseInt(t.style("height"),10)||0;this.container=t.append("div").attr("class","vzb-svg-export"),this.svg=this.container.node().appendChild(t.select("svg").node().cloneNode(!0)),this.svg=d3.select(this.svg),this.svg.attr("viewBox","0 0 "+n+" "+a).attr("version","1.1").attr("param1","http://www.w3.org/2000/svg").attr("param2","http://www.w3.org/1999/xlink").attr("x","0px").attr("y","0px").attr("style","enable-background:new 0 0 "+n+" "+a).attr("xml:space","preserve"),this.redBall=t.append("div").attr("class","vzb-export-redball").style("position","absolute").style("top","20px").style("right","20px").style("width","20px").style("height","20px").style("background","red").style("color","white").style("text-align","center").style("border-radius","10px").style("font-size","14px").style("line-height","20px").style("opacity",.8).style("cursor","pointer").on("mouseover",function(){d3.select(this).style("opacity",1).text(""),i.counterEl.text("Download")}).on("mouseout",function(){d3.select(this).style("opacity",.8).text(""),i.counterEl.text(i.label)}).on("click",function(){i.close()}),this.counterEl=t.append("div").attr("class","vzb-export-counter").style("position","absolute").style("top","20px").style("right","45px").style("color","red").style("opacity",.8).style("line-height","20px").style("font-size","14px").style("text-align","center"),this.root=this.svg.select("."+s+"graph"),this.root.selectAll("g, text, svg, line, rect").filter(function(){var t=d3.select(this),e=!1;return o.forEach(function(i){e=e||t.classed(i)}),e}).remove(),this.svg.selectAll(".tick line").attr("fill","none").attr("stroke","#999"),this.svg.selectAll("."+s+"axis-x path").attr("fill","none").attr("stroke","#999"),this.svg.selectAll("."+s+"axis-y path").attr("fill","none").attr("stroke","#999")},write:function(t){var e="time";if(this.root||this.open(),!(this.shapes.indexOf(t.id+"_"+t.time)>-1)){this.shapes.push(t.id+"_"+t.time),this.groups.indexOf(t[e])==-1&&(this.root.append("g").attr("id","g_"+t[e]),this.groups.push(t[e])),null==t.opacity&&(t.opacity=.5),null==t.fill&&(t.fill="#ff80dd");var i=this.root.select("#g_"+t[e]).append(t.type).attr("id",t.id+"_"+t.time).style("fill",t.fill).style("opacity",t.opacity);switch(t.type){case"path":i.attr("d",t.d);break;case"circle":i.attr("cx",t.cx).attr("cy",t.cy).attr("r",t.r)}this.counter++,this.redBall.style("opacity",this.counter%10/12+.2),this.label=t.type+" shapes: "+this.counter,this.counterEl.text(this.label)}},close:function(){var t=l+" "+this.container.node().innerHTML.replace("param1","xmlns").replace("param2","xmlns:xlink").replace(/\d+(\.\d+)/g,function(t){return Math.round(100*+t)/100+""});if(t.length/1024/1024>2)alert("The file size is "+Math.round(t.length/1024)+"kB, which is too large to download. Will try to print it in the console instead..."),console.log(t);else{var e=document.createElement("a");e.download=this.name+" "+this.counter+" shapes.svg",e.href="data:,"+t,e.click()}}})},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),s=a(r),o=i(41),l=n(o),c={_continuous:{_default:"#ffb600",0:"#B4DE79",50:"#E1CE00",100:"#F77481"},_discrete:{_default:"#ffb600",0:"#4cd843",1:"#e83739",2:"#ff7f00",3:"#c027d4",4:"#d66425",5:"#0ab8d8",6:"#bcfa83",7:"#ff8684",8:"#ffb04b",9:"#f599f5",10:"#f4f459",11:"#7fb5ed"},_default:{_default:"#93daec"}},h=l.default.extend({getClassDefaults:function(){var t={use:null,which:null,scaleType:null,syncModels:[],palette:{},paletteLabels:null,allow:{scales:["linear","log","genericLog","time","pow","ordinal"]}};return s.deepExtend(this._super(),t)},autoGenerateModel:function(){if(null==this.which){var t;if(this.autogenerate){var t=this.dataSource.getConceptByIndex(this.autogenerate.conceptIndex,this.autogenerate.conceptType);t&&(this.which=t.concept,this.use="indicator",this.scaleType="linear")}t||(this.which="_default",this.use="constant",this.scaleType="ordinal")}null==this.scaleType&&(this.scaleType=this.dataSource.getConceptprops(this.which).scales[0])},init:function(t,e,i,n){var a=this;this._type="color",this._super(t,e,i,n),this._syncModelReferences={},this._hasDefaultColor=!1,this.on("hook_change",function(){if(!a._readyOnce&&a.palette&&0!==Object.keys(a.palette._data).length){var t=a.getDefaultPalette(),e=a.getPalette(!0),i={};Object.keys(t).map(function(n){e[n]&&t[n]!=e[n]||(i[n]=t[n])}),a.set("palette",i,!1,!1)}})},setInterModelListeners:function(){this._super(),this._setSyncModels()},getColorShade:function(t){var e=this.getPalette();if(!t)return s.warn("getColorShade() is missing arguments");if(t.colorID&&e[t.colorID]||(t.colorID="_default"),!s.isArray(e[t.colorID]))return e[t.colorID];var i=this.getConceptprops().color,n=t.shadeID&&i&&i.shades&&i.shades[t.shadeID]?i.shades[t.shadeID]:0;return e[t.colorID][n]},isUserSelectable:function(){var t=this.getConceptprops().color;return null==t||null==t.selectable||t.selectable},setWhich:function(t){this._super(t),this.palette&&(this.palette._data={}),this._setSyncModels()},_setSyncModels:function(){var t=this;this.syncModels.forEach(function(e){var i=t.getClosestModel(e),n=i.isHook()?i._parent:i,a=n.getClosestModel(n.space[0]);t._syncModelReferences[e]={model:i,marker:n,entities:a},t.isDiscrete()&&t._setSyncModel(i,n,a)})},_setSyncModel:function(t,e,i){if(t==e){var n={dim:this.which,show:{}};e.setDataSourceForAllSubhooks(this.data),i.set(n,!1,!1)}else t.isDiscrete()&&"constant"!==t.use&&t.set({which:this.which,data:this.data},!1,!1)},getColorlegendMarker:function(){return(this._syncModelReferences.marker_colorlegend||{}).marker},getColorlegendEntities:function(){return(this._syncModelReferences.marker_colorlegend||{}).entities},setColor:function(t,e){var i=this.getPalette();i[e]=t,this.scale.range(s.values(i)),this.palette[e]=t},mapValue:function(t){return null!=this.scale&&this.isDiscrete()&&this._hasDefaultColor&&this.scale.domain().indexOf(t)==-1&&(t="_default"),this._super(t)},getDefaultPalette:function(){var t,e=this.getConceptprops().color;return this.discreteDefaultPalette=!1,e&&e.palette?t=s.clone(e.palette):c[this.which]?t=s.clone(c[this.which]):"constant"===this.use?t=/^#([0-9a-f]{3}|[0-9a-f]{6})$/.test(this.which)?{_default:this.which}:s.clone(c._default):(t=s.clone(c[this.isDiscrete()?"_discrete":"_continuous"]),this.discreteDefaultPalette=!0),t},_getPaletteLabels:function(){var t=this.getConceptprops().color,e=null;return t&&t.paletteLabels&&(e=s.clone(t.paletteLabels)),e},getPaletteLabels:function(){return this.paletteLabels.getPlainObject()},getPalette:function(t){if(!this.palette||0===Object.keys(this.palette._data).length){var e=this.getDefaultPalette();this.set("palette",e,!1,!1);var i=this._getPaletteLabels();this.set("paletteLabels",i,!1,!1)}var e=this.palette.getPlainObject();return"indicator"!==this.use||t||delete e._default,e},buildScale:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.scaleType,e=this,i=e.getPalette(),n=Object.keys(i),a=s.values(i);if(this._hasDefaultColor=n.indexOf("_default")>-1,"time"==t){var r=this._space.time,o=r.splash?{min:r.parse(r.startOrigin),max:r.parse(r.endOrigin)}:{min:r.start,max:r.end},l=o.max-o.min==0;n=n.sort(function(t,e){return t-e}),a=n.map(function(t){return l?i[n[0]]:i[t]}),n=n.map(function(t){return o.min.valueOf()+t/100*(o.max.valueOf()-o.min.valueOf())}),this.scale=d3.time.scale.utc().domain(n).range(a).interpolate(d3.interpolateRgb)}else if(this.isDiscrete())a=a.map(function(t){return s.isArray(t)?t[0]:t}),t="ordinal",this.discreteDefaultPalette&&(n=n.concat(this.getUnique(this.which))),this.scale=d3.scale[t]().domain(n).range(a);else{var o=this.getLimits(this.which);o=[o.min,o.max],o=this.getConceptprops().domain?this.getConceptprops().domain:o;var l=o[1]-o[0]==0;if(n=n.sort(function(t,e){return t-e}),a=n.map(function(t){return l?i[n[0]]:i[t]}),n=n.map(function(t){return o[0]+t/100*(o[1]-o[0])}),d3.min(n)<=0&&d3.max(n)>=0&&"log"===t&&(t="genericLog"),"log"==t||"genericLog"==t){var c=d3.scale.genericLog().domain(o).range(o);n=n.map(function(t){return c.invert(t)})}this.scale=d3.scale[t]().domain(n).range(a).interpolate(d3.interpolateRgb)}this.scaleType=t}});e.default=h},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s=i(1),o=a(s),l=i(47),c=n(l),h=i(71),u=n(h),d=i(46),f=n(d),m=c.default.extend({getClassDefaults:function(){var t={reader:"csv"};return o.deepExtend(this._super(),t)},trackInstances:!0,init:function(t,e,i,n){this._type="data",this.queryQueue={},this._collection={},this._collectionPromises={},this._super(t,e,i,n),this.readerObject=this.getReader()},preloadData:function(){return this.loadConceptProps()},load:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.dataset&&(t.dataset=this.dataset),this.version&&(t.version=this.version);var n=this.getDataId(t);return n?Promise.resolve(n):(o.timeStamp("Vizabi Data: Loading Data"),f.default.freezeAll(["hook_change","resize"]),this.loadFromReader(t,i).then(function(t){return f.default.unfreezeAll(),t}).catch(function(i){return e.handleReaderError(i,t)}))},loadFromReader:function(t,e){var i=this,n=o.hashCode([t]),a=o.hashCode([t.select.key,t.where,t.join]);if(this.queryQueue[a])return Array.prototype.push.apply(this.queryQueue[a].query.select.value,t.select.value),o.extend(this.queryQueue[a].parsers,e),this.queryQueue[a].promise;var r=new Promise(function(r,s){o.defer(function(){t.select.value=o.unique(t.select.value),i.readerObject.read(t,e).then(function(e){i.checkQueryResponse(t,e),i._collection[n]={},i._collectionPromises[n]={};var s=i._collection[n];s.data=e,s.valid={},s.nested={},s.unique={},s.limits={},s.frames={},s.haveNoDataPointsPerKey={},s.query=t,i.queryQueue[a]=null,r(n)},function(t){i.queryQueue[a]=null,s(t)})})});return this.queryQueue[a]={query:t,parsers:e,promise:r},this.queryQueue[a].promise},getReader:function(){var t=u.default.get(this.reader);if(!t)throw new Error("Unknown reader: "+this.reader);return new t({path:this.path,delimiter:this.delimiter,keySize:this.keySize,data:this.data})},checkQueryResponse:function(t,e){if(0==e.length&&o.warn("Reader for data source '"+this._name+"' returned empty array for query:",JSON.stringify(t,null,2)),e.length>0){for(var i=(t.select.key||[]).concat(t.select.value||[]),n=e.length-1;n>=0;n--){for(var a=i.length-1;a>=0;a--)(e[n][i[a]]||0===e[n][i[a]])&&i.splice(a,1);if(!i.length)break}i.forEach(function(i){t.select.key.indexOf(i)==-1?o.warn('Reader result: Column "'+i+'" is missing from "'+t.from+'" data, but it might be ok'):(o.error('Reader result: Key column "'+i+'" is missing from "'+t.from+'" data for query:',JSON.stringify(t)),console.log(e))})}},getData:function(t,e,i,n){if(!t)return o.warn("Data.js 'get' method doesn't like the dataId you gave it: "+t);if(!e||"data"==e)return this._collection[t].data;if(!i)return this._collection[t][e];var a="string"==typeof i?i:JSON.stringify(i);if(this._collection[t][e][a])return this._collection[t][e][a];switch(e){case"unique":this._collection[t][e][a]=this._getUnique(t,i);break;case"valid":this._collection[t][e][a]=this._getValid(t,i);break;case"limits":this._collection[t][e][a]=this._getLimits(t,i);break;case"nested":this._collection[t][e][a]=this._getNested(t,i);break;case"haveNoDataPointsPerKey":}return this._collection[t][e][a]},loadConceptProps:function(){var t=this,e={select:{key:["concept"],value:["concept_type","domain","indicator_url","color","scales","interpolation","tags","name","unit","description"]},from:"concepts",where:{},language:this.getClosestModel("locale").id};return this.load(e).then(this.handleConceptPropsResponse.bind(this)).catch(function(i){return t.handleReaderError(i,e)})},handleConceptPropsResponse:function(t){var e=this;this.conceptDictionary={_default:{concept_type:"string",use:"constant",scales:["ordinal"],tags:"_root"}},this.conceptArray=[],this.getData(t).forEach(function(t){var i={};t.concept_type&&(i.use="measure"==t.concept_type||"time"==t.concept_type?"indicator":"property"),i.concept_type=t.concept_type,i.sourceLink=t.indicator_url;try{i.color=t.color&&""!==t.color?JSON.parse(t.color):null}catch(t){i.color=null}try{i.scales=t.scales?JSON.parse(t.scales):null}catch(t){i.scales=null}if(!i.scales)switch(t.concept_type){case"measure":i.scales=["linear","log"];break;case"string":i.scales=["nominal"];break;case"entity_domain":i.scales=["ordinal"];break;case"entity_set":i.scales=["ordinal"];break;case"time":i.scales=["time"]}null==i.scales&&(i.scales=["linear","log"]),t.interpolation?i.interpolation=t.interpolation:"measure"==t.concept_type?i.interpolation=i.scales&&"log"==i.scales[0]?"exp":"linear":"time"==t.concept_type?i.interpolation="linear":i.interpolation="stepMiddle",i.concept=t.concept,i.domain=t.domain,i.tags=t.tags,i.name=t.name||t.concept||"",i.unit=t.unit||"",i.description=t.description,e.conceptDictionary[t.concept]=i,e.conceptArray.push(i)})},getConceptprops:function(t){return t?this.conceptDictionary[t]?this.conceptDictionary[t]:o.warn("The concept "+t+" is not found in the dictionary"):this.conceptDictionary},getConceptByIndex:function(t,e){var i=this.conceptArray.filter(function(t){return!e||!t.concept_type||t.concept_type===e})[t];return i},getDatasetName:function(){if(this.readerObject.getDatasetInfo){var t=this.readerObject.getDatasetInfo();return t.name+(t.version?" "+t.version:"")}return this._name},_getCacheKey:function(t,e){var i=t[0]+" - "+t[t.length-1];return e&&(i=i+"_"+e.join()),i},getFrames:function(t,e,i){var n=this,a=this._getCacheKey(e,i);return this._collectionPromises[t][a]||(this._collectionPromises[t][a]={queue:this.framesQueue(e,a),promise:null}),this._collectionPromises[t][a]&&this._collectionPromises[t][a].promise instanceof Promise?this._collectionPromises[t][a].promise:(this._collectionPromises[t][a].promise=new Promise(function(r,s){t||s(o.warn("Data.js 'get' method doesn't like the dataId you gave it: "+t)),n._getFrames(t,a,e,i).then(function(e){n._collection[t].frames[a]=e,r(n._collection[t].frames[a])})}),this._collectionPromises[t][a].promise)},getFrame:function(t,e,i,n){var a=this,r=this._getCacheKey(e,n);return new Promise(function(e,n){a._collection[t].frames[r]&&a._collection[t].frames[r][i]?e(a._collection[t].frames[r]):a._collectionPromises[t][r].queue.forceFrame(i,function(){e(a._collection[t].frames[r])})})},listenFrame:function(t,e,i,n){var a=this._getCacheKey(e,i);this._collectionPromises[t][a].queue.defaultCallbacks.push(function(e){n(t,e)}),this._collection[t].frames[a]&&o.forEach(this._collection[t].frames[a],function(e,i){n(t,new Date(i))})},_muteAllQueues:function(t){o.forEach(this._collectionPromises,function(e,i){o.forEach(e,function(e,i){1==e.queue.isActive&&e.queue.whatId!=t&&e.queue.mute()})})},_checkForcedQueuesExists:function(){o.forEach(this._collectionPromises,function(t,e){o.forEach(t,function(t,e){t.queue.forcedQueue.length>0&&t.queue.unMute()})})},_unmuteQueue:function(){o.forEach(this._collectionPromises,function(t,e){o.forEach(t,function(t,e){0==t.queue.isActive&&t.queue.unMute()})})},framesQueue:function(t,e){var i=this;return new function(){this.defaultCallbacks=[],this.callbacks={},this.forcedQueue=[],this.isActive=!0,this.delayedAction=null,this.whatId=e,this.queue=t.slice(0);var n=this;this.queue.splice(0,0,this.queue.splice(this.queue.length-1,1)[0]),this.key=0,this.mute=function(){var t=this;this.isActive=!1,new Promise(function(e,i){t.delayedAction=e})},this.unMute=function(){this.isActive=!0,"function"==typeof this.delayedAction&&this.delayedAction(),this.delayedAction=null,0==this.forcedQueue.length&&0==this.queue.length&&i._unmuteQueue()},this.frameComplete=function(t){var e;if(n.defaultCallbacks.length>0)for(e=0;e<n.defaultCallbacks.length;e++)n.defaultCallbacks[e](t);if(n.callbacks[t]&&n.callbacks[t].length>0)for(e=0;e<n.callbacks[t].length;e++)n.callbacks[t][e]()},this._waitingForActivation=function(){var t=this;return new Promise(function(e,i){return t.isActive?e():void(t.delayedAction=e)})},this._getNextFrameName=function(){var t=null;return this.forcedQueue.length>0||this.queue.length>0?this.forcedQueue.length>0?t=this.forcedQueue.shift():(0==this.forcedQueue.length&&this.key>=this.queue.length-1&&(this.key=0),t=this.queue.splice(this.key,1).pop()):i._unmuteQueue(),t},this.checkForcedFrames=function(){this.forcedQueue.length>0||i._checkForcedQueuesExists()},this.getNext=function(){var t=this;return new Promise(function(e,i){t.checkForcedFrames(),t.isActive?e(t._getNextFrameName()):t._waitingForActivation().then(function(){e(t._getNextFrameName())})})},this.forceFrame=function(t,e){var n=function(t,e){for(var i=e.toString(),n=-1,a=0,r=t.length;a<r;a++)if(t[a].toString()==i){n=a;break}return n};if(this.callbacks[t])this.callbacks[t].push(e);else{var a=n(this.queue,t);a!==-1?(this.forcedQueue.unshift(this.queue.splice(a,1).pop()),i._muteAllQueues(this.whatId),this.unMute(),"function"==typeof e&&("object"!=r(this.callbacks[t])&&(this.callbacks[t]=[]),this.callbacks[t].push(e)),this.key=a):"object"===r(this.callbacks[t])?this.callbacks[t].push(e):this.callbacks[t]=[e]}}}},_getFrames:function(t,e,i,n){var a=this;return a._collection[t].frames[e]||(a._collection[t].frames[e]={}),new Promise(function(r,s){var l=a.getConceptprops();l||o.warn("_getFrames in data.js is missing indicatorsDB, it's needed for gap filling"),i||o.warn("_getFrames in data.js is missing framesArray, it's needed so much");var c=a._collection[t].query.animatable,h=a._collection[t].query.select.key.slice(0);c&&h.indexOf(c)!=-1&&h.splice(h.indexOf(c),1);var u,d,f,m,p,g,v,b={},y={};if(h.length>1)for(u=1;u<h.length;u++){var x=a.getData(t,"nested",[h[u]].concat([c]));y[h[u]]=Object.keys(x)}var x=a.getData(t,"nested",h.concat([c]));n=n?n:Object.keys(x),y[h[0]]=n;var _,u,M,w=a._collection[t].query,z=w.select.value.filter(function(t){return"_default"!==t}),S=z.length,k=h.length-1,E=function t(e,i){for(var n=y[h[i]],a=0,r=n.length;a<r;a++)if(e[n[a]]={},i==k)for(M=0;M<S;M++)e[n[a]][z[M]]=null;else{var s=i+1;t(e[n[a]],s)}};for(E(b,0),M=0;M<S;M++)a._collection[t].haveNoDataPointsPerKey[z[M]]={};var O=function t(i,n,s,h,u){var y={};if("datapoints"!==w.from){var E=a._collection[h].data;for(M=0;M<S;M++)y[z[M]]={};for(var O=0;O<E.length;O++){var T=E[O];for(M=0;M<S;M++)y[z[M]][T[s[0]]]=T[z[M]],null==T[z[M]]&&(a._collection[h].haveNoDataPointsPerKey[z[M]][T[s[0]]]=E.length)}}else{var P;!function(){var t=function(t,e,n,r,s,u,b){if(p=l[t]?l[t].interpolation:null,g=l[t]?l[t].use:"indicator",r?y[t][e]=r[e]:s=y[t],u&&u[i]&&(u[i][0][t]||0===u[i][0][t]))s[n]=u[i][0][t];else if("none"===p)s[n]=null;else{if(d=b[t],null===d){var x=Object.keys(u);d=new Array(x.length),f=0;for(var M=0,w=x.length;M<w;M++)m=u[x[M]],(m[0][t]||0===m[0][t])&&(d[f++]=m[0]);d.length=f,0===f?b[t]=[]:b[t]=d,0==d.length&&(a._collection[h].haveNoDataPointsPerKey[t][_]=d.length)}d&&d.length>0&&(v=null,s[n]=o.interpolatePoint(d,g,t,v,c,i,p))}};for(M=0;M<S;M++)y[z[M]]={};(P=function(e,i,a,r,o,l){for(var c=n[s[l]],h=0,u=c.length;h<u;h++)if(0==l&&(a=c[h]),l==k)for(M=0;M<S;M++)t(z[M],a,c[h],e,i,r[c[h]],o[c[h]]);else{0==l&&(i=e={});var d=l+1;i[c[h]]={},P(e,i[c[h]],a,r[c[h]],o[c[h]],d)}})(null,null,null,x,b,0)}()}a._collection[h].frames[e][i]=y,"function"==typeof u&&u(i),a._collectionPromises[h][e].queue.getNext().then(function(i){i?o.defer(function(){t(i,n,s,h,a._collectionPromises[h][e].queue.frameComplete)}):r(a._collection[h].frames[e])})};a._collectionPromises[t][e].queue.getNext().then(function(i){i&&O(i,y,h,t,a._collectionPromises[t][e].queue.frameComplete)})})},_getNested:function(t,e){for(var i=d3.nest(),n=0;n<e.length;n++)i=i.key(function(t){return function(e){return e[t]}}(e[n]));return o.nestArrayToObj(i.entries(this._collection[t].data))},_getUnique:function(t,e){var i,n=this._collection[t].data;if(o.isArray(e)){var a=n.map(function(t){return o.clone(t,e)});i=o.unique(a,function(t){return JSON.stringify(t)})}else{var a=n.map(function(t){return t[e]});i=o.unique(a)}return i},_getValid:function(t,e){return this._collection[t].data.filter(function(t){return t[e]||0===t[e]})},_getLimits:function(t,e){for(var i,n,a=this._collection[t].data,r=a.reduce(function(t,i){var n=o.isDate(i[e])?i[e]:parseFloat(i[e]);return isNaN(n)||t.push(n),t},[]),s={},l=0;l<r.length;l+=1){var c=r[l];("undefined"==typeof i||c<i)&&(i=c),("undefined"==typeof n||c>n)&&(n=c)}return s.min=i||0,s.max=n||100,s},getDataId:function(t){var e=o.hashCode([t]);return Object.keys(this._collection).indexOf(e)!==-1&&e},handleReaderError:function(t,e){if((0,s.isObject)(t)){var i=this.getClosestModel("locale"),n=i.getTFunction()(t.code,t.payload)||"";t=(n+" "+(t.message||"")).trim()}throw o.warn("Problem with query: ",e),t}});e.default=m},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),s=a(r),o=i(59),l=n(o),c=l.default.extend({getClassDefaults:function(){var t={show:{},dim:null,skipFilter:!1};return s.deepExtend(this._super(),t)},objectLeafs:["show","autogenerate"],dataConnectedChildren:["show","dim"],init:function(t,e,i,n){this._type="entities",this._super(t,e,i,n)},afterPreload:function(){if(null==this.dim&&this.autogenerate){var t=this.getClosestModel(this.autogenerate.data);this.dim=t.getConceptByIndex(this.autogenerate.conceptIndex).concept}},getDimension:function(){return this.dim},getFilter:function(){return this.skipFilter?[]:this.show},showEntity:function(t){var e,i=this,n=s.deepClone(this.show),a=this.getDimension();e=s.isArray(t)?t:[t];var r=[];this.show[a]&&this.show[a].$in&&s.isArray(this.show[a].$in)&&(r=this.show[a].$in),s.forEach(e,function(t){
var e=t[a];r=i.isShown(t)?r.filter(function(t){return t!==e}):r.concat(e)}),0===r.length?delete n[a]:n[a]={$in:r},this.show=n},isShown:function(t){var e=this.getDimension();return this.show[e]&&this.show[e].$in&&this.show[e].$in.indexOf(t[e])!==-1},clearShow:function(){var t=this.getDimension(),e=s.deepClone(this.show);delete e[t],this.show=e},getFilteredEntities:function(){var t=this.getDimension();if(this.show[t]&&this.show[t].$in&&s.isArray(this.show[t].$in)){var e=this.show[t].$in;return e.map(function(e){var i={};return i[t]=e,i})}return!1}});e.default=c},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),s=a(r),o=i(41),l=n(o),c=l.default.extend({getClassDefaults:function(){var t={use:null,which:null,merge:!1,manualSorting:null};return s.deepExtend(this._super(),t)},init:function(t,e,i,n){this._type="model",this._super(t,e,i,n)},validate:function(){this.scale&&(this.scale=null),"property"!=this.use&&(s.warn("group model: use must be 'property'. Resetting..."),this.use="property")}});e.default=c},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),s=a(r),o=i(41),l=n(o),c=l.default.extend({getClassDefaults:function(){var t={use:null,which:null};return s.deepExtend(this._super(),t)},init:function(t,e,i,n){this._type="label",this._super(t,e,i,n)}});e.default=c},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),s=a(r),o=i(59),l=n(o),c=["ar","ar-SA"],h=l.default.extend({getClassDefaults:function(){var t={id:"en",filePath:"assets/translation/"};return s.deepExtend(this._super(),t)},dataConnectedChildren:["id"],strings:{},init:function(t,e,i,n){this._type="locale",this._super(t,e,i,n)},_isLoading:function(){return!this._loadedOnce||this._loadCall},preloadData:function(){return this.loadData()},loadData:function(){var t,e=this;return this.setReady(!1),this._loadCall=!0,t=[],s.forEach(this._root._data,function(e){"data"===e._type&&t.push(e.loadConceptProps())}),t.push(new Promise(function(t,i){d3.json(e.filePath+e.id+".json",function(n,a){n&&i(n),e.handleNewStrings(a),t()})})),Promise.all(t).then(function(){return e.trigger("translate")})},handleNewStrings:function(t){this.strings[this.id]=this.strings[this.id]?s.extend(this.strings[this.id],t):t},getUIString:function(t){return this.strings&&this.strings[this.id]&&(this.strings[this.id][t]||""===this.strings[this.id][t])?this.strings[this.id][t]:(this.strings&&this.strings[this.id]||s.warn("Strings are not loaded for the "+this.id+" locale. Check if translation JSON is valid"),t)},getTFunction:function(){var t=this;return function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object.keys(i).reduce(function(t,e){var n=new RegExp("{{"+e+"}}","g");return t.replace(n,i[e])},t.getUIString(e))}},isRTL:function(){return c.indexOf(this.id)!==-1}});e.default=h},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),s=a(r),o=i(47),l=n(o),c=l.default.extend({getClassDefaults:function(){var t={select:[],highlight:[],opacityHighlightDim:.1,opacitySelectDim:.3,opacityRegular:1,allowSelectMultiple:!0};return s.deepExtend(this._super(),t)},init:function(t,e,i,n,a){var r=this;this._visible=[],this._super(t,e,i,n,a),this.on("ready",this.checkTimeLimits.bind(this)),this.on("readyOnce",function(){var t={exceptType:"time"},e=r._getAllDimensions(t);r._multiDim=e.length>1})},setDataSourceForAllSubhooks:function(t){var e={};this.getSubhooks().forEach(function(i){e[i._name]={data:t}}),this.set(e,null,!1)},validate:function(){var t=this.getDimension(),e=this._visible.map(function(e){return e[t]});e.length&&(this.select=this.select.filter(function(i){return e.indexOf(i[t])!==-1}),this.setHighlight(this.highlight.filter(function(i){return e.indexOf(i[t])!==-1})))},setVisible:function(t){this._visible=t},getVisible:function(t){return this._visible},getSelected:function(t){return t?this.select.map(function(e){return e[t]}):this.select},selectMarker:function(t){var e=this,i=this._createValue(t);this.isSelected(t)?this.select=this.select.filter(function(t){return JSON.stringify(e._createValue(t))!==JSON.stringify(i)}):this.select=this.allowSelectMultiple?this.select.concat(i):[i]},selectAll:function(t,e){if(this.allowSelectMultiple){var i,n=this.getDimension(),a=this._visible.map(function(t){return i={},i[n]=t[n],i});this.select=a}},isSelected:function(t){var e=this,i=this._createValue(t);return this.select.map(function(t){return JSON.stringify(e._createValue(t))===JSON.stringify(i)}).indexOf(!0)!==-1},_createValue:function(t){var e=this._getAllDimensions({exceptType:"time"});return e.reduce(function(e,i){return e[i]=t[i],e},{})},getHighlighted:function(t){return t?this.highlight.map(function(e){return e[t]}):this.highlight},setHighlight:function(t){return s.isArray(t)?void this.getModelObject("highlight").set(t,!1,!1):void this.setHighlight([].concat(t))},setSelect:function(t){return s.isArray(t)?void this.getModelObject("select").set(t):void this.setSelect([].concat(t))},highlightMarker:function(t){var e=this._createValue(t);this.isHighlighted(t)||this.setHighlight(this.highlight.concat(e))},unhighlightEntity:function(t){var e=this._createValue(t);this.isHighlighted(t)&&this.setHighlight(this.highlight.filter(function(t){return t[dimension]!==e}))},isHighlighted:function(t){var e=this,i=this._createValue(t);return this.highlight.map(function(t){return JSON.stringify(e._createValue(t))===JSON.stringify(i)}).indexOf(!0)!==-1},clearHighlighted:function(){this.setHighlight([])},clearSelected:function(){this.select=[]},setLabelOffset:function(t,e){0===e[0]&&1===e[1]||(this.select.find(function(e){return s.comparePlainObjects(e,t)}).labelOffset=[Math.round(1e3*e[0])/1e3,Math.round(1e3*e[1])/1e3],this.set("select",this.select,!0))},checkTimeLimits:function(){var t=this._parent.time;if(t){var e=this.getTimeLimits();if(e){if(!s.isDate(e.min)||!s.isDate(e.max))return s.warn("checkTimeLimits(): min-max look wrong: "+e.min+" "+e.max+". Expecting Date objects. Ensure that time is properly parsed in the data from reader");var i={};t.start-e.min==0&&(t.start||this.startOrigin)||(i.start=d3.max([e.min,t.parse(t.startOrigin)])),t.end-e.max==0&&(t.end||this.endOrigin)||(i.end=d3.min([e.max,t.parse(t.endOrigin)])),t.set(i,!1,!1),(i.start||i.end)&&s.forEach(this.getSubhooks(),function(t){"time"==t.which&&t.buildScale()}),t.validate()}}},getTimeLimits:function(){var t,e,i=this,n=this._parent.time,a=[],r=[],o={};this.cachedTimeLimits||(this.cachedTimeLimits={}),s.forEach(this.getSubhooks(),function(l){if("indicator"===l.use&&l._important){var c=i.cachedTimeLimits[l._dataId+l.which];c?(t=c.min,e=c.max):(o=l.getValidItems().map(function(t){return t[n.getDimension()]}),0==o.length&&s.warn("getTimeLimits() was unable to work with an empty array of valid datapoints"),t=d3.min(o),e=d3.max(o)),i.cachedTimeLimits[l._dataId+l.which]={min:t,max:e},a.push(t),r.push(e)}});var l=d3.max(a),c=d3.min(r);return l>c&&(s.warn("getTimeLimits(): Availability of the indicator's data has no intersection. I give up and just return some valid time range where you'll find no data points. Enjoy!"),l=d3.min(a),c=d3.max(r)),!(!t&&!e)&&{min:l,max:c}},getKeys:function(t){var e=[];t=t||this._getFirstDimension();var i=this._getFirstDimension({type:"time"});return s.forEach(this._dataCube||this.getSubhooks(!0),function(n,a){if("constant"!==n.use){var r=n.getNestedItems([t,i]),s=n.getHaveNoDataPointsPerKey();r.undefined&&delete r.undefined;var o=Object.keys(r),l=Object.keys(s||[]);0==e.length&&(e=o),n._important&&(e=e.filter(function(t){return o.indexOf(t)>-1&&l.indexOf(t)==-1}))}}),e.map(function(e){var i={};return i[t]=e,i})},_getCachePath:function(t){var e=this._parent.time.getAllSteps(),i=e[0]+" - "+e[e.length-1];this._dataCube=this._dataCube||this.getSubhooks(!0);var n=!1;return s.forEach(this._dataCube,function(t,e){t._loadCall&&(n=!0),i=i+"_"+t._dataId+t.which}),n?null:(t&&(i=i+"_"+t.join(",")),i)},_getAllDimensions:function(t){var e=[],i=this;s.forEach(this.space,function(t){e.push(i.getClosestModel(t))}),t=t||{};var n,a=[];return s.forEach(e,function(e){return!(!t.exceptType||e.getType()!==t.exceptType)||(!(!t.onlyType||e.getType()===t.onlyType)||void((n=e.getDimension())&&a.push(n)))}),a},_getFirstDimension:function(t){var e=[],i=this;s.forEach(this.space,function(t){e.push(i.getClosestModel(t))}),t=t||{};var n=!1;return s.forEach(e,function(e){return t.exceptType&&e.getType()!==t.exceptType?(n=e.getDimension(),!1):t.type&&e.getType()===t.type?(n=e.getDimension(),!1):t.exceptType||t.type?void 0:(n=e.getDimension(),!1)}),n},framesAreReady:function(){var t=this._getCachePath();return!!this.cachedFrames&&Object.keys(this.cachedFrames[t]).length==this._parent.time.getAllSteps().length},getFrame:function(t,e,i){var n=this;this.cachedFrames||(this.cachedFrames={});var a=this._parent.time.getAllSteps(),r=this._getCachePath();if(!r)return e(null,t);if(t&&n.cachedFrames[r]&&n.cachedFrames[r][t])return e(n.cachedFrames[r][t],t);if(r=this._getCachePath(i),!r)return e(null,t);if(t&&n.cachedFrames[r]&&n.cachedFrames[r][t])return e(n.cachedFrames[r][t],t);if(t&&a.length>1){var o=d3.bisectLeft(a,t);if(!a[o])return s.warn("The requested frame is out of range: "+t),e(null,t),null;if(a[o].toString()!=t.toString())return this._interpolateBetweenFrames(t,o,a,function(i){e(i,t)},i),null}n.getFrames(t,i).then(function(){return!t&&n.cachedFrames[r]?e(n.cachedFrames[r],t):n.cachedFrames[r]&&n.cachedFrames[r][t]?e(n.cachedFrames[r][t],t):(s.warn("marker.js getFrame: Data is not available for frame: "+t),e(null,t))})},_interpolateBetweenFrames:function(t,e,i,n,a){var r=this;if(0==e)this.getFrame(i[e],function(t){return n(t)},a);else{var o=i[e-1],l=i[e];this.getFrame(o,function(e){r.getFrame(l,function(i){function a(e,i,n,a,r,o,l){e[i]=a[i],s.isDate(o)?r[n]=t:s.isNumber(o)?r[n]=null==o||null==l?null:o+(l-o)*c:r[n]=o}var c=(t-o)/(l-o),h={};s.forEach(e,function(e,n){if(h[n]={},r._multiDim&&"indicator"==r[n].use){var o=h[n],l=r[n].dataSource._collection[r[n]._dataId].query.animatable,u=r[n].dataSource._collection[r[n]._dataId].query.select.key.slice(0);l&&u.indexOf(l)!=-1&&u.splice(u.indexOf(l),1);var d=u.length-1,f=function t(e,i,n,r,s,l){for(var c=Object.keys(r),h=0,u=c.length;h<u;h++)if(0==l&&(n=c[h]),l==d)a(o,n,c[h],e,i,r[c[h]],s[c[h]]);else{0==l&&(i=e={});var f=l+1;i[c[h]]={},t(e,i[c[h]],n,r[c[h]],s[c[h]],f)}};f(null,null,null,e,i[n],0)}else s.forEach(e,function(e,a){var r=i[n][a];s.isDate(e)?h[n][a]=t:s.isNumber(e)?h[n][a]=null==e||null==r?null:e+(r-e)*c:h[n][a]=e})}),n(h)},a)},a)}},getFrames:function(t,e){var i=this;this.cachedFrames||(this.cachedFrames={});var n=this._getFirstDimension(),a=this._getFirstDimension({type:"time"});this.frameQueues||(this.frameQueues={}),this.partialResult||(this.partialResult={});var r=this._parent.time.getAllSteps(),o=this._getCachePath(e);return o?((!this.frameQueues[o]||!this.frameQueues[o]instanceof Promise)&&(this.frameQueues[o]=new Promise(function(t,l){i.partialResult[o]={},r.forEach(function(t){i.partialResult[o][t]={}});var c=i.getKeys(),h=[];if(s.forEach(i._dataCube,function(t,e){"constant"===t.use?r.forEach(function(a){i.partialResult[o][a][e]={},c.forEach(function(r){i.partialResult[o][a][e][r[n]]=t.which})}):t.which===n?r.forEach(function(t){i.partialResult[o][t][e]={},c.forEach(function(a){i.partialResult[o][t][e][a[n]]=a[n]})}):t.which===a?r.forEach(function(t){i.partialResult[o][t][e]={},c.forEach(function(a){i.partialResult[o][t][e][a[n]]=new Date(t)})}):h.push(t)}),h.length>0){var u=[];s.forEach(h,function(t){u.push(new Promise(function(n,a){var l={name:t._name,which:t.which};t.getFrames(r,e).then(function(t){s.forEach(t,function(t,e){i.partialResult[o][e][l.name]=t[l.which]}),n()})}))}),Promise.all(u).then(function(){i.cachedFrames[o]=i.partialResult[o],t()})}else i.cachedFrames[o]=i.partialResult[o],t()})),new Promise(function(l,c){if(r.length<2||!t)i.frameQueues[o].then(function(){l()});else{var h=[];s.forEach(i._dataCube,function(s,l){"constant"!==s.use&&s.which!==n&&s.which!==a&&!function(n,a){h.push(new Promise(function(s,l){n.getFrame(r,t,e).then(function(e){i.partialResult[o][t][a]=e[t][n.which],s()})}))}(s,l)}),h.length>0&&Promise.all(h).then(function(){i.cachedFrames[o]||(i.cachedFrames[o]={}),i.cachedFrames[o][t]=i.partialResult[o][t],l()})}})):new Promise(function(t,e){t()})},listenFramesQueue:function(t,e){var i=this,n=this._getFirstDimension(),a=this._getFirstDimension({type:"time"}),r=this._parent.time.getAllSteps(),o={};this.getFrames();var l=[];s.forEach(i._dataCube,function(i,s){"constant"!==i.use&&i.which!==n&&i.which!==a&&l.indexOf(i._dataId)==-1&&(l.push(i._dataId),i.dataSource.listenFrame(i._dataId,r,t,function(t,i){var n=i.toString();"undefined"==typeof o[n]&&(o[n]=[]),o[n].indexOf(t)==-1&&o[n].push(t),o[n].length==l.length&&e(i)}))})},getValues:function(t,e,i){if(this.isHook())return[];var n,a,r,o,l,c,h,u;this._dataCube=this._dataCube||this.getSubhooks(!0),t=s.clone(t,this._getAllDimensions()),n=this._getFirstDimension({type:"time"}),a=new Date(t[n]),t=s.clone(t,null,n);var d={},f=Object.keys(t),m=f.map(function(e){return t[e]});return f.length?s.forEach(this._dataCube,function(e,p){if(c=e.use,h=e.which,"property"!==e.use&&(o=o||d3.bisectLeft(e.getUnique(n),a)),l=e.getConceptprops?e.getConceptprops().interpolation:null,r=e.getNestedItems(f),s.forEach(m,function(t){r=r[t]}),u=s.interpolatePoint(r,c,h,o,n,a,l),d[p]=e.mapValue(u),i){var g=s.filter(r,t).filter(function(t){return t[n]<=a}).map(function(t){return e.mapValue(t[h])}).concat(d[p]);d[p]=g}}):s.forEach(this._dataCube,function(f,m){r=f.getNestedItems(e),d[m]={},c=f.use,h=f.which,"property"!==f.use&&(o="undefined"==typeof o?d3.bisectLeft(f.getUnique(n),a):o),l=f.getConceptprops?f.getConceptprops().interpolation:null;var p=function(e,r,d){if(o=d3.bisectLeft(e.map(function(t){return t[n]}),a),u=s.interpolatePoint(e,c,h,o,n,a,l),r[d]=f.mapValue(u),i){var m=s.filter(e,t).filter(function(t){return t[n]<=a}).map(function(t){return f.mapValue(t[h])}).concat(r[d]);r[d]=m}},g=function t(e,i,n,a){i--,s.forEach(e,function(e,r){i?(n[r]={},t(e,i,n[r],a)):a(e,n,r)})};g(r,e.length,d[m],p)}),d},getEntityLimits:function(t){var e=this,i=this._parent.time.getAllSteps(),n=[],a=[];s.forEach(e.getSubhooks(),function(t){"constant"!=t.use&&t._important&&a.push(t._name)});var r=function(e){if(!e)return!1;for(var i=0,n=a.length;i<n;i++)if(!e[a[i]][t]&&0!==e[a[i]][t])return!1;return!0},o=function t(n,a){var s=n();null!=s&&e.getFrame(i[s],function(e){r(e)?a(s):t(n,a)})},l=[];return l.push(new Promise(function(t,e){o(function(){var t=i.length,e=0;return function(){return e<t?e++:null}}(),function(e){n[0]=i[e],t()})})),l.push(new Promise(function(t,e){o(function(){var t=i.length-1;return function(){return t>=0?t--:null}}(),function(e){n[1]=i[e],t()})})),Promise.all(l).then(function(){return{min:n[0],max:n[1]}})},getSpace:function(){return s.isArray(this.space)?this.space:void s.error('ERROR: space not found.\n You must specify the objects this hook will use under the "space" attribute in the state.\n Example:\n space: ["entities", "time"]')}});e.default=c},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),s=a(r),o=i(41),l=n(o),c=l.default.extend({getClassDefaults:function(){var t={use:null,which:null};return s.deepExtend(this._super(),t)},init:function(t,e,i,n){this._type="side",n.readyOnce=this.readyOnce,this.state={left:{},right:{}},this._super(t,e,i,n)},readyOnce:function(){if(this.spaceRef){var t=this._space[this.spaceRef].dataConnectedChildren.slice(0);t.splice(t.indexOf("show"),1),this._space[this.spaceRef].dataConnectedChildren=t}},switchSideState:function(){var t=this.state.left;this.state.left=this.state.right,this.state.right=t},clearSideState:function(){this.state={left:{},right:{}}}});e.default=c},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function a(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var r=i(87),s=a(r),o=i(1),l=n(o),c=s.default.extend({getClassDefaults:function(){var t={use:null,which:null,domainMin:null,domainMax:null,zoomedMin:null,zoomedMax:null,extent:[0,.85],scaleType:null,allow:{scales:["linear","log","genericLog","pow"]}};return l.deepExtend(this._super(),t)},_type:"size",buildScale:function(){this._super(),"ordinal"!==this.scaleType&&this.scale.clamp(!0)},autoGenerateModel:function(){if(null==this.which){var t;if(this.autogenerate){var t=this.dataSource.getConceptByIndex(this.autogenerate.conceptIndex,this.autogenerate.conceptType);t&&(this.which=t.concept,this.use="indicator",this.scaleType="linear")}t||(this.which="_default",this.use="constant",this.scaleType="ordinal")}null==this.scaleType&&(this.scaleType=this.dataSource.getConceptprops(this.which).scales[0])}});e.default=c},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),s=a(r),o=i(41),l=n(o),c={ALL:"all",_default:"none"},h=l.default.extend({getClassDefaults:function(){var t={use:null,which:null,merge:!1};return s.deepExtend(this._super(),t)},init:function(t,e,i,n){this._type="model",this._super(t,e,i,n)},validate:function(){this.scale&&(this.scale=null),"indicator"===this.use&&(s.warn("stack model: use must not be 'indicator'. Resetting use to 'constant' and which to '"+c._default),this.use="constant",this.which=c._default),"constant"===this.use&&s.values(c).indexOf(this.which)==-1&&(s.warn("stack model: the requested value '"+this.which+"' is not allowed. resetting to '"+c._default),this.which==c._default)},getPalettes:function(){return c},buildScale:function(){}});e.default=h},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function r(){var t=function(t){return e(t)+"w"+i(t)};t.parse=function(t){var e=t.match(/^(\d{4})w(\d{2})$/);return e?n(e[1],e[2]):null};var e=function(t){var e=+t;return new Date(e+864e5*(4-(t.getUTCDay()||7))).getUTCFullYear()},i=function(t){var e=+t,i=new Date(e+864e5*(4-(t.getUTCDay()||7))),n=Math.ceil(((i.getTime()-i.setUTCMonth(0,1))/864e5+1)/7);return n<10?"0"+n:n},n=function(t,e){var i=parseInt(e),n=t,a=new Date;a.setUTCFullYear(n),a.setUTCMonth(0),a.setUTCDate(4);var r=a.getUTCDay()||7,s=1,o=7*i+s-(r+4),l=u.year.parse(n);return l=new Date(l.getTime()+24*o*60*60*1e3)};return t}function s(){var t=function(t){return u.year.data(t)+"q"+e(t)};t.parse=function(t){var e=t.match(/^(\d{4})q(\d)$/);return e?i(e[1],e[2]):null};var e=function(t){return(t.getUTCMonth()/3|0)+1},i=function(t,e){var i=parseInt(e),n=3*i-2,a=t;return u.month.data.parse([a,(n<9?"0":"")+n].join("-"))};return t}Object.defineProperty(e,"__esModule",{value:!0});var o=i(1),l=a(o),c=i(59),h=n(c);Date.prototype.utc=Date.prototype.toUTCString;var u={year:{data:d3.time.format.utc("%Y"),ui:d3.time.format.utc("%Y")},month:{data:d3.time.format.utc("%Y-%m"),ui:d3.time.format.utc("%b %Y")},day:{data:d3.time.format.utc("%Y%m%d"),ui:d3.time.format.utc("%c")},hour:{data:d3.time.format.utc("%Y%m%dT%H"),ui:d3.time.format.utc("%b %d %Y, %H")},minute:{data:d3.time.format.utc("%Y%m%dT%H%M"),ui:d3.time.format.utc("%b %d %Y, %H:%M")},second:{data:d3.time.format.utc("%Y%m%dT%H%M%S"),ui:d3.time.format.utc("%b %d %Y, %H:%M:%S")},week:{data:r(),ui:r()},quarter:{data:s(),ui:s()}},d=h.default.extend({objectLeafs:["autogenerate"],getClassDefaults:function(){var t={dim:null,value:null,start:null,end:null,startOrigin:null,endOrigin:null,startSelected:null,endSelected:null,playable:!0,playing:!1,loop:!1,round:"round",delay:150,delayThresholdX2:90,delayThresholdX4:45,unit:"year",format:{data:null,ui:null},step:1,immediatePlay:!0,record:!1};return l.deepExtend(this._super(),t)},dataConnectedChildren:["startOrigin","endOrigin","dim"],init:function(t,e,i,n){this._type="time",this._super(t,e,i,n);var a=this;this.initFormatters(),this.dragging=!1,this.postponePause=!1,this.allSteps={},this.delayAnimations=this.delay,this.on({"change:playing":function(){a.playing===!0?a._startPlaying():a._stopPlaying()},"change:format":function(){a.initFormatters()}})},initFormatters:function(){u[this.unit]&&(this.formatters=u[this.unit]),"string"==typeof this.format?this.formatters.data=this.formatters.ui=d3.time.format.utc(this.format):(this.format.data&&(this.formatters.data=d3.time.format.utc(this.format.data)),this.format.ui&&(this.formatters.ui=d3.time.format.utc(this.format.ui))),this.validateFormatting()},afterPreload:function(){if(null==this.dim&&this.autogenerate){var t=this.getClosestModel(this.autogenerate.data);this.dim=t.getConceptByIndex(this.autogenerate.conceptIndex,this.autogenerate.conceptType).concept}},_formatToDates:function(){for(var t=["value"],e=["value","start","end","startSelected","endSelected"],i=0;i<e.length;i++){var n=e[i];if(!l.isDate(this[n])){var a=this.parse(this[n]);this.set(n,a,null,t.indexOf(n)!==-1)}}},formatDate:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"data";return["data","ui"].indexOf(e)===-1&&(l.warn("Time.formatDate type parameter ("+e+') invalid. Using "data".'),e=data),null==t?null:this.formatters[e](t)},parse:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"data";return null==t?null:this.formatters[e].parse(t.toString())},findFormat:function(t){for(var e=Object.keys(u),i=0;i<e.length;i++){var n=u[e[i]].data.parse(t);if(n)return{unit:e[i],time:n,type:"data"};var n=u[e[i]].ui.parse(t);if(n)return{unit:e[i],time:n,type:"ui"}}return null},validate:function(){null==this.start&&this.startOrigin&&this.set("start",this.startOrigin,null,!1),null==this.end&&this.endOrigin&&this.set("end",this.endOrigin,null,!1),this.formatters&&this.validateFormatting(),u[this.unit]||(l.warn(this.unit+' is not a valid time unit, using "year" instead.'),this.unit="year"),this.step<1&&(this.step=1),this.end<this.start&&null!=this.start&&this.set("end",new Date(this.start),null,!1),this.value<this.startSelected&&null!=this.startSelected&&(this.value=new Date(this.startSelected)),this.value>this.endSelected&&null!=this.endSelected&&(this.value=new Date(this.endSelected)),this.splash===!1&&(this.startSelected<this.start&&null!=this.start&&this.set({startSelected:new Date(this.start)},null,!1),this.endSelected>this.end&&null!=this.end&&this.set({endSelected:new Date(this.end)},null,!1)),this.value<this.start&&null!=this.start?this.value=new Date(this.start):this.value>this.end&&null!=this.end&&(this.value=new Date(this.end)),this.playable===!1&&this.playing===!0&&this.set("playing",!1,null,!1)},validateFormatting:function(){null==this.value&&this.set("value",this.parse(this.formatDate(new Date)),null,!1),l.isDate(this.start)&&l.isDate(this.end)&&l.isDate(this.value)&&l.isDate(this.startSelected)&&l.isDate(this.endSelected)||this._formatToDates()},play:function(){this._startPlaying()},pause:function(t){t?this.postponePause=!0:this.playing&&(this.set("playing",!1,null,!1),this.set("value",this.value,!0,!0))},dragStart:function(){this.dragging=!0},dragStop:function(){this.dragging=!1},getRange:function(){var t=this.getIntervalAndStep();return d3.time[t.interval].utc.range(this.start,this.end,t.step)},getIntervalAndStep:function(){var t,e;switch(this.unit){case"week":t="monday",e=this.step;break;case"quarter":t="month",e=3*this.step;break;default:t=this.unit,e=this.step}return{interval:t,step:e}},getFilter:function(t){var e=this.parse(this.startOrigin),i=this.parse(this.endOrigin),n=this.getDimension(),a=null;if(t)null!=this.value&&(a={},a[n]=this.formatters.data(this.value));else{var r,s;null!=e&&(r=this.formatters.data(e)),null!=i&&(s=this.formatters.data(i)),(r||s)&&(a={},a[n]={},r&&(a[n].$gte=r),s&&(a[n].$lte=s))}return a},getParser:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"data";return this.formatters[t].parse},getFormatter:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"data";return this.formatters[t]},getAllSteps:function(){if(!this.start||!this.end)return l.warn("getAllSteps(): invalid start/end time is detected: "+this.start+", "+this.end),[];var t=""+this.start+this.end+this.step;if(this.allSteps[t])return this.allSteps[t];this.allSteps[t]=[];for(var e=this.start;e<=this.end;){var i=this.getIntervalAndStep();this.allSteps[t].push(e),e=d3.time[i.interval].utc.offset(e,i.step)}return this.allSteps[t]},snap:function(t){if(this.round){null==t&&(t="value");var e="round";"ceil"===this.round&&(e="ceil"),"floor"===this.round&&(e="floor");var i=this.getIntervalAndStep(),n=d3.time[i.interval].utc[e](this[t]);this.set(t,n,!0)}},_startPlaying:function(){if(this.playable){var t=this;this.value>=this.endSelected&&t.getModelObject("value").set(t.startSelected,null,!1),this.set("playing",!0,null,!1),this.playInterval(this.immediatePlay),this.trigger("play")}},playInterval:function(t){if(this.playing){var e=this;this.delayAnimations=this.delay,this.delay<this.delayThresholdX2&&(this.delayAnimations*=2),this.delay<this.delayThresholdX4&&(this.delayAnimations*=2);var i=t?1:this.delayAnimations;this._intervals.setInterval("playInterval_"+this._id,function(){if(e.value>=e.endSelected)return void(e.loop?e.getModelObject("value").set(e.startSelected,null,!1):e.set("playing",!1,null,!1));if(e._intervals.clearInterval("playInterval_"+e._id),e.postponePause||!e.playing)e.set("playing",!1,null,!1),e.postponePause=!1,e.getModelObject("value").set(e.value,!0,!0);else{var t=e.getIntervalAndStep();e.delay<e.delayThresholdX2&&(t.step*=2),e.delay<e.delayThresholdX4&&(t.step*=2);var i=d3.time[t.interval].utc.offset(e.value,t.step);i>=e.endSelected?e.getModelObject("value").set(e.endSelected,null,!0):e.getModelObject("value").set(i,null,!1),e.playInterval()}},i)}},incrementTime:function(t){var e=this.getIntervalAndStep();return d3.time[e.interval].utc.offset(t,e.step)},decrementTime:function(t){var e=this.getIntervalAndStep();return d3.time[e.interval].utc.offset(t,-e.step)},_stopPlaying:function(){this._intervals.clearInterval("playInterval_"+this._id),this.trigger("pause")}});e.default=d},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),s=a(r),o=i(47),l=n(o),c="vzb-",h="presentation",u="rtl",d="vzb-portrait",f="vzb-landscape",m=l.default.extend({screen_profiles:{small:{min_width:0,min_height:0},medium:{min_width:600,min_height:400},large:{min_width:900,min_height:520}},getClassDefaults:function(){var t={presentation:!1,buttons:[],dialogs:{popup:[],sidebar:[],moreoptions:[]},splash:!1};return s.deepExtend(this._super(),t)},init:function(t,e,i,n){this._type="ui",this._container=null,this._curr_profile=null,this._prev_size={},this.resizeHandler=this.resizeHandler.bind(this),window.addEventListener("resize",this.resizeHandler),n["change:presentation"]=this.updatePresentation.bind(this),this._super(t,e,i,n)},resizeHandler:function(){this._container&&this.setSize()},setSize:function(t){var e=this,i=this._container.clientWidth,n=this._container.clientHeight;if(/^((?!chrome|android).)*safari/i.test(navigator.userAgent)&&navigator.userAgent.match(/iPhone/i)&&(this._container.style.top=0,this._container.clientWidth>this._container.clientHeight&&this._container.clientWidth<700)){var a=this._container.clientHeight,r=window.innerHeight;2<a-r&&a-r<=45&&(this._container.style.top="44px",document.body.scrollTop=44)}!t&&this._prev_size&&this._prev_size.width===i&&this._prev_size.height===n||(s.forEach(this.screen_profiles,function(t,a){s.removeClass(e._container,c+a),i>=t.min_width&&n>=t.min_height&&(e._curr_profile=a)}),s.addClass(this._container,c+this._curr_profile),s.classed(this._container,d,i<n),s.classed(this._container,f,!(i<n)),this._prev_size.width=i,this._prev_size.height=n,this.trigger("resize"))},setContainer:function(t){this._container=t,this.setSize(),this.updatePresentation()},updatePresentation:function(){s.classed(this._container,c+h,this.presentation),this.trigger("resize")},getPresentationMode:function(){return this.presentation},setRTL:function(t){s.classed(this._container,c+u,t)},currentProfile:function(){return this._curr_profile},clear:function(){window.removeEventListener("resize",this.resizeHandler)}});e.default=m},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){var i=[],n=!0,a=!1,r=void 0;try{for(var s,o=t[Symbol.iterator]();!(n=(s=o.next()).done)&&(i.push(s.value),!e||i.length!==e);n=!0);}catch(t){a=!0,r=t}finally{try{!n&&o.return&&o.return()}finally{if(a)throw r}}return i}return function(e,i){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),r=i(71),s=n(r),o={},l=s.default.extend({_name:"csv",init:function(t){this._data=[],this._basepath=t.path,this.delimiter=t.delimiter,this.keySize=t.keySize||1,Object.assign(this.ERRORS,{WRONG_TIME_COLUMN_OR_UNITS:"reader/error/wrongTimeUnitsOrColumn",NOT_ENOUGH_ROWS_IN_FILE:"reader/error/notEnoughRows",UNDEFINED_DELIMITER:"reader/error/undefinedDelimiter",EMPTY_HEADERS:"reader/error/emptyHeaders"})},ensureDataIsCorrect:function(t,e){var i=t.columns,n=t.data,r=i[this.keySize],s=a(n,1),o=s[0],l=e[r],c=o[r];if(l&&!l(c))throw this.error(this.ERRORS.WRONG_TIME_COLUMN_OR_UNITS,void 0,{currentYear:(new Date).getFullYear(),foundYear:c});if(!i.filter(Boolean).length)throw this.error(this.ERRORS.EMPTY_HEADERS)},getDatasetInfo:function(){return{name:this._basepath.split("/").pop()}},load:function(){var t=this,e=this._basepath;return new Promise(function(i,n){var r=o[e];r?i(r):d3.text(e).get(function(r,s){if(!s)return n("No permissions or empty file: "+e+". "+r);if(r)return n("Error happened while loading csv file: "+e+". "+r);try{var l=t.delimiter,c=void 0===l?t._guessDelimiter(s):l,h=d3.dsv(c),u=t._getRows(s,1),d=a(u,1),f=d[0],m=h.parseRows(f),p=a(m,1),g=p[0],v=h.parse(s),b={columns:g,data:v};o[e]=b,i(b)}catch(t){return n(t)}})})},_guessDelimiter:function(t){var e=2,i=this._getRows(t,e).map(function(t){return t.replace(/".*?"/g,"")});if(i.length!==e)throw this.error(this.ERRORS.NOT_ENOUGH_ROWS_IN_FILE);var n=a(i,2),r=n[0],s=n[1],o=",",l=";",c=this._countCharsInLine(r,o),h=this._countCharsInLine(r,l),u=this._countCharsInLine(s,o),d=this._countCharsInLine(s,l);if(c===u&&c>1&&(h!==d||!h&&!d||c>h&&u>d))return o;if(h===d&&h>1&&(c!==u||!c&&!u||h>c&&d>u))return l;
throw this.error(this.ERRORS.UNDEFINED_DELIMITER)},_getRows:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=/([^\r\n]+)/g,n=[],a=0,r=!0;r&&a!==e;)r=i.exec(t),r&&r.length>1&&(++a,n.push(r[1]));return n},_countCharsInLine:function(t,e){var i=new RegExp(e,"g"),n=t.match(i);return n?n.length:0}});e.default=l},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),s=a(r),o=i(2),l=n(o),c=i(40),h=n(c),u=i(10),d=l.default.extend({init:function(t,e){this.name="agepyramid",this.template=i(445),this.model_expects=[{name:"time",type:"time"},{name:"marker",type:"model"},{name:"entities",type:"entities"},{name:"entities_side",type:"entities"},{name:"locale",type:"locale"},{name:"ui",type:"ui"}];var n=this;this.model_binds={"change:time.value":function(t){if(n._readyOnce){if(1!=n.model.time.step&&!n.snapped&&!n.model.time.playing&&!n.model.time.dragging){var e=d3.bisectLeft(n.timeSteps,n.model.time.value);if(0!=e&&n.timeSteps[e]-n.model.time.value){n.snapped=!0;var i=n.model.time.value,a=n.timeSteps[e-1],e=n.timeSteps[e],r=i-a<e-i?a:e;n.model.time.value=new Date(r)}}if(!n.snapped)if(n.timeSteps.filter(function(t){return t-n.model.time.value==0}).length)n.model.marker.getFrame(n.model.time.value,function(t){n.frame=t,n.frameAxisX=t.axis_x,n._updateEntities(),n.updateBarsOpacity()});else{var s=d3.bisectLeft(n.timeSteps,n.model.time.value),o=n.timeSteps[s-1],l=n.timeSteps[s],c=(n.model.time.value-o)/(l-o);n.model.marker.getFrame(l,function(t){n.model.marker.getFrame(o,function(e){n.frameAxisX=n.interpolateDiagonal(e.axis_x,t.axis_x,c),n._updateEntities(),n.updateBarsOpacity()})})}n.snapped=!1}},"change:marker.select":function(t){n.someSelected=n.model.marker.select.length>0,n.nonSelectedOpacityZero=!1},"change:marker.highlight":function(t,e){n._readyOnce&&n._highlightBars()},"change:marker.opacitySelectDim":function(){n.updateBarsOpacity()},"change:marker.opacityRegular":function(){n.updateBarsOpacity()},"change:marker.color.palette":function(t){n._readyOnce&&n._updateEntities()},"change:marker.color.scaleType":function(t){n._readyOnce&&n._updateEntities()},"change:marker.side.which":function(t){if(n._readyOnce){var e="constant"==n.model.marker.side.use?null:n.model.marker.side.which;n.model.marker.side.clearSideState(),n.model.entities_side.clearShow(),n.model.entities_side.set("dim",e)}},"change:entities.show":function(t){n._readyOnce&&(n.model.entities.dim!==n.model.entities_side.dim||s.isEmpty(n.model.entities.show)||s.isEmpty(n.model.entities_side.show)||s.forEach(n.model.entities_side.getFilteredEntities(),function(t){n.model.entities.isShown(t)||(n.model.marker.side.clearSideState(),n.model.entities_side.showEntity(t))}))},"change:entities_side.show":function(t){if(n._readyOnce){var e=!1,i=null;s.forEach(n.model.marker.side._space,function(t){t.dim===n.model.entities_side.dim&&t._name!==n.model.entities_side._name&&(i=t)}),i&&!s.isEmpty(i.show)&&s.forEach(n.model.entities_side.getFilteredEntities(),function(t){i.isShown(t)||(i.showEntity(t),e=!0)}),e||(n._updateIndicators(),n._updateLimits(),n.resize(),n._updateEntities())}},"change:ui.chart.inpercent":function(t){n._readyOnce&&(n._updateLimits(),n.resize(),n._updateEntities())},"change:ui.chart.flipSides":function(t){n._readyOnce&&(n.model.marker.side.switchSideState(),n._updateIndicators(),n.resize(),n._updateEntities())}},this._super(t,e),this.xScale=null,this.yScale=null,this.cScale=null,this.xAxis=(0,h.default)(),this.xAxisLeft=(0,h.default)(),this.yAxis=(0,h.default)(),this.xScales=[],this.SHIFTEDAGEDIM="s_age",this.totalFieldName="Total"},readyOnce:function(){var t=this;this.el=this.el?this.el:d3.select(this.element),this.element=this.el,this.interaction=this._interaction(),this.graph=this.element.select(".vzb-bc-graph"),this.yAxisEl=this.graph.select(".vzb-bc-axis-y"),this.xAxisEl=this.graph.select(".vzb-bc-axis-x"),this.xAxisLeftEl=this.graph.select(".vzb-bc-axis-x-left"),this.xTitleEl=this.element.select(".vzb-bc-axis-x-title"),this.xInfoEl=this.element.select(".vzb-bc-axis-x-info"),this.yTitleEl=this.graph.select(".vzb-bc-axis-y-title"),this.barsCrop=this.graph.select(".vzb-bc-bars-crop"),this.labelsCrop=this.graph.select(".vzb-bc-labels-crop"),this.bars=this.graph.select(".vzb-bc-bars"),this.labels=this.graph.select(".vzb-bc-labels"),this.title=this.element.select(".vzb-bc-title"),this.titleRight=this.element.select(".vzb-bc-title-right"),this.year=this.element.select(".vzb-bc-year"),this.on("resize",function(){t._updateEntities()}),this._attributeUpdaters={_newWidth:function(e,i){e.x_=0;var n;return n=t.stackSkip?e[t.PREFIXEDSIDEDIM]==e[t.PREFIXEDSTACKDIM]?t.frameAxisX[e[t.PREFIXEDSIDEDIM]][e[t.AGEDIM]+t.ageShift]:0:t.sideSkip?t.frameAxisX[e[t.PREFIXEDSTACKDIM]][e[t.AGEDIM]+t.ageShift]:t.frameAxisX[e[t.PREFIXEDSTACKDIM]][e[t.PREFIXEDSIDEDIM]][e[t.AGEDIM]+t.ageShift],e.width_=n?t.xScale(n):0,t.ui.chart.inpercent&&(e.width_/=t.total[e[t.PREFIXEDSIDEDIM]]),e.width_},_newX:function(t,e){var i=this.previousSibling;if(i){var n=d3.select(i).datum();t.x_=n.x_+n.width_}else t.x_=0;return t.x_}}},ready:function(){if(this.model.marker._ready){var t=this;this.timeSteps=this.model.time.getAllSteps(),this.shiftScale=d3.scale.linear().domain([this.timeSteps[0],this.timeSteps[this.timeSteps.length-1]]).range([0,this.timeSteps.length-1]),this.side=this.model.marker.label_side.getEntity(),this.SIDEDIM=this.side.getDimension(),this.PREFIXEDSIDEDIM="side_"+this.SIDEDIM,this.stack=this.model.marker.label_stack.getEntity(),this.STACKDIM=this.stack.getDimension()||this.model.marker.color.which,this.PREFIXEDSTACKDIM="stack_"+this.STACKDIM,this.age=this.model.marker.axis_y.getEntity(),this.AGEDIM=this.age.getDimension(),this.TIMEDIM=this.model.time.getDimension(),this.groupBy=this.age.grouping||1,this.stackSkip=this.STACKDIM==this.SIDEDIM,this.sideSkip="constant"==t.model.marker.side.use,this.updateUIStrings(),this._updateIndicators(),this.model.marker.getFrame(t.model.time.value,function(e){t.frame=e,t.frameAxisX=e.axis_x,t._createLimits(),t._updateLimits(),t.resize(),t._updateEntities(!0),t.updateBarsOpacity()})}},interpolateDiagonal:function(t,e,i){var n,a,r,o,l=this,c={},h=this.groupBy;return this.stackSkip?s.forEach(l.sideKeys,function(u){n=c[u]={},s.forEach(l.ageKeys,function(s){o=+s+h,a=t[u][s],r=e[u][o]||0,n[o]=null==a||null==r?null:a+(r-a)*i}),n[0]=e[u][0]||0}):this.sideSkip?s.forEach(l.stackKeys,function(u){n=c[u]={},s.forEach(l.ageKeys,function(s){o=+s+h,a=t[u][s],r=e[u][o]||0,n[o]=null==a||null==r?null:a+(r-a)*i}),n[0]=e[u][0]||0}):s.forEach(l.stackKeys,function(u){c[u]={},s.forEach(l.sideKeys,function(d){n=c[u][d]={},s.forEach(l.ageKeys,function(s){o=+s+h,a=t[u][d][s],r=e[u][d][o]||0,n[o]=null==a||null==r?null:a+(r-a)*i}),n[0]=e[u][d][0]||0})}),c},updateUIStrings:function(){var t=this;this.translator=this.model.locale.getTFunction();var e=this.model.marker.axis_x.getConceptprops().name,i=this.xTitleEl.selectAll("text").data([0]);i.enter().append("text"),i.text(e).on("click",function(){t.parent.findChildByName("gapminder-treemenu").markerID("axis_x").alignX(t.model.locale.isRTL()?"right":"left").alignY("top").updateView().toggle()}),s.setIcon(this.xInfoEl,u.question).select("svg").attr("width","0px").attr("height","0px"),this.xInfoEl.on("click",function(){t.parent.findChildByName("gapminder-datanotes").pin()}),this.xInfoEl.on("mouseover",function(){if(!t.model.time.dragging){var e=this.getBBox(),i=s.makeAbsoluteContext(this,this.farthestViewportElement)(e.x-10,e.y+e.height+10),n=t.root.element.getBoundingClientRect(),a=t.element.node().getBoundingClientRect();t.parent.findChildByName("gapminder-datanotes").setHook("axis_x").show().setPos(i.x+a.left-n.left,i.y)}}),this.xInfoEl.on("mouseout",function(){t.model.time.dragging||t.parent.findChildByName("gapminder-datanotes").hide()})},_updateIndicators:function(){var t=this,e=this;this.duration=this.model.time.delayAnimations,this.yScale=this.model.marker.axis_y.getScale(),this.xScale=this.model.marker.axis_x.getScale(),this.yAxis.tickFormat(e.model.marker.axis_y.getTickFormatter()),this.xAxis.tickFormat(e.model.marker.axis_x.getTickFormatter()),this.xAxisLeft.tickFormat(e.model.marker.axis_x.getTickFormatter());var i=this.SIDEDIM,n=this.STACKDIM,a=this.AGEDIM,r=this.groupBy,o=this.model.marker.getKeys(a),l=[];l=o.map(function(t){return t[a]}),this.ageKeys=l,this.shiftedAgeKeys=this.timeSteps.map(function(t,e){return-e*r}).slice(1).reverse().concat(l);var c=this.model.marker.label_side.getItems(),h=[];if(!s.isEmpty(c)){var u=!!this.model.marker.side.getEntity().show[i],d=this.model.marker.getKeys(i).filter(function(e){return!u||t.model.marker.side.getEntity().isShown(e)});if(h=d.map(function(t){return t[i]}),h.length>2&&(h.length=2),h.length>1){var f=this.ui.chart.flipSides?d3.ascending:d3.descending;h.sort(f)}}h.length||h.push("undefined"),this.sideKeys=h;var m=this.model.marker.getKeys(n),p=[],p=s.without(m.map(function(t){return t[n]==e.totalFieldName&&(e.dataWithTotal=!0),t[n]}),this.totalFieldName),g=s.keys(this.model.marker.color.getPalette()).reduce(function(t,e){return p.indexOf(e)!=-1&&t.push(e),t},[]);if(g.length!=p.length&&(g=p.reduce(function(t,e){return t.indexOf(e)==-1&&t.push(e),t},g)),this.stackKeys=g,this.stackItems=this.model.marker.label_stack.getItems(),this.stacked=this.ui.chart.stacked&&"constant"!=this.model.marker.color.use&&this.stack.getDimension(),this.twoSided=this.sideKeys.length>1,this.titleRight.classed("vzb-hidden",!this.twoSided),this.twoSided)this.xScaleLeft=this.xScale.copy(),this.title.text(c[this.sideKeys[1]]),this.titleRight.text(c[this.sideKeys[0]]);else{var v=this.sideKeys.length&&c[this.sideKeys[0]]?c[this.sideKeys[0]]:"";this.title.text(v)}this.cScale=this.model.marker.color.getScale();this.SHIFTEDAGEDIM;this.markers=this.model.marker.getKeys(a)},_createLimits:function(){var t,e=this,i=this.model.marker.axis_x,n=Object.keys(this.model.marker.side.getItems());n.length||n.push("undefined");var a=this.sideSkip?[this.STACKDIM]:this.stackSkip?[this.SIDEDIM]:[this.STACKDIM,this.SIDEDIM];t=i.getLimitsByDimensions(a.concat([this.AGEDIM,this.TIMEDIM]));var r=i.getUnique(),o={},l={},c={};n.map(function(t){c[t]=[],l[t]=[]}),e.sideSkip?s.forEach(r,function(i){o[i]={};var a=0,r=[];s.forEach(e.ageKeys,function(n){var o=0;s.forEach(e.stackKeys,function(e){t[e]&&t[e][n]&&t[e][n][i]&&(o+=t[e][n][i].max,a+=o)}),r.push(o)}),o[i][n[0]]=a;var h=Math.max.apply(Math,r);l[n[0]].push(h/a),c[n[0]].push(h)}):e.stackSkip?s.forEach(r,function(i){o[i]={},s.forEach(n,function(n){var a=0,r=[];s.forEach(e.ageKeys,function(e){var s=0;t[n]&&t[n][e]&&t[n][e][i]&&(s+=t[n][e][i].max,a+=s),r.push(s)}),o[i][n]=a;var h=Math.max.apply(Math,r);l[n].push(h/a),c[n].push(h)})}):s.forEach(r,function(i){o[i]={},s.forEach(n,function(n){var a=0,r=[];s.forEach(e.ageKeys,function(o){var l=0;s.forEach(e.stackKeys,function(e){t[e][n]&&t[e][n][o]&&t[e][n][o][i]&&(l+=t[e][n][o][i].max,a+=l)}),r.push(l)}),o[i][n]=a;var h=Math.max.apply(Math,r);l[n].push(h/a),c[n].push(h)})}),this.maxLimits={},this.inpercentMaxLimits={},n.map(function(t){e.maxLimits[t]=Math.max.apply(Math,c[t]),e.inpercentMaxLimits[t]=Math.max.apply(Math,l[t])}),this.totals=o},_updateLimits:function(){var t,e=this,i=this.model.marker.axis_x;t=this.ui.chart.inpercent?[0,Math.max.apply(Math,this.sideKeys.map(function(t){return e.inpercentMaxLimits[t]}))]:null!=i.domainMin&&null!=i.domainMax?[+i.domainMin,+i.domainMax]:[0,Math.max.apply(Math,this.sideKeys.map(function(t){return e.maxLimits[t]}))],this.xScale.domain(t),this.xScaleLeft&&this.xScaleLeft.domain(this.xScale.domain())},_interpolateBetweenTotals:function(t,e,i){var n=d3.bisectLeft(t,i),a=(i-t[n-1])/(t[n]-t[n-1]),r={};return s.forEach(this.sideKeys,function(i){r[i]=e[t[n]][i]*a+e[t[n-1]][i]*(1-a)}),r},_updateEntities:function(t){var e=this,i=this.model.time,n=this.SIDEDIM,a=this.PREFIXEDSIDEDIM,r=this.AGEDIM,s=this.STACKDIM,o=this.PREFIXEDSTACKDIM,l=(this.TIMEDIM,i.playing?i.delayAnimations:0),c=this.groupBy;this.ui.chart.inpercent&&(this.total=this.totals[i.value]?this.totals[i.value]:this._interpolateBetweenTotals(this.timeSteps,this.totals,i.value));var h=this.yScale.domain(),u=d3.bisectLeft(this.timeSteps,i.value),d=this.SHIFTEDAGEDIM,f=this.markers.map(function(t){var e={};return e[r]=e[d]=+t[r],e[r]-=u*c,e}),m=f.slice(0),p={};p[d]=f.length*c,p[r]=p[d]-u*c,this.ageShift=u*c,u&&m.push(p),this.entityBars=this.bars.selectAll(".vzb-bc-bar").data(m,function(t){return t[r]}),this.entityLabels=this.labels.selectAll(".vzb-bc-label").data(f),this.entityBars.exit().remove(),this.entityLabels.exit().remove();var g=this.oneBarHeight,v=this.barHeight,b=this.firstBarOffsetY;this.entityBars.enter().append("g").attr("class",function(t){return"vzb-bc-bar vzb-bc-bar-"+t[r]}).attr("transform",function(t,e){return"translate(0,"+(b-(t[d]-h[0]-c)*g)+")"}),this.entityBars.attr("class",function(t){return"vzb-bc-bar vzb-bc-bar-"+t[r]}),this.sideBars=this.entityBars.selectAll(".vzb-bc-side").data(function(t){return e.sideKeys.map(function(e){var i={};return i[r]=t[r],i[d]=t[d],i[a]=e,i[n]=e,i})},function(t){return t[a]}),this.sideBars.exit().remove(),this.sideBars.enter().append("g").attr("class",function(t,i){return"vzb-bc-side vzb-bc-side-"+(!i!=!e.twoSided?"right":"left")}),this.sideBars.attr("transform",function(t,i){return i?"scale(-1,1) translate("+e.activeProfile.centerWidth+",0)":""}),t&&this.sideBars.attr("transform",function(t,i){return i?"scale(-1,1) translate("+e.activeProfile.centerWidth+",0)":""}),this.stackBars=this.sideBars.selectAll(".vzb-bc-stack").data(function(t,i){var l=e.stacked?e.stackKeys:[e.totalFieldName];return l.map(function(e){var i={};return i[r]=t[r],i[d]=t[d],i[n]=t[n],i[s]=e,i[a]=t[a],i[o]=e,i})},function(t){return t[o]}),this.stackBars.exit().remove(),this.stackBars.enter().append("rect").attr("class",function(t,i){return"vzb-bc-stack vzb-bc-stack-"+i+(e.highlighted?" vzb-dimmed":"")}).attr("y",0).attr("height",v).attr("fill",function(t){return e.cScale(t[o])}).on("mouseover",e.interaction.mouseover).on("mouseout",e.interaction.mouseout).on("click",e.interaction.click).onTap(e.interaction.tap),t&&this.stackBars.order();var y=m[0][d]-m[0][r]-this.shiftScale(i.value)*c,x=this._attributeUpdaters;l?(this.entityBars.transition("age").duration(l).ease("linear").attr("transform",function(t,e){return"translate(0,"+(b-(t[d]-h[0]-y)*g)+")"}),this.stackBars.transition().duration(.95*l).ease("linear").attr("width",x._newWidth).attr("x",x._newX)):(this.entityBars.interrupt().attr("transform",function(t,e){return"translate(0,"+(b-(t[d]-h[0]-y)*g)+")"}).transition(),this.stackBars.interrupt().attr("width",x._newWidth).attr("x",x._newX).transition()),this.entityLabels.enter().append("g").attr("class","vzb-bc-label").attr("id",function(t){return"vzb-bc-label-"+t[d]+"-"+e._id}).append("text").attr("class","vzb-bc-age"),this.labels.selectAll(".vzb-bc-label > .vzb-bc-age").each(function(t,i){var n=e.translator("agepyramid/yearOlds"),a=parseInt(t[r],10);c>1&&(a=a+"-to-"+(a+c-1)),t.text=a+n}).attr("y",function(t,e){return b-(t[d]-h[0])*g-10}),l?this.year.transition().duration(l).ease("linear").each("end",this._setYear(i.value)):this.year.interrupt().text(i.formatDate(i.value)).transition()},_setYear:function(t){var e=this.model.time.formatDate(t);return function(){d3.select(this).text(e)}},_interaction:function(){var t=this;return{mouseover:function(e,i){s.isTouchDevice()||(t.model.marker.highlightMarker(e),t._showLabel(e))},mouseout:function(e,i){s.isTouchDevice()||t.model.marker.clearHighlighted()},click:function(e,i){s.isTouchDevice()||t.model.marker.selectMarker(e)},tap:function(e){d3.event.stopPropagation(),t.model.marker.selectMarker(e)}}},_highlightBars:function(t){var e=this;e.someHighlighted=e.model.marker.highlight.length>0,e.updateBarsOpacity(),e.someHighlighted||e.labels.selectAll(".vzb-hovered").classed("vzb-hovered",!1)},_showLabel:function(t){var e=this,i=e.ui.chart.inpercent?d3.format(".1%"):e.model.marker.axis_x.getTickFormatter(),n=e.SIDEDIM,a=(e.AGEDIM,e.STACKDIM),r="s_age",s=e.sideKeys.indexOf(t[n]),o=e.labels.select("#vzb-bc-label-"+t[r]+"-"+e._id);o.selectAll(".vzb-bc-age").text(function(n){var r=e.stackKeys.length>1?e.stackItems[t[a]]:n.text;r=e.twoSided?r:n.text+" "+e.stackItems[t[a]];var s=e.xScale.invert(t.width_);return r+": "+i(s)}).attr("x",(s?-1:1)*(.5*e.activeProfile.centerWidth+7)).classed("vzb-text-left",s),o.classed("vzb-hovered",!0)},presentationProfileChanges:{medium:{margin:{right:80,bottom:80},infoElHeight:32},large:{margin:{top:100,right:100,left:100,bottom:80},infoElHeight:32}},profiles:{small:{margin:{top:70,right:20,left:40,bottom:40},infoElHeight:16,minRadius:2,maxRadius:40,centerWidth:2,titlesSpacing:5},medium:{margin:{top:80,right:60,left:60,bottom:40},infoElHeight:20,minRadius:3,maxRadius:60,centerWidth:2,titlesSpacing:10},large:{margin:{top:100,right:60,left:60,bottom:40},infoElHeight:22,minRadius:4,maxRadius:80,centerWidth:2,titlesSpacing:20}},resize:function(){var t=this;this.activeProfile=this.getActiveProfile(this.profiles,this.presentationProfileChanges);var e=this.activeProfile.margin,i=this.activeProfile.infoElHeight;if(this.height=parseInt(this.element.style("height"),10)-e.top-e.bottom||0,this.width=parseInt(this.element.style("width"),10)-e.left-e.right||0,this.height<=0||this.width<=0)return s.warn("Pop by age resize() abort: vizabi container is too little or has display:none");this.graph.attr("transform","translate("+e.left+","+e.top+")"),this.barsCrop.attr("width",this.width).attr("height",Math.max(0,this.height)),this.labelsCrop.attr("width",this.width).attr("height",Math.max(0,this.height));var n=this.groupBy,a=this.yScale.domain();this.oneBarHeight=this.height/(a[1]-a[0]);var r=this.barHeight=this.oneBarHeight*n;this.firstBarOffsetY=this.height-this.barHeight,this.stackBars&&this.stackBars.attr("height",r),this.sideBars&&this.sideBars.attr("transform",function(e,i){return i?"scale(-1,1) translate("+t.activeProfile.centerWidth+",0)":""}),"ordinal"!==this.model.marker.axis_y.scaleType?this.yScale.range([this.height,0]):this.yScale.rangePoints([this.height,0]).range();var o=this.twoSided?.5*(this.width-this.activeProfile.centerWidth):this.width;"ordinal"!==this.model.marker.axis_x.scaleType?this.xScale.range([0,o]):this.xScale.rangePoints([0,o]).range(),this.yAxis.scale(this.yScale).orient("left").tickSize(-this.width,0).tickPadding(6).tickSizeMinor(-this.width,0).labelerOptions({scaleType:this.model.marker.axis_y.scaleType,toolMargin:e,limitMaxTickNumber:19});var l=this.ui.chart.inpercent?d3.format((n>3?"":".1")+"%"):this.model.marker.axis_x.getTickFormatter();this.xAxis.scale(this.xScale).orient("bottom").tickFormat(l).tickSize(-this.height,0).tickPadding(6).tickSizeMinor(-this.height,0).labelerOptions({scaleType:this.model.marker.axis_x.scaleType,toolMargin:e,limitMaxTickNumber:6});var c=this.twoSided?.5*(this.width+t.activeProfile.centerWidth):0;if(this.xAxisEl.attr("transform","translate("+c+","+this.height+")").call(this.xAxis),this.yAxisEl.attr("transform","translate(0,0)").call(this.yAxis),this.xAxisLeftEl.classed("vzb-hidden",!this.twoSided),this.twoSided){"ordinal"!==this.model.marker.axis_x.scaleType?this.xScaleLeft.range([.5*(this.width-this.activeProfile.centerWidth),0]):this.xScaleLeft.rangePoints([.5*(this.width-this.activeProfile.centerWidth),0]).range(),this.xAxisLeft.scale(this.xScaleLeft).orient("bottom").tickFormat(l).tickSize(-this.height,0).tickPadding(6).tickSizeMinor(-this.height,0).labelerOptions({scaleType:this.model.marker.axis_x.scaleType,toolMargin:e,limitMaxTickNumber:6}),this.xAxisLeftEl.attr("transform","translate(0,"+this.height+")").call(this.xAxisLeft);var h=this.xAxisEl.select(".tick text");if(!h.empty()){var u=h.node().getBBox().width;h.attr("dx",.5*-(this.activeProfile.centerWidth+u))}}var d=this.model.locale.isRTL();if(this.bars.attr("transform","translate("+c+",0)"),this.labels.attr("transform","translate("+c+",0)"),this.title.attr("x",e.left+(this.twoSided?c-this.activeProfile.titlesSpacing:0)).style("text-anchor",this.twoSided?"end":"").attr("y",.7*e.top),this.titleRight.attr("x",e.left+c+this.activeProfile.titlesSpacing).attr("y",.7*e.top),this.xTitleEl.style("font-size",i+"px").attr("transform","translate("+(d?this.width:.4*e.left)+","+.4*e.top+")"),this.xInfoEl.select("svg").node()){var f=this.xTitleEl.node().getBBox(),m=d3.transform(this.xTitleEl.attr("transform")).translate,p=d?f.x+m[0]-1.4*i:f.x+m[0]+f.width+.4*i;this.xInfoEl.select("svg").attr("width",i+"px").attr("height",i+"px"),this.xInfoEl.attr("transform","translate("+p+","+(m[1]-.8*i)+")")}this.year.attr("x",this.width+e.left).attr("y",.4*e.top)},updateBarsOpacity:function(t){var e=this,i=1,n=this.model.marker.opacityHighlightDim,a=this.model.marker.opacityRegular,r=this.model.marker.opacityRegular,s=this.model.marker.opacitySelectDim;this.stackBars.style("opacity",function(t){return e.someHighlighted&&e.model.marker.isHighlighted(t)?i:e.someSelected?e.model.marker.isSelected(t)?a:s:e.someHighlighted?n:r});var o=e.model.marker.opacitySelectDim<.01;o!=this.nonSelectedOpacityZero&&this.stackBars.style("pointer-events",function(t){return e.someSelected&&o&&!e.model.marker.isSelected(t)?"none":"visible"}),this.nonSelectedOpacityZero=e.model.marker.opacitySelectDim<.01}});e.default=d},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),s=a(r),o=i(2),l=n(o),c=i(86),h=n(c),u=i(10),d=i(136),f=n(d),m=i(66),p=n(m),g=i(45),v=n(g),b=l.default.extend({init:function(t,e){this.name="cartogram",this.template=i(451);var n=function(){var t=!1;return function(e){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0)}(navigator.userAgent||navigator.vendor||window.opera),t};this.isMobile=n(),this.model_expects=[{name:"time",type:"time"},{name:"entities",type:"entities"},{name:"marker",type:"model"},{name:"locale",type:"locale"},{name:"ui",type:"ui"}];var a=this;this.model_binds={"change:time.value":function(t){a._readyOnce&&(a.calculationQueue?a.calculationQueue.push(a.model.time.value.toString()):a.calculationQueue=[a.model.time.value.toString()],function(t){a.model.marker.getFrame(t,function(t,e){var i=a.calculationQueue.indexOf(e.toString());i!=-1&&(a.calculationQueue.splice(0,i+1),a.frameChanged(t,e))})}(a.model.time.value))},"change:marker.size.extent":function(t,e){a._readyOnce&&(a.updateMarkerSizeLimits(),a.updateEntities())},"change:marker.color.scaleType":function(t,e){a.updateIndicators(),a.updateEntitityColor()},"change:marker.size.use":function(t,e){a.model.ui.chart.lockActive="constant"!=a.model.marker.size.use},"change:marker.color.palette":function(t,e){a.updateEntitityColor()},"change:ui.chart.lockNonSelected":function(t){a.updateEntities(900)},"change:entities.select":function(){a._readyOnce&&a.updateLandOpacity()},"change:entities.highlight":function(){a._readyOnce&&a.updateLandOpacity()},"change:entities.opacitySelectDim":function(){a.updateLandOpacity()},"change:entities.opacityRegular":function(){a.updateLandOpacity()}},this._super(t,e),a.COLOR_LAND_DEFAULT="#fdfdfd",this.lands=null,this.features=null,this.topo_features=null,this.borderArcs=null,this.defaultWidth=700,this.defaultHeight=550,this.updateEntitiesQueue=[],this.boundBox=[[.05,0],[.95,1]],(0,f.default)(),this.cached=[],this.projection=d3.geo.mercator().center([25,-29]).scale(1900).translate([this.defaultWidth/2,this.defaultHeight/2]).precision(.1),this.cartogram=d3.cartogram().projection(this.projection).properties(function(t){return t.properties}),this._labels=new h.default(this),this._labels.config({CSS_PREFIX:"vzb-ct",LABELS_CONTAINER_CLASS:"vzb-ct-labels",LINES_CONTAINER_CLASS:"vzb-ct-lines"})},afterPreload:function(){var t=this;this.world||s.warn("cartogram afterPreload: missing country shapes "+this.world),this.geometries||s.warn("cartogram afterPreload: missing country shapes "+this.geometries),this.borderArcs=t.cartogram.meshArcs(this.world,this.world.objects.topo,function(t,e){return t.properties.MN_NAME&&t.properties.PR_NAME!==e.properties.PR_NAME})},_getKey:function(t){return t.properties[this.id_lookup]?t.properties[this.id_lookup].toString():t.id.toString()},readyOnce:function(){this.element=d3.select(this.element),this.graph=this.element.select(".vzb-ct-graph"),this.mapSvg=this.element.select(".vzb-ct-map-background"),this.labelsContainerCrop=this.graph.select(".vzb-ct-labels-crop"),this.labelsContainer=this.graph.select(".vzb-ct-labels"),this.yTitleEl=this.graph.select(".vzb-ct-axis-y-title"),this.sTitleEl=this.graph.select(".vzb-ct-axis-c-title"),this.yInfoEl=this.graph.select(".vzb-ct-axis-y-info"),this.sInfoEl=this.graph.select(".vzb-ct-axis-c-info"),this.dataWarningEl=this.graph.select(".vzb-data-warning"),this.entityBubbles=null,this.tooltip=this.element.select(".vzb-ct-tooltip"),this.yearEl=this.graph.select(".vzb-ct-year"),this.year=new p.default(this.yearEl),this.year.setConditions({xAlign:"left",yAlign:"bottom",bottomOffset:5}),this.mapGraph=this.element.select(".vzb-ct-map-graph").attr("width",this.defaultWidth).attr("height",this.defaultHeight),this.mapGraph.html(""),this.KEY=this.model.entities.getDimension(),this.TIMEDIM=this.model.time.getDimension();var t=this;this.updateUIStrings(),this.on("resize",function(){t.updateSize()}),this.wScale=d3.scale.linear().domain(this.model.ui.datawarning.doubtDomain).range(this.model.ui.datawarning.doubtRange),this.cartogram.iterations(0),this.redrawInProgress=!0,this.cartogram(this.world,this.geometries).then(function(e){if(t.redrawInProgress=!1,t.features=t.topo_features=e.features,t.lands=t.mapGraph.selectAll(".land").data(t.topo_features).enter().append("path").attr("class",function(e){return"land "+(e.properties[t.id_lookup]?e.properties[t.id_lookup]:e.id)}).attr("d",t.cartogram.path).on("mouseover",function(e,i){s.isTouchDevice()||t._interact()._mouseover(e,i)}).on("mouseout",function(e,i){s.isTouchDevice()||t._interact()._mouseout(e,i)}).on("click",function(e,i){s.isTouchDevice()||t._interact()._click(e,i)}).each(function(e){e[t.KEY]=t._getKey(e)}),t.borderArcs){var i=t.cartogram.stitchArcs(e,t.borderArcs);t.borders=t.mapGraph.append("path").datum(i).attr("class","boundary").attr("d",t.cartogram.path)}})},frameChanged:function(t,e){e.toString()==this.model.time.value.toString()&&t&&(this.values=t,this.updateTime(),this.updateTitleNumbers(),this.updateEntities(this.duration))},ready:function(){var t=this;this.cached=[],this.updateIndicators(),this.updateUIStrings(),this.updateMarkerSizeLimits(),this.updateSize(),this.model.marker.getFrame(t.model.time.value,t.frameChanged.bind(t))},updateIndicators:function(){this.sScale=this.model.marker.size.getScale(),this.cScale=this.model.marker.color.getScale()},updateMarkerSizeLimits:function(){var t=this.model.marker.size.extent||[0,1];this.minRadius=Math.max(100*t[0],0),this.maxRadius=Math.max(100*t[1],0),this.sScale.domain([0,this.sScale.domain()[1]]),"ordinal"!==this.model.marker.size.scaleType?this.sScale.range([this.minRadius,this.maxRadius]):this.sScale.rangePoints([this.minRadius,this.maxRadius],0).range()},_calculateTotalSize:function(t,e){if(this.cached[t])return this.cached[t];var i=this;return this.cached[t]=0,s.forEach(e,function(e){i.cached[t]+=i.sScale(e)}),this.cached[t]},_redrawEntities:function(){var t=this;if(0!=this.updateEntitiesQueue.length){if(this.redrawInProgress)return void setTimeout(function(){t._redrawEntities()},100);this.redrawInProgress=!0;var e=this.updateEntitiesQueue[this.updateEntitiesQueue.length-1].time,i=this.updateEntitiesQueue[this.updateEntitiesQueue.length-1].duration;this.updateEntitiesQueue=[],this.model.ui.chart.lockNonSelected&&(e=this.model.time.parse(""+this.model.ui.chart.lockNonSelected)),this.model.marker.getFrame(e,function(e){var n=null;"constant"==t.model.marker.size.use?t.cartogram.iterations(0):(t.cartogram.iterations(8),t.cartogram.value(function(i){if(t.model.ui.chart.lockNonSelected){var n=t.sScale(e.size[t._getKey(i)]),a=t.sScale(t.values.size[t._getKey(i)]);return d3.geo.path().projection(null).area(i)*Math.pow(a/n,2)}return t.sScale(t.values.size[t._getKey(i)])}));var a=(new Date).getTime();t.cartogram(t.world,t.geometries,n).then(function(e){var n=(new Date).getTime();if(i&&(i=Math.max(i,n-a)),t.features=e.features,t.borderArcs){var r=t.cartogram.stitchArcs(e,t.borderArcs);t.borders.datum(r).transition().duration(i).ease("linear").attr("d",t.cartogram.path)}t.lands.data(t.features).each(function(e){e[t.KEY]=t._getKey(e)}),i?(t.lands.interrupt().transition().duration(i).ease("linear").style("fill",function(e){return null!=t.values.color[t._getKey(e)]?t.cScale(t.values.color[t._getKey(e)]):t.COLOR_LAND_DEFAULT}).attr("d",t.cartogram.path),t.borderArcs&&t.borders.interrupt().transition().duration(i).ease("linear").attr("d",t.cartogram.path)):(t.borders.attr("d",t.cartogram.path),t.lands.style("fill",function(e){return null!=t.values.color[t._getKey(e)]?t.cScale(t.values.color[t._getKey(e)]):t.COLOR_LAND_DEFAULT}).attr("d",t.cartogram.path)),t.updateLandOpacity(),t.redrawInProgress=!1,t._redrawEntities()})})}},updateEntities:function(t){var e=this.model.time.value;this.updateEntitiesQueue.push({time:e,duration:t}),this._redrawEntities()},updateEntitityColor:function(){var t=this;this.lands.transition().duration(t.duration).ease("linear").style("fill",function(e){return null!=t.values.color[t._getKey(e)]?t.cScale(t.values.color[t._getKey(e)]):t.COLOR_LAND_DEFAULT})},updateUIStrings:function(){var t=this;this.translator=this.model.locale.getTFunction();this.model.marker.size.getConceptprops();this.strings={title:{C:("constant"!==t.model.marker.size.use?this.translator("buttons/color")+": ":"")+this.translator("indicator/"+t.model.marker.color.which),
S:this.translator("buttons/size")+": "+this.translator("indicator/"+t.model.marker.size.which)}},this.yTitleEl.select("text").text(this.strings.title.C).on("click",function(){t.parent.findChildByName("gapminder-treemenu").markerID("color").alignX("left").alignY("top").updateView().toggle()}),this.sTitleEl.select("text").text(this.strings.title.S).on("click",function(){t.parent.findChildByName("gapminder-treemenu").markerID("size").alignX("left").alignY("top").updateView().toggle()}),s.setIcon(this.dataWarningEl,u.warn).select("svg").attr("width","0px").attr("height","0px"),this.dataWarningEl.append("text").attr("text-anchor","end").text(this.translator("hints/dataWarning")),this.dataWarningEl.on("click",function(){t.parent.findChildByName("gapminder-datawarning").toggle()}).on("mouseover",function(){t.updateDoubtOpacity(1)}).on("mouseout",function(){t.updateDoubtOpacity()}),this.yInfoEl.html(u.question).select("svg").attr("width","0px").attr("height","0px"),this.yInfoEl.on("click",function(){t.parent.findChildByName("gapminder-datanotes").pin()}),this.yInfoEl.on("mouseover",function(){var e=this.getBBox(),i=s.makeAbsoluteContext(this,this.farthestViewportElement)(e.x-10,e.y+e.height+10);t.parent.findChildByName("gapminder-datanotes").setHook("size").show().setPos(i.x,i.y)}),this.yInfoEl.on("mouseout",function(){t.parent.findChildByName("gapminder-datanotes").hide()}),this.sInfoEl.html(u.question).select("svg").attr("width","0px").attr("height","0px"),this.sInfoEl.on("click",function(){t.parent.findChildByName("gapminder-datanotes").pin()}),this.sInfoEl.on("mouseover",function(){var e=this.getBBox(),i=s.makeAbsoluteContext(this,this.farthestViewportElement)(e.x-10,e.y+e.height+10);t.parent.findChildByName("gapminder-datanotes").setHook("color").show().setPos(i.x,i.y)}),this.sInfoEl.on("mouseout",function(){t.parent.findChildByName("gapminder-datanotes").hide()})},updateDoubtOpacity:function(t){null==t&&(t=this.wScale(+this.time.getUTCFullYear().toString())),this.someSelected&&(t=1),this.dataWarningEl.style("opacity",t)},updateTime:function(){this.time_1=null==this.time?this.model.time.value:this.time,this.time=this.model.time.value,this.duration=this.model.time.playing&&this.time-this.time_1>0?this.model.time.delayAnimations:0,this.year.setText(this.model.time.formatDate(this.time),this.duration)},updateSize:function(){var t,e,i={small:{margin:{top:10,right:10,left:10,bottom:0},infoElHeight:16},medium:{margin:{top:20,right:20,left:20,bottom:30},infoElHeight:20},large:{margin:{top:30,right:30,left:30,bottom:35},infoElHeight:22}},n={medium:{infoElHeight:26},large:{infoElHeight:32}};this.activeProfile=this.getActiveProfile(i,n),t=this.activeProfile.margin,e=this.activeProfile.infoElHeight;var a=this.height=parseInt(this.element.style("height"),10)-t.top-t.bottom||0,r=this.width=parseInt(this.element.style("width"),10)-t.left-t.right||0;if(this.height<=0||this.width<=0)return s.warn("Bubble map updateSize() abort: vizabi container is too little or has display:none");var o=this.boundBox,l=[o[0][0]*this.defaultWidth,o[0][1]*this.defaultHeight,Math.abs(o[1][0]-o[0][0])*this.defaultWidth,Math.abs(o[1][1]-o[0][1])*this.defaultHeight];this.graph.attr("transform","translate("+t.left+","+t.top+")"),this.year.resize(this.width,this.height),this.mapSvg.attr("width",r).attr("height",a).attr("viewBox",l.join(" ")).attr("preserveAspectRatio","xMidYMid").attr("x",t.left).attr("y",t.top).style("transform","translate3d("+t.left+"px,"+t.top+"px,0)"),this.yTitleEl.style("font-size",e).attr("transform","translate(0,"+t.top+")");var c=this.yTitleEl.select("text").node().getBBox();this.sTitleEl.attr("transform","translate(0,"+(t.top+c.height)+")").classed("vzb-hidden","constant"==this.model.marker.size.use);var h=this.dataWarningEl.select("text").node().getBBox();if(this.dataWarningEl.select("svg").attr("width",.75*h.height).attr("height",.75*h.height).attr("x",-h.width-1.2*h.height).attr("y",.65*-h.height),this.dataWarningEl.attr("transform","translate("+this.width+","+(this.height-.5*h.height)+")").select("text"),this.yInfoEl.select("svg").node()){var u=this.yTitleEl.node().getBBox(),d=d3.transform(this.yTitleEl.attr("transform")).translate;this.yInfoEl.select("svg").attr("width",e).attr("height",e),this.yInfoEl.attr("transform","translate("+(u.x+d[0]+u.width+.4*e)+","+(d[1]-.8*e)+")")}if(this.sInfoEl.classed("vzb-hidden",this.sTitleEl.classed("vzb-hidden")),!this.sInfoEl.classed("vzb-hidden")&&this.sInfoEl.select("svg").node()){var u=this.sTitleEl.node().getBBox(),d=d3.transform(this.sTitleEl.attr("transform")).translate;this.sInfoEl.select("svg").attr("width",e).attr("height",e),this.sInfoEl.attr("transform","translate("+(u.x+d[0]+u.width+.4*e)+","+(d[1]-.8*e)+")")}},fitSizeOfTitles:function(){var t=this.yTitleEl.select("text").style("font-size",null),e=this.sTitleEl.select("text").style("font-size",null),i=t.node().getBBox(),n=this.sTitleEl.classed("vzb-hidden")?i:e.node().getBBox(),a=Math.max(parseInt(t.style("font-size")),parseInt(e.style("font-size")))*this.width/Math.max(i.width,n.width);Math.max(i.width,n.width)>this.width?(t.style("font-size",a+"px"),e.style("font-size",a+"px")):(t.style("font-size",null),e.style("font-size",null))},_interact:function(){var t=this;return{_mouseover:function(e,i){t.model.time.dragging||(t.model.entities.highlightEntity(e),t.hovered=e,t.updateTitleNumbers(),t.fitSizeOfTitles(),t.model.entities.isSelected(e)?t._setTooltip():t._setTooltip(e))},_mouseout:function(e,i){t.model.time.dragging||(t._setTooltip(),t.hovered=null,t.updateTitleNumbers(),t.fitSizeOfTitles(),t.model.entities.clearHighlighted())},_click:function(e,i){t.model.entities.selectEntity(e)}}},updateTitleNumbers:function(){var t,e=this;if(e.isMobile&&e.model.entities.select&&1===e.model.entities.select.length&&(t=e.model.entities.select[0]),e.hovered||t){var i=e.hovered||t,n=e.model.marker.color.getTickFormatter(),a=e.translator("unit/"+e.model.marker.color.which);a==="unit/"+e.model.marker.color.which&&(a="");var r=e.values.color[e._getKey(i)];if(e.yTitleEl.select("text").text(this.strings.title.C+": "+(r||0===r?n(r)+" "+a:e.translator("hints/nodata"))),"constant"!==this.model.marker.size.use){var s=e.model.marker.size.getTickFormatter(),o=e.translator("unit/"+e.model.marker.size.which);o==="unit/"+e.model.marker.size.which&&(o="");var l=e.values.size[e._getKey(i)];e.sTitleEl.select("text").text(this.strings.title.S+": "+s(l)+" "+o)}this.yInfoEl.classed("vzb-hidden",!0),this.sInfoEl.classed("vzb-hidden",!0)}else this.yTitleEl.select("text").text(this.strings.title.C),this.sTitleEl.select("text").text(this.strings.title.S),this.yInfoEl.classed("vzb-hidden",!1),this.sInfoEl.classed("vzb-hidden",!1)},_setTooltip:function(t){if(t){var e,i,n=this.values.label[this._getKey(t)]?this.values.label[this._getKey(t)]:t.properties.MN_NAME,a=10,r=d3.mouse(this.graph.node()).map(function(t){return parseInt(t)}),s=r[0],o=r[1],l=-1,c=-1,h=0,u=0;a&&(h=.71*a,u=.71*a),this.tooltip.classed("vzb-hidden",!1).selectAll("text").text(n);var d=this.tooltip.select("text")[0][0].getBBox();s-h-d.width<0?(l=1,s+=d.width+5):s-=5,o-u-d.height<0?(c=1,o+=d.height):o-=11,a?(e=s+h*l,i=o+u*c):(e=s+h*l,i=o+u*c),this.tooltip.attr("transform","translate("+(e?e:r[0])+","+(i?i:r[1])+")"),this.tooltip.select("rect").attr("width",d.width+8).attr("height",1.2*d.height).attr("x",-d.width-4).attr("y",.85*-d.height).attr("rx",.2*d.height).attr("ry",.2*d.height)}else this.tooltip.classed("vzb-hidden",!0)},updateLandOpacity:function(){var t=this,e=.8,i=.3,n=this.model.entities.opacityRegular,a=this.model.entities.opacityRegular,r=this.model.entities.opacitySelectDim;this.someHighlighted=this.model.entities.highlight.length>0,this.someSelected=this.model.entities.select.length>0,this.lands.style("opacity",function(s){return t.someHighlighted&&t.model.entities.isHighlighted(s)?e:t.someSelected?t.model.entities.isSelected(s)?n:r:t.someHighlighted?i:a});var s=t.someSelected&&t.model.entities.opacitySelectDim<.01;s!=this.someSelectedAndOpacityZero_1&&this.lands.style("pointer-events",function(e){return!s||t.model.entities.isSelected(e)?"visible":"none"}),this.someSelectedAndOpacityZero_1=t.someSelected&&t.model.entities.opacitySelectDim<.01},preload:function(){var t=this,e=v.default.ext_resources.shapePath?v.default.ext_resources.shapePath:v.default.ext_resources.host+v.default.ext_resources.preloadPath+"municipalities.json";return new Promise(function(i,n){d3.json(e,function(n,a){return n?console.warn("Failed loading json "+e+". "+n):(t.world=a,t.geometries=a.objects.topo.geometries,t.id_lookup=a.objects.id_lookup,void i())})})}});e.default=b},function(t,e,i){var n=i(28);t.exports=function(t,e){if("number"!=typeof t&&"Number"!=n(t))throw TypeError(e);return+t}},function(t,e,i){"use strict";var n=i(13),a=i(56),r=i(12);t.exports=[].copyWithin||function(t,e){var i=n(this),s=r(i.length),o=a(t,s),l=a(e,s),c=arguments.length>2?arguments[2]:void 0,h=Math.min((void 0===c?s:a(c,s))-l,s-o),u=1;for(l<o&&o<l+h&&(u=-1,l+=h-1,o+=h-1);h-- >0;)l in i?i[o]=i[l]:delete i[o],o+=u,l+=u;return i}},function(t,e,i){var n=i(61);t.exports=function(t,e){var i=[];return n(t,!1,i.push,i,e),i}},function(t,e,i){var n=i(16),a=i(13),r=i(68),s=i(12);t.exports=function(t,e,i,o,l){n(e);var c=a(t),h=r(c),u=s(c.length),d=l?u-1:0,f=l?-1:1;if(i<2)for(;;){if(d in h){o=h[d],d+=f;break}if(d+=f,l?d<0:u<=d)throw TypeError("Reduce of empty array with no initial value")}for(;l?d>=0:u>d;d+=f)d in h&&(o=e(o,h[d],d,c));return o}},function(t,e,i){"use strict";var n=i(16),a=i(6),r=i(76),s=[].slice,o={},l=function(t,e,i){if(!(e in o)){for(var n=[],a=0;a<e;a++)n[a]="a["+a+"]";o[e]=Function("F,a","return new F("+n.join(",")+")")}return o[e](t,i)};t.exports=Function.bind||function(t){var e=n(this),i=s.call(arguments,1),o=function(){var n=i.concat(s.call(arguments));return this instanceof o?l(e,n.length,n):r(e,n,t)};return a(e.prototype)&&(o.prototype=e.prototype),o}},function(t,e,i){"use strict";var n=i(9).f,a=i(51),r=i(54),s=i(36),o=i(49),l=i(29),c=i(61),h=i(99),u=i(164),d=i(55),f=i(8),m=i(42).fastKey,p=f?"_s":"size",g=function(t,e){var i,n=m(e);if("F"!==n)return t._i[n];for(i=t._f;i;i=i.n)if(i.k==e)return i};t.exports={getConstructor:function(t,e,i,h){var u=t(function(t,n){o(t,u,e,"_i"),t._i=a(null),t._f=void 0,t._l=void 0,t[p]=0,void 0!=n&&c(n,i,t[h],t)});return r(u.prototype,{clear:function(){for(var t=this,e=t._i,i=t._f;i;i=i.n)i.r=!0,i.p&&(i.p=i.p.n=void 0),delete e[i.i];t._f=t._l=void 0,t[p]=0},delete:function(t){var e=this,i=g(e,t);if(i){var n=i.n,a=i.p;delete e._i[i.i],i.r=!0,a&&(a.n=n),n&&(n.p=a),e._f==i&&(e._f=n),e._l==i&&(e._l=a),e[p]--}return!!i},forEach:function(t){o(this,u,"forEach");for(var e,i=s(t,arguments.length>1?arguments[1]:void 0,3);e=e?e.n:this._f;)for(i(e.v,e.k,this);e&&e.r;)e=e.p},has:function(t){return!!g(this,t)}}),f&&n(u.prototype,"size",{get:function(){return l(this[p])}}),u},def:function(t,e,i){var n,a,r=g(t,e);return r?r.v=i:(t._l=r={i:a=m(e,!0),k:e,v:i,p:n=t._l,n:void 0,r:!1},t._f||(t._f=r),n&&(n.n=r),t[p]++,"F"!==a&&(t._i[a]=r)),t},getEntry:g,setStrong:function(t,e,i){h(t,e,function(t,e){this._t=t,this._k=e,this._l=void 0},function(){for(var t=this,e=t._k,i=t._l;i&&i.r;)i=i.p;return t._t&&(t._l=i=i?i.n:t._t._f)?"keys"==e?u(0,i.k):"values"==e?u(0,i.v):u(0,[i.k,i.v]):(t._t=void 0,u(1))},i?"entries":"values",!i,!0),d(e)}}},function(t,e,i){var n=i(67),a=i(155);t.exports=function(t){return function(){if(n(this)!=t)throw TypeError(t+"#toJSON isn't generic");return a(this)}}},function(t,e,i){"use strict";var n=i(54),a=i(42).getWeak,r=i(3),s=i(6),o=i(49),l=i(61),c=i(31),h=i(15),u=c(5),d=c(6),f=0,m=function(t){return t._l||(t._l=new p)},p=function(){this.a=[]},g=function(t,e){return u(t.a,function(t){return t[0]===e})};p.prototype={get:function(t){var e=g(this,t);if(e)return e[1]},has:function(t){return!!g(this,t)},set:function(t,e){var i=g(this,t);i?i[1]=e:this.a.push([t,e])},delete:function(t){var e=d(this.a,function(e){return e[0]===t});return~e&&this.a.splice(e,1),!!~e}},t.exports={getConstructor:function(t,e,i,r){var c=t(function(t,n){o(t,c,e,"_i"),t._i=f++,t._l=void 0,void 0!=n&&l(n,i,t[r],t)});return n(c.prototype,{delete:function(t){if(!s(t))return!1;var e=a(t);return e===!0?m(this).delete(t):e&&h(e,this._i)&&delete e[this._i]},has:function(t){if(!s(t))return!1;var e=a(t);return e===!0?m(this).has(t):e&&h(e,this._i)}}),c},def:function(t,e,i){var n=a(r(e),!0);return n===!0?m(t).set(e,i):n[t._i]=i,t},ufstore:m}},function(t,e,i){t.exports=!i(8)&&!i(5)(function(){return 7!=Object.defineProperty(i(91)("div"),"a",{get:function(){return 7}}).a})},function(t,e,i){var n=i(6),a=Math.floor;t.exports=function(t){return!n(t)&&isFinite(t)&&a(t)===t}},function(t,e,i){var n=i(3);t.exports=function(t,e,i,a){try{return a?e(n(i)[0],i[1]):e(i)}catch(e){var r=t.return;throw void 0!==r&&n(r.call(t)),e}}},function(t,e){t.exports=function(t,e){return{value:e,done:!!t}}},function(t,e){t.exports=Math.log1p||function(t){return(t=+t)>-1e-8&&t<1e-8?t-t*t/2:Math.log(1+t)}},function(t,e,i){"use strict";var n=i(53),a=i(80),r=i(69),s=i(13),o=i(68),l=Object.assign;t.exports=!l||i(5)(function(){var t={},e={},i=Symbol(),n="abcdefghijklmnopqrst";return t[i]=7,n.split("").forEach(function(t){e[t]=t}),7!=l({},t)[i]||Object.keys(l({},e)).join("")!=n})?function(t,e){for(var i=s(t),l=arguments.length,c=1,h=a.f,u=r.f;l>c;)for(var d,f=o(arguments[c++]),m=h?n(f).concat(h(f)):n(f),p=m.length,g=0;p>g;)u.call(f,d=m[g++])&&(i[d]=f[d]);return i}:l},function(t,e,i){var n=i(9),a=i(3),r=i(53);t.exports=i(8)?Object.defineProperties:function(t,e){a(t);for(var i,s=r(e),o=s.length,l=0;o>l;)n.f(t,i=s[l++],e[i]);return t}},function(t,e,i){var n=i(20),a=i(52).f,r={}.toString,s="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],o=function(t){try{return a(t)}catch(t){return s.slice()}};t.exports.f=function(t){return s&&"[object Window]"==r.call(t)?o(t):a(n(t))}},function(t,e,i){var n=i(15),a=i(20),r=i(72)(!1),s=i(104)("IE_PROTO");t.exports=function(t,e){var i,o=a(t),l=0,c=[];for(i in o)i!=s&&n(o,i)&&c.push(i);for(;e.length>l;)n(o,i=e[l++])&&(~r(c,i)||c.push(i));return c}},function(t,e,i){var n=i(53),a=i(20),r=i(69).f;t.exports=function(t){return function(e){for(var i,s=a(e),o=n(s),l=o.length,c=0,h=[];l>c;)r.call(s,i=o[c++])&&h.push(t?[i,s[i]]:s[i]);return h}}},function(t,e,i){var n=i(52),a=i(80),r=i(3),s=i(4).Reflect;t.exports=s&&s.ownKeys||function(t){var e=n.f(r(t)),i=a.f;return i?e.concat(i(t)):e}},function(t,e,i){var n=i(4).parseFloat,a=i(64).trim;t.exports=1/n(i(109)+"-0")!==-(1/0)?function(t){var e=a(String(t),3),i=n(e);return 0===i&&"-"==e.charAt(0)?-0:i}:n},function(t,e,i){var n=i(4).parseInt,a=i(64).trim,r=i(109),s=/^[\-+]?0[xX]/;t.exports=8!==n(r+"08")||22!==n(r+"0x16")?function(t,e){var i=a(String(t),3);return n(i,e>>>0||(s.test(i)?16:10))}:n},function(t,e){t.exports=Object.is||function(t,e){return t===e?0!==t||1/t===1/e:t!=t&&e!=e}},function(t,e,i){var n=i(12),a=i(108),r=i(29);t.exports=function(t,e,i,s){var o=String(r(t)),l=o.length,c=void 0===i?" ":String(i),h=n(e);if(h<=l||""==c)return o;var u=h-l,d=a.call(c,Math.ceil(u/c.length));return d.length>u&&(d=d.slice(0,u)),s?d+o:o+d}},function(t,e,i){e.f=i(7)},function(t,e,i){"use strict";var n=i(158);t.exports=i(73)("Map",function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},{get:function(t){var e=n.getEntry(this,t);return e&&e.v},set:function(t,e){return n.def(this,0===t?0:t,e)}},n,!0)},function(t,e,i){i(8)&&"g"!=/./g.flags&&i(9).f(RegExp.prototype,"flags",{configurable:!0,get:i(75)})},function(t,e,i){"use strict";var n=i(158);t.exports=i(73)("Set",function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},{add:function(t){return n.def(this,t=0===t?0:t,t)}},n)},function(t,e,i){"use strict";var n,a=i(31)(0),r=i(18),s=i(42),o=i(166),l=i(160),c=i(6),h=s.getWeak,u=Object.isExtensible,d=l.ufstore,f={},m=function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},p={get:function(t){if(c(t)){var e=h(t);return e===!0?d(this).get(t):e?e[this._i]:void 0}},set:function(t,e){return l.def(this,t,e)}},g=t.exports=i(73)("WeakMap",m,p,l,!0,!0);7!=(new g).set((Object.freeze||Object)(f),7).get(f)&&(n=l.getConstructor(m),o(n.prototype,p),s.NEED=!0,a(["delete","has","get","set"],function(t){var e=g.prototype,i=e[t];r(e,t,function(e,a){if(c(e)&&!u(e)){this._f||(this._f=new n);var r=this._f[t](e,a);return"set"==t?this:r}return i.call(this,e,a)})}))},function(t,e){var i;i=function(){return this}();try{i=i||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(i=window)}t.exports=i},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),s=(a(r),i(14)),o=n(s),l=i(151),c=n(l),h=i(24),u=n(h),d=i(23),f=n(d),m=i(22),p=n(m),g=i(27),v=n(g),b=i(34),y=n(b),x=o.default.extend("AgePyramid",{init:function(t,e){this.name="agepyramid",this.components=[{component:c.default,placeholder:".vzb-tool-viz",model:["state.time","state.marker","state.entities","state.entities_side","locale","ui"]},{component:u.default,placeholder:".vzb-tool-timeslider",model:["state.time","state.entities","state.marker","ui"]},{component:f.default,placeholder:".vzb-tool-dialogs",model:["state","ui","locale"]},{component:p.default,placeholder:".vzb-tool-buttonlist",model:["state","ui","locale"]},{component:v.default,placeholder:".vzb-tool-treemenu",model:["state.marker","state.marker_tags","state.time","locale"]},{component:y.default,placeholder:".vzb-tool-datanotes",model:["state.marker","locale"]}],this._super(t,e)},default_model:{state:{marker_tags:{}},ui:{chart:{stacked:!0,inpercent:!1,flipSides:!0},presentation:!1},locale:{}}});e.default=x},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),s=(a(r),i(14)),o=n(s),l=i(218),c=n(l),h=0,u=[[-123,123],[1,1e4],[4,123],[6e-4,123],[123,4],[123,6e-4],[-123,-4],[-123,-6e-4],[-4,-123],[-6e-4,-123],[-123,1800],[1800,-123],[123,-18e3],[-18e3,123],[-6e-4,1800],[1800,-6e-4],[6e-4,-1800],[-1800,6e-4],[-12,-2],[-80,40],[5,8],[42,42],[5e-11,4554545484715],[-2611968678575,4554545484715],[-.002,.002],[-123,-.1,.002,1540],[-123,-.001,.5,1540],[123,.1,-.002,-1540],[123,.001,-.5,-1540]],d=o.default.extend("AxisLabeler",{init:function(t,e){this.name="axislabeler",this.components=[{component:c.default,placeholder:".vzb-tool-viz",model:["state.scales","state.show"]}],this._super(t,e)},default_model:{state:{scales:{domain:u[h],xScaleType:"linear",yScaleType:"genericLog"},show:{labelSize:"16px",labelMargin:{LR:"5px",TB:"5px"},toolMargin:{top:30,right:20,left:40,bottom:40}}},data:{noConceptprops:!0},locale:{},ui:{}}});e.default=d},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),s=(a(r),i(14)),o=n(s),l=i(219),c=n(l),h=i(24),u=n(h),d=i(23),f=n(d),m=i(22),p=n(m),g=i(27),v=n(g),b=o.default.extend("BarChart",{init:function(t,e){this.name="barchart",this.components=[{component:c.default,placeholder:".vzb-tool-viz",model:["state.time","state.entities","state.marker","locale"]},{component:u.default,placeholder:".vzb-tool-timeslider",model:["state.time","state.entities","state.marker","ui"]},{component:f.default,placeholder:".vzb-tool-dialogs",model:["state","ui","locale"]},{component:p.default,placeholder:".vzb-tool-buttonlist",model:["state","ui","locale"]},{component:v.default,placeholder:".vzb-tool-treemenu",model:["state.marker","state.marker_tags","state.time","locale"]}],this._super(t,e)},default_model:{state:{time:{},entities:{},marker:{label:{},axis_y:{allow:{scales:["linear","log"]}},axis_x:{allow:{scales:["ordinal","nominal"]}},color:{}}},locale:{},ui:{presentation:!1,chart:{}}}});e.default=b},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),s=(a(r),i(14)),o=n(s),l=i(220),c=n(l),h=i(24),u=n(h),d=i(23),f=n(d),m=i(22),p=n(m),g=i(27),v=n(g),b=i(34),y=n(b),x=i(39),_=n(x),M=o.default.extend("BarRankChart",{init:function(t,e){this.name="barrankchart",this.components=[{component:c.default,placeholder:".vzb-tool-viz",model:["state.time","state.entities","state.marker","locale","ui"]},{component:u.default,placeholder:".vzb-tool-timeslider",model:["state.time","state.entities","state.marker","ui"]},{component:f.default,placeholder:".vzb-tool-dialogs",model:["state","ui","locale"]},{component:p.default,placeholder:".vzb-tool-buttonlist",model:["state","ui","locale"]},{component:v.default,placeholder:".vzb-tool-treemenu",model:["state.marker","state.marker_tags","state.time","locale"]},{component:y.default,placeholder:".vzb-tool-datanotes",model:["state.marker","locale"]},{component:_.default,placeholder:".vzb-tool-datawarning",model:["locale"]}],this._super(t,e)},default_model:{state:{entities:{dim:"id"},time:{},marker:{axis_x:{allow:{scales:["linear","log"]}},axis_y:{allow:{scales:["ordinal","nominal"]}},color:{}}},locale:{},ui:{chart:{},datawarning:{doubtDomain:[],doubtRange:[]},presentation:!1}}});e.default=M},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),s=(a(r),i(14)),o=n(s),l=i(221),c=n(l),h=i(24),u=n(h),d=i(23),f=n(d),m=i(22),p=n(m),g=i(27),v=n(g),b=i(39),y=n(b),x=i(34),_=n(x),M=i(134),w=n(M),z=o.default.extend("BubbleChart",{init:function(t,e){this.name="bubblechart",this.components=[{component:c.default,placeholder:".vzb-tool-viz",model:["state.time","state.entities","state.marker","locale","ui"]},{component:u.default,placeholder:".vzb-tool-timeslider",model:["state.time","state.entities","state.marker","ui"]},{component:f.default,placeholder:".vzb-tool-dialogs",model:["state","ui","locale"]},{component:p.default,placeholder:".vzb-tool-buttonlist",model:["state","ui","locale"]},{component:v.default,placeholder:".vzb-tool-treemenu",model:["state.marker","state.marker_tags","state.time","locale"]},{component:y.default,placeholder:".vzb-tool-datawarning",model:["locale"]},{component:_.default,placeholder:".vzb-tool-datanotes",model:["state.marker","locale"]},{component:w.default,placeholder:".vzb-tool-stepped-speed-slider",model:["state.time","locale"]}],this._super(t,e)},validate:function(t){if(t=this.model||t,this._super(t),t.ui.chart.lockNonSelected){var e=t.state.time.parse(""+t.ui.chart.lockNonSelected);e<t.state.time.start&&(t.ui.chart.lockNonSelected=t.state.time.formatDate(t.state.time.start)),e>t.state.time.end&&(t.ui.chart.lockNonSelected=t.state.time.formatDate(t.state.time.end))}},default_model:{state:{time:{autogenerate:{data:"data",conceptIndex:0,conceptType:"time"}},entities:{autogenerate:{data:"data",conceptIndex:0}},entities_colorlegend:{autogenerate:{data:"data",conceptIndex:0}},entities_tags:{},marker_tags:{space:["entities_tags"],label:{},hook_parent:{}},marker:{space:["entities","time"],axis_x:{use:"indicator",autogenerate:{conceptIndex:1,conceptType:"measure"}},axis_y:{use:"indicator",autogenerate:{conceptIndex:0,conceptType:"measure"}},label:{use:"property",autogenerate:{conceptIndex:0}},size:{autogenerate:{conceptIndex:2,conceptType:"measure"}},color:{syncModels:["marker_colorlegend"],autogenerate:{conceptIndex:0,conceptType:"entity_set"}},size_label:{use:"constant",which:"_default",_important:!1,extent:[0,.33]}},marker_colorlegend:{space:["entities_colorlegend"],label:{use:"property",which:"name"},hook_rank:{use:"property",which:"rank"},hook_geoshape:{use:"property",which:"shape_lores_svg"}}},locale:{},ui:{chart:{whenHovering:{showProjectionLineX:!0,showProjectionLineY:!0,higlightValueX:!0,higlightValueY:!0},labels:{dragging:!0,removeLabelBox:!1},trails:!0,lockNonSelected:0},datawarning:{doubtDomain:[],doubtRange:[]},presentation:!1,adaptMinMaxZoom:!1,cursorMode:"arrow",zoomOnScrolling:!1,buttons:["colors","find","size","trails","lock","moreoptions","fullscreen","presentation"],dialogs:{popup:["colors","find","size","zoom","moreoptions"],sidebar:["colors","find","size","zoom"],moreoptions:["opacity","speed","axes","size","colors","label","zoom","presentation","about"]}}}});e.default=z},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),s=(a(r),i(14)),o=n(s),l=i(224),c=n(l),h=i(24),u=n(h),d=i(23),f=n(d),m=i(22),p=n(m),g=i(27),v=n(g),b=i(39),y=n(b),x=i(34),_=n(x),M=o.default.extend("BubbleMap",{init:function(t,e){this.name="bubblemap",this.components=[{component:c.default,placeholder:".vzb-tool-viz",model:["state.time","state.entities","state.marker","locale","ui"]},{component:u.default,placeholder:".vzb-tool-timeslider",model:["state.time","state.entities","state.marker","ui"]},{component:f.default,placeholder:".vzb-tool-dialogs",model:["state","ui","locale"]},{component:p.default,placeholder:".vzb-tool-buttonlist",model:["state","ui","locale"]},{component:v.default,placeholder:".vzb-tool-treemenu",model:["state.marker","state.marker_tags","state.time","locale"]},{component:y.default,placeholder:".vzb-tool-datawarning",model:["locale"]},{component:_.default,placeholder:".vzb-tool-datanotes",model:["state.marker","locale"]}],this._super(t,e)},default_model:{state:{time:{delay:100,delayThresholdX2:50,delayThresholdX4:25},entities:{opacitySelectDim:.3,opacityRegular:1}},locale:{},ui:{map:{path:null,colorGeo:!1,preserveAspectRatio:!0,scale:.95,offset:{top:0,right:0,bottom:0,left:0},projection:"robinson",topology:{path:null,objects:{geo:"land",boundaries:"countries"},geoIdProperty:null}},chart:{labels:{dragging:!0}},datawarning:{doubtDomain:[],doubtRange:[]},presentation:!1}}});e.default=M},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),s=(a(r),i(14)),o=n(s),l=i(152),c=n(l),h=i(24),u=n(h),d=i(23),f=n(d),m=i(22),p=n(m),g=i(27),v=n(g),b=i(39),y=n(b),x=i(34),_=n(x),M=o.default.extend("Cartogram",{init:function(t,e){this.name="cartogram",this.components=[{component:c.default,placeholder:".vzb-tool-viz",model:["state.time","state.entities","state.marker","locale","ui"]},{component:u.default,placeholder:".vzb-tool-timeslider",model:["state.time","state.entities","state.marker","ui"]},{component:f.default,placeholder:".vzb-tool-dialogs",model:["state","ui","locale"]},{component:p.default,placeholder:".vzb-tool-buttonlist",model:["state","ui","locale"]},{component:v.default,placeholder:".vzb-tool-treemenu",model:["state.marker","locale"]},{component:y.default,placeholder:".vzb-tool-datawarning",model:["locale"]},{component:_.default,placeholder:".vzb-tool-datanotes",model:["state.marker","locale"]}],this._super(t,e)},default_model:{state:{},ui:{chart:{labels:{dragging:!0},lockNonSelected:0,lockActive:0,sizeSelectorActive:0},datawarning:{doubtDomain:[],doubtRange:[]},presentation:!1}}});e.default=M},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),s=(a(r),i(14)),o=n(s),l=i(225),c=(n(l),i(24)),h=(n(c),i(23)),u=(n(h),i(22)),d=(n(u),i(27)),f=(n(d),o.default.extend("DonutChart",{init:function(t,e){this.name="donutchart",this.components=[{component:"donut",placeholder:".vzb-tool-viz",model:["state.time","state.marker"]},{component:"timeslider",placeholder:".vzb-tool-timeslider",model:["state.time","state.entities","state.marker","ui"]}],this._super(t,e)},default_model:{state:{},ui:{presentation:!1},locale:{}}}));e.default=f},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),s=(a(r),i(14)),o=n(s),l=i(152),c=n(l),h=i(88),u=n(h),d=i(24),f=n(d),m=i(23),p=n(m),g=i(22),v=n(g),b=i(27),y=n(b),x=i(39),_=n(x),M=i(34),w=n(M),z=o.default.extend("JOINTCartogramLine",{init:function(t,e){this.name="joint_cartogramline",this.template='<div class="vzb-tool vzb-tool-'+this.name+'"><div class="vzb-tool-stage vzb-tool-stage-left" style="position:absolute; left: 0; width: 65%; height: 100%;"><div class="vzb-tool-viz vzb-tool-viz-cartogram"></div></div><div class="vzb-tool-stage vzb-tool-stage-right" style="position:absolute; right: 0; top: 0; width: 40%; height: 100%;"><div class="vzb-tool-viz vzb-tool-viz-line"></div><div class="vzb-tool-timeslider"></div></div><div class="vzb-tool-sidebar"><div class="vzb-tool-dialogs"></div><div class="vzb-tool-buttonlist"></div></div><div class="vzb-tool-datanotes vzb-hidden"></div><div class="vzb-tool-treemenu vzb-hidden"></div><div class="vzb-tool-datawarning vzb-hidden"></div><div class="vzb-tool-labels vzb-hidden"></div></div>',this.components=[{component:c.default,placeholder:".vzb-tool-viz-cartogram",model:["state.time","state.entities","state.marker","locale","ui"]},{component:u.default,placeholder:".vzb-tool-viz-line",model:["state.time","state.entities_line","state.marker_line","locale"]},{component:f.default,placeholder:".vzb-tool-timeslider",model:["state.time","state.entities","state.marker","ui"]},{component:p.default,placeholder:".vzb-tool-dialogs",model:["state","ui","locale"]},{component:v.default,placeholder:".vzb-tool-buttonlist",model:["state","ui","locale"]},{component:y.default,placeholder:".vzb-tool-treemenu",model:["state.marker","locale"]},{component:_.default,placeholder:".vzb-tool-datawarning",model:["locale"]},{component:w.default,placeholder:".vzb-tool-datanotes",model:["state.marker","locale"]}],this._super(t,e)},readyOnce:function(){this.element=d3.select(this.element),this.element.select(".vzb-lc-axis-y-title").classed("vzb-hidden",!0),this.element.select(".vzb-lc-axis-x-title").classed("vzb-hidden",!0),this.element.select(".vzb-lc-axis-y-info").classed("vzb-hidden",!0),this.element.select(".vzb-data-warning").classed("vzb-hidden",!0)},default_model:{ui:{chart:{labels:{min_number_of_entities_when_values_hide:0},hideXAxisValue:!0,whenHovering:{hideVerticalNow:!0,showProjectionLineX:!0,showProjectionLineY:!0,higlightValueX:!0,higlightValueY:!0,showTooltip:!1},stacked:!0,inpercent:!1},presentation:!0}},datawarning_content:{title:"",body:"Comparing the size of economy across countries and time is not trivial. The methods vary and the prices change. Gapminder has adjusted the picture for many such differences, but still we recommend you take these numbers with a large grain of salt.<br/><br/> Countries on a lower income levels have lower data quality in general, as less resources are available for compiling statistics. Historic estimates of GDP before 1950 are generally also more rough. <br/><br/> Data for child mortality is more reliable than GDP per capita, as the unit of comparison, dead children, is universally comparable across time and place. This is one of the reasons this indicator has become so useful to measure social progress. But the historic estimates of child mortality are still suffering from large uncertainties.<br/><br/> Learn more about the datasets and methods in this <a href='http://www.gapminder.org/news/data-sources-dont-panic-end-poverty' target='_blank'>blog post</a>",
doubtDomain:[1800,1950,2015],doubtRange:[1,.3,.2]}});e.default=z},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),s=(a(r),i(14)),o=n(s),l=i(151),c=n(l),h=i(88),u=n(h),d=i(24),f=n(d),m=o.default.extend("JOINTPyramidLine",{init:function(t,e){this.name="joint_pyramidline",this.template='<div class="vzb-tool vzb-tool-'+this.name+'"><div class="vzb-tool-stage vzb-tool-stage-left" style="position:absolute; left: 0; width: 50%; height: 100%;"><div class="vzb-tool-viz vzb-tool-viz-pyramid"></div></div><div class="vzb-tool-stage vzb-tool-stage-right" style="position:absolute; right: 0; width: 50%; height: 100%;"><div class="vzb-tool-viz vzb-tool-viz-line"></div><div class="vzb-tool-timeslider"></div></div><div class="vzb-tool-sidebar"><div class="vzb-tool-dialogs"></div><div class="vzb-tool-buttonlist"></div></div><div class="vzb-tool-datanotes vzb-hidden"></div><div class="vzb-tool-treemenu vzb-hidden"></div><div class="vzb-tool-datawarning vzb-hidden"></div><div class="vzb-tool-labels vzb-hidden"></div></div>',this.components=[{component:c.default,placeholder:".vzb-tool-viz-pyramid",model:["state.time","state.entities","state.entities_side","state.entities_stack","state.entities_age","state.marker_pyramid","state.marker_side","locale","ui"]},{component:u.default,placeholder:".vzb-tool-viz-line",model:["state.time","state.entities","state.marker_line","locale"]},{component:f.default,placeholder:".vzb-tool-timeslider",model:["state.time","state.entities","state.marker_pyramid","ui"]}],this._super(t,e)},default_model:{ui:{chart:{labels:{min_number_of_entities_when_values_hide:2},whenHovering:{hideVerticalNow:!1,showProjectionLineX:!0,showProjectionLineY:!0,higlightValueX:!0,higlightValueY:!0,showTooltip:!1},stacked:!0,inpercent:!1},presentation:!1}}});e.default=m},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),s=(a(r),i(14)),o=n(s),l=i(88),c=n(l),h=i(24),u=n(h),d=i(23),f=n(d),m=i(22),p=n(m),g=i(27),v=n(g),b=i(39),y=n(b),x=i(34),_=n(x),M=o.default.extend("LineChart",{init:function(t,e){this.name="linechart",this.components=[{component:c.default,placeholder:".vzb-tool-viz",model:["state.time","state.entities","state.marker","locale","ui"]},{component:u.default,placeholder:".vzb-tool-timeslider",model:["state.time","state.entities","state.marker","ui"],ui:{show_value_when_drag_play:!1,axis_aligned:!0}},{component:f.default,placeholder:".vzb-tool-dialogs",model:["state","ui","locale"]},{component:p.default,placeholder:".vzb-tool-buttonlist",model:["state","ui","locale"]},{component:v.default,placeholder:".vzb-tool-treemenu",model:["state.marker","state.marker_tags","state.time","locale"]},{component:y.default,placeholder:".vzb-tool-datawarning",model:["locale"]},{component:_.default,placeholder:".vzb-tool-datanotes",model:["state.marker","locale"]}],this._super(t,e)},default_model:{state:{time:{},marker:{axis_x:{allow:{scales:["time"]}},axis_y:{allow:{scales:["linear","log"]}}}},locale:{},ui:{chart:{labels:{min_number_of_entities_when_values_hide:2},whenHovering:{hideVerticalNow:!1,showProjectionLineX:!0,showProjectionLineY:!0,higlightValueX:!0,higlightValueY:!0,showTooltip:!1}},datawarning:{doubtDomain:[],doubtRange:[]},presentation:!1}}});e.default=M},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),s=(a(r),i(14)),o=n(s),l=i(226),c=n(l),h=i(24),u=n(h),d=i(23),f=n(d),m=i(22),p=n(m),g=i(27),v=n(g),b=i(39),y=n(b),x=i(34),_=n(x),M=o.default.extend("MountainChart",{init:function(t,e){this.name="mountainchart",this.components=[{component:c.default,placeholder:".vzb-tool-viz",model:["state.time","state.entities","state.marker","locale","ui"]},{component:u.default,placeholder:".vzb-tool-timeslider",model:["state.time","state.entities","state.marker","ui"]},{component:f.default,placeholder:".vzb-tool-dialogs",model:["state","ui","locale"]},{component:p.default,placeholder:".vzb-tool-buttonlist",model:["state","ui","locale"]},{component:v.default,placeholder:".vzb-tool-treemenu",model:["state.marker","state.marker_tags","state.time","locale"]},{component:y.default,placeholder:".vzb-tool-datawarning",model:["locale"]},{component:_.default,placeholder:".vzb-tool-datanotes",model:["state.marker","locale"]}],this._super(t,e)},default_model:{state:{time:{delay:100,delayThresholdX2:50,delayThresholdX4:25},entities:{opacitySelectDim:.3,opacityRegular:.7}},locale:{},ui:{chart:{manualSortingEnabled:!0,yMaxMethod:"latest",showProbeX:!0,probeX:1.85,xLogStops:[1,2,5],xPoints:50},datawarning:{doubtDomain:[],doubtRange:[]},presentation:!1}}});e.default=M},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function a(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var r=i(70),s=a(r),o=i(1),l=n(o),c=i(14),h=a(c),u=i(2),d=a(u),f=i(47),m=a(f),p=i(71),g=a(p),v=i(46),b=a(v),y=i(45),x=a(y),_=i(212),M=a(_),w=i(213),z=i(214),S=n(z),k=function t(e,i,n){var a=h.default.get(e);if(a){var r=new a(i,n);return t._instances[r._id]=r,r}l.error('Tool "'+e+'" was not found.')};k._instances={},k._globals=x.default,k.clearInstances=function(t){if(t)k._instances[t]=void 0;else{for(var e in k._instances)k._instances[e].clear();k._instances={}}};var E=(0,s.default)(i(461));l.forEach(E,function(t,e){g.default.register(e,t)});var O=(0,s.default)(i(457),1);l.forEach(O,function(t,e){d.default.register(e,t)}),d3.scale.genericLog=M.default,d3.selection.prototype.onTap=w.onTap,d3.selection.prototype.onLongTap=w.onLongTap,d3.svg.brush=S.brush,d3.behavior.drag=S.drag,d3.behavior.zoom=S.zoom,k.Tool=h.default,k.Component=d.default,k.Model=m.default,k.Reader=g.default,k.Events=b.default,k.utils=l,e.default=k},function(t,e,i){"use strict";(function(t){function e(t,e,i){t[e]||Object[n](t,e,{writable:!0,configurable:!0,value:i})}if(i(410),i(455),i(230),t._babelPolyfill)throw new Error("only one instance of babel-polyfill is allowed");t._babelPolyfill=!0;var n="defineProperty";e(String.prototype,"padLeft","".padStart),e(String.prototype,"padRight","".padEnd),"pop,reverse,shift,keys,values,entries,indexOf,every,some,forEach,map,filter,find,findIndex,includes,join,slice,concat,push,splice,unshift,sort,lastIndexOf,reduce,reduceRight,copyWithin,fill".split(",").forEach(function(t){[][t]&&e(Array,t,Function.call.bind([][t]))})}).call(e,i(181))},function(t,e){},,,,,,,,,,,,,function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var a=i(21),r=n(a),s=r.default.extend({init:function(){this.intervals={}},setInterval:function(t){function e(e,i,n){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(t,e,i){this.clearInterval(t),this.intervals[t]=setInterval(e,i)}),clearInterval:function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(t){return t?clearInterval(this.intervals[t]):this.clearAllIntervals()}),clearAllIntervals:function(){for(var t in this.intervals)this.clearInterval(t)}});e.default=s},function(t,e){"use strict";function i(){return function(){function t(d){return null==a?void console.warn("D3 collision resolver stopped: missing data to work with. Example: data = {asi: {valueY: 45, valueX: 87}, ame: {valueY: 987, valueX: 767}}"):null==r?void console.warn("D3 collision resolver stopped: missing a CSS slector"):null==s?void console.warn("D3 collision resolver stopped: missing height of the canvas"):null==l?void console.warn("D3 collision resolver stopped: missing pointer within data objects. Example: value = 'valueY' "):null==u?void console.warn("D3 collision resolver stopped: missing a key for data. Example: key = 'geo' "):(d.each(function(t,e){i[t[u]]=d3.select(this).select(r)[0][0].getBBox().height}),n=t.calculatePositions(a,l,s,o),void d.each(function(t,i){if(a[t[u]]&&!a[t[u]][c]){var s=n[t[u]]||o(a[t[u]][l])||0,d=null;return null!=h?void h(t,i,this,d,s):void d3.select(this).selectAll(r).transition().duration(e).attr("transform","translate(0,"+s+")")}}))}var e=300,i={},n={};t.calculatePositions=function(t,e,n,a){var r={},s=Object.keys(t).sort(function(i,n){return t[i][e]-t[n][e]});s.forEach(function(n,o){r[n]=a(t[n][e]);for(var l=o;l>0;l--){var c=r[s[l-1]]-r[s[l]]-i[s[l]];if(c<0&&(r[s[l-1]]-=c),c>0)break}});var o=n-r[s[0]]-i[s[0]];if(o<0){r[s[0]]+=o;for(var l=0;l<s.length-1;l++){var o=r[s[l]]-r[s[l+1]]-i[s[l+1]];if(o<0&&(r[s[l+1]]+=o),o>0)break}}return r};var a=null;t.data=function(e){return arguments.length?(a=e,t):a};var r=null;t.selector=function(e){return arguments.length?(r=e,t):r};var s=null;t.height=function(e){return arguments.length?(s=e,t):s};var o=d3.scale.linear().domain([0,1]).range([0,1]);t.scale=function(e){return arguments.length?(o=e,t):o};var l=null;t.value=function(e){return arguments.length?(l=e,t):l};var c=null;t.fixed=function(e){return arguments.length?(c=e,t):c};var h=null;t.handleResult=function(e){return arguments.length?(h=e,t):h};var u=null;return t.KEY=function(e){return arguments.length?(u=e,t):u},t}()}Object.defineProperty(e,"__esModule",{value:!0}),e.default=i},function(t,e){"use strict";function i(){function t(){function t(){for(var t=[],i=0;i<r;i++){var u=s+(1-s)/r*i;t.push([]);for(var d=0;d<=n;d++){var f=a+(1-a)/n*d;t[i].push({display:e(f,0==d?h:o,0==i?l:u),meaning:e(f,0==d?h:o,0==i?c:u)})}}return t}function e(t,e,i){var n,a,r;if(0==e)n=a=r=i;else{var s=function(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t},o=i<.5?i*(1+e):i+e-i*e,l=2*i-o;n=s(l,o,t+1/3),a=s(l,o,t),r=s(l,o,t-1/3)}return"#"+Math.round(255*n).toString(16)+Math.round(255*a).toString(16)+Math.round(255*r).toString(16)}function i(e){if(i.container=e,M=e.select("."+b.COLOR_PICKER),M.empty()){e.on("click",function(){i.show(!1),d3.event.stopPropagation()}),y=t(),M=e.append("svg").style("position","absolute").style("top","0").style("left","0").style("width","100%").style("max-width",d+"px").style("height","100%").style("max-height",f+"px").style("z-index",9999).attr("class",b.COLOR_PICKER+" vzb-dialog-shadow").classed(b.INVISIBLE,!z).on("mouseout",function(t){D(p)});var n=parseInt(M.style("width")),a=parseInt(M.style("height")),s=n/2*(1-m.left-m.right);E=M.append("rect").attr("width",n).attr("height",f).attr("class",b.COLOR_BUTTON+" "+b.COLOR_BACKGR).on("mouseover",function(t){D(p)});var o=M.append("g").attr("class",b.COLOR_CIRCLES).attr("transform","translate("+(s+n*m.left)+","+(s+a*m.top)+")");M.append("rect").attr("class",b.COLOR_SAMPLE).attr("width",n/2).attr("height",a*m.top/2),S=M.append("rect").attr("class",b.COLOR_SAMPLE).attr("width",n/2).attr("x",n/2).attr("height",a*m.top/2),M.append("text").attr("x",n*m.left).attr("y",a*m.top/2).attr("dy","1.3em").attr("class",b.COLOR_SAMPLE).style("text-anchor","start"),k=M.append("text").attr("x",n*(1-m.right)).attr("y",a*m.top/2).attr("dy","1.3em").attr("class",b.COLOR_SAMPLE).style("text-anchor","end"),M.append("text").attr("x",.1*n).attr("y",a*(1-m.bottom)).attr("dy","1.2em").attr("class","vzb-default-label").style("text-anchor","start").text("default"),M.append("circle").attr("class",b.COLOR_DEFAULT+" "+b.COLOR_BUTTON).attr("r",n*m.left/2).attr("cx",n*m.left*1.5).attr("cy",a*(1-1.5*m.bottom)).on("mouseover",function(){d3.select(this).style("stroke","#444"),D(g)}).on("mouseout",function(){d3.select(this).style("stroke","none")}),o.selectAll("."+b.COLOR_CIRCLE).data(y).enter().append("g").attr("class",b.COLOR_CIRCLE).each(function(t,e){x.outerRadius(u+(s-u)/r*(r-e)).innerRadius(u+(s-u)/r*(r-e-1));var i=d3.select(this).selectAll("."+b.COLOR_SEGMENT).data(_(t)).enter().append("g").attr("class",b.COLOR_SEGMENT);i.append("path").attr("class",b.COLOR_BUTTON).attr("d",x).style("fill",function(t){return t.data.display}).style("stroke",function(t){return t.data.display}).on("mouseover",function(t){D(t.data.meaning,this)}).on("mouseout",function(t){I()})}),o.append("circle").attr("r",u).attr("fill",v).attr("class",b.COLOR_BUTTON).on("mouseover",function(){d3.select(this).style("stroke","#555"),D(v)}).on("mouseout",function(){d3.select(this).style("stroke","none")}),w=o.append("path").attr("class",b.COLOR_POINTER+" "+b.INVISIBLE),M.selectAll("."+b.COLOR_BUTTON).on("click",function(){d3.event.stopPropagation(),P.show(!1)}),T(M),i.resize(M)}}var n=15,a=0,r=4,s=.5,o=.7,l=.4,c=.3,h=0,u=15,d=280,f=323,m={top:.1,bottom:.1,left:.1,right:.1},p="#000",g="#000",v="#f8f8f8",b={INVISIBLE:"vzb-invisible",COLOR_POINTER:"vzb-colorpicker-pointer",COLOR_BUTTON:"vzb-colorpicker-cell",COLOR_DEFAULT:"vzb-colorpicker-default",COLOR_SAMPLE:"vzb-colorpicker-sample",COLOR_PICKER:"vzb-colorpicker-svg",COLOR_CIRCLE:"vzb-colorpicker-circle",COLOR_CIRCLES:"vzb-colorpicker-circles",COLOR_SEGMENT:"vzb-colorpicker-segment",COLOR_BACKGR:"vzb-colorpicker-background"},y=[],x=d3.svg.arc(),_=d3.layout.pie().sort(null).value(function(t){return 1}),M=null,w=null,z=!1,S=null,k=null,E=null,O=function(t){console.info("Color picker callback example. Setting color to "+t)},T=function(t){t.select("."+b.COLOR_BACKGR).style("fill","white"),t.select("."+b.COLOR_POINTER).style("stroke-width",2).style("stroke",v).style("pointer-events","none").style("fill","none"),t.selectAll("."+b.COLOR_BUTTON).style("cursor","pointer"),t.selectAll("text").style("fill","#D9D9D9").style("font-size","0.7em").style("text-transform","uppercase"),t.selectAll("circle."+b.COLOR_BUTTON).style("stroke-width",2)},P=i,D=function(t,e){null!=e&&w.classed(b.INVISIBLE,!1).attr("d",d3.select(e).attr("d")),S.style("fill",t),k.text(t),O(t)},I=function(){w.classed(b.INVISIBLE,!0)},C="toggle";return i.show=function(t){return arguments.length?(null==M&&console.warn("Color picker is missing SVG element. Was init sequence performed?"),z=t==C?!z:t,z||(O=function(){}),void M.classed(b.INVISIBLE,!z)):z},i.nCellsH=function(t){return arguments.length?(n=t,i):n},i.minH=function(t){return arguments.length?(a=t,i):a},i.nCellsL=function(t){return arguments.length?(r=t,i):r},i.minL=function(t){return arguments.length?(s=t,i):s},i.outerL_display=function(t){return arguments.length?(l=t,i):l},i.outerL_meaning=function(t){return arguments.length?(c=t,i):c},i.satConstant=function(t){return arguments.length?(o=t,i):o},i.firstAngleSat=function(t){return arguments.length?(h=t,i):h},i.minRadius=function(t){return arguments.length?(u=t,i):u},i.margin=function(t){return arguments.length?(m=t,i):m},i.callback=function(t){return arguments.length?(O=t,i):O},i.colorDef=function(t){return arguments.length?("undefined"!=typeof t&&(g=t),null==M&&console.warn("Color picker is missing SVG element. Was init sequence performed?"),M.select("."+b.COLOR_DEFAULT).style("fill",g),i):g},i.translate=function(t){return t instanceof Function&&M.select(".vzb-default-label").text(t("colorpicker/default")),i},i.fitToScreen=function(t){var e,n,a=i.container.node().getBoundingClientRect(),r=parseInt(M.style("width")),s=parseInt(M.style("height"));t?(e=t[0]-a.left,n=t[1]-a.top):(e=a.width-parseInt(M.style("right"))-r,n=parseInt(M.style("top")));var o={left:""};return.8*a.width<=r?o.right=.5*(a.width-r)+"px":e+r>a.width?o.right=Math.min(.1*a.width,20)+"px":o.right=a.width-e-r+"px",.8*a.height<=s?o.top=.5*(a.height-s)+"px":n+1.2*s>a.height?o.top=.9*a.height-s+"px":o.top=n+"px",M.style(o),i},i.colorOld=function(t){return arguments.length?(p=t,null==M&&console.warn("Color picker is missing SVG element. Was init sequence performed?"),M.select("rect."+b.COLOR_SAMPLE).style("fill",p),M.select("text."+b.COLOR_SAMPLE).text(p),i):p},i.resize=function(t){if(!arguments.length)return resize;if("undefined"!=typeof t){var e=t,n=parseInt(e.style("width")),a=parseInt(e.style("height")),r=n/2*(1-m.left-m.right),s=e.select("."+b.COLOR_DEFAULT),o=e.select(".vzb-default-label"),l=e.select("."+b.COLOR_CIRCLES),c=r+a*m.top,h=(1+.5*m.top)*a*.5;c=c>h?h:c,l.attr("transform","translate("+(r+n*m.left)+","+c+")"),s.attr("cx",n*m.left*1.5).attr("cy",a*(1-1.5*m.bottom)),o.attr("x",.1*n).attr("y",a*(1-m.bottom))}return i.fitToScreen(),i},i}return function(){return null==n&&(n=t()),n}()}Object.defineProperty(e,"__esModule",{value:!0}),e.default=i;var n=null},function(t,e){"use strict";function i(){return function t(e){function i(t){var e=v(t);return u?u(e.scale(t*e.sign)):e.scale(t*e.sign)}var n,a,r=[],s=[],o=.1,l=5,c=e.domain(),h=e.range(),u=null,d=function(t){return t instanceof Array?t.map(function(t){return Math.abs(t)}):Math.abs(t)},f=function(t,e){return{domain:t,sign:1,range:e,scale:d3.scale.linear().domain(t).range(e)}},m=function(t,e,i){var n=t;return i&&(n=d(t)),{domain:t,sign:i?-1:1,range:e,scale:d3.scale.log().domain(n).range(e)}},p=function(){n=h[0]<h[h.length-1];var t=n?1:-1;if(r=[],1==s.length)r=s[0][0]<=0&&s[0][1]>=0?[f(s[0],h)]:[m(s[0],h,s[0][0]<=0)];else{var i,u=d3.max(d(c)),p=d(d3.max(h)-d3.min(h)),g=1,v=0,b=0,y=0,x=0;e.domain([o,u]).range([0,p]),i=l,0!=c[0]&&d(c[0])>o&&(v=e(d(c[0]))),0!=c[c.length-1]&&d(c.length-1)>o&&(b=e(d(c[c.length-1]))),d(c[0])>o&&(y=i),d(c[c.length-1])>o&&(x=i),p=p-y-x,0!=b&&(g=d(v/b));var _,M;2==s.length?0==c[0]||d(c[0])<=o?(_=h[0]+v*g*t+x*t,r=[f(s[0],[h[0],_]),m(s[1],[_,h[h.length-1]],!a)]):(0==c[c.length-1]||d(c[c.length-1])<=o)&&(_=h[h.length-1]-(y+x)*g*t,r=[m(s[0],[h[0],_],a),f(s[1],[_,h[h.length-1]])]):(_=h[0]+p/(1/g+1)*t,M=h[0]+(p/(1/g+1)+y+x)*t,r=[m(s[0],[h[0],_],a),f(s[1],[_,M]),m(s[2],[M,h[h.length-1]],!a)])}},g=function(){if(a=c[0]<c[c.length-1],s=[],d3.min(c)>0&&d3.max(c)>0||d3.min(c)<0&&d3.max(c)<0)s=[c];else{var t,e;a?(t=c[0],e=c[c.length-1]):(t=c[c.length-1],e=c[0]);for(var i=function(t,e){a?s.push([t,e]):s.unshift([e,t])};t!=e;)e<=-o||t>=-o&&e<=o||t>=o?(i(t,e),t=e):t<-o&&e>=-o?(i(t,-o),t=-o):t>=-o&&e>=o?(i(t,o),t=o):(console.warn("Something wrong while build subdomains: "+t+" "+e),t=e)}p()},v=function(t){if(a){if(t<c[0])return r[0];if(t>c[c.length-1])return r[r.length-1];for(var e=0;e<r.length;e++)if(t>=r[e].domain[0]&&t<=r[e].domain[r[e].domain.length-1])return r[e]}else{if(t>c[0])return r[0];if(t<c[c.length-1])return r[r.length-1];for(var e=0;e<r.length;e++)if(i=r[e],t<=r[e].domain[0]&&t>=r[e].domain[r[e].domain.length-1])return r[e]}},b=function(t){if(n){if(t<h[0])return r[0];if(t>h[h.length-1])return r[r.length-1];for(var e=0;e<r.length;e++)if(t>=r[e].range[0]&&t<=r[e].range[r[e].range.length-1])return r[e]}else{if(t>h[0])return r[0];if(t<h[h.length-1])return r[r.length-1];for(var e=0;e<r.length;e++){r[e];if(t<=r[e].range[0]&&t>=r[e].range[1])return r[e]}}};return Math.sign=Math.sign||function(t){return t=+t,0===t||isNaN(t)?t:t>0?1:-1},i.eps=function(t){return arguments.length?(o=t,i.domain(c),i):o},i.delta=function(t){return arguments.length?(l=t,i.range(h),i):l},i.domain=function(t){if(!arguments.length)return c;switch(t.length){case 0:t=c;break;case 1:t=[t[0]/2,2*t[0]]}t[0]==t[t.length-1]&&(t[0]=t[0]/2,t[t.length-1]=2*t[t.length-1]),c=t;var e=d3.min(d(c).filter(function(t){return!!t}));return e&&(o=Math.min(o,e/100)),g(),i},i.range=function(t,e){if(!arguments.length)return u?u.range():h;switch(t.length){case 0:t=h;break;case 1:t=[t[0]-100,t[0]+100]}if(u&&!e)u.range(t);else{h=t;var n=d3.min(d(h).filter(function(t){return!!t}));n&&(l=Math.min(l,n/100)),p()}return i},i.interpolate=function(t){return u=d3.scale.linear().domain(c).range(h).interpolate(t),i.range(u.domain(),!0),i},i.invert=function(t){var e=b(t);return e.scale.invert(t)*e.sign},i.ticks=function(t){for(var e,i=[],n=0;n<r.length;n++)e=r[n].sign==-1?r[n].scale.ticks().reverse().map(function(t){return t*-1}):r[n].scale.ticks(),i.length>0&&e.length>0&&i[i.length-1]==e[0]&&e.splice(0,1),i.push.apply(i,e);return i},i.copy=function(){return t(e).domain(c).range(h).delta(l).eps(o)},d3.rebind(i,e,"base","rangeRound","clamp","nice","tickFormat")}(d3.scale.log().domain([.1,200]).range([0,1e3]))}Object.defineProperty(e,"__esModule",{value:!0}),e.default=i},function(t,e){"use strict";function i(t,e,i){var n,a,r,s=e?".onTap":".onLongTap";d3.select(t).on("touchstart"+s,function(t,e){n=d3.event.timeStamp,a=d3.event.changedTouches[0].screenX,r=d3.event.changedTouches[0].screenY}).on("touchend"+s,function(t,s){return a=Math.abs(a-d3.event.changedTouches[0].screenX),r=Math.abs(r-d3.event.changedTouches[0].screenY),a<5&&r<5?d3.event.timeStamp-n<500?e?e(t,s):void 0:i?i(t,s):void 0:void 0})}Object.defineProperty(e,"__esModule",{value:!0});var n=function(t){return this.each(function(){i(this,t)})},a=function(t){return this.each(function(){i(this,null,t)})};e.default={onTap:n,onLongTap:a},e.onTap=n,e.onLongTap=a},function(t,e,i){"use strict";function n(){d3.event.target.dispatchEvent(new TouchEvent("touchend",d3.event))}Object.defineProperty(e,"__esModule",{value:!0}),e.zoom=e.drag=e.brush=void 0;var a=i(1),r=function(t){return(0,a.isTouchDevice)()?function(){return function(t){function e(){t.call(this),this.on("mousedown.drag",null),this.on("touchcancel",n)}return d3.rebind(e,t,"origin","on")}(t())}:t}(d3.behavior.drag),s=function(t){return(0,a.isTouchDevice)()?function(){return function(t){function e(i){t(i),i.on("mousedown.zoom",null),i.on("touchcancel",n),e.on("zoomend.clearmousedown",function(){i.on("mousedown.zoom",null)})}return d3.rebind(e,t,"translate","scale","scaleExtent","center","size","x","y","on","event")}(t())}:t}(d3.behavior.zoom),o=function(t){function e(t){return t&&(t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView)}return(0,a.isTouchDevice)()?function(){return function(t){function i(){function t(){i.on("touchcancel.brush",null)}a.on("brushend.touchcancel",t);var i=d3.select(e(this));i.on("touchcancel.brush",n)}function a(e){t(e),e.each(function(){d3.select(this).on("mousedown.brush",null)}),a.on("brushstart.touchcancel",i)}return d3.rebind(a,t,"x","y","extent","clamp","clear","empty","on","event")}(t())}:t}(d3.svg.brush);e.default={brush:o,drag:r,zoom:s},e.brush=o,e.drag=r,e.zoom=s},function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){function t(t,e){function i(e){var i,n=t.arcs[e<0?~e:e],a=n[0];return t.transform?(i=[0,0],n.forEach(function(t){i[0]+=t[0],i[1]+=t[1]})):i=n[n.length-1],e<0?[i,a]:[a,i]}function n(t,e){for(var i in t){var n=t[i];delete e[n.start],delete n.start,delete n.end,n.forEach(function(t){a[t<0?~t:t]=1}),o.push(n)}}var a={},r={},s={},o=[],l=-1;return e.forEach(function(i,n){var a,r=t.arcs[i<0?~i:i];r.length<3&&!r[1][0]&&!r[1][1]&&(a=e[++l],e[l]=i,e[n]=a)}),e.forEach(function(t){var e,n,a=i(t),o=a[0],l=a[1];if(e=s[o])if(delete s[e.end],e.push(t),e.end=l,n=r[l]){delete r[n.start];var c=n===e?e:e.concat(n);r[c.start=e.start]=s[c.end=n.end]=c}else r[e.start]=s[e.end]=e;else if(e=r[l])if(delete r[e.start],e.unshift(t),e.start=o,n=s[o]){delete s[n.end];var h=n===e?e:n.concat(e);r[h.start=n.start]=s[h.end=e.end]=h}else r[e.start]=s[e.end]=e;else e=[t],r[e.start=o]=s[e.end=l]=e}),n(s,r),n(r,s),e.forEach(function(t){a[t<0?~t:t]||o.push([t])}),o}function e(e,i,n){function a(t){var e=t<0?~t:t;(h[e]||(h[e]=[])).push({i:t,g:c})}function r(t){t.forEach(a)}function s(t){t.forEach(r)}function o(t){"GeometryCollection"===t.type?t.geometries.forEach(o):t.type in u&&(c=t,u[t.type](t.arcs))}var l=[];if(arguments.length>1){var c,h=[],u={LineString:r,MultiLineString:s,Polygon:s,MultiPolygon:function(t){t.forEach(s)}};o(i),h.forEach(arguments.length<3?function(t){l.push(t[0].i)}:function(t){n(t[0].g,t[t.length-1].g)&&l.push(t[0].i)})}else for(var d=0,f=e.arcs.length;d<f;++d)l.push(d);return{type:"MultiLineString",arcs:t(e,l)}}function i(e,i){function a(t){t.forEach(function(e){e.forEach(function(e){(o[e=e<0?~e:e]||(o[e]=[])).push(t)})}),l.push(t)}function r(t){return u(s(e,{type:"Polygon",arcs:[t]}).coordinates[0])>0}var o={},l=[],c=[];return i.forEach(function(t){"Polygon"===t.type?a(t.arcs):"MultiPolygon"===t.type&&t.arcs.forEach(a)}),l.forEach(function(t){if(!t._){var e=[],i=[t];for(t._=1,c.push(e);t=i.pop();)e.push(t),t.forEach(function(t){t.forEach(function(t){o[t<0?~t:t].forEach(function(t){t._||(t._=1,i.push(t))})})})}}),l.forEach(function(t){delete t._}),{type:"MultiPolygon",arcs:c.map(function(i){var a=[];if(i.forEach(function(t){t.forEach(function(t){t.forEach(function(t){o[t<0?~t:t].length<2&&a.push(t)})})}),a=t(e,a),(n=a.length)>1)for(var s,l=r(i[0][0]),c=0;c<n;++c)if(l===r(a[c])){s=a[0],a[0]=a[c],a[c]=s;break}return a})}}function a(t,e){return"GeometryCollection"===e.type?{type:"FeatureCollection",features:e.geometries.map(function(e){return r(t,e)})}:r(t,e)}function r(t,e){var i={type:"Feature",id:e.id,properties:e.properties||{},geometry:s(t,e)};return null==e.id&&delete i.id,i}function s(t,e){function i(t,e){e.length&&e.pop();for(var i,n=h[t<0?~t:t],a=0,r=n.length;a<r;++a)e.push(i=n[a].slice()),c(i,a);t<0&&o(e,r)}function n(t){return t=t.slice(),c(t,0),t}function a(t){for(var e=[],n=0,a=t.length;n<a;++n)i(t[n],e);return e.length<2&&e.push(e[0].slice()),e}function r(t){for(var e=a(t);e.length<4;)e.push(e[0].slice());return e}function s(t){return t.map(r)}function l(t){var e=t.type;return"GeometryCollection"===e?{type:e,geometries:t.geometries.map(l)}:e in u?{type:e,coordinates:u[e](t)}:null}var c=p(t.transform),h=t.arcs,u={Point:function(t){return n(t.coordinates)},MultiPoint:function(t){return t.coordinates.map(n)},LineString:function(t){return a(t.arcs)},MultiLineString:function(t){return t.arcs.map(a)},Polygon:function(t){return s(t.arcs)},MultiPolygon:function(t){return t.arcs.map(s)}};return l(e)}function o(t,e){for(var i,n=t.length,a=n-e;a<--n;)i=t[a],t[a++]=t[n],t[n]=i}function l(t,e){for(var i=0,n=t.length;i<n;){var a=i+n>>>1;t[a]<e?i=a+1:n=a}return i}function c(t){function e(t,e){t.forEach(function(t){t<0&&(t=~t);var i=a[t];i?i.push(e):a[t]=[e]})}function i(t,i){t.forEach(function(t){e(t,i)})}function n(t,e){"GeometryCollection"===t.type?t.geometries.forEach(function(t){n(t,e)}):t.type in s&&s[t.type](t.arcs,e)}var a={},r=t.map(function(){return[]}),s={LineString:e,MultiLineString:i,Polygon:i,MultiPolygon:function(t,e){t.forEach(function(t){i(t,e)})}};t.forEach(n);for(var o in a)for(var c=a[o],h=c.length,u=0;u<h;++u)for(var d=u+1;d<h;++d){var f,m=c[u],p=c[d];(f=r[m])[o=l(f,p)]!==p&&f.splice(o,0,p),(f=r[p])[o=l(f,m)]!==m&&f.splice(o,0,m)}return r}function h(t,e){function i(t){r.remove(t),t[1][2]=e(t),r.push(t)}var n=p(t.transform),a=g(t.transform),r=m();return e||(e=d),t.arcs.forEach(function(t){for(var s,o,l=[],c=0,h=0,u=t.length;h<u;++h)o=t[h],n(t[h]=[o[0],o[1],1/0],h);for(var h=1,u=t.length-1;h<u;++h)s=t.slice(h-1,h+2),s[1][2]=e(s),l.push(s),r.push(s);for(var h=0,u=l.length;h<u;++h)s=l[h],s.previous=l[h-1],s.next=l[h+1];for(;s=r.pop();){var d=s.previous,f=s.next;s[1][2]<c?s[1][2]=c:c=s[1][2],d&&(d.next=f,d[2]=s[2],i(d)),f&&(f.previous=d,f[0]=s[0],i(f))}t.forEach(a)}),t}function u(t){for(var e,i=-1,n=t.length,a=t[n-1],r=0;++i<n;)e=a,a=t[i],r+=e[0]*a[1]-e[1]*a[0];return.5*r}function d(t){var e=t[0],i=t[1],n=t[2];return Math.abs((e[0]-n[0])*(i[1]-e[1])-(e[0]-i[0])*(n[1]-e[1]))}function f(t,e){return t[1][2]-e[1][2]}function m(){function t(t,e){for(;e>0;){var i=(e+1>>1)-1,a=n[i];if(f(t,a)>=0)break;n[a._=e]=a,n[t._=e=i]=t}}function e(t,e){for(;;){var i=e+1<<1,r=i-1,s=e,o=n[s];if(r<a&&f(n[r],o)<0&&(o=n[s=r]),i<a&&f(n[i],o)<0&&(o=n[s=i]),s===e)break;n[o._=e]=o,n[t._=e=s]=t}}var i={},n=[],a=0;return i.push=function(e){return t(n[e._=a]=e,a++),a},i.pop=function(){if(!(a<=0)){var t,i=n[0];return--a>0&&(t=n[a],e(n[t._=0]=t,0)),i}},i.remove=function(i){var r,s=i._;if(n[s]===i)return s!==--a&&(r=n[a],(f(r,i)<0?t:e)(n[r._=s]=r,s)),s},i}function p(t){if(!t)return v;var e,i,n=t.scale[0],a=t.scale[1],r=t.translate[0],s=t.translate[1];return function(t,o){o||(e=i=0),t[0]=(e+=t[0])*n+r,t[1]=(i+=t[1])*a+s}}function g(t){if(!t)return v;var e,i,n=t.scale[0],a=t.scale[1],r=t.translate[0],s=t.translate[1];return function(t,o){o||(e=i=0);var l=(t[0]-r)/n|0,c=(t[1]-s)/a|0;t[0]=l-e,t[1]=c-i,e=l,i=c}}function v(){}var b={version:"1.6.19",mesh:function(t){return s(t,e.apply(this,arguments))},meshArcs:e,merge:function(t){return s(t,i.apply(this,arguments))},mergeArcs:i,feature:a,neighbors:c,presimplify:h};return b}()},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){var i=[],n=!0,a=!1,r=void 0;try{for(var s,o=t[Symbol.iterator]();!(n=(s=o.next()).done)&&(i.push(s.value),!e||i.length!==e);n=!0);}catch(t){a=!0,r=t}finally{try{!n&&o.return&&o.return()}finally{if(a)throw r}}return i}return function(e,i){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),s=i(150),o=n(s),l=(i(1),o.default.extend({_name:"csv-time_in_columns",init:function(t){this._super(t),this.timeKey="time"},load:function(){var t=this;return this._super().then(function(e){var i=e.data,n=e.columns,s=n[t.keySize],o=i.reduce(function(t,e){return Object.keys(e).forEach(function(i){i=i===s?e[s]:i,Number(i)==i||t.includes(i)||t.push(i)}),t},[]);o.splice(1,0,t.timeKey);var l=o.slice(2),c=r(o,1),h=c[0];return{columns:o,data:i.reduce(function(e,i){var n=e.filter(function(t){return t[h]===i[h]});return n.length?n.forEach(function(e){e[i[s]]=i[e[t.timeKey]]}):Object.keys(i).forEach(function(n){if(![h,s].includes(n)){var r;e.push(Object.assign((r={},a(r,h,i[h]),a(r,t.timeKey,n),r),l.reduce(function(t,e){return t[e]=i[s]===e?i[n]:null,t},{})))}}),e},[])}})}}));e.default=l},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var a=i(71),r=n(a),s=r.default.extend({_name:"inline",init:function(t){this._data=t.data||[{}]},load:function(){return Promise.resolve({columns:Object.keys(this._data[0]),data:this._data})}});e.default=s},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),s=a(r),o=i(2),l=n(o),c=i(40),h=n(c),u=l.default.extend({init:function(t,e){this.name="axislabeler",this.template=i(446),this.model_expects=[{name:"scales"},{name:"show"}];var n=this;this.model_binds={"change:scales":function(t){n.initScales(),n.update()},"change:show":function(t,e){n.initScales(),n.update()}},this._super(t,e),this.xScale=null,this.yScale=null,this.xAxis=(0,h.default)(),this.yAxis=(0,h.default)()},readyOnce:function(){var t=this;this.element=d3.select(this.element),this.graph=this.element.select(".vzb-al-graph"),this.xAxisEl=this.graph.select(".vzb-al-axis-x"),this.yAxisEl=this.graph.select(".vzb-al-axis-y"),this.xInvert=function(e){return t.xScale(t.xScale.invert(t.xScale(e)))},this.yInvert=function(e){return t.yScale(t.yScale.invert(t.yScale(e)))},this.line=d3.svg.line().x(function(e){return t.xScale(e)}).y(function(e){return t.yScale(e)}),this.lineInvert=d3.svg.line().x(function(e){return t.xInvert(e)}).y(function(e){return t.yInvert(e)}),this.on("resize",function(){t.update()})},ready:function(){console.log("Model ready"),this.initScales(),this.update()},initScales:function(){var t=this.model.scales.domain;this.xScale=d3.scale[this.model.scales.xScaleType](),
this.yScale=d3.scale[this.model.scales.yScaleType](),this.xScale.domain(t),this.yScale.domain(t),this.mockData=d3.range(t[0],t[t.length-1],(t[t.length-1]-t[0])/1e4),this.mockData.push(t[t.length-1])},update:function(){var t=this,e=this.model.show.toolMargin.getPlainObject(),i=parseInt(this.element.style("height"),10)-e.top-e.bottom||0,n=parseInt(this.element.style("width"),10)-e.left-e.right||0;if(i<=0||n<=0)return s.warn("Axis Labeler update() call interrupted for Vizabi container is too little or has display:none");this.graph.attr("transform","translate("+e.left+","+e.top+")");var a=this.xScale.domain().length,r=this.yScale.domain().length;this.xScale.range(d3.range(a).map(function(t){return n/(a-1)*t})),this.yScale.range(d3.range(r).map(function(t){return i/(r-1)*t}).reverse()),this.xAxis.scale(this.xScale).orient("bottom").tickSize(6,0).tickSizeMinor(3,0).labelerOptions({scaleType:this.model.scales.xScaleType,toolMargin:e}),this.yAxis.scale(this.yScale).orient("left").tickSize(6,0).tickSizeMinor(3,0).labelerOptions({scaleType:this.model.scales.yScaleType,toolMargin:e}),this.xAxisEl.attr("transform","translate(0,"+i+")"),this.xAxisEl.call(this.xAxis),this.yAxisEl.call(this.yAxis);var o=this.graph.selectAll(".vzb-al-line").data([0]);o.enter().append("path").attr("class","vzb-al-line"),o.datum(this.mockData).attr("d",this.line);var l=this.graph.selectAll(".vzb-al-line-invert").data([0]);l.enter().append("path").attr("class","vzb-al-line-invert"),l.datum(this.mockData).attr("d",this.lineInvert);var c=d3.format(".4r"),h=this.graph.selectAll(".vzb-al-dots").data(this.mockData);h.enter().append("circle").attr("class","vzb-al-dots").attr("r",5).on("mouseenter",function(e,i){console.log("Point #"+i+": "+e+" x="+c(t.xScale(e))+" y="+c(t.yScale(e)))}),h.exit().remove(),h.attr("cx",function(e){return t.xScale(e)}).attr("cy",function(e){return t.yScale(e)});var u=this.graph.selectAll(".vzb-al-dots-invert").data(this.mockData);u.enter().append("circle").attr("class","vzb-al-dots-invert").attr("r",5).on("mouseenter",function(e,i){console.log("Point #"+i+": "+e+" x="+c(t.xScale(e))+" y="+c(t.yScale(e)))}),u.exit().remove(),u.attr("cx",function(e){return t.xInvert(e)}).attr("cy",function(e){return t.yInvert(e)})}});e.default=u},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),s=a(r),o=i(2),l=n(o),c=i(40),h=n(c),u=l.default.extend({init:function(t,e){this.name="barchart",this.template=i(447),this.model_expects=[{name:"time",type:"time"},{name:"entities",type:"entities"},{name:"marker",type:"model"},{name:"locale",type:"locale"}];var n=this;this.model_binds={"change:time.value":function(t){n.model.marker.getFrame(n.model.time.value,function(t){n.values=t,n.updateEntities()})},"change:marker":function(t,e){n._readyOnce&&(e.indexOf("color.palette")>-1||e.indexOf("which")>-1||e.indexOf("use")>-1||n.ready())},"change:marker.color.palette":s.debounce(function(t){n._readyOnce&&n.updateEntities()},200)},this._super(t,e),this.xScale=null,this.yScale=null,this.cScale=d3.scale.category10(),this.xAxis=(0,h.default)(),this.yAxis=(0,h.default)()},readyOnce:function(){this.element=d3.select(this.element),this.graph=this.element.select(".vzb-bc-graph"),this.yAxisEl=this.graph.select(".vzb-bc-axis-y"),this.xAxisEl=this.graph.select(".vzb-bc-axis-x"),this.yTitleEl=this.graph.select(".vzb-bc-axis-y-title"),this.xTitleEl=this.graph.select(".vzb-bc-axis-x-title"),this.bars=this.graph.select(".vzb-bc-bars"),this.year=this.element.select(".vzb-bc-year");var t=this;this.on("resize",function(){t.updateEntities()})},ready:function(){var t=this;this.model.marker.getFrame(this.model.time.value,function(e){t.values=e,t.updateIndicators(),t.resize(),t.updateEntities()})},updateIndicators:function(){var t=this;this.translator=this.model.locale.getTFunction(),this.duration=this.model.time.delayAnimations;var e=this.translator("indicator/"+this.model.marker.axis_y.which),i=this.translator("indicator/"+this.model.marker.axis_x.which),n=this.yTitleEl.selectAll("text").data([0]);n.enter().append("text"),n.attr("y","-6px").attr("x","-9px").attr("dx","-0.72em").text(e).on("click",function(){t.parent.findChildByName("gapminder-treemenu").markerID("axis_y").alignX("left").alignY("top").updateView().toggle()});var a=this.xTitleEl.selectAll("text").data([0]);a.enter().append("text"),a.attr("y","-3px").attr("dx","-0.72em").text(i).on("click",function(){t.parent.findChildByName("gapminder-treemenu").markerID("axis_x").alignY("bottom").alignX("center").updateView().toggle()}),this.yScale=this.model.marker.axis_y.getScale(),this.xScale=this.model.marker.axis_x.getScale(),this.cScale=this.model.marker.color.getScale();var r="geo.world_4region"==this.model.marker.axis_x.which?function(e){return t.translator("entity/geo.world_4region/"+e)}:t.model.marker.axis_x.getTickFormatter();this.yAxis.tickFormat(t.model.marker.axis_y.getTickFormatter()),this.xAxis.tickFormat(r)},updateEntities:function(){var t=this,e=this.model.time,i=e.getDimension(),n=this.model.entities.getDimension(),a=e.playing?e.delayAnimations:0,r={};r[i]=e.value;var s=this.model.marker.getKeys(r);this.entityBars=this.bars.selectAll(".vzb-bc-bar").data(s),this.entityBars.exit().remove(),this.entityBars.enter().append("rect").attr("class","vzb-bc-bar").on("mousemove",function(t,e){}).on("mouseout",function(t,e){}).on("click",function(t,e){});var o=(this.bars.selectAll(".vzb-bc-bar"),this.xScale.rangeBand());this.bars.selectAll(".vzb-bc-bar").attr("width",o).attr("fill",function(e){return t.cScale(t.values.color[e[n]])}).attr("x",function(e){return t.xScale(t.values.axis_x[e[n]])}).transition().duration(a).ease("linear").attr("y",function(e){return t.yScale(t.values.axis_y[e[n]])}).attr("height",function(e){return t.height-t.yScale(t.values.axis_y[e[n]])}),this.year.text(this.model.time.formatDate(this.model.time.value))},resize:function(){var t=this;this.profiles={small:{margin:{top:30,right:20,left:40,bottom:50},padding:2,minRadius:2,maxRadius:40},medium:{margin:{top:30,right:60,left:60,bottom:60},padding:2,minRadius:3,maxRadius:60},large:{margin:{top:30,right:60,left:60,bottom:80},padding:2,minRadius:4,maxRadius:80}},this.activeProfile=this.profiles[this.getLayoutProfile()];var e=this.activeProfile.margin;if(this.height=parseInt(this.element.style("height"),10)-e.top-e.bottom||0,this.width=parseInt(this.element.style("width"),10)-e.left-e.right||0,this.height<=0||this.width<=0)return s.warn("Bar chart resize() abort: vizabi container is too little or has display:none");this.graph.attr("transform","translate("+e.left+","+e.top+")"),"ordinal"!==this.model.marker.axis_y.scaleType?this.yScale.range([this.height,0]):this.yScale.rangePoints([this.height,0],t.activeProfile.padding).range(),"ordinal"!==this.model.marker.axis_x.scaleType?this.xScale.range([0,this.width]):this.xScale.rangePoints([0,this.width],t.activeProfile.padding).range(),this.yAxis.scale(this.yScale).orient("left").tickSize(6,0).tickSizeMinor(3,0).labelerOptions({scaleType:this.model.marker.axis_y.scaleType,timeFormat:this.model.time.getFormatter(),toolMargin:{top:5,right:e.right,left:e.left,bottom:e.bottom},limitMaxTickNumber:6}),this.xAxis.scale(this.xScale).orient("bottom").tickSize(6,0).tickSizeMinor(3,0).labelerOptions({scaleType:this.model.marker.axis_x.scaleType,timeFormat:this.model.time.getFormatter(),toolMargin:e,viewportLength:this.width}),this.xAxisEl.attr("transform","translate(0,"+this.height+")").call(this.xAxis),this.xScale.rangeRoundBands([0,this.width],.1,.2),this.yAxisEl.call(this.yAxis),this.xAxisEl.call(this.xAxis);var i=this.xAxisEl.node().getBoundingClientRect(),n=this.xTitleEl.node().getBoundingClientRect(),a=i.width/2-n.width/2,r=this.height+i.height+n.height;this.xTitleEl.attr("transform","translate("+a+","+r+")"),this.year.attr("x",this.width).attr("y",0)}});e.default=u},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function r(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}Object.defineProperty(e,"__esModule",{value:!0});var s=i(1),o=a(s),l=i(2),c=n(l),h=i(40),u=n(h),d=i(10),f="#333",m="#fdfdfd",p=c.default.extend({init:function(t,e){var n=this;this.name="barrankchart-component",this.template=i(448),this.model_expects=[{name:"time",type:"time"},{name:"entities",type:"entities"},{name:"marker",type:"model"},{name:"locale",type:"locale"},{name:"ui",type:"ui"}],this.model_binds={"change:time.value":function(){n._readyOnce&&n.onTimeChange()},"change:marker.select":function(){n._readyOnce&&(n._selectBars(),n._updateOpacity(),n._updateDoubtOpacity(),n._scroll())},"change:marker.axis_x.scaleType":function(){n._readyOnce&&(n.loadData(),n.draw(!0))},"change:marker.color.palette":function(){n._drawColors()},"change:marker.highlight":function(){n._updateOpacity()},"change:marker.opacitySelectDim":function(){n._updateOpacity()},"change:marker.opacityRegular":function(){n._updateOpacity()}},this._super(t,e),this.xScale=null,this.cScale=d3.scale.category10(),this.xAxis=(0,u.default)()},onTimeChange:function(){var t=this;this.model.marker.getFrame(this.model.time.value,function(e){t.values=e,t.loadData(),t.draw()})},readyOnce:function(){this.element=d3.select(this.element),this.header=this.element.select(".vzb-br-header"),this.infoEl=this.element.select(".vzb-br-axis-info"),this.barViewport=this.element.select(".vzb-br-barsviewport"),this.barSvg=this.element.select(".vzb-br-bars-svg"),this.barContainer=this.element.select(".vzb-br-bars"),this.dataWarningEl=this.element.select(".vzb-data-warning"),this.wScale=d3.scale.linear().domain(this.model.ui.datawarning.doubtDomain).range(this.model.ui.datawarning.doubtRange),this.xAxis.tickFormat(this.model.marker.axis_x.getTickFormatter()),this._presentation=!this.model.ui.presentation,this._formatter=this.model.marker.axis_x.getTickFormatter(),this.ready(),this._selectBars()},ready:function(){var t=this;this.model.marker.getFrame(this.model.time.value,function(e){t.values=e,t.loadData(),t.draw(!0),t._updateOpacity(),t._drawColors()})},resize:function(){this.draw(!0)},loadData:function(){var t=this,e=this;this.translator=this.model.locale.getTFunction(),this.sortedEntities=this._sortByIndicator(this.values.axis_x),this.header.select(".vzb-br-title").select("text").on("click",function(){return t.parent.findChildByName("gapminder-treemenu").markerID("axis_x").alignX("left").alignY("top").updateView().toggle()}),this.xScale=this.model.marker.axis_x.getScale(),this.cScale=this.model.marker.color.getScale(),o.setIcon(this.dataWarningEl,d.warn).select("svg").attr("width",0).attr("height",0),this.dataWarningEl.append("text").text(this.translator("hints/dataWarning")),this.dataWarningEl.on("click",function(){return t.parent.findChildByName("gapminder-datawarning").toggle()}).on("mouseover",function(){return t._updateDoubtOpacity(1)}).on("mouseout",function(){return t._updateDoubtOpacity()}),o.setIcon(this.infoEl,d.question).select("svg").attr("width",0).attr("height",0),this.infoEl.on("click",function(){t.parent.findChildByName("gapminder-datanotes").pin()}),this.infoEl.on("mouseover",function(){var t=this.getBBox(),i=o.makeAbsoluteContext(this,this.farthestViewportElement),n=i(t.x-10,t.y+t.height+10);e.parent.findChildByName("gapminder-datanotes").setHook("axis_y").show().setPos(n.x,n.y)}),this.infoEl.on("mouseout",function(){e.parent.findChildByName("gapminder-datanotes").hide()})},draw:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.time_1=null==this.time?this.model.time.value:this.time,this.time=this.model.time.value;var e=this.model.time.playing&&this.time-this.time_1>0?this.model.time.delayAnimations:0;this.drawAxes(e,t)||this.drawData(e,t)},drawAxes:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e={small:{margin:{top:60,right:5,left:5,bottom:20},headerMargin:{top:10,right:20,bottom:20,left:20},infoElHeight:16,infoElMargin:5,barHeight:18,barMargin:3,barRectMargin:5,barValueMargin:5,scrollMargin:20},medium:{margin:{top:60,right:5,left:5,bottom:20},headerMargin:{top:10,right:20,bottom:20,left:20},infoElHeight:16,infoElMargin:5,barHeight:21,barMargin:3,barRectMargin:5,barValueMargin:5,scrollMargin:25},large:{margin:{top:60,right:5,left:5,bottom:20},headerMargin:{top:10,right:20,bottom:20,left:20},infoElHeight:16,infoElMargin:5,barHeight:28,barMargin:4,barRectMargin:5,barValueMargin:5,scrollMargin:25}},i={medium:{margin:{top:60,right:10,left:10,bottom:40},headerMargin:{top:10,right:20,bottom:20,left:20},infoElHeight:25,infoElMargin:10,barHeight:25,barMargin:6},large:{margin:{top:60,right:10,left:10,bottom:40},headerMargin:{top:10,right:20,bottom:20,left:20},infoElHeight:16,infoElMargin:10,barHeight:30,barMargin:6}};this.activeProfile=this.getActiveProfile(e,i);var n=this.activeProfile,a=n.margin,r=n.headerMargin,s=n.infoElHeight,o=n.infoElMargin;this.height=+this.element.style("height").replace("px",""),this.width=+this.element.style("width").replace("px",""),this.barViewport.style("height",this.height-a.bottom-a.top+"px"),this.header.attr("height",a.top);var l=this.header.select(".vzb-br-title"),c=this.model.marker.axis_x.getConceptprops(),h=c.name,u=c.unit,d=l.select("text");if(u){d.text(h+", "+u);var f=r.left+l.node().getBBox().width+o+s;f>this.width-r.right&&d.text(h)}var m=l.node().getBBox(),p=r.left,g=r.top+m.height;l.attr("transform","translate("+p+", "+g+")");var v=this.infoEl;v.select("svg").attr("width",s+"px").attr("height",s+"px");var b=p+l.node().getBBox().width+o,y=r.top+s/4;v.attr("transform","translate("+b+", "+y+")");var x=this.header.select(".vzb-br-total");t?x.select("text").transition("text").delay(t).text(this.model.time.formatDate(this.time)):x.select("text").interrupt().text(this.model.time.formatDate(this.time)),x.style("opacity",Number("large"!==this.getLayoutProfile()));var _=x.node().getBBox(),M=this.width-r.right-_.width,w=r.top+_.height;x.attr("transform","translate("+M+", "+w+")").classed("vzb-transparent",m.width+_.width+10>this.width),this.element.select(".vzb-data-warning-svg").style("height",a.bottom+"px");var z=this.dataWarningEl.select("text").node().getBBox();this.dataWarningEl.attr("transform","translate("+(this.width-a.right-z.width)+", "+z.height+")").select("text"),this.dataWarningEl.select("svg").attr("width",z.height).attr("height",z.height).attr("x",-z.height-5).attr("y",-z.height+1),this._updateDoubtOpacity()},drawData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this._createAndDeleteBars(this.barContainer.selectAll(".vzb-br-bar").data(this.sortedEntities,function(t){return t.entity}));var n=this.model.ui.presentation,a=this._presentation!==n;a&&(this._presentation=n);var r="undefined"==typeof this._entitiesCount||this._entitiesCount!==this.sortedEntities.length;(a||r)&&(r&&(this._entitiesCount=this.sortedEntities.length),this._resizeSvg()),this._scroll(e);var s=this.activeProfile,o=s.barRectMargin,l=s.barValueMargin,c=s.scrollMargin,h=s.margin,u=this.model.marker.axis_x,d=u.getLimits(u.which),f=Math.abs(d.max)>=Math.abs(d.min),m=this.width-h.right-h.left-this._getWidestLabelWidth()-o-c;this.xScale.range([0,m]);var p=this.xScale(0)||0,g=this._getWidestLabelWidth();p>(f?h.left:h.right)+this._getWidestLabelWidth()&&(g=p),p<0&&(this.xScale.range([0,m-Math.abs(p)]),p=this.xScale(0)||0);var v=function(e){return t.xScale(e)-p},b=f?"end":"start",y=f?"start":"end",x=f?h.left+g:this.width-g-c-h.right,_=f?x+o:x-o,M=f?_+l:_-l,w=this._getWidestLabelWidth(!0)+(f?h.left:h.right)<g;this.sortedEntities.forEach(function(n){var r=n.value;if((i||a||n.isNew)&&(n.barLabel.attr("x",x).attr("y",t.activeProfile.barHeight/2).attr("text-anchor",b).text(w?n.labelFull:n.labelSmall),n.barRect.attr("rx",t.activeProfile.barHeight/4).attr("ry",t.activeProfile.barHeight/4).attr("height",t.activeProfile.barHeight),n.barValue.attr("x",M).attr("y",t.activeProfile.barHeight/2).attr("text-anchor",y)),i||n.changedWidth||a){var s=Math.max(0,r&&v(Math.abs(r)));(i||n.changedWidth||a)&&n.barRect.transition().duration(e).ease("linear").attr("width",s),n.barRect.attr("x",_-(r<0?s:0)),(i||n.changedValue)&&n.barValue.text(t._formatter(r)||t.translator("hints/nodata"))}(i||n.changedIndex||a)&&n.self.transition().duration(e).ease("linear").attr("transform","translate(0, "+t._getBarPosition(n.index)+")")})},_resizeSvg:function(){var t=this.activeProfile,e=t.barHeight,i=t.barMargin;this.barSvg.attr("height",(e+i)*this.sortedEntities.length+"px")},_scroll:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=this.barContainer.select(".vzb-selected");if(!e.empty()){var i=e.datum(),n=this._getBarPosition(i.index),a=this.activeProfile.margin,r=this.height-a.top-a.bottom,s=n-(r+this.activeProfile.barHeight)/2;this.barViewport.transition().duration(t).tween("scrollfor"+i.entity,this._scrollTopTween(s))}},_createAndDeleteBars:function(t){var e=this;t.exit().remove(),t.enter().append("g").each(function(t){var i=d3.select(this);i.attr("class","vzb-br-bar").classed("vzb-selected",e.model.marker.isSelected(t)).attr("id","vzb-br-bar-"+t.entity+"-"+e._id).on("mousemove",function(t){return e.model.marker.highlightMarker(t)}).on("mouseout",function(){return e.model.marker.clearHighlighted()}).on("click",function(t){e.model.marker.selectMarker(t)});var n=i.append("rect").attr("stroke","transparent"),a=e.values.label[t.entity],r=a.length<12?a:a.substring(0,9)+"...",s=i.append("text").attr("class","vzb-br-label").attr("dominant-baseline","middle"),o=s.text(a).node().getBBox().width,l=s.text(r).node().getBBox().width,c=i.append("text").attr("class","vzb-br-value").attr("dominant-baseline","middle");Object.assign(t,{self:i,barRect:n,barLabel:s,barValue:c,isNew:!0,labelFullWidth:o,labelSmallWidth:l,labelFull:a,labelSmall:r})})},_getWidestLabelWidth:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=t?"labelFullWidth":"labelSmallWidth",i=t?"labelFull":"labelSmall",n=this.sortedEntities.reduce(function(t,i){return t[e]<i[e]?i:t}),a=n.barLabel.text(),r=n.barLabel.text(n[i]).node().getBBox().width;return n.barLabel.text(a),r},_drawColors:function(){var t=this,e=this;this.barContainer.selectAll(".vzb-br-bar>rect").each(function(t){var i=t.entity,n=d3.select(this),a=e.values.color[i];a||0===a?n.style("fill",e._getColor(a)).attr("stroke","transparent"):n.style("fill",m).attr("stroke",f)}),this.barContainer.selectAll(".vzb-br-bar>text").style("fill",function(e){var i=e.entity;return t._getDarkerColor(t.values.color[i])})},_getColor:function(t){return d3.rgb(this.cScale(t))},_getDarkerColor:function(t){return this._getColor(t).darker(2)},_scrollTopTween:function(t){return function(){var e=d3.interpolateNumber(this.scrollTop,t);return function(t){this.scrollTop=e(t)}}},_getBarPosition:function(t){return(this.activeProfile.barHeight+this.activeProfile.barMargin)*t},_entities:{},_sortByIndicator:function(t){var e=this;return Object.keys(t).map(function(i){var n,a=e._entities[i],s=t[i],o=e._formatter(s);return a?Object.assign(a,{value:s,formattedValue:o,changedValue:o!==a.formattedValue,changedWidth:s!==a.value,isNew:!1}):e._entities[i]=(n={entity:i,value:s,formattedValue:o},r(n,e.model.entities.dim,i),r(n,"changedValue",!0),r(n,"changedWidth",!0),r(n,"isNew",!0),n)}).sort(function(t,e){var i=t.value,n=e.value;return n-i}).map(function(t,e){return Object.assign(t,{index:e,changedIndex:e!==t.index})})},_selectBars:function(){var t=this,e=this.model.entities.dim,i=this.model.marker.select;this.barContainer.classed("vzb-dimmed-selected",!1),this.barContainer.selectAll(".vzb-br-bar.vzb-selected").classed("vzb-selected",!1),i.length&&(this.barContainer.classed("vzb-dimmed-selected",!0),i.forEach(function(i){t.barContainer.select("#vzb-br-bar-"+i[e]+"-"+t._id).classed("vzb-selected",!0)}))},_updateOpacity:function(){var t=this.model.marker,e=1,i=t.highlight,n=t.select,a=t.opacityHighlightDim,r=t.opacitySelectDim,s=t.opacityRegular,o=i.length>0,l=n.length>0;this.barContainer.selectAll(".vzb-br-bar").style("opacity",function(i){return o&&t.isHighlighted(i)?e:l?t.isSelected(i)?s:r:o?a:s})},_updateDoubtOpacity:function(t){this.dataWarningEl.style("opacity",t||(this.model.marker.select.length?1:this.wScale(+this.model.time.value.getUTCFullYear().toString())))}});e.default=p},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),s=a(r),o=i(2),l=n(o),c=i(223),h=n(c),u=i(222),d=n(u),f=i(137),m=n(f),p=i(86),g=n(p),v=i(40),b=n(v),y=i(66),x=n(y),_=i(10),M=l.default.extend({init:function(t,e){var n=this;this.name="bubblechart",this.template=i(449),this.model_expects=[{name:"time",type:"time"},{name:"entities",type:"entities"},{name:"marker",type:"model"},{name:"locale",type:"locale"},{name:"ui",type:"ui"}],this.model_binds={"change:time.playing":function(t,e){s.isTouchDevice()&&n.model.time.playing&&n.someHighlighted&&n.model.marker.clearHighlighted()},"change:time.start":function(t,e){"time"===n.model.marker.color.scaleType&&(n.model.marker.color.scale=null),n._readyOnce&&!n.model.time.splash&&n._trails.create().then(function(){n._trails.run(["findVisible","reveal","opacityHandler"])})},"change:time.end":function(t,e){n._readyOnce&&!n.model.time.splash&&n._trails.create().then(function(){n._trails.run(["findVisible","reveal","opacityHandler"])})},"change:time.record":function(){n.model.time.record?n._export.open(this.element,this.name):n._export.reset()},"change:ui.chart.trails":function(t){n._trails.toggle(n.model.ui.chart.trails),n.redrawDataPoints()},"change:ui.chart.lockNonSelected":function(t){n.redrawDataPoints(500)},"change:marker":function(t,e){if(n._readyOnce){if(e.indexOf("scaleType")>-1)return void n.ready();if(e.indexOf("marker.color")===-1&&e.indexOf("marker.size")===-1&&e.indexOf("marker.size_label")===-1){if(e.indexOf("domainMin")>-1||e.indexOf("domainMax")>-1){if(!n.yScale||!n.xScale)return;return n.updateSize(),n.updateMarkerSizeLimits(),n._trails.run("findVisible"),n.redrawDataPoints(),void n._trails.run("resize",null,500)}if(e.indexOf("zoomedMin")>-1||e.indexOf("zoomedMax")>-1){if(n.draggingNow)return;if(s.approxEqual(n._zoomedXYMinMax.axis_x.zoomedMin,n.model.marker.axis_x.zoomedMin,.01)&&s.approxEqual(n._zoomedXYMinMax.axis_x.zoomedMax,n.model.marker.axis_x.zoomedMax,.01)&&s.approxEqual(n._zoomedXYMinMax.axis_y.zoomedMin,n.model.marker.axis_y.zoomedMin,.01)&&s.approxEqual(n._zoomedXYMinMax.axis_y.zoomedMax,n.model.marker.axis_y.zoomedMax,.01))return;var i=!1;return n.model.time.playing&&(i=!0,n.model.time.pause(!0)),n._trails.run("abortAnimation"),n._panZoom.zoomToMaxMin(n.model.marker.axis_x.zoomedMin,n.model.marker.axis_x.zoomedMax,n.model.marker.axis_y.zoomedMin,n.model.marker.axis_y.zoomedMax,500,"don't feed these zoom values back to state"),void(i&&(n.model.time.postponePause=!1))}}}},"change:marker.select":function(t,e){n._readyOnce&&n.entityBubbles&&((t.source._val||[]).length-(t.source._previousVal||[]).length>50&&(n.model.ui.chart.trails=!1),n.selectDataPoints(),n.redrawDataPoints(),n._trails.create().then(function(){n._trails.run(["findVisible","reveal","opacityHandler"])}),n.updateBubbleOpacity(),n._updateDoubtOpacity())},"change:marker.highlight":function(t,e){if(n._readyOnce)if("highlight"==e)n.highlightDataPoints();else if(null!==e){var i=n._formatSTitleValues(e.size,e.color);n._updateSTitle(i[0],i[1])}else n._updateSTitle()},"change:time.value":function(){n._readyOnce&&n.entityBubbles&&(n.calculationQueue?n.calculationQueue.push(n.model.time.value.toString()):n.calculationQueue=[n.model.time.value.toString()],function(t){n.model.marker.getFrame(t,function(t,e){if(!n._frameIsValid(t))return s.warn("change:time.value: empty data received from marker.getFrame(). doing nothing");var i=n.calculationQueue.indexOf(e.toString());i!=-1&&(n.calculationQueue.splice(0,i+1),n.frameChanged(t,e))})}(n.model.time.value))},"change:ui.adaptMinMaxZoom":function(){n.model.ui.adaptMinMaxZoom?n._panZoom.expandCanvas(500):n._panZoom.reset()},"change:marker.size.extent":function(t,e){n._readyOnce&&(n.updateMarkerSizeLimits(),n.redrawDataPointsOnlySize(),n._trails.run("resize"))},"change:marker.color":function(t,e){n._readyOnce&&(n.redrawDataPointsOnlyColors(),n._trails.run("recolor"))},"change:marker.opacitySelectDim":function(){n.updateBubbleOpacity()},"change:marker.opacityRegular":function(){n.updateBubbleOpacity(),n._trails.run("opacityHandler")},"change:ui.cursorMode":function(){var t=n.element.select("svg");"plus"===n.model.ui.cursorMode?(t.classed("vzb-zoomin",!0),t.classed("vzb-zoomout",!1)):"minus"===n.model.ui.cursorMode?(t.classed("vzb-zoomin",!1),t.classed("vzb-zoomout",!0)):(t.classed("vzb-zoomin",!1),t.classed("vzb-zoomout",!1))},ready:function(){}},this._super(t,e),this.xScale=null,this.yScale=null,this.sScale=null,this.cScale=null,this.xAxis=(0,b.default)(),this.yAxis=(0,b.default)(),n.COLOR_BLACKISH="#333",n.COLOR_WHITEISH="#fdfdfd",this.isCanvasPreviouslyExpanded=!1,this.draggingNow=null,this._trails=new h.default(this),this._panZoom=new d.default(this),this._export=new m.default(this),this._export.prefix("vzb-bc-").deleteClasses(["vzb-bc-bubbles-crop","vzb-hidden","vzb-bc-year","vzb-bc-zoom-rect","vzb-bc-projection-x","vzb-bc-projection-y","vzb-bc-axis-c-title"]),this._labels=new g.default(this),this._labels.config({CSS_PREFIX:"vzb-bc",LABELS_CONTAINER_CLASS:"vzb-bc-labels",LINES_CONTAINER_CLASS:"vzb-bc-bubbles",LINES_CONTAINER_SELECTOR_PREFIX:"bubble-"})},_rangeBump:function(t,e){var i=this.activeProfile.maxRadius/2;if(e=e?-1:1,s.isArray(t)&&t.length>1){var n=t[0],a=t[t.length-1];return n<a?(n+=i*e,a-=i*e,n>a&&(n=a=(n+a)/2)):n>a?(n-=i*e,a+=i*e,n<a&&(n=a=(n+a)/2)):s.warn("rangeBump error: the input scale range has 0 length. that sucks"),[n,a]}s.warn("rangeBump error: input is not an array or empty")},readyOnce:function(){var t=this;this._readyOnce=!1,this.scrollableAncestor=s.findScrollableAncestor(this.element),this.element=d3.select(this.element),this.graph=this.element.select(".vzb-bc-graph"),this.yAxisElContainer=this.graph.select(".vzb-bc-axis-y"),this.yAxisEl=this.yAxisElContainer.select("g"),this.xAxisElContainer=this.graph.select(".vzb-bc-axis-x"),this.xAxisEl=this.xAxisElContainer.select("g"),this.yTitleEl=this.graph.select(".vzb-bc-axis-y-title"),this.xTitleEl=this.graph.select(".vzb-bc-axis-x-title"),this.sTitleEl=this.graph.select(".vzb-bc-axis-s-title"),this.cTitleEl=this.graph.select(".vzb-bc-axis-c-title"),this.yearEl=this.graph.select(".vzb-bc-year"),this.year=new x.default(this.yearEl),this.yInfoEl=this.graph.select(".vzb-bc-axis-y-info"),this.xInfoEl=this.graph.select(".vzb-bc-axis-x-info"),this.dataWarningEl=this.graph.select(".vzb-data-warning"),this.projectionX=this.graph.select(".vzb-bc-projection-x"),this.projectionY=this.graph.select(".vzb-bc-projection-y"),this.lineEqualXY=this.graph.select(".vzb-bc-line-equal-xy"),this.trailsContainer=this.graph.select(".vzb-bc-trails"),this.bubbleContainerCrop=this.graph.select(".vzb-bc-bubbles-crop"),this.labelsContainerCrop=this.graph.select(".vzb-bc-labels-crop"),this.bubbleContainer=this.graph.select(".vzb-bc-bubbles"),this.labelsContainer=this.graph.select(".vzb-bc-labels"),this.linesContainer=this.graph.select(".vzb-bc-lines"),this.zoomRect=this.element.select(".vzb-bc-zoom-rect"),this.eventArea=this.element.select(".vzb-bc-eventarea"),this.entityBubbles=null,this.bubbleCrown=this.element.select(".vzb-bc-bubble-crown"),this.bubbleCrown.selectAll(".vzb-crown-glow").attr("filter","url("+location.pathname+"#vzb-glow-filter)"),this.tooltip=this.element.select(".vzb-bc-tooltip"),this.tooltip.select(".vzb-tooltip-glow").attr("filter","url("+location.pathname+"#vzb-glow-filter)"),this.tooltipMobile=this.element.select(".vzb-tooltip-mobile"),this.on("resize",function(){t._trails.run("abortAnimation"),t.updateSize()||(t.updateMarkerSizeLimits(),t._labels.updateSize(),function(e,i,n,a){t._panZoom.zoomer.dontFeedToState=!0,t._panZoom.rerun(),t._panZoom.zoomToMaxMin(e,i,n,a,0,!0)}(t._zoomedXYMinMax.axis_x.zoomedMin,t._zoomedXYMinMax.axis_x.zoomedMax,t._zoomedXYMinMax.axis_y.zoomedMin,t._zoomedXYMinMax.axis_y.zoomedMax))}),d3.select("body").on("keydown",function(){"arrow"===t.model.ui.cursorMode&&(d3.event.metaKey||d3.event.ctrlKey)&&t.element.select("svg").classed("vzb-zoomin",!0)}).on("keyup",function(){"arrow"===t.model.ui.cursorMode&&(d3.event.metaKey||d3.event.ctrlKey||t.element.select("svg").classed("vzb-zoomin",!1))}).on("mouseenter",function(){"arrow"===t.model.ui.cursorMode&&(d3.event.metaKey||d3.event.ctrlKey||t.element.select("svg").classed("vzb-zoomin",!1))}),this.root.on("resetZoom",function(){t._panZoom.reset(null,500)}),this.bubbleContainerCrop.call(this._panZoom.zoomer).call(this._panZoom.dragRectangle).on("dblclick.zoom",null).on("mouseup",function(){t.draggingNow=!1}).on("click",function(){var e=t.model.ui.cursorMode;d3.event.defaultPrevented||"arrow"===e||t._panZoom.zoomByIncrement(e,500)}),this.KEY=this.model.entities.getDimension(),this.TIMEDIM=this.model.time.getDimension(),this.updateUIStrings(),this.wScale=d3.scale.linear().domain(this.model.ui.datawarning.doubtDomain).range(this.model.ui.datawarning.doubtRange),this._labels.readyOnce(),t._readyOnce=!0},_frameIsValid:function(t){return!(!t||0===Object.keys(t.axis_y).length||0===Object.keys(t.axis_x).length||0===Object.keys(t.size).length)},ready:function(){var t=this;this.updateUIStrings();this.model.time.end;this.updateIndicators(),this.updateTime(),t.model.time.splash||t._trails.create(),this.model.marker.getFrame(this.model.time.value,function(e,i){return i.toString()!=t.model.time.value.toString()?void s.defer(function(){t.ready()}):t._frameIsValid(e)?(t.frame=e,t.updateSize(),t.updateMarkerSizeLimits(),t.updateEntities(),t._labels.ready(),t.redrawDataPoints(),t.selectDataPoints(),t.updateBubbleOpacity(),t._updateDoubtOpacity(),t.zoomToMarkerMaxMin(),t.model.time.splash||t._trails.run(["findVisible","reveal","opacityHandler"]),void(t.model.ui.adaptMinMaxZoom&&t._panZoom.expandCanvas())):s.warn("ready: empty data received from marker.getFrame(). doing nothing")})},zoomToMarkerMaxMin:function(){this._panZoom.resetZoomState();var t=this.model.marker.axis_x,e=this.model.marker.axis_y,i=t.getScale().domain(),n=e.getScale().domain(),a=t.zoomedMin?t.zoomedMin:i[0],r=t.zoomedMax?t.zoomedMax:i[1],s=e.zoomedMin?e.zoomedMin:n[0],o=e.zoomedMax?e.zoomedMax:n[1];this._panZoom.zoomToMaxMin(a,r,s,o,0,"don't feed these zoom values back to state")},updateIndicators:function(){var t=this;this.yScale=this.model.marker.axis_y.getScale(),this.xScale=this.model.marker.axis_x.getScale(),this.sScale=this.model.marker.size.getScale(),this.cScale=this.model.marker.color.getScale(),this._labels.setScales(this.xScale,this.yScale),this.yAxis.tickFormat(t.model.marker.axis_y.getTickFormatter()),this.xAxis.tickFormat(t.model.marker.axis_x.getTickFormatter())},frameChanged:function(t,e){this.frame=t,this.updateTime(),this._updateDoubtOpacity(),this._trails.run("findVisible"),this.model.ui.adaptMinMaxZoom?this._panZoom.expandCanvas():this.redrawDataPoints(),this._trails.run("reveal",null,this.duration),this.tooltipMobile.classed("vzb-hidden",!0),this._reorderEntities()},updateUIStrings:function(){var t=this,e=t.model.marker.axis_y.getConceptprops(),i=t.model.marker.axis_x.getConceptprops(),n=t.model.marker.size.getConceptprops(),a=t.model.marker.color.getConceptprops();this.translator=this.model.locale.getTFunction(),
this.strings={title:{Y:e.name,X:i.name,S:n.name,C:a.name},unit:{Y:e.unit||"",X:i.unit||"",S:n.unit||"",C:a.unit||""}};var r=this.yTitleEl.selectAll("text").data([0]);r.enter().append("text"),r.on("click",function(){t.parent.findChildByName("gapminder-treemenu").markerID("axis_y").alignX(t.model.locale.isRTL()?"right":"left").alignY("top").updateView().toggle()});var o=this.xTitleEl.selectAll("text").data([0]);o.enter().append("text"),o.on("click",function(){t.parent.findChildByName("gapminder-treemenu").markerID("axis_x").alignX(t.model.locale.isRTL()?"right":"left").alignY("bottom").updateView().toggle()});var l=this.sTitleEl.selectAll("text").data([0]);l.enter().append("text"),l.attr("text-anchor","end"),s.setIcon(this.dataWarningEl,_.warn).select("svg").attr("width","0px").attr("height","0px"),this.dataWarningEl.append("text").attr("text-anchor","end").text(this.translator("hints/dataWarning")),s.setIcon(this.yInfoEl,_.question).select("svg").attr("width","0px").attr("height","0px"),s.setIcon(this.xInfoEl,_.question).select("svg").attr("width","0px").attr("height","0px"),this.yInfoEl.on("click",function(){t.parent.findChildByName("gapminder-datanotes").pin()}),this.yInfoEl.on("mouseover",function(){var e=this.getBBox(),i=s.makeAbsoluteContext(this,this.farthestViewportElement)(e.x-10,e.y+e.height+10),n=t.root.element.getBoundingClientRect(),a=t.element.node().getBoundingClientRect();t.parent.findChildByName("gapminder-datanotes").setHook("axis_y").show().setPos(i.x+a.left-n.left,i.y)}),this.yInfoEl.on("mouseout",function(){t.parent.findChildByName("gapminder-datanotes").hide()}),this.xInfoEl.on("click",function(){t.parent.findChildByName("gapminder-datanotes").pin()}),this.xInfoEl.on("mouseover",function(){if(!t.model.time.dragging){var e=this.getBBox(),i=s.makeAbsoluteContext(this,this.farthestViewportElement)(e.x-10,e.y+e.height+10),n=t.root.element.getBoundingClientRect(),a=t.element.node().getBoundingClientRect();t.parent.findChildByName("gapminder-datanotes").setHook("axis_x").show().setPos(i.x+a.left-n.left,i.y)}}),this.xInfoEl.on("mouseout",function(){t.model.time.dragging||t.parent.findChildByName("gapminder-datanotes").hide()}),this.dataWarningEl.on("click",function(){t.parent.findChildByName("gapminder-datawarning").toggle()}).on("mouseover",function(){t._updateDoubtOpacity(1)}).on("mouseout",function(){t._updateDoubtOpacity()})},_updateDoubtOpacity:function(t){null==t&&(t=this.wScale(+this.model.time.formatDate(this.time))),this.someSelected&&(t=1),this.dataWarningEl.style("opacity",t)},updateEntities:function(){var t=this,e=this.KEY,i=this.TIMEDIM,n=function(n){return n=n||"",t.model.marker.getKeys().map(function(r){var s={};return s[e]=r[e],s[i]=a,s.sortValue=t.frame.size[r[e]]||0,s[e]=n+r[e],s}).sort(function(t,e){return e.sortValue-t.sortValue})},a=this.model.time.end,r=n.call(this);this.model.marker.setVisible(r),this.model.time.splash||this.unselectBubblesWithNoData(r),this.entityBubbles=this.bubbleContainer.selectAll("circle.vzb-bc-entity").data(this.model.marker.getVisible(),function(t){return t[e]}),this.entityBubbles.exit().remove(),this.entityBubbles.enter().append("circle").attr("class",function(t){return"vzb-bc-entity bubble-"+t[e]}).on("mouseover",function(e,i){s.isTouchDevice()||"arrow"!==t.model.ui.cursorMode||t._bubblesInteract().mouseover(e,i)}).on("mouseout",function(e,i){s.isTouchDevice()||"arrow"!==t.model.ui.cursorMode||t._bubblesInteract().mouseout(e,i)}).on("click",function(e,i){s.isTouchDevice()||"arrow"!==t.model.ui.cursorMode||t._bubblesInteract().click(e,i)}).onTap(function(e,i){d3.event.stopPropagation(),t._bubblesInteract().click(e,i)}).onLongTap(function(t,e){}),this._reorderEntities()},unselectBubblesWithNoData:function(t){var e=this,i=this.KEY;if(this.model.marker.select.length){var n=[],a=t.map(function(t){return t[i]});this.model.marker.select.forEach(function(t){a.indexOf(t[i])!==-1&&n.push(t)}),n.length!==e.model.marker.select.length&&(e.model.marker.select=n)}},_reorderEntities:function(){var t=this,e=this.KEY;this.bubbleContainer.selectAll(".vzb-bc-entity").sort(function(i,n){var a=t.frame.size[i[e]],r=t.frame.size[n[e]];return"undefined"==typeof a&&"undefined"!=typeof r?-1:"undefined"!=typeof a&&"undefined"==typeof r?1:a!=r?d3.descending(a,r):i[e]!=n[e]?d3.ascending(i[e],n[e]):"undefined"!=typeof i.trailStartTime||"undefined"!=typeof n.trailStartTime?"undefined"!=typeof i.trailStartTime?-1:1:"undefined"!=typeof i.limits||"undefined"!=typeof n.limits?"undefined"!=typeof i.limits?-1:1:d3.descending(a,r)})},_bubblesInteract:function(){var t=this;this.KEY,this.TIMEDIM;return{mouseover:function(e,i){t.model.marker.highlightMarker(e),t._labels.showCloseCross(e,!0)},mouseout:function(e,i){t.model.marker.clearHighlighted(),t._labels.showCloseCross(e,!1)},click:function(e,i){if(!t.draggingNow){var n=t.model.marker.isSelected(e);t.model.marker.selectMarker(e),s.isTouchDevice()||(n&&t.model.marker.highlightMarker(e),t.highlightDataPoints())}}}},updateTime:function(){this.time_1=null==this.time?this.model.time.value:this.time,this.time=this.model.time.value,this.duration=this.model.time.playing&&this.time-this.time_1>0?this.model.time.delayAnimations:0,this.year.setText(this.model.time.formatDate(this.time,"ui"),this.duration)},updateSize:function(){var t={small:{margin:{top:30,right:10,left:40,bottom:35},padding:2,minRadius:.5,maxRadius:30,infoElHeight:16,yAxisTitleBottomMargin:6,xAxisTitleBottomMargin:4},medium:{margin:{top:40,right:15,left:60,bottom:55},padding:2,minRadius:1,maxRadius:55,infoElHeight:20,yAxisTitleBottomMargin:6,xAxisTitleBottomMargin:5},large:{margin:{top:50,right:20,left:60,bottom:60},padding:2,minRadius:1,maxRadius:65,infoElHeight:22,yAxisTitleBottomMargin:6,xAxisTitleBottomMargin:5,hideSTitle:!0}},e={medium:{margin:{top:80,bottom:80,left:100},yAxisTitleBottomMargin:20,xAxisTitleBottomMargin:20,infoElHeight:26},large:{margin:{top:80,bottom:100,left:100},yAxisTitleBottomMargin:20,xAxisTitleBottomMargin:20,infoElHeight:32,hideSTitle:!0}},i=this;this.activeProfile=this.getActiveProfile(t,e);var n=this.activeProfile.margin,a=this.activeProfile.infoElHeight;if(i._labels.setCloseCrossHeight(1.2*i.activeProfile.infoElHeight),this.height=parseInt(this.element.style("height"),10)-n.top-n.bottom||0,this.width=parseInt(this.element.style("width"),10)-n.left-n.right||0,this.height<=0||this.width<=0)return s.warn("Bubble chart updateSize() abort: vizabi container is too little or has display:none");this.graph.attr("transform","translate("+n.left+","+n.top+")"),this.year.resize(this.width,this.height),this.eventArea.attr("width",this.width).attr("height",Math.max(0,this.height)),"ordinal"!==this.model.marker.axis_y.scaleType?this.yScale.range(this._rangeBump([this.height,0])):this.yScale.rangePoints([this.height,0],i.activeProfile.padding).range(),"ordinal"!==this.model.marker.axis_x.scaleType?this.xScale.range(this._rangeBump([0,this.width])):this.xScale.rangePoints([0,this.width],i.activeProfile.padding).range(),this.yAxis.scale(this.yScale).orient("left").tickSize(-this.width,0).tickPadding(6).tickSizeMinor(-this.width,0).labelerOptions({scaleType:this.model.marker.axis_y.scaleType,toolMargin:n,limitMaxTickNumber:6,bump:this.activeProfile.maxRadius/2,viewportLength:this.height,formatter:this.model.marker.axis_y.getTickFormatter()}),this.xAxis.scale(this.xScale).orient("bottom").tickSize(-this.height,0).tickPadding(6).tickSizeMinor(-this.height,0).labelerOptions({scaleType:this.model.marker.axis_x.scaleType,toolMargin:n,bump:this.activeProfile.maxRadius/2,viewportLength:this.width,formatter:this.model.marker.axis_x.getTickFormatter()}),this.bubbleContainerCrop.attr("width",this.width).attr("height",Math.max(0,this.height)),this.labelsContainerCrop.attr("width",this.width).attr("height",Math.max(0,this.height)),this.xAxisElContainer.attr("width",this.width+1).attr("height",this.activeProfile.margin.bottom+this.height).attr("y",-1).attr("x",-1),this.xAxisEl.attr("transform","translate(1,"+(1+this.height)+")"),this.yAxisElContainer.attr("width",this.activeProfile.margin.left+this.width).attr("height",Math.max(0,this.height)).attr("x",-this.activeProfile.margin.left),this.yAxisEl.attr("transform","translate("+(this.activeProfile.margin.left-1)+",0)"),this.yAxisEl.call(this.yAxis),this.xAxisEl.call(this.xAxis),this.projectionX.attr("y1",i.yScale.range()[0]+this.activeProfile.maxRadius/2),this.projectionY.attr("x2",i.xScale.range()[0]-this.activeProfile.maxRadius/2),this._updateSTitle(),this.sTitleEl.attr("transform","translate("+this.width+",20) rotate(-90)");var r=this.model.locale.isRTL();this.yTitleEl.style("font-size",a+"px").attr("transform","translate("+(r?this.width:10-this.activeProfile.margin.left)+", -"+this.activeProfile.yAxisTitleBottomMargin+")"),this.xTitleEl.style("font-size",a+"px").attr("transform","translate("+(r?this.width:0)+","+(this.height+n.bottom-this.activeProfile.xAxisTitleBottomMargin)+")");var o=this.strings.unit.Y?", ":"",l=this.yTitleEl.select("text").text(this.strings.title.Y+o+this.strings.unit.Y);l.node().getBBox().width>this.width&&l.text(this.strings.title.Y);var c=this.strings.unit.Y?", ":"",h=this.xTitleEl.select("text").text(this.strings.title.X+c+this.strings.unit.X);if(h.node().getBBox().width>this.width-100&&h.text(this.strings.title.X),this.yInfoEl.select("svg").node()){var u=this.yTitleEl.node().getBBox(),d=d3.transform(this.yTitleEl.attr("transform")).translate,f=r?u.x+d[0]-1.4*a:u.x+d[0]+u.width+.4*a;this.yInfoEl.select("svg").attr("width",a+"px").attr("height",a+"px"),this.yInfoEl.attr("transform","translate("+f+","+(d[1]-.8*a)+")")}if(this.xInfoEl.select("svg").node()){var u=this.xTitleEl.node().getBBox(),d=d3.transform(this.xTitleEl.attr("transform")).translate,f=r?u.x+d[0]-1.4*a:u.x+d[0]+u.width+.4*a;this.xInfoEl.select("svg").attr("width",a+"px").attr("height",a+"px"),this.xInfoEl.attr("transform","translate("+f+","+(d[1]-.8*a)+")")}this._resizeDataWarning()},_updateLineEqualXY:function(t){var e=this.model.marker.axis_x.which==this.model.marker.axis_y.which;if(this.lineEqualXY.classed("vzb-invisible",!e),e){var i=d3.min(this.yScale.domain().concat(this.xScale.domain())),n=d3.max(this.yScale.domain().concat(this.xScale.domain()));this.lineEqualXY.transition().duration(t||0).attr("y1",this.yScale(i)).attr("y2",this.yScale(n)).attr("x1",this.xScale(i)).attr("x2",this.xScale(n))}},_resizeDataWarning:function(){var t=this.dataWarningEl.select("text").style("font-size",null),e=t.node().getBBox().width+3*t.node().getBBox().height,i=this.width-this.xTitleEl.node().getBBox().width-this.activeProfile.infoElHeight,n=parseInt(t.style("font-size"))*i/e;t.style("font-size",e>i?n+"px":null);var a=t.node().getBBox();this.dataWarningEl.select("svg").attr("width",.75*a.height).attr("height",.75*a.height).attr("x",-a.width-1.2*a.height).attr("y",.65*-a.height),this.dataWarningEl.attr("transform","translate("+(this.model.locale.isRTL()?a.width+a.height:this.width)+","+(this.height+this.activeProfile.margin.bottom-this.activeProfile.xAxisTitleBottomMargin)+")")},updateMarkerSizeLimits:function(){var t=this,e=this.model.marker.size.extent||[0,1];if(!this.activeProfile)return s.warn("updateMarkerSizeLimits() is called before ready(). This can happen if events get unfrozen and getFrame() still didn't return data");var i=this.activeProfile.minRadius,n=this.activeProfile.maxRadius;this.minRadius=Math.max(n*e[0],i),this.maxRadius=Math.max(n*e[1],i),"ordinal"!==this.model.marker.size.scaleType?this.sScale.range([s.radiusToArea(t.minRadius),s.radiusToArea(t.maxRadius)]):this.sScale.rangePoints([s.radiusToArea(t.minRadius),s.radiusToArea(t.maxRadius)],t.activeProfile.padding).range()},redrawDataPointsOnlyColors:function(){var t=this;if(!this.entityBubbles)return s.warn("redrawDataPointsOnlyColors(): no entityBubbles defined. likely a premature call, fix it!");var e,i=this.KEY,n=this.model.time.value;this.model.ui.chart.lockNonSelected&&this.someSelected&&(n=this.model.time.parse(""+this.model.ui.chart.lockNonSelected)),this.model.marker.getFrame(n,function(n){return t._frameIsValid(n)?(e=t.frame,void t.entityBubbles.each(function(a,r){var o=t.model.marker.isSelected(a),l=o?e.color[a[i]]:n.color[a[i]],c=null!=l?t.cScale(l):t.COLOR_WHITEISH;if(d3.select(this).style("fill",c),o){var h=s.find(t.model.marker.select,function(t){return t[i]==a[i]}),u=t.model.time.parse(""+h.trailStartTime);t.model.marker.getFrame(u,function(e){if(!e)return s.warn("redrawDataPointsOnlyColor: empty data received from marker.getFrames(). doing nothing");var n={};if(t.model.ui.chart.trails&&u-t.time!=0){var o=e.color[a[i]];n.scaledC0=null!=o?t.cScale(o):t.COLOR_WHITEISH}else n.scaledC0=c;t._labels.updateLabelOnlyColor(a,r,n)})}})):s.warn("redrawDataPointsOnlyColor: empty data received from marker.getFrame(). doing nothing")})},redrawDataPointsOnlySize:function(){var t,e=this,i=this.KEY,n=this.model.time.value;this.model.ui.chart.lockNonSelected&&this.someSelected&&(n=this.model.time.parse(""+this.model.ui.chart.lockNonSelected)),this.model.marker.getFrame(n,function(n){return e._frameIsValid(n)?(t=e.frame,void e.entityBubbles.each(function(a,r){var o=e.model.marker.isSelected(a),l=o?t.size[a[i]]:n.size[a[i]];if(null!=l){var c=s.areaToRadius(e.sScale(l));if(d3.select(this).attr("r",c),o){var h=s.find(e.model.marker.select,function(t){return t[i]==a[i]}),u=e.model.time.parse(""+h.trailStartTime);e.model.marker.getFrame(u,function(t){if(!t)return s.warn("redrawDataPointsOnlySize: empty data received from marker.getFrames(). doing nothing");var n={};e.model.ui.chart.trails&&u-e.time!=0?n.scaledS0=s.areaToRadius(e.sScale(t.size[a[i]])):n.scaledS0=c,e._labels.updateLabelOnlyPosition(a,r,n)})}}})):s.warn("redrawDataPointsOnlySize: empty data received from marker.getFrame(). doing nothing")})},redrawDataPoints:function(t){var e=this;this.KEY;if(null==t&&(t=e.duration),this.model.ui.chart.lockNonSelected&&this.someSelected){var i=this.model.time.parse(""+this.model.ui.chart.lockNonSelected);this.model.marker.getFrame(i,function(i){return i?void e.entityBubbles.each(function(n,a){var r=e.model.marker.isSelected(n)?e.frame:i;e._updateBubble(n,r,a,d3.select(this),t)}):s.warn("redrawDataPoints: empty data received from marker.getFrames(). doing nothing")})}else e.entityBubbles.each(function(i,n){e._updateBubble(i,e.frame,n,d3.select(this),t)});this._updateLineEqualXY(t)},_updateBubble:function(t,e,i,n,a){var r=this,o=this.KEY,l=!1,c=e.axis_y[t[o]],h=e.axis_x[t[o]],u=e.size[t[o]],d=e.label[t[o]],f=e.color[t[o]],m=e.size_label[t[o]];if(!d&&0!==d||!c&&0!==c||!h&&0!==h||!u&&0!==u){if(t.hidden||(t.hidden=!0,l=!0),l)if(a){var p=n.style("opacity");n.transition().duration(a).ease("exp").style("opacity",0).each("end",function(){n.classed("vzb-invisible",t.hidden),n.style("opacity",p)})}else n.classed("vzb-invisible",t.hidden)}else{(t.hidden||n.classed("vzb-invisible"))&&(t.hidden=!1,l=!0);var g=s.areaToRadius(r.sScale(u));if(n.style("fill",null!=f?r.cScale(f):r.COLOR_WHITEISH),a)if(l){var p=n.style("opacity");n.classed("vzb-invisible",t.hidden),n.style("opacity",0).attr("cy",r.yScale(c)).attr("cx",r.xScale(h)).attr("r",g).transition().duration(a).ease("exp").style("opacity",p)}else n.transition().duration(a).ease("linear").attr("cy",r.yScale(c)).attr("cx",r.xScale(h)).attr("r",g);else n.interrupt().attr("cy",r.yScale(c)).attr("cx",r.xScale(h)).attr("r",g).transition(),l&&n.classed("vzb-invisible",t.hidden);this.model.time.record&&r._export.write({type:"circle",id:t[o],time:this.model.time.value.getUTCFullYear(),fill:null!=f?r.cScale(f):r.COLOR_WHITEISH,cx:r.xScale(h),cy:r.yScale(c),r:g})}r._updateLabel(t,i,h,c,u,f,d,m,a,l)},_updateLabel:function(t,e,i,n,a,r,o,l,c,h){var u=this,d=this.KEY;if(u.model.marker.isSelected(t)){var f={},m=s.find(u.model.marker.select,function(e){return e[d]==t[d]}),p=u.model.time.formatDate(u.time);this.model.ui.chart.trails&&m.trailStartTime!=p&&null!=m.trailStartTime||(this.model.ui.chart.trails&&null==m.trailStartTime&&(m.trailStartTime=p),f.labelX0=i,f.labelY0=n,f.scaledC0=null!=r?u.cScale(r):u.COLOR_WHITEISH,f.scaledS0=a||0===a?s.areaToRadius(u.sScale(a)):null);var g=u.model.time.parse(""+m.trailStartTime),v=o+(u.model.ui.chart.trails?" "+m.trailStartTime:"");h&&t.hidden&&u.model.ui.chart.trails&&g&&g<u.time&&(h=!1),t.hidden&&!u.model.ui.chart.trails&&(h=!0),this._labels.updateLabel(t,e,f,i,n,a,r,v,l,c,h)}},_formatSTitleValues:function(t,e){var i=this.strings.unit.S,n=this.strings.unit.C,a=this.model.marker.size.getTickFormatter(),r=this.model.marker.color.getTickFormatter();return this.model.marker.color.isDiscrete()&&"constant"!==this.model.marker.color.use&&e&&this.model.marker.color.getColorlegendMarker()&&(e=this.model.marker.color.getColorlegendMarker().label.getItems()[e]||""),[a(t)+" "+i,e||0===e?r(e)+" "+n:this.translator("hints/nodata")]},_updateSTitle:function(t,e){if(this.activeProfile.hideSTitle&&this.model.ui.dialogs.sidebar.indexOf("colors")>-1&&this.model.ui.dialogs.sidebar.indexOf("size")>-1)return void this.sTitleEl.classed("vzb-invisible",!0);this.sTitleEl.classed("vzb-invisible")&&this.sTitleEl.classed("vzb-invisible",!1);var i="constant"!==this.model.marker.size.use,n="constant"!==this.model.marker.color.use,a=this.sTitleEl.select("text").style("font-size",null).text((i?this.translator("buttons/size")+": "+(t?t:this.strings.title.S):"")+(i&&n?", ":"")+(n?this.translator("buttons/colors")+": "+(e?e:this.strings.title.C):"")),r=a.node().getBBox().width,s=this.height-30,o=parseInt(a.style("font-size"))*s/r;a.style("font-size",r>s?o+"px":null)},selectDataPoints:function(){var t=this;this.KEY;s.isTouchDevice()?(t.model.marker.clearHighlighted(),t._labels.showCloseCross(null,!1)):(t._setTooltip(),t._setBubbleCrown()),t.someSelected=t.model.marker.select.length>0,t.nonSelectedOpacityZero=!1},_setBubbleCrown:function(t,e,i,n,a){null!=t?(this.bubbleCrown.classed("vzb-hidden",!1),this.bubbleCrown.select(".vzb-crown").attr("cx",t).attr("cy",e).attr("r",i).attr("fill",a?"none":n),this.bubbleCrown.selectAll(".vzb-crown-glow").attr("cx",t).attr("cy",e).attr("r",i+10).attr("stroke",n)):this.bubbleCrown.classed("vzb-hidden",!0)},_setTooltip:function(t,e,i,n,a){if(t){var r,s,o=-1,l=-1,c=0,h=0;n&&(c=.71*n,h=.71*n),this.tooltip.classed("vzb-hidden",!1).selectAll("text").text(t);var u=this.tooltip.select("text")[0][0].getBBox();e-c-u.width<0?(o=1,e+=u.width+5):e-=5,i-h-u.height<0?(l=1,i+=u.height):i-=11,n?(r=e+c*o,s=i+h*l):(r=e+c*o,s=i+h*l),this.tooltip.attr("transform","translate("+r+","+s+")"),this.tooltip.selectAll("rect").attr("width",u.width+8).attr("height",1.2*u.height).attr("x",-u.width-4).attr("y",.85*-u.height).attr("rx",.2*u.height).attr("ry",.2*u.height),this.tooltip.select(".vzb-tooltip-glow").attr("stroke",a)}else this.tooltip.classed("vzb-hidden",!0)},_axisProjections:function(t){var e=this,i=this.TIMEDIM,n=this.KEY;null!=t?this.model.marker.getFrame(t[i],function(i){var a=i.axis_y[t[n]],r=i.axis_x[t[n]],o=i.size[t[n]],l=s.areaToRadius(e.sScale(o));!a&&0!==a||!r&&0!==r||!o&&0!==o||(e.model.ui.chart.whenHovering.showProjectionLineX&&e.xScale(r)>0&&e.xScale(r)<e.width&&e.yScale(a)+l<e.height&&e.projectionX.style("opacity",1).attr("y2",e.yScale(a)+l).attr("x1",e.xScale(r)).attr("x2",e.xScale(r)),e.model.ui.chart.whenHovering.showProjectionLineY&&e.yScale(a)>0&&e.yScale(a)<e.height&&e.xScale(r)-l>0&&e.projectionY.style("opacity",1).attr("y1",e.yScale(a)).attr("y2",e.yScale(a)).attr("x1",e.xScale(r)-l),e.model.ui.chart.whenHovering.higlightValueX&&e.xAxisEl.call(e.xAxis.highlightValue(r)),e.model.ui.chart.whenHovering.higlightValueY&&e.yAxisEl.call(e.yAxis.highlightValue(a)))}):(this.projectionX.style("opacity",0),this.projectionY.style("opacity",0),this.xAxisEl.call(this.xAxis.highlightValue("none")),this.yAxisEl.call(this.yAxis.highlightValue("none")))},highlightDataPoints:function(){var t=this,e=this.TIMEDIM,i=this.KEY;if(this.someHighlighted=this.model.marker.highlight.length>0,this.updateBubbleOpacity(),1===this.model.marker.highlight.length){var n=s.clone(this.model.marker.highlight[0]);t.model.ui.chart.lockNonSelected&&t.someSelected&&!t.model.marker.isSelected(n)?n[e]=t.model.time.parse(""+t.model.ui.chart.lockNonSelected):n[e]=t.model.time.parse(""+n.trailStartTime)||t.time,t.model.marker.getFrame(n[e],function(a){if(a){var r=t.xScale(a.axis_x[n[i]]),o=t.yScale(a.axis_y[n[i]]),l=s.areaToRadius(t.sScale(a.size[n[i]])),c=null!=a.color[n[i]]?t.cScale(a.color[n[i]]):t.COLOR_WHITEISH,h=!1,u=t._formatSTitleValues(a.size[n[i]],a.color[n[i]]);t._updateSTitle(u[0],u[1]),(r+l<0||r-l>t.width||o+l<0||o-l>t.height)&&(h=!0);var d="",f=!1;if(t.model.marker.isSelected(n)&&t.model.ui.chart.trails){d=t.model.time.formatDate(t.time);var m=s.find(t.model.marker.select,function(t){return t[i]==n[i]});f=d!==m.trailStartTime&&!d3.select(d3.event.target).classed("bubble-"+n[i]),d=d!==m.trailStartTime&&t.time===n[e]?d:""}else d=t.model.marker.isSelected(n)?"":a.label[n[i]];if(t._labels.highlight(null,!1),t._labels.highlight(n,!0),t.model.marker.isSelected(n)){var p=!n.trailStartTime||n.trailStartTime==t.model.time.formatDate(t.time);t._setBubbleCrown(r,o,l,c,p)}h||f||t._axisProjections(n),!d||h||f||t._setTooltip(d,r,o,l+3,c);var m=s.find(t.model.marker.select,function(t){return t[i]==n[i]});if(m){var g=s.clone(m);g.opacity=1,t._trails.run(["opacityHandler"],g)}}})}else this._axisProjections(),this._trails.run(["opacityHandler"]),t._updateSTitle(),this._setTooltip(),this._setBubbleCrown(),this._labels.highlight(null,!1)},updateBubbleOpacity:function(t){var e=this,i=1,n=this.model.marker.opacityHighlightDim,a=this.model.marker.opacityRegular,r=this.model.marker.opacityRegular,s=this.model.marker.opacitySelectDim;this.entityBubbles.style("opacity",function(t){return e.someHighlighted&&e.model.marker.isHighlighted(t)?i:e.someSelected?e.model.marker.isSelected(t)?a:s:e.someHighlighted?n:r});var o=e.model.marker.opacitySelectDim<.01;o!=this.nonSelectedOpacityZero&&this.entityBubbles.style("pointer-events",function(t){return e.someSelected&&o&&!e.model.marker.isSelected(t)?"none":"visible"}),this.nonSelectedOpacityZero=e.model.marker.opacitySelectDim<.01}});e.default=M},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),s=a(r),o=i(21),l=n(o);e.default=l.default.extend({init:function(t){this.context=t,this.dragRectangle=d3.behavior.drag(),this.zoomer=d3.behavior.zoom(),this.dragLock=!1,this.dragRectangle.on("dragstart",this.drag().start).on("drag",this.drag().go).on("dragend",this.drag().stop),this.zoomer.on("zoomstart",this.zoom().start).on("zoom",this.zoom().go).on("zoomend",this.zoom().stop),this.zoomer.ratioX=1,this.zoomer.ratioY=1,t._zoomedXYMinMax={axis_x:{zoomedMin:null,zoomedMax:null},axis_y:{zoomedMin:null,zoomedMax:null}}},drag:function(){var t=this.context,e=this;return{start:function(i,n){!d3.event.sourceEvent.ctrlKey&&!d3.event.sourceEvent.metaKey&&"plus"!==t.ui.cursorMode||("touchmove"===d3.event.sourceEvent.type||"touchstart"===d3.event.sourceEvent.type)&&(d3.event.sourceEvent.touches.length>1||d3.event.sourceEvent.targetTouches.length>1)||(e.dragLock=!0,this.origin={x:d3.mouse(this)[0],y:d3.mouse(this)[1]},t.zoomRect.classed("vzb-invisible",!1))},go:function(i,n){if(!e.dragLock||("touchmove"===d3.event.sourceEvent.type||"touchstart"===d3.event.sourceEvent.type)&&(d3.event.sourceEvent.touches.length>1||d3.event.sourceEvent.targetTouches.length>1))return e.dragLock=!1,void t.zoomRect.attr("width",0).attr("height",0).classed("vzb-invisible",!0);var a=this.origin,r={x:d3.event.x,y:d3.event.y};t.zoomRect.attr("x",Math.min(r.x,a.x)).attr("y",Math.min(r.y,a.y)).attr("width",Math.abs(r.x-a.x)).attr("height",Math.abs(r.y-a.y))},stop:function(i){if(e.dragLock&&(e.dragLock=!1,t.zoomRect.attr("width",0).attr("height",0).classed("vzb-invisible",!0),this.target={x:d3.mouse(this)[0],y:d3.mouse(this)[1]},!(Math.abs(this.origin.x-this.target.x)<10||Math.abs(this.origin.y-this.target.y)<10))){var n=d3.event.sourceEvent.ctrlKey||d3.event.sourceEvent.metaKey||"plus"===t.ui.cursorMode;e._zoomOnRectangle(d3.select(this),this.origin.x,this.origin.y,this.target.x,this.target.y,n,500)}}}},zoom:function(){var t=this.context,e=this.zoomer,i=this;return{start:function(){this.savedScale=e.scale()},go:function(){var n=d3.event.sourceEvent;if((null==n||!n.ctrlKey&&!n.metaKey)&&(null===n||"touchmove"!==n.type&&"touchstart"!==n.type||!(n.touches.length>1||n.targetTouches.length>1)||(i.dragLock=!1),!i.dragLock)){if(null!=n&&("wheel"===n.type||"mousewheel"===n.type)&&!t.ui.zoomOnScrolling)return t.scrollableAncestor&&(t.scrollableAncestor.scrollTop+=n.deltaY||-n.wheelDelta),d3.event.scale=null,e.scale(this.savedScale),void(this.quitZoom=!0);this.quitZoom=!1,t.model._data.marker.clearHighlighted(),t._setTooltip();var a=d3.event.scale,r=d3.event.translate,o=e.ratioY,l=e.ratioX;t.draggingNow=!0,(isNaN(a)||null==a)&&(a=e.scale()),(isNaN(a)||null==a)&&(a=1),1===a&&null!==n&&(("wheel"===n.type||"mousewheel"===n.type)&&(n.deltaY||-n.wheelDelta)>0||"touchmove"===n.type&&n.touches.length>1)&&(e.ratioX=1,l=1,e.ratioY=1,o=1),(isNaN(r[0])||isNaN(r[1])||null==r[0]||null==r[1])&&(r=e.translate()),(isNaN(r[0])||isNaN(r[1])||null==r[0]||null==r[1])&&(r=[0,0]);var c=e.scaleExtent()[0];a*o<c&&(o=c/a,e.ratioY=o),a*l<c&&(l=c/a,e.ratioX=l);var h=a*l<1,u=a*o<1;h?(r[0]<0&&(r[0]=0),r[0]>(1-a*l)*t.width&&(r[0]=(1-a*l)*t.width)):(r[0]>0&&(r[0]=0),r[0]<(1-a*l)*t.width&&(r[0]=(1-a*l)*t.width)),u?(r[1]<0&&(r[1]=0),r[1]>(1-a*o)*t.height&&(r[1]=(1-a*o)*t.height)):(r[1]>0&&(r[1]=0),r[1]<(1-a*o)*t.height&&(r[1]=(1-a*o)*t.height));var d=t.width*a*l,f=t.height*a*o,m=[0*a*l+r[0],d+r[0]],p=[f+r[1],0*a*o+r[1]],g=t._rangeBump(m),v=t._rangeBump(p),b=(g[0]-m[0])*a*l,y=(g[1]-m[1])*a*l,x=(v[0]-p[0])*a*o,_=(v[1]-p[1])*a*o;m[0]=m[0]+b,m[1]=m[1]+y,p[0]=p[0]+x,p[1]=p[1]+_;var M=[0,t.width],w=[t.height,0],z=t._rangeBump(M),S=t._rangeBump(w);h?(m[0]<z[0]&&(r[0]=z[0]-b),m[1]>z[1]&&(r[0]=z[1]-y-d)):(m[0]>z[0]&&(r[0]=z[0]-b),m[1]<z[1]&&(r[0]=z[1]-y-d)),u?(p[0]>S[0]&&(r[1]=S[0]-x-f),p[1]<S[1]&&(r[1]=S[1]-_)):(p[0]<S[0]&&(r[1]=S[0]-x-f),p[1]>S[1]&&(r[1]=S[1]-_)),e.translate(r),h?(m[0]<z[0]&&(m[1]=m[1]+Math.abs(m[0]-z[0]),m[0]=z[0]),m[1]>z[1]&&(m[0]=m[0]-Math.abs(m[1]-z[1]),m[1]=z[1])):(m[0]>z[0]&&(m[1]=m[1]-Math.abs(m[0]-z[0]),m[0]=z[0]),m[1]<z[1]&&(m[0]=m[0]+Math.abs(m[1]-z[1]),m[1]=z[1])),u?(p[0]>S[0]&&(p[1]=p[1]-Math.abs(p[0]-S[0]),p[0]=S[0]),p[1]<S[1]&&(p[0]=p[0]+Math.abs(p[1]-S[1]),p[1]=S[1])):(p[0]<S[0]&&(p[1]=p[1]+Math.abs(p[0]-S[0]),p[0]=S[0]),p[1]>S[1]&&(p[0]=p[0]-Math.abs(p[1]-S[1]),p[1]=S[1])),"ordinal"===t.model.marker.axis_x.scaleType?t.xScale.rangeBands(m):t.xScale.range(m),"ordinal"===t.model.marker.axis_y.scaleType?t.yScale.rangeBands(p):t.yScale.range(p);var k=function(t){return s.isDate(t)?t:d3.round(t,2)},E=z,O=S;h||(E[0]=M[0]>m[0]?M[0]:m[0],E[1]=M[1]<m[1]?M[1]:m[1]),u||(O[0]=w[0]<p[0]?w[0]:p[0],O[1]=w[1]>p[1]?w[1]:p[1]),t._zoomedXYMinMax={axis_x:{zoomedMin:k(t.xScale.invert(E[0])),zoomedMax:k(t.xScale.invert(E[1]))},axis_y:{zoomedMin:k(t.yScale.invert(O[0])),zoomedMax:k(t.yScale.invert(O[1]))}},e.dontFeedToState||t.model.marker.set(t._zoomedXYMinMax,null,!1);var T=t.yAxis.labelerOptions(),P=t.xAxis.labelerOptions();T.limitMaxTickNumber=a*o<1.5?8:a*o*8,P.limitMaxTickNumber=a*l<1.5?8:a*l*8,T.transitionDuration=e.duration,P.transitionDuration=e.duration,t.xAxisEl.call(t.xAxis.labelerOptions(P)),t.yAxisEl.call(t.yAxis.labelerOptions(T)),t.redrawDataPoints(e.duration),t._trails.run("resize",null,e.duration),e.duration=0}},stop:function(){t.draggingNow=!1,this.quitZoom||(e.dontFeedToState||t.model.marker.set(t._zoomedXYMinMax,!0,!0),e.dontFeedToState=null)}}},expandCanvas:function(t){var e=this.context;t||(t=e.duration);var i=d3.extent(s.values(e.frame.axis_x)),n=d3.extent(s.values(e.frame.axis_y)),a=s.areaToRadius(e.sScale(d3.extent(s.values(e.frame.size))[1]))||0;if(!i[0]&&0!==i[0]||!i[1]&&0!==i[1]||!n[0]&&0!==n[0]||!n[1]&&0!==n[1])return s.warn("panZoom.expandCanvas: X or Y min/max are broken. Aborting with no action");var r={x1:e.xScale(i[0])-a,y1:e.yScale(n[0])+a,x2:e.xScale(i[1])+a,y2:e.yScale(n[1])-a},o=[0,e.width],l=[e.height,0],c={x1:o[0],x2:o[1],y1:l[0],y2:l[1]},h=0;if(!e.isCanvasPreviouslyExpanded||r.x1<c.x1*(1-h)||r.x2>c.x2*(1+h)||r.y2<c.y2*(1-h)||r.y1>c.y1*(1+h)){if(e.isCanvasPreviouslyExpanded){var u=e._rangeBump(o),d=e._rangeBump(l),f=e.xScale.copy().range(u),m=e.yScale.copy().range(d),p=[f.invert(o[0]),f.invert(o[1])],g=[m.invert(l[0]),m.invert(l[1])];r.x1>0?r.x1=0:e.xScale.invert(r.x1)<p[0]&&(r.x1=e.xScale(p[0])),r.x2<e.width?r.x2=e.width:e.xScale.invert(r.x2)>p[1]&&(r.x2=e.xScale(p[1])),r.y1<e.height?r.y1=e.height:e.yScale.invert(r.y1)<g[0]&&(r.y1=e.yScale(g[0])),r.y2>0?r.y2=0:e.yScale.invert(r.y2)>g[1]&&(r.y2=e.yScale(g[1]))}e.isCanvasPreviouslyExpanded=!0,this._zoomOnRectangle(e.element,r.x1,r.y1,r.x2,r.y2,!1,t)}else e.redrawDataPoints(t)},zoomToMaxMin:function(t,e,i,n,a,r){var s=this.context,o=t,l=e,c=i,h=n,u=this.zoomer,d=[0,s.width],f=[s.height,0],m=s._rangeBump(d),p=s._rangeBump(f),g=s.xScale.domain(),v=s.yScale.domain();o<g[0]&&l<g[1]&&(o=g[0]),o>g[0]&&l>g[1]&&(l=g[1]),c<v[0]&&h<v[1]&&(c=v[0]),c>v[0]&&h>v[1]&&(h=v[1]);var b=o<=g[0]&&g[1]<=l&&g[1]-g[0]<l-t,y=c<=v[0]&&v[1]<=h&&v[1]-v[0]<h-i,x=Number.EPSILON?Number.EPSILON:2.220446049250313e-16;s.xScale.invert(d[0])<g[0]&&!b&&Math.abs(o-g[0])<x&&(o=s.xScale.invert(d[0])),s.xScale.invert(d[1])>g[1]&&!b&&Math.abs(l-g[1])<x&&(l=s.xScale.invert(d[1])),s.yScale.invert(f[0])<v[0]&&!y&&Math.abs(c-v[0])<x&&(c=s.yScale.invert(f[0])),s.yScale.invert(f[1])>v[1]&&!y&&Math.abs(h-v[1])<x&&(h=s.yScale.invert(f[1]));var _=[s.xScale(o),s.xScale(l)],M=[s.yScale(c),s.yScale(h)];if(b&&e>=g[1]&&t<=g[0]){var w=Math.abs(s.xScale(g[1])-s.xScale(g[0]))/Math.abs(_[1]-_[0]),z=Math.abs(m[0]-d[0]),S=Math.abs(d[1]-d[0]),k=Math.abs(m[1]-m[0]),E=u.translate()[0]-u.scale()*u.ratioX*(1/w-1)*(z+k*Math.abs(s.xScale(g[0])-_[0])/Math.abs(_[1]-s.xScale(g[1])+Math.abs(s.xScale(g[0])-_[0])));_[1]=(_[1]-_[0])*S/k+E,_[0]=E}if(y&&n>=v[1]&&i<=v[0]){var w=Math.abs(s.yScale(v[0])-s.yScale(v[1]))/Math.abs(M[0]-M[1]),z=Math.abs(p[1]-f[1]),S=Math.abs(f[0]-f[1]),k=Math.abs(p[0]-p[1]),O=u.translate()[1]-u.scale()*u.ratioY*(1/w-1)*(z+k*Math.abs(s.yScale(v[1])-M[1])/(Math.abs(s.yScale(v[0])-M[0])+Math.abs(M[1]-s.yScale(v[1]))));M[0]=(M[0]-M[1])*S/k+O,M[1]=O}this._zoomOnRectangle(s.element,_[0],M[0],_[1],M[1],!1,a,r)},_zoomOnRectangle:function(t,e,i,n,a,r,s,o){var l=this.context,c=this.zoomer,h=e,u=i,d=n,f=a;r&&c.translate([c.translate()[0]+h-d,c.translate()[1]+u-f]);var m=[0,l.width],p=[l.height,0],g=l.xScale.domain(),v=l.yScale.domain(),b=c.scale()*c.ratioX<1,y=c.scale()*c.ratioY<1;l.xScale.invert(h)<g[0]&&h>=m[0]&&!b?h=this._scaleCoordinate(h,m[1]-d,l.xScale.range()[0],m[1]):l.xScale.invert(d)<g[0]&&d>=m[0]&&!b&&(d=this._scaleCoordinate(d,m[1]-h,l.xScale.range()[0],m[1])),l.xScale.invert(d)>g[1]&&d<=m[1]&&!b?d=this._scaleCoordinate(d,h-m[0],l.xScale.range()[1],m[0]):l.xScale.invert(h)>g[1]&&h<=m[1]&&!b&&(h=this._scaleCoordinate(h,d-m[0],l.xScale.range()[1],m[0])),l.yScale.invert(u)<v[0]&&u<=p[0]&&!y?u=this._scaleCoordinate(u,f-p[1],l.yScale.range()[0],p[1]):l.yScale.invert(f)<v[0]&&f<=p[0]&&!y&&(f=this._scaleCoordinate(f,u-p[1],l.yScale.range()[0],p[1])),l.yScale.invert(f)>v[1]&&f>=p[1]&&!y?f=this._scaleCoordinate(f,p[0]-u,l.yScale.range()[1],p[0]):l.yScale.invert(u)>v[1]&&u>=p[1]&&!y&&(u=this._scaleCoordinate(u,p[0]-f,l.yScale.range()[1],p[0]));var x=c.scaleExtent()[0],_=c.scaleExtent()[1];if(Math.abs(h-d)>Math.abs(u-f)){var M=l.height/Math.abs(u-f)*c.scale();M<x&&(c.ratioY*=M/c.scale(),M=x),M>_&&(M=_);var w=l.width/Math.abs(h-d)*c.scale()/M*c.ratioX,z=c.ratioY}else{var M=l.width/Math.abs(h-d)*c.scale();M<x&&(c.ratioX*=M/c.scale(),M=x),M>_&&(M=_);var z=l.height/Math.abs(u-f)*c.scale()/M*c.ratioY,w=c.ratioX}var S=[(c.translate()[0]-Math.min(h,d))/c.scale()/c.ratioX*M*w,(c.translate()[1]-Math.min(u,f))/c.scale()/c.ratioY*M*z];
c.dontFeedToState=o,c.scale(M),c.ratioY=z,c.ratioX=w,c.translate(S),c.duration=s?s:0,c.event(t)},_scaleCoordinate:function(t,e,i,n){var a=e/Math.abs(i-n);return(t-i)*(1-a)+i},_scaleToMin:function(t,e,i,n){var a=(t-e)*i,r=Math.max(n,e-n),s=Math.max(a,r);return s},zoomByIncrement:function(t,e){var i=this.context,n=this.zoomer.scale(),a=[this.zoomer.translate()[0],this.zoomer.translate()[1]],r=d3.mouse(i.element.node()),s=Math.log(n)/Math.LN2;"plus"!=t&&t||(s=Math.floor(s)+1),"minus"==t&&(s=Math.ceil(s)-1);var o=[(r[0]-a[0])/n,(r[1]-a[1])/n],l=this.zoomer.scaleExtent();n==l[0]&&(this.zoomer.ratioY=1,this.zoomer.ratioX=1),n=Math.max(l[0],Math.min(l[1],Math.pow(2,s))),o=[o[0]*n+a[0],o[1]*n+a[1]],a[0]+=r[0]-o[0],a[1]+=r[1]-o[1],this.zoomer.scale(n),this.zoomer.translate([a[0],a[1]]),this.zoomer.duration=e||0,this.zoomer.event(i.element)},resetZoomState:function(t){this.zoomer.scale(1),this.zoomer.ratioY=1,this.zoomer.ratioX=1,this.zoomer.translate([0,0])},reset:function(t,e){var i=this.context;i.isCanvasPreviouslyExpanded=!1,this.zoomer.scale(1),this.zoomer.ratioY=1,this.zoomer.ratioX=1,this.zoomer.translate([0,0]),this.zoomer.duration=e||0,this.zoomer.event(t||i.element)},rerun:function(t){var e=this.context;this.zoomer.event(t||e.element)}})},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),s=a(r),o=i(21),l=n(o);e.default=l.default.extend({init:function(t){this.context=t,this._isCreated=null,this.actionsQueue={},this.entityTrails={},this.trailsData=[],this.trailsInProgress={},this.activePromises={},this.trailTransitions={},this.delayedIterations={},this.drawingQueue={}},toggle:function(t){var e=this.context;t?e._trails.create().then(function(){e._trails.run(["findVisible","reveal","opacityHandler"])}):(e._trails.run("remove"),e.model.marker.select.forEach(function(t){t.trailStartTime=null}))},create:function(t){var e=this.context,i=this,n=e.KEY,a=e.TIMEDIM;return this._isCreated=new Promise(function(r,o){if(e.model.ui.chart.trails){var l=e.model.time.getAllSteps(),c=[];t=null==t?e.model.marker.select:[t],i._clearActions(t),i.trailsData=e.model.marker.select.map(function(t){var e={status:"created",selectedEntityData:t};return e[n]=t[n],e}),i.trailTransitions={};var h=e.bubbleContainer.selectAll("g.vzb-bc-entity.entity-trail").data(i.trailsData,function(t){return t[n]});h.exit().remove(),h.enter().insert("g",function(t){return this.querySelector(".bubble-"+t[n])}).attr("class",function(t){return"vzb-bc-entity entity-trail trail-"+t[n]}),h.each(function(t,r){var o=this;c.push(new Promise(function(r,c){var h=l.map(function(e){return{t:e,key:t[n]}});i.entityTrails[t[n]]=d3.select(o).selectAll("g").data(h).classed("vzb-invisible",!0),i.entityTrails[t[n]].exit().remove(),i.entityTrails[t[n]].enter().append("g").attr("class","vzb-bc-trailsegment").on("mouseover",function(i,r){if(!s.isTouchDevice()){var o={};o[n]=i.key,o[a]=i.t,e._axisProjections(o),e._labels.highlight(t,!0);var l=e.model.time.formatDate(i.t),c=s.find(e.model.marker.select,function(e){return e[n]==t[n]});e.model.marker.getFrame(o[a],function(t){var i=e.xScale(t.axis_x[o[n]]),a=e.yScale(t.axis_y[o[n]]),r=s.areaToRadius(e.sScale(t.size[o[n]])),h=null!=t.color[o[n]]?e.cScale(t.color[o[n]]):e.COLOR_WHITEISH;l!==c.trailStartTime&&e._setTooltip(l,i,a,r+3,h),e._setBubbleCrown(i,a,r,h),e.model.marker.getModelObject("highlight").trigger("change",{size:t.size[o[n]],color:t.color[o[n]]})}),d3.select(this).style("opacity",1)}}).on("mouseout",function(t,i){s.isTouchDevice()||(e._axisProjections(),e._setTooltip(),e._setBubbleCrown(),e._labels.highlight(null,!1),e.model.marker.getModelObject("highlight").trigger("change",null),d3.select(this).style("opacity",e.model.marker.opacityRegular))}).each(function(t,e){var i=d3.select(this);i.append("circle"),i.append("line")}),r()}))}),c.length>0?Promise.all(c).then(function(t){r(!0)}):r(!0)}}),this._isCreated},_addActions:function(t,e){var i=this.context,n=this,a=i.KEY;t.forEach(function(t){n.actionsQueue[t[a]]||(n.actionsQueue[t[a]]=[]),n.actionsQueue[t[a]]=[].concat(n.actionsQueue[t[a]].filter(function(t){return e.indexOf(t)==-1}),e)})},_clearActions:function(t){var e=this.context,i=this,n=e.KEY;t.forEach(function(t){i.actionsQueue[t[n]]||(i.actionsQueue[t[n]]=[]),i.actionsQueue[t[n]]=[],i.drawingQueue[t[n]]={},i.delayedIterations[t[n]]={},i.activePromises[t[n]]||(i.activePromises[t[n]]=[]),s.forEach(i.activePromises[t[n]],function(t,e){"pending"===t.status&&t.reject()}),i.trailsInProgress[t[n]]=null,i.activePromises[t[n]]=[]})},_getNextAction:function(t){return this.actionsQueue[t].shift()},run:function(t,e,i){var n=this.context,a=this,r=n.KEY;this._isCreated&&!n.model.time.splash&&("string"==typeof t&&(t=[t]),this._isCreated.then(function(){if(n.model.ui.chart.trails&&n.model.marker.select.length||"remove"==t){i||(i=0),e=null==e?n.model.marker.select:[e];for(var s=0;s<t.length;s++)if(["resize","recolor"].indexOf(t[s])!=-1){var o=t.splice(s,1).pop();--s,a.trailsData.forEach(function(t){var e=a.entityTrails[t[r]];n._trails["_"+o](e,i,t)})}0!=t.length&&(a._addActions(e,t),a.trailsData.forEach(function(e){t.indexOf("findVisible")!=-1&&(a.drawingQueue[e[r]]={},a.delayedIterations[e[r]]={});var s=a.entityTrails[e[r]],o=function t(o){var l=a._getNextAction(e[r]);if(l){a.trailsInProgress[e[r]]=l;var c=n._trails["_"+l](s,i,e);c&&c instanceof Promise?c.then(function(){a.trailsInProgress[e[r]]=null,t(o+1)},function(){a.trailsInProgress[e[r]]=null}):(a.trailsInProgress[e[r]]=null,t(o+1))}};a.trailsInProgress[e[r]]||o(0)}))}}))},_remove:function(t,e,i){this.actionsQueue[i[this.context.KEY]]=[],t&&(d3.select(this.entityTrails[i[this.context.KEY]].node().parentNode).remove(),this.entityTrails[i[this.context.KEY]]=null)},_resize:function(t,e,i){var n=this.context;if(!n.model.time.splash){var a=!1;t.each(function(t,r){if(null!=t.valueY&&null!=t.valueX&&null!=t.valueS){var o=d3.select(this);if(e?o.select("circle").transition().duration(e).ease("linear").attr("cy",n.yScale(t.valueY)).attr("cx",n.xScale(t.valueX)).attr("r",s.areaToRadius(n.sScale(t.valueS))):o.select("circle").interrupt().attr("cy",n.yScale(t.valueY)).attr("cx",n.xScale(t.valueX)).attr("r",s.areaToRadius(n.sScale(t.valueS))).transition(),a||t.transparent||(a=!0,n._labels.updateLabelOnlyPosition(i,null,{scaledS0:s.areaToRadius(n.sScale(t.valueS))})),t.next){var l=t.next;if(null!=l&&null!=l.valueY&&null!=l.valueX){var c=Math.sqrt(Math.pow(n.xScale(t.valueX)-n.xScale(l.valueX),2)+Math.pow(n.yScale(t.valueY)-n.yScale(l.valueY),2));e?o.select("line").transition().duration(e).ease("linear").attr("x1",n.xScale(l.valueX)).attr("y1",n.yScale(l.valueY)).attr("x2",n.xScale(t.valueX)).attr("y2",n.yScale(t.valueY)).style("stroke-dasharray",c).style("stroke-dashoffset",s.areaToRadius(n.sScale(t.valueS))):o.select("line").interrupt().attr("x1",n.xScale(l.valueX)).attr("y1",n.yScale(l.valueY)).attr("x2",n.xScale(t.valueX)).attr("y2",n.yScale(t.valueY)).style("stroke-dasharray",c).style("stroke-dashoffset",s.areaToRadius(n.sScale(t.valueS))).transition()}}}})}},_recolor:function(t,e,i){var n=this.context;t.each(function(t,e){var i=d3.select(this),a="geo.world_4region"==n.model.marker.color.which?n.model.marker.color.getColorShade({colorID:t.valueC,shadeID:"shade"}):null!=t.valueC?n.cScale(t.valueC):n.COLOR_BLACKISH;i.select("circle").style("fill",null!=t.valueC?n.cScale(t.valueC):n.COLOR_WHITEISH),i.select("line").style("stroke",a)})},_opacityHandler:function(t,e,i){var n=this.context;t.each(function(t,e){var a=d3.select(this);a.style("opacity",i.opacity||n.model.marker.opacityRegular)})},_findVisible:function(t,e,i){var n=this.context,a=this,r=n.KEY;return new Promise(function(e,o){new Promise(function(t,e){i.limits?t():n.model.marker.getEntityLimits(i[r]).then(function(e){i.limits=e,t()})}).then(function(){i.selectedEntityData.trailStartTime||(i.selectedEntityData.trailStartTime=n.model.time.formatDate(n.time));var o=n.model.time.parse(""+i.selectedEntityData.trailStartTime);if(n.time-o<0||i.limits.min-o>0){n.time-o<0?(i.selectedEntityData.trailStartTime=n.model.time.formatDate(d3.max([n.time,i.limits.min])),o=n.model.time.parse(""+i.selectedEntityData.trailStartTime)):(i.selectedEntityData.trailStartTime=n.model.time.formatDate(i.limits.min),o=n.model.time.parse(""+i.selectedEntityData.trailStartTime));var l=n._labels.cached[i[r]],c=n.frame.size[i[r]],h=n.frame.color[i[r]];l.labelX0=n.frame.axis_x[i[r]],l.labelY0=n.frame.axis_y[i[r]],l.scaledS0=c||0===c?s.areaToRadius(n.sScale(c)):null,l.scaledC0=null!=h?n.cScale(h):n.COLOR_WHITEISH,n._updateLabel(i,0,n.frame.axis_x[i[r]],n.frame.axis_y[i[r]],n.frame.size[i[r]],n.frame.color[i[r]],n.frame.label[i[r]],n.frame.size_label[i[r]],0,!0)}t.each(function(e,a){var r=e.transparent;e.transparent=null==i.selectedEntityData.trailStartTime||e.t-n.time>0||o-e.t>0||i.selectedEntityData.trailStartTime-n.model.time.formatDate(n.time)>=0,(r!=e.transparent||Math.abs(n.model.time.formatDate(e.t)-n.model.time.formatDate(n.time))<2)&&(e.visibilityChanged=!0),e.transparent&&d3.select(t[0][a]).classed("vzb-invisible",e.transparent)}),a.drawingQueue[i[r]]={},a.delayedIterations[i[r]]={},e()})})},_abortAnimation:function(){var t=this.context,e=this,i=t.KEY;e.trailsData.forEach(function(t){e.trailTransitions[t[i]]&&e.trailTransitions[t[i]].select("line").interrupt().transition()})},_reveal:function(t,e,i){var n=this.context,a=this,r=n.KEY;i.status="reveal";var o=n.model.time.parse(""+i.selectedEntityData.trailStartTime),l=function(t,l,c,u){return new Promise(function(u,d){var f=d3.select(t[0][l]),m=f.datum();if(c-l==1){if(m.transparent)return f.classed("vzb-invisible",m.transparent),u();if(!m.visibilityChanged)return u()}n.model.marker.getFrame(m.t,function(d){if("reveal"!=i.status)return u();if(!d)return u();if(m.valueY=d.axis_y[i[r]],m.valueX=d.axis_x[i[r]],m.valueS=d.size[i[r]],m.valueC=d.color[i[r]],null==m.valueY||null==m.valueX||null==m.valueS)return u();if(o&&o.toString()==m.t.toString()){var p=n._labels.cached[i[r]];p.labelX0=m.valueX,p.labelY0=m.valueY;var g=m.valueS;p.scaledS0=g||0===g?s.areaToRadius(n.sScale(g)):null,p.scaledC0=null!=m.valueC?n.cScale(m.valueC):n.COLOR_WHITEISH,n._updateLabel(i,l,m.valueX,m.valueY,m.valueS,m.valueC,d.label[i[r]],d.size_label[i[r]],0,!0)}if(f.select("circle").attr("cy",n.yScale(m.valueY)).attr("cx",n.xScale(m.valueX)).attr("r",s.areaToRadius(n.sScale(m.valueS))).style("fill",null!=m.valueC?n.cScale(m.valueC):n.COLOR_WHITEISH),f.select("line").attr("x2",n.xScale(m.valueX)).attr("y2",n.yScale(m.valueY)).attr("x1",n.xScale(m.valueX)).attr("y1",n.yScale(m.valueY)),n.time-m.t>0?(m.visibilityChanged=!1,f.classed("vzb-invisible",m.transparent)):f.classed("vzb-invisible",!0),!t[0][c]||n.time.toString()==m.t.toString())return u();var v=d3.select(t[0][c]),b=v.datum();b.previous=m,m.next=b;var y=b.t;n.time-b.t<0&&(m.visibilityChanged=!0,y=n.time),n.model.marker.getFrame(y,function(t){if("reveal"!=i.status)return u();if(t&&null!=m.valueY&&null!=m.valueX&&null!=m.valueS){if(null==t.axis_x[i[r]]||null==t.axis_y[i[r]])return u();b.valueY=t.axis_y[i[r]],b.valueX=t.axis_x[i[r]],b.valueS=t.size[i[r]],b.valueC=t.color[i[r]],a.trailTransitions[i[r]]=f;var o="geo.world_4region"==n.model.marker.color.which?n.model.marker.color.getColorShade({colorID:m.valueC,shadeID:"shade"}):null!=m.valueC?n.cScale(m.valueC):n.COLOR_BLACKISH,d=Math.sqrt(Math.pow(n.xScale(m.valueX)-n.xScale(t.axis_x[i[r]]),2)+Math.pow(n.yScale(m.valueY)-n.yScale(t.axis_y[i[r]]),2));return f.select("line").transition().duration(e).ease("linear").attr("x1",n.xScale(b.valueX)).attr("y1",n.yScale(b.valueY)).attr("x2",n.xScale(m.valueX)).attr("y2",n.yScale(m.valueY)).style("stroke-dasharray",d).style("stroke-dashoffset",s.areaToRadius(n.sScale(m.valueS))).style("stroke",o),c-l>1?(h(l,c),u()):u()}return u()})})})},c=function(a,o,l){return new Promise(function(c,u){var d=d3.select(t[0][a]),f=d3.select(t[0][o]),m=d3.select(t[0][l]),p=d.datum(),g=f.datum(),v=m.datum();return!p.previous&&!p.next||!g.previous&&!g.next?c():void n.model.marker.getFrame(v.t,function(t){if("reveal"!=i.status)return c();if(!t||"undefined"==typeof t.axis_x||null==t.axis_x[i[r]]||"undefined"==typeof t.axis_y||null==t.axis_y[i[r]])return s.warn("Frame for trail missed: "+v.t),c();if(v.valueY=t.axis_y[i[r]],v.valueX=t.axis_x[i[r]],v.valueS=t.size[i[r]],v.valueC=t.color[i[r]],v.previous=p,v.next=g,p.next=v,g.previous=v,null==v.valueY||null==v.valueX||null==v.valueS)return s.warn("Data for trail point missed: "+v.t),c();var u="geo.world_4region"==n.model.marker.color.which?n.model.marker.color.getColorShade({colorID:v.valueC,shadeID:"shade"}):null!=v.valueC?n.cScale(v.valueC):n.COLOR_BLACKISH,f=Math.sqrt(Math.pow(n.xScale(p.valueX)-n.xScale(v.valueX),2)+Math.pow(n.yScale(p.valueY)-n.yScale(v.valueX),2));if(d.select("line").transition().duration(e).ease("linear").attr("x1",n.xScale(v.valueX)).attr("y1",n.yScale(v.valueY)).attr("x2",n.xScale(p.valueX)).attr("y2",n.yScale(p.valueY)).style("stroke-dasharray",f).style("stroke-dashoffset",s.areaToRadius(n.sScale(p.valueS))).style("stroke",u),m.classed("vzb-invisible",v.transparent),!v.transparent){m.select("circle").attr("cy",n.yScale(v.valueY)).attr("cx",n.xScale(v.valueX)).attr("r",s.areaToRadius(n.sScale(v.valueS))).style("fill",null!=v.valueC?n.cScale(v.valueC):n.COLOR_WHITEISH);var b=Math.sqrt(Math.pow(n.xScale(v.valueX)-n.xScale(g.valueX),2)+Math.pow(n.yScale(v.valueY)-n.yScale(g.valueY),2));m.select("line").transition().duration(e).ease("linear").attr("x1",n.xScale(g.valueX)).attr("y1",n.yScale(g.valueY)).attr("x2",n.xScale(v.valueX)).attr("y2",n.yScale(v.valueY)).style("stroke-dasharray",b).style("stroke-dashoffset",s.areaToRadius(n.sScale(v.valueS))).style("stroke",u)}h(a,l,o),c()})})},h=function(t,e,n){var s;e-t>1&&(s=u(t,e),a.delayedIterations[i[r]][t]={first:t,next:e,medium:s}),n&&n-e>1&&(s=u(e,n),a.delayedIterations[i[r]][e]={first:e,next:n,medium:s})},u=function(t,e){return Math.round(t+(e-t)/2)},d=function(t,e,i){var a=[],r=0,o=0,l=d3.min([t.limits.max,n.time]),c=d3.max([t.limits.min,n.model.time.parse(""+t.selectedEntityData.trailStartTime)]);return s.forEach(e[0],function(t,e){var s=t.__data__;s.t-c==0?r=e:s.t-l==0?o=e:s.t>c&&s.t<l&&(n.model.time.formatDate(s.t)%i==0||s.next&&s.previous)&&a.push(e)}),a.unshift(r),o>0&&a.push(o),a},f=function(){return new Promise(function(t,e){var n=function e(){var n=Object.keys(a.drawingQueue[i[r]])[Math.floor(Math.random()*Object.keys(a.drawingQueue[i[r]]).length)],s=JSON.parse(JSON.stringify(a.drawingQueue[i[r]][n]));delete a.drawingQueue[i[r]][n],c(s.first,s.next,s.medium).then(function(){Object.keys(a.drawingQueue[i[r]]).length>0?e():t()})};Object.keys(a.drawingQueue[i[r]]).length>0?n(a.drawingQueue[i[r]]):t()})};return new Promise(function(e,s){var o=function t(i,n){return n<0||n>=i[0].length?e():void l(i,n,n+1).then(function(){t(i,n+1)},function(){return e()})},c=function t(){f().then(function(){return 0==Object.keys(a.delayedIterations[i[r]]).length?e():(a.drawingQueue[i[r]]=a.delayedIterations[i[r]],a.delayedIterations[i[r]]={},t(),void 0)},function(){return e()})};if(n.model.marker.framesAreReady())o(t,0);else{a.delayedIterations[i[r]]={},a.drawingQueue[i[r]]={};var h=d(i,t,50),u=[];if(h.length<=1)return e();a.delayedIterations[i[r]]={};for(var m=0;m<h.length-1;m++)u.push(l(t,h[m],h[m+1],1));Promise.all(u).then(function(){0==Object.keys(a.delayedIterations[i[r]]).length?e():(a.drawingQueue[i[r]]=a.delayedIterations[i[r]],a.delayedIterations[i[r]]={},c())},function(){e()})}})}})},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),s=a(r),o=i(2),l=n(o),c=i(86),h=n(c),u=i(10),d=i(215),f=n(d),m=i(136),p=n(m),g=i(66),v=n(g),b=i(45),y=n(b),x=l.default.extend({init:function(t,e){this.name="bubblemap",this.template=i(450),this.bubblesDrawing=null;var n=function(){var t=!1;return function(e){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0)}(navigator.userAgent||navigator.vendor||window.opera),t};this.isMobile=n(),this.model_expects=[{name:"time",type:"time"},{name:"entities",type:"entities"},{name:"marker",type:"model"},{name:"locale",type:"locale"},{name:"ui",type:"ui"}];var a=this;this.model_binds={"change:time.value":function(t){a._readyOnce&&a.model.marker.getFrame(a.model.time.value,a.frameChanged.bind(a))},"change:marker.highlight":function(t){a._readyOnce&&(a.highlightMarkers(),a.updateOpacity())},"change:marker":function(t,e){a._readyOnce&&e.indexOf("scaleType")>-1&&a.ready()},"change:marker.size.extent":function(t,e){a._readyOnce&&a.entityBubbles&&(a.updateMarkerSizeLimits(),a.redrawDataPoints(null,!1))},"change:marker.color.palette":function(t,e){a._readyOnce&&a.redrawDataPoints(null,!1)},"change:marker.select":function(t){a._readyOnce&&(a.selectMarkers(),a.redrawDataPoints(null,!1),a.updateOpacity(),a.updateDoubtOpacity())},"change:marker.opacitySelectDim":function(t){a.updateOpacity()},"change:marker.opacityRegular":function(t){a.updateOpacity()}},this._super(t,e),this.sScale=null,this.cScale=d3.scale.category10(),a.COLOR_WHITEISH="#fdfdfd",(0,p.default)(),this._labels=new h.default(this),this._labels.config({CSS_PREFIX:"vzb-bmc",LABELS_CONTAINER_CLASS:"vzb-bmc-labels",LINES_CONTAINER_CLASS:"vzb-bmc-lines",SUPPRESS_HIGHLIGHT_DURING_PLAY:!1})},readyOnce:function(){this.element=d3.select(this.element),this.graph=this.element.select(".vzb-bmc-graph"),this.mapSvg=this.element.select(".vzb-bmc-map-background"),this.bubbleContainerCrop=this.graph.select(".vzb-bmc-bubbles-crop"),this.bubbleContainer=this.graph.select(".vzb-bmc-bubbles"),this.labelListContainer=this.graph.select(".vzb-bmc-bubble-labels"),this.dataWarningEl=this.graph.select(".vzb-data-warning"),this.yTitleEl=this.graph.select(".vzb-bmc-axis-y-title"),this.cTitleEl=this.graph.select(".vzb-bmc-axis-c-title"),this.yInfoEl=this.graph.select(".vzb-bmc-axis-y-info"),this.cInfoEl=this.graph.select(".vzb-bmc-axis-c-info"),this.entityBubbles=null,this.tooltip=this.element.select(".vzb-bmc-tooltip"),this.yearEl=this.graph.select(".vzb-bmc-year"),this.year=new v.default(this.yearEl),this.year.setConditions({xAlign:"left",yAlign:"bottom"});var t=this;this.on("resize",function(){t.updateSize()||(t.updateMarkerSizeLimits(),t._labels.updateSize(),t.redrawDataPoints())}),this.initMap(),this.KEY=this.model.entities.getDimension(),this.TIMEDIM=this.model.time.getDimension(),this.updateUIStrings(),this.wScale=d3.scale.linear().domain(this.model.ui.datawarning.doubtDomain).range(this.model.ui.datawarning.doubtRange),this._labels.readyOnce()},ready:function(){var t=this;this.updateUIStrings(),this.updateIndicators(),this.updateSize(),this.updateMarkerSizeLimits(),this.model.marker.getFrame(this.model.time.value,function(e,i){return i.toString()!=t.model.time.value.toString()?void s.defer(function(){t.ready()}):void(e&&(t.values=e,t.updateEntities(),t.updateTime(),t._labels.ready(),t.redrawDataPoints(),t.highlightMarkers(),t.selectMarkers(),t.updateDoubtOpacity(),t.updateOpacity()))})},frameChanged:function(t,e){e.toString()==this.model.time.value.toString()&&t&&(this.values=t,this.updateTime(),this.updateDoubtOpacity(),this.redrawDataPoints(null,!1))},updateUIStrings:function(){var t=this;this.translator=this.model.locale.getTFunction();var e=t.model.marker.size.getConceptprops(),i=t.model.marker.color.getConceptprops();this.strings={title:{S:e.name,C:i.name}},this.yTitleEl.select("text").text(this.translator("buttons/size")+": "+this.strings.title.S).on("click",function(){t.parent.findChildByName("gapminder-treemenu").markerID("size").alignX(t.model.locale.isRTL()?"right":"left").alignY("top").updateView().toggle()}),this.cTitleEl.select("text").text(this.translator("buttons/color")+": "+this.strings.title.C).on("click",function(){t.parent.findChildByName("gapminder-treemenu").markerID("color").alignX(t.model.locale.isRTL()?"right":"left").alignY("top").updateView().toggle()}),s.setIcon(this.dataWarningEl,u.warn).select("svg").attr("width","0px").attr("height","0px"),this.dataWarningEl.append("text").attr("text-anchor","end").text(this.translator("hints/dataWarning")),this.dataWarningEl.on("click",function(){t.parent.findChildByName("gapminder-datawarning").toggle()}).on("mouseover",function(){t.updateDoubtOpacity(1)}).on("mouseout",function(){t.updateDoubtOpacity()}),this.yInfoEl.html(u.question).select("svg").attr("width","0px").attr("height","0px"),this.yInfoEl.on("click",function(){t.parent.findChildByName("gapminder-datanotes").pin()}),this.yInfoEl.on("mouseover",function(){var e=this.getBBox(),i=s.makeAbsoluteContext(this,this.farthestViewportElement)(e.x-10,e.y+e.height+10),n=t.root.element.getBoundingClientRect(),a=t.element.node().getBoundingClientRect();t.parent.findChildByName("gapminder-datanotes").setHook("size").show().setPos(i.x+a.left-n.left,i.y)}),this.yInfoEl.on("mouseout",function(){t.parent.findChildByName("gapminder-datanotes").hide()}),this.cInfoEl.html(u.question).select("svg").attr("width","0px").attr("height","0px"),this.cInfoEl.on("click",function(){t.parent.findChildByName("gapminder-datanotes").pin()}),this.cInfoEl.on("mouseover",function(){var e=this.getBBox(),i=s.makeAbsoluteContext(this,this.farthestViewportElement)(e.x-10,e.y+e.height+10),n=t.root.element.getBoundingClientRect(),a=t.element.node().getBoundingClientRect();t.parent.findChildByName("gapminder-datanotes").setHook("color").show().setPos(i.x+a.left-n.left,i.y)}),this.cInfoEl.on("mouseout",function(){t.parent.findChildByName("gapminder-datanotes").hide()})},updateTitleNumbers:function(){var t,e=this;if(e.isMobile&&e.model.marker.select&&1===e.model.marker.select.length&&(t=e.model.marker.select[0]),e.hovered||t){var i=e.model.marker.size.getConceptprops(),n=e.model.marker.color.getConceptprops(),a=e.hovered||t,r=e.model.marker.size.getTickFormatter(),s=e.model.marker.color.getTickFormatter(),o=i.unit||"",l=n.unit||"",c=e.values.size[a[e.KEY]],h=e.values.color[a[e.KEY]];e.model.marker.color.isDiscrete()&&h&&(h=this.model.marker.color.getColorlegendMarker().label.getItems()[h]||""),e.yTitleEl.select("text").text(e.translator("buttons/size")+": "+r(c)+" "+o),e.cTitleEl.select("text").text(e.translator("buttons/color")+": "+(h||0===h?s(h)+" "+l:e.translator("hints/nodata"))),this.yInfoEl.classed("vzb-hidden",!0),this.cInfoEl.classed("vzb-hidden",!0)}else this.yTitleEl.select("text").text(this.translator("buttons/size")+": "+this.strings.title.S),this.cTitleEl.select("text").text(this.translator("buttons/color")+": "+this.strings.title.C),this.yInfoEl.classed("vzb-hidden",!1),this.cInfoEl.classed("vzb-hidden",this.cTitleEl.classed("vzb-hidden"))},updateDoubtOpacity:function(t){null==t&&(t=this.wScale(+this.time.getUTCFullYear().toString())),this.someSelected&&(t=1),this.dataWarningEl.style("opacity",t)},updateOpacity:function(){var t=this,e=1,i=.3,n=this.model.marker.opacityRegular,a=this.model.marker.opacityRegular,r=this.model.marker.opacitySelectDim;this.entityBubbles.style("opacity",function(s){return t.someHighlighted&&t.model.marker.isHighlighted(s)?e:t.someSelected?t.model.marker.isSelected(s)?n:r:t.someHighlighted?i:a}),this.entityBubbles.classed("vzb-selected",function(e){return t.model.marker.isSelected(e)});var s=t.model.marker.opacitySelectDim<.01;s!==this.nonSelectedOpacityZero&&this.entityBubbles.style("pointer-events",function(e){return t.someSelected&&s&&!t.model.marker.isSelected(e)?"none":"visible"}),this.nonSelectedOpacityZero=t.model.marker.opacitySelectDim<.01},updateIndicators:function(){this.sScale=this.model.marker.size.getScale(),this.cScale=this.model.marker.color.getScale()},updateEntities:function(){var t=this,e=this.KEY,i=this.TIMEDIM,n=function(n){return n=n||"",t.model.marker.getKeys().map(function(r){var s={};return s[e]=r[e],s[i]=a,s.sortValue=t.values.size[r[e]]||0,s[e]=n+r[e],s}).sort(function(t,e){return e.sortValue-t.sortValue})},a=this.model.time.end;this.model.marker.setVisible(n.call(this)),this.model.time.splash||this.unselectBubblesWithNoData(),this.entityBubbles=this.bubbleContainer.selectAll(".vzb-bmc-bubble").data(this.model.marker.getVisible(),function(t){return t[e]}).order(),this.entityBubbles.exit().remove(),this.entityBubbles.enter().append("circle").attr("class","vzb-bmc-bubble").on("mouseover",function(e,i){s.isTouchDevice()||t._interact()._mouseover(e,i)}).on("mouseout",function(e,i){s.isTouchDevice()||t._interact()._mouseout(e,i)}).on("click",function(e,i){s.isTouchDevice()||(t._interact()._click(e,i),t.highlightMarkers())}).onTap(function(e,i){t._interact()._click(e,i),d3.event.stopPropagation()}).onLongTap(function(t,e){})},unselectBubblesWithNoData:function(t){var e=this,i=this.KEY;t||(t=this.values),t&&t.size&&this.model.marker.select.forEach(function(n){t.size[n[i]]||0===t.size[n[i]]||e.model.marker.selectMarker(n)})},redrawDataPoints:function(t,e){var i=this;return t||(t=this.duration),e||(e=!0),this.entityBubbles?void this.entityBubbles.each(function(n,a){var r=d3.select(this),o=d3.select("#"+n[i.KEY]),l=i.values.hook_lng[n[i.KEY]],c=i.values.hook_lat[n[i.KEY]],h=i.values.size[n[i.KEY]],u=i.values.color[n[i.KEY]],d=i.values.label[n[i.KEY]];n.hidden_1=n.hidden,n.hidden=!h&&0!==h||null==l||null==c,n.hidden!==n.hidden_1&&(t?r.transition().duration(t).ease("linear").style("opacity",0).each("end",function(){return r.classed("vzb-hidden",n.hidden).style("opacity",i.model.marker.opacityRegular)}):r.classed("vzb-hidden",n.hidden)),n.hidden?i._updateLabel(n,a,0,0,h,u,d,t):(n.r=s.areaToRadius(i.sScale(h||0)),n.label=d,r.classed("vzb-hidden",!1).attr("fill",null!=u?i.cScale(u):i.COLOR_WHITEISH),i.model.ui.map.colorGeo&&o.style("fill",null!=u?i.cScale(u):"#999"),e&&(n.cLoc=i.skew(i.projection([l||0,c||0])),r.attr("cx",n.cLoc[0]).attr("cy",n.cLoc[1])),t?r.transition().duration(t).ease("linear").attr("r",n.r):r.interrupt().attr("r",n.r).transition(),i._updateLabel(n,a,n.cLoc[0],n.cLoc[1],h,u,n.label,t))}):s.warn("redrawDataPoints(): no entityBubbles defined. likely a premature call, fix it!")},updateTime:function(){this.time_1=null==this.time?this.model.time.value:this.time,this.time=this.model.time.value,this.duration=this.model.time.playing&&this.time-this.time_1>0?this.model.time.delayAnimations:0,this.year.setText(this.model.time.formatDate(this.time),this.duration),this.updateTitleNumbers()},fitSizeOfTitles:function(){var t=this.yTitleEl.select("text").style("font-size",null),e=this.cTitleEl.select("text").style("font-size",null),t=this.yTitleEl.select("text"),e=this.cTitleEl.select("text"),i=t.node().getBBox(),n=this.cTitleEl.classed("vzb-hidden")?i:e.node().getBBox(),a=Math.max(parseInt(t.style("font-size")),parseInt(e.style("font-size")))*this.width/Math.max(i.width,n.width);Math.max(i.width,n.width)>this.width?(t.style("font-size",a+"px"),e.style("font-size",a+"px")):(t.style("font-size",null),e.style("font-size",null))},initMap:function(){var t=this;this.topology||s.warn("bubble map afterPreload: missing country shapes "+this.topology),this.projection=d3.geo[this.model.ui.map.projection](),this.mapPath=d3.geo.path().projection(this.projection),this.mapGraph=this.element.select(".vzb-bmc-map-graph"),this.mapGraph.html(""),this.mapFeature=f.default.feature(this.topology,this.topology.objects[this.model.ui.map.topology.objects.geo]);var e=f.default.mesh(this.topology,this.topology.objects[this.model.ui.map.topology.objects.boundaries],function(t,e){return t!==e});this.projection.scale(1).translate([0,0]),this.mapBounds=this.mapPath.bounds(this.mapFeature),this.mapFeature.features?this.mapGraph.selectAll(".land").data(this.mapFeature.features).enter().insert("path").attr("d",this.mapPath).attr("id",function(e){return e.properties[t.model.ui.map.topology.geoIdProperty].toLowerCase()}).attr("class","land"):this.mapGraph.insert("path").datum(this.mapFeature).attr("class","land"),this.mapGraph.insert("path").datum(e).attr("class","boundary")},profiles:{small:{margin:{top:10,right:10,left:10,bottom:0},infoElHeight:16,minRadius:.5,maxRadius:30},medium:{margin:{top:20,right:20,left:20,bottom:30},infoElHeight:20,minRadius:1,maxRadius:55},large:{margin:{top:30,right:30,left:30,bottom:35},infoElHeight:22,minRadius:1,maxRadius:65}},presentationProfileChanges:{medium:{infoElHeight:26},large:{infoElHeight:32}},updateSize:function(){this.activeProfile=this.getActiveProfile(this.profiles,this.presentationProfileChanges);var t=this.activeProfile.margin;return this.height=parseInt(this.element.style("height"),10)-t.top-t.bottom||0,this.width=parseInt(this.element.style("width"),10)-t.left-t.right||0,this.height<=0||this.width<=0?s.warn("Bubble map updateSize() abort: vizabi container is too little or has display:none"):(this.repositionElements(),void this.rescaleMap())},repositionElements:function(){var t=this.activeProfile.margin,e=this.activeProfile.infoElHeight,i=this.model.locale.isRTL();this.graph.attr("transform","translate("+t.left+","+t.top+")"),this.year.setConditions({widthRatio:.2}),this.year.resize(this.width,this.height),this.yTitleEl.style("font-size",e).attr("transform","translate("+(i?this.width:0)+","+t.top+")");var n=this.yTitleEl.select("text").node().getBBox();this.cTitleEl.attr("transform","translate("+(i?this.width:0)+","+(t.top+n.height)+")").classed("vzb-hidden","large"===this.getLayoutProfile()||"constant"==this.model.marker.color.use);var a=this.dataWarningEl.select("text").node().getBBox();if(this.dataWarningEl.select("svg").attr("width",.75*a.height).attr("height",.75*a.height).attr("x",-a.width-1.2*a.height).attr("y",.65*-a.height),this.dataWarningEl.attr("transform","translate("+this.width+","+(this.height-.5*a.height)+")").select("text"),this.yInfoEl.select("svg").node()){var r=this.yTitleEl.node().getBBox(),s=d3.transform(this.yTitleEl.attr("transform")).translate,o=i?r.x+s[0]-1.4*e:r.x+s[0]+r.width+.4*e;
this.yInfoEl.select("svg").attr("width",e).attr("height",e),this.yInfoEl.attr("transform","translate("+o+","+(s[1]-.8*e)+")")}if(this.cInfoEl.classed("vzb-hidden",this.cTitleEl.classed("vzb-hidden")),!this.cInfoEl.classed("vzb-hidden")&&this.cInfoEl.select("svg").node()){var r=this.cTitleEl.node().getBBox(),s=d3.transform(this.cTitleEl.attr("transform")).translate,o=i?r.x+s[0]-1.4*e:r.x+s[0]+r.width+.4*e;this.cInfoEl.select("svg").attr("width",e).attr("height",e),this.cInfoEl.attr("transform","translate("+o+","+(s[1]-.8*e)+")")}},rescaleMap:function(){var t=this.model.ui.map.offset,e=this.activeProfile.margin,i=this.model.ui.map.scale/Math.max((this.mapBounds[1][0]-this.mapBounds[0][0])/this.width,(this.mapBounds[1][1]-this.mapBounds[0][1])/this.height),n=i*(this.mapBounds[1][0]-this.mapBounds[0][0]),a=i*(this.mapBounds[1][1]-this.mapBounds[0][1]),r=a*(1+t.top+t.bottom),s=n*(1+t.left+t.right),o=a*t.top,l=n*t.left,c=[(n-i*(this.mapBounds[1][0]+this.mapBounds[0][0]))/2,(a-i*(this.mapBounds[1][1]+this.mapBounds[0][1]))/2];this.projection.scale(i).translate(c),this.mapGraph.selectAll("path").attr("d",this.mapPath);var h,u;if(this.model.ui.map.preserveAspectRatio)h=1,u=1;else{var d=r,f=s;r=this.height*this.model.ui.map.scale,s=this.width*this.model.ui.map.scale,this.mapSvg.attr("preserveAspectRatio","none").attr("viewBox",[0,0,f,d].join(" ")),h=s/n/(1+t.left+t.right),u=r/a/(1+t.top+t.bottom)}this.mapGraph.attr("transform","translate("+l+","+o+")"),this.mapSvg.style("transform","translate3d("+(e.left+(this.width-s)/2)+"px,"+(e.top+(this.height-r)/2)+"px,0)").attr("width",s).attr("height",r);var m=this;this.skew=function(){var t=m.width,e=m.height;return function(i){var n=i[0]*h+(t-s)/2+l*h,a=i[1]*u+(e-r)/2+o*u;return[n,a]}}()},updateMarkerSizeLimits:function(){var t=this,e=this.model.marker.size.extent||[0,1],i=this.activeProfile.minRadius,n=this.activeProfile.maxRadius;this.minRadius=Math.max(n*e[0],i),this.maxRadius=Math.max(n*e[1],i),"ordinal"!==this.model.marker.size.scaleType?this.sScale.range([s.radiusToArea(t.minRadius),s.radiusToArea(t.maxRadius)]):this.sScale.rangePoints([s.radiusToArea(t.minRadius),s.radiusToArea(t.maxRadius)],0).range()},_interact:function(){var t=this;return{_mouseover:function(e,i){t.model.time.dragging||(t.model.marker.highlightMarker(e),t.hovered=e,t.updateTitleNumbers(),t.fitSizeOfTitles(),t.model.marker.isSelected(e)?t._setTooltip():t._setTooltip(e))},_mouseout:function(e,i){t.model.time.dragging||(t._setTooltip(),t.hovered=null,t.updateTitleNumbers(),t.fitSizeOfTitles(),t.model.marker.clearHighlighted())},_click:function(e,i){t.model.marker.selectMarker(e)}}},highlightMarkers:function(){var t=this;this.someHighlighted=this.model.marker.highlight.length>0,s.isTouchDevice()&&(this.someHighlighted?t.hovered=this.model.marker.highlight[0]:t.hovered=null,t.updateTitleNumbers(),t.fitSizeOfTitles())},_updateLabel:function(t,e,i,n,a,r,o,l){var c=this,h=this.KEY;if(t[h]!=c.druging&&(null==l&&(l=c.duration),c.model.marker.isSelected(t))){var u=t.hidden!==t.hidden_1,d=null,f={};f.labelX0=i/this.width,f.labelY0=n/this.height,f.scaledS0=a?s.areaToRadius(c.sScale(a)):null,f.scaledC0=null!=r?c.cScale(r):c.COLOR_WHITEISH,this._labels.updateLabel(t,e,f,i/this.width,n/this.height,a,r,o,d,l,u)}},selectMarkers:function(){var t=this;this.KEY;this.someSelected=this.model.marker.select.length>0,s.isTouchDevice()?(t._labels.showCloseCross(null,!1),t.someHighlighted?t.model.marker.clearHighlighted():(t.updateTitleNumbers(),t.fitSizeOfTitles())):t.hovered&&!t.model.marker.isSelected(t.hovered)||t._setTooltip(),this.nonSelectedOpacityZero=!1},_setTooltip:function(t){if(t){var e,i,n=t.label,a=t.cLoc[0],r=t.cLoc[1],s=t.r,o=d3.mouse(this.graph.node()).map(function(t){return parseInt(t)}),l=-1,c=-1,h=0,u=0;s&&(h=.71*s,u=.71*s),this.tooltip.classed("vzb-hidden",!1).selectAll("text").text(n);var d=this.tooltip.select("text")[0][0].getBBox();a-h-d.width<0?(l=1,a+=d.width+5):a-=5,r-u-d.height<0?(c=1,r+=d.height):r-=11,s?(e=a+h*l,i=r+u*c):(e=a+h*l,i=r+u*c),this.tooltip.attr("transform","translate("+(e?e:o[0])+","+(i?i:o[1])+")"),this.tooltip.select("rect").attr("width",d.width+8).attr("height",1.2*d.height).attr("x",-d.width-4).attr("y",.85*-d.height).attr("rx",.2*d.height).attr("ry",.2*d.height)}else this.tooltip.classed("vzb-hidden",!0)},preload:function(){var t=this,e=this.model.ui.map.topology.path||y.default.ext_resources.host+y.default.ext_resources.preloadPath+"world-50m.json";return new Promise(function(i,n){d3.json(e,function(n,a){return n?console.warn("Failed loading json "+e+". "+n):(t.topology=a,void i())})})}});e.default=x},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),s=a(r),o=i(2),l=n(o),c=l.default.extend("donut",{init:function(t,e){var i=this;this.name="donutchart",this.template='<div class="vzb-donutchart"><svg class="vzb-donutchart-svg"></svg></div>',this.model_expects=[{name:"time",type:"time"},{name:"marker",type:"model"}],this.model_binds={"change:time:value":function(t){i._readyOnce&&(i.time=i.model.time.value,i.yearEl.text(i.timeFormatter(i.time)),i.redraw())}},this._super(t,e),this.colorScale=null,this.arc=d3.svg.arc(),this.pie=d3.layout.pie().sort(null).value(function(t){return t.pop})},readyOnce:function(){var t=this;this.element=d3.select(this.element),this.svgEl=this.element.select("svg").append("g"),this.yearEl=this.svgEl.append("text").attr("class","year").style({"font-size":"4em"}),this.titleEl=this.svgEl.append("text").attr("class","title").style({"font-size":"2em"}),this.on("resize",function(){t.resize(),t.redraw()}),this.resize(),this.update(),this.redraw()},update:function(){this.timeFormatter=this.model.time.formatters.data("%Y"),this.colorScale=this.model.marker.color.getScale(),this.titleEl.text("Population"),this.keys=this.model.marker.getKeys(),this.entities=this.svgEl.selectAll(".vzb-dc-entity").data(this.keys),this.entities.exit().remove(),this.entities.enter().append("g").attr("class","vzb-dc-entity").each(function(){d3.select(this).append("path"),d3.select(this).append("text").attr("class","label").style({"font-size":"1.2em"})})},redraw:function(){var t=this;this.values=this.model.marker.getValues({time:t.time},["geo"]);var e=this.keys.map(function(e){return{geo:e.geo,pop:t.values.axis[e.geo],color:t.values.color[e.geo],label:t.values.label[e.geo]}});e=this.pie(e),this.entities.data(e).select("path").attr("d",this.arc).style("fill",function(e){return t.colorScale(e.data.color)}).style("stroke","white"),this.entities.select("text").style({"text-transform":"capitalize"}).attr("transform",function(e){return"translate("+t.arc.centroid(e)+")"}).text(function(t){return t.data.geo})},resize:function(){var t=parseInt(this.element.style("height"),10)||0,e=parseInt(this.element.style("width"),10)||0,i=Math.min(t,e);return t<=0||e<=0?s.warn("Donut chart resize() abort: vizabi container is too little or has display:none"):(this.svgEl.attr("transform","translate("+e/2+","+t/2+")"),this.titleEl.attr("y","-0.1em"),this.yearEl.attr("y","0.1em"),void this.arc.outerRadius(i/2*.9).innerRadius(i/2-.1*i))}});e.default=c},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),s=a(r),o=i(2),l=n(o),c=i(10),h=i(137),u=n(h),d=i(40),f=n(d),m=i(227),p=n(m),g=i(229),v=n(g),b=i(228),y=n(b),x=i(66),_=n(x),M=i(45),w=n(M),z=.001,S="#d3d3d3",k=l.default.extend({init:function(t,e){var n=this;this.name="mountainchart",this.template=i(453),this.model_expects=[{name:"time",type:"time"},{name:"entities",type:"entities"},{name:"marker",type:"model"},{name:"locale",type:"locale"},{name:"ui",type:"ui"}],this.model_binds={"change:time.value":function(t){n._readyOnce&&n.model.marker.getFrame(n.model.time.value,n.frameChanged.bind(n))},"change:time.playing":function(t){n.model.time.playing||n.redrawDataPoints()},"change:marker.axis_x.xScaleFactor":function(){n.ready()},"change:marker.axis_x.xScaleShift":function(){n.ready()},"change:marker.axis_x.tailFatX":function(){n.ready()},"change:marker.axis_x.tailCutX":function(){n.ready()},"change:marker.axis_x.tailFade":function(){n.ready()},"change:ui.chart.probeX":function(){n.ready()},"change:ui.chart.showProbeX":function(){n.ready()},"change:ui.chart.xPoints":function(){n.ready()},"change:ui.chart.xLogStops":function(){n.updateSize()},"change:ui.chart.yMaxMethod":function(){n._adjustMaxY({force:!0}),n.redrawDataPoints()},"change:time.record":function(t){n.model.time.record?n._export.open(this.element,this.name):n._export.reset()},"change:marker.highlight":function(t){n._readyOnce&&(n.highlightMarkers(),n.updateOpacity())},"change:marker.select":function(t){n._readyOnce&&(n.selectMarkers(),n._selectlist.redraw(),n.updateOpacity(),n.updateDoubtOpacity(),n.redrawDataPoints())},"change:marker.opacitySelectDim":function(t){n.updateOpacity()},"change:marker.opacityRegular":function(t){n.updateOpacity()},"change:marker":function(t,e){if(n._readyOnce)return e.indexOf("scaleType")>-1?void n.ready():e.indexOf("zoomedMin")>-1||e.indexOf("zoomedMax")>-1?(n.zoomToMaxMin(),n.redrawDataPoints(),void n._probe.redraw()):void 0},"change:marker.group":function(t,e){n._readyOnce&&(e.indexOf("group.merge")>-1||n.ready())},"change:marker.group.merge":function(t){n._readyOnce&&(n.updatePointers(),n.redrawDataPoints())},"change:marker.stack":function(t){n._readyOnce&&n.ready()},"change:marker.stack.which":function(t){n._readyOnce&&n.model.time.playing&&n.model.time.pause()},"change:marker.stack.use":function(t){n._readyOnce&&n.model.time.playing&&n.model.time.pause()},"change:marker.color.palette":function(t){n._readyOnce&&(n.redrawDataPointsOnlyColors(),n._selectlist.redraw())}},this._super(t,e),this._math=new p.default(this),this._export=new u.default(this),this._export.prefix("vzb-mc-").deleteClasses(["vzb-mc-mountains-mergestacked","vzb-mc-mountains-mergegrouped","vzb-mc-mountains","vzb-mc-year","vzb-mc-mountains-labels","vzb-mc-axis-labels"]),this._probe=new y.default(this),this._selectlist=new v.default(this),this.area=d3.svg.area().interpolate("basis").x(function(t){return n.xScale(n._math.rescale(t.x))}).y0(function(t){return n.yScale(t.y0)}).y1(function(t){return n.yScale(t.y0+t.y)}),this.stack=d3.layout.stack().order("reverse").values(function(t){return n.cached[t.KEY()]}).out(function(t,e,i){t.y0=e}),this.xScale=null,this.yScale=null,this.cScale=null,this.xAxis=(0,f.default)(),this.rangeRatio=1,this.rangeShift=0,this.cached={},this.mesh=[],this.yMax=0},domReady:function(){var t=this;this.element=d3.select(this.element),this.graph=this.element.select(".vzb-mc-graph"),this.xAxisEl=this.graph.select(".vzb-mc-axis-x"),this.xTitleEl=this.graph.select(".vzb-mc-axis-x-title"),this.yTitleEl=this.graph.select(".vzb-mc-axis-y-title"),this.infoEl=this.graph.select(".vzb-mc-axis-info"),this.dataWarningEl=this.graph.select(".vzb-data-warning"),this.yearEl=this.graph.select(".vzb-mc-year"),this.year=new _.default(this.yearEl),this.mountainMergeStackedContainer=this.graph.select(".vzb-mc-mountains-mergestacked"),this.mountainMergeGroupedContainer=this.graph.select(".vzb-mc-mountains-mergegrouped"),this.mountainAtomicContainer=this.graph.select(".vzb-mc-mountains"),this.mountainLabelContainer=this.graph.select(".vzb-mc-mountains-labels"),this.tooltip=this.element.select(".vzb-mc-tooltip"),this.eventAreaEl=this.element.select(".vzb-mc-eventarea"),this.probeEl=this.element.select(".vzb-mc-probe"),this.probeLineEl=this.probeEl.select("line"),this.probeTextEl=this.probeEl.selectAll("text"),this.element.onTap(function(e,i){t._interact()._mouseout(e,i)})},afterPreload:function(){var t=this,e=t.model.time.formatDate(this.model.time.value),i=t.model.time.formatDate(this.model.time.end);if(this._math.xScaleFactor=this.model.marker.axis_x.xScaleFactor,this._math.xScaleShift=this.model.marker.axis_x.xScaleShift,this.precomputedShapes&&this.precomputedShapes[e]&&this.precomputedShapes[i]){var n=this.precomputedShapes["immediate"==this.model.ui.chart.yMaxMethod?e:i].yMax,a=this.precomputedShapes[e].shape;n&&a&&0!==a.length&&(this.xScale=d3.scale.log().domain([this.model.marker.axis_x.domainMin,this.model.marker.axis_x.domainMax]),this.yScale=d3.scale.linear().domain([0,Math.round(n)]),t.updateSize(a.length),t.zoomToMaxMin(),a=a.map(function(e,i){return{x:t.mesh[i],y0:0,y:+e}}),this.mountainAtomicContainer.selectAll(".vzb-mc-prerender").data([0]).enter().append("path").attr("class","vzb-mc-prerender").style("fill","pink").style("opacity",0).attr("d",t.area(a)).transition().duration(1e3).ease("linear").style("opacity",1))}},readyOnce:function(){this.eventAreaEl.on("mousemove",function(){t.model.time.dragging||t.model.ui.chart.showProbeX&&t._probe.redraw({level:t.xScale.invert(d3.mouse(this)[0]),full:!0})}).on("mouseout",function(){t.model.time.dragging||t.model.ui.chart.showProbeX&&t._probe.redraw()});var t=this;this.on("resize",function(){t.updateSize()||(t.updatePointers(),t.redrawDataPoints(),t._selectlist.redraw(),t._probe.redraw())}),this.KEY=this.model.entities.getDimension(),this.TIMEDIM=this.model.time.getDimension(),this.mountainAtomicContainer.select(".vzb-mc-prerender").remove(),this.year.setText(this.model.time.formatDate(this.model.time.value)),this.wScale=d3.scale.linear().domain(this.model.ui.datawarning.doubtDomain).range(this.model.ui.datawarning.doubtRange)},ready:function(){var t=this;this._math.xScaleFactor=this.model.marker.axis_x.xScaleFactor,this._math.xScaleShift=this.model.marker.axis_x.xScaleShift,this.updateUIStrings(),this.updateIndicators(),this.model.marker.getFrame(this.model.time.value,function(e){e&&(t.values=e,t.updateEntities(),t.updateSize(),t.zoomToMaxMin(),t._spawnMasks(),t.updateTime(),t.updatePointers(),t._adjustMaxY({force:!0}),t.redrawDataPoints(),t.redrawDataPointsOnlyColors(),t.highlightMarkers(),t.selectMarkers(),t._selectlist.redraw(),t.updateOpacity(),t.updateDoubtOpacity(),t._probe.redraw())})},frameChanged:function(t,e){return t?void(e.toString()==this.model.time.value.toString()&&(this.values=t,this.updateTime(),this.updatePointers(),this.redrawDataPoints(),this._selectlist.redraw(),this._probe.redraw(),this.updateDoubtOpacity())):s.warn("change:time.value: empty data received from marker.getFrame(). doing nothing")},updateSize:function(t){var e,i,n={small:{margin:{top:10,right:10,left:10,bottom:18},infoElHeight:16},medium:{margin:{top:20,right:20,left:20,bottom:30},infoElHeight:20},large:{margin:{top:30,right:30,left:30,bottom:35},infoElHeight:22}},a={medium:{margin:{top:20,right:20,left:20,bottom:50},infoElHeight:26},large:{margin:{top:30,right:30,left:30,bottom:50},infoElHeight:32}};if(this.activeProfile=this.getActiveProfile(n,a),e=this.activeProfile.margin,i=this.activeProfile.infoElHeight,this.height=parseInt(this.element.style("height"),10)-e.top-e.bottom||0,this.width=parseInt(this.element.style("width"),10)-e.left-e.right||0,this.height<=0||this.width<=0)return s.warn("Mountain chart updateSize() abort: vizabi container is too little or has display:none");this.graph.attr("transform","translate("+e.left+","+e.top+")");var r=this.model.locale.isRTL(),o={topOffset:"large"===this.getLayoutProfile()?2*e.top:0,xAlign:"large"===this.getLayoutProfile()?r?"left":"right":"center",yAlign:"large"===this.getLayoutProfile()?"top":"center",widthRatio:"large"===this.getLayoutProfile()?3/8:.8};this.year.setConditions(o).resize(this.width,this.height),this.yScale.range([this.height,0]),this.xScale.range([this.rangeShift,this.width*this.rangeRatio+this.rangeShift]);var l=this._readyOnce?this.model.marker.axis_x.scaleType:"log";this.xAxis.scale(this.xScale).orient("bottom").tickSize(6,0).tickPadding(9).tickSizeMinor(3,0).labelerOptions({scaleType:l,toolMargin:e,pivotingLimit:1.5*e.bottom,method:this.xAxis.METHOD_REPEATING,stops:this._readyOnce?this.model.ui.chart.xLogStops:[1],formatter:this.model.marker.axis_x.getTickFormatter()}),this.xAxisEl.attr("transform","translate(0,"+this.height+")").call(this.xAxis),this.xTitleEl.select("text").attr("transform","translate("+this.width+","+this.height+")").attr("dy","-0.36em"),this.yTitleEl.style("font-size",i+"px").attr("transform","translate("+(r?this.width:0)+","+e.top+")");var c=this.dataWarningEl.select("text").node().getBBox();if(this.dataWarningEl.select("svg").attr("width",c.height).attr("height",c.height).attr("x",.1*c.height).attr("y",1*-c.height+1),this.dataWarningEl.attr("transform","translate("+(r?this.width-c.width-2*c.height:0)+","+(e.top+1.5*c.height)+")").select("text").attr("dx",1.5*c.height),this.infoEl.select("svg").node()){var h=this.yTitleEl.node().getBBox(),u=d3.transform(this.yTitleEl.attr("transform")).translate,d=r?h.x+u[0]-1.4*i:h.x+u[0]+h.width+.4*i;this.infoEl.select("svg").attr("width",i+"px").attr("height",i+"px"),this.infoEl.attr("transform","translate("+d+","+(u[1]-.8*i)+")")}this.eventAreaEl.attr("y",this.height).attr("width",this.width).attr("height",e.bottom),t||(t=this.model.ui.chart.xPoints),this.mesh=this._math.generateMesh(t,l,this.xScale.domain())},zoomToMaxMin:function(){if(null!=this.model.marker.axis_x.zoomedMin&&null!=this.model.marker.axis_x.zoomedMax){var t=this.xScale(this.model.marker.axis_x.zoomedMin),e=this.xScale(this.model.marker.axis_x.zoomedMax);this.rangeRatio=this.width/(e-t)*this.rangeRatio,this.rangeShift=(this.rangeShift-t)/(e-t)*this.width,this.xScale.range([this.rangeShift,this.width*this.rangeRatio+this.rangeShift]),this.xAxisEl.call(this.xAxis)}},updateUIStrings:function(){var t=this;this.translator=this.model.locale.getTFunction();this.model.marker.axis_x.getConceptprops();this.xTitleEl.select("text").text(this.translator("unit/mountainchart_hardcoded_income_per_day")),this.yTitleEl.select("text").text(this.translator("mount/title")),s.setIcon(this.dataWarningEl,c.warn).select("svg").attr("width","0px").attr("height","0px"),this.dataWarningEl.append("text").text(this.translator("hints/dataWarning")),s.setIcon(this.infoEl,c.question).select("svg").attr("width","0px").attr("height","0px"),this.infoEl.on("click",function(){t.parent.findChildByName("gapminder-datanotes").pin()}),this.infoEl.on("mouseover",function(){var e=this.getBBox(),i=s.makeAbsoluteContext(this,this.farthestViewportElement)(e.x-10,e.y+e.height+10),n=t.root.element.getBoundingClientRect(),a=t.element.node().getBoundingClientRect();t.parent.findChildByName("gapminder-datanotes").setHook("axis_y").show().setPos(i.x+a.left-n.left,i.y)}),this.infoEl.on("mouseout",function(){t.parent.findChildByName("gapminder-datanotes").hide()}),this.dataWarningEl.on("click",function(){t.parent.findChildByName("gapminder-datawarning").toggle()}).on("mouseover",function(){t.updateDoubtOpacity(1)}).on("mouseout",function(){t.updateDoubtOpacity()})},updateDoubtOpacity:function(t){null==t&&(t=this.wScale(+this.time.getUTCFullYear().toString())),this.someSelected&&(t=1),this.dataWarningEl.style("opacity",t)},updateIndicators:function(){var t=this;this.yScale=this.model.marker.axis_y.getScale(),this.xScale=this.model.marker.axis_x.getScale(),this.cScale=this.model.marker.color.getScale(),this.xAxis.tickFormat(t.model.marker.axis_x.getTickFormatter())},updateEntities:function(){var t=this;this.mountainPointers=this.model.marker.getKeys().filter(function(e){return t.values.axis_x[e[t.KEY]]&&t.values.axis_y[e[t.KEY]]&&t.values.axis_s[e[t.KEY]]}).map(function(e){var i={};return i[t.KEY]=e[t.KEY],i.KEY=function(){return this[t.KEY]},i.sortValue=[t.values.axis_y[i.KEY()]||0,0],i.aggrLevel=0,i}),this.groupedPointers=d3.nest().key(function(e){return"property"===t.model.marker.stack.use?t.values.stack[e.KEY()]:t.values.group[e.KEY()]}).sortValues(function(t,e){return e.sortValue[0]-t.sortValue[0]}).entries(this.mountainPointers);var e=this.model.marker.group.manualSorting;this.groupedPointers.forEach(function(i){var n=d3.sum(i.values.map(function(t){return t.sortValue[0]}));e&&e.length>1&&(n=e.length-1-e.indexOf(i.key)),i.values.forEach(function(t){t.sortValue[1]=n}),i[t.model.entities.getDimension()]=i.key,i.KEY=function(){return this.key},i.aggrLevel=1});var i={};t.groupedPointers.map(function(t){i[t.key]=t.values[0].sortValue[1]}),"none"===t.model.marker.stack.which?(this.stackedPointers=[],this.mountainPointers.sort(function(t,e){return e.sortValue[0]-t.sortValue[0]})):(this.stackedPointers=d3.nest().key(function(e){return t.values.stack[e.KEY()]}).key(function(e){return t.values.group[e.KEY()]}).sortKeys(function(t,e){return i[e]-i[t]}).sortValues(function(t,e){return e.sortValue[0]-t.sortValue[0]}).entries(this.mountainPointers),this.mountainPointers.sort(function(t,e){return e.sortValue[1]-t.sortValue[1]}),this.stackedPointers.forEach(function(e){e.KEY=function(){return this.key},e[t.model.entities.getDimension()]=e.key,e.aggrLevel=2})),this.mountainsMergeStacked=this.mountainAtomicContainer.selectAll(".vzb-mc-mountain.vzb-mc-aggrlevel2").data(this.stackedPointers),this.mountainsMergeGrouped=this.mountainAtomicContainer.selectAll(".vzb-mc-mountain.vzb-mc-aggrlevel1").data(this.groupedPointers),this.mountainsAtomic=this.mountainAtomicContainer.selectAll(".vzb-mc-mountain.vzb-mc-aggrlevel0").data(this.mountainPointers),this.mountainsMergeStacked.exit().remove(),this.mountainsMergeGrouped.exit().remove(),this.mountainsAtomic.exit().remove(),this.mountainsMergeStacked.enter().append("path").attr("class","vzb-mc-mountain vzb-mc-aggrlevel2"),this.mountainsMergeGrouped.enter().append("path").attr("class","vzb-mc-mountain vzb-mc-aggrlevel1"),this.mountainsAtomic.enter().append("path").attr("class","vzb-mc-mountain vzb-mc-aggrlevel0"),this.mountains=this.mountainAtomicContainer.selectAll(".vzb-mc-mountain"),this.mountains.on("mousemove",function(e,i){s.isTouchDevice()||t._interact()._mousemove(e,i)}).on("mouseout",function(e,i){s.isTouchDevice()||t._interact()._mouseout(e,i)}).on("click",function(e,i){s.isTouchDevice()||(t._interact()._click(e,i),t.highlightMarkers())}).onTap(function(e,i){t._interact()._click(e,i),d3.event.stopPropagation()}).onLongTap(function(t,e){})},_interact:function(){var t=this;return{_mousemove:function(e,i){if(!t.model.time.dragging&&!t.model.time.playing){t.model.marker.highlightMarker(e);d3.mouse(t.graph.node()).map(function(t){return parseInt(t)});t._setTooltip(e.key?t.model.marker.color.getColorlegendMarker().label.getItems()[e.key]:t.values.label[e.KEY()]),t._selectlist.showCloseCross(e,!0)}},_mouseout:function(e,i){t.model.time.dragging||t.model.time.playing||(t._setTooltip(""),t.model.marker.clearHighlighted(),t._selectlist.showCloseCross(e,!1))},_click:function(e,i){t.model.time.dragging||t.model.time.playing||t.model.marker.selectMarker(e)}}},highlightMarkers:function(){var t=this;this.someHighlighted=this.model.marker.highlight.length>0,this.selectList&&this.someSelected&&this.selectList.classed("vzb-highlight",function(e){return t.model.marker.isHighlighted(e)})},selectMarkers:function(){this.someSelected=this.model.marker.select.length>0,this._selectlist.rebuild(),this.nonSelectedOpacityZero=!1},_sumLeafPointersByMarker:function(t,e){var i=this;return t.key?d3.sum(t.values.map(function(t){return i._sumLeafPointersByMarker(t,e)})):i.values[e][t.KEY()]},updateOpacity:function(){var t=this,e=1,i=.3,n=this.model.marker.opacityRegular,a=this.model.marker.opacityRegular,r=this.model.marker.opacitySelectDim;this.mountains.style("opacity",function(s){return t.someHighlighted&&t.model.marker.isHighlighted(s)?e:t.someSelected?t.model.marker.isSelected(s)?n:r:t.someHighlighted?i:a}),this.mountains.classed("vzb-selected",function(e){return t.model.marker.isSelected(e)});var s=t.model.marker.opacitySelectDim<.01;s!==this.nonSelectedOpacityZero&&this.mountainsAtomic.style("pointer-events",function(e){return t.someSelected&&s&&!t.model.marker.isSelected(e)?"none":"visible"}),this.nonSelectedOpacityZero=t.model.marker.opacitySelectDim<.01},updateTime:function(){this.time_1=null==this.time?this.model.time.value:this.time,this.time=this.model.time.value,this.duration=this.model.time.playing&&this.time-this.time_1>0?this.model.time.delayAnimations:0,this.year.setText(this.model.time.formatDate(this.time),this.duration)},updatePointers:function(){var t=this;this.yMax=0,this.mountainPointers.forEach(function(e,i){var n=t._spawn(t.values,e);t.cached[e.KEY()]=n,e.hidden=0===n.length}),"none"!==t.model.marker.stack.which&&this.stackedPointers.forEach(function(e){var i=[];e.values.forEach(function(t){i=i.concat(t.values.filter(function(t){return!t.hidden}))}),t.stack(i)}),this.mountainPointers.forEach(function(e){e.yMax=d3.max(t.cached[e.KEY()].map(function(t){return t.y0+t.y})),t.yMax<e.yMax&&(t.yMax=e.yMax)});var e=t.model.marker.group.merge,i=t.model.marker.stack.merge;this.stackedPointers.forEach(function(e){var i=t._getFirstLastPointersInStack(e);t.cached[e.key]=t._getVerticesOfaMergedShape(i),t.values.color[e.key]="_default",t.values.axis_y[e.key]=t._sumLeafPointersByMarker(e,"axis_y"),e.yMax=i.first.yMax}),this.groupedPointers.forEach(function(e){var i=t._getFirstLastPointersInStack(e);t.cached[e.key]=t._getVerticesOfaMergedShape(i),t.values.color[e.key]=t.values.color[i.first.KEY()],t.values.axis_y[e.key]=t._sumLeafPointersByMarker(e,"axis_y"),e.yMax=i.first.yMax}),i||e||"property"!==this.model.marker.stack.use||this.groupedPointers.forEach(function(t){var e=t.values.filter(function(t){return!t.hidden});t.yMax=e[0].yMax,t.values.forEach(function(e){e.yMaxGroup=t.yMax})})},_getFirstLastPointersInStack:function(t){var e,i;if(t.values[0].values){e=t.values[0].values.filter(function(t){return!t.hidden}),i=t.values[t.values.length-1].values.filter(function(t){return!t.hidden});var n=e[0],a=i[i.length-1]}else{e=t.values.filter(function(t){return!t.hidden});var n=e[0],a=e[e.length-1]}return(!e.length||i&&!i.length)&&s.warn("mountain chart failed to generate shapes. check the incoming data"),{first:n,last:a}},_getVerticesOfaMergedShape:function(t){var e=this,i=t.first.KEY(),n=t.last.KEY();return e.mesh.map(function(t,a){var r=e.cached[i][a].y0+e.cached[i][a].y-e.cached[n][a].y0,s=e.cached[n][a].y0;return{x:t,y0:s,y:r}})},_spawnMasks:function(){var t=this,e=this._math.unscale(this.model.marker.axis_x.tailFatX),i=this._math.unscale(this.model.marker.axis_x.tailCutX),n=this.model.marker.axis_x.tailFade,a=2*Math.PI/(Math.log(e)-Math.log(i)),r=Math.PI-Math.log(e)*a;this.spawnMask=[],this.cosineShape=[],this.cosineArea=0,this.mesh.map(function(s,o){t.spawnMask[o]=s<i?1:s>7*n?0:Math.exp((i-s)/n),t.cosineShape[o]=s>i&&s<e?1+Math.cos(Math.log(s)*a+r):0,t.cosineArea+=t.cosineShape[o]})},_spawn:function(t,e){var i=this,n=t.axis_y[e.KEY()],a=i._math.giniToSigma(t.axis_s[e.KEY()]),r=i._math.gdpToMu(t.axis_x[e.KEY()],a);if(!n||!r||!a)return[];var s=[],o=0;this.mesh.map(function(t,e){s[e]=i._math.pdf.lognormal(t,r,a),o+=i.spawnMask[e]*s[e]});var l=this.mesh.map(function(t,e){return{x:t,y0:0,y:n*(s[e]*(1-i.spawnMask[e])+i.cosineShape[e]/i.cosineArea*o)}});return l},_adjustMaxY:function(t){t||(t={});var e=this,i=this.model.ui.chart.yMaxMethod;if("immediate"===i||t.force)if("latest"===i){var n=e.values;e.model.marker.getFrame(e.model.time.end,function(t){t&&(e.values=t,e.updatePointers(),e.values=n,e.yScale.domain([0,Math.round(e.yMax)]),e.updatePointers(),e.redrawDataPoints())})}else e.yMax||s.warn("Setting yMax to "+e.yMax+". You failed again :-/"),e.yScale.domain([0,Math.round(e.yMax)])},redrawDataPoints:function(){var t=this,e=this.model.marker.group.merge,i=this.model.marker.stack.merge,n=this.model.marker.stack.which,a=(this.model.time.dragging||this.model.time.playing)&&"none"!==n;this._adjustMaxY(),this.mountainsMergeStacked.each(function(e){var n=d3.select(this),a=!i;t._renderShape(n,e.KEY(),a)}),this.mountainsMergeGrouped.each(function(n){var r=d3.select(this),s=!e&&!a||i&&!t.model.marker.isSelected(n);t._renderShape(r,n.KEY(),s)}),this.mountainsAtomic.each(function(n,r){var s=d3.select(this),o=n.hidden||(e||i||a)&&!t.model.marker.isSelected(n);t._renderShape(s,n.KEY(),o)}),"none"===n?this.mountainsAtomic.sort(function(t,e){return e.yMax-t.yMax}):"all"===n||e||a||this.mountainsAtomic.sort(function(t,e){return e.yMaxGroup-t.yMaxGroup})},redrawDataPointsOnlyColors:function(){var t=this;if(!this.mountains)return s.warn("redrawDataPointsOnlyColors(): no mountains  defined. likely a premature call, fix it!");var e="indicator"===this.model.marker.color.use;this.mountains.style("fill",function(i){return t.values.color[i.KEY()]?e&&"_default"==t.values.color[i.KEY()]?t.model.marker.color.palette._default:t.cScale(t.values.color[i.KEY()]):S})},_renderShape:function(t,e,i){var n=this.model.marker.stack.which,a=this;if(t.classed("vzb-hidden",i),i)return void("none"!==n&&t.style("stroke-opacity",0));var r={};r[this.KEY]=e,this.model.marker.isSelected(r)?t.attr("d",this.area(this.cached[e].filter(function(t){return t.y>a.values.axis_y[e]*z}))):t.attr("d",this.area(this.cached[e])),"indicator"===this.model.marker.color.use&&t.style("fill",a.values.color[e]?"_default"!==a.values.color[e]?a.cScale(a.values.color[e]):a.model.marker.color.palette._default:S),"none"!==n&&t.transition().duration(900*Math.random()+100).ease("circle").style("stroke-opacity",.5),this.model.time.record&&this._export.write({type:"path",id:e,time:this.model.time.value.getUTCFullYear(),fill:this.cScale(this.values.color[e]),d:this.area(this.cached[e])})},_setTooltip:function(t){if(t){var e=d3.mouse(this.graph.node()).map(function(t){return parseInt(t)});this.tooltip.classed("vzb-hidden",!1).attr("transform","translate("+e[0]+","+e[1]+")").selectAll("text").attr("text-anchor","middle").attr("alignment-baseline","middle").text(t);var i=this.tooltip.select("text")[0][0].getBBox();this.tooltip.select("rect").attr("width",i.width+8).attr("height",i.height+8).attr("x",-i.width-25).attr("y",-i.height-25).attr("rx",.2*i.height).attr("ry",.2*i.height),this.tooltip.selectAll("text").attr("x",-i.width-25+(i.width+8)/2).attr("y",-i.height-25+(i.height+11)/2);var n=e[0]-i.width-25>0?e[0]:i.width+25,a=e[1]-i.height-25>0?e[1]:i.height+25;this.tooltip.attr("transform","translate("+n+","+a+")")}else this.tooltip.classed("vzb-hidden",!0)},preload:function(){var t=w.default.ext_resources.shapePath?w.default.ext_resources.shapePath:w.default.ext_resources.host+w.default.ext_resources.preloadPath+"mc_precomputed_shapes.json",e=this;return new Promise(function(i,n){d3.json(t,function(n,a){return n?console.warn("Failed loading json "+t+". "+n):(e.precomputedShapes=a,void i())})})}});e.default=k},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),s=(a(r),i(21)),o=n(s),l=o.default.extend({init:function(t){this.context=t,this.xScaleFactor=1,this.xScaleShift=0},rescale:function(t){return Math.exp(this.xScaleFactor*Math.log(t)+this.xScaleShift)},unscale:function(t){return Math.exp((Math.log(t)-this.xScaleShift)/this.xScaleFactor)},generateMesh:function(t,e,i){var n="linear"===e?i[0]:Math.log(this.unscale(i[0])),a="linear"===e?i[1]:Math.log(this.unscale(i[1])),r=(a-n)/t,s=d3.range(n,a,r).concat(a);return s="linear"!==e?s.map(function(t){return Math.exp(t)}):s.filter(function(t){return t>0})},gdpToMu:function(t,e,i,n){return Math.log(t/365)-e*e/2},giniToSigma:function(t){return this.normsinv((t/100+1)/2)*Math.pow(2,.5)},pdf:{normal:function(t,e,i){return Math.exp(-.5*Math.log(2*Math.PI)-Math.log(i)-Math.pow(t-e,2)/(2*i*i))},lognormal:function(t,e,i){return Math.exp(-.5*Math.log(2*Math.PI)-Math.log(i)-Math.pow(Math.log(t)-e,2)/(2*i*i))}},normsinv:function(t){var e=[-39.69683028665376,220.9460984245205,-275.9285104469687,138.357751867269,-30.66479806614716,2.506628277459239],i=[-54.47609879822406,161.5858368580409,-155.6989798598866,66.80131188771972,-13.28068155288572],n=[-.007784894002430293,-.3223964580411365,-2.400758277161838,-2.549732539343734,4.374664141464968,2.938163982698783],a=[.007784695709041462,.3224671290700398,2.445134137142996,3.754408661907416],r=.02425,s=1-r;
if(t<r){var o=Math.sqrt(-2*Math.log(t));return(((((n[0]*o+n[1])*o+n[2])*o+n[3])*o+n[4])*o+n[5])/((((a[0]*o+a[1])*o+a[2])*o+a[3])*o+1)}if(s<t){var o=Math.sqrt(-2*Math.log(1-t));return-(((((n[0]*o+n[1])*o+n[2])*o+n[3])*o+n[4])*o+n[5])/((((a[0]*o+a[1])*o+a[2])*o+a[3])*o+1)}var o=t-.5,l=o*o;return(((((e[0]*l+e[1])*l+e[2])*l+e[3])*l+e[4])*l+e[5])*o/(((((i[0]*l+i[1])*l+i[2])*l+i[3])*l+i[4])*l+1)}});e.default=l},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),s=(a(r),i(21)),o=n(s),l=o.default.extend({init:function(t){this.context=t},redraw:function(t){var e=this.context;if(t||(t={}),t.level||(t.level=e.model.ui.chart.probeX),e.probeEl.classed("vzb-hidden",!t.level||!e.model.ui.chart.showProbeX),t.level){e.xAxisEl.call(e.xAxis.highlightValue(t.full?t.level:"none"));var i=0,n=0,a=0,r=function(r){i+=e.values.axis_y[r.KEY()],e.cached[r.KEY()].forEach(function(i){n+=i.y,e._math.rescale(i.x)<t.level&&(a+=i.y)})};"all"===e.model.marker.stack.which?e.stackedPointers.forEach(r):"none"===e.model.marker.stack.which?e.mountainPointers.forEach(r):e.groupedPointers.forEach(r);var s=d3.format(".3r"),o=e.model.marker.axis_y.getTickFormatter();e.heightOfLabels=e.heightOfLabels||.66*e.height,e.probeTextEl.each(function(i,n){if(8===n){var a=d3.select(this);t.full||e.model.ui.chart.probeX!=e.model.marker.axis_x.tailFatX?a.classed("vzb-hidden",!0):(a.text(e.translator("mount/extremepoverty")).classed("vzb-hidden",!1).attr("x",-e.height).attr("y",e.xScale(t.level)).attr("dy","-1.15em").attr("dx","0.5em").attr("transform","rotate(-90)"),e.heightOfLabels=e.height-a.node().getBBox().width-1.75*a.node().getBBox().height)}}),e.probeTextEl.each(function(r,l){if(8!==l){var c,h=d3.select(this);0!==l&&4!==l||(c=s(a/n*100)+"%"),1!==l&&5!==l||(c=s(100-a/n*100)+"%"),2!==l&&6!==l||(c=o(i*a/n)),3!==l&&7!==l||(c=o(i*(1-a/n))+" "+e.translator("mount/people")),h.text(c).classed("vzb-hidden",!t.full&&0!==l&&4!==l).attr("x",e.xScale(t.level)+([0,4,2,6].indexOf(l)>-1?-6:5)).attr("y",e.heightOfLabels).attr("dy",[0,1,4,5].indexOf(l)>-1?0:"1.5em")}}),e.probeLineEl.attr("x1",e.xScale(t.level)).attr("x2",e.xScale(t.level)).attr("y1",e.height+6).attr("y2",0)}}});e.default=l},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function a(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),s=a(r),o=i(21),l=n(o),c=i(10),h=l.default.extend({init:function(t){this.context=t},rebuild:function(t){var e=this.context,i=this,n=e.mountainPointers.concat(e.groupedPointers).concat(e.stackedPointers).filter(function(t){return e.model.marker.isSelected(t)}).sort(function(t,e){return t.sortValue&&e.sortValue?t.sortValue[1]===e.sortValue[1]?d3.descending(t.sortValue[0],e.sortValue[0]):d3.descending(t.sortValue[1],e.sortValue[1]):t.aggrLevel!=e.aggrLevel?d3.descending(t.aggrLevel,e.aggrLevel):t.aggrLevel&&e.aggrLevel?d3.descending(t.yMax,e.yMax):0});e.selectList=e.mountainLabelContainer.selectAll("g.vzb-mc-label").data(s.unique(n,function(t){return t.KEY()})),e.selectList.exit().remove(),e.selectList.enter().append("g").attr("class","vzb-mc-label").each(function(t,i){var n=d3.select(this);n.append("circle").attr("class","vzb-mc-label-legend"),n.append("text").attr("class","vzb-mc-label-shadow vzb-mc-label-text"),n.append("text").attr("class","vzb-mc-label-text"),n.append("g").attr("class","vzb-mc-label-x vzb-label-shadow vzb-invisible").on("click",function(t,i){s.isTouchDevice()||(d3.event.stopPropagation(),e.model.marker.clearHighlighted(),e.model.marker.selectMarker(t),d3.event.stopPropagation())}).onTap(function(t,i){d3.select("#"+t.geo+"-label-"+e._id).remove(),e.model.marker.clearHighlighted(),e.model.marker.selectMarker(t)});var a=n.select("g.vzb-mc-label-x");s.isTouchDevice()?(a.append("rect"),a.append("text").attr("class","vzb-mc-label-x-text").text("Deselect")):(s.setIcon(a,c.close).select("svg").attr("class","vzb-mc-label-x-icon").attr("width","0px").attr("height","0px"),a.insert("circle","svg"))}).on("mousemove",function(t,n){s.isTouchDevice()||(i.showCloseCross(t,!0),e.model.marker.highlightMarker(t))}).on("mouseout",function(t,n){s.isTouchDevice()||(i.showCloseCross(t,!1),e.model.marker.clearHighlighted())}).on("click",function(t,i){s.isTouchDevice()||(e.model.marker.clearHighlighted(),e.model.marker.selectMarker(t))})},redraw:function(){var t=this.context;if(t.selectList&&t.someSelected){var e=t.mountainLabelContainer.append("g").attr("class","vzb-mc-label").append("text").text("0"),i=1.2*e[0][0].getBBox().height,n=parseFloat(e.style("font-size"))/i;d3.select(e[0][0].parentNode).remove();var a=t.model.marker.axis_y.getTickFormatter(),r=t.yTitleEl.select("text").node().getBBox().height||0,o=(t.height-3*r)/(t.selectList.data().length+2);i>o&&(i=o);var l="null",c=0,h=t.model.marker.color.getColorlegendMarker().label.getItems(),u=t.model.locale.isRTL();t.selectList.attr("transform",function(e,n){e.aggrLevel!=l&&(c+=i);var a=i*n+1.5*r+c;return l=e.aggrLevel,"translate("+(u?t.width:0)+","+a+")"}).each(function(e,r){var l=d3.select(this).attr("id",e.geo+"-label-"+t._id),c="";c=e.key?"all"===e.key?t.translator("mount/merging/world"):h[e.key]:t.values.label[e.KEY()];var d=t.values.axis_y[e.KEY()],f=c+": "+a(d)+(0===r?" "+t.translator("mount/people"):""),m=l.selectAll(".vzb-mc-label-text").attr("x",(u?-1:1)*i).attr("y",i).text(f).style("font-size",i===o?i*n+"px":null),p=m[0][0].getBBox(),g=l.select(".vzb-mc-label-x");if(s.isTouchDevice()){var v=g.select("text").node().getBBox();g.classed("vzb-revert-color",!0).select(".vzb-mc-label-x-text").classed("vzb-revert-color",!0).attr("x",p.width+1.12*p.height+.5*v.width).attr("y",.55*p.height),g.select("rect").attr("width",v.width+.6*p.height).attr("height",p.height).attr("x",p.width+.9*p.height).attr("y",0).attr("rx",.25*p.height).attr("ry",.25*p.height)}else g.attr("x",p.width+1.1*p.height).attr("y",p.height/3),g.select("circle").attr("r",.4*p.height).attr("cx",(u?-1:1)*(p.width+1.1*p.height)).attr("cy",p.height/3),g.select("svg").attr("x",(u?-1:1)*(p.width+p.height*(1.1-(u?-.4:.4)))).attr("y",p.height*(1/3-.4)).attr("width",.8*p.height).attr("height",.8*p.height);l.select(".vzb-mc-label-legend").attr("r",i/3).attr("cx",(u?-1:1)*i*.4).attr("cy",i/1.5).style("fill",t.cScale(t.values.color[e.KEY()])),l.onTap(function(e,i){d3.event.stopPropagation(),t.model.marker.highlightMarker(e),setTimeout(function(){t.model.marker.unhighlightMarker(e)},2e3)})})}},showCloseCross:function(t,e){var i=this.context,n=i.KEY;i.selectList.filter(function(e){return e[n]==t[n]}).select(".vzb-mc-label-x").classed("vzb-invisible",!e)}});e.default=h},function(t,e,i){i(239),t.exports=i(35).RegExp.escape},function(t,e,i){var n=i(6),a=i(97),r=i(7)("species");t.exports=function(t){var e;return a(t)&&(e=t.constructor,"function"!=typeof e||e!==Array&&!a(e.prototype)||(e=void 0),n(e)&&(e=e[r],null===e&&(e=void 0))),void 0===e?Array:e}},function(t,e,i){var n=i(231);t.exports=function(t,e){return new(n(t))(e)}},function(t,e,i){"use strict";var n=i(3),a=i(33),r="number";t.exports=function(t){if("string"!==t&&t!==r&&"default"!==t)throw TypeError("Incorrect hint");return a(n(this),t!=r)}},function(t,e,i){var n=i(53),a=i(80),r=i(69);t.exports=function(t){var e=n(t),i=a.f;if(i)for(var s,o=i(t),l=r.f,c=0;o.length>c;)l.call(t,s=o[c++])&&e.push(s);return e}},function(t,e,i){var n=i(53),a=i(20);t.exports=function(t,e){for(var i,r=a(t),s=n(r),o=s.length,l=0;o>l;)if(r[i=s[l++]]===e)return i}},function(t,e,i){"use strict";var n=i(237),a=i(76),r=i(16);t.exports=function(){for(var t=r(this),e=arguments.length,i=Array(e),s=0,o=n._,l=!1;e>s;)(i[s]=arguments[s++])===o&&(l=!0);return function(){var n,r=this,s=arguments.length,c=0,h=0;if(!l&&!s)return a(t,i,r);if(n=i.slice(),l)for(;e>c;c++)n[c]===o&&(n[c]=arguments[h++]);for(;s>h;)n.push(arguments[h++]);return a(t,n,r)}}},function(t,e,i){t.exports=i(4)},function(t,e){t.exports=function(t,e){var i=e===Object(e)?function(t){return e[t]}:e;return function(e){return String(e).replace(t,i)}}},function(t,e,i){var n=i(0),a=i(238)(/[\\^$*+?.()|[\]{}]/g,"\\$&");n(n.S,"RegExp",{escape:function(t){return a(t)}})},function(t,e,i){var n=i(0);n(n.P,"Array",{copyWithin:i(154)}),i(60)("copyWithin")},function(t,e,i){"use strict";var n=i(0),a=i(31)(4);n(n.P+n.F*!i(30)([].every,!0),"Array",{every:function(t){return a(this,t,arguments[1])}})},function(t,e,i){var n=i(0);n(n.P,"Array",{fill:i(89)}),i(60)("fill")},function(t,e,i){"use strict";var n=i(0),a=i(31)(2);n(n.P+n.F*!i(30)([].filter,!0),"Array",{filter:function(t){return a(this,t,arguments[1])}})},function(t,e,i){"use strict";var n=i(0),a=i(31)(6),r="findIndex",s=!0;r in[]&&Array(1)[r](function(){s=!1}),n(n.P+n.F*s,"Array",{findIndex:function(t){return a(this,t,arguments.length>1?arguments[1]:void 0)}}),i(60)(r)},function(t,e,i){"use strict";var n=i(0),a=i(31)(5),r="find",s=!0;r in[]&&Array(1)[r](function(){s=!1}),n(n.P+n.F*s,"Array",{find:function(t){return a(this,t,arguments.length>1?arguments[1]:void 0)}}),i(60)(r)},function(t,e,i){"use strict";var n=i(0),a=i(31)(0),r=i(30)([].forEach,!0);n(n.P+n.F*!r,"Array",{forEach:function(t){return a(this,t,arguments[1])}})},function(t,e,i){"use strict";var n=i(36),a=i(0),r=i(13),s=i(163),o=i(96),l=i(12),c=i(90),h=i(113);a(a.S+a.F*!i(78)(function(t){Array.from(t)}),"Array",{from:function(t){var e,i,a,u,d=r(t),f="function"==typeof this?this:Array,m=arguments.length,p=m>1?arguments[1]:void 0,g=void 0!==p,v=0,b=h(d);if(g&&(p=n(p,m>2?arguments[2]:void 0,2)),void 0==b||f==Array&&o(b))for(e=l(d.length),i=new f(e);e>v;v++)c(i,v,g?p(d[v],v):d[v]);else for(u=b.call(d),i=new f;!(a=u.next()).done;v++)c(i,v,g?s(u,p,[a.value,v],!0):a.value);return i.length=v,i}})},function(t,e,i){"use strict";var n=i(0),a=i(72)(!1),r=[].indexOf,s=!!r&&1/[1].indexOf(1,-0)<0;n(n.P+n.F*(s||!i(30)(r)),"Array",{indexOf:function(t){return s?r.apply(this,arguments)||0:a(this,t,arguments[1])}})},function(t,e,i){var n=i(0);n(n.S,"Array",{isArray:i(97)})},function(t,e,i){"use strict";var n=i(0),a=i(20),r=[].join;n(n.P+n.F*(i(68)!=Object||!i(30)(r)),"Array",{join:function(t){return r.call(a(this),void 0===t?",":t)}})},function(t,e,i){"use strict";var n=i(0),a=i(20),r=i(44),s=i(12),o=[].lastIndexOf,l=!!o&&1/[1].lastIndexOf(1,-0)<0;n(n.P+n.F*(l||!i(30)(o)),"Array",{lastIndexOf:function(t){if(l)return o.apply(this,arguments)||0;var e=a(this),i=s(e.length),n=i-1;for(arguments.length>1&&(n=Math.min(n,r(arguments[1]))),n<0&&(n=i+n);n>=0;n--)if(n in e&&e[n]===t)return n||0;return-1}})},function(t,e,i){"use strict";var n=i(0),a=i(31)(1);n(n.P+n.F*!i(30)([].map,!0),"Array",{map:function(t){return a(this,t,arguments[1])}})},function(t,e,i){"use strict";var n=i(0),a=i(90);n(n.S+n.F*i(5)(function(){function t(){}return!(Array.of.call(t)instanceof t)}),"Array",{of:function(){for(var t=0,e=arguments.length,i=new("function"==typeof this?this:Array)(e);e>t;)a(i,t,arguments[t++]);return i.length=e,i}})},function(t,e,i){"use strict";var n=i(0),a=i(156);n(n.P+n.F*!i(30)([].reduceRight,!0),"Array",{reduceRight:function(t){return a(this,t,arguments.length,arguments[1],!0)}})},function(t,e,i){"use strict";var n=i(0),a=i(156);n(n.P+n.F*!i(30)([].reduce,!0),"Array",{reduce:function(t){return a(this,t,arguments.length,arguments[1],!1)}})},function(t,e,i){"use strict";var n=i(0),a=i(94),r=i(28),s=i(56),o=i(12),l=[].slice;n(n.P+n.F*i(5)(function(){a&&l.call(a)}),"Array",{slice:function(t,e){var i=o(this.length),n=r(this);if(e=void 0===e?i:e,"Array"==n)return l.call(this,t,e);for(var a=s(t,i),c=s(e,i),h=o(c-a),u=Array(h),d=0;d<h;d++)u[d]="String"==n?this.charAt(a+d):this[a+d];return u}})},function(t,e,i){"use strict";var n=i(0),a=i(31)(3);n(n.P+n.F*!i(30)([].some,!0),"Array",{some:function(t){return a(this,t,arguments[1])}})},function(t,e,i){"use strict";var n=i(0),a=i(16),r=i(13),s=i(5),o=[].sort,l=[1,2,3];n(n.P+n.F*(s(function(){l.sort(void 0)})||!s(function(){l.sort(null)})||!i(30)(o)),"Array",{sort:function(t){return void 0===t?o.call(r(this)):o.call(r(this),a(t))}})},function(t,e,i){i(55)("Array")},function(t,e,i){var n=i(0);n(n.S,"Date",{now:function(){return(new Date).getTime()}})},function(t,e,i){"use strict";var n=i(0),a=i(5),r=Date.prototype.getTime,s=function(t){return t>9?t:"0"+t};n(n.P+n.F*(a(function(){return"0385-07-25T07:06:39.999Z"!=new Date(-5e13-1).toISOString()})||!a(function(){new Date(NaN).toISOString()})),"Date",{toISOString:function(){if(!isFinite(r.call(this)))throw RangeError("Invalid time value");var t=this,e=t.getUTCFullYear(),i=t.getUTCMilliseconds(),n=e<0?"-":e>9999?"+":"";return n+("00000"+Math.abs(e)).slice(n?-6:-4)+"-"+s(t.getUTCMonth()+1)+"-"+s(t.getUTCDate())+"T"+s(t.getUTCHours())+":"+s(t.getUTCMinutes())+":"+s(t.getUTCSeconds())+"."+(i>99?i:"0"+s(i))+"Z"}})},function(t,e,i){"use strict";var n=i(0),a=i(13),r=i(33);n(n.P+n.F*i(5)(function(){return null!==new Date(NaN).toJSON()||1!==Date.prototype.toJSON.call({toISOString:function(){return 1}})}),"Date",{toJSON:function(t){var e=a(this),i=r(e);return"number"!=typeof i||isFinite(i)?e.toISOString():null}})},function(t,e,i){var n=i(7)("toPrimitive"),a=Date.prototype;n in a||i(17)(a,n,i(233))},function(t,e,i){var n=Date.prototype,a="Invalid Date",r="toString",s=n[r],o=n.getTime;new Date(NaN)+""!=a&&i(18)(n,r,function(){var t=o.call(this);return t===t?s.call(this):a})},function(t,e,i){var n=i(0);n(n.P,"Function",{bind:i(157)})},function(t,e,i){"use strict";var n=i(6),a=i(26),r=i(7)("hasInstance"),s=Function.prototype;r in s||i(9).f(s,r,{value:function(t){if("function"!=typeof this||!n(t))return!1;if(!n(this.prototype))return t instanceof this;for(;t=a(t);)if(this.prototype===t)return!0;return!1}})},function(t,e,i){var n=i(9).f,a=i(43),r=i(15),s=Function.prototype,o=/^\s*function ([^ (]*)/,l="name",c=Object.isExtensible||function(){return!0};l in s||i(8)&&n(s,l,{configurable:!0,get:function(){try{var t=this,e=(""+t).match(o)[1];return r(t,l)||!c(t)||n(t,l,a(5,e)),e}catch(t){return""}}})},function(t,e,i){var n=i(0),a=i(165),r=Math.sqrt,s=Math.acosh;n(n.S+n.F*!(s&&710==Math.floor(s(Number.MAX_VALUE))&&s(1/0)==1/0),"Math",{acosh:function(t){return(t=+t)<1?NaN:t>94906265.62425156?Math.log(t)+Math.LN2:a(t-1+r(t-1)*r(t+1))}})},function(t,e,i){function n(t){return isFinite(t=+t)&&0!=t?t<0?-n(-t):Math.log(t+Math.sqrt(t*t+1)):t}var a=i(0),r=Math.asinh;a(a.S+a.F*!(r&&1/r(0)>0),"Math",{asinh:n})},function(t,e,i){var n=i(0),a=Math.atanh;n(n.S+n.F*!(a&&1/a(-0)<0),"Math",{atanh:function(t){return 0==(t=+t)?t:Math.log((1+t)/(1-t))/2}})},function(t,e,i){var n=i(0),a=i(101);n(n.S,"Math",{cbrt:function(t){return a(t=+t)*Math.pow(Math.abs(t),1/3)}})},function(t,e,i){var n=i(0);n(n.S,"Math",{clz32:function(t){return(t>>>=0)?31-Math.floor(Math.log(t+.5)*Math.LOG2E):32}})},function(t,e,i){var n=i(0),a=Math.exp;n(n.S,"Math",{cosh:function(t){return(a(t=+t)+a(-t))/2}})},function(t,e,i){var n=i(0),a=i(100);n(n.S+n.F*(a!=Math.expm1),"Math",{expm1:a})},function(t,e,i){var n=i(0),a=i(101),r=Math.pow,s=r(2,-52),o=r(2,-23),l=r(2,127)*(2-o),c=r(2,-126),h=function(t){return t+1/s-1/s};n(n.S,"Math",{fround:function(t){var e,i,n=Math.abs(t),r=a(t);return n<c?r*h(n/c/o)*c*o:(e=(1+o/s)*n,i=e-(e-n),i>l||i!=i?r*(1/0):r*i)}})},function(t,e,i){var n=i(0),a=Math.abs;n(n.S,"Math",{hypot:function(t,e){for(var i,n,r=0,s=0,o=arguments.length,l=0;s<o;)i=a(arguments[s++]),l<i?(n=l/i,r=r*n*n+1,l=i):i>0?(n=i/l,r+=n*n):r+=i;return l===1/0?1/0:l*Math.sqrt(r)}})},function(t,e,i){var n=i(0),a=Math.imul;n(n.S+n.F*i(5)(function(){return a(4294967295,5)!=-5||2!=a.length}),"Math",{imul:function(t,e){var i=65535,n=+t,a=+e,r=i&n,s=i&a;return 0|r*s+((i&n>>>16)*s+r*(i&a>>>16)<<16>>>0)}})},function(t,e,i){var n=i(0);n(n.S,"Math",{log10:function(t){return Math.log(t)/Math.LN10}})},function(t,e,i){var n=i(0);n(n.S,"Math",{log1p:i(165)})},function(t,e,i){var n=i(0);n(n.S,"Math",{log2:function(t){return Math.log(t)/Math.LN2}})},function(t,e,i){var n=i(0);n(n.S,"Math",{sign:i(101)})},function(t,e,i){var n=i(0),a=i(100),r=Math.exp;n(n.S+n.F*i(5)(function(){return!Math.sinh(-2e-17)!=-2e-17}),"Math",{sinh:function(t){return Math.abs(t=+t)<1?(a(t)-a(-t))/2:(r(t-1)-r(-t-1))*(Math.E/2)}})},function(t,e,i){var n=i(0),a=i(100),r=Math.exp;n(n.S,"Math",{tanh:function(t){var e=a(t=+t),i=a(-t);return e==1/0?1:i==1/0?-1:(e-i)/(r(t)+r(-t))}})},function(t,e,i){var n=i(0);n(n.S,"Math",{trunc:function(t){return(t>0?Math.floor:Math.ceil)(t)}})},function(t,e,i){"use strict";var n=i(4),a=i(15),r=i(28),s=i(95),o=i(33),l=i(5),c=i(52).f,h=i(25).f,u=i(9).f,d=i(64).trim,f="Number",m=n[f],p=m,g=m.prototype,v=r(i(51)(g))==f,b="trim"in String.prototype,y=function(t){var e=o(t,!1);if("string"==typeof e&&e.length>2){e=b?e.trim():d(e,3);var i,n,a,r=e.charCodeAt(0);if(43===r||45===r){if(i=e.charCodeAt(2),88===i||120===i)return NaN}else if(48===r){switch(e.charCodeAt(1)){case 66:case 98:n=2,a=49;break;case 79:case 111:n=8,a=55;break;default:return+e}for(var s,l=e.slice(2),c=0,h=l.length;c<h;c++)if(s=l.charCodeAt(c),s<48||s>a)return NaN;return parseInt(l,n)}}return+e};if(!m(" 0o1")||!m("0b1")||m("+0x1")){m=function(t){var e=arguments.length<1?0:t,i=this;return i instanceof m&&(v?l(function(){g.valueOf.call(i)}):r(i)!=f)?s(new p(y(e)),i,m):y(e)};for(var x,_=i(8)?c(p):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),M=0;_.length>M;M++)a(p,x=_[M])&&!a(m,x)&&u(m,x,h(p,x));m.prototype=g,g.constructor=m,i(18)(n,f,m)}},function(t,e,i){var n=i(0);n(n.S,"Number",{EPSILON:Math.pow(2,-52)})},function(t,e,i){var n=i(0),a=i(4).isFinite;n(n.S,"Number",{isFinite:function(t){return"number"==typeof t&&a(t)}})},function(t,e,i){var n=i(0);n(n.S,"Number",{isInteger:i(162)})},function(t,e,i){var n=i(0);n(n.S,"Number",{isNaN:function(t){return t!=t}})},function(t,e,i){var n=i(0),a=i(162),r=Math.abs;n(n.S,"Number",{isSafeInteger:function(t){return a(t)&&r(t)<=9007199254740991}})},function(t,e,i){var n=i(0);n(n.S,"Number",{MAX_SAFE_INTEGER:9007199254740991})},function(t,e,i){var n=i(0);n(n.S,"Number",{MIN_SAFE_INTEGER:-9007199254740991})},function(t,e,i){var n=i(0),a=i(172);n(n.S+n.F*(Number.parseFloat!=a),"Number",{parseFloat:a})},function(t,e,i){var n=i(0),a=i(173);n(n.S+n.F*(Number.parseInt!=a),"Number",{parseInt:a})},function(t,e,i){"use strict";var n=i(0),a=i(44),r=i(153),s=i(108),o=1..toFixed,l=Math.floor,c=[0,0,0,0,0,0],h="Number.toFixed: incorrect invocation!",u="0",d=function(t,e){for(var i=-1,n=e;++i<6;)n+=t*c[i],c[i]=n%1e7,n=l(n/1e7)},f=function(t){for(var e=6,i=0;--e>=0;)i+=c[e],c[e]=l(i/t),i=i%t*1e7},m=function(){for(var t=6,e="";--t>=0;)if(""!==e||0===t||0!==c[t]){var i=String(c[t]);e=""===e?i:e+s.call(u,7-i.length)+i}return e},p=function(t,e,i){return 0===e?i:e%2===1?p(t,e-1,i*t):p(t*t,e/2,i)},g=function(t){for(var e=0,i=t;i>=4096;)e+=12,i/=4096;for(;i>=2;)e+=1,i/=2;return e};n(n.P+n.F*(!!o&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0))||!i(5)(function(){o.call({})})),"Number",{toFixed:function(t){var e,i,n,o,l=r(this,h),c=a(t),v="",b=u;if(c<0||c>20)throw RangeError(h);if(l!=l)return"NaN";if(l<=-1e21||l>=1e21)return String(l);if(l<0&&(v="-",l=-l),l>1e-21)if(e=g(l*p(2,69,1))-69,i=e<0?l*p(2,-e,1):l/p(2,e,1),i*=4503599627370496,e=52-e,e>0){for(d(0,i),n=c;n>=7;)d(1e7,0),n-=7;for(d(p(10,n,1),0),n=e-1;n>=23;)f(1<<23),n-=23;f(1<<n),d(1,1),f(2),b=m()}else d(0,i),d(1<<-e,0),b=m()+s.call(u,c);return c>0?(o=b.length,b=v+(o<=c?"0."+s.call(u,c-o)+b:b.slice(0,o-c)+"."+b.slice(o-c))):b=v+b,b}})},function(t,e,i){"use strict";var n=i(0),a=i(5),r=i(153),s=1..toPrecision;n(n.P+n.F*(a(function(){return"1"!==s.call(1,void 0)})||!a(function(){s.call({})})),"Number",{toPrecision:function(t){var e=r(this,"Number#toPrecision: incorrect invocation!");return void 0===t?s.call(e):s.call(e,t)}})},function(t,e,i){var n=i(0);n(n.S+n.F,"Object",{assign:i(166)})},function(t,e,i){var n=i(0);n(n.S,"Object",{create:i(51)})},function(t,e,i){var n=i(0);n(n.S+n.F*!i(8),"Object",{defineProperties:i(167)})},function(t,e,i){var n=i(0);n(n.S+n.F*!i(8),"Object",{defineProperty:i(9).f})},function(t,e,i){var n=i(6),a=i(42).onFreeze;i(32)("freeze",function(t){return function(e){return t&&n(e)?t(a(e)):e}})},function(t,e,i){var n=i(20),a=i(25).f;i(32)("getOwnPropertyDescriptor",function(){return function(t,e){return a(n(t),e)}})},function(t,e,i){i(32)("getOwnPropertyNames",function(){return i(168).f})},function(t,e,i){var n=i(13),a=i(26);i(32)("getPrototypeOf",function(){return function(t){return a(n(t))}})},function(t,e,i){var n=i(6);i(32)("isExtensible",function(t){return function(e){return!!n(e)&&(!t||t(e))}})},function(t,e,i){var n=i(6);i(32)("isFrozen",function(t){return function(e){return!n(e)||!!t&&t(e)}})},function(t,e,i){var n=i(6);i(32)("isSealed",function(t){return function(e){return!n(e)||!!t&&t(e)}})},function(t,e,i){var n=i(0);n(n.S,"Object",{is:i(174)})},function(t,e,i){var n=i(13),a=i(53);i(32)("keys",function(){return function(t){return a(n(t))}})},function(t,e,i){var n=i(6),a=i(42).onFreeze;i(32)("preventExtensions",function(t){return function(e){return t&&n(e)?t(a(e)):e}})},function(t,e,i){var n=i(6),a=i(42).onFreeze;i(32)("seal",function(t){return function(e){return t&&n(e)?t(a(e)):e}})},function(t,e,i){var n=i(0);n(n.S,"Object",{setPrototypeOf:i(103).set})},function(t,e,i){"use strict";var n=i(67),a={};a[i(7)("toStringTag")]="z",a+""!="[object z]"&&i(18)(Object.prototype,"toString",function(){return"[object "+n(this)+"]"},!0)},function(t,e,i){var n=i(0),a=i(172);n(n.G+n.F*(parseFloat!=a),{parseFloat:a})},function(t,e,i){var n=i(0),a=i(173);n(n.G+n.F*(parseInt!=a),{parseInt:a})},function(t,e,i){"use strict";var n,a,r,s=i(50),o=i(4),l=i(36),c=i(67),h=i(0),u=i(6),d=i(16),f=i(49),m=i(61),p=i(105),g=i(110).set,v=i(102)(),b="Promise",y=o.TypeError,x=o.process,_=o[b],x=o.process,M="process"==c(x),w=function(){},z=!!function(){try{var t=_.resolve(1),e=(t.constructor={})[i(7)("species")]=function(t){t(w,w)};return(M||"function"==typeof PromiseRejectionEvent)&&t.then(w)instanceof e}catch(t){}}(),S=function(t,e){return t===e||t===_&&e===r},k=function(t){var e;return!(!u(t)||"function"!=typeof(e=t.then))&&e},E=function(t){return S(_,t)?new O(t):new a(t)},O=a=function(t){var e,i;this.promise=new t(function(t,n){if(void 0!==e||void 0!==i)throw y("Bad Promise constructor");e=t,i=n}),this.resolve=d(e),this.reject=d(i)},T=function(t){try{t()}catch(t){return{error:t}}},P=function(t,e){if(!t._n){t._n=!0;var i=t._c;v(function(){for(var n=t._v,a=1==t._s,r=0,s=function(e){var i,r,s=a?e.ok:e.fail,o=e.resolve,l=e.reject,c=e.domain;try{s?(a||(2==t._h&&C(t),t._h=1),s===!0?i=n:(c&&c.enter(),i=s(n),c&&c.exit()),i===e.promise?l(y("Promise-chain cycle")):(r=k(i))?r.call(i,o,l):o(i)):l(n)}catch(t){l(t)}};i.length>r;)s(i[r++]);t._c=[],t._n=!1,e&&!t._h&&D(t)})}},D=function(t){g.call(o,function(){var e,i,n,a=t._v;if(I(t)&&(e=T(function(){M?x.emit("unhandledRejection",a,t):(i=o.onunhandledrejection)?i({promise:t,reason:a}):(n=o.console)&&n.error&&n.error("Unhandled promise rejection",a)}),t._h=M||I(t)?2:1),t._a=void 0,e)throw e.error})},I=function(t){if(1==t._h)return!1;for(var e,i=t._a||t._c,n=0;i.length>n;)if(e=i[n++],e.fail||!I(e.promise))return!1;return!0},C=function(t){g.call(o,function(){var e;M?x.emit("rejectionHandled",t):(e=o.onrejectionhandled)&&e({promise:t,reason:t._v})})},A=function(t){var e=this;e._d||(e._d=!0,e=e._w||e,e._v=t,e._s=2,e._a||(e._a=e._c.slice()),P(e,!0))},L=function(t){var e,i=this;if(!i._d){i._d=!0,i=i._w||i;try{if(i===t)throw y("Promise can't be resolved itself");(e=k(t))?v(function(){var n={_w:i,_d:!1};try{e.call(t,l(L,n,1),l(A,n,1))}catch(t){A.call(n,t)}}):(i._v=t,i._s=1,P(i,!1))}catch(t){A.call({_w:i,_d:!1},t)}}};z||(_=function(t){f(this,_,b,"_h"),d(t),n.call(this);try{t(l(L,this,1),l(A,this,1))}catch(t){A.call(this,t)}},n=function(t){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1},n.prototype=i(54)(_.prototype,{then:function(t,e){var i=E(p(this,_));return i.ok="function"!=typeof t||t,i.fail="function"==typeof e&&e,i.domain=M?x.domain:void 0,this._c.push(i),this._a&&this._a.push(i),this._s&&P(this,!1),i.promise},catch:function(t){return this.then(void 0,t)}}),O=function(){var t=new n;this.promise=t,this.resolve=l(L,t,1),this.reject=l(A,t,1)}),h(h.G+h.W+h.F*!z,{Promise:_}),i(63)(_,b),i(55)(b),r=i(35)[b],h(h.S+h.F*!z,b,{reject:function(t){var e=E(this),i=e.reject;return i(t),e.promise}}),h(h.S+h.F*(s||!z),b,{resolve:function(t){if(t instanceof _&&S(t.constructor,this))return t;var e=E(this),i=e.resolve;return i(t),e.promise}}),h(h.S+h.F*!(z&&i(78)(function(t){_.all(t).catch(w)})),b,{all:function(t){var e=this,i=E(e),n=i.resolve,a=i.reject,r=T(function(){var i=[],r=0,s=1;m(t,!1,function(t){var o=r++,l=!1;i.push(void 0),s++,e.resolve(t).then(function(t){l||(l=!0,i[o]=t,--s||n(i))},a)}),--s||n(i)});return r&&a(r.error),i.promise},race:function(t){var e=this,i=E(e),n=i.reject,a=T(function(){m(t,!1,function(t){e.resolve(t).then(i.resolve,n)})});return a&&n(a.error),i.promise}})},function(t,e,i){var n=i(0),a=i(16),r=i(3),s=(i(4).Reflect||{}).apply,o=Function.apply;n(n.S+n.F*!i(5)(function(){s(function(){})}),"Reflect",{apply:function(t,e,i){var n=a(t),l=r(i);return s?s(n,e,l):o.call(n,e,l)}})},function(t,e,i){var n=i(0),a=i(51),r=i(16),s=i(3),o=i(6),l=i(5),c=i(157),h=(i(4).Reflect||{}).construct,u=l(function(){function t(){}return!(h(function(){},[],t)instanceof t)}),d=!l(function(){h(function(){})});n(n.S+n.F*(u||d),"Reflect",{construct:function(t,e){r(t),s(e);var i=arguments.length<3?t:r(arguments[2]);if(d&&!u)return h(t,e,i);if(t==i){switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3])}var n=[null];return n.push.apply(n,e),new(c.apply(t,n))}var l=i.prototype,f=a(o(l)?l:Object.prototype),m=Function.apply.call(t,f,e);return o(m)?m:f}})},function(t,e,i){var n=i(9),a=i(0),r=i(3),s=i(33);a(a.S+a.F*i(5)(function(){Reflect.defineProperty(n.f({},1,{value:1}),1,{value:2})}),"Reflect",{defineProperty:function(t,e,i){r(t),e=s(e,!0),r(i);try{return n.f(t,e,i),!0}catch(t){return!1}}})},function(t,e,i){var n=i(0),a=i(25).f,r=i(3);n(n.S,"Reflect",{deleteProperty:function(t,e){var i=a(r(t),e);return!(i&&!i.configurable)&&delete t[e]}})},function(t,e,i){"use strict";var n=i(0),a=i(3),r=function(t){this._t=a(t),this._i=0;var e,i=this._k=[];for(e in t)i.push(e)};i(98)(r,"Object",function(){var t,e=this,i=e._k;do if(e._i>=i.length)return{value:void 0,done:!0};while(!((t=i[e._i++])in e._t));return{value:t,done:!1}}),n(n.S,"Reflect",{enumerate:function(t){return new r(t)}})},function(t,e,i){var n=i(25),a=i(0),r=i(3);a(a.S,"Reflect",{getOwnPropertyDescriptor:function(t,e){return n.f(r(t),e)}})},function(t,e,i){var n=i(0),a=i(26),r=i(3);n(n.S,"Reflect",{getPrototypeOf:function(t){return a(r(t))}})},function(t,e,i){function n(t,e){var i,o,h=arguments.length<3?t:arguments[2];return c(t)===h?t[e]:(i=a.f(t,e))?s(i,"value")?i.value:void 0!==i.get?i.get.call(h):void 0:l(o=r(t))?n(o,e,h):void 0}var a=i(25),r=i(26),s=i(15),o=i(0),l=i(6),c=i(3);o(o.S,"Reflect",{get:n})},function(t,e,i){var n=i(0);n(n.S,"Reflect",{has:function(t,e){return e in t}})},function(t,e,i){var n=i(0),a=i(3),r=Object.isExtensible;n(n.S,"Reflect",{isExtensible:function(t){return a(t),!r||r(t)}})},function(t,e,i){var n=i(0);n(n.S,"Reflect",{ownKeys:i(171)})},function(t,e,i){var n=i(0),a=i(3),r=Object.preventExtensions;n(n.S,"Reflect",{preventExtensions:function(t){a(t);try{return r&&r(t),!0}catch(t){return!1}}})},function(t,e,i){var n=i(0),a=i(103);a&&n(n.S,"Reflect",{setPrototypeOf:function(t,e){a.check(t,e);try{return a.set(t,e),!0}catch(t){return!1}}})},function(t,e,i){function n(t,e,i){var l,d,f=arguments.length<4?t:arguments[3],m=r.f(h(t),e);if(!m){if(u(d=s(t)))return n(d,e,i,f);m=c(0)}return o(m,"value")?!(m.writable===!1||!u(f))&&(l=r.f(f,e)||c(0),l.value=i,a.f(f,e,l),!0):void 0!==m.set&&(m.set.call(f,i),!0)}var a=i(9),r=i(25),s=i(26),o=i(15),l=i(0),c=i(43),h=i(3),u=i(6);l(l.S,"Reflect",{set:n})},function(t,e,i){var n=i(4),a=i(95),r=i(9).f,s=i(52).f,o=i(77),l=i(75),c=n.RegExp,h=c,u=c.prototype,d=/a/g,f=/a/g,m=new c(d)!==d;if(i(8)&&(!m||i(5)(function(){return f[i(7)("match")]=!1,c(d)!=d||c(f)==f||"/a/i"!=c(d,"i")}))){c=function(t,e){var i=this instanceof c,n=o(t),r=void 0===e;return!i&&n&&t.constructor===c&&r?t:a(m?new h(n&&!r?t.source:t,e):h((n=t instanceof c)?t.source:t,n&&r?l.call(t):e),i?this:u,c)};for(var p=(function(t){t in c||r(c,t,{configurable:!0,get:function(){return h[t]},set:function(e){h[t]=e}})}),g=s(h),v=0;g.length>v;)p(g[v++]);u.constructor=c,c.prototype=u,i(18)(n,"RegExp",c)}i(55)("RegExp")},function(t,e,i){i(74)("match",1,function(t,e,i){return[function(i){"use strict";var n=t(this),a=void 0==i?void 0:i[e];return void 0!==a?a.call(i,n):new RegExp(i)[e](String(n))},i]})},function(t,e,i){i(74)("replace",2,function(t,e,i){return[function(n,a){"use strict";var r=t(this),s=void 0==n?void 0:n[e];return void 0!==s?s.call(n,r,a):i.call(String(r),n,a)},i]})},function(t,e,i){i(74)("search",1,function(t,e,i){return[function(i){"use strict";var n=t(this),a=void 0==i?void 0:i[e];return void 0!==a?a.call(i,n):new RegExp(i)[e](String(n))},i]})},function(t,e,i){i(74)("split",2,function(t,e,n){"use strict";var a=i(77),r=n,s=[].push,o="split",l="length",c="lastIndex";if("c"=="abbc"[o](/(b)*/)[1]||4!="test"[o](/(?:)/,-1)[l]||2!="ab"[o](/(?:ab)*/)[l]||4!="."[o](/(.?)(.?)/)[l]||"."[o](/()()/)[l]>1||""[o](/.?/)[l]){var h=void 0===/()??/.exec("")[1];n=function(t,e){var i=String(this);if(void 0===t&&0===e)return[];if(!a(t))return r.call(i,t,e);var n,o,u,d,f,m=[],p=(t.ignoreCase?"i":"")+(t.multiline?"m":"")+(t.unicode?"u":"")+(t.sticky?"y":""),g=0,v=void 0===e?4294967295:e>>>0,b=new RegExp(t.source,p+"g");for(h||(n=new RegExp("^"+b.source+"$(?!\\s)",p));(o=b.exec(i))&&(u=o.index+o[0][l],!(u>g&&(m.push(i.slice(g,o.index)),!h&&o[l]>1&&o[0].replace(n,function(){for(f=1;f<arguments[l]-2;f++)void 0===arguments[f]&&(o[f]=void 0)}),o[l]>1&&o.index<i[l]&&s.apply(m,o.slice(1)),d=o[0][l],g=u,m[l]>=v)));)b[c]===o.index&&b[c]++;return g===i[l]?!d&&b.test("")||m.push(""):m.push(i.slice(g)),m[l]>v?m.slice(0,v):m}}else"0"[o](void 0,0)[l]&&(n=function(t,e){return void 0===t&&0===e?[]:r.call(this,t,e)});return[function(i,a){var r=t(this),s=void 0==i?void 0:i[e];return void 0!==s?s.call(i,r,a):n.call(String(r),i,a)},n]})},function(t,e,i){"use strict";i(178);var n=i(3),a=i(75),r=i(8),s="toString",o=/./[s],l=function(t){i(18)(RegExp.prototype,s,t,!0)};i(5)(function(){return"/a/b"!=o.call({source:"a",flags:"b"})})?l(function(){var t=n(this);return"/".concat(t.source,"/","flags"in t?t.flags:!r&&t instanceof RegExp?a.call(t):void 0)}):o.name!=s&&l(function(){return o.call(this)})},function(t,e,i){"use strict";i(19)("anchor",function(t){return function(e){return t(this,"a","name",e)}})},function(t,e,i){"use strict";i(19)("big",function(t){return function(){return t(this,"big","","")}})},function(t,e,i){"use strict";i(19)("blink",function(t){return function(){return t(this,"blink","","")}})},function(t,e,i){"use strict";i(19)("bold",function(t){return function(){return t(this,"b","","")}})},function(t,e,i){"use strict";var n=i(0),a=i(106)(!1);n(n.P,"String",{codePointAt:function(t){return a(this,t)}})},function(t,e,i){"use strict";var n=i(0),a=i(12),r=i(107),s="endsWith",o=""[s];n(n.P+n.F*i(93)(s),"String",{endsWith:function(t){var e=r(this,t,s),i=arguments.length>1?arguments[1]:void 0,n=a(e.length),l=void 0===i?n:Math.min(a(i),n),c=String(t);return o?o.call(e,c,l):e.slice(l-c.length,l)===c}})},function(t,e,i){"use strict";i(19)("fixed",function(t){return function(){return t(this,"tt","","");
}})},function(t,e,i){"use strict";i(19)("fontcolor",function(t){return function(e){return t(this,"font","color",e)}})},function(t,e,i){"use strict";i(19)("fontsize",function(t){return function(e){return t(this,"font","size",e)}})},function(t,e,i){var n=i(0),a=i(56),r=String.fromCharCode,s=String.fromCodePoint;n(n.S+n.F*(!!s&&1!=s.length),"String",{fromCodePoint:function(t){for(var e,i=[],n=arguments.length,s=0;n>s;){if(e=+arguments[s++],a(e,1114111)!==e)throw RangeError(e+" is not a valid code point");i.push(e<65536?r(e):r(((e-=65536)>>10)+55296,e%1024+56320))}return i.join("")}})},function(t,e,i){"use strict";var n=i(0),a=i(107),r="includes";n(n.P+n.F*i(93)(r),"String",{includes:function(t){return!!~a(this,t,r).indexOf(t,arguments.length>1?arguments[1]:void 0)}})},function(t,e,i){"use strict";i(19)("italics",function(t){return function(){return t(this,"i","","")}})},function(t,e,i){"use strict";var n=i(106)(!0);i(99)(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,e=this._t,i=this._i;return i>=e.length?{value:void 0,done:!0}:(t=n(e,i),this._i+=t.length,{value:t,done:!1})})},function(t,e,i){"use strict";i(19)("link",function(t){return function(e){return t(this,"a","href",e)}})},function(t,e,i){var n=i(0),a=i(20),r=i(12);n(n.S,"String",{raw:function(t){for(var e=a(t.raw),i=r(e.length),n=arguments.length,s=[],o=0;i>o;)s.push(String(e[o++])),o<n&&s.push(String(arguments[o]));return s.join("")}})},function(t,e,i){var n=i(0);n(n.P,"String",{repeat:i(108)})},function(t,e,i){"use strict";i(19)("small",function(t){return function(){return t(this,"small","","")}})},function(t,e,i){"use strict";var n=i(0),a=i(12),r=i(107),s="startsWith",o=""[s];n(n.P+n.F*i(93)(s),"String",{startsWith:function(t){var e=r(this,t,s),i=a(Math.min(arguments.length>1?arguments[1]:void 0,e.length)),n=String(t);return o?o.call(e,n,i):e.slice(i,i+n.length)===n}})},function(t,e,i){"use strict";i(19)("strike",function(t){return function(){return t(this,"strike","","")}})},function(t,e,i){"use strict";i(19)("sub",function(t){return function(){return t(this,"sub","","")}})},function(t,e,i){"use strict";i(19)("sup",function(t){return function(){return t(this,"sup","","")}})},function(t,e,i){"use strict";i(64)("trim",function(t){return function(){return t(this,3)}})},function(t,e,i){"use strict";var n=i(4),a=i(15),r=i(8),s=i(0),o=i(18),l=i(42).KEY,c=i(5),h=i(81),u=i(63),d=i(57),f=i(7),m=i(176),p=i(112),g=i(235),v=i(234),b=i(97),y=i(3),x=i(20),_=i(33),M=i(43),w=i(51),z=i(168),S=i(25),k=i(9),E=i(53),O=S.f,T=k.f,P=z.f,D=n.Symbol,I=n.JSON,C=I&&I.stringify,A="prototype",L=f("_hidden"),R=f("toPrimitive"),j={}.propertyIsEnumerable,N=h("symbol-registry"),F=h("symbols"),B=h("op-symbols"),q=Object[A],H="function"==typeof D,Y=n.QObject,V=!Y||!Y[A]||!Y[A].findChild,X=r&&c(function(){return 7!=w(T({},"a",{get:function(){return T(this,"a",{value:7}).a}})).a})?function(t,e,i){var n=O(q,e);n&&delete q[e],T(t,e,i),n&&t!==q&&T(q,e,n)}:T,W=function(t){var e=F[t]=w(D[A]);return e._k=t,e},K=H&&"symbol"==typeof D.iterator?function(t){return"symbol"==typeof t}:function(t){return t instanceof D},U=function(t,e,i){return t===q&&U(B,e,i),y(t),e=_(e,!0),y(i),a(F,e)?(i.enumerable?(a(t,L)&&t[L][e]&&(t[L][e]=!1),i=w(i,{enumerable:M(0,!1)})):(a(t,L)||T(t,L,M(1,{})),t[L][e]=!0),X(t,e,i)):T(t,e,i)},G=function(t,e){y(t);for(var i,n=v(e=x(e)),a=0,r=n.length;r>a;)U(t,i=n[a++],e[i]);return t},Q=function(t,e){return void 0===e?w(t):G(w(t),e)},Z=function(t){var e=j.call(this,t=_(t,!0));return!(this===q&&a(F,t)&&!a(B,t))&&(!(e||!a(this,t)||!a(F,t)||a(this,L)&&this[L][t])||e)},$=function(t,e){if(t=x(t),e=_(e,!0),t!==q||!a(F,e)||a(B,e)){var i=O(t,e);return!i||!a(F,e)||a(t,L)&&t[L][e]||(i.enumerable=!0),i}},J=function(t){for(var e,i=P(x(t)),n=[],r=0;i.length>r;)a(F,e=i[r++])||e==L||e==l||n.push(e);return n},tt=function(t){for(var e,i=t===q,n=P(i?B:x(t)),r=[],s=0;n.length>s;)!a(F,e=n[s++])||i&&!a(q,e)||r.push(F[e]);return r};H||(D=function(){if(this instanceof D)throw TypeError("Symbol is not a constructor!");var t=d(arguments.length>0?arguments[0]:void 0),e=function(i){this===q&&e.call(B,i),a(this,L)&&a(this[L],t)&&(this[L][t]=!1),X(this,t,M(1,i))};return r&&V&&X(q,t,{configurable:!0,set:e}),W(t)},o(D[A],"toString",function(){return this._k}),S.f=$,k.f=U,i(52).f=z.f=J,i(69).f=Z,i(80).f=tt,r&&!i(50)&&o(q,"propertyIsEnumerable",Z,!0),m.f=function(t){return W(f(t))}),s(s.G+s.W+s.F*!H,{Symbol:D});for(var et="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),it=0;et.length>it;)f(et[it++]);for(var et=E(f.store),it=0;et.length>it;)p(et[it++]);s(s.S+s.F*!H,"Symbol",{for:function(t){return a(N,t+="")?N[t]:N[t]=D(t)},keyFor:function(t){if(K(t))return g(N,t);throw TypeError(t+" is not a symbol!")},useSetter:function(){V=!0},useSimple:function(){V=!1}}),s(s.S+s.F*!H,"Object",{create:Q,defineProperty:U,defineProperties:G,getOwnPropertyDescriptor:$,getOwnPropertyNames:J,getOwnPropertySymbols:tt}),I&&s(s.S+s.F*(!H||c(function(){var t=D();return"[null]"!=C([t])||"{}"!=C({a:t})||"{}"!=C(Object(t))})),"JSON",{stringify:function(t){if(void 0!==t&&!K(t)){for(var e,i,n=[t],a=1;arguments.length>a;)n.push(arguments[a++]);return e=n[1],"function"==typeof e&&(i=e),!i&&b(e)||(e=function(t,e){if(i&&(e=i.call(this,t,e)),!K(e))return e}),n[1]=e,C.apply(I,n)}}}),D[A][R]||i(17)(D[A],R,D[A].valueOf),u(D,"Symbol"),u(Math,"Math",!0),u(n.JSON,"JSON",!0)},function(t,e,i){"use strict";var n=i(0),a=i(82),r=i(111),s=i(3),o=i(56),l=i(12),c=i(6),h=i(4).ArrayBuffer,u=i(105),d=r.ArrayBuffer,f=r.DataView,m=a.ABV&&h.isView,p=d.prototype.slice,g=a.VIEW,v="ArrayBuffer";n(n.G+n.W+n.F*(h!==d),{ArrayBuffer:d}),n(n.S+n.F*!a.CONSTR,v,{isView:function(t){return m&&m(t)||c(t)&&g in t}}),n(n.P+n.U+n.F*i(5)(function(){return!new d(2).slice(1,void 0).byteLength}),v,{slice:function(t,e){if(void 0!==p&&void 0===e)return p.call(s(this),t);for(var i=s(this).byteLength,n=o(t,i),a=o(void 0===e?i:e,i),r=new(u(this,d))(l(a-n)),c=new f(this),h=new f(r),m=0;n<a;)h.setUint8(m++,c.getUint8(n++));return r}}),i(55)(v)},function(t,e,i){var n=i(0);n(n.G+n.W+n.F*!i(82).ABV,{DataView:i(111).DataView})},function(t,e,i){i(38)("Float32",4,function(t){return function(e,i,n){return t(this,e,i,n)}})},function(t,e,i){i(38)("Float64",8,function(t){return function(e,i,n){return t(this,e,i,n)}})},function(t,e,i){i(38)("Int16",2,function(t){return function(e,i,n){return t(this,e,i,n)}})},function(t,e,i){i(38)("Int32",4,function(t){return function(e,i,n){return t(this,e,i,n)}})},function(t,e,i){i(38)("Int8",1,function(t){return function(e,i,n){return t(this,e,i,n)}})},function(t,e,i){i(38)("Uint16",2,function(t){return function(e,i,n){return t(this,e,i,n)}})},function(t,e,i){i(38)("Uint32",4,function(t){return function(e,i,n){return t(this,e,i,n)}})},function(t,e,i){i(38)("Uint8",1,function(t){return function(e,i,n){return t(this,e,i,n)}})},function(t,e,i){i(38)("Uint8",1,function(t){return function(e,i,n){return t(this,e,i,n)}},!0)},function(t,e,i){"use strict";var n=i(160);i(73)("WeakSet",function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},{add:function(t){return n.def(this,t,!0)}},n,!1,!0)},function(t,e,i){"use strict";var n=i(0),a=i(72)(!0);n(n.P,"Array",{includes:function(t){return a(this,t,arguments.length>1?arguments[1]:void 0)}}),i(60)("includes")},function(t,e,i){var n=i(0),a=i(102)(),r=i(4).process,s="process"==i(28)(r);n(n.G,{asap:function(t){var e=s&&r.domain;a(e?e.bind(t):t)}})},function(t,e,i){var n=i(0),a=i(28);n(n.S,"Error",{isError:function(t){return"Error"===a(t)}})},function(t,e,i){var n=i(0);n(n.P+n.R,"Map",{toJSON:i(159)("Map")})},function(t,e,i){var n=i(0);n(n.S,"Math",{iaddh:function(t,e,i,n){var a=t>>>0,r=e>>>0,s=i>>>0;return r+(n>>>0)+((a&s|(a|s)&~(a+s>>>0))>>>31)|0}})},function(t,e,i){var n=i(0);n(n.S,"Math",{imulh:function(t,e){var i=65535,n=+t,a=+e,r=n&i,s=a&i,o=n>>16,l=a>>16,c=(o*s>>>0)+(r*s>>>16);return o*l+(c>>16)+((r*l>>>0)+(c&i)>>16)}})},function(t,e,i){var n=i(0);n(n.S,"Math",{isubh:function(t,e,i,n){var a=t>>>0,r=e>>>0,s=i>>>0;return r-(n>>>0)-((~a&s|~(a^s)&a-s>>>0)>>>31)|0}})},function(t,e,i){var n=i(0);n(n.S,"Math",{umulh:function(t,e){var i=65535,n=+t,a=+e,r=n&i,s=a&i,o=n>>>16,l=a>>>16,c=(o*s>>>0)+(r*s>>>16);return o*l+(c>>>16)+((r*l>>>0)+(c&i)>>>16)}})},function(t,e,i){"use strict";var n=i(0),a=i(13),r=i(16),s=i(9);i(8)&&n(n.P+i(79),"Object",{__defineGetter__:function(t,e){s.f(a(this),t,{get:r(e),enumerable:!0,configurable:!0})}})},function(t,e,i){"use strict";var n=i(0),a=i(13),r=i(16),s=i(9);i(8)&&n(n.P+i(79),"Object",{__defineSetter__:function(t,e){s.f(a(this),t,{set:r(e),enumerable:!0,configurable:!0})}})},function(t,e,i){var n=i(0),a=i(170)(!0);n(n.S,"Object",{entries:function(t){return a(t)}})},function(t,e,i){var n=i(0),a=i(171),r=i(20),s=i(25),o=i(90);n(n.S,"Object",{getOwnPropertyDescriptors:function(t){for(var e,i=r(t),n=s.f,l=a(i),c={},h=0;l.length>h;)o(c,e=l[h++],n(i,e));return c}})},function(t,e,i){"use strict";var n=i(0),a=i(13),r=i(33),s=i(26),o=i(25).f;i(8)&&n(n.P+i(79),"Object",{__lookupGetter__:function(t){var e,i=a(this),n=r(t,!0);do if(e=o(i,n))return e.get;while(i=s(i))}})},function(t,e,i){"use strict";var n=i(0),a=i(13),r=i(33),s=i(26),o=i(25).f;i(8)&&n(n.P+i(79),"Object",{__lookupSetter__:function(t){var e,i=a(this),n=r(t,!0);do if(e=o(i,n))return e.set;while(i=s(i))}})},function(t,e,i){var n=i(0),a=i(170)(!1);n(n.S,"Object",{values:function(t){return a(t)}})},function(t,e,i){"use strict";var n=i(0),a=i(4),r=i(35),s=i(102)(),o=i(7)("observable"),l=i(16),c=i(3),h=i(49),u=i(54),d=i(17),f=i(61),m=f.RETURN,p=function(t){return null==t?void 0:l(t)},g=function(t){var e=t._c;e&&(t._c=void 0,e())},v=function(t){return void 0===t._o},b=function(t){v(t)||(t._o=void 0,g(t))},y=function(t,e){c(t),this._c=void 0,this._o=t,t=new x(this);try{var i=e(t),n=i;null!=i&&("function"==typeof i.unsubscribe?i=function(){n.unsubscribe()}:l(i),this._c=i)}catch(e){return void t.error(e)}v(this)&&g(this)};y.prototype=u({},{unsubscribe:function(){b(this)}});var x=function(t){this._s=t};x.prototype=u({},{next:function(t){var e=this._s;if(!v(e)){var i=e._o;try{var n=p(i.next);if(n)return n.call(i,t)}catch(t){try{b(e)}finally{throw t}}}},error:function(t){var e=this._s;if(v(e))throw t;var i=e._o;e._o=void 0;try{var n=p(i.error);if(!n)throw t;t=n.call(i,t)}catch(t){try{g(e)}finally{throw t}}return g(e),t},complete:function(t){var e=this._s;if(!v(e)){var i=e._o;e._o=void 0;try{var n=p(i.complete);t=n?n.call(i,t):void 0}catch(t){try{g(e)}finally{throw t}}return g(e),t}}});var _=function(t){h(this,_,"Observable","_f")._f=l(t)};u(_.prototype,{subscribe:function(t){return new y(t,this._f)},forEach:function(t){var e=this;return new(r.Promise||a.Promise)(function(i,n){l(t);var a=e.subscribe({next:function(e){try{return t(e)}catch(t){n(t),a.unsubscribe()}},error:n,complete:i})})}}),u(_,{from:function(t){var e="function"==typeof this?this:_,i=p(c(t)[o]);if(i){var n=c(i.call(t));return n.constructor===e?n:new e(function(t){return n.subscribe(t)})}return new e(function(e){var i=!1;return s(function(){if(!i){try{if(f(t,!1,function(t){if(e.next(t),i)return m})===m)return}catch(t){if(i)throw t;return void e.error(t)}e.complete()}}),function(){i=!0}})},of:function(){for(var t=0,e=arguments.length,i=Array(e);t<e;)i[t]=arguments[t++];return new("function"==typeof this?this:_)(function(t){var e=!1;return s(function(){if(!e){for(var n=0;n<i.length;++n)if(t.next(i[n]),e)return;t.complete()}}),function(){e=!0}})}}),d(_.prototype,o,function(){return this}),n(n.G,{Observable:_}),i(55)("Observable")},function(t,e,i){var n=i(37),a=i(3),r=n.key,s=n.set;n.exp({defineMetadata:function(t,e,i,n){s(t,e,a(i),r(n))}})},function(t,e,i){var n=i(37),a=i(3),r=n.key,s=n.map,o=n.store;n.exp({deleteMetadata:function(t,e){var i=arguments.length<3?void 0:r(arguments[2]),n=s(a(e),i,!1);if(void 0===n||!n.delete(t))return!1;if(n.size)return!0;var l=o.get(e);return l.delete(i),!!l.size||o.delete(e)}})},function(t,e,i){var n=i(179),a=i(155),r=i(37),s=i(3),o=i(26),l=r.keys,c=r.key,h=function(t,e){var i=l(t,e),r=o(t);if(null===r)return i;var s=h(r,e);return s.length?i.length?a(new n(i.concat(s))):s:i};r.exp({getMetadataKeys:function(t){return h(s(t),arguments.length<2?void 0:c(arguments[1]))}})},function(t,e,i){var n=i(37),a=i(3),r=i(26),s=n.has,o=n.get,l=n.key,c=function(t,e,i){var n=s(t,e,i);if(n)return o(t,e,i);var a=r(e);return null!==a?c(t,a,i):void 0};n.exp({getMetadata:function(t,e){return c(t,a(e),arguments.length<3?void 0:l(arguments[2]))}})},function(t,e,i){var n=i(37),a=i(3),r=n.keys,s=n.key;n.exp({getOwnMetadataKeys:function(t){return r(a(t),arguments.length<2?void 0:s(arguments[1]))}})},function(t,e,i){var n=i(37),a=i(3),r=n.get,s=n.key;n.exp({getOwnMetadata:function(t,e){return r(t,a(e),arguments.length<3?void 0:s(arguments[2]))}})},function(t,e,i){var n=i(37),a=i(3),r=i(26),s=n.has,o=n.key,l=function(t,e,i){var n=s(t,e,i);if(n)return!0;var a=r(e);return null!==a&&l(t,a,i)};n.exp({hasMetadata:function(t,e){return l(t,a(e),arguments.length<3?void 0:o(arguments[2]))}})},function(t,e,i){var n=i(37),a=i(3),r=n.has,s=n.key;n.exp({hasOwnMetadata:function(t,e){return r(t,a(e),arguments.length<3?void 0:s(arguments[2]))}})},function(t,e,i){var n=i(37),a=i(3),r=i(16),s=n.key,o=n.set;n.exp({metadata:function(t,e){return function(i,n){o(t,e,(void 0!==n?a:r)(i),s(n))}}})},function(t,e,i){var n=i(0);n(n.P+n.R,"Set",{toJSON:i(159)("Set")})},function(t,e,i){"use strict";var n=i(0),a=i(106)(!0);n(n.P,"String",{at:function(t){return a(this,t)}})},function(t,e,i){"use strict";var n=i(0),a=i(29),r=i(12),s=i(77),o=i(75),l=RegExp.prototype,c=function(t,e){this._r=t,this._s=e};i(98)(c,"RegExp String",function(){var t=this._r.exec(this._s);return{value:t,done:null===t}}),n(n.P,"String",{matchAll:function(t){if(a(this),!s(t))throw TypeError(t+" is not a regexp!");var e=String(this),i="flags"in l?String(t.flags):o.call(t),n=new RegExp(t.source,~i.indexOf("g")?i:"g"+i);return n.lastIndex=r(t.lastIndex),new c(n,e)}})},function(t,e,i){"use strict";var n=i(0),a=i(175);n(n.P,"String",{padEnd:function(t){return a(this,t,arguments.length>1?arguments[1]:void 0,!1)}})},function(t,e,i){"use strict";var n=i(0),a=i(175);n(n.P,"String",{padStart:function(t){return a(this,t,arguments.length>1?arguments[1]:void 0,!0)}})},function(t,e,i){"use strict";i(64)("trimLeft",function(t){return function(){return t(this,1)}},"trimStart")},function(t,e,i){"use strict";i(64)("trimRight",function(t){return function(){return t(this,2)}},"trimEnd")},function(t,e,i){i(112)("asyncIterator")},function(t,e,i){i(112)("observable")},function(t,e,i){var n=i(0);n(n.S,"System",{global:i(4)})},function(t,e,i){for(var n=i(114),a=i(18),r=i(4),s=i(17),o=i(62),l=i(7),c=l("iterator"),h=l("toStringTag"),u=o.Array,d=["NodeList","DOMTokenList","MediaList","StyleSheetList","CSSRuleList"],f=0;f<5;f++){var m,p=d[f],g=r[p],v=g&&g.prototype;if(v){v[c]||s(v,c,u),v[h]||s(v,h,p),o[p]=u;for(m in n)v[m]||a(v,m,n[m],!0)}}},function(t,e,i){var n=i(0),a=i(110);n(n.G+n.B,{setImmediate:a.set,clearImmediate:a.clear})},function(t,e,i){var n=i(4),a=i(0),r=i(76),s=i(236),o=n.navigator,l=!!o&&/MSIE .\./.test(o.userAgent),c=function(t){return l?function(e,i){return t(r(s,[].slice.call(arguments,2),"function"==typeof e?e:Function(e)),i)}:t};a(a.G+a.B+a.F*l,{setTimeout:c(n.setTimeout),setInterval:c(n.setInterval)})},function(t,e,i){i(359),i(298),i(300),i(299),i(302),i(304),i(309),i(303),i(301),i(311),i(310),i(306),i(307),i(305),i(297),i(308),i(312),i(313),i(265),i(267),i(266),i(315),i(314),i(285),i(295),i(296),i(286),i(287),i(288),i(289),i(290),i(291),i(292),i(293),i(294),i(268),i(269),i(270),i(271),i(272),i(273),i(274),i(275),i(276),i(277),i(278),i(279),i(280),i(281),i(282),i(283),i(284),i(346),i(351),i(358),i(349),i(341),i(342),i(347),i(352),i(354),i(337),i(338),i(339),i(340),i(343),i(344),i(345),i(348),i(350),i(353),i(355),i(356),i(357),i(260),i(262),i(261),i(264),i(263),i(249),i(247),i(253),i(250),i(256),i(258),i(246),i(252),i(243),i(257),i(241),i(255),i(254),i(248),i(251),i(240),i(242),i(245),i(244),i(259),i(114),i(331),i(336),i(178),i(332),i(333),i(334),i(335),i(316),i(177),i(179),i(180),i(371),i(360),i(361),i(366),i(369),i(370),i(364),i(367),i(365),i(368),i(362),i(363),i(317),i(318),i(319),i(320),i(321),i(324),i(322),i(323),i(325),i(326),i(327),i(328),i(330),i(329),i(372),i(398),i(401),i(400),i(402),i(403),i(399),i(404),i(405),i(383),i(386),i(382),i(380),i(381),i(384),i(385),i(375),i(397),i(406),i(374),i(376),i(378),i(377),i(379),i(388),i(389),i(391),i(390),i(393),i(392),i(394),i(395),i(396),i(373),i(387),i(409),i(408),i(407),t.exports=i(35)},,,,,,,,,,,,,,function(t,e){t.exports='<div class="vzb-bs-holder">\n\t<svg class="vzb-bs-svg">\n\t\t<g class="vzb-bs-slider-wrap">\n\t\t\t<g class="vzb-bs-slider">\n\t\t\t</g>\n\t\t</g>\n\t</svg>\n</div>\n'},function(t,e){t.exports='<div class=\'vzb-dialog-modal\'>\n  <div class="vzb-dialog-title"> \n      <%=t ("buttons/about") %>\n  </div>\n      \n  <div class="vzb-dialog-content">\n      <p class="vzb-about-text0"></p>\n      <p class="vzb-about-text1"></p>\n      <br/>\n      <p class="vzb-about-version"></p>\n      <p class="vzb-about-updated"></p>\n      <br/>\n      <p class="vzb-about-text2"></p>\n      <br/>\n      <p class="vzb-about-report"></p>\n      <br/>\n      <p class="vzb-about-credits"></p>\n  </div>\n      \n  <div class="vzb-dialog-buttons">\n    <div data-click="closeDialog" class="vzb-dialog-button vzb-label-primary">\n      <%=t ("buttons/ok") %>\n    </div>\n  </div>\n      \n\n</div>\n'},function(t,e){t.exports='<div class=\'vzb-dialog-modal\'>\n    <span class="thumb-tack-class thumb-tack-class-ico-pin fa" data-dialogtype="axes" data-click="pinDialog"></span>\n    <span class="thumb-tack-class thumb-tack-class-ico-drag fa" data-dialogtype="axes" data-click="dragDialog"></span>\n    <div class="vzb-dialog-title"><%=t ("buttons/axes") %></div>\n    <div class="vzb-dialog-content">\n      <p class="vzb-dialog-sublabel"> <%=t ("buttons/axis_x") %> <span class="vzb-xaxis-selector"></span> </p>\n      <div class="vzb-xaxis-minmax vzb-dialog-paragraph"></div>\n      <p class="vzb-dialog-sublabel"> <%=t ("buttons/axis_y") %> <span class="vzb-yaxis-selector"></span> </p>\n      <div class="vzb-yaxis-minmax vzb-dialog-paragraph"></div>\n    </div>\n    <div class="vzb-dialog-buttons">\n      <div data-click="closeDialog" class="vzb-dialog-button vzb-label-primary"><%=t ( "buttons/ok") %></div>\n    </div>\n</div>'},function(t,e){t.exports='<div class=\'vzb-dialog-modal\'>\n    <span class="thumb-tack-class thumb-tack-class-ico-pin fa" data-dialogtype="axesmc" data-click="pinDialog"></span>\n    <span class="thumb-tack-class thumb-tack-class-ico-drag fa" data-dialogtype="axesmc" data-click="dragDialog"></span>\n    <div class="vzb-dialog-title">\n        <%=t ("buttons/axes") %>\n    </div>\n    <div class="vzb-dialog-content">\n        <div class="vzb-yaxis-container">\n            <p class="vzb-dialog-sublabel"><%=t ("hints/mount/maxYvalue") %></p>\n            <form class="vzb-dialog-paragraph">\n                <label><input type="radio" name="ymax" value="immediate"><%=t ("mount/maxYmode/immediate") %></label>\n                <label><input type="radio" name="ymax" value="latest"><%=t ("mount/maxYmode/latest") %></label>\n            </form>\n        </div>\n        <div class="vzb-xaxis-container">\n            <p class="vzb-dialog-sublabel">\n                <%=t ("hints/mount/logXstops") %>\n            </p>\n            <form class="vzb-dialog-paragraph">\n                <input type="checkbox" name="logstops" value="1">1\n                <input type="checkbox" name="logstops" value="2">2\n                <input type="checkbox" name="logstops" value="5">5\n            </form>\n        </div>\n        <p class="vzb-dialog-sublabel">\n            <%=t ("hints/mount/xlimits") %>\n        </p>\n        <div class="vzb-xlimits-container vzb-dialog-paragraph"></div>\n        <div class="vzb-probe-container">\n            <p class="vzb-dialog-sublabel">\n              <input type="checkbox" name="probe" class="vzb-probe-check"> <%=t ("hints/mount/probe") %>\n            </p>\n            <input type="text" class="vzb-probe-field" name="probe">\n        </div>\n    </div>\n    <div class="vzb-dialog-buttons">\n        <div data-click="closeDialog" class="vzb-dialog-button vzb-label-primary">\n            <%=t ("buttons/ok") %>\n        </div>\n    </div>\n</div>'},function(t,e){t.exports='<div class=\'vzb-dialog-modal\'>\n  <span class="thumb-tack-class thumb-tack-class-ico-pin fa" data-dialogtype="colors" data-click="pinDialog"></span>\n  <span class="thumb-tack-class thumb-tack-class-ico-drag fa" data-dialogtype="colors" data-click="dragDialog"></span>\n  \n  <div class="vzb-dialog-title">\n      <%=t ("buttons/colors") %>\n      <span class="vzb-caxis-selector"></span>\n  </div>\n  \n  \n  \n  <div class="vzb-dialog-content vzb-dialog-scrollable">\n    <div class="vzb-clegend-container"></div>\n  </div>\n\n  <div class="vzb-dialog-buttons">\n    <div data-click="closeDialog" class="vzb-dialog-button vzb-label-primary">\n      <%=t ("buttons/ok") %>\n    </div>\n  </div>\n\n</div>\n'},function(t,e){t.exports='<div class=\'vzb-dialog-modal\'>\n  <span class="thumb-tack-class thumb-tack-class-ico-pin fa" data-dialogtype="find" data-click="pinDialog"></span>\n  <span class="thumb-tack-class thumb-tack-class-ico-drag fa" data-dialogtype="find" data-click="dragDialog"></span>\n  <div class="vzb-dialog-title">\n    <%=t ("dialogs/find") %>\n    <span class="vzb-dialog-content vzb-find-filter">\n      <input class="vzb-find-search" type="search"/>\n    </span>\n  </div>\n  \n  <div class="vzb-dialog-content vzb-dialog-content-fixed vzb-dialog-scrollable">\n    <div class="vzb-find-list">\n      <!-- list will be placed here -->\n    </div>\n  </div>\n\n  <div class="vzb-dialog-buttons">\n    <div class="vzb-dialog-bubbleopacity vzb-dialog-control"></div>\n    <div class="vzb-dialog-button vzb-find-deselect">\n      <%=t ("buttons/deselect") %>\n    </div>\n\n    <div data-click="closeDialog" class="vzb-dialog-button vzb-label-primary">\n      <%=t ("buttons/ok") %>\n    </div>\n  </div>\n\n</div>\n'},function(t,e){t.exports='<div class=\'vzb-dialog-modal\'>\n  <span class="thumb-tack-class thumb-tack-class-ico-pin fa" data-dialogtype="label" data-click="pinDialog"></span>\n  <span class="thumb-tack-class thumb-tack-class-ico-drag fa" data-dialogtype="label" data-click="dragDialog"></span>\n  <div class="vzb-dialog-title"> \n      <%=t ("buttons/label") %>\n  </div>\n      \n      \n  <div class="vzb-dialog-content">\n    <span class="vzb-saxis-selector"></span>\n    <div class="vzb-dialog-sizeslider"></div>\n    <div class="vzb-removelabelbox-switch"></div>\n  </div>\n\n  <div class="vzb-dialog-buttons">\n    <div data-click="closeDialog" class="vzb-dialog-button vzb-label-primary">\n      <%=t ("buttons/ok") %>\n    </div>\n  </div>\n\n</div>\n'},function(t,e){t.exports='<div class=\'vzb-dialog-modal\'>\n  <span class="thumb-tack-class thumb-tack-class-ico-pin fa" data-dialogtype="moreoptions" data-click="pinDialog"></span>\n  <span class="thumb-tack-class thumb-tack-class-ico-drag fa" data-dialogtype="moreoptions" data-click="dragDialog"></span>\n\n\n  <div class="vzb-dialog-title">\n    <%=t ("buttons/more_options") %>\n  </div>\n\n  <div class="vzb-dialog-content vzb-dialog-scrollable">\n    <div class=\'vzb-dialog-options-buttonlist\'>\n    </div>\n    <div class="vzb-accordion">\n    </div>\n  </div>\n\n  <div class="vzb-dialog-buttons">\n    <div data-click="closeDialog" class="vzb-dialog-button vzb-label-primary">\n      <%=t ("buttons/ok") %>\n    </div>\n  </div>\n\n</div>'},function(t,e){t.exports='<div class=\'vzb-dialog-modal\'>\n  <div class="vzb-dialog-title"> \n      <%=t ("buttons/opacity") %>\n  </div>\n      \n  <div class="vzb-dialog-content">\n      <p class="vzb-dialog-sublabel">\n        <%=t ("buttons/opacityRegular") %>\n      </p>\n      <div class="vzb-dialog-bubbleopacity-regular"></div>\n\n      <p class="vzb-dialog-sublabel">\n        <%=t ("buttons/opacityNonselect") %>\n      </p>\n      <div class="vzb-dialog-bubbleopacity-selectdim"></div>\n    </div>\n  </div>\n\n</div>\n'},function(t,e){t.exports='<div class=\'vzb-dialog-modal\'>\n  <div class="vzb-dialog-title"> \n      <%=t ("dialogs/presentation") %>\n  </div>\n      \n  <div class="vzb-dialog-content">\n      <div class="vzb-presentationmode-switch"></div>\n  </div>\n\n</div>\n'},function(t,e){t.exports='<div class=\'vzb-dialog-modal\'>\n  <span class="thumb-tack-class thumb-tack-class-ico-pin fa" data-dialogtype="show" data-click="pinDialog"></span>\n  <span class="thumb-tack-class thumb-tack-class-ico-drag fa" data-dialogtype="show" data-click="dragDialog"></span>\n  <div class="vzb-dialog-title">\n    <%=t ("buttons/show") %>\n    <span class="vzb-dialog-content vzb-show-filter">\n      <input class="vzb-show-search" type="search"/>\n    </span>\n  </div>\n  \n  <div class="vzb-dialog-content vzb-dialog-content-fixed vzb-dialog-scrollable">\n    <p class="vzb-dialog-sublabel"> <%=t ("hints/mount/onlyshowthefollowing") %> </p>\n    <div class="vzb-show-list">\n      <!-- list will be placed here -->\n    </div>\n  </div>\n\n  <div class="vzb-dialog-buttons">\n    <div class="vzb-dialog-button vzb-show-deselect">\n      <%=t ("buttons/showall") %>\n    </div>\n\n    <div data-click="closeDialog" class="vzb-dialog-button vzb-label-primary">\n      <%=t ("buttons/ok") %>\n    </div>\n  </div>\n\n</div>\n'},function(t,e){t.exports='<div class=\'vzb-dialog-modal\'>\n  <span class="thumb-tack-class thumb-tack-class-ico-pin fa" data-dialogtype="side" data-click="pinDialog"></span>\n  <span class="thumb-tack-class thumb-tack-class-ico-drag fa" data-dialogtype="side" data-click="dragDialog"></span>\n  <div class="vzb-dialog-title">\n    <%=t ("buttons/side") %>\n    <span class="vzb-side-selector"></span>\n  </div>\n  \n  <div class="vzb-dialog-content vzb-dialog-scrollable">\n    <div class="vzb-side-list vzb-side-list-left">\n      <!-- list will be placed here -->\n    </div>\n    <div class="vzb-side-list vzb-side-list-right">\n      <!-- list will be placed here -->\n    </div>\n  </div>\n\n  <div class="vzb-dialog-buttons">\n    <div class="vzb-dialog-button vzb-label-primary vzb-side-switch-sides">\n      <%=t ("buttons/leftright") %>\n    </div>\n\n    <div data-click="closeDialog" class="vzb-dialog-button vzb-label-primary">\n      <%=t ("buttons/ok") %>\n    </div>\n  </div>\n\n</div>\n'},function(t,e){t.exports='<div class=\'vzb-dialog-modal\'>\n  <span class="thumb-tack-class thumb-tack-class-ico-pin fa" data-dialogtype="size" data-click="pinDialog"></span>\n  <span class="thumb-tack-class thumb-tack-class-ico-drag fa" data-dialogtype="size" data-click="dragDialog"></span>\n  <div class="vzb-dialog-title"> \n      <%=t ("buttons/size") %>\n      <span class="vzb-saxis-selector"></span>\n  </div>\n      \n      \n  <div class="vzb-dialog-content">\n    <div class="vzb-dialog-bubblesize"></div>\n  </div>\n\n  <div class="vzb-dialog-buttons">\n    <div data-click="closeDialog" class="vzb-dialog-button vzb-label-primary">\n      <%=t ("buttons/ok") %>\n    </div>\n  </div>\n\n</div>\n'},function(t,e){t.exports='<div class=\'vzb-dialog-modal\'>\n  <div class="vzb-dialog-title"> \n      <%=t ("buttons/speed") %>\n  </div>\n      \n  <div class="vzb-dialog-content">\n    <div class="vzb-dialog-placeholder"></div>\n  </div>\n\n</div>\n'},function(t,e){t.exports='<div class=\'vzb-dialog-modal\'>\n    <span class="thumb-tack-class thumb-tack-class-ico-pin fa" data-dialogtype="stack" data-click="pinDialog"></span>\n    <span class="thumb-tack-class thumb-tack-class-ico-drag fa" data-dialogtype="stack" data-click="dragDialog"></span>\n    <div class="vzb-dialog-title"><%=t ("buttons/stack") %></div>\n        \n    <div class="vzb-dialog-content vzb-dialog-scrollable">\n        \n        <!--p class="vzb-dialog-sublabel"> <%=t ( "hints/mount/howtostack") %></p-->\n        <form class="vzb-howtostack vzb-dialog-paragraph">\n            <label> <input type="radio" name="stack" value="none"> <%=t ("mount/stacking/none") %> </label>\n            <label> <input type="radio" name="stack" value="bycolor"> <%=t ("mount/stacking/color") %> </label>\n            <label> <input type="radio" name="stack" value="all"> <%=t ("mount/stacking/world") %> </label>\n        </form>\n        \n        <form class="vzb-howtomerge vzb-dialog-paragraph">\n            <p class="vzb-dialog-sublabel"> <%=t ("hints/mount/howtomerge") %> </p>\n            <label> <input type="radio" name="merge" value="none"> <%=t ("mount/merging/none") %> </label>\n            <label> <input type="radio" name="merge" value="grouped"> <%=t ("mount/merging/color") %> </label>\n            <label> <input type="radio" name="merge" value="stacked"> <%=t ("mount/merging/world") %> </label>\n        </form>\n        \n        <form class="vzb-manual-sorting">\n            <p class="vzb-dialog-sublabel"> <%=t ("mount/manualSorting") %> </p>\n            <div class="vzb-dialog-draggablelist vzb-dialog-control"></div>\n        </form>\n                \n    </div>\n\n    <div class="vzb-dialog-buttons">\n        <div data-click="closeDialog" class="vzb-dialog-button vzb-label-primary"><%=t ("buttons/ok") %></div>\n    </div>\n\n</div>'},function(t,e){t.exports='<div class="vzb-dialog-modal">\n  <div class="vzb-dialog-content vzb-dialog-content-fixed">\n    <svg>\n      <g class="vzb-timedisplay"></g>\n    </svg>\n  </div>\n  <div class="vzb-dialog-buttons"></div>\n</div>\n'},function(t,e){t.exports='<div class=\'vzb-dialog-modal\'>\n  <span class="thumb-tack-class thumb-tack-class-ico-pin fa" data-dialogtype="label" data-click="pinDialog"></span>\n  <span class="thumb-tack-class thumb-tack-class-ico-drag fa" data-dialogtype="label" data-click="dragDialog"></span>\n  <div class="vzb-dialog-title"> \n    <%=t ("buttons/zoom") %>\n    <div class="vzb-dialog-zoom-buttonlist"></div>\n  </div>\n      \n      \n  <div class="vzb-dialog-content">\n    <div class="vzb-zoomonscrolling-switch"></div>\n    <div class="vzb-adaptminmaxzoom-switch"></div>\n  </div>\n\n  <div class="vzb-dialog-buttons">\n    <div data-click="closeDialog" class="vzb-dialog-button vzb-label-primary">\n      <%=t ("buttons/ok") %>\n    </div>\n  </div>\n\n</div>\n'},function(t,e){t.exports='<div class="vzb-mmi-holder">\n\n    <span class="vzb-mmi-domainmin-label"></span>\n    <input type="text" class="vzb-mmi-domainmin" name="min">\n    <span class="vzb-mmi-domainmax-label"></span>\n    <input type="text" class="vzb-mmi-domainmax" name="max">\n\n    <br class="vzb-mmi-break"/>\n\n    <span class="vzb-mmi-zoomedmin-label"></span>\n    <input type="text" class="vzb-mmi-zoomedmin" name="min">\n    <span class="vzb-mmi-zoomedmax-label"></span>\n    <input type="text" class="vzb-mmi-zoomedmax" name="max">\n    \n</div>'},function(t,e){t.exports='<div class="vzb-szs-holder">\n\t<svg class="vzb-szs-svg">\n\t\t<g class="vzb-szs-slider-wrap">\n\t\t\t<g class="vzb-szs-slider">\n\t\t\t</g>\n\t\t</g>\n\t</svg>\n</div>\n'},function(t,e){t.exports='<div class="vzb-stepped-speed-slider">\n  <svg>\n    <g class="vzb-stepped-speed-slider-triangle"></g>\n    <g class="vzb-stepped-speed-slider-axis"></g>\n  </svg>\n</div>\n'},function(t,e){t.exports='<div class="vzb-timeslider vzb-ts-loading">\n  <div class="vzb-ts-slider-wrapper">\n    <svg class="vzb-ts-slider">\n      <g>\n        <g class="vzb-ts-slider-axis"></g>\n        <g class="vzb-ts-slider-progress"></g>\n        <g class="vzb-ts-slider-select"></g>\n        <g class="vzb-ts-slider-slide">\n          <circle class="vzb-ts-slider-handle"></circle>\n          <text class="vzb-ts-slider-value"></text>\n        </g>\n      </g>\n      </svg>\n  </div>\n\n  <!-- SVG VIZABI ICONS\n       source: https://github.com/encharm/Font-Awesome-SVG-PNG/ -->\n  <div class="vzb-ts-btns">\n    <button class="vzb-ts-btn-loading vzb-ts-btn">\n      <div class=\'vzb-loader\'></div>\n    </button>\n    <button class="vzb-ts-btn-play vzb-ts-btn">\n      <svg class="vzb-icon vzb-icon-play" viewBox="3 3 42 42"\n           xmlns="http://www.w3.org/2000/svg">\n        <path xmlns="http://www.w3.org/2000/svg" d="M24 4C12.95 4 4 12.95 4 24s8.95 20 20 20 20-8.95 20-20S35.05 4 24 4zm-4 29V15l12 9-12 9z"/>\n      </svg>\n    </button>\n    <button class="vzb-ts-btn-pause vzb-ts-btn">\n      <svg class="vzb-icon vzb-icon-pause" viewBox="3 3 42 42"\n           xmlns="http://www.w3.org/2000/svg">\n        <path xmlns="http://www.w3.org/2000/svg" d="M24 4C12.95 4 4 12.95 4 24s8.95 20 20 20 20-8.95 20-20S35.05 4 24 4zm-2 28h-4V16h4v16zm8 0h-4V16h4v16z"/>\n      </svg>\n    </button>\n  </div>\n</div>\n';
},function(t,e){t.exports='<!-- Bar Chart Component -->\n<svg class="vzb-agepyramid">\n  <g class="vzb-bc-header">\n    <g class="vzb-bc-axis-x-title"></g>\n    <g class="vzb-bc-axis-x-info vzb-noexport"></g>\n    <text class="vzb-bc-title"></text>\n    <text class="vzb-bc-title vzb-bc-title-right"></text>\n    <text class="vzb-bc-year"></text>\n  </g>\n  <g class="vzb-bc-graph">\n\n    <g class="vzb-bc-axis-y-title"></g>\n\n    <g class="vzb-bc-axis-y"></g>\n\n    <svg class="vzb-bc-bars-crop">\n      <g class="vzb-bc-bars"></g>\n    </svg>\n\n    <g class="vzb-bc-axis-x"></g>\n    <g class="vzb-bc-axis-x vzb-bc-axis-x-left"></g>\n\n    <svg class="vzb-bc-labels-crop">\n      <g class="vzb-bc-labels"></g>        \n    </svg>\n\n    <g class="vzb-bc-axis-labels">\n      <!-- <text class="vzb-x_label">Lifespan</text>\n            <text class="vzb-y_label">Lifespan</text> -->\n    </g>\n  </g>\n</svg>\n'},function(t,e){t.exports='<!-- Axis Labeler Component -->\n<svg class="vzb-axislabeler">\n  <g class="vzb-al-graph">\n\n    <g class="vzb-al-axis-x"></g>\n    <g class="vzb-al-axis-y"></g>\n\n  </g>\n</svg>\n'},function(t,e){t.exports='<!-- Bar Chart Component -->\n<svg class="vzb-barchart">\n  <g class="vzb-bc-graph">\n    <g class="vzb-bc-bars"></g>\n    <g class="vzb-bc-bar-labels"></g>\n\n    <g class="vzb-bc-axis-y-title"></g>\n    <text class="vzb-bc-year"></text>\n    <g class="vzb-bc-axis-x-title"></g>\n\n    <g class="vzb-bc-axis-x"></g>\n    <g class="vzb-bc-axis-y"></g>\n\n    <g class="vzb-bc-axis-labels">\n      <!-- <text class="vzb-x_label">Lifespan</text>\n            <text class="vzb-y_label">Lifespan</text> -->\n    </g>\n  </g>\n</svg>\n'},function(t,e){t.exports='<!-- Bar Chart Component -->\n<div class="vzb-barrankchart">\n  <svg class="vzb-br-header">\n    <g class="vzb-br-title">\n      <text></text>\n    </g>\n    <g class="vzb-br-total">\n      <text></text>\n    </g>\n    <g class="vzb-br-axis-info vzb-noexport"></g>\n  </svg>\n\n  <div class="vzb-br-barsviewport vzb-dialog-scrollable">\n    <svg class="vzb-br-bars-svg">\n      <g class="vzb-br-bars"></g>\n    </svg>\n  </div>\n\n  <svg class="vzb-data-warning-svg">\n    <g class="vzb-data-warning vzb-noexport">\n      <svg></svg>\n      <text></text>\n    </g>\n  </svg>\n</div>\n'},function(t,e){t.exports='<!-- Bubble Chart Component -->\n<div class="vzb-bubblechart">\n  <svg class="vzb-bubblechart-svg vzb-export">\n    <g class="vzb-bc-graph">\n      <g class="vzb-bc-year"></g>\n\n      <svg class="vzb-bc-axis-x"><g></g></svg>\n      <svg class="vzb-bc-axis-y"><g></g></svg>\n      <line class="vzb-bc-projection-x"></line>\n      <line class="vzb-bc-projection-y"></line>\n\n      <svg class="vzb-bc-bubbles-crop">\n        <line class="vzb-bc-line-equal-xy vzb-invisible"></line>\n        <rect class="vzb-bc-eventarea"></rect>\n        <g class="vzb-bc-trails"></g>\n        <g class="vzb-bc-bubbles"></g>\n        <g class="vzb-bc-lines"></g>\n        <g class="vzb-bc-bubble-crown vzb-hidden">\n          <circle class="vzb-crown-glow"></circle>\n          <circle class="vzb-crown"></circle>\n        </g>        \n      </svg>        \n\n      <g class="vzb-bc-axis-y-title"></g>\n      <g class="vzb-bc-axis-x-title"></g>\n      <g class="vzb-bc-axis-s-title"></g>\n      <g class="vzb-bc-axis-c-title"></g>\n\n      <g class="vzb-bc-axis-y-info vzb-noexport"></g>\n      <g class="vzb-bc-axis-x-info vzb-noexport"></g>\n      \n      <svg class="vzb-bc-labels-crop">\n        <g class="vzb-bc-labels"></g>        \n      </svg>       \n\n      <g class="vzb-data-warning vzb-noexport">\n        <svg></svg>\n        <text></text>\n      </g>\n\n      <rect class="vzb-bc-zoom-rect"></rect>\n      <g class="vzb-bc-tooltip vzb-hidden">\n        <rect class="vzb-tooltip-glow"></rect>\n        <rect class="vzb-tooltip-border"></rect>\n        <text class="vzb-tooltip-text"></text>\n      </g>\n    </g>\n  </svg>\n  <!-- This could possibly be another component -->\n  <div class="vzb-tooltip vzb-hidden vzb-tooltip-mobile"></div>\n</div>\n'},function(t,e){t.exports='<!-- Bubble Map Chart Component -->\n<div class="vzb-bubblemap">\n  <svg class="vzb-bmc-map-background vzb-export">\n    <g class="vzb-bmc-map-graph"></g>\n  </svg>\n  <svg class="vzb-bubblemap-svg vzb-export">\n    <g class="vzb-bmc-graph">\n      <g class="vzb-bmc-year"></g>\n\n      <g class="vzb-bmc-lines"></g>\n      <g class="vzb-bmc-bubbles"></g>\n      <g class="vzb-bmc-bubble-labels"></g>\n\n\n      <g class="vzb-bmc-axis-y-title">\n          <text></text>\n      </g>\n        \n      <g class="vzb-bmc-axis-c-title">\n          <text></text>\n      </g>\n\n      <g class="vzb-bmc-axis-y-info vzb-noexport">\n      </g>\n\n      <g class="vzb-bmc-axis-c-info vzb-noexport">\n      </g>\n\n      <g class="vzb-data-warning vzb-noexport">\n        <svg></svg>\n        <text></text>\n      </g>\n      <g class="vzb-bmc-labels"></g>\n\n      <g class="vzb-bmc-tooltip vzb-hidden">\n        <rect class="vzb-tooltip-border"></rect>\n        <text class="vzb-tooltip-text"></text>\n      </g>\n    </g>\n  </svg>\n</div>\n'},function(t,e){t.exports='<!-- Cartogram Component -->\n<div class="vzb-cartogram">\n  \n  <svg class="vzb-cartogram-svg">\n    <g class="vzb-ct-graph">\n      <g class="vzb-ct-year"></g>\n      <svg class="vzb-ct-map-background vzb-export">\n        <g class="vzb-ct-map-graph"></g>\n      </svg>\n      <svg class="vzb-ct-labels-crop">\n        <g class="vzb-ct-labels">\n          <line class="vzb-ct-vertical-now"></line>\n        </g>\n      </svg>\n\n      <g class="vzb-ct-axis-y-title"><text></text></g>\n      <g class="vzb-ct-axis-c-title"><text></text></g>\n      <g class="vzb-ct-axis-y-info"></g>\n      <g class="vzb-ct-axis-c-info"></g>\n      <g class="vzb-ct-tooltip vzb-hidden">\n        <rect class="vzb-tooltip-border"></rect>\n        <text class="vzb-tooltip-text"></text>\n\n      </g>\n\n      <g class="vzb-data-warning vzb-noexport">\n        <svg></svg>\n        <text></text>\n      </g>\n    </g>\n  </svg>\n</div>\n'},function(t,e){t.exports='<!-- Line Chart Component -->\n<div class="vzb-linechart">\n  <svg class="vzb-linechart-svg">\n    <g class="vzb-lc-graph">\n\n      <svg class="vzb-lc-axis-x"><g></g></svg>\n      <svg class="vzb-lc-axis-y"><g></g></svg>\n      <text class="vzb-lc-axis-x-value"></text>\n      <text class="vzb-lc-axis-y-value"></text>\n      <svg class="vzb-lc-lines-crop">\n        <svg class="vzb-lc-lines"></svg>\n        <line class="vzb-lc-projection-x"></line>\n        <line class="vzb-lc-projection-y"></line>\n      </svg>\n      <svg class="vzb-lc-labels-crop">\n        <g class="vzb-lc-labels">\n          <line class="vzb-lc-vertical-now"></line>\n        </g>\n      </svg>\n\n      <g class="vzb-lc-axis-y-title"></g>\n      <g class="vzb-lc-axis-x-title"></g>\n      <g class="vzb-lc-axis-y-info"></g>\n\n      <g class="vzb-data-warning vzb-noexport">\n        <svg></svg>\n        <text></text>\n      </g>\n\n      \n      <!--filter id="vzb-lc-filter-dropshadow"> \n        <feOffset result="offOut" in="SourceGraphic" dx="0" dy="2" />\n        <feColorMatrix result = "matrixOut" in = "offOut" type = "matrix"\n                       values = "0.3 .0 .0 .0 .0\n                                 .0 .3 .0 .0 .0\n                                 .0 .0 .3 .0 .0\n                                 1.0 1.0 1.0 1.0 .0"/>\n        <feGaussianBlur result="blurOut" in="matrixOut" stdDeviation="0.8" />\n        <feBlend in="SourceGraphic" in2="blurOut" mode="normal" />\n      </filter-->\n\n    </g>\n  </svg>\n  <div class="vzb-tooltip vzb-hidden"></div>\n</div>\n'},function(t,e){t.exports='<!-- Mountain Chart Template -->\n<div class="vzb-mountainchart">\n  <svg class="vzb-mountainchart-svg vzb-export">\n        <g class="vzb-mc-graph">\n            <rect class="vzb-mc-eventarea"></rect>\n            <g class="vzb-mc-year"></g>\n\n            <g class="vzb-mc-mountains-mergestacked"></g>\n            <g class="vzb-mc-mountains-mergegrouped"></g>\n            <g class="vzb-mc-mountains"></g>\n            <g class="vzb-mc-mountains-labels"></g>\n\n\n            <g class="vzb-mc-axis-y-title">\n                <text></text>\n            </g>\n\n            <g class="vzb-mc-axis-x-title">\n                <text></text>\n            </g>\n\n            <g class="vzb-mc-axis-info vzb-noexport">\n            </g>\n\n            <g class="vzb-data-warning vzb-noexport">\n                <svg></svg>\n                <text></text>\n            </g>\n\n            <g class="vzb-mc-axis-x"></g>\n\n            <g class="vzb-mc-axis-labels"></g>\n            <g class="vzb-mc-probe">\n                <text class="vzb-shadow vzb-mc-probe-value-ul"></text>\n                <text class="vzb-shadow vzb-mc-probe-value-ur"></text>\n                <text class="vzb-shadow vzb-mc-probe-value-dl"></text>\n                <text class="vzb-shadow vzb-mc-probe-value-dr"></text>\n                <text class="vzb-mc-probe-value-ul"></text>\n                <text class="vzb-mc-probe-value-ur"></text>\n                <text class="vzb-mc-probe-value-dl"></text>\n                <text class="vzb-mc-probe-value-dr"></text>\n                <text class="vzb-mc-probe-extremepoverty"></text>\n                <line></line>\n            </g>\n\n            <g class="vzb-mc-tooltip vzb-hidden">\n                <rect class="vzb-tooltip-border"></rect>\n                <text class="vzb-tooltip-text"></text>\n            </g>\n        </g>\n  </svg>\n</div>\n'},function(t,e){function i(){throw new Error("setTimeout has not been defined")}function n(){throw new Error("clearTimeout has not been defined")}function a(t){if(h===setTimeout)return setTimeout(t,0);if((h===i||!h)&&setTimeout)return h=setTimeout,setTimeout(t,0);try{return h(t,0)}catch(e){try{return h.call(null,t,0)}catch(e){return h.call(this,t,0)}}}function r(t){if(u===clearTimeout)return clearTimeout(t);if((u===n||!u)&&clearTimeout)return u=clearTimeout,clearTimeout(t);try{return u(t)}catch(e){try{return u.call(null,t)}catch(e){return u.call(this,t)}}}function s(){p&&f&&(p=!1,f.length?m=f.concat(m):g=-1,m.length&&o())}function o(){if(!p){var t=a(s);p=!0;for(var e=m.length;e;){for(f=m,m=[];++g<e;)f&&f[g].run();g=-1,e=m.length}f=null,p=!1,r(t)}}function l(t,e){this.fun=t,this.array=e}function c(){}var h,u,d=t.exports={};!function(){try{h="function"==typeof setTimeout?setTimeout:i}catch(t){h=i}try{u="function"==typeof clearTimeout?clearTimeout:n}catch(t){u=n}}();var f,m=[],p=!1,g=-1;d.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];m.push(new l(t,e)),1!==m.length||p||a(o)},l.prototype.run=function(){this.fun.apply(null,this.array)},d.title="browser",d.browser=!0,d.env={},d.argv=[],d.version="",d.versions={},d.on=c,d.addListener=c,d.once=c,d.off=c,d.removeListener=c,d.removeAllListeners=c,d.emit=c,d.binding=function(t){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(t){throw new Error("process.chdir is not supported")},d.umask=function(){return 0}},function(t,e,i){(function(e,i){!function(e){"use strict";function n(t,e,i,n){var a=e&&e.prototype instanceof r?e:r,s=Object.create(a.prototype),o=new f(n||[]);return s._invoke=h(t,i,o),s}function a(t,e,i){try{return{type:"normal",arg:t.call(e,i)}}catch(t){return{type:"throw",arg:t}}}function r(){}function s(){}function o(){}function l(t){["next","throw","return"].forEach(function(e){t[e]=function(t){return this._invoke(e,t)}})}function c(t){function e(i,n,r,s){var o=a(t[i],t,n);if("throw"!==o.type){var l=o.arg,c=l.value;return c&&"object"==typeof c&&b.call(c,"__await")?Promise.resolve(c.__await).then(function(t){e("next",t,r,s)},function(t){e("throw",t,r,s)}):Promise.resolve(c).then(function(t){l.value=t,r(l)},s)}s(o.arg)}function n(t,i){function n(){return new Promise(function(n,a){e(t,i,n,a)})}return r=r?r.then(n,n):n()}"object"==typeof i&&i.domain&&(e=i.domain.bind(e));var r;this._invoke=n}function h(t,e,i){var n=z;return function(r,s){if(n===k)throw new Error("Generator is already running");if(n===E){if("throw"===r)throw s;return p()}for(;;){var o=i.delegate;if(o){if("return"===r||"throw"===r&&o.iterator[r]===g){i.delegate=null;var l=o.iterator.return;if(l){var c=a(l,o.iterator,s);if("throw"===c.type){r="throw",s=c.arg;continue}}if("return"===r)continue}var c=a(o.iterator[r],o.iterator,s);if("throw"===c.type){i.delegate=null,r="throw",s=c.arg;continue}r="next",s=g;var h=c.arg;if(!h.done)return n=S,h;i[o.resultName]=h.value,i.next=o.nextLoc,i.delegate=null}if("next"===r)i.sent=i._sent=s;else if("throw"===r){if(n===z)throw n=E,s;i.dispatchException(s)&&(r="next",s=g)}else"return"===r&&i.abrupt("return",s);n=k;var c=a(t,e,i);if("normal"===c.type){n=i.done?E:S;var h={value:c.arg,done:i.done};if(c.arg!==O)return h;i.delegate&&"next"===r&&(s=g)}else"throw"===c.type&&(n=E,r="throw",s=c.arg)}}}function u(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function d(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function f(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(u,this),this.reset(!0)}function m(t){if(t){var e=t[x];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,n=function e(){for(;++i<t.length;)if(b.call(t,i))return e.value=t[i],e.done=!1,e;return e.value=g,e.done=!0,e};return n.next=n}}return{next:p}}function p(){return{value:g,done:!0}}var g,v=Object.prototype,b=v.hasOwnProperty,y="function"==typeof Symbol?Symbol:{},x=y.iterator||"@@iterator",_=y.toStringTag||"@@toStringTag",M="object"==typeof t,w=e.regeneratorRuntime;if(w)return void(M&&(t.exports=w));w=e.regeneratorRuntime=M?t.exports:{},w.wrap=n;var z="suspendedStart",S="suspendedYield",k="executing",E="completed",O={},T={};T[x]=function(){return this};var P=Object.getPrototypeOf,D=P&&P(P(m([])));D&&D!==v&&b.call(D,x)&&(T=D);var I=o.prototype=r.prototype=Object.create(T);s.prototype=I.constructor=o,o.constructor=s,o[_]=s.displayName="GeneratorFunction",w.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===s||"GeneratorFunction"===(e.displayName||e.name))},w.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,o):(t.__proto__=o,_ in t||(t[_]="GeneratorFunction")),t.prototype=Object.create(I),t},w.awrap=function(t){return{__await:t}},l(c.prototype),w.AsyncIterator=c,w.async=function(t,e,i,a){var r=new c(n(t,e,i,a));return w.isGeneratorFunction(e)?r:r.next().then(function(t){return t.done?t.value:r.next()})},l(I),I[_]="Generator",I.toString=function(){return"[object Generator]"},w.keys=function(t){var e=[];for(var i in t)e.push(i);return e.reverse(),function i(){for(;e.length;){var n=e.pop();if(n in t)return i.value=n,i.done=!1,i}return i.done=!0,i}},w.values=m,f.prototype={constructor:f,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=g,this.done=!1,this.delegate=null,this.tryEntries.forEach(d),!t)for(var e in this)"t"===e.charAt(0)&&b.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=g)},stop:function(){this.done=!0;var t=this.tryEntries[0],e=t.completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){function e(e,n){return r.type="throw",r.arg=t,i.next=e,!!n}if(this.done)throw t;for(var i=this,n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n],r=a.completion;if("root"===a.tryLoc)return e("end");if(a.tryLoc<=this.prev){var s=b.call(a,"catchLoc"),o=b.call(a,"finallyLoc");if(s&&o){if(this.prev<a.catchLoc)return e(a.catchLoc,!0);if(this.prev<a.finallyLoc)return e(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return e(a.catchLoc,!0)}else{if(!o)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return e(a.finallyLoc)}}}},abrupt:function(t,e){for(var i=this.tryEntries.length-1;i>=0;--i){var n=this.tryEntries[i];if(n.tryLoc<=this.prev&&b.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var a=n;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var r=a?a.completion:{};return r.type=t,r.arg=e,a?this.next=a.finallyLoc:this.complete(r),O},complete:function(t,e){if("throw"===t.type)throw t.arg;"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=t.arg,this.next="end"):"normal"===t.type&&e&&(this.next=e)},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e];if(i.finallyLoc===t)return this.complete(i.completion,i.afterLoc),d(i),O}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e];if(i.tryLoc===t){var n=i.completion;if("throw"===n.type){var a=n.arg;d(i)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,i){return this.delegate={iterator:m(t),resultName:e,nextLoc:i},O}}}("object"==typeof e?e:"object"==typeof window?window:"object"==typeof self?self:this)}).call(e,i(181),i(454))},function(t,e){t.exports={linear:function(t,e,i,n,a){return+i+(a-t)/(e-t)*(n-i)},exp:function(t,e,i,n,a){return Math.exp((Math.log(i)*(e-a)-Math.log(n)*(t-a))/(e-t))},stepBefore:function(t,e,i,n,a){return n},stepAfter:function(t,e,i,n,a){return i},stepMiddle:function(t,e,i,n,a){return a<(t+e)/2?i:n}}},function(t,e,i){function n(t){return i(a(t))}function a(t){var e=r[t];if(!(e+1))throw new Error("Cannot find module '"+t+"'.");return e}var r={"./bubblesize/bubblesize.js":83,"./buttonlist/buttonlist.js":22,"./buttonlist/optionsbuttonlist/optionsbuttonlist.js":115,"./colorlegend/colorlegend.js":84,"./datanotes/datanotes.js":34,"./datawarning/datawarning.js":39,"./dialogs/_dialog.js":11,"./dialogs/about/about.js":116,"./dialogs/axes/axes.js":117,"./dialogs/axesmc/axesmc.js":118,"./dialogs/colors/colors.js":119,"./dialogs/dialogs.js":23,"./dialogs/find/find.js":120,"./dialogs/label/label.js":121,"./dialogs/moreoptions/moreoptions.js":122,"./dialogs/opacity/opacity.js":123,"./dialogs/presentation/presentation.js":124,"./dialogs/show/show.js":125,"./dialogs/side/side.js":126,"./dialogs/size/size.js":127,"./dialogs/speed/speed.js":128,"./dialogs/stack/stack.js":129,"./dialogs/timedisplay/timedisplay.js":130,"./dialogs/zoom/zoom.js":131,"./draggablelist/draggablelist.js":132,"./indicatorpicker/indicatorpicker.js":48,"./minmaxinputs/minmaxinputs.js":85,"./simplecheckbox/simplecheckbox.js":58,"./simpleslider/simpleslider.js":65,"./sizeslider/sizeslider.js":133,"./steppedspeedslider/steppedspeedslider.js":134,"./timeslider/timeslider.js":24,"./treemenu/treemenu.js":27,"./zoombuttonlist/zoombuttonlist.js":135};n.keys=function(){return Object.keys(r)},n.resolve=a,t.exports=n,n.id=457},function(t,e,i){function n(t){return i(a(t))}function a(t){var e=r[t];if(!(e+1))throw new Error("Cannot find module '"+t+"'.");return e}var r={"./about/about.html":425,"./axes/axes.html":426,"./axesmc/axesmc.html":427,"./colors/colors.html":428,"./find/find.html":429,"./label/label.html":430,"./moreoptions/moreoptions.html":431,"./opacity/opacity.html":432,"./presentation/presentation.html":433,"./show/show.html":434,"./side/side.html":435,"./size/size.html":436,"./speed/speed.html":437,"./stack/stack.html":438,"./timedisplay/timedisplay.html":439,"./zoom/zoom.html":440};n.keys=function(){return Object.keys(r)},n.resolve=a,t.exports=n,n.id=458},function(t,e,i){function n(t){return i(a(t))}function a(t){var e=r[t];if(!(e+1))throw new Error("Cannot find module '"+t+"'.");return e}var r={"./_dialog.js":11,"./about/about.js":116,"./axes/axes.js":117,"./axesmc/axesmc.js":118,"./colors/colors.js":119,"./dialogs.js":23,"./find/find.js":120,"./label/label.js":121,"./moreoptions/moreoptions.js":122,"./opacity/opacity.js":123,"./presentation/presentation.js":124,"./show/show.js":125,"./side/side.js":126,"./size/size.js":127,"./speed/speed.js":128,"./stack/stack.js":129,"./timedisplay/timedisplay.js":130,"./zoom/zoom.js":131};n.keys=function(){return Object.keys(r)},n.resolve=a,t.exports=n,n.id=459},function(t,e,i){function n(t){return i(a(t))}function a(t){var e=r[t];if(!(e+1))throw new Error("Cannot find module '"+t+"'.");return e}var r={"./axis":87,"./axis.js":87,"./color":138,"./color.js":138,"./data":139,"./data.js":139,"./dataconnected":59,"./dataconnected.js":59,"./entities":140,"./entities.js":140,"./group":141,"./group.js":141,"./hook":41,"./hook.js":41,"./label":142,"./label.js":142,"./locale":143,"./locale.js":143,"./marker":144,"./marker.js":144,"./side":145,"./side.js":145,"./size":146,"./size.js":146,"./stack":147,"./stack.js":147,"./time":148,"./time.js":148,"./ui":149,"./ui.js":149};n.keys=function(){return Object.keys(r)},n.resolve=a,t.exports=n,n.id=460},function(t,e,i){function n(t){return i(a(t))}function a(t){var e=r[t];if(!(e+1))throw new Error("Cannot find module '"+t+"'.");return e}var r={"./csv-time_in_columns/csv-time_in_columns.js":216,"./csv/csv.js":150,"./inline/inline.js":217};n.keys=function(){return Object.keys(r)},n.resolve=a,t.exports=n,n.id=461},,function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function a(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),i(195);var r=i(45),s=a(r),o=i(1),l=n(o),c=i(14),h=(a(c),i(194)),u=a(h);i(196);var d=i(70),f=(a(d),i(186)),m=(a(f),i(185)),p=(a(m),i(193)),g=(a(p),i(184)),v=(a(g),i(187)),b=(a(v),i(192)),y=(a(b),i(189)),x=(a(y),i(188)),_=(a(x),i(183)),M=(a(_),i(182)),w=(a(M),i(191)),z=(a(w),i(190)),S=(a(z),window.location.href.split("/")),k=S.splice(0,S.indexOf("preview")).join("/")+"/preview/";s.default.ext_resources=l.deepExtend({host:k,preloadPath:"data/",dataPath:"data/waffles/"},s.default.ext_resources),e.default=u.default,t.exports=u.default}])});
//# sourceMappingURL=vizabi.min.js.map