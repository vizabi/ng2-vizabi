/**
 * vizabi - Vizabi Framework, Interactive charts and visualization tools animated through time
 * @version v0.19.1-37
 * @build timestamp Mon Feb 27 2017 11:44:02 GMT+0000 (UTC)
 * @link http://vizabi.org
 * @license BSD-3-Clause
 */

!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define("Vizabi",[],e):"object"==typeof exports?exports.Vizabi=e():t.Vizabi=e()}(this,function(){return function(t){function e(n){if(i[n])return i[n].exports;var r=i[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,e),r.l=!0,r.exports}var i={};return e.m=t,e.c=i,e.i=function(t){return t},e.d=function(t,i,n){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:n})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=479)}([function(t,e,i){var n=i(4),r=i(36),a=i(18),o=i(19),s=i(37),l="prototype",c=function(t,e,i){var u,h,d,f,p=t&c.F,m=t&c.G,g=t&c.S,v=t&c.P,y=t&c.B,b=m?n:g?n[e]||(n[e]={}):(n[e]||{})[l],_=m?r:r[e]||(r[e]={}),x=_[l]||(_[l]={});m&&(i=e);for(u in i)h=!p&&b&&void 0!==b[u],d=(h?b:i)[u],f=y&&h?s(d,n):v&&"function"==typeof d?s(Function.call,d):d,b&&o(b,u,d,t&c.U),_[u]!=d&&a(_,u,f),v&&x[u]!=d&&(x[u]=d)};n.core=r,c.F=1,c.G=2,c.S=4,c.P=8,c.B=16,c.W=32,c.U=64,c.R=128,t.exports=c},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){return Boolean(t instanceof Date||t instanceof RegExp)}function a(t){if(t instanceof Date)return new Date(t.getTime());if(t instanceof RegExp)return new RegExp(t);throw new Error("Unexpected situation")}function o(t){var e=[];return _(t,function(t,i){"object"===("undefined"==typeof t?"undefined":u(t))&&null!==t?f(t)?e[i]=o(t):r(t)?e[i]=a(t):e[i]=x({},t):e[i]=t}),e}function s(t,e){return function(i,n){var r=e.getBoundingClientRect(),a=t.getScreenCTM();return{x:a.a*i+a.c*n+a.e-r.left,y:a.b*i+a.d*n+a.f-r.top}}}function l(){function t(t){return t}function e(t){return"string"==typeof t?t.toLowerCase():t}function i(i,n){return n="number"==typeof n?{direction:n}:n||{},"function"!=typeof i&&!function(){var t=i;i=function(e){return e[t]?e[t]:""}}(),1===i.length&&!function(){var r=i,a=n.ignoreCase?e:t;i=function(t,e){return a(r(t))<a(r(e))?-1:a(r(t))>a(r(e))?1:0}}(),n.direction===-1?function(t,e){return-i(t,e)}:i}function n(t,e){var r="function"==typeof this&&this,a=i(t,e),o=r?function(t,e){return r(t,e)||a(t,e)}:a;return o.thenBy=n,o}return n}function c(t){var e=t.transform.baseVal.consolidate().matrix,i=e.a,n=e.b,r=e.c,a=e.d,o=e.e,s=e.f;return function(t,e,i,n,r,a){var o=void 0,s=void 0,l=void 0;return(o=Math.sqrt(t*t+e*e))&&(t/=o,e/=o),(l=t*i+e*n)&&(i-=t*l,n-=e*l),(s=Math.sqrt(i*i+n*n))&&(i/=s,n/=s,l/=s),t*n<e*i&&(t=-t,e=-e,l=-l,o=-o),{translateX:r,translateY:a,rotate:Math.atan2(e,t)*Math.PI/180,skewX:Math.atan(l)*Math.PI/180,scaleX:o,scaleY:s}}(i,n,r,a,o,s)}Object.defineProperty(e,"__esModule",{value:!0}),e.isMobileOrTablet=e.capitalize=e.setIcon=e.pruneTree=e.isTouchDevice=e.debounce=e.memoize=e.post=e.get=e.ajax=e.interpolatePoint=e.interpolateVector=e.nestArrayToObj=e.hashCode=e.clearDelay=e.delay=e.defer=e.diffObject=e.arrayLast=e.arrayMedian=e.arraySum=e.arrayMean=e.arrayMax=e.arrayMin=e.values=e.keys=e.throttle=e.hasClass=e.classed=e.removeClass=e.addClass=e.countDecimals=e.error=e.groupEnd=e.groupCollapsed=e.warn=e.timeStamp=e.areaToRadius=e.radiusToArea=e.mapRows=e.preventAncestorScrolling=e.matchAny=e.filterAny=e.filter=e.find=e.uniqueLast=e.unique=e.without=e.deepClone=e.clone=e.merge=e.deepExtend=e.extend=e.forEach=e.strToFloat=e.roundStep=e.findScrollableAncestor=e.getViewportPosition=e.comparePlainObjects=e.arrayEquals=e.isPlainObject=e.isNumber=e.isEmpty=e.isNaN=e.isString=e.isDate=e.isObject=e.isArray=e.isElement=e.uniqueId=e.approxEqual=void 0;var u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};e.makeAbsoluteContext=s,e.firstBy=l,e.transform=c;var h=i(472),d=n(h),f=(e.approxEqual=function(t,e,i){return i=i||0,e>0?(1-i)*e<=t&&t<=e*(1+i):e<0?(1+i)*e<=t&&t<=e*(1-i):Math.abs(t)<=i},e.uniqueId=function(){var t=0;return function(e){return e?e+(t+=1):t+=1}}(),e.isElement=function(t){return!(!t||1!==t.nodeType)},e.isArray=Array.isArray||function(t){return"[object Array]"===toString.call(t)}),p=e.isObject=function(t){var e="undefined"==typeof t?"undefined":u(t);return"object"===e&&!!t},m=(e.isDate=function(t){return t instanceof Date},e.isString=function(t){return"string"==typeof t}),g=e.isNaN=function(t){return v(t)&&t!==+t},v=(e.isEmpty=function(t){return 0===Object.keys(t).length&&t.constructor===Object},e.isNumber=function(t){return"number"==typeof t||!!t&&"object"===("undefined"==typeof t?"undefined":u(t))&&"[object Number]"===Object.prototype.toString.call(t)}),y=e.isPlainObject=function(t){return null!==t&&"[object Object]"===Object.prototype.toString.call(t)},b=e.arrayEquals=function(t,e){if(t===e)return!0;if(null==t||null==e)return!1;if(t.length!=e.length)return!1;for(var i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0},_=(e.comparePlainObjects=function(t,e){var i=function(t){return Object.prototype.toString.call(t).match(/^\[object\s(.*)\]$/)[1]},n=function(t){if(void 0===t)return"undefined";if(null===t)return"null";var e="undefined"==typeof t?"undefined":u(t);return"object"===e&&(e=i(t).toLowerCase()),"number"===e?t.toString().indexOf(".")>0?"float":"integer":e},r=function(t,e){if(t===e)return!0;for(var i in t){if(!e.hasOwnProperty(i))return!1;if(!s(t[i],e[i]))return!1}for(var n in e)if(!t.hasOwnProperty(n))return!1;return!0},a=function(t,e){if(t===e)return!0;if(t.length!==e.length)return!1;for(var i=0;i<t.length;i++)if(!s(t[i],e[i]))return!1;return!0},o={};o.array=a,o.object=r,o.date=function(t,e){return t.getTime()===e.getTime()},o.regexp=function(t,e){return t.toString()===e.toString()};var s=function(t,e){if(t!==e){var i=n(t),r=n(e);return i===r&&(o.hasOwnProperty(i)?o[i](t,e):t==e)}return!0};return r(t,e)},e.getViewportPosition=function(t){for(var e=0,i=0;t;)e+=t.offsetLeft-t.scrollLeft+t.clientLeft,i+=t.offsetTop-t.scrollTop+t.clientTop,t=t.offsetParent;return{x:e,y:i}},e.findScrollableAncestor=function(t){for(var e=["scroll","auto"];t=t.parentNode;){var i=t.scrollHeight,n=t.clientHeight;if(i>n&&e.indexOf(d3.select(t).style("overflow"))!==-1)return t}return null},e.roundStep=function(t,e){return Math.round(t/e)*e},e.strToFloat=function(t){return+t.replace(/[^\d.-]/g,"")},e.forEach=function(t,e,i){if(t){var n=void 0,r=void 0;if(f(t))for(r=t.length,n=0;n<r&&e.apply(i,[t[n],n])!==!1;n+=1);else{var a=Object.keys(t);for(r=a.length,n=0;n<r&&e.apply(i,[t[a[n]],a[n]])!==!1;n+=1);}}}),x=(e.extend=function(t){var e=Array.prototype.slice.call(arguments,1);return _(e,function(e,i){_(e,function(i,n){e.hasOwnProperty(n)&&(t[n]=i)})}),t},e.deepExtend=function t(){if(arguments.length<1||"object"!==u(arguments[0]))return!1;if(arguments.length<2)return arguments[0];var e=arguments[0],i=Array.prototype.slice.call(arguments,1),n=void 0,s=void 0;return _(i,function(i){"object"!==("undefined"==typeof i?"undefined":u(i))||f(i)||_(Object.keys(i),function(l){s=e[l],n=i[l],n===e||("object"!==("undefined"==typeof n?"undefined":u(n))||null===n||n._data?e[l]=n:f(n)?e[l]=o(n):r(n)?e[l]=a(n):"object"!==("undefined"==typeof s?"undefined":u(s))||null===s||f(s)?e[l]=t({},n):e[l]=t(s,n))})}),e}),w=(e.merge=function(t){var e=Array.prototype.slice.call(arguments,1);return _(e,function(e,i){_(e,function(i,n){e.hasOwnProperty(n)&&(t.hasOwnProperty(n)?(f(t[n])||(t[n]=[t[n]]),t[n].push(i)):t[n]=i)})}),t},e.clone=function t(e,i,n){if(f(e))return e.slice(0);var t={};return _(e,function(r,a){i&&i.indexOf(a)===-1||n&&n.indexOf(a)!==-1||e.hasOwnProperty(a)&&(t[a]=r)}),t},e.deepClone=function t(e){var i={};return f(e)&&(i=[]),_(e,function(e,n){p(e)||f(e)?i[n]=t(e):i[n]=e}),i},e.without=function(t,e){var i=t.indexOf(e);return i!==-1&&t.splice(i,1),t},e.unique=function(t,e){var i={},n=[];e||(e=function(t){return t});for(var r=0,a=t.length;r<a;r+=1){var o=e(t[r]);i.hasOwnProperty(o)||(n.push(t[r]),i[o]=1)}return n},e.uniqueLast=function(t,e){var i={},n=[];e||(e=function(t){return t});for(var r=0,a=t.length;r<a;r+=1){var o=e(t[r]);i.hasOwnProperty(o)&&n.splice(i[o],1),n.push(t[r]),i[o]=n.length-1}return n},e.find=function(t,e){var i=void 0;return _(t,function(t){if(e(t))return i=t,!1}),i},e.filter=function(t,e){for(var i=-1,n=t.length,r=-1,a=[],o=Object.keys(e),s=o.length,l=void 0,c=void 0;(i+=1)<n;){var u=t[i],h=!0;for(l=0;l<s;l+=1)if(c=o[l],!u.hasOwnProperty(c)||u[c]!==e[c]){h=!1;break}h&&(a[r+=1]=u)}return a},e.filterAny=function(t,e,i){for(var n=-1,r=t.length,a=-1,o=[],s=Object.keys(e),l=s.length,c=void 0,u=void 0;(n+=1)<r;){var h=t[n],d=!0;for(c=0;c<l;c+=1)if(u=s[c],!h.hasOwnProperty(u)||!w(h[u],e[u],i)){d=!1;break}d&&(o[a+=1]=h)}return o},e.matchAny=function(t,e,i){f(t)||(t=[t]),i||(i="*");for(var n=!1,r=0;r<t.length;r++){var a=t[r];if(!f(e)&&a==e){n=!0;break}if(f(e)){for(var o=-1,s=0;s<e.length;s++){var l=e[s];if(!(f(l)||l!=a&&l!==i)){o=s;break}if(f(l)){var c=l[0],u=l[1]||c;if(a>=c&&a<=u){o=s;break}}}if(o!==-1){n=!0;break}}}return n}),M=(e.preventAncestorScrolling=function(t){var e=!1;t.on("mousewheel",function(i,n){var r=this.scrollTop,a=this.scrollHeight,o=t.node().offsetHeight,s=d3.event.wheelDelta,l=s>0,c=function(){return d3.event.stopPropagation(),d3.event.preventDefault(),d3.event.returnValue=!1,!1},u=function(t){return function(){var e=this,i=d3.interpolateNumber(this.scrollTop,t);return function(t){e.scrollTop=i(t)}}};if(l?l&&(s>r&&r>0?(t.transition().delay(0).duration(0).tween("scrolltween",u(0)),e=!0,setTimeout(function(){e=!1},2e3)):a==o+r&&(e=!1)):-s>a-o-r&&a!=o+r?(t.transition().delay(0).duration(0).tween("scrolltween",u(a)),e=!0,setTimeout(function(){e=!1},2e3)):0==r&&(e=!1),e)return c()})},e.mapRows=function(t,e){function i(t,e){if(!f(t))return e(t);for(var n=[],r=0;r<t.length;r++)n[r]=i(t[r],e);return n}var n=function(t){var e=t;if(""===t)e=null;else{var i=parseFloat(t);!g(i)&&isFinite(t)&&(e=i)}return e};return t=t.map(function(t){for(var r=Object.keys(t),a=0;a<r.length;a++){var o=r[a];t[o]=i(t[o],e[o]||n)}return t})},e.radiusToArea=function(t){return t*t*Math.PI},e.areaToRadius=function(t){return Math.sqrt(t/Math.PI)},e.timeStamp=function(t){console&&"function"==typeof console.timeStamp&&console.timeStamp(t)},e.warn=function(t){return t=Array.prototype.slice.call(arguments).map(function(t){return t instanceof Object?JSON.stringify(t,null,4):t}).join(" "),console&&"function"==typeof console.warn&&console.warn(t),!0}),z=(e.groupCollapsed=function(t){t=Array.prototype.slice.call(arguments).join(" "),console&&"function"==typeof console.groupCollapsed&&console.groupCollapsed(t)},e.groupEnd=function(){console&&"function"==typeof console.groupEnd&&console.groupEnd()},e.error=function(t){console&&"function"==typeof console.error&&(t.stack?console.error(t.stack):console.error(t),arguments.length>1&&console.error.apply(this,Array.prototype.slice.call(arguments,1)))},e.countDecimals=function(t){return Math.floor(t.valueOf())===t.valueOf()?0:t.toString().split(".")[1].length||0},e.addClass=function(t,e){t.classList?t.classList.add(e):t.className+=" "+e}),S=e.removeClass=function(t,e){t.classList?t.classList.remove(e):t.className=t.className.replace(new RegExp("(^|\\b)"+e.split(" ").join("|")+"(\\b|$)","gi")," ")},E=(e.classed=function(t,e,i){if(i===!0)z(t,e);else{if(i!==!1)return E(t,e);S(t,e)}},e.hasClass=function(t,e){return t.classList?t.classList.contains(e):new RegExp("(^| )"+e+"( |$)","gi").test(t.className)}),k=(e.throttle=function(t,e){var i=!1,n=void 0,r=void 0,a=void 0,o=function(){i&&(i=!1,t.apply(r,n))},s=function(){return a>Date.now()?(i=!0,n=arguments,void(r=this)):(a=Date.now()+e,i=!1,t.apply(this,arguments),void setTimeout(function(){o()},e))};return s.recallLast=o,s},e.keys=function(t){return Object.keys(t)},e.values=function(t){for(var e=[],i=Object.keys(t),n=i.length,r=0;r<n;r+=1)e.push(t[i[r]]);return e},e.arrayMin=function(t){return t.reduce(function(t,e){return t<e?t:e})},e.arrayMax=function(t){return t.reduce(function(t,e){return t>e?t:e})},e.arrayMean=function(t){return k(t)/t.length},e.arraySum=function(t){return t.reduce(function(t,e){return t+e})}),T=(e.arrayMedian=function(t){t=t.sort(function(t,e){return t-e});var e=Math.floor((t.length-1)/2);return t.length%2?t[e]:(t[e]+t[e+1])/2},e.arrayLast=function(t){return t.length?t[t.length-1]:null},e.diffObject=function t(e,i){var n={};return _(e,function(e,r){if(i.hasOwnProperty(r)){if(e!==i[r])if(y(e)&&y(i[r])){var a=t(e,i[r]);Object.keys(a).length>0&&(n[r]=a)}else f(e)&&f(i[r])&&b(e,i[r])||(n[r]=e)}else n[r]=e}),n},e.defer=function(t){setTimeout(t,1)},e.delay=function(t){return new Promise(function(e){return setTimeout(e,t)})},e.clearDelay=function(t){return clearTimeout(t)},e.hashCode=function(t){m(t)||(t=JSON.stringify(t));var e=0,i=t.length,n=void 0;if(0===i)return e;for(var r=0;r<i;r+=1)n=t.charCodeAt(r),e=(e<<5)-e+n,e&=e;return e.toString()},e.nestArrayToObj=function t(e){if(!e||!e.length||!e[0].key)return e;for(var i={},n=0;n<e.length;n++)i[e[n].key]=t(e[n].values);return i},e.interpolateVector=function(){},e.interpolatePoint=function(t,e,i,n,r,a,o,s){if(!t||0===t.length)return M("interpolatePoint failed because incoming array is empty. It was "+i),null;if("constant"===e)return i;if("property"===e)return t[0][i];if(s){if(a-t[0][r]<=0)return t[0][i];if(a-t[t.length-1][r]>=0)return t[t.length-1][i]}else if(a<t[0][r]||a>t[t.length-1][r])return null;if(n||0===n||(n=d3.bisectLeft(t.map(function(t){return t[r]}),a)),0===n)return t[0][i];if(void 0===t[n]||null===t[n][i]||null===t[n-1][i]||""===t[n][i])return M("interpolatePoint failed because next/previous points are bad in "+i),null;var l=d.default[o||"linear"](t[n-1][r],t[n][r],t[n-1][i],t[n][i],a);return i===r&&(l=new Date(l)),g(l)&&(M("interpolatePoint failed because result is NaN. It was "+i),l=null),l},e.ajax=function(t){var e=new XMLHttpRequest;e.open(t.method,t.url,!0),"POST"!==t.method||t.json?"POST"===t.method&&t.json&&e.setRequestHeader("Content-Type","application/json; charset=UTF-8"):e.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),e.onload=function(){if(e.status>=200&&e.status<400){var i=t.json?JSON.parse(e.responseText):e.responseText;t.success&&t.success(i)}else t.error&&t.error()},e.onerror=function(){t.error&&t.error()},e.send(t.data)});e.get=function(t,e,i,n,r){e=e||[],_(e,function(t,i){e.push(i+"="+t)}),t=e.length?t+"?"+e.join("&"):t,T({method:"GET",url:t,success:i,error:n,json:r})},e.post=function(t,e,i,n,r){T({method:"POST",url:t,success:i,error:n,json:r,data:e})},e.memoize=function(t){return function(){for(var e=Array.prototype.slice.call(arguments),i="",n=e.length,r=null;n--;)r=e[n],i+=r===Object(r)?JSON.stringify(r):r,t.memoize||(t.memoize={});return i in t.memoize?t.memoize[i]:t.memoize[i]=t.apply(this,e)}},e.debounce=function(t,e,i){var n=void 0;return function(){var r=this,a=arguments,o=function(){n=null,i||t.apply(r,a)},s=i&&!n;clearTimeout(n),n=setTimeout(o,e),s&&t.apply(r,a)}},e.isTouchDevice=function(){return null!=((d3.event||{}).sourceCapabilities||{}).firesTouchEvents?d3.event.sourceCapabilities.firesTouchEvents:!!("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)},e.pruneTree=function t(e,i){var n={},r=[];return e.hasOwnProperty("children")&&(r=e.children.map(function(e){return t(e,i)}).filter(function(t){return 0!==Object.keys(t).length})),(0!=r.length||i(e))&&_(e,function(t,e){n[e]=t}),0!=r.length&&(n.children=r),n},e.setIcon=function(t,e){return t.selectAll("*").remove(),t.node().appendChild(t.node().ownerDocument.importNode((new DOMParser).parseFromString(e,"application/xml").documentElement,!0)),t},e.capitalize=function(t){return t.slice(0,1).toUpperCase()+t.slice(1).toLowerCase()},e.isMobileOrTablet=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:navigator.userAgent||navigator.vendor||window.opera;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw-(n|u)|c55\/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|g560|gene|gf-5|g-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|-[a-w])|libw|lynx|m1-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk\/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|zeto|zte-/i.test(t.substr(0,4))}},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function a(t,e){var i=function(e){return t.replace(/<%=([^%]*)%>/g,function(t){var i=t.match(/t\s*\(([^)]+)\)/g);return i.length?i=e.t(i[0].match(/"([^"]+)"/g)[0].split('"').join("")):(i=t.match(/([a-z\-A-Z]+([a-z\-A-Z0-9]?[a-zA-Z0-9]?)?)/g)[0],i=e[i]||i),i})},n=/<[a-z][\s\S]*>/i.test(t)?i:v[t]=v[t]||a(f.default.templates[t]);return e?n(e):n}Object.defineProperty(e,"__esModule",{value:!0});var o=i(1),s=r(o),l=i(46),c=n(l),u=i(47),h=n(u),d=i(34),f=n(d),p="vzb-loading-first",m="vzb-loading-data",g="vzb-error",v={},y=c.default.extend({init:function(t,e){if(this._id=this._id||s.uniqueId("c"),this._ready=!1,this._readyOnce=!1,this.name=this.name||t.name||this._id,this.template=this.template||"<div></div>",this.placeholder=this.placeholder||t.placeholder,this.template_data=this.template_data||{name:this.name},this.placeholder&&!s.isElement(this.placeholder))try{this.placeholder=e.placeholder.querySelector(this.placeholder)}catch(t){s.error("Error finding placeholder '"+this.placeholder+"' for component '"+this.name+"'")}this.parent=e||null,this.root=this.parent?this.parent.root:this,this.components=this.components||[],this._components_config=this.components.map(function(t){return s.clone(t)}),this.model_expects=this.model_expects||[],this.model_binds=this.model_binds||{},this.createModel(t.model),this.ui=this.model.ui||this.ui||t.ui,this._super(),this.registerListeners()},createModel:function(t){this.model=this._modelMapping(t)},registerListeners:function(){this.on({readyOnce:this.readyOnce,ready:this.ready,domReady:this.domReady,resize:this.resize})},startPreload:function(){var t=[];return t.push(this.preload()),s.forEach(this.components,function(e){return t.push(e.startPreload())}),Promise.all(t)},preload:function(){return Promise.resolve()},afterPreload:function(){this.model&&this.model.afterPreload(),s.forEach(this.components,function(t){t.afterPreload()})},render:function(){var t=this;this.loadTemplate(),this.loadSubComponents(),s.forEach(this.components,function(e){e.render(),t.on("resize",function(){e.trigger("resize")})}),this.startLoading()},startLoading:function(){var t=this;this.model.on("ready",function(){t.loadingDone()}),this.model&&this.model.isLoading()||this.loadingDone()},loadingDone:function(){s.removeClass(this.placeholder,p),s.removeClass(this.placeholder,m),this.setReady()},renderError:function(){s.removeClass(this.placeholder,p),s.removeClass(this.placeholder,m),s.addClass(this.placeholder,g),this.setError({type:"data"})},setError:function(t){"function"==typeof this.error&&this.error(t)},setReady:function(t){this._readyOnce||(this.trigger("readyOnce"),this._readyOnce=!0),this._ready=!0,this.trigger("ready")},loadTemplate:function(){var t=this.template,e=this.template_data,i="";if(this.placeholder){if(e=s.extend(e,{t:this.getTranslationFunction(!0)}),this.template)try{i=a(t,e)}catch(t){s.error("Templating error for component: '"+this.name+"' - Check if template name is unique and correct. E.g.: 'bubblechart'"),s.removeClass(this.placeholder,m),s.addClass(this.placeholder,g),this.setError({type:"template"})}s.addClass(this.placeholder,m),s.addClass(this.placeholder,p),this.placeholder.innerHTML=i,this.element=this.placeholder.children[0],this.trigger("domReady")}},getActiveProfile:function(t,e){var i=this.getLayoutProfile(),n=this.getPresentationMode(),r=s.deepClone(t[i]);return n&&(e||{})[i]&&s.deepExtend(r,e[i]),r},loadSubComponents:function(){var t=this,e=void 0,i=void 0;this.components=[],s.forEach(this._components_config,function(n){if(n.model=n.model||{},!n.component)return void s.error("Error loading component: name not provided");if(i=s.isString(n.component)?y.get(n.component):n.component){e=s.extend(n,{name:n.component,ui:t._uiMapping(n.placeholder,n.ui)});var r=new i(e,t);t.components.push(r)}})},findChildByName:function(t){return s.find(this.components,function(e){return e.name===t})},getLayoutProfile:function(){return this.model.ui?this.model.ui.currentProfile():this.parent.getLayoutProfile()},getPresentationMode:function(){return this.model.ui?this.model.ui.getPresentationMode():this.parent.getPresentationMode()},_uiMapping:function(t,e){if(e)return new h.default("ui",e);if(t&&this.ui){t=t.replace(".","");var i=this.ui[t];if(i)return i}return this.ui},_modelMapping:function(t){function e(t){for(var e=t.split("."),n=i.parent.model,r="";e.length;)r=e.shift(),n=n[r];return{name:t,model:n,type:n?n.getType():null}}var i=this,n={};if(s.isArray(t)&&s.isArray(this.model_expects)){this.model_expects.length!==t.length&&(s.groupCollapsed("DIFFERENCE IN NUMBER OF MODELS EXPECTED AND RECEIVED"),s.warn("Please, configure the 'model_expects' attribute accordingly in '"+this.name+"' or check the models passed in '"+i.parent.name+"'.\n\nComponent: '"+i.parent.name+"'\nSubcomponent: '"+this.name+"'\nNumber of Models Expected: "+this.model_expects.length+"\nNumber of Models Received: "+t.length),s.groupEnd()),s.forEach(t,function(r,a){var o=e(r),l=void 0;i.model_expects[a]?(l=i.model_expects[a].name,!i.model_expects[a].type||o.type===i.model_expects[a].type||s.isArray(i.model_expects[a].type)&&i.model_expects[a].type.indexOf(o.type)!==-1||(s.groupCollapsed("UNEXPECTED MODEL TYPE: '"+o.type+"' instead of '"+i.model_expects[a].type+"'"),s.warn("Please, configure the 'model_expects' attribute accordingly in '"+i.name+"' or check the models passed in '"+i.parent.name+"'.\n\nComponent: '"+i.parent.name+"'\nSubcomponent: '"+i.name+"'\nExpected Model: '"+i.model_expects[a].type+"'\nReceived Model: '"+o.type+"'\nModel order: "+a),s.groupEnd())):(s.groupCollapsed("UNEXPECTED MODEL: '"+t[a]+"'"),s.warn("Please, configure the 'model_expects' attribute accordingly in '"+i.name+"' or check the models passed in '"+i.parent.name+"'.\n\nComponent: '"+i.parent.name+"'\nSubcomponent: '"+i.name+"'\nNumber of Models Expected: "+i.model_expects.length+"\nNumber of Models Received: "+t.length),s.groupEnd(),l=o.name),n[l]=o.model});var r=t.length,a=this.model_expects.length;return a>r&&(this.model_expects.splice(0,r),s.forEach(a,function(t){n[t.name]={}})),new h.default(this.name,n,null,this.model_binds)}},getTranslationFunction:function(t){var e=void 0;try{e=this.model.get("locale").getTFunction()}catch(t){this.parent&&this.parent!==this&&(e=this.parent.getTranslationFunction())}return e||(e=function(t){return t}),t?this._translatedStringFunction(e):e},_translatedStringFunction:function(t){return function(e){var i=t(e);return'<span data-vzb-translate="'+e+'">'+i+"</span>"}},translateStrings:function(){var t=this.getTranslationFunction(),e=this.placeholder.querySelectorAll("[data-vzb-translate]");0!==e.length&&s.forEach(e,function(e){e&&e.getAttribute&&(e.innerHTML=t(e.getAttribute("data-vzb-translate")))})},readyOnce:function(){},ready:function(){},resize:function(){},domReady:function(){},clear:function(){this.freeze(),this.model&&this.model.freeze(),s.forEach(this.components,function(t){t.clear()})}});y.isComponent=function(t){return t._id&&("t"===t._id[0]||"c"===t._id[0])},e.default=y},function(t,e,i){var n=i(6);t.exports=function(t){if(!n(t))throw TypeError(t+" is not an object!");return t}},function(t,e){var i=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=i)},function(t,e){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,e){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,e,i){var n=i(83)("wks"),r=i(58),a=i(4).Symbol,o="function"==typeof a,s=t.exports=function(t){return n[t]||(n[t]=o&&a[t]||(o?a:r)("Symbol."+t))};s.store=n},function(t,e,i){t.exports=!i(5)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(t,e,i){var n=i(3),r=i(161),a=i(33),o=Object.defineProperty;e.f=i(8)?Object.defineProperty:function(t,e,i){if(n(t),e=a(e,!0),n(i),r)try{return o(t,e,i)}catch(t){}if("get"in i||"set"in i)throw TypeError("Accessors not supported!");return"value"in i&&(t[e]=i.value),t}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.paintbrush='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M1615 0q70 0 122.5 46.5t52.5 116.5q0 63-45 151-332 629-465 752-97 91-218 91-126 0-216.5-92.5t-90.5-219.5q0-128 92-212l638-579q59-54 130-54zm-909 1034q39 76 106.5 130t150.5 76l1 71q4 213-129.5 347t-348.5 134q-123 0-218-46.5t-152.5-127.5-86.5-183-29-220q7 5 41 30t62 44.5 59 36.5 46 17q41 0 55-37 25-66 57.5-112.5t69.5-76 88-47.5 103-25.5 125-10.5z"/></svg>',e.search='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M1216 832q0-185-131.5-316.5t-316.5-131.5-316.5 131.5-131.5 316.5 131.5 316.5 316.5 131.5 316.5-131.5 131.5-316.5zm512 832q0 52-38 90t-90 38q-54 0-90-38l-343-342q-179 124-399 124-143 0-273.5-55.5t-225-150-150-225-55.5-273.5 55.5-273.5 150-225 225-150 273.5-55.5 273.5 55.5 225 150 150 225 55.5 273.5q0 220-124 399l343 343q37 37 37 90z"/></svg>',e.circle='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M1664 896q0 209-103 385.5t-279.5 279.5-385.5 103-385.5-103-279.5-279.5-103-385.5 103-385.5 279.5-279.5 385.5-103 385.5 103 279.5 279.5 103 385.5z"/></svg>',e.expand='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M883 1056q0 13-10 23l-332 332 144 144q19 19 19 45t-19 45-45 19h-448q-26 0-45-19t-19-45v-448q0-26 19-45t45-19 45 19l144 144 332-332q10-10 23-10t23 10l114 114q10 10 10 23zm781-864v448q0 26-19 45t-45 19-45-19l-144-144-332 332q-10 10-23 10t-23-10l-114-114q-10-10-10-23t10-23l332-332-144-144q-19-19-19-45t19-45 45-19h448q26 0 45 19t19 45z"/></svg>',e.asterisk='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M1546 1050q46 26 59.5 77.5t-12.5 97.5l-64 110q-26 46-77.5 59.5t-97.5-12.5l-266-153v307q0 52-38 90t-90 38h-128q-52 0-90-38t-38-90v-307l-266 153q-46 26-97.5 12.5t-77.5-59.5l-64-110q-26-46-12.5-97.5t59.5-77.5l266-154-266-154q-46-26-59.5-77.5t12.5-97.5l64-110q26-46 77.5-59.5t97.5 12.5l266 153v-307q0-52 38-90t90-38h128q52 0 90 38t38 90v307l266-153q46-26 97.5-12.5t77.5 59.5l64 110q26 46 12.5 97.5t-59.5 77.5l-266 154z"/></svg>',e.trails='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M 1381.375 17.1875 C 1375.7825 17.176804 1370.1216 17.316078 1364.4375 17.5625 C 1273.4913 21.505489 1197.0982 57.199956 1135.2188 124.6875 C 1076.5961 188.62338 1047.6964 263.96059 1048.5312 350.65625 L 835.71875 433 C 797.77288 391.67699 749.96961 361.96416 692.3125 343.84375 C 604.96227 316.39162 520.95691 323.70366 440.25 365.8125 C 359.5432 407.92133 305.45225 472.64985 278 560 C 250.54783 647.35004 257.89117 731.38694 300 812.09375 C 342.10886 892.80075 406.83755 946.89147 494.1875 974.34375 C 576.9404 1000.3512 657.38873 994.58645 735.5625 957.09375 L 959.28125 1171.4375 L 972.375 1184.4062 C 966.2931 1198.3454 961.94845 1209.2226 959.34375 1217.0625 C 956.73915 1224.9024 953.7186 1236.224 950.25 1251.0312 L 711.03125 1285.1875 C 669.59175 1209.0324 607.72526 1157.2863 525.40625 1129.9375 C 438.51381 1101.0693 354.34933 1107.021 272.96875 1147.8125 C 191.58796 1188.6039 136.49335 1252.4513 107.625 1339.3438 C 78.756758 1426.2362 84.708528 1510.3694 125.5 1591.75 C 166.29138 1673.1307 230.1387 1728.2567 317.03125 1757.125 C 403.92369 1785.9933 488.05682 1780.0415 569.4375 1739.25 C 650.81799 1698.4587 705.94425 1634.6111 734.8125 1547.7188 C 737.41718 1539.8788 740.43763 1528.5573 743.90625 1513.75 L 983.125 1479.5938 C 1024.5644 1555.7487 1086.4309 1607.4948 1168.75 1634.8438 C 1255.6425 1663.7119 1339.8069 1657.7603 1421.1875 1616.9688 C 1502.5682 1576.1772 1557.6631 1512.3299 1586.5312 1425.4375 C 1615.3996 1338.5451 1609.4477 1254.4119 1568.6562 1173.0312 C 1527.8647 1091.6506 1464.0174 1036.5244 1377.125 1007.6562 C 1294.9259 980.34721 1214.5066 984.74084 1135.8438 1020.8125 L 1120.2812 1005.9062 L 898.0625 785.96875 C 902.79653 774.40321 906.33847 765.03422 908.5 758.15625 C 920.42249 720.22 925.7916 682.90194 924.59375 646.21875 L 1130.9688 566.34375 C 1141.2015 577.59424 1149.3796 586.0106 1155.4688 591.59375 C 1222.9566 653.47326 1302.1474 682.44278 1393.0938 678.5 C 1484.04 674.55731 1560.4642 638.83151 1622.3438 571.34375 C 1684.2232 503.85591 1713.1929 424.6337 1709.25 333.6875 C 1705.3072 242.74139 1669.5816 166.34819 1602.0938 104.46875 C 1538.8238 46.456824 1465.2625 17.347946 1381.375 17.1875 z "/></svg>',e.lock='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M640 768h512v-192q0-106-75-181t-181-75-181 75-75 181v192zm832 96v576q0 40-28 68t-68 28h-960q-40 0-68-28t-28-68v-576q0-40 28-68t68-28h32v-192q0-184 132-316t316-132 316 132 132 316v192h32q40 0 68 28t28 68z"/></svg>',e.unlock='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M1376 768q40 0 68 28t28 68v576q0 40-28 68t-68 28h-960q-40 0-68-28t-28-68v-576q0-40 28-68t68-28h32v-320q0-185 131.5-316.5t316.5-131.5 316.5 131.5 131.5 316.5q0 26-19 45t-45 19h-64q-26 0-45-19t-19-45q0-106-75-181t-181-75-181 75-75 181v320h736z"/></svg>',e.unexpand='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M896 960v448q0 26-19 45t-45 19-45-19l-144-144-332 332q-10 10-23 10t-23-10l-114-114q-10-10-10-23t10-23l332-332-144-144q-19-19-19-45t19-45 45-19h448q26 0 45 19t19 45zm755-672q0 13-10 23l-332 332 144 144q19 19 19 45t-19 45-45 19h-448q-26 0-45-19t-19-45v-448q0-26 19-45t45-19 45 19l144 144 332-332q10-10 23-10t23 10l114 114q10 10 10 23z"/></svg>',e.axes='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 500 500"><path d="M430.25,379.655l-75.982-43.869v59.771H120.73V151.966h59.774l-43.869-75.983L92.767,0L48.898,75.983L5.029,151.966h59.775 v271.557c0,15.443,12.52,27.965,27.963,27.965h261.5v59.773l75.982-43.869l75.982-43.867L430.25,379.655z"/></svg>',
e.gear='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M1152 896q0-106-75-181t-181-75-181 75-75 181 75 181 181 75 181-75 75-181zm512-109v222q0 12-8 23t-20 13l-185 28q-19 54-39 91 35 50 107 138 10 12 10 25t-9 23q-27 37-99 108t-94 71q-12 0-26-9l-138-108q-44 23-91 38-16 136-29 186-7 28-36 28h-222q-14 0-24.5-8.5t-11.5-21.5l-28-184q-49-16-90-37l-141 107q-10 9-25 9-14 0-25-11-126-114-165-168-7-10-7-23 0-12 8-23 15-21 51-66.5t54-70.5q-27-50-41-99l-183-27q-13-2-21-12.5t-8-23.5v-222q0-12 8-23t19-13l186-28q14-46 39-92-40-57-107-138-10-12-10-24 0-10 9-23 26-36 98.5-107.5t94.5-71.5q13 0 26 10l138 107q44-23 91-38 16-136 29-186 7-28 36-28h222q14 0 24.5 8.5t11.5 21.5l28 184q49 16 90 37l142-107q9-9 24-9 13 0 25 10 129 119 165 170 7 8 7 22 0 12-8 23-15 21-51 66.5t-54 70.5q26 50 41 98l183 28q13 2 21 12.5t8 23.5z"/></svg>',e.stack='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 54.849 54.849"><g><path d="M54.497,39.614l-10.363-4.49l-14.917,5.968c-0.537,0.214-1.165,0.319-1.793,0.319c-0.627,0-1.254-0.104-1.79-0.318     l-14.921-5.968L0.351,39.614c-0.472,0.203-0.467,0.524,0.01,0.716L26.56,50.81c0.477,0.191,1.251,0.191,1.729,0L54.488,40.33     C54.964,40.139,54.969,39.817,54.497,39.614z"/><path d="M54.497,27.512l-10.364-4.491l-14.916,5.966c-0.536,0.215-1.165,0.321-1.792,0.321c-0.628,0-1.256-0.106-1.793-0.321     l-14.918-5.966L0.351,27.512c-0.472,0.203-0.467,0.523,0.01,0.716L26.56,38.706c0.477,0.19,1.251,0.19,1.729,0l26.199-10.479     C54.964,28.036,54.969,27.716,54.497,27.512z"/><path d="M0.361,16.125l13.662,5.465l12.537,5.015c0.477,0.191,1.251,0.191,1.729,0l12.541-5.016l13.658-5.463     c0.477-0.191,0.48-0.511,0.01-0.716L28.277,4.048c-0.471-0.204-1.236-0.204-1.708,0L0.351,15.41     C-0.121,15.614-0.116,15.935,0.361,16.125z"/></g></svg>',e.drag='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M896 384q-53 0-90.5 37.5t-37.5 90.5v128h-32v-93q0-48-32-81.5t-80-33.5q-46 0-79 33t-33 79v429l-32-30v-172q0-48-32-81.5t-80-33.5q-46 0-79 33t-33 79v224q0 47 35 82l310 296q39 39 39 102 0 26 19 45t45 19h640q26 0 45-19t19-45v-25q0-41 10-77l108-436q10-36 10-77v-246q0-48-32-81.5t-80-33.5q-46 0-79 33t-33 79v32h-32v-125q0-40-25-72.5t-64-40.5q-14-2-23-2-46 0-79 33t-33 79v128h-32v-122q0-51-32.5-89.5t-82.5-43.5q-5-1-13-1zm0-128q84 0 149 50 57-34 123-34 59 0 111 27t86 76q27-7 59-7 100 0 170 71.5t70 171.5v246q0 51-13 108l-109 436q-6 24-6 71 0 80-56 136t-136 56h-640q-84 0-138-58.5t-54-142.5l-308-296q-76-73-76-175v-224q0-99 70.5-169.5t169.5-70.5q11 0 16 1 6-95 75.5-160t164.5-65q52 0 98 21 72-69 174-69z"/></svg>',e.warn='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512.209 512.209"><path d="M507.345,439.683L288.084,37.688c-3.237-5.899-7.71-10.564-13.429-13.988c-5.705-3.427-11.893-5.142-18.554-5.142   s-12.85,1.718-18.558,5.142c-5.708,3.424-10.184,8.089-13.418,13.988L4.859,439.683c-6.663,11.998-6.473,23.989,0.57,35.98   c3.239,5.517,7.664,9.897,13.278,13.128c5.618,3.237,11.66,4.859,18.132,4.859h438.529c6.479,0,12.519-1.622,18.134-4.859   c5.62-3.23,10.038-7.611,13.278-13.128C513.823,463.665,514.015,451.681,507.345,439.683z M292.655,411.132   c0,2.662-0.91,4.897-2.71,6.704c-1.807,1.811-3.949,2.71-6.427,2.71h-54.816c-2.474,0-4.616-0.899-6.423-2.71   c-1.809-1.807-2.713-4.042-2.713-6.704v-54.248c0-2.662,0.905-4.897,2.713-6.704c1.807-1.811,3.946-2.71,6.423-2.71h54.812   c2.479,0,4.62,0.899,6.428,2.71c1.803,1.807,2.71,4.042,2.71,6.704v54.248H292.655z M292.088,304.357   c-0.198,1.902-1.198,3.47-3.001,4.709c-1.811,1.238-4.046,1.854-6.711,1.854h-52.82c-2.663,0-4.947-0.62-6.849-1.854   c-1.908-1.243-2.858-2.807-2.858-4.716l-4.853-130.47c0-2.667,0.953-4.665,2.856-5.996c2.474-2.093,4.758-3.14,6.854-3.14h62.809   c2.098,0,4.38,1.043,6.854,3.14c1.902,1.331,2.851,3.14,2.851,5.424L292.088,304.357z"/></svg>',e.pin='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M800 864v-448q0-14-9-23t-23-9-23 9-9 23v448q0 14 9 23t23 9 23-9 9-23zm672 352q0 26-19 45t-45 19h-429l-51 483q-2 12-10.5 20.5t-20.5 8.5h-1q-27 0-32-27l-76-485h-404q-26 0-45-19t-19-45q0-123 78.5-221.5t177.5-98.5v-512q-52 0-90-38t-38-90 38-90 90-38h640q52 0 90 38t38 90-38 90-90 38v512q99 0 177.5 98.5t78.5 221.5z"/></svg>',e.question='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="17 17 483 483"> <circle stroke-width="40" cx="258.57" cy="258.57" r="220"/> <path d="M299.756,413.021v-61.78c0-3.003-0.966-5.472-2.896-7.401s-4.398-2.896-7.401-2.896h-61.78 c-3.003,0-5.47,0.965-7.4,2.896c-1.932,1.931-2.896,4.398-2.896,7.401v61.78c0,3.002,0.965,5.47,2.896,7.399 c1.931,1.931,4.396,2.896,7.4,2.896h61.779c3.003,0,5.472-0.967,7.401-2.896S299.756,416.021,299.756,413.021z"/> <path d="M382.128,196.789c0-18.877-5.952-36.36-17.856-52.449c-11.905-16.088-26.762-28.53-44.566-37.325 c-17.804-8.795-36.037-13.192-54.7-13.192c-52.127,0-91.919,22.845-119.377,68.537c-3.218,5.148-2.359,9.653,2.574,13.514 l42.474,32.177c1.502,1.287,3.54,1.931,6.114,1.931c3.433,0,6.115-1.287,8.044-3.861c11.369-14.587,20.594-24.454,27.672-29.603 c7.294-5.148,16.519-7.723,27.673-7.723c10.297,0,19.468,2.789,27.513,8.366c8.044,5.578,12.065,11.906,12.065,18.985 c0,8.151-2.146,14.694-6.437,19.628c-4.29,4.934-11.583,9.76-21.881,14.479c-13.514,6.006-25.901,15.284-37.164,27.834 c-11.263,12.549-16.894,26.01-16.894,40.382v11.583c0,3.004,0.965,5.472,2.896,7.401c1.931,1.93,4.396,2.896,7.4,2.896h61.779 c3.003,0,5.471-0.965,7.401-2.896c1.93-1.931,2.896-4.397,2.896-7.401c0-4.075,2.306-9.385,6.917-15.928 c4.612-6.542,10.458-11.852,17.537-15.927c6.863-3.861,12.119-6.918,15.768-9.171c3.646-2.252,8.579-6.008,14.802-11.263 c6.22-5.255,10.993-10.402,14.317-15.443c3.325-5.042,6.328-11.53,9.01-19.467C380.788,214.916,382.128,206.228,382.128,196.789z"/> </svg>',e.close='<svg class="vzb-icon vzb-icon-pin" viewBox="-150 -250 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1149 414q0 26 -19 45l-181 181l181 181q19 19 19 45q0 27 -19 46l-90 90q-19 19 -46 19q-26 0 -45 -19l-181 -181l-181 181q-19 19 -45 19q-27 0 -46 -19l-90 -90q-19 -19 -19 -46q0 -26 19 -45l181 -181l-181 -181q-19 -19 -19 -45q0 -27 19 -46l90 -90q19 -19 46 -19 q26 0 45 19l181 181l181 -181q19 -19 45 -19q27 0 46 19l90 90q19 19 19 46z"/></svg>',e.presentation='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path id="flip-chart-1" d="M334.549,393.834l58.607,68.666h-45.096l-58.709-68.666H334.549z M240.333,462.5h34.333v-68.666h-34.333 V462.5z M360.5,153.5h-34.334v137.334H360.5V153.5z M121.566,462.5h45.113l58.709-68.666h-45.197L121.566,462.5z M206,273.666 h-34.333v17.168H206V273.666z M257.5,239.333h-34.333v51.5H257.5V239.333z M309,205h-34.334v85.834H309V205z M446.334,102h-17.168 v257.5H85.833V102H68.667V50.5h377.667V102z M394.834,102H120.167v223.166h274.667V102z"/></svg>',e.about='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792"><path d="M1088 1256v240q0 16-12 28t-28 12h-240q-16 0-28-12t-12-28v-240q0-16 12-28t28-12h240q16 0 28 12t12 28zm316-600q0 54-15.5 101t-35 76.5-55 59.5-57.5 43.5-61 35.5q-41 23-68.5 65t-27.5 67q0 17-12 32.5t-28 15.5h-240q-15 0-25.5-18.5t-10.5-37.5v-45q0-83 65-156.5t143-108.5q59-27 84-56t25-76q0-42-46.5-74t-107.5-32q-65 0-108 29-35 25-107 115-13 16-31 16-12 0-25-8l-164-125q-13-10-15.5-25t5.5-28q160-266 464-266 80 0 161 31t146 83 106 127.5 41 158.5z"/></svg>',e.cursorArrow='<svg class="vzb-icon" viewBox="-200 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1389 1043q31 30 14 69-17 40-59 40h-382l201 476q10 25 0 49t-34 35l-177 75q-25 10-49 0t-35-34l-191-452-312 312q-19 19-45 19-12 0-24-5-40-17-40-59v-1504q0-42 40-59 12-5 24-5 27 0 45 19z"/></svg>',e.cursorPlus='<svg class="vzb-icon" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1088 800v64q0 13-9.5 22.5t-22.5 9.5h-224v224q0 13-9.5 22.5t-22.5 9.5h-64q-13 0-22.5-9.5t-9.5-22.5v-224h-224q-13 0-22.5-9.5t-9.5-22.5v-64q0-13 9.5-22.5t22.5-9.5h224v-224q0-13 9.5-22.5t22.5-9.5h64q13 0 22.5 9.5t9.5 22.5v224h224q13 0 22.5 9.5t9.5 22.5zm128 32q0-185-131.5-316.5t-316.5-131.5-316.5 131.5-131.5 316.5 131.5 316.5 316.5 131.5 316.5-131.5 131.5-316.5zm512 832q0 53-37.5 90.5t-90.5 37.5q-54 0-90-38l-343-342q-179 124-399 124-143 0-273.5-55.5t-225-150-150-225-55.5-273.5 55.5-273.5 150-225 225-150 273.5-55.5 273.5 55.5 225 150 150 225 55.5 273.5q0 220-124 399l343 343q37 37 37 90z"/></svg>',e.cursorMinus='<svg class="vzb-icon" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1088 800v64q0 13-9.5 22.5t-22.5 9.5h-576q-13 0-22.5-9.5t-9.5-22.5v-64q0-13 9.5-22.5t22.5-9.5h576q13 0 22.5 9.5t9.5 22.5zm128 32q0-185-131.5-316.5t-316.5-131.5-316.5 131.5-131.5 316.5 131.5 316.5 316.5 131.5 316.5-131.5 131.5-316.5zm512 832q0 53-37.5 90.5t-90.5 37.5q-54 0-90-38l-343-342q-179 124-399 124-143 0-273.5-55.5t-225-150-150-225-55.5-273.5 55.5-273.5 150-225 225-150 273.5-55.5 273.5 55.5 225 150 150 225 55.5 273.5q0 220-124 399l343 343q37 37 37 90z"/></svg>',e.hundredPercent='<svg class="vzb-icon" xmlns="http://www.w3.org/2000/svg"><g transform="translate(18 11)"><text transform="scale(0.9 1)" x="0" y="0">100</text><text transform="scale(0.6 1)" class="percent" x="0" y="0">%</text></g></svg>',e.percent='<svg class="vzb-icon" viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1408 1280q0-52-38-90t-90-38-90 38-38 90 38 90 90 38 90-38 38-90zm-768-768q0-52-38-90t-90-38-90 38-38 90 38 90 90 38 90-38 38-90zm1024 768q0 159-112.5 271.5t-271.5 112.5-271.5-112.5-112.5-271.5 112.5-271.5 271.5-112.5 271.5 112.5 112.5 271.5zm-96-1088q0 20-13 38l-1056 1408q-19 26-51 26h-160q-26 0-45-19t-19-45q0-20 13-38l1056-1408q19-26 51-26h160q26 0 45 19t19 45zm-672 320q0 159-112.5 271.5t-271.5 112.5-271.5-112.5-112.5-271.5 112.5-271.5 271.5-112.5 271.5 112.5 112.5 271.5z"/></svg>',e.side='<svg class="vzb-icon" viewBox="-120 -1540 1792 1792" xmlns="http://www.w3.org/2000/svg"><path transform="rotate(-90) scale(1.2)" d="M1024 448q0 -26 -19 -45l-448 -448q-19 -19 -45 -19t-45 19l-448 448q-19 19 -19 45t19 45t45 19h896q26 0 45 -19t19 -45zM1024 832q0 -26 -19 -45t-45 -19h-896q-26 0 -45 19t-19 45t19 45l448 448q19 19 45 19t45 -19l448 -448q19 -19 19 -45z"/></svg>',e.cursorHand='<svg class="vzb-icon" viewBox="0 -1540 1792 1792" xmlns="http://www.w3.org/2000/svg"><path transform="scale(1,-1)" d="M880 1408q-46 0 -79 -33t-33 -79v-656h-32v528q0 46 -33 79t-79 33t-79 -33t-33 -79v-528v-256l-154 205q-38 51 -102 51q-53 0 -90.5 -37.5t-37.5 -90.5q0 -43 26 -77l384 -512q38 -51 102 -51h688q34 0 61 22t34 56l76 405q5 32 5 59v498q0 46 -33 79t-79 33t-79 -33t-33 -79v-272h-32v528q0 46 -33 79t-79 33t-79 -33t-33 -79v-528h-32v656q0 46 -33 79t-79 33zM880 1536q68 0 125.5 -35.5t88.5 -96.5q19 4 42 4q99 0 169.5 -70.5t70.5 -169.5v-17q105 6 180.5 -64t75.5 -175v-498q0 -40 -8 -83l-76 -404q-14 -79 -76.5 -131t-143.5 -52h-688q-60 0 -114.5 27.5t-90.5 74.5l-384 512q-51 68 -51 154q0 106 75 181t181 75q78 0 128 -34v434q0 99 70.5 169.5t169.5 70.5q23 0 42 -4q31 61 88.5 96.5t125.5 35.5z"/></svg>'},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function a(t,e,i){var n=void 0,r=void 0,a=void 0,o=void 0,l=void 0,c=void 0,u=void 0,h=void 0,d=void 0,f=void 0,p=void 0,m=void 0,g=void 0,v=void 0;return{move:function(e,i){t.style("right",e+"px"),t.style("top",i+"px")},dragStart:function(y){if(s.isTouchDevice()){var b=d3.touches(e.node());n=b[0][0],r=b[0][1]}else n=y.sourceEvent.clientX,r=y.sourceEvent.clientY;a=parseInt(t.style("top"))||0,o=parseInt(t.style("right"))||0,c=parseInt(t.style("margin-left"))||0,l=parseInt(t.style("margin-right"))||0,h=Math.min(i,c),u=Math.min(i,l),d=parseInt(t.style("width"))+c-h,f=parseInt(t.style("height")),p=parseInt(e.style("width"))-l,m=parseInt(e.style("height")),g=n+o,v=r-a},drag:function(t){if(s.isTouchDevice()){var i=d3.touches(e.node());n=i[0][0],r=i[0][1]}else n=t.sourceEvent.clientX,r=t.sourceEvent.clientY;var a=-n+g,o=r-v;a<-u&&(a=-u),o<0&&(o=0),a+d>p&&(a=p-d),o+f>m&&(o=m-f),this.move(a,o)}}}Object.defineProperty(e,"__esModule",{value:!0});var o=i(1),s=r(o),l=i(2),c=n(l),u=i(10),h=i(71),d=n(h),f=(0,d.default)(i(474)),p=c.default.extend({init:function(t,e){this.name=this.name||"",this.model_expects=this.model_expects||[{name:"state",type:"model"},{name:"ui",type:"ui"},{name:"locale",type:"locale"}],this.template=f[this.name],this._super(t,e)},readyOnce:function(){this.element=d3.select(this.element),this.titleEl=this.element.selectAll(".vzb-top-dialog > .vzb-dialog-modal > .vzb-dialog-title"),this.buttonsEl=this.element.selectAll(".vzb-top-dialog > .vzb-dialog-modal > .vzb-dialog-buttons"),this.contentEl=this.element.selectAll(".vzb-top-dialog > .vzb-dialog-modal > .vzb-dialog-content")},ready:function(){var t=this;this.placeholderEl=d3.select(this.placeholder),this.rootEl=this.root.element instanceof Array?this.root.element:d3.select(this.root.element),this.dragHandler=this.placeholderEl.select("[data-click='dragDialog']"),this.dragHandler.html(u.drag),this.pinIcon=this.placeholderEl.select("[data-click='pinDialog']"),this.pinIcon.html(u.pin),this.topPos="";var e=this.getLayoutProfile(),i=a(this.placeholderEl,this.rootEl,10),n=d3.drag().on("start",function(){var e=t.placeholderEl.node().offsetTop;t.placeholderEl.style("top",e+"px"),t.placeholderEl.style("bottom","auto"),t.trigger("dragstart"),i.dragStart(d3.event)}).on("drag",function(){t.trigger("drag"),i.drag(d3.event)}).on("end",function(){t.rightPos=t.placeholderEl.style("right"),t.topPos=t.placeholderEl.style("top"),t.trigger("dragend")});this.dragHandler.call(n),this.dragHandler.classed("vzb-hidden","small"===e),this.pinIcon.classed("vzb-hidden","small"===e),this.resize()},resize:function(){if(this.placeholderEl&&this.rootEl&&this.placeholderEl.classed("vzb-top-dialog")){this.placeholderEl.classed("notransition",!0);var t=this.getLayoutProfile();if("small"!==t){var e=parseInt(this.rootEl.style("width"),10),i=parseInt(this.rightPos,10),n=parseInt(this.rootEl.style("height"),10),r=parseInt(this.topPos,10),a=parseInt(this.placeholderEl.style("width"),10),o=parseInt(this.placeholderEl.style("height"),10),l=parseInt(this.placeholderEl.style("margin-right"),10)||0;s.isNumber(i)&&i>e-a-l&&this.rightPos&&(this.rightPos=e-a-l+"px",this.isOpen&&this.placeholderEl.style("right",this.rightPos)),s.isNumber(r)&&s.isNumber(o)&&r>=0&&r>n-o&&this.topPos&&(this.topPos=(n-o>0?n-o:0)+"px",this.isOpen&&this.placeholderEl.style("top",this.topPos)),this.topPos&&"large"===this.getLayoutProfile()&&this.rootEl.classed("vzb-dialog-expand-true")&&this.placeholderEl.style("bottom","auto"),this.rootEl.classed("vzb-landscape"),this.element.style("max-height","")}else this.rightPos="",this.topPos="",this.placeholderEl.attr("style","");this.dragHandler.classed("vzb-hidden","small"===t),this.pinIcon.classed("vzb-hidden","small"===t),this._setMaxHeight()}},_setMaxHeight:function(){var t=this.root.element.offsetHeight;if("small"!==this.getLayoutProfile())if(!this.topPos&&"large"===this.getLayoutProfile()&&this.rootEl.classed("vzb-dialog-expand-true")){var e=parseInt(this.placeholderEl.style("bottom"),10);t-=e}else{var i=this.topPos?parseInt(this.topPos,10):this.placeholderEl.node().offsetTop;t-=i}else t=this.rootEl.classed("vzb-portrait")?t-50:t-10;this.element.style("max-height",t+"px");var n=t-this.titleEl.node().offsetHeight-this.buttonsEl.node().offsetHeight;this.contentEl.style("max-height",n+"px")},beforeOpen:function(){var t=this;if(this.transitionEvents=["webkitTransitionEnd","transitionend","msTransitionEnd","oTransitionEnd"],this.transitionEvents.forEach(function(e){t.placeholderEl.on(e,t.transitionEnd.bind(t,e))}),this.placeholderEl.classed("notransition",!0),this.placeholderEl.style("top",""),this.placeholderEl.style("bottom",""),this.topPos&&"large"===this.getLayoutProfile()&&this.rootEl.classed("vzb-dialog-expand-true")){var e=this.placeholderEl.node().offsetTop;this.placeholderEl.style("top",e+"px"),this.placeholderEl.style("bottom","auto")}else"small"!==this.getLayoutProfile();this.placeholderEl.node().offsetTop,this.placeholderEl.classed("notransition",!1),"small"===this.getLayoutProfile()?this.placeholderEl.style("top",""):this.rootEl.classed("vzb-landscape")},open:function(){this.isOpen=!0,"small"!==this.getLayoutProfile()&&this.topPos&&(this.placeholderEl.style("top",this.topPos),this.placeholderEl.style("right",this.rightPos))},beforeClose:function(){this.rootEl.classed("vzb-portrait")&&"small"===this.getLayoutProfile()&&this.placeholderEl.style("top","auto"),"large"===this.getLayoutProfile()&&this.rootEl.classed("vzb-dialog-expand-true")&&(this.topPos0=this.topPos?this.placeholderEl.node().parentNode.offsetHeight-this.placeholderEl.node().offsetHeight+"px":""),this.placeholderEl.classed("notransition",!1),this.placeholderEl.node().offsetHeight},close:function(){this.rootEl.classed("vzb-portrait")&&"small"===this.getLayoutProfile()||(this.placeholderEl.style("top",""),this.placeholderEl.style("right","")),"large"===this.getLayoutProfile()&&this.rootEl.classed("vzb-dialog-expand-true")&&(this.placeholderEl.style("top",this.topPos0),this.placeholderEl.style("right","")),this.isOpen=!1,this.trigger("close")},transitionEnd:function(t){var e=this;this.transitionEvents.forEach(function(t){e.placeholderEl.on(t,null)}),this.isOpen&&this.placeholderEl.classed("notransition",!0)}});e.default=p},function(t,e,i){var n=i(45),r=Math.min;t.exports=function(t){return t>0?r(n(t),9007199254740991):0}},function(t,e,i){var n=i(29);t.exports=function(t){return Object(n(t))}},function(t,e){var i={}.hasOwnProperty;t.exports=function(t,e){return i.call(t,e)}},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o=i(1),s=r(o),l=i(47),c=n(l),u=i(2),h=n(u),d=i(10),f=i(46),p=n(f),m="vzb-loading-data",g="vzb-placeholder",v="vzb-buttonlist-off",y=c.default.extend({init:function(t,e){this._id=s.uniqueId("tm"),this._type="tool",this._component=t,this.getClassDefaults=function(){return t.default_model};var i=s.extend(t.getToolListeners(),e.bind);delete e.bind,this._super(t.name,e,null,i)},getDefaults:function(){return s.deepExtend({},this.getSubmodelDefaults(),this.getClassDefaults())},validate:function(){function t(i){var r=JSON.stringify(n.getPlainObject());n._component.validate(n);var a=JSON.stringify(n.getPlainObject());i>=e?s.error("Max validation loop."):r!==a&&t(i++)}var e=10,i=0,n=this;t(i)}}),b=h.default.extend({init:function(t,e){this._id=s.uniqueId("t"),this.template=this.getToolTemplate(),this._super({placeholder:t,model:e}),this.render(),this.setCSSClasses(),this.setResizeHandler()},createModel:function(t){t=t||{},t.bind=t.bind||{},this.model=new y(this,t),this.model.setInterModelListeners()},getToolTemplate:function(){return this.template||'<div class="vzb-tool vzb-tool-'+this.name+'"><div class="vzb-tool-stage"><div class="vzb-tool-viz"></div><div class="vzb-tool-time-speed-sliders"><div class="vzb-tool-timeslider"></div><div class="vzb-tool-stepped-speed-slider"></div></div></div><div class="vzb-tool-sidebar"><div class="vzb-tool-dialogs"></div><div class="vzb-tool-buttonlist"></div></div><div class="vzb-tool-datanotes vzb-hidden"></div><div class="vzb-tool-treemenu vzb-hidden"></div><div class="vzb-tool-datawarning vzb-hidden"></div><div class="vzb-tool-labels vzb-hidden"></div></div>'},getToolListeners:function(){var t=this,e=this;return s.extend(this.model_binds,{change:function(t,i){e._ready&&(e.model.validate(),t.source.persistent&&e.model.trigger(new f.DefaultEvent(t.source,"persistentChange")))},hook_change:function(){e.model.state.time.splash||e.beforeLoading()},"resize:ui":function(){e._ready&&e.triggerResize()},"translate:locale":function(){e.translateStrings(),e.model.ui.setRTL(e.model.locale.isRTL())},load_error:function(){t.renderError(),t.error.apply(t,arguments)}})},setResizeHandler:function(){this.model.ui.setContainer(this.element)},triggerResize:s.throttle(function(){this.trigger("resize")},100),startLoading:function(){var t=this;this._super(),Promise.all([this.model.startPreload(),this.startPreload()]).then(this.afterPreload.bind(this)).then(this.loadSplashScreen.bind(this)).then(function(){return s.delay(300)}).then(this.model.startLoading.bind(this.model)).then(this.finishLoading.bind(this)).catch(function(e){p.default.unfreezeAll(),t.model.triggerLoadError(e)})},loadSplashScreen:function(){return this.model.ui.splash?(this.model.state.time.splash=!0,this.model.startLoading({splashScreen:!0})):Promise.resolve()},finishLoading:function(){this.model.state.time.splash=!1},getPersistentModel:function(){var t=function t(e){for(var i in e)"function"==typeof e[i]?(delete e[i],s.warn("minModel validation. Function found in enumerable properties of "+i+". This key is deleted from minModel")):"object"===a(e[i])&&t(e[i])},e=this.model.getPlainObject(!0);return t(e),e},getPersistentMinimalModel:function(t){var e=this.model.getDefaults(),i=this.getPersistentModel(),n=s.deepExtend(e,t);return s.diffObject(i,n)},clear:function(){this.model.ui.clear(),this.setModel=this.getModel=function(){},this._super()},error:function(t,e){e||(e=t&&"data"===t.type?"Error loading chart data. <br>Please, try again later.":"Error loading chart"),this.placeholder.innerHTML='<div class="vzb-error-message"><h1>'+d.warn+"</h1><p>"+e+"</p></div>"},setModel:function(t,e){e?this.model.reset(t):this.model.set(t),this.setCSSClasses()},getModel:function(){return this.model.getPlainObject()||{}},beforeLoading:function(){s.addClass(this.placeholder,m)},validate:function(t){if(t=this.model||t,!t||!t.state)return s.warn("tool validation aborted: model.state looks wrong: "+t)},setCSSClasses:function(){s.addClass(this.placeholder,g),this.model.ui&&this.model.ui.buttons&&this.model.ui.buttons.length?s.removeClass(this.element,v):s.addClass(this.element,v)}});e.default=b},function(t,e,i){"use strict";function n(t,e){function i(){this.trackInstances&&i.instances.push(this),!a&&this.init&&this.init.apply(this,arguments)}e=1===arguments.length?t:e;var s=this.prototype;a=!0;var l=new this;return a=!1,(0,r.forEach)(e,function(t,i){"function"==typeof e[i]&&"function"==typeof s[i]&&o.test(e[i])?l[i]=function(t,e){return function(){var i=this._super;this._super=s[t];var n=e.apply(this,arguments);return this._super=i,n}}(i,e[i]):l[i]=t}),i.prototype=l,i.prototype.constructor=i,i.extend=n,i._collection={},i.instances=[],i.register=function(t,e){"undefined"!=typeof this._collection[t]&&(0,r.warn)('"'+t+'" is already registered. Overwriting...'),this._collection[t]=e},i.unregister=function(t){this._collection[t]=void 0},i.getCollection=function(){return this._collection},i.define=function(t,e){this.prototype[t]=e},i.get=function(t,e){return this._collection.hasOwnProperty(t)?this._collection[t]:(e||(0,r.warn)('"'+t+'" was not found.'),!1)},arguments.length>1&&this.register&&this.register(t,i),i}Object.defineProperty(e,"__esModule",{value:!0});var r=i(1),a=!1,o=/xyz/.test(function(){})?/\b_super\b/:/.*/,s=function(){};s.extend=n,e.default=s},function(t,e){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},function(t,e,i){var n=i(9),r=i(44);t.exports=i(8)?function(t,e,i){return n.f(t,e,r(1,i))}:function(t,e,i){return t[e]=i,t}},function(t,e,i){var n=i(4),r=i(18),a=i(14),o=i(58)("src"),s="toString",l=Function[s],c=(""+l).split(s);i(36).inspectSource=function(t){return l.call(t)},(t.exports=function(t,e,i,s){var l="function"==typeof i;l&&(a(i,"name")||r(i,"name",e)),t[e]!==i&&(l&&(a(i,o)||r(i,o,t[e]?""+t[e]:c.join(String(e)))),t===n?t[e]=i:s?t[e]?t[e]=i:r(t,e,i):(delete t[e],r(t,e,i)))})(Function.prototype,s,function(){return"function"==typeof this&&this[o]||l.call(this)})},function(t,e,i){var n=i(0),r=i(5),a=i(29),o=/"/g,s=function(t,e,i,n){var r=String(a(t)),s="<"+e;return""!==i&&(s+=" "+i+'="'+String(n).replace(o,"&quot;")+'"'),s+">"+r+"</"+e+">"};t.exports=function(t,e){var i={};i[t]=e(s),n(n.P+n.F*r(function(){var e=""[t]('"');return e!==e.toLowerCase()||e.split('"').length>3}),"String",i)}},function(t,e,i){var n=i(69),r=i(29);t.exports=function(t){return n(r(t))}},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function a(){return!!window&&(void 0!==window.document.webkitIsFullScreen?window.document.webkitIsFullScreen:void 0!==window.document.mozFullScreen?window.document.mozFullScreen:void 0!==window.document.msFullscreenElement&&window.document.msFullscreenElement)}function o(t){a()||(l.call(this),this.resizeInExitHandler?this.root.ui.resizeHandler():t())}function s(t){if(window){var e=window.document;this.exitFullscreenHandler=o.bind(this,t),e.addEventListener("webkitfullscreenchange",this.exitFullscreenHandler,!1),e.addEventListener("mozfullscreenchange",this.exitFullscreenHandler,!1),e.addEventListener("fullscreenchange",this.exitFullscreenHandler,!1),e.addEventListener("MSFullscreenChange",this.exitFullscreenHandler,!1)}}function l(){var t=window.document;t.removeEventListener("webkitfullscreenchange",this.exitFullscreenHandler),t.removeEventListener("mozfullscreenchange",this.exitFullscreenHandler),t.removeEventListener("fullscreenchange",this.exitFullscreenHandler),t.removeEventListener("MSFullscreenChange",this.exitFullscreenHandler)}function c(t){t.requestFullscreen?t.requestFullscreen():t.msRequestFullscreen?t.msRequestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen&&h()&&t.webkitRequestFullscreen()}function u(){document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&h()?document.webkitExitFullscreen():(l.call(this),this.resizeInExitHandler=!1)}function h(){return!(navigator.vendor&&navigator.vendor.indexOf("Apple")>-1&&navigator.userAgent&&!navigator.userAgent.match("CriOS"))}Object.defineProperty(e,"__esModule",{value:!0});var d=i(1),f=r(d),p=i(2),m=n(p),g=i(10),v=r(g),y="vzb-active",b="vzb-hidden",_="vzb-active-locked",x="vzb-unavailable",w="vzb-force-fullscreen",M="vzb-container-fullscreen",z=m.default.extend({init:function(t,e){var i=this;this.name=this.name||"gapminder-buttonlist",this.model_expects=[{name:"state",type:"model"},{name:"ui",type:"ui"},{name:"locale",type:"locale"}],this._available_buttons={find:{title:"buttons/find",icon:"search",required:!1},show:{title:"buttons/show",icon:"asterisk",required:!1},moreoptions:{title:"buttons/more_options",icon:"gear",required:!0},colors:{title:"buttons/colors",icon:"paintbrush",required:!1},size:{title:"buttons/size",icon:"circle",required:!1},fullscreen:{title:"buttons/expand",icon:"expand",func:this.toggleFullScreen.bind(this),required:!0},trails:{title:"buttons/trails",icon:"trails",func:this.toggleBubbleTrails.bind(this),required:!1,statebind:"ui.chart.trails",statebindfunc:this.setBubbleTrails.bind(this)},lock:{title:"buttons/lock",icon:"lock",func:this.toggleBubbleLock.bind(this),required:!1,statebind:"ui.chart.lockNonSelected",statebindfunc:this.setBubbleLock.bind(this)},inpercent:{title:"buttons/inpercent",icon:"percent",func:this.toggleInpercent.bind(this),required:!1,statebind:"ui.chart.inpercent",statebindfunc:this.setInpercent.bind(this)},presentation:{title:"buttons/presentation",icon:"presentation",func:this.togglePresentationMode.bind(this),required:!1,statebind:"ui.presentation",statebindfunc:this.setPresentationMode.bind(this)},about:{title:"buttons/about",icon:"about",required:!1},axes:{title:"buttons/axes",icon:"axes",required:!1},axesmc:{title:"buttons/axesmc",icon:"axes",required:!1},stack:{title:"buttons/stack",icon:"stack",required:!1},side:{title:"buttons/side",icon:"side",required:!1},_default:{title:"Button",icon:"asterisk",required:!1}},this._active_comp=!1,this.model_binds={"change:state.marker.select":function(t){i._readyOnce&&(i.setBubbleTrails(),i.setBubbleLock(),i._toggleButtons())},"change:ui.chart":function(t,e){e.indexOf("lockActive")>-1&&i.setBubbleLock()}},t.ui.buttons.forEach(function(t){var e=i._available_buttons[t];e&&e.statebind&&(i.model_binds["change:"+e.statebind]=function(i){e.statebindfunc(t,i.source.value)})}),this._super(t,e),this.validatePopupButtons(this.model.ui.buttons,this.model.ui.dialogs)},readyOnce:function(){var t=this;this.element=d3.select(this.placeholder),this.element.selectAll("div").remove(),this.root.findChildByName("gapminder-dialogs").on("close",function(e,i){t.setButtonActive(i.id,!1)});var e=(this.model.ui.dialogs||{}).sidebar||[],i=[].concat(this.model.ui.buttons);this.model.ui.buttons=i,this._addButtons(i,e),this._prev_body_overflow=document.body.style.overflow,this.setBubbleTrails(),this.setBubbleLock(),this.setInpercent(),this.setPresentationMode(),this._toggleButtons()},proceedClick:function(t){var e=this,i=e.element.selectAll(".vzb-buttonlist-btn[data-btn='"+t+"']"),n=i.attr("class"),r=e._available_buttons[t];if(r&&r.func)r.func(t);else{var a=n.indexOf(y)===-1;i.classed(y,a);var o={};o.id=t,o.active=a,e.trigger("click",o)}},validatePopupButtons:function(t,e){for(var i=this,n=e.popup,r=t.filter(function(t){return i._available_buttons[t]&&!i._available_buttons[t].func}),a=0,o=r.length;a<o;a++)if(n.indexOf(r[a])==-1)return f.error('Buttonlist: bad buttons config: "'+r[a]+'" is missing in popups list');return!1},_showAllButtons:function(){var t=this.element.selectAll(".vzb-buttonlist-btn");t.each(function(t,e){var i=d3.select(this);i.style("display","")})},_toggleButtons:function(){var t=this,e=this.parent.element.node?this.parent.element:d3.select(this.parent.element),i=(this.model.ui.dialogs||{}).sidebar||[];t._showAllButtons();var n=this.element.selectAll(".vzb-buttonlist-btn"),r=(this.element.node().getBoundingClientRect(),[]),a=[],o=80,s=80,l=this.element.node().getBoundingClientRect().width,c=this.element.node().getBoundingClientRect().height,u=0,h=0;n.each(function(e,n){var l=e,c=d3.select(this),d=i.indexOf(l.id)!==-1,f={top:parseInt(c.style("margin-top")),right:parseInt(c.style("margin-right")),left:parseInt(c.style("margin-left")),bottom:parseInt(c.style("margin-bottom"))};o=c.node().getBoundingClientRect().width+f.right+f.left,s=c.node().getBoundingClientRect().height+f.top+f.bottom,c.classed(b)||(d&&"large"===t.getLayoutProfile()?c.style("display","none"):(u+=o,h+=s,l.required?a.push(c):r.push(c)))});var d=u-l,f=h-c,p=1;e.classed("vzb-large")&&e.classed("vzb-dialog-expand-true")||e.classed("vzb-small")&&e.classed("vzb-portrait")?(d>0&&d<=10&&(l+=d),p=Math.floor(l/o)-a.length,p<0&&(p=0)):(f>0&&f<=10&&(c+=f),p=Math.floor(c/s)-a.length,p<0&&(p=0)),r.reverse();for(var m=[],g=0,v=r.length-p;g<v;g++)r[g].style("display","none"),m.push(r[g].attr("data-btn"));var y={};y.hiddenButtons=m,t.trigger("toggle",y)},_addButtons:function(t,e){var i=this;this._components_config=[];var n=[];if(t.length){for(var r=0;r<t.length;r++){var a=t[r],o=this._available_buttons[a],s=o?a:"_default",l=f.clone(this._available_buttons[s]);"_default"==s&&(l.title="buttons/"+a),l.id=a,l.icon=v[l.icon],n.push(l)}var c=this.getTranslationFunction(!0);this.element.selectAll("button").data(n).enter().append("button").attr("class",function(t){var i="vzb-buttonlist-btn";return e.length>0&&e.indexOf(t.id)>-1&&(i+=" vzb-dialog-side-btn"),i}).attr("data-btn",function(t){return t.id}).html(function(t){return"<span class='vzb-buttonlist-btn-icon fa'>"+t.icon+"</span><span class='vzb-buttonlist-btn-title'>"+c(t.title)+"</span>";
});var u=this.element.selectAll(".vzb-buttonlist-btn");u.on("click",function(){d3.event.preventDefault(),d3.event.stopPropagation();var t=d3.select(this).attr("data-btn");i.proceedClick(t)})}},scrollToEnd:function(){var t=0,e=d3.select(".vzb-tool");e.classed("vzb-portrait")&&e.classed("vzb-small")?(this.model.state.marker.select.length>0&&(t=this.element.node().scrollWidth),this.element.node().scrollLeft=t):(this.model.state.marker.select.length>0&&(t=this.element.node().scrollHeight),this.element.node().scrollTop=t)},resize:function(){"small"===this.getLayoutProfile()&&this.model.ui.presentation&&this.togglePresentationMode(),this._toggleButtons()},setButtonActive:function(t,e){var i=this.element.selectAll(".vzb-buttonlist-btn[data-btn='"+t+"']");i.classed(y,e)},toggleBubbleTrails:function(){this.model.ui.chart.trails=!this.model.ui.chart.trails,this.setBubbleTrails()},setBubbleTrails:function(){var t=(this.model.ui.chart||{}).trails;if(t||t===!1){var e="trails",i=this.element.selectAll(".vzb-buttonlist-btn[data-btn='"+e+"']");if(!i.node())return f.warn("setBubbleTrails: no button '"+e+"' found in DOM. doing nothing");i.classed(_,t),i.classed(b,0==this.model.state.marker.select.length)}},toggleBubbleLock:function(t){var e=(this.model.ui.chart||{}).lockActive;if(0!=this.model.state.marker.select.length||e){var i=this.model.ui.chart.lockNonSelected,n=this.model.state.time;i=i?0:n.formatDate(n.value),this.model.ui.chart.lockNonSelected=i,this.setBubbleLock()}},setBubbleLock:function(){var t=(this.model.ui.chart||{}).lockNonSelected,e=(this.model.ui.chart||{}).lockActive;if(t||0===t){0===t||0!==this.model.state.marker.select.length||e||(t=this.model.ui.chart.lockNonSelected=0);var i="lock",n=this.element.selectAll(".vzb-buttonlist-btn[data-btn='"+i+"']");if(!n.node())return f.warn("setBubbleLock: no button '"+i+"' found in DOM. doing nothing");var r=this.model.locale.getTFunction();n.classed(x,0==this.model.state.marker.select.length&&!e),"undefined"==typeof e?n.classed(b,0==this.model.state.marker.select.length):n.classed(b,!e),n.classed(_,t),n.select(".vzb-buttonlist-btn-title").text(t?t:r("buttons/lock")),n.select(".vzb-buttonlist-btn-icon").html(v[t?"lock":"unlock"])}},toggleInpercent:function(){this.model.ui.chart.inpercent=!this.model.ui.chart.inpercent,this.setInpercent()},setInpercent:function(){if("undefined"!=typeof(this.model.ui.chart||{}).inpercent){var t="inpercent",e=(this.model.locale.getTFunction(),this.element.selectAll(".vzb-buttonlist-btn[data-btn='"+t+"']"));e.classed(_,this.model.ui.chart.inpercent)}},togglePresentationMode:function(){this.model.ui.presentation=!this.model.ui.presentation,this.setPresentationMode()},setPresentationMode:function(){var t="presentation",e=(this.model.locale.getTFunction(),this.element.selectAll(".vzb-buttonlist-btn[data-btn='"+t+"']"));e.classed(_,this.model.ui.presentation)},toggleFullScreen:function(t,e){if(window){for(var i=this,n=i.placeholder,r=!1,a=this.element.selectAll(".vzb-buttonlist-btn[data-btn='"+t+"']"),o=!this.model.ui.fullscreen,l=o?"hidden":this._prev_body_overflow;!(r=f.hasClass(n,"vzb-placeholder"));)i=i.parent,n=i.placeholder;o?(this.resizeInExitHandler=!1,c(n),s.call(this,this.toggleFullScreen.bind(this,t,!0))):(this.resizeInExitHandler=!e,u.call(this)),f.classed(n,w,o),"undefined"!=typeof container&&f.classed(container,M,o),this.model.ui.fullscreen=o;var h=this.model.locale.getTFunction();a.classed(_,o),a.select(".vzb-buttonlist-btn-icon").html(v[o?"unexpand":"expand"]),a.select(".vzb-buttonlist-btn-title>span").text(h("buttons/"+(o?"unexpand":"expand"))).attr("data-vzb-translate","buttons/"+(o?"unexpand":"expand")),document.body.style.overflow=l,this.resizeInExitHandler||this.root.ui.resizeHandler()}}});e.default=z},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var a=i(71),o=r(a),s=i(1),l=n(s),c=i(2),u=r(c),h=i(10),d=(n(h),(0,o.default)(i(475),1)),f="vzb-active",p=u.default.extend({init:function(t,e){this.name="gapminder-dialogs",this._curr_dialog_index=20,this.model_expects=[{name:"state",type:"model"},{name:"ui",type:"ui"},{name:"locale",type:"locale"}],this._available_dialogs={timedisplay:{dialog:d.timedisplay},find:{dialog:d.find},show:{dialog:d.show},moreoptions:{dialog:d.moreoptions},colors:{dialog:d.colors},size:{dialog:d.size},side:{dialog:d.side},label:{dialog:d.label},zoom:{dialog:d.zoom},axes:{dialog:d.axes},axesmc:{dialog:d.axesmc},stack:{dialog:d.stack},speed:{dialog:d.speed},opacity:{dialog:d.opacity},presentation:{dialog:d.presentation},about:{dialog:d.about},mapoptions:{dialog:d.mapoptions}},this._super(t,e)},domReady:function(){var t=(this.model.ui.dialogs||{}).popup||[],e=(this.model.ui.dialogs||{}).sidebar||[];this.rootEl=this.root.element instanceof Array?this.root.element:d3.select(this.root.element),e===!0&&(e=t,(this.model.ui.dialogs||{}).sidebar=e),0!==e.length&&this.rootEl.classed("vzb-dialog-expand-true",!0),this.dialog_popup=t,this.dialog_sidebar=e},readyOnce:function(){var t=this;if(this.element=d3.select(this.placeholder),this.element.selectAll("div").remove(),this._addDialogs(this.dialog_popup,this.dialog_sidebar),this.resize(),0!==this.dialog_popup.length){this.root.findChildByName("gapminder-buttonlist").on("click",function(e,i){t._available_dialogs[i.id]&&(i.active?t.openDialog(i.id):t.closeDialog(i.id))});var e=this.element.selectAll(".vzb-top-dialog").filter(function(e){return t.dialog_popup.indexOf(e.id)>-1}),i=e.select(".vzb-top-dialog>.vzb-dialog-modal>.vzb-dialog-buttons>[data-click='closeDialog']");i.on("click",function(e,i){t.closeDialog(e.id)});var n=e.select(".vzb-top-dialog>.vzb-dialog-modal>[data-click='pinDialog']");n.on("click",function(e,i){t.pinDialog(e.id)}),this.rootEl.node().addEventListener("click",function(){t.closeAllDialogs()}),this.rootEl.on("mousedown",function(e){if(this._active_comp){for(var i=d3.event.target,n=!0;i;){if(i.classList.contains("vzb-dialog-modal")){n=!1;break}i=i.parentElement}n&&t.closeAllDialogs()}})}this.element.on("click",function(){d3.event.stopPropagation()})},resize:function(){var t=this,e=this.getLayoutProfile();this.element.selectAll(".vzb-top-dialog").each(function(i){var n=d3.select(this),r=n.attr("class").replace(" vzb-popup","").replace(" vzb-sidebar","");"large"===e&&t.dialog_sidebar.indexOf(i.id)>-1?r+=" vzb-sidebar":t.dialog_popup.indexOf(i.id)>-1&&(r+=" vzb-popup"),n.attr("class",r)})},_addDialogs:function(t,e){var i=(this.getLayoutProfile(),[]);i=t?i.concat(t):i,i=e?i.concat(e):i,i=l.unique(i),this._components_config=[];var n=[];if(i.length){for(var r=0;r<i.length;r++){var a=i[r],o=this._available_dialogs[a];if(o&&o.dialog){var s=this._components_config;s.push({component:o.dialog,placeholder:'.vzb-dialogs-dialog[data-dlg="'+a+'"]',model:["state","ui","locale"]}),o.component=s.length-1}o.id=a,n.push(o)}this.element.selectAll("div").data(n).enter().append("div").attr("data-dlg",function(t){return t.id}).attr("class","vzb-top-dialog vzb-dialogs-dialog vzb-dialog-shadow"),this.loadSubComponents();var c=this;l.forEach(this.components,function(t){t.render(),c.on("resize",function(){t.trigger("resize")}),t.on("dragstart",function(){c.bringForward(t.name)}),t.on("close",function(){this.placeholderEl.each(function(t){var e={};e.id=t.id,c.trigger("close",e)})})})}},bringForward:function(t){var e=this.element.select(".vzb-popup.vzb-dialogs-dialog[data-dlg='"+t+"']");e.style("z-index",this._curr_dialog_index),this._curr_dialog_index+=10},openDialog:function(t){var e="small"===this.getLayoutProfile();this.closeAllDialogs(e);var i=this.element.selectAll(".vzb-popup.vzb-dialogs-dialog[data-dlg='"+t+"']");this._active_comp=this.components[this._available_dialogs[t].component],this._active_comp.beforeOpen(),i.classed(f,!0),this.bringForward(t),this._active_comp.open()},pinDialog:function(t){var e=this.element.select(".vzb-popup.vzb-dialogs-dialog[data-dlg='"+t+"']");this._available_dialogs[t].ispin?(e.classed("pinned",!1),this._available_dialogs[t].ispin=!1):(e.classed("pinned",!0),this._available_dialogs[t].ispin=!0)},closeDialog:function(t){var e=this.element.selectAll(".vzb-popup.vzb-dialogs-dialog[data-dlg='"+t+"']");this._active_comp=this.components[this._available_dialogs[t].component],this._active_comp&&!this._active_comp.isOpen||(this._available_dialogs[t].ispin&&this.pinDialog(t),this._active_comp&&this._active_comp.beforeClose(),e.classed(f,!1),this._active_comp&&this._active_comp.close(),this._active_comp=!1)},closeAllDialogs:function(t){var e=this,i=t?".vzb-popup.vzb-dialogs-dialog.vzb-active":".vzb-popup.vzb-dialogs-dialog.vzb-active:not(.pinned)",n=this.element.selectAll(i);n.each(function(t){e.closeDialog(t.id)})}});e.default=p},function(t,e,i){var n=i(70),r=i(44),a=i(21),o=i(33),s=i(14),l=i(161),c=Object.getOwnPropertyDescriptor;e.f=i(8)?c:function(t,e){if(t=a(t),e=o(e,!0),l)try{return c(t,e)}catch(t){}if(s(t,e))return r(!n.f.call(t,e),t[e])}},function(t,e,i){var n=i(14),r=i(13),a=i(106)("IE_PROTO"),o=Object.prototype;t.exports=Object.getPrototypeOf||function(t){return t=r(t),n(t,a)?t[a]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?o:null}},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var a=i(1),o=r(a),s=i(2),l=n(s),c=1,u="vzb-playing",h="vzb-ts-loading",d="vzb-ts-hide-play-button",f="vzb-ts-dragging",p="vzb-ts-axis-aligned",m="vzb-ts-show-value",g="vzb-ts-show-value-when-drag-play",v={small:{margin:{top:7,right:15,bottom:10,left:15},radius:8,label_spacing:10},medium:{margin:{top:16,right:15,bottom:10,left:15},radius:9,label_spacing:12},large:{margin:{top:14,right:15,bottom:10,left:15},radius:11,label_spacing:14}},y={medium:{margin:{top:9}},large:{margin:{}}},b=l.default.extend({init:function(t,e){this.name="gapminder-timeslider",this.template=this.template||i(456),this.prevPosition=null,this.model_expects=[{name:"time",type:"time"},{name:"entities",type:"entities"},{name:"marker",type:"model"},{name:"ui",type:"ui"}];var n=this;this.model_binds={"change:time":function(t,e){if(n.slide){if(["time.start","time.end"].indexOf(e)!==-1){if(!n.xScale)return;n.changeLimits()}n._optionClasses(),n.model.time.dragging||n._setHandle(n.model.time.playing)}},"change:time.start":function(t,e){n.slide&&(n.model.time.dragging||n._setHandle(n.model.time.playing))},"change:time.end":function(t,e){n.slide&&(n.model.time.dragging||n._setHandle(n.model.time.playing))},"change:time.startSelected":function(t,e){n.slide&&n.updateSelectedStartLimiter()},"change:time.endSelected":function(t,e){n.slide&&n.updateSelectedEndLimiter()},"change:marker.select":function(t,e){n.setSelectedLimits()}},this._super(t,e),this.ui=o.extend({show_limits:!1,show_value:!1,show_value_when_drag_play:!0,show_button:!0,class_axis_aligned:!1},t.ui,this.ui),this.width=0,this.height=0,this.availableTimeFrames=[],this.completedTimeFrames=[],this.getValueWidth=o.memoize(this.getValueWidth),this._setTime=o.throttle(this._setTime,50)},readyOnce:function(){var t=this;this.element=o.isArray(this.element)?this.element:d3.select(this.element),this.slider_outer=this.element.select(".vzb-ts-slider"),this.slider=this.slider_outer.select("g"),this.axis=this.element.select(".vzb-ts-slider-axis"),this.select=this.element.select(".vzb-ts-slider-select"),this.progressBar=this.element.select(".vzb-ts-slider-progress"),this.slide=this.element.select(".vzb-ts-slider-slide"),this.handle=this.element.select(".vzb-ts-slider-handle"),this.valueText=this.element.select(".vzb-ts-slider-value"),this.xScale=d3.time.scale.utc().clamp(!0),this.xAxis=d3.axisBottom().tickSize(0),this.valueText.attr("text-anchor","middle").attr("dy","-0.7em");var e=t._getBrushed(),i=t._getBrushedEnd();this.brush=d3.drag().on("start drag",function(){e.call(this)}).on("end",function(){i.call(this)}),this.slide.call(this.brush),this.slider_outer.on("mousewheel",function(){if(t.model.time.dragging)return d3.event.stopPropagation(),d3.event.preventDefault(),d3.event.returnValue=!1,!1}),this._setSelectedLimitsId=0,this.model.time.startSelected>this.model.time.start&&t.updateSelectedStartLimiter(),this.model.time.endSelected<this.model.time.end&&t.updateSelectedEndLimiter(),this.parent.on("myEvent",function(e,i){var n=t.getLayoutProfile();i.profile&&i.profile.margin&&(v[n].margin=i.profile.margin),t.element.select(".vzb-ts-slider-wrapper").style("right",i.mRight-v[n].margin.right+"px"),t.updateSize([0,i.rangeMax])}),this.on("resize",function(){t.updateSize()})},ready:function(){if(!this.model.time.splash){this.element.classed(h,!1);var t=this.element.select(".vzb-ts-btn-play"),e=this.element.select(".vzb-ts-btn-pause"),i=this;this.model.time;t.on("click",function(){i.model.time.play()}),e.on("click",function(){i.model.time.pause("soft")}),this.changeLimits(),this.changeTime(),this.updateSize(),i._updateProgressBar(),i.model.marker.listenFramesQueue(null,function(t){i._updateProgressBar(t)}),i.setSelectedLimits(!0)}},changeLimits:function(){var t=this.model.time.start,e=this.model.time.end;this.xScale.domain([t,e]),this.xAxis.tickValues([t,e]).tickFormat(this.model.time.getFormatter())},changeTime:function(){this.model.time.value;this._optionClasses()},updateSize:function(t){if(!this.model.time.splash){this.model.time.pause(),this.profile=this.getActiveProfile(v,y);var e=parseInt(this.slider_outer.style("width"),10)||0,i=parseInt(this.slider_outer.style("height"),10)||0;if(!i||!e)return o.warn("time slider resize() aborted because element is too small or has display:none");this.width=e-this.profile.margin.left-this.profile.margin.right,this.height=i-this.profile.margin.bottom-this.profile.margin.top;var n=this;this.slider.attr("transform","translate("+this.profile.margin.left+","+this.profile.margin.top+")"),this.xScale.range(t||[0,this.width]),this.slide.attr("transform","translate(0,"+this.height/2+")").attr("x1",this.xScale.range()[0]).attr("x2",this.xScale.range()[1]).style("stroke-width",2*this.profile.radius+"px"),this.xAxis=this.xAxis.scale(this.xScale).tickPadding(this.profile.label_spacing),this.axis.attr("transform","translate(0,"+this.height/2+")").call(this.xAxis),this.select.attr("transform","translate(0,"+this.height/2+")"),this.progressBar.attr("transform","translate(0,"+this.height/2+")"),this.slide.select(".background").attr("height",this.height),this.handle.attr("transform","translate(0,"+this.height/2+")").attr("r",this.profile.radius),this.sliderWidth=n.slider.node().getBoundingClientRect().width,this.resizeSelectedLimiters(),this._resizeProgressBar(),this._setHandle()}},setSelectedLimits:function(t){var e=this;this._setSelectedLimitsId++;var i=this._setSelectedLimitsId,n=e.model.marker.select;if(0==n.length)return void e.model.time.set({startSelected:new Date(e.model.time.start),endSelected:new Date(e.model.time.end)},null,!1);var r=e.model.entities.getDimension(),a=[];o.forEach(n,function(t){a.push(e.model.marker.getEntityLimits(t[r]))}),Promise.all(a).then(function(n){if(i==e._setSelectedLimitsId){var r=n.shift(),a=r.min,s=r.max;o.forEach(n,function(t){a-t.min>0&&(a=t.min),s-t.max<0&&(s=t.max)}),e.model.time.set({startSelected:d3.max([a,new Date(e.model.time.start)]),endSelected:d3.min([s,new Date(e.model.time.end)])},t,!1)}})},updateSelectedStartLimiter:function(){var t=this;this.select.select("#clip-start-"+t._id).remove(),this.select.select(".selected-start").remove(),this.model.time.startSelected&&this.model.time.startSelected>this.model.time.start&&(this.select.append("clipPath").attr("id","clip-start-"+t._id).append("rect"),this.select.append("path").attr("clip-path","url("+location.pathname+"#clip-start-"+t._id+")").classed("selected-start",!0),this.resizeSelectedLimiters())},updateSelectedEndLimiter:function(){var t=this;this.select.select("#clip-end-"+t._id).remove(),this.select.select(".selected-end").remove(),this.model.time.endSelected&&this.model.time.endSelected<this.model.time.end&&(this.select.append("clipPath").attr("id","clip-end-"+t._id).append("rect"),this.select.append("path").attr("clip-path","url("+location.pathname+"#clip-end-"+t._id+")").classed("selected-end",!0),this.resizeSelectedLimiters())},resizeSelectedLimiters:function(){var t=this;this.select.select(".selected-start").attr("d","M0,0H"+this.xScale(this.model.time.startSelected)),this.select.select("#clip-start-"+t._id).select("rect").attr("x",-this.height/2).attr("y",-this.height/2).attr("height",this.height).attr("width",this.xScale(this.model.time.startSelected)+this.height/2),this.select.select(".selected-end").attr("d","M"+this.xScale(this.model.time.endSelected)+",0H"+this.xScale(this.model.time.end)),this.select.select("#clip-end-"+t._id).select("rect").attr("x",this.xScale(this.model.time.endSelected)).attr("y",-this.height/2).attr("height",this.height).attr("width",this.xScale(this.model.time.end)-this.xScale(this.model.time.endSelected)+this.height/2)},_resizeProgressBar:function(){var t=this;this.progressBar.selectAll("path").each(function(e){d3.select(this).attr("d","M"+t.xScale(e[0])+",0H"+t.xScale(e[1]))})},_updateProgressBar:function(t){var e=this;if(t){if(e.completedTimeFrames.indexOf(t)!=-1)return;e.completedTimeFrames.push(t);var i=e.model.time.incrementTime(t),n=e.model.time.decrementTime(t);if(i>e.model.time.end){if(t-e.model.time.end!=0)return;i=t,t=n}if(0==e.availableTimeFrames.length||e.availableTimeFrames[e.availableTimeFrames.length-1][1]<t)e.availableTimeFrames.push([t,i]);else if(i<e.availableTimeFrames[0][0])e.availableTimeFrames.unshift([t,i]);else for(var r=0;r<e.availableTimeFrames.length;r++){if(t-e.availableTimeFrames[r][1]==0){r+1<e.availableTimeFrames.length&&i-e.availableTimeFrames[r+1][0]==0?(e.availableTimeFrames[r][1]=e.availableTimeFrames[r+1][1],e.availableTimeFrames.splice(r+1,1)):e.availableTimeFrames[r][1]=i;break}if(i-e.availableTimeFrames[r][0]==0){e.availableTimeFrames[r][0]=t;break}if(t-e.availableTimeFrames[r][1]>0&&i-e.availableTimeFrames[r+1][0]<0){e.availableTimeFrames.splice(r+1,0,[t,i]);break}}}else e.availableTimeFrames=[],e.completedTimeFrames=[];var a=this.progressBar.selectAll("path").data(e.availableTimeFrames);a.exit().remove(),a.enter().append("path").attr("class","domain").merge(a).each(function(t){var i=d3.select(this);i.attr("d","M"+e.xScale(t[0])+",0H"+e.xScale(t[1])).classed("rounded",1==e.availableTimeFrames.length)})},getValueWidth:function(t,e){return this.valueText.node().getBoundingClientRect().width},_getBrushed:function(){var t=this;return function(){t.model.time.playing&&t.model.time.pause(),t._optionClasses(),t.element.classed(f,!0);var e=void 0;if(d3.event.sourceEvent){d3.event.sourceEvent.preventDefault(),t.model.time.dragStart();var i=o.roundStep(Math.round(d3.mouse(this)[0]),c);e=t.xScale.invert(i);var n=t.width;i>n?i=n:i<0&&(i=0),t.handle.attr("cx",i),t.valueText.attr("transform","translate("+i+","+t.height/2+")"),t.valueText.text(t.model.time.formatDate(e,"ui"))}e-t.model.time.value!==0&&t._setTime(e)}},_getBrushedEnd:function(){var t=this;return function(){t._setTime.recallLast(),t.element.classed(f,!1),t.model.time.dragStop(),t.model.time.snap()}},_setHandle:function(t){var e=this,i=this.model.time.value,n=this.xScale(i);this.element.classed("vzb-ts-disabled",this.model.time.end<=this.model.time.start),null==e.prevPosition&&(e.prevPosition=n);var r=n>e.prevPosition?this.model.time.delayAnimations:0;t?(this.handle.attr("cx",e.prevPosition).transition().duration(r).ease(d3.easeLinear).attr("cx",n),this.valueText.attr("transform","translate("+e.prevPosition+","+this.height/2+")").transition("text").delay(r).text(this.model.time.formatDate(i,"ui")),this.valueText.transition().duration(r).ease(d3.easeLinear).attr("transform","translate("+n+","+this.height/2+")")):(this.handle.interrupt().attr("cx",n),this.valueText.interrupt().interrupt("text").transition("text"),this.valueText.attr("transform","translate("+n+","+this.height/2+")").text(this.model.time.formatDate(i,"ui"))),e.prevPosition=n},_setTime:function(t){var e=this,i=!this.model.time.dragging&&!this.model.time.playing;e.model.time.getModelObject("value").set(t,!1,i)},_optionClasses:function(){var t=this.ui.show_limits,e=this.ui.show_value,i=this.ui.show_value_when_drag_play,n=this.ui.axis_aligned,r=this.ui.show_button&&this.model.time.playable;t||this.xAxis.tickValues([]).ticks(0),this.element.classed(d,!r),this.element.classed(u,this.model.time.playing),this.element.classed(m,e),this.element.classed(g,i),this.element.classed(p,n)}});e.default=b},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o=i(1),s=r(o),l=i(2),c=n(l),u=i(16),h=n(u),d=i(10),f=1,p=2,m={wrapper:"vzb-treemenu-wrap",wrapper_outer:"vzb-treemenu-wrap-outer",background:"vzb-treemenu-background",close:"vzb-treemenu-close",search:"vzb-treemenu-search",list:"vzb-treemenu-list",list_outer:"vzb-treemenu-list-outer",list_item:"vzb-treemenu-list-item",list_item_leaf:"vzb-treemenu-list-item-leaf",leaf:"vzb-treemenu-leaf",leaf_content:"vzb-treemenu-leaf-content",leaf_content_item:"vzb-treemenu-leaf-content-item",leaf_content_item_title:"vzb-treemenu-leaf-content-item-title",leaf_content_item_descr:"vzb-treemenu-leaf-content-item-descr",hasChild:"vzb-treemenu-list-item-children",list_item_label:"vzb-treemenu-list-item-label",list_top_level:"vzb-treemenu-list-top",search_wrap:"vzb-treemenu-search-wrap",isSpecial:"vzb-treemenu-list-item-special",hidden:"vzb-hidden",title:"vzb-treemenu-title",scaletypes:"vzb-treemenu-scaletypes",scaletypesDisabled:"vzb-treemenu-scaletypes-disabled",scaletypesActive:"vzb-treemenu-scaletypes-active",alignYt:"vzb-align-y-top",alignYb:"vzb-align-y-bottom",alignXl:"vzb-align-x-left",alignXr:"vzb-align-x-right",alignXc:"vzb-align-x-center",menuHorizontal:"vzb-treemenu-horizontal",menuVertical:"vzb-treemenu-vertical",absPosVert:"vzb-treemenu-abs-pos-vert",absPosHoriz:"vzb-treemenu-abs-pos-horiz",menuOpenLeftSide:"vzb-treemenu-open-left-side",noTransition:"notransition"},g={MOUSE_LOCS:[],MOUSE_LOCS_TRACKED:3,DELAY:200,TOLERANCE:150,LAST_DELAY_LOC:null,TIMEOUT:null,SEARCH_PROPERTY:"id",SUBMENUS:"children",SEARCH_MIN_STR:1,RESIZE_TIMEOUT:null,MOBILE_BREAKPOINT:400,CURRENT_PATH:[],MIN_COL_WIDTH:60,MENU_DIRECTION:f,MAX_MENU_WIDTH:320,MENU_OPEN_LEFTSIDE:!1},v=h.default.extend({init:function(t,e,i){var n=this;this.parent=t,this.entity=e,this.OPTIONS=i,this.width=this.OPTIONS.MIN_COL_WIDTH,this.direction=this.OPTIONS.MENU_DIRECTION,this._setDirectionClass(),this.menuItems=[];var r=void 0;return this.entity.empty()?this:(this.entity.each(function(){r=d3.selectAll(this.childNodes).filter(function(){return d3.select(this).classed(m.list)})}),r.empty()&&(r=this.entity),e.selectAll("."+m.list_item).filter(function(){return this.parentNode==r.node()}).each(function(){n.addSubmenu(d3.select(this))}),this)},setWidth:function(t,e,i){if(this.width!=t&&this.entity.node()){if(this.width=t,(this.entity.classed(m.list_top_level)||this.entity.classed("active"))&&this.direction==f&&(i?this.entity.style("width",this.width+"px"):this.entity.transition().delay(0).duration(100).style("width",this.width+"px")),this.entity.classed(m.list_top_level)&&this.entity.selectAll("."+m.leaf).style("width",this.width-1+"px"),e)for(var n=0;n<this.menuItems.length;n++)this.menuItems[n].setWidth(this.width,e,i);return this}},setDirection:function(t,e){if(this.direction=t,this.entity.style("width","").style("height",""),e)for(var i=0;i<this.menuItems.length;i++)this.menuItems[i].setDirection(this.direction,e);return this._setDirectionClass(),this},_setDirectionClass:function(){this.direction==f?(this.entity.classed(m.menuVertical,!1),this.entity.classed(m.menuHorizontal,!0)):(this.entity.classed(m.menuHorizontal,!1),this.entity.classed(m.menuVertical,!0))},addSubmenu:function(t){this.menuItems.push(new y(this,t,this.OPTIONS))},open:function(){var t=this;return this.isActive()||(t.parent.parentMenu.openSubmenuNow=!0,this.closeNeighbors(function(){t.direction==f?(t._openHorizontal(),t.calculateMissingWidth(0)):t._openVertical()}),t.parent.parentMenu.openSubmenuNow=!1),this},calculateMissingWidth:function(t,e){var i=this;this.entity.classed(m.list_top_level)?t>this.OPTIONS.MAX_MENU_WIDTH&&"function"==typeof e&&e(t-this.OPTIONS.MAX_MENU_WIDTH):this.parent.parentMenu.calculateMissingWidth(t+this.width,function(t){t>0?i.reduceWidth(t,function(t){"function"==typeof e&&e(t)}):"function"==typeof e&&e(t)})},restoreWidth:function(t,e,i){var n=this;if(e)this.parent.parentMenu.restoreWidth(t,!1,i);else if(t<=0)"function"==typeof i&&i();else if(this.entity.classed(m.list_top_level))"function"==typeof i&&i();else{var r=this.entity.node().offsetWidth,a=Math.min(t,n.width);if(r<a){var o=250*(r/a);this.entity.transition().delay(0).duration(o).style("width",a+"px").on("end",function(){}),n.parent.parentMenu.restoreWidth(t-a,!1,i)}else this.parent.parentMenu.restoreWidth(t,!1,i)}},reduceWidth:function(t,e){var i=this,n=this,r=this.entity.node().offsetWidth;r<=this.OPTIONS.MIN_COL_WIDTH?e(t-n.width+r):!function(){var r=Math.max(i.OPTIONS.MIN_COL_WIDTH,n.width-t),a=250/(n.width/r);i.entity.transition().delay(0).duration(a).style("width",r+"px").on("end",function(){e(t-n.width+r)})}()},_openHorizontal:function(){var t=this;t.entity.classed("active",!0).transition().delay(0).duration(250).style("width",t.width+"px").on("end",function(){t.marqueeToggle(!0)})},_openVertical:function(){var t=this;t.entity.style("height","0px"),t.entity.transition().delay(0).duration(250).style("height",36*t.menuItems.length+"px").on("end",function(){t.entity.style("height","auto"),t.marqueeToggle(!0),t.scrollToFitView()}),t.entity.classed("active",!0)},closeAllChildren:function(t){for(var e=0,i=0;i<this.menuItems.length;i++)this.menuItems[i].isActive()&&(++e,this.menuItems[i].submenu.close(function(){0==--e&&"function"==typeof t&&t()}));0==e&&"function"==typeof t&&t()},closeNeighbors:function(t){this.parent?this.parent.closeNeighbors(t):t()},close:function(t){var e=this;this.closeAllChildren(function(){e.direction==f?e._closeHorizontal(t):e._closeVertical(t)})},_closeHorizontal:function(t){var e=(this.entity.node().offsetWidth,this),i=e.parent.parentMenu.openSubmenuNow;e.entity.transition().delay(0).duration(20).style("width","0px").on("end",function(){e.marqueeToggle(!1),e.entity.classed("active",!1),i?"function"==typeof t&&t():e.restoreWidth(e.OPTIONS.MAX_MENU_WIDTH,!0,function(){"function"==typeof t&&t()})})},_closeVertical:function(t){var e=this;e.entity.transition().delay(0).duration(100).style("height","0px").on("end",function(){e.marqueeToggle(!1),e.entity.classed("active",!1),"function"==typeof t&&t()})},isActive:function(){return this.entity.classed("active")},hasActiveParentNeighbour:function(){return this.menuItems.filter(function(t){return t.isActive()}).some(function(t){return!!d3.select(t.entity).node().classed(m.hasChild)})},marqueeToggle:function(t){for(var e=0;e<this.menuItems.length;e++)this.menuItems[e].marqueeToggle(t)},marqueeToggleAll:function(t){for(var e=0;e<this.menuItems.length;e++)this.menuItems[e].marqueeToggleAll(t)},findItemById:function(t){for(var e=0;e<this.menuItems.length;e++){if(this.menuItems[e].entity.data().id==t)return this.menuItems[e];if(this.menuItems[e].submenu){var i=this.menuItems[e].submenu.findItemById(t);if(i)return i}}return null},getTopMenu:function(){return this.parent?this.parent.parentMenu.getTopMenu():this},scrollToFitView:function(){var t=this.getTopMenu().entity.node().parentNode,e=this.entity.node().parentNode,i=t.getBoundingClientRect(),n=e.getBoundingClientRect(),r=n.top-i.top;if(r+n.height>i.height){var a=n.height>i.height?i.height-10:n.height+10,o=t.scrollTop+a-i.height+r,s=function(t){return function(){var e=d3.interpolateNumber(this.scrollTop,t);return function(t){this.scrollTop=e(t)}}};d3.select(t).transition().duration(20).tween("scrolltoptween",s(o))}}}),y=h.default.extend({init:function(t,e,i){var n=this;this.parentMenu=t,this.entity=e;var r=e.select("."+m.list_outer);return r.node()&&(this.submenu=new v(this,r,i)),this.entity.select("."+m.list_item_label).on("mouseenter",function(){s.isTouchDevice()||(n.parentMenu.direction!=f||d3.select(this).attr("children")?n.parentMenu.hasActiveParentNeighbour()||n.closeNeighbors():(n.openSubmenu(),n.marqueeToggle(!0)))}).on("click.item",function(){if(!s.isTouchDevice())if(d3.event.stopPropagation(),n.parentMenu.direction==f)n.openSubmenu();else{var t=d3.select(this);if(!t.attr("children"))return;n.toggleSubmenu()}}).onTap(function(t){if(d3.event.stopPropagation(),n.parentMenu.direction==p){var e=n.entity.select("."+m.list_item_label);if(!e.attr("children"))return}n.toggleSubmenu()}),this},setWidth:function(t,e,i){return this.submenu&&e&&this.submenu.setWidth(t,e,i),this},setDirection:function(t,e){return this.submenu&&e&&this.submenu.setDirection(t,e),this},toggleSubmenu:function(){this.submenu&&(this.submenu.isActive()?this.submenu.close():this.submenu.open())},openSubmenu:function(){this.submenu?this.submenu.open():this.closeNeighbors()},closeNeighbors:function(t){this.parentMenu.closeAllChildren(t)},isActive:function(){return this.submenu&&this.submenu.isActive()},marqueeToggleAll:function(t){var e=this.entity.selectAll("."+m.list_item_label);e.each(function(){var e=d3.select(this).select("span"),i=d3.select(this.parentNode);if(i.classed("marquee",!1),e.style("left",""),e.style("right",""),t&&e.node().scrollWidth>e.node().offsetWidth){e.attr("data-content",e.text());var n=30;e.style("left",-n-e.node().scrollWidth+"px"),e.style("right",-n-e.node().scrollWidth+"px"),i.classed("marquee",!0)}})},marqueeToggle:function(t){var e=this.entity.select("."+m.list_item_label).select("span");if(this.entity.classed("marquee",!1),e.style("left",""),e.style("right",""),t&&e.node().scrollWidth>e.node().offsetWidth){e.attr("data-content",e.text());var i=30;e.style("left",-i-e.node().scrollWidth+"px"),e.style("right",-i-e.node().scrollWidth+"px"),this.entity.classed("marquee",!0)}}}),b=c.default.extend({tree:function(t){return arguments.length?(this._tree=t,this):this._tree},callback:function(t){return arguments.length?(this._callback=t,this):this._callback},markerID:function(t){return arguments.length?(this._markerID=t,this):this._markerID},alignX:function(t){return arguments.length?(this._alignX=t,this):this._alignX},alignY:function(t){return arguments.length?(this._alignY=t,this):this._alignY},top:function(t){return arguments.length?(this._top=t,this):this._top},left:function(t){return arguments.length?(this._left=t,this):this._left},init:function(t,e){var i=this;this.name="gapminder-treemenu",this.model_expects=[{name:"marker",type:"model"},{name:"marker_tags",type:"model"},{name:"time",type:"time"},{name:"locale",type:"locale"}],this.context=e,this.menuEntity=null,this.model_binds={"change:marker":function(t,e){e.indexOf(i._markerID+".which")==-1&&e.indexOf(i._markerID+".scaleType")==-1||i.updateView()}},this._super(t,e),this._callback=function(t){console.log("Indicator selector: stub callback fired. New indicator is ",t)},this._alignX="center",this._alignY="center",this.OPTIONS=s.deepClone(g)},ready:function(){this.updateView();var t=this.model.marker_tags.label.getData();this._buildIndicatorsTree(t)},readyOnce:function(){this.element=d3.select(this.placeholder);
var t=this;this.element.selectAll("div").remove(),this.element.append("div").attr("class",m.background).on("click",function(){d3.event.stopPropagation(),t.toggle()}),this.wrapperOuter=this.element.append("div").classed(m.wrapper_outer,!0).classed(m.noTransition,!0),this.wrapper=this.wrapperOuter.append("div").classed(m.wrapper,!0).classed(m.noTransition,!0).classed("vzb-dialog-scrollable",!0),this.wrapper.on("click",function(){d3.event.stopPropagation()}),this.wrapper.append("div").attr("class",m.close).html(d.close).on("click",function(){d3.event.stopPropagation(),t.toggle()}).select("svg").attr("width","0px").attr("height","0px").attr("class",m.close+"-icon"),this.wrapper.append("div").classed(m.scaletypes,!0).append("span"),this.wrapper.append("div").classed(m.title,!0).append("span"),this.wrapper.append("div").classed(m.search_wrap,!0).append("input").classed(m.search,!0).attr("type","search").attr("id",m.search),d3.select("body").on("mousemove",t._mousemoveDocument),this.wrapper.on("mouseleave",function(){}),this.translator=this.model.locale.getTFunction(),t._enableSearch(),t.resize()},_buildIndicatorsTree:function(t){t!==!0&&t||(t=[]);var e=this,i="_root",n="_unclassified",r={};r[i]={id:i,children:[]},r[n]={id:n,type:"folder",name:this.translator("buttons/unclassified"),children:[]},t.forEach(function(t){r[t.tag]={id:t.tag,name:t.name,type:"folder",children:[]}});var a=r[i];a.children.push(r[n]),t.forEach(function(t){t.parent&&r[t.parent]?r[t.parent].children.push(r[t.tag]):a.children.push(r[t.tag])}),s.forEach(this.model.marker._root._data,function(t){if("data"===t._type){var a=t.getConceptprops(),o=t.getDatasetName();r[o]={id:o,type:"dataset",children:[]},r[i].children.push(r[o]),s.forEach(a,function(i,a){if("_none"!=i.tags){i.tags||(i.tags=o||n);var l={id:a,name:i.name,unit:i.unit,description:i.description,dataSource:t._name};i.tags.split(",").forEach(function(t){r[t.trim()]?r[t.trim()].children.push(l):(e.consoleGroupOpen||(console.groupCollapsed("Some tags were are not found, so indicators went under 'Unclassified' menu"),e.consoleGroupOpen=!0),s.warn("tag '"+t+"' for indicator '"+a+"'"),r[n].children.push(l))})}})}}),e.consoleGroupOpen&&(console.groupEnd(),delete e.consoleGroupOpen),this._sortChildren(a),this.indicatorsTree=a},_sortChildren:function(t,e){var i=this;t.children&&(t.children.sort(s.firstBy()(function(t,e){return t="dataset"===t.type?1:0,e="dataset"===e.type?1:0,e-t}).thenBy(function(t,e){return t=t.children?1:0,e=e.children?1:0,t-e}).thenBy(function(t,i){if(!e){if("time"==t.id)return-1;if("time"==i.id)return 1;if("advanced"==t.id)return 1;if("advanced"==i.id)return-1;if("_default"==t.id)return 1;if("_default"==i.id)return-1}return t.name>i.name?1:-1})),t.children.forEach(function(t){i._sortChildren(t,!0)}))},resize:function(){var t=this;this.profiles={small:{col_width:200},medium:{col_width:200},large:{col_width:200}};var e=this._top,i=this._left;this.wrapper.classed(m.noTransition,!0),this.wrapper.node().scrollTop=0,this.activeProfile=this.profiles[this.getLayoutProfile()],this.OPTIONS.IS_MOBILE="small"===this.getLayoutProfile(),this.menuEntity&&(this.menuEntity.setWidth(this.activeProfile.col_width,!0,!0),this.OPTIONS.IS_MOBILE?this.menuEntity.direction!=p&&(this.menuEntity.setDirection(p,!0),this.OPTIONS.MENU_DIRECTION=p):this.menuEntity.direction!=f&&(this.menuEntity.setDirection(f,!0),this.OPTIONS.MENU_DIRECTION=f)),this.width=t.element.node().offsetWidth,this.height=t.element.node().offsetHeight;var n=this.wrapperOuter.node().getBoundingClientRect(),r=n.width,a=n.height;if(r)if(this.OPTIONS.IS_MOBILE)this.clearPos();else{(e||i)&&(this.wrapperOuter.node().offsetTop<10&&this.wrapperOuter.style("top","10px"),this.height-t.wrapperOuter.node().offsetTop-a<0&&(a>this.height&&(a=this.height-20),this.wrapperOuter.style("top",this.height-a-10+"px"),this.wrapperOuter.style("bottom","auto")),e&&(e=t.wrapperOuter.node().offsetTop));var o=void 0;o=this.wrapperOuter.classed(m.alignYb)?this.wrapperOuter.node().offsetTop+this.wrapperOuter.node().offsetHeight:this.height-this.wrapperOuter.node().offsetTop,this.wrapper.style("max-height",o-10+"px"),this.wrapperOuter.classed(m.alignXc,"center"===this._alignX),this.wrapperOuter.style("margin-left","center"===this._alignX?"-"+r/2+"px":null),"center"===this._alignX?this.OPTIONS.MAX_MENU_WIDTH=this.width/2-.5*r-10:this.OPTIONS.MAX_MENU_WIDTH=this.width-this.wrapperOuter.node().offsetLeft-r-10;var s=this.activeProfile.col_width+2*this.OPTIONS.MIN_COL_WIDTH,l=this.wrapperOuter.node().offsetLeft;this.OPTIONS.MENU_OPEN_LEFTSIDE=this.OPTIONS.MAX_MENU_WIDTH<s&&l>this.OPTIONS.MAX_MENU_WIDTH+10,this.OPTIONS.MENU_OPEN_LEFTSIDE?(l<s+10&&(l=s+10),this.OPTIONS.MAX_MENU_WIDTH=l-10):this.OPTIONS.MAX_MENU_WIDTH<s&&(l-=s-this.OPTIONS.MAX_MENU_WIDTH,this.OPTIONS.MAX_MENU_WIDTH=s),i?i=l:l!=this.wrapperOuter.node().offsetLeft&&(this.wrapperOuter.style("left","auto"),this.wrapperOuter.style("right",this.width-l-n.width+"px")),this._top=e,this._left=i,(i||e)&&this.setPos(),this.wrapperOuter.classed("vzb-treemenu-open-left-side",!this.OPTIONS.IS_MOBILE&&this.OPTIONS.MENU_OPEN_LEFTSIDE)}return this.wrapper.node().offsetHeight,this.wrapper.classed(m.noTransition,!1),this.setHorizontalMenuHeight(),this},toggle:function(){var t=this,e=!this.element.classed(m.hidden);this.element.classed(m.hidden,e),e?(this.clearPos(),this.menuEntity.marqueeToggle(!1)):((top||left)&&this.setPos(),this.resize(),this.scrollToSelected()),this.wrapper.classed(m.noTransition,e),this.parent.components.forEach(function(i){"gapminder-dialogs"==i.name?d3.select(i.placeholder.parentNode).classed("vzb-blur",!e):i.element.classed?i.element.classed("vzb-blur",i!=t&&!e):d3.select(i.element).classed("vzb-blur",i!=t&&!e)}),this.width=t.element.node().offsetWidth},scrollToSelected:function(){var t=this,e=function(t,e){t.scrollTop=0;var i=t.getBoundingClientRect(),n=e.getBoundingClientRect(),r=n.bottom-i.top-t.offsetHeight+10;t.scrollTop=r};if(this.menuEntity.direction==p)e(this.wrapper.node(),this.selectedNode),t.menuEntity.marqueeToggleAll(!0);else{var i=this.menuEntity.findItemById(d3.select(this.selectedNode).data().id);i.submenu.calculateMissingWidth(0,function(){t.menuEntity.marqueeToggleAll(!0)});for(var n=this.selectedNode,r=void 0;!s.hasClass(n,m.list_top_level);)"LI"==n.tagName&&(r=s.hasClass(n.parentNode,m.list_top_level)?n.parentNode.parentNode:n.parentNode,e(r,n)),n=n.parentNode}},setPos:function(){var t=this._top,e=this._left,i=this.wrapperOuter.node().getBoundingClientRect();if(t&&(this.wrapperOuter.style("top",t+"px"),this.wrapperOuter.style("bottom","auto"),this.wrapperOuter.classed(m.absPosVert,t)),e){var n=this.element.node().offsetWidth-e-i.width;n=n<10?10:n,this.wrapperOuter.style("right",n+"px"),this.wrapperOuter.style("left","auto"),this.wrapperOuter.classed(m.absPosHoriz,n)}},clearPos:function(){this._top="",this._left="",this.wrapperOuter.attr("style",""),this.wrapperOuter.classed(m.absPosVert,""),this.wrapperOuter.classed(m.absPosHoriz,""),this.wrapperOuter.classed(m.menuOpenLeftSide,""),this.wrapper.style("max-height","")},setHorizontalMenuHeight:function(){var t=null;if(this.menuEntity&&this.OPTIONS.MENU_DIRECTION==f&&this.menuEntity.menuItems.length){var e=parseInt(this.menuEntity.menuItems[0].entity.style("height"),10),i=e*this._maxChildCount,n=Math.max(this.menuEntity.menuItems.length,3)*e+this.menuEntity.entity.node().offsetTop+parseInt(this.wrapper.style("padding-bottom"),10);t=""+Math.max(i,n)+"px"}this.wrapper.classed(m.noTransition,!0),this.wrapper.node().offsetHeight,this.wrapper.style("height",t),this.wrapper.node().offsetHeight,this.wrapper.classed(m.noTransition,!1)},_enableSearch:function(){var t=this,e=this.wrapper.select("."+m.search),i=function(e){var i={_id:"root",children:[]},n=function(e,i,n){var r=i[n].name;if(!r&&t.translator){var a=t.translator("indicator/"+i[n][t.OPTIONS.SEARCH_PROPERTY]+"/"+t.model.marker[t._markerID]._type);r=a||t.translator("indicator/"+i[n][t.OPTIONS.SEARCH_PROPERTY])}return r&&r.toLowerCase().indexOf(e.toLowerCase())>=0},r=function r(a){for(var o=t.OPTIONS.SUBMENUS,s=0;s<a.length;s++){var l=!1;l=n(e,a,s),l&&i.children.push(a[s]),!l&&a[s][o]&&r(a[s][o])}};return r(t.dataFiltered.children),i},n=!1,r=s.debounce(function(){var r=e.node().value;(n||""!=r)&&(n=""!=r,r.length>=t.OPTIONS.SEARCH_MIN_STR?t.redraw(i(r),!0):t.redraw())},250);e.on("input",r)},_selectIndicator:function(t){this._callback("which",t,this._markerID),this.toggle()},redraw:function(t,e){var i=this,n=this,r=this._markerID,o=void 0,l=void 0,c={};s.forEach(this.model.marker._root._data,function(t){"data"===t._type&&s.deepExtend(c,t.getConceptprops())});var u=n.model.marker[r]._type;e?o=t:(null==t&&(t=this._tree),l=s.keys(c).filter(function(t){if(n.model.marker[r].allow&&n.model.marker[r].allow.names){if(n.model.marker[r].allow.names.indexOf("!"+t)!=-1)return!1;if(n.model.marker[r].allow.names.indexOf(t)!=-1)return!0}if(!n.model.marker[r].allow||!n.model.marker[r].allow.scales)return!0;if("*"==n.model.marker[r].allow.scales[0])return!0;if(!c[t].scales)return!0;for(var e=c[t].scales.length-1;e>=0;e--)if(n.model.marker[r].allow.scales.indexOf(c[t].scales[e])>-1)return!0;return!1}),o=s.pruneTree(t,function(t){return l.indexOf(t.id)>-1}),this.dataFiltered=o),this.wrapper.select("ul").remove(),this.element.select("."+m.title).select("span").text(this.translator("buttons/"+r)),this.element.select("."+m.search).attr("placeholder",this.translator("placeholder/search")+"..."),this._maxChildCount=0;var h=function t(e,i,a){if(i.children){n._maxChildCount=Math.max(n._maxChildCount,i.children.length);var o=a?e:e.append("div").classed(m.list_outer,!0),l=o.append("ul").classed(m.list,!a).classed(m.list_top_level,a).classed("vzb-dialog-scrollable",!0).selectAll("li").data(i.children,function(t){return t.id}).enter().append("li");l.append("span").classed(m.list_item_label,!0).attr("children",function(t){return t.children?"true":null}).attr("type",function(t){return t.type?t.type:null}).on("click",function(t){var e=d3.select(this);e.attr("children")||(d3.event.stopPropagation(),n._selectIndicator({concept:t.id,dataSource:t.dataSource}))}).append("span").text(function(t){var e="_default"===t.id?n.translator("indicator/_default/"+u):t.name||t.id;return e||""===e||s.warn("translation missing: NAME of "+t.id),e||""}),l.classed(m.list_item,!0).classed(m.hasChild,function(t){return t.children}).classed(m.isSpecial,function(t){return t.special}).each(function(e){var i=d3.select(this);if(e.children||!function(){var t=i.append("div").attr("class",m.menuHorizontal+" "+m.list_outer+" "+m.list_item_leaf);t.on("click",function(t){n._selectIndicator({concept:t.id,dataSource:t.dataSource})});var e=t.append("div").classed(m.leaf+" "+m.leaf_content+" vzb-dialog-scrollable",!0);e.append("span").classed(m.leaf_content_item+" "+m.leaf_content_item_title,!0).text(function(t){var e="_default"===t.id?n.translator("indicator/_default/"+u):t.name;return e||""});var r=void 0,a=e.append("span").classed(m.leaf_content_item,!0).text(function(t){var e="_default"===t.id?n.translator("unit/_default/"+u):t.unit;return r=!e,n.translator("hints/units")+": "+e||""});a.classed("vzb-hidden",r);var o=void 0,s=e.append("span").classed(m.leaf_content_item+" "+m.leaf_content_item_descr,!0).text(function(t){var e="_default"===t.id?n.translator("description/_default/"+u):t.description;return o=!e,r&&o?n.translator("hints/nodescr"):e||""});s.classed("vzb-hidden",o&&!r)}(),e.id==n.model.marker[r].which){var o=void 0;if(n.selectedNode&&a)for(o=n.selectedNode.parentNode,d3.select(n.selectedNode).select("."+m.list_item_leaf).classed("active",!1);!s.hasClass(o,m.list_top_level);)"UL"==o.tagName&&d3.select(o.parentNode).classed("active",!1),o=o.parentNode;if(!n.selectedNode||a){for(o=this.parentNode,d3.select(this).classed("item-active",!0).select("."+m.list_item_leaf).classed("active",!0);!s.hasClass(o,m.list_top_level);)"UL"==o.tagName&&d3.select(o.parentNode).classed("active",!0),"LI"==o.tagName&&d3.select(o).classed("item-active",!0),o=o.parentNode;n.selectedNode=this}}t(i,e)})}};if(this.OPTIONS.IS_MOBILE?this.OPTIONS.MENU_DIRECTION=p:this.OPTIONS.MENU_DIRECTION=f,this.selectedNode=null,h(this.wrapper,o,!0),this.menuEntity=new v(null,this.wrapper.selectAll("."+m.list_top_level),this.OPTIONS),this.menuEntity&&this.menuEntity.setDirection(this.OPTIONS.MENU_DIRECTION),this.menuEntity&&this.menuEntity.setWidth(this.activeProfile.col_width,!0,!0),this.setHorizontalMenuHeight(),!e){var d=function(){var t="_default";if(l.indexOf(i.model.marker[r].which)>-1&&(t=i.model.marker[r].which),c[t]||s.error("Concept properties of "+t+" are missing from the set, or the set is empty. Put a breakpoint here and check what you have in indicatorsDB"),!c[t].scales)return i.element.select("."+m.scaletypes).classed(m.hidden,!0),{v:!0};var e=c[t].scales.filter(function(t){return!n.model.marker[r].allow||!n.model.marker[r].allow.scales||("*"==n.model.marker[r].allow.scales[0]||n.model.marker[r].allow.scales.indexOf(t)>-1)});0==e.length?i.element.select("."+m.scaletypes).classed(m.hidden,!0):!function(){var t=i.element.select("."+m.scaletypes).classed(m.hidden,!1).selectAll("span").data(e,function(t){return t});t.exit().remove(),t=t.enter().append("span").on("click",function(t){d3.event.stopPropagation(),n._setModel("scaleType",t,n._markerID)}).merge(t);var a=n.model.marker[r].scaleType;t.classed(m.scaletypesDisabled,e.length<2).classed(m.scaletypesActive,function(t){return(t==a||"log"===t&&"genericLog"===a)&&e.length>1}).text(function(t){return n.translator("scaletype/"+t)})}()}();if("object"===("undefined"==typeof d?"undefined":a(d)))return d.v}return this},updateView:function(){if(this._markerID){this.wrapperOuter.classed(m.absPosVert,this._top),this.wrapperOuter.classed(m.alignYt,"top"===this._alignY),this.wrapperOuter.classed(m.alignYb,"bottom"===this._alignY),this.wrapperOuter.classed(m.absPosHoriz,this._left),this.wrapperOuter.classed(m.alignXl,"left"===this._alignX),this.wrapperOuter.classed(m.alignXr,"right"===this._alignX);var t=this._setModel.bind(this);return this.callback(t).tree(this.indicatorsTree).redraw(),this.wrapper.select("."+m.search).node().value="",this}},_setModel:function(t,e,i){var n=this.model.marker[i];"which"==t&&n.setWhich(e),"scaleType"==t&&n.setScaleType(e)}});e.default=b},function(t,e){var i={}.toString;t.exports=function(t){return i.call(t).slice(8,-1)}},function(t,e){t.exports=function(t){if(void 0==t)throw TypeError("Can't call method on  "+t);return t}},function(t,e,i){var n=i(5);t.exports=function(t,e){return!!t&&n(function(){e?t.call(null,function(){},1):t.call(null)})}},function(t,e,i){var n=i(37),r=i(69),a=i(13),o=i(12),s=i(236);t.exports=function(t,e){var i=1==t,l=2==t,c=3==t,u=4==t,h=6==t,d=5==t||h,f=e||s;return function(e,s,p){for(var m,g,v=a(e),y=r(v),b=n(s,p,3),_=o(y.length),x=0,w=i?f(e,_):l?f(e,0):void 0;_>x;x++)if((d||x in y)&&(m=y[x],g=b(m,x,v),t))if(i)w[x]=g;else if(g)switch(t){case 3:return!0;case 5:return m;case 6:return x;case 2:w.push(m)}else if(u)return!1;return h?-1:c||u?u:w}}},function(t,e,i){var n=i(0),r=i(36),a=i(5);t.exports=function(t,e){var i=(r.Object||{})[t]||Object[t],o={};o[t]=e(i),n(n.S+n.F*a(function(){i(1)}),"Object",o)}},function(t,e,i){var n=i(6);t.exports=function(t,e){if(!n(t))return t;var i,r;if(e&&"function"==typeof(i=t.toString)&&!n(r=i.call(t)))return r;if("function"==typeof(i=t.valueOf)&&!n(r=i.call(t)))return r;if(!e&&"function"==typeof(i=t.toString)&&!n(r=i.call(t)))return r;throw TypeError("Can't convert object to primitive value")}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={ext_resources:{},build:1488195842170,version:"0.19.1-37"}},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var a=i(1),o=(r(a),i(2)),s=n(o),l=i(10),c=!0,u=!1,h=!1,d=0,f=0,p=null,m=null,g=s.default.extend({init:function(t,e){var i=this;this.name="gapminder-datanotes",this.model_expects=[{name:"marker",type:"model"},{name:"locale",type:"locale"}],this.context=e,this.model_binds={"translate:locale":function(t){i._ready&&i._readyOnce&&i.ready()}},this._super(t,e),this.close=this.close.bind(this)},ready:function(){this.setValues()},readyOnce:function(){var t=this;this.translator=this.model.locale.getTFunction(),this.element=d3.select(this.placeholder),this.element.selectAll("div").remove();var e=this.element;e.append("div").html(l.close).on("click",function(){d3.event.stopPropagation(),t.close()}).select("svg").attr("width","0px").attr("height","0px").attr("class","vzb-data-notes-close").classed("vzb-hidden",!0),e.append("div").attr("class","vzb-data-notes-body vzb-dialog-scrollable"),e.append("div").attr("class","vzb-data-notes-link")},resize:function(){this.close()},close:function(){c||this.pin(!1).hide()},setHook:function(t){return this._readyOnce?h?(m=t,this):(p&&this.model.marker[p].off("change:which",this.close),p=m=t,this.model.marker[p].on("change:which",this.close),this.setValues(),this):this},setValues:function(){if(p){var t=this.model.marker[p],e=t.getConceptprops();if(this.element.select(".vzb-data-notes-body").classed("vzb-hidden",!e.description).text(e.description||""),this.element.select(".vzb-data-notes-link").classed("vzb-hidden",!e.sourceLink),e.sourceLink){var i=this.translator("hints/source"),n=e.sourceName||"";this.element.select(".vzb-data-notes-link").html("<span>"+(n?i+":":"")+'<a href="'+e.sourceLink+'" target="_blank">'+(n?n:i)+"</a></span>")}u=e.sourceLink||e.description}},setPos:function(t,e,i){if(d=t,f=e,h&&!i)return this;var n=this.parent.element.offsetHeight,r=this.element.node().offsetWidth,a=this.element.node().offsetHeight,o=void 0,s=void 0,l=d-r,c=f;return l<10&&(l=10,o=!0),c+a+10>n&&(c=n-a-10,s=!0),o&&s&&(c=f-a-30),this.element.style("top",c+"px"),this.element.style("left",l+"px"),this},pin:function(t){return c?this:(h=!h,null!=t&&(h=t),this.element.select(".vzb-data-notes-close").classed("vzb-hidden",!h),this.element.classed("vzb-data-notes-pinned",h),p!=m&&this.setHook(m),this.element.select(".vzb-data-notes-body").node().scrollTop=0,u?this.setPos(d,f,!0):this.hide())},toggle:function(t){return h||!p?this:(null==t&&(t=!c),c=t,this.element.classed("vzb-hidden",c||!u),this)},show:function(){return this.toggle(!1)},hide:function(){return this.toggle(!0)}});e.default=g},function(t,e){var i=t.exports={version:"2.4.0"};"number"==typeof __e&&(__e=i)},function(t,e,i){var n=i(17);t.exports=function(t,e,i){if(n(t),void 0===e)return t;switch(i){case 1:return function(i){return t.call(e,i)};case 2:return function(i,n){return t.call(e,i,n)};case 3:return function(i,n,r){return t.call(e,i,n,r)}}return function(){return t.apply(e,arguments)}}},function(t,e,i){var n=i(177),r=i(0),a=i(83)("metadata"),o=a.store||(a.store=new(i(180))),s=function(t,e,i){var r=o.get(t);if(!r){if(!i)return;o.set(t,r=new n)}var a=r.get(e);if(!a){if(!i)return;r.set(e,a=new n)}return a},l=function(t,e,i){var n=s(e,i,!1);return void 0!==n&&n.has(t)},c=function(t,e,i){var n=s(e,i,!1);return void 0===n?void 0:n.get(t)},u=function(t,e,i,n){s(i,n,!0).set(t,e)},h=function(t,e){var i=s(t,e,!1),n=[];return i&&i.forEach(function(t,e){n.push(e)}),n},d=function(t){return void 0===t||"symbol"==typeof t?t:String(t)},f=function(t){r(r.S,"Reflect",t)};t.exports={store:o,map:s,has:l,get:c,set:u,keys:h,key:d,exp:f}},function(t,e,i){"use strict";if(i(8)){var n=i(51),r=i(4),a=i(5),o=i(0),s=i(84),l=i(113),c=i(37),u=i(50),h=i(44),d=i(18),f=i(55),p=i(45),m=i(12),g=i(57),v=i(33),y=i(14),b=i(174),_=i(68),x=i(6),w=i(13),M=i(98),z=i(52),S=i(25),E=i(53).f,k=i(115),T=i(58),P=i(7),O=i(31),A=i(74),I=i(107),C=i(116),L=i(64),D=i(80),R=i(56),B=i(91),j=i(154),F=i(9),N=i(24),q=F.f,V=N.f,U=r.RangeError,H=r.TypeError,X=r.Uint8Array,Y="ArrayBuffer",W="Shared"+Y,G="BYTES_PER_ELEMENT",K="prototype",Z=Array[K],Q=l.ArrayBuffer,J=l.DataView,$=O(0),tt=O(2),et=O(3),it=O(4),nt=O(5),rt=O(6),at=A(!0),ot=A(!1),st=C.values,lt=C.keys,ct=C.entries,ut=Z.lastIndexOf,ht=Z.reduce,dt=Z.reduceRight,ft=Z.join,pt=Z.sort,mt=Z.slice,gt=Z.toString,vt=Z.toLocaleString,yt=P("iterator"),bt=P("toStringTag"),_t=T("typed_constructor"),xt=T("def_constructor"),wt=s.CONSTR,Mt=s.TYPED,zt=s.VIEW,St="Wrong length!",Et=O(1,function(t,e){return It(I(t,t[xt]),e)}),kt=a(function(){return 1===new X(new Uint16Array([1]).buffer)[0]}),Tt=!!X&&!!X[K].set&&a(function(){new X(1).set({})}),Pt=function(t,e){if(void 0===t)throw H(St);var i=+t,n=m(t);if(e&&!b(i,n))throw U(St);return n},Ot=function(t,e){var i=p(t);if(i<0||i%e)throw U("Wrong offset!");return i},At=function(t){if(x(t)&&Mt in t)return t;throw H(t+" is not a typed array!")},It=function(t,e){if(!(x(t)&&_t in t))throw H("It is not a typed array constructor!");return new t(e)},Ct=function(t,e){return Lt(I(t,t[xt]),e)},Lt=function(t,e){for(var i=0,n=e.length,r=It(t,n);n>i;)r[i]=e[i++];return r},Dt=function(t,e,i){q(t,e,{get:function(){return this._d[i]}})},Rt=function(t){var e,i,n,r,a,o,s=w(t),l=arguments.length,u=l>1?arguments[1]:void 0,h=void 0!==u,d=k(s);if(void 0!=d&&!M(d)){for(o=d.call(s),n=[],e=0;!(a=o.next()).done;e++)n.push(a.value);s=n}for(h&&l>2&&(u=c(u,arguments[2],2)),e=0,i=m(s.length),r=It(this,i);i>e;e++)r[e]=h?u(s[e],e):s[e];return r},Bt=function(){for(var t=0,e=arguments.length,i=It(this,e);e>t;)i[t]=arguments[t++];return i},jt=!!X&&a(function(){vt.call(new X(1))}),Ft=function(){return vt.apply(jt?mt.call(At(this)):At(this),arguments)},Nt={copyWithin:function(t,e){return j.call(At(this),t,e,arguments.length>2?arguments[2]:void 0)},every:function(t){return it(At(this),t,arguments.length>1?arguments[1]:void 0)},fill:function(t){return B.apply(At(this),arguments)},filter:function(t){return Ct(this,tt(At(this),t,arguments.length>1?arguments[1]:void 0))},find:function(t){return nt(At(this),t,arguments.length>1?arguments[1]:void 0)},findIndex:function(t){return rt(At(this),t,arguments.length>1?arguments[1]:void 0)},forEach:function(t){$(At(this),t,arguments.length>1?arguments[1]:void 0)},indexOf:function(t){return ot(At(this),t,arguments.length>1?arguments[1]:void 0)},includes:function(t){return at(At(this),t,arguments.length>1?arguments[1]:void 0)},join:function(t){return ft.apply(At(this),arguments)},lastIndexOf:function(t){return ut.apply(At(this),arguments)},map:function(t){return Et(At(this),t,arguments.length>1?arguments[1]:void 0)},reduce:function(t){return ht.apply(At(this),arguments)},reduceRight:function(t){return dt.apply(At(this),arguments)},reverse:function(){for(var t,e=this,i=At(e).length,n=Math.floor(i/2),r=0;r<n;)t=e[r],e[r++]=e[--i],e[i]=t;return e},some:function(t){return et(At(this),t,arguments.length>1?arguments[1]:void 0)},sort:function(t){return pt.call(At(this),t)},subarray:function(t,e){var i=At(this),n=i.length,r=g(t,n);return new(I(i,i[xt]))(i.buffer,i.byteOffset+r*i.BYTES_PER_ELEMENT,m((void 0===e?n:g(e,n))-r))}},qt=function(t,e){return Ct(this,mt.call(At(this),t,e))},Vt=function(t){At(this);var e=Ot(arguments[1],1),i=this.length,n=w(t),r=m(n.length),a=0;if(r+e>i)throw U(St);for(;a<r;)this[e+a]=n[a++]},Ut={entries:function(){return ct.call(At(this))},keys:function(){return lt.call(At(this))},values:function(){return st.call(At(this))}},Ht=function(t,e){return x(t)&&t[Mt]&&"symbol"!=typeof e&&e in t&&String(+e)==String(e)},Xt=function(t,e){return Ht(t,e=v(e,!0))?h(2,t[e]):V(t,e)},Yt=function(t,e,i){return!(Ht(t,e=v(e,!0))&&x(i)&&y(i,"value"))||y(i,"get")||y(i,"set")||i.configurable||y(i,"writable")&&!i.writable||y(i,"enumerable")&&!i.enumerable?q(t,e,i):(t[e]=i.value,t)};wt||(N.f=Xt,F.f=Yt),o(o.S+o.F*!wt,"Object",{getOwnPropertyDescriptor:Xt,defineProperty:Yt}),a(function(){gt.call({})})&&(gt=vt=function(){return ft.call(this)});var Wt=f({},Nt);f(Wt,Ut),d(Wt,yt,Ut.values),f(Wt,{slice:qt,set:Vt,constructor:function(){},toString:gt,toLocaleString:Ft}),Dt(Wt,"buffer","b"),Dt(Wt,"byteOffset","o"),Dt(Wt,"byteLength","l"),Dt(Wt,"length","e"),q(Wt,bt,{get:function(){return this[Mt]}}),t.exports=function(t,e,i,l){l=!!l;var c=t+(l?"Clamped":"")+"Array",h="Uint8Array"!=c,f="get"+t,p="set"+t,g=r[c],v=g||{},y=g&&S(g),b=!g||!s.ABV,w={},M=g&&g[K],k=function(t,i){var n=t._d;return n.v[f](i*e+n.o,kt)},T=function(t,i,n){var r=t._d;l&&(n=(n=Math.round(n))<0?0:n>255?255:255&n),r.v[p](i*e+r.o,n,kt)},P=function(t,e){q(t,e,{get:function(){return k(this,e)},set:function(t){return T(this,e,t)},enumerable:!0})};b?(g=i(function(t,i,n,r){u(t,g,c,"_d");var a,o,s,l,h=0,f=0;if(x(i)){if(!(i instanceof Q||(l=_(i))==Y||l==W))return Mt in i?Lt(g,i):Rt.call(g,i);a=i,f=Ot(n,e);var p=i.byteLength;if(void 0===r){if(p%e)throw U(St);if(o=p-f,o<0)throw U(St)}else if(o=m(r)*e,o+f>p)throw U(St);s=o/e}else s=Pt(i,!0),o=s*e,a=new Q(o);for(d(t,"_d",{b:a,o:f,l:o,e:s,v:new J(a)});h<s;)P(t,h++)}),M=g[K]=z(Wt),d(M,"constructor",g)):D(function(t){new g(null),new g(t)},!0)||(g=i(function(t,i,n,r){u(t,g,c);var a;return x(i)?i instanceof Q||(a=_(i))==Y||a==W?void 0!==r?new v(i,Ot(n,e),r):void 0!==n?new v(i,Ot(n,e)):new v(i):Mt in i?Lt(g,i):Rt.call(g,i):new v(Pt(i,h))}),$(y!==Function.prototype?E(v).concat(E(y)):E(v),function(t){t in g||d(g,t,v[t])}),g[K]=M,n||(M.constructor=g));var O=M[yt],A=!!O&&("values"==O.name||void 0==O.name),I=Ut.values;d(g,_t,!0),d(M,Mt,c),d(M,zt,!0),d(M,xt,g),(l?new g(1)[bt]==c:bt in M)||q(M,bt,{get:function(){return c}}),w[c]=g,o(o.G+o.W+o.F*(g!=v),w),o(o.S,c,{BYTES_PER_ELEMENT:e,from:Rt,of:Bt}),G in M||d(M,G,e),o(o.P,c,Nt),R(c),o(o.P+o.F*Tt,c,{set:Vt}),o(o.P+o.F*!A,c,Ut),o(o.P+o.F*(M.toString!=gt),c,{toString:gt}),o(o.P+o.F*a(function(){new g(1).slice()}),c,{slice:qt}),o(o.P+o.F*(a(function(){return[1,2].toLocaleString()!=new g([1,2]).toLocaleString()})||!a(function(){M.toLocaleString.call([1,2])})),c,{toLocaleString:Ft}),L[c]=A?O:I,n||A||d(M,yt,I)}}else t.exports=function(){}},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var a=i(1),o=(r(a),i(2)),s=n(o),l=i(10),c=!0,u=s.default.extend({init:function(t,e){var i=this;this.name="gapminder-datawarning",this.model_expects=[{name:"locale",type:"locale"}],this.context=e,this.model_binds={"translate:locale":function(t){i._ready&&i.redraw()}},this._super(t,e)},ready:function(){this.redraw()},readyOnce:function(){var t=this;this.element=d3.select(this.placeholder),this.element.selectAll("div").remove(),this.element.append("div").attr("class","vzb-data-warning-background").on("click",function(){t.toggle(!0)}),this.container=this.element.append("div").attr("class","vzb-data-warning-box"),this.container.append("div").html(l.close).on("click",function(){t.toggle()}).select("svg").attr("width","0px").attr("height","0px").attr("class","vzb-data-warning-close");var e=this.container.append("div").attr("class","vzb-data-warning-link").html(l.warn);e.append("div"),this.container.append("div").attr("class","vzb-data-warning-title"),this.container.append("div").attr("class","vzb-data-warning-body vzb-dialog-scrollable")},redraw:function(){this.translator=this.model.locale.getTFunction(),this.container.select(".vzb-data-warning-link div").text(this.translator("hints/dataWarning"));var t=this.translator("datawarning/title/"+this.parent.name);this.container.select(".vzb-data-warning-title").html(t).classed("vzb-hidden",!t||t=="datawarning/title/"+this.parent.name),this.container.select(".vzb-data-warning-body").html(this.translator("datawarning/body/"+this.parent.name))},toggle:function(t){null==t&&(t=!c),c=t,this.element.classed("vzb-hidden",c);var e=this;this.parent.components.forEach(function(t){t.element.classed("vzb-blur",t!=e&&!c)})}});e.default=u},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function r(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}function a(t){return function e(i){function n(t,e,i){return i.indexOf(t)===e}function a(t){var e=a.scale().domain(),n=a.scale().range();if(!e[0]&&0!==e[0]||!e[1]&&0!==e[1]||!n[0]&&0!==n[0]||!n[1]&&0!==n[1])return s.warn("d3.axisSmart() skips action because of invalid domain "+JSON.stringify(e)+" or range "+JSON.stringify(n)+" of the attached scale");if(null!=y)return void a.highlightValueRun(t);var r=t.append("g").attr("class","tick widthSampling"),o=r.append("text").text("0");z.cssMargin||(z.cssMargin={}),z.cssMargin.top=o.style("margin-top"),z.cssMargin.bottom=o.style("margin-bottom"),z.cssMargin.left=o.style("margin-left"),z.cssMargin.right=o.style("margin-right"),z.widthOfOneDigit=o.node().getBBox().width,z.heightOfOneDigit=o.node().getBBox().height,r.remove(),a.labelFactory(z),i(z.transitionDuration>0?t.transition().duration(z.transitionDuration):t),t.attr("fill",null),t.attr("font-size",null),t.attr("font-family",null),t.attr("text-anchor",null);var l="top"==a.orient()||"bottom"==a.orient()?h:u,c=l==h&&a.pivot()||l==u&&!a.pivot()?f:d;t.selectAll(".vzb-axis-value").data([null]).enter().append("g").attr("class","vzb-axis-value").classed("vzb-hidden",!0).append("text");var p=a.tickPadding();t.selectAll("text").each(function(t,e){if(null!=a.pivot()){var i=d3.select(this);i.attr("transform","rotate("+(a.pivot()?-90:0)+")"),i.style("text-anchor",c==d?"middle":"end"),i.attr("x",c==d?l==u?-p:0:-p),i.attr("y",c==d?l==u?0:p:0),i.attr("dx",c==d&&l==u?p:0),i.attr("dy",c==d?l==u?-p:".72em":".32em")}}),null!=a.repositionLabels()&&t.selectAll(".tick").each(function(t){var e=d3.select(this).select("text"),i=a.repositionLabels()[t]||{x:0,y:0};e.attr("x",+e.attr("x")+i.x),e.attr("y",+e.attr("y")+i.y)});var m=a.scale();z.viewportLength&&t.selectAll(".tick").classed("vzb-hidden",function(t){return m(t)<0||m(t)>z.viewportLength}),null==a.tickValuesMinor()&&a.tickValuesMinor([]);var g=t.selectAll(".tick-minor").data(w);g.exit().remove(),g=g.enter().append("line").attr("class","tick-minor").merge(g);var v=a.tickSizeMinor().outbound,b=a.tickSizeMinor().inbound;g.classed("vzb-hidden",function(t){return m(t)<0||m(t)>z.viewportLength}).attr("y1",l==h?("top"==a.orient()?1:-1)*b:m).attr("y2",l==h?("top"==a.orient()?-1:1)*v:m).attr("x1",l==u?("right"==a.orient()?-1:1)*b:m).attr("x2",l==u?("right"==a.orient()?1:-1)*v:m),t.selectAll("path").remove();var _=t.selectAll(".vzb-axis-line").data([0]);_.exit().remove(),_=_.enter().append("line").attr("class","vzb-axis-line").merge(_),z.viewportLength?_.attr("x1",l==u?0:-1).attr("x2",l==u?0:z.viewportLength).attr("y1",0).attr("y2",l==h?0:z.viewportLength):_.attr("x1",l==u?0:d3.min(m.range())-(z.bump||0)-1).attr("x2",l==u?0:d3.max(m.range())+(z.bump||0)).attr("y1",l==h?0:d3.min(m.range())-(z.bump||0)).attr("y2",l==h?0:d3.max(m.range())+(z.bump||0))}function o(t,e){null==e&&(e=!0);var i=[],n=[];t.indexOf(0)!=-1&&(i.push([0]),n.push(t.indexOf(0)));for(var r=function(r){i.push(t.filter(function(t,i){return!(i%Math.floor(r)!=0||n.indexOf(i)!=-1&&e)&&(n.push(i),!0)}))},a=t.length;a>=1;a=a<4?a-1:a/2)r(a);return i}function l(t,e,i,n,r){if(!t)return null;var a={},o=i==u?{head:e.toolMargin.top,tail:e.toolMargin.bottom}:{head:e.toolMargin.right,tail:e.toolMargin.left},s=n.range(),l=e.bump;return e.viewportLength&&(t=t.filter(function(t){return n(t)>=0&&n(t)<=e.viewportLength}),s=[0,e.viewportLength],l=0),t.forEach(function(c,d){if(0==d||d==t.length-1){var f=Math.min(o.head,.5*e.widthOfOneDigit)+l+(i==h?1:0)*d3.max(s)-(i==h?0:1)*d3.min(s)+(i==h?-1:1)*n(c)-("x"==r)*e.formatter(c).length*e.widthOfOneDigit/2-("y"==r)*e.heightOfOneDigit/2-("x"==r)*parseInt(e.cssMargin.right)-("y"==r)*parseInt(e.cssMargin.top),p=Math.min(o.tail,.5*e.widthOfOneDigit)+l+(i==u?1:0)*d3.max(s)-(i==u?0:1)*d3.min(s)+(i==u?-1:1)*n(c)-("x"==r)*e.formatter(c).length*e.widthOfOneDigit/2-("y"==r)*e.heightOfOneDigit/2-("x"==r)*parseInt(e.cssMargin.left)-("y"==r)*parseInt(e.cssMargin.bottom);
f>0&&(f=0),p>0&&(p=0),a[c]={x:0,y:0},a[c][r]=("y"==r&&i==u?-1:1)*(f-p)}}),t.forEach(function(o,s){if(0!=s&&s!=t.length-1){var l=Math.abs(n(o)-n(t[t.length-1]))-("y"==r)*(i==h?-1:1)*a[t[t.length-1]][r]-("x"==r)*(i==h?1:-1)*a[t[t.length-1]][r]-("x"==r)*e.widthOfOneDigit/2*e.formatter(o).length-("x"==r)*e.widthOfOneDigit/2*e.formatter(t[t.length-1]).length-("y"==r)*e.heightOfOneDigit*.7-("x"==r)*parseInt(e.cssMargin.left)-("y"==r)*parseInt(e.cssMargin.bottom),c=Math.abs(n(o)-n(t[0]))-("y"==r)*(i==u?-1:1)*a[t[0]][r]-("x"==r)*(i==u?1:-1)*a[t[0]][r]-("x"==r)*e.widthOfOneDigit/2*e.formatter(o).length-("x"==r)*e.widthOfOneDigit/2*e.formatter(t[0]).length-("y"==r)*e.heightOfOneDigit*.7-("x"==r)*parseInt(e.cssMargin.left)-("y"==r)*parseInt(e.cssMargin.bottom);l>0&&(l=0),c>0&&(c=0),a[o]={x:0,y:0},a[o][r]=("y"==r&&i==u?-1:1)*(l-c)}}),a}function c(){var t;a.labelerOptions().isDevMode&&(t=console).log.apply(t,arguments)}var u="vertical axis",h="horizontal axis",d="labels stack side by side",f="labels stack top to bottom",p="optimistic approximation: labels have different lengths",m="pessimistic approximation: all labels have the largest length",g=10;a.highlightValueRun=function(t){z.viewportLength&&"none"!=y&&(a.scale()(y)>z.viewportLength||a.scale()(y)<0)&&(y="none");var e="top"==a.orient()||"bottom"==a.orient()?h:u,i=e==h&&a.pivot()||e==u&&!a.pivot()?"y":"x",n=a.pivot()?-1:1;t.select(".vzb-axis-value").classed("vzb-hidden","none"==y);var r=void 0,o={};"none"!=y&&(r=t.select(".vzb-axis-value").node().getBBox(),o.bump=z.bump,o.formatter=z.formatter,o.viewportLength=z.viewportLength,o.toolMargin=z.toolMargin,o.cssMargin=z.cssMargin,o.widthOfOneDigit=r[a.pivot()?"height":"width"]/z.formatter(y).length,o.heightOfOneDigit=r[a.pivot()?"width":"height"]);var s=("none"==y?{x:0,y:0}:l([y],o,e,a.scale(),i)[y])[i],c=function(t){return"none"==y?"translate(0,0)":"translate("+(e==h?a.scale()(y)+s*n:0)+","+(e==u?a.scale()(y)+s*n:0)+")"},d=function(t,o,l){if("none"==y)return 1;var c=e==h?"width":"height",u=(a.repositionLabels()[t]||{x:0,y:0})[i];return a.hlOpacityScale()(Math.abs(a.scale()(t)+u*n-a.scale()(y)-s*n)-l.getBBox()[c]/2-r[c]/2)};b?(t.select(".vzb-axis-value").transition().duration(b).ease(d3.easeLinear).attr("transform",c),t.select(".vzb-axis-value").select("text").transition("text").delay(b).text("none"==y?"":z.formatter(y)),t.selectAll(".tick:not(.vzb-hidden)").each(function(t,e){d3.select(this).select("text").transition().duration(b).ease(d3.easeLinear).style("opacity",d(t,e,this))})):(t.select(".vzb-axis-value").interrupt().attr("transform",c).transition(),t.select(".vzb-axis-value").select("text").interrupt().text("none"==y?"":z.formatter(y)).transition(),t.selectAll(".tick:not(.vzb-hidden)").each(function(t,e){d3.select(this).select("text").interrupt().style("opacity",d(t,e,this)).transition()})),y=null};var v=d3.scale.linear().domain([0,5]).range([0,1]).clamp(!0);a.hlOpacityScale=function(t){return arguments.length?(v=t,a):v};var y=null;a.highlightValue=function(t){return arguments.length?(y=t,a):y};var b=0;a.highlightTransDuration=function(t){return arguments.length?(b=t,a):b};var _=null;a.repositionLabels=function(t){return arguments.length?(_=t,a):_};var x=!1;a.pivot=function(t){return arguments.length?(x=!!t,a):x};var w=[];a.tickValuesMinor=function(t){return arguments.length?(w=t,a):w};var M={outbound:0,inbound:0};a.tickSizeMinor=function(t,e){return arguments.length?(M={outbound:t,inbound:e||0},c("setting",M),a):M};var z={};return a.labelerOptions=function(t){return arguments.length?(z=t,a):z},a.METHOD_REPEATING="repeating specified powers",a.METHOD_DOUBLING="doubling the value",a.labelFactory=function(t){function e(e,i){return 0==e||0==i?0:(null==i&&(i=t.logBase),Math.log(e)/Math.log(i))}if(null==t&&(t={}),"linear"!=t.scaleType&&"time"!=t.scaleType&&"genericLog"!=t.scaleType&&"log"!=t.scaleType&&"ordinal"!=t.scaleType)return a.ticks(w).tickFormat(null).tickValues(null).tickValuesMinor(null).pivot(null).repositionLabels(null);if("ordinal"==t.scaleType)return a.tickValues(null);null==t.logBase&&(t.logBase=g),null==t.stops&&(t.stops=[1,2,5,3,7,4,6,8,9]),null==t.removeAllLabels&&(t.removeAllLabels=!1),null==t.formatter&&(t.formatter=a.tickFormat()?a.tickFormat():function(t){return t+""}),t.cssLabelMarginLimit=5,null==t.cssMargin&&(t.cssMargin={}),(null==t.cssMargin.left||parseInt(t.cssMargin.left)<t.cssLabelMarginLimit)&&(t.cssMargin.left=t.cssLabelMarginLimit+"px"),(null==t.cssMargin.right||parseInt(t.cssMargin.right)<t.cssLabelMarginLimit)&&(t.cssMargin.right=t.cssLabelMarginLimit+"px"),(null==t.cssMargin.top||parseInt(t.cssMargin.top)<t.cssLabelMarginLimit)&&(t.cssMargin.top=t.cssLabelMarginLimit+"px"),(null==t.cssMargin.bottom||parseInt(t.cssMargin.bottom)<t.cssLabelMarginLimit)&&(t.cssMargin.bottom=t.cssLabelMarginLimit+"px"),null==t.toolMargin&&(t.toolMargin={left:30,bottom:30,right:30,top:30}),null==t.bump&&(t.bump=0),null==t.viewportLength&&(t.viewportLength=0),null==t.pivotingLimit&&(t.pivotingLimit=t.toolMargin[this.orient()]),null==t.showOuter&&(t.showOuter=!1),null==t.limitMaxTickNumber&&(t.limitMaxTickNumber=0);var i="top"==this.orient()||"bottom"==this.orient()?h:u;null==t.isPivotAuto&&(t.isPivotAuto=i==u),null==t.cssFontSize&&(t.cssFontSize="13px"),null==t.widthToFontsizeRatio&&(t.widthToFontsizeRatio=.75),null==t.heightToFontsizeRatio&&(t.heightToFontsizeRatio=1.2),null==t.widthOfOneDigit&&(t.widthOfOneDigit=parseInt(t.cssFontSize)*t.widthToFontsizeRatio),null==t.heightOfOneDigit&&(t.heightOfOneDigit=parseInt(t.cssFontSize)*t.heightToFontsizeRatio),null!=t.fitIntoScale&&"pessimistic"!=t.fitIntoScale||(t.fitIntoScale=m),"optimistic"==t.fitIntoScale&&(t.fitIntoScale=p),c("********** "+i+" **********");var s=a.scale().domain(),d=a.scale().range(),f=(Math.abs(s[s.length-1]-s[0]),Math.abs(d[d.length-1]-d[0])),v=d3.min([s[0],s[s.length-1]]),y=d3.max([s[0],s[s.length-1]]),b=v<=0&&y>=0&&"time"!=t.scaleType,_=t.showOuter?[v,y]:[],x=[],w=5,M=d3.max(d3.range(v,y,(y-v)/17).concat(y).map(function(e){return t.formatter(e).length}))*t.widthOfOneDigit+parseInt(t.cssMargin.left),z=t.isPivotAuto&&(M+a.tickPadding()>t.pivotingLimit&&i==u||!(M+a.tickPadding()>t.pivotingLimit)&&!(i==u)),S=i==h&&z||i==u&&!z,E=!S&&t.heightOfOneDigit>t.pivotingLimit;if(t.removeAllLabels)return a.tickValues([]);if(v==y)return a.tickValues([v]).ticks(1).tickFormat(t.formatter);var k=function(e,i,n,r){if(null==e||e.length<=1)return!0;if(null==n&&(n=m),null==r&&(scaleType="none"),S)return i>e.length*(t.heightOfOneDigit+parseInt(t.cssMargin.top)+parseInt(t.cssMargin.bottom));var o=parseInt(t.cssMargin.left)+parseInt(t.cssMargin.right),s=d3.max(e.map(function(e){return t.formatter(e).length}));return"log"==r?(i=Math.abs(a.scale()(d3.max(e))-a.scale()(d3.min(e))),i>d3.sum(e.map(function(e){return(t.widthOfOneDigit*(n==m?s:t.formatter(e).length)+o)*(1+Math.log(e.toString().replace(/([0.])/g,"")[0])/Math.LN10)}))):i>e.length*o+(n==m?t.widthOfOneDigit*e.length*s:0)+(n==p?t.widthOfOneDigit*e.map(function(e){return t.formatter(e)}).join("").length:0)},T=function(e,i){if(null==i||0==i.length)return!1;i instanceof Array||(i=[i]);for(var n=0;n<i.length;n++)if(e!=i[n]&&0!=e&&Math.abs(a.scale()(e)-a.scale()(i[n]))<(S?t.heightOfOneDigit:(t.formatter(e).length+t.formatter(i[n]).length)*t.widthOfOneDigit/2))return!0;return!1};if("genericLog"==t.scaleType||"log"==t.scaleType){var P=a.scale().eps?a.scale().eps():0,O=b?[0]:[],A=y<P?[]:d3.range(Math.floor(e(Math.max(P,v))),Math.ceil(e(y)),1).concat(Math.ceil(e(y))).map(function(e){return Math.pow(t.logBase,e)}),I=v>-P?[]:d3.range(Math.floor(e(Math.max(P,-y))),Math.ceil(e(-v)),1).concat(Math.ceil(e(-v))).map(function(e){return-Math.pow(t.logBase,e)});if(null==t.method){var C=b?Math.max(Math.abs(y),Math.abs(v))/P:Math.max(Math.abs(y),Math.abs(v))/Math.min(Math.abs(y),Math.abs(v));t.method=10<=C&&C<=1024?this.METHOD_DOUBLING:this.METHOD_REPEATING}t.method==this.METHOD_DOUBLING&&!function(){var t=[];b&&_.push(0);var e=[].concat(_),i=y<P?null:4*A[Math.floor(A.length/2)-1],r=v>-P?null:4*I[Math.floor(I.length/2)-1];if(i)for(var a=i;a<=y;a*=2)t.push(a);if(i)for(var s=i/2;s>=Math.max(v,P);s/=2)t.push(s);if(r)for(var l=r;l>=v;l*=2)t.push(l);if(r)for(var c=r/2;c<=Math.min(y,-P);c/=2)t.push(c);t=t.sort(d3.ascending).filter(function(t){return v<=t&&t<=y}),x=x.concat(t),t=o(t,!1);for(var u=_,h=0;h<t.length;h++){var d=u.concat(t[h]).filter(function(t){return!T(t,e)}).filter(n);if(!k(d,f,m,"none"))break;_=d}}(),t.method==this.METHOD_REPEATING&&!function(){var e=O.concat(A).concat(I).sort(d3.ascending);t.stops.forEach(function(t,i){x=x.concat(e.map(function(e){return e*t}))}),e=o(e);var i=O.concat(_),a=!1;t.stops.forEach(function(o,s){if(0==s){for(var l,c=0;c<e.length;c++){var u=_.concat(e[c].map(function(t){return t*o})).filter(function(t){return!T(t,i)}).filter(function(t){return v<=t&&t<=y}).filter(n);if(!k(u,f,m,"none"))break;_=u}e=(l=[]).concat.apply(l,r(e))}else{if(a)return;var h=_.concat(e.map(function(t){return t*o})).filter(function(t){return v<=t&&t<=y}).filter(n);if(!k(h,f,m,"log"))return void(a=!0);if(_.length>t.limitMaxTickNumber&&0!=t.limitMaxTickNumber)return void(a=!0);_=h}})}()}return"linear"!=t.scaleType&&"time"!=t.scaleType||!function(){b&&_.push(0);var e=[].concat(_);w=S?Math.max(Math.floor(f/(t.heightOfOneDigit+parseInt(t.cssMargin.top))),2):Math.max(Math.floor(f/M),2),0!=t.limitMaxTickNumber&&w>t.limitMaxTickNumber&&(w=t.limitMaxTickNumber);var i=a.scale().ticks(w).sort(d3.ascending).filter(function(t){return v<=t&&t<=y});x=x.concat(i),i=o(i,!1);for(var r=_,s=0;s<i.length;s++){var l=r.concat(i[s]).filter(function(t){return!T(t,e)}).filter(n);if(!k(l,f,t.fitIntoScale,"none"))break;_=l}_=_.filter(function(t){return!T(t,e)}).filter(n)}(),null!=_&&_.length<=2&&!b&&(_=[v,y]),null!=_&&_.length<=3&&b&&(_=T(0,[v,y])?[v,y]:[v,0,y]),null!=_&&_.sort(function(t,e){return(i==h?-1:1)*(a.scale()(e)-a.scale()(t))}),E&&(_=[]),x=x.filter(function(t){return _.indexOf(t)==-1&&v<=t&&t<=y}),c("final result",_),a.ticks(w).tickFormat(t.formatter).tickValues(_).tickValuesMinor(x).pivot(z).repositionLabels(l(_,t,i,a.scale(),S?"y":"x"))},a.copy=function(){return e(d3["axis"+s.capitalize(t)]())},a.orient=function(){return arguments.length?a:t},d3.rebind(a,i,"scale","ticks","tickArguments","tickValues","tickFormat","tickSize","tickSizeInner","tickSizeOuter","tickPadding")}(d3["axis"+s.capitalize(t)]())}Object.defineProperty(e,"__esModule",{value:!0}),e.default=a;var o=i(1),s=n(o)},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var a=i(1),o=r(a),s=i(61),l=n(s),c=i(46),u=(n(c),l.default.extend({_important:!1,objectLeafs:["autogenerate"],dataConnectedChildren:["use","which"],getClassDefaults:function(){var t={data:"data",which:null};return o.deepExtend(this._super(),t)},buildScale:function(){},setInterModelListeners:function(){var t=this,e=this._parent.getSpace(this);o.forEach(e,function(e){t._space[e]=t.getClosestModel(e),t._space[e].on("dataConnectedChange",t.handleDataConnectedChange.bind(t))}),this.getClosestModel("locale").on("dataConnectedChange",this.handleDataConnectedChange.bind(this))},onSuccessfullLoad:function(){this.buildScale(),this._super()},setWhich:function(t){var e={which:t.concept};t.dataSource&&(e.data=t.dataSource);var i=this.getClosestModel(e.data||this.data),n=i.getConceptprops(t.concept);"_default"===t.which?e.use="constant":n.use&&(e.use=n.use),n.scales&&(e.scaleType=n.scales[0]),"axis"!==this.getType()&&"size"!==this.getType()||(e.domainMin=null,e.domainMax=null,e.zoomedMin=null,e.zoomedMax=null),this.set(e)},setScaleType:function(t){this.buildScale(t)},preloadData:function(){return this.dataSource=this.getClosestModel(this.data),this._super()},afterPreload:function(){this.autoGenerateModel()},autoGenerateModel:function(){null==this.which&&this.autogenerate&&(this.which=this.dataSource.getConceptByIndex(this.autogenerate.conceptIndex,this.autogenerate.conceptType).concept)},loadData:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!this.which)return Promise.resolve();this.trigger("hook_change"),this.dataSource=this.getClosestModel(this.data);var e=this.getQuery(t.splashScreen);if(e===!0)return Promise.resolve();this._loadCall=!0,this.setReady(!1),o.timeStamp("Vizabi Model: Loading Data: "+this._id);var i=this._getAllParsers(),n=this.dataSource.load(e,i);return n.then(this.afterLoad.bind(this),function(t){return o.warn("Problem with query: ",t,JSON.stringify(e))}),n},handleDataConnectedChange:function(t){var e=this;o.defer(function(){e.startLoading().catch(o.warn)})},_isLoading:function(){return!this._loadedOnce||this._loadCall},afterLoad:function(t){this._dataId=t,o.timeStamp("Vizabi Model: Data loaded: "+this._id)},getQuery:function(t){var e=void 0;if(Object.keys(this._space).length<1)return o.error("Error:",this._id,"can't find the space"),!0;var i="property"===this.use||"constant"===this.use,n=i?{exceptType:"time"}:{},r=o.unique(this._getAllDimensions(n)),a=i&&r.length>1?[this.spaceRef?this._space[this.spaceRef].dim:this.which]:r;if(a=a.filter(function(t){return"_default"!==t}),!a||!a.length)return o.warn("getQuery() produced no query because no keys are available"),!0;var s={key:a,value:a.indexOf(this.which)!=-1||"constant"===this.use?[]:[this.which]},l=this._getFirstDimension({type:"time"}),c=i?"entities":"datapoints";if(e=this._getAllFilters(n,t),i&&r.length>1){var u={};e[a]&&(u[a]=e[a]),e=u}var h={};if(Object.keys(e).length>0){h.$and=[];for(var d in e){var f={};f[d]=e[d],h.$and.push(f)}}var p=this._getAllJoins(n,t);if(i&&r.length>1){var m={};p["$"+a]&&(m["$"+a]=p["$"+a]),p=m}return{language:this.getClosestModel("locale").id,from:c,animatable:l,select:s,where:h,join:p,order_by:i?["rank"]:[this._space.time.dim]}},_getAllDimensions:function(t){return this._parent._getAllDimensions(t)},_getFirstDimension:function(t){return this._parent._getFirstDimension(t)},_getAllFilters:function(t,e){t=t||{};var i={},n=this;return o.forEach(this._space,function(r){if(t.exceptType&&r.getType()===t.exceptType)return!0;if(t.onlyType&&r.getType()!==t.onlyType)return!0;if(!r.skipFilter)if(o.arrayEquals(n._getAllDimensions(t),[r.getDimension()]))i=o.extend(i,r.getFilter(e));else{var a=r.getFilter(e);if(null!=a&&!o.isEmpty(a)){var s={};s[r.getDimension()]="$"+r.getDimension(),i=o.extend(i,s)}}}),i},_getAllJoins:function(t,e){var i={},n=this;return o.forEach(this._space,function(r){if(t.exceptType&&r.getType()===t.exceptType)return!0;if(t.onlyType&&r.getType()!==t.onlyType)return!0;if(o.arrayEquals(n._getAllDimensions(t),[r.getDimension()]))return!0;if(!r.skipFilter){var a=r.getFilter(e);null==a||o.isEmpty(a)||(i["$"+r.getDimension()]={key:r.getDimension(),where:r.getFilter(e)})}}),i},_getAllParsers:function(){function t(t){var i=t.getParser(),n=t.getDimensionOrWhich();i&&n&&(e[n]=i)}var e={};return o.forEach(this._space,function(e){t(e)}),t(this),e},getTickFormatter:function(){var t=this,e="share",i="percent";return function(n,r,a,s,l){if(l=t.getConceptprops().format,l===e&&(n*=100),o.isDate(n))return t._space.time.formatDate(n);if("time"===t.scaleType&&!o.isDate(n))return t._space.time.formatDate(new Date(n));if(o.isString(n)||!n&&0!==n)return n;if(Math.abs(n)<1e-14)return"0";var c="r",u=3,h="";if(s)return d3.format("."+u+c)(n);switch(Math.floor(Math.log(Math.abs(n))/Math.LN10+1e-14)){case-13:n*=1e12,h="p";break;case-10:n*=1e9,h="n";break;case-7:n*=1e6,h="";break;case-6:n*=1e6,h="";break;case-5:n*=1e6,h="";break;case-4:break;case-3:break;case-2:break;case-1:break;case 0:break;case 1:break;case 2:break;case 3:break;case 4:n/=1e3,h="k";break;case 5:n/=1e3,h="k";break;case 6:n/=1e6,h="M";break;case 7:n/=1e6,h="M";break;case 8:n/=1e6,h="M";break;case 9:n/=1e9,h="B";break;case 10:n/=1e9,h="B";break;case 11:n/=1e9,h="B";break;case 12:n/=1e12,h="TR";break;case 13:n/=1e12,h="TR";break;case 14:n/=1e12,h="TR";break;default:return d3.format("."+u+"s")(n).replace("G","B")}var d=d3.format("."+u+c)(n);return d.indexOf(".")>-1&&(d=d.replace(/0+$/,"").replace(/\.$/,"")),d+h+(l===i||l===e?"%":"")}},getScale:function(){return null==this.scale&&console.warn("scale is null"),this.scale},getUnique:function(t){if(this.isHook())return t||(t=this._getFirstDimension({type:"time"})),this.dataSource.getData(this._dataId,"unique",t)},getData:function(){return this.dataSource.getData(this._dataId)},getValidItems:function(){return this.dataSource.getData(this._dataId,"valid",this.which)},getNestedItems:function(t){return t?this.dataSource.getData(this._dataId,"nested",t):o.warn("No keys provided to getNestedItems(<keys>)")},getHaveNoDataPointsPerKey:function(){return this.dataSource.getData(this._dataId,"haveNoDataPointsPerKey",this.which)},getLimits:function(t){return this.dataSource.getData(this._dataId,"limits",t)},getFrame:function(t,e,i){return this.dataSource.getFrame(this._dataId,t,e,i)},getFrames:function(t,e){return this.dataSource.getFrames(this._dataId,t,e)},getItems:function(){var t=this,e=this.spaceRef&&this._space[this.spaceRef]?this._space[this.spaceRef].dim:t._getFirstDimension({exceptType:"time"}),i={};return this.getValidItems().forEach(function(n){i[n[e]]=n[t.which]}),i},getLimitsByDimensions:function(t){var e=this.dataSource.getData(this._dataId,"nested",t),i={},n=this.which,r=function(t,e,i){for(var r=t.reduce(function(t,e){var i=o.isDate(e[n])?e[n]:parseFloat(e[n]);return isNaN(i)||t.push(i),t},[]),a=void 0,s=void 0,l={},c=0;c<r.length;c+=1){var u=r[c];("undefined"==typeof a||u<a)&&(a=u),("undefined"==typeof s||u>s)&&(s=u)}l.min=a||0,l.max=s||100,e[i]=l},a=function t(e,i,n,r){i--,o.forEach(e,function(e,a){i?(n[a]={},t(e,i,n[a],r)):r(e,n,a)})};return a(e,t.length,i,r),i},getConceptprops:function(){return"constant"!==this.use&&this.dataSource?this.dataSource.getConceptprops(this.which):{}},isDiscrete:function(){return"ordinal"===this.scaleType},validate:function(){this._super();var t=this.getConceptprops().scales;t&&t.length>0&&!t.includes(this.scaleType)&&this.set({scaleType:"nominal"===t[0]?"ordinal":t[0]},null,!1)},getEntity:function(){return this._space[this.spaceRef?this.spaceRef:this._parent.getSpace()[0]]}}));e.default=u},function(t,e,i){var n=i(58)("meta"),r=i(6),a=i(14),o=i(9).f,s=0,l=Object.isExtensible||function(){return!0},c=!i(5)(function(){return l(Object.preventExtensions({}))}),u=function(t){o(t,n,{value:{i:"O"+ ++s,w:{}}})},h=function(t,e){if(!r(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!a(t,n)){if(!l(t))return"F";if(!e)return"E";u(t)}return t[n].i},d=function(t,e){if(!a(t,n)){if(!l(t))return!0;if(!e)return!1;u(t)}return t[n].w},f=function(t){return c&&p.NEED&&l(t)&&!a(t,n)&&u(t),t},p=t.exports={KEY:n,NEED:!1,fastKey:h,getWeak:d,onFreeze:f}},function(t,e){t.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},function(t,e){var i=Math.ceil,n=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?n:i)(t)}},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function a(t){d=!0,t&&(c.isArray(t)||(t=[t]),c.forEach(t,function(t){p[t]=!0}))}function o(){d=!1,p={};for(var t=Object.keys(f),e=0;e<t.length;e++){var i=f[t[e]];i&&i.unfreeze()}f={}}Object.defineProperty(e,"__esModule",{value:!0}),e.ChangeEvent=e.DefaultEvent=void 0;var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},l=i(1),c=r(l),u=i(16),h=n(u),d=!1,f=[],p={},m=e.DefaultEvent=h.default.extend({source:"",type:"default",init:function(t,e){this.source=t,e&&(this.type=e)}}),g=(e.ChangeEvent=m.extend("change",{type:"change",init:function(t){this._super(t)}}),h.default.extend({init:function(){this._id=this._id||c.uniqueId("e"),this._events={},this._freeze=!1,this._freezer=[],this._freezeExceptions={}},on:function(t,e,i){if(!this.splitEventParameters(t,e,i,this.on)){var n=this.traversePath(e);n&&(n._events[t]=n._events[t]||[],"function"==typeof i?n._events[t].push(i):c.warn("Can't bind event '"+t+"'. It must be a function."))}},off:function(t,e,i){if(0==arguments.length)return void(this._events={});if(!this.splitEventParameters(t,e,i,this.off)){var n=this.traversePath(e);if(n&&n._events.hasOwnProperty(t)){if("undefined"==typeof i)return void(n._events[t]=[]);var r=n._events[t].indexOf(i);r>-1?n._events[t].splice(r,1):c.warn("Could not unbind function "+i.name+". Function not in bound function list.")}}},splitEventParameters:function(t,e,i,n){var r=void 0;if(c.isArray(t)){for(r=0;r<t.length;r+=1)n.call(this,t[r],i);return!0}if(c.isObject(t)){for(r in t)n.call(this,r,t[r]);return!0}if("function"==typeof e){if(i=e,t.indexOf(":")!==-1){var a=t.split(":");t=a[0],e=a[1]}else e=void 0;return n.call(this,t,e,i),!0}if(c.isArray(e)){for(r=0;r<e.length;r+=1)n.call(this,t,e[r],i);return!0}if(i&&c.isArray(i)){for(r=0;r<i.length;r+=1)n.call(this,t,e,i[r]);return!0}return!1},traversePath:function(t){if("undefined"==typeof t||c.isArray(t)&&0==t.length)return this;if("string"==typeof t&&(t=t.split(".")),!c.isArray(t))return c.error("Path is wrong type. Path should be a string or array but is "+("undefined"==typeof t?"undefined":s(t))+"."),null;var e=t.shift();return void 0!==this[e]?this.getModelObject(e).traversePath(t):void c.warn("Can't find child \""+e+'" of the model '+this._name+".")},createEventFromType:function(t){if(t instanceof m)return t;var e=m.get(t,!0);return e?new e(this):new m(this,t)},trigger:function(t,e){var i=this,n=void 0,r=void 0;if(c.isArray(t))for(n=0,r=t.length;n<r;n+=1)this.trigger(t[n],e);else{var a=this.createEventFromType(t);if(this._events.hasOwnProperty(a.type)){var o=this;c.forEach(this._events[a.type],function(t){var n=function(){var i="Vizabi Event: "+a.type;c.timeStamp(i),t.apply(o,[a,e])};i.allowExecution(a)?n():(i._freezer.push(n),d&&!f[i._id]&&(i.freeze(),f[i._id]=i))})}}},allowExecution:function(t){return!this._freeze&&!d||d&&p.hasOwnProperty(t.type)||!d&&this._freeze&&this._freezeExceptions.hasOwnProperty(t.type)},freeze:function(t){if(this._freeze=!0,t){c.isArray(t)||(t=[t]);for(var e=0;e<t.length;e+=1)this._freezeExceptions[t[e]]=!0}},unfreeze:function(){for(this._freeze=!1,this._freezeExceptions={};this._freezer.length;){var t=this._freezer.shift();t()}},clearFrozen:function(){this._freeze=!1,this._freezeExceptions={},this._freezer=[]}}));g.freezeAll=a,g.unfreezeAll=o,e.default=g},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function a(t,e){Object.defineProperty(t,e,{configurable:!0,get:function(e){return function(){return t.get(e)}}(e),set:function(e){return function(i){return t.set(e,i)}}(e)})}function o(t,e,n,r){function a(t,e){n._ready&&(e=n._name+"."+e,n.trigger(t,e))}function o(t,e){n.trigger(t,e)}function s(t,e){n.setReady(!1),c.defer(function(){n.setReady()})}var l=void 0;if(!c.isPlainObject(e)||c.isArray(e)||n.isObjectLeaf(t)){var u={change:a};l=new p(t,e,n,u,r)}else{var h={change:a,hook_change:o,load_error:function(){return n.trigger.apply(n,arguments)},ready:s};if(m.isModel(e,!0))l=e,l.on(h);else{var d=t.split("_")[0],f=m.get(d,!0);if(!f)try{f=i(476)("./"+d).default}catch(t){f=m}l=new f(t,e,n,h)}}return l}function s(t){return t._intervals||(t._parent?s(t._parent):new f.default)}Object.defineProperty(e,"__esModule",{value:!0});var l=i(1),c=r(l),u=i(46),h=n(u),d=i(208),f=n(d),p=h.default.extend({_name:"",_parent:null,_persistent:!0,init:function(t,e,i,n,r){Object.defineProperty(this,"value",{get:this.get,set:this.set}),Object.defineProperty(this,"persistent",{get:function(){return this._persistent}}),this._super(),this._name=t,this._parent=i,this._root=i._root,this.set(e,!1,r),this.on(n)},get:function(t){return t&&!this._persistent?this._persistentVal:this._val},set:function(t,e,i){return!!this.isSetAllowed(t,e)&&(i="undefined"==typeof i||i,i&&(this._persistentVal=t),this._previousVal=c.deepClone(this._val),this._val=t,this._persistent=i,this.trigger(new u.ChangeEvent(this),this._name),!0)},isSetAllowed:function(t,e){return e||this._val!==t&&JSON.stringify(this._val)!==JSON.stringify(t)},setTreeFreezer:function(t){t?this.freeze(["hook_change"]):this.unfreeze()}}),m=h.default.extend({getClassDefaults:function(){return{}},objectLeafs:[],init:function(t,e,i,n){this._type=this._type||"model",this._id=this._id||c.uniqueId("m"),this._data={},this._parent=i,this._root=i?i._root:this,this._name=t,this._ready=!1,this._readyOnce=!1,this._loadedOnce=!1,this._intervals=s(this),this._space={},this._dataId=!1,this._limits={},this._super();var r=c.deepExtend({},this.getClassDefaults(),e);this.set(r),n&&this.on(n)},get:function(t){if(t){var e=this._data[t];return m.isModel(e)?e:e.value}return this._data},set:function(t,e,i,n){var r=this._setting,s=void 0,l=!1;if(c.isPlainObject(t)?(s=t,n=i,i=e):(s={})[t]=e,0!==Object.keys(s).length){this._setting=!0,this._freeze||(l=!0,this.setTreeFreezer(!0));var u=[];for(var h in s){e=s[h];var d=c.isPlainObject(e)&&this._data[h]instanceof m,f=(!c.isPlainObject(e)||this.isObjectLeaf(h))&&this._data[h]instanceof p;if(this._data[h]&&(d||f)){var g=this._data[h].set(e,i,n);f&&g&&u.push(h)}else this._data[h]=o(h,e,this,n),a(this,h)}r||(this.checkDataChanges(u),this.validate&&this.validate()),r&&!i||(this._setting=!1,!l||this.isHook()&&this.isLoading()||this.setTreeFreezer(!1),this.isHook()||this.isLoading()||this.setReady())}},checkDataChanges:function(){},setTreeFreezer:function(t){c.forEach(this._data,function(e){e.setTreeFreezer(t)}),t?this.freeze(["hook_change"]):this.unfreeze()},getType:function(){return this._type},getSubmodels:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){return!0},i=t?{}:[];return c.forEach(this._data,function(n,r){n&&"undefined"!=typeof n._id&&m.isModel(n)&&e(n)&&(t?i[r]=n:i.push(n))}),i},getPlainObject:function(t){var e={},i=this;return c.forEach(this._data,function(n,r){if(n instanceof m)e[r]=n.getPlainObject(t);else if(!t||n.persistent){var a=n.get(t);c.isDate(a)&&(a=i.formatDate(a)),e[r]=a}}),e},formatDate:function(t){return t.toString()},getModelObject:function(t){return t?this._data[t]:this},clear:function(){var t=this.getSubmodels();for(var e in t)t[e].clear();this.setReady(!1),this.off(),this._intervals.clearAllIntervals(),this._data={}},validate:function(){},_isLoading:function(){return!1},isLoading:function(){if(this._isLoading())return!0;var t=this.getSubmodels(),e=void 0;for(e=0;e<t.length;e+=1)if(t[e].isLoading())return!0;return!1},setReady:function(t){if(t===!1)return this._ready=!1,void(this._parent&&this._parent.setReady&&this._parent.setReady(!1));var e=this._ready;this._ready=!this.isLoading()&&!this._setting,this._ready&&e!==this._ready&&(this._readyOnce||(this._readyOnce=!0,this.trigger("readyOnce")),this.trigger("ready"))},setInterModelListeners:function(){c.forEach(this.getSubmodels(),function(t){return t.setInterModelListeners()})},startPreload:function(){var t=[];return t.push(this.preloadData()),c.forEach(this.getSubmodels(),function(e){return t.push(e.startPreload())}),Promise.all(t)},preloadData:function(){return Promise.resolve()},startLoading:function(t){var e=this,i=[];return i.push(this.loadData(t)),c.forEach(this.getSubmodels(),function(e){return i.push(e.startLoading(t))}),Promise.all(i).then(this.onSuccessfullLoad.bind(this)).catch(function(t){var i=e.getClosestModel("locale").getTFunction();e.triggerLoadError([i("crash/error"),window.navigator.userAgent,t].join("<br>"))})},loadData:function(t){return this.isHook()&&c.warn("Hook "+this._name+" is not loading because it's not extending Hook prototype."),Promise.resolve()},loadSubmodels:function(t){var e=[],i=this.getSubmodels();return c.forEach(i,function(i){e.push(i.startLoading(t))}),e.length>0?Promise.all(e):Promise.resolve()},onSuccessfullLoad:function(){var t=this;this.validate(),c.timeStamp("Vizabi Model: Model loaded: "+this._name+"("+this._id+")"),this._loadedOnce=!0,this._loadCall=!1,this.setTreeFreezer(!1),c.defer(function(){return t.setReady()})},triggerLoadError:function(t){c.error(t),this.trigger("load_error",t)},afterPreload:function(){var t=this.getSubmodels();c.forEach(t,function(t){t.afterPreload()})},isHook:function(){return Boolean(this.use)},getSubhooks:function(t){return this.getSubmodels(t,function(t){return t.isHook()})},getHookWhich:function(t){var e=[];return this.use&&this.use===t&&e.push(this.which),c.forEach(this.getSubmodels(),function(i){e=c.unique(e.concat(i.getHookWhich(t)))}),e},getIndicators:function(){return this.getHookWhich("indicator")},getProperties:function(){return this.getHookWhich("property")},getDimension:function(){return this.dim||!1},getDimensionOrWhich:function(){return this.dim||"constant"!=this.use&&this.which},getFilter:function(){return{}},mapValue:function(t){return t},getParser:function(){return null},getDefaults:function(){return c.deepExtend({},this.getClassDefaults(),this.getSubmodelDefaults())},getSubmodelDefaults:function(){var t={};return c.forEach(this.getSubmodels(!0),function(e,i){t[i]=e.getDefaults()}),t},isObjectLeaf:function(t){return this.objectLeafs.indexOf(t)!==-1},getClosestModel:function(t){var e=this.findSubmodel(t);return e?e:this._parent?this._parent.getClosestModel(t):null},findSubmodel:function(t){for(var e in this._data)if(e===t&&m.isModel(this._data[e]))return this._data[e];return null}});m.isModel=function(t,e){return t&&(t.hasOwnProperty("_data")||e&&t.hasOwnProperty("_val"))},e.default=m},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var a=i(1),o=r(a),s=i(2),l=n(s),c=i(10),u=l.default.extend({init:function(t,e){this.name="gapminder-indicatorpicker",this.template='<span class="vzb-ip-holder"><span class="vzb-ip-select"></span><span class="vzb-ip-info"></span></span>';var i=this;this.model_expects=[{name:"time",type:"time"},{name:"entities",type:"entities"},{name:"marker",type:"model"},{name:"locale",type:"locale"}],this.markerID=t.markerID,this.showHoverValues=t.showHoverValues||!1,t.markerID||o.warn("indicatorpicker.js complains on 'markerID' property: "+t.markerID),this.model_binds={"translate:locale":function(t){i.updateView()},ready:function(t){i.updateView()}},this.markerID&&(this.model_binds["change:marker."+this.markerID+".which"]=function(t){i.updateView()}),this.showHoverValues&&(this.model_binds["change:marker.highlight"]=function(t,e){var n=i.model.marker[i.markerID];if(i.showHoverValues&&"constant"!=n.use){var r=i.model.marker.getHighlighted();r.length>1||(r.length?i.model.marker.getFrame(i.model.time.value,function(t){if(!i._highlighted&&t){var e=i.model.entities.getDimension(),r=i.model.marker.getHighlighted(e);if(r.length){var a=t[i.markerID][r[0]];if(a&&"color"===n._type&&n.isDiscrete()){var o=n.getColorlegendMarker();o.label.getItems()[a]&&(a=o.label.getItems()[a])}i._highlightedValue=a,i._highlighted=!i._highlightedValue&&0!==i._highlightedValue||"constant"!==n.use,i.updateView()}}}):(null!==e&&"highlight"!==e?e&&(i._highlightedValue=e[i.markerID],i._highlighted=!i._highlightedValue&&0!==i._highlightedValue||"constant"!==n.use):i._highlighted=!1,i.updateView()))}}),this._super(t,e)},ready:function(){this.updateView()},readyOnce:function(){var t=this;this.el_select=d3.select(this.element).select(".vzb-ip-select"),this.el_select.on("click",function(){
var e=t.el_select.node().getBoundingClientRect(),i=t.root.element instanceof Array?t.root.element:d3.select(t.root.element),n=i.node().getBoundingClientRect(),r=t.root.findChildByName("gapminder-treemenu"),a=r.activeProfile.col_width,o=parseInt(r.wrapper.style("padding-left"),10)||0,s=parseInt(r.wrapper.style("padding-right"),10)||0,l=e.bottom-n.top,c=e.left-n.left-.5*(o+s+a-e.width);r.markerID(t.markerID).alignX("left").alignY("top").top(l).left(c).updateView().toggle()}),this.infoEl=d3.select(this.element).select(".vzb-ip-info"),o.setIcon(this.infoEl,c.question).select("svg").attr("width","0px").attr("height","0px"),this.infoEl.on("click",function(){t.root.findChildByName("gapminder-datanotes").pin()}),this.infoEl.on("mouseover",function(){var e=t.el_select.node().getBoundingClientRect(),i=t.root.element.getBoundingClientRect(),n=e.bottom-i.top,r=e.left-i.left+e.width;t.root.findChildByName("gapminder-datanotes").setHook(t.markerID).show().setPos(r,n)}),this.infoEl.on("mouseout",function(){t.root.findChildByName("gapminder-datanotes").hide()})},updateView:function(){if(this._readyOnce){var t=this,e=this.model.locale.getTFunction(),i=this.model.marker[this.markerID].which,n=this.model.marker[this.markerID]._type,r=this.model.marker[this.markerID].getConceptprops(),a=void 0;if(this.showHoverValues&&this._highlighted){var o=r.unit?" "+r.unit:"",s=t.model.marker[this.markerID].getTickFormatter();a=this._highlightedValue||0===this._highlightedValue?s(this._highlightedValue)+o:e("hints/nodata")}else a="_default"===i?e("indicator/_default/"+n):r.name;this.el_select.text(a);var l=!r.description&&!r.sourceName&&!r.sourceLink;this.infoEl.classed("vzb-hidden",l)}}});e.default=u},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var r=i(2),a=n(r),o=i(1),s=a.default.extend({init:function(t,e){var n=this;this.name="steppedSlider",this.template=i(455),this.config=Object.assign({triangleWidth:10,triangleHeight:10,height:31,lineWidth:10,domain:[1,2,3,4,5,6],range:[1200,900,450,200,150,100]},t),this.config.height-=this.config.triangleHeight/2,this.model_expects=[{name:"time",type:"time"},{name:"locale",type:"locale"}],this.model_binds={"change:time.delay":function(){n.redraw()}},this.setDelay=(0,o.throttle)(this.setDelay,50),this._super(t,e)},readyOnce:function(){var t=this.config,e=t.domain,i=t.range,n=t.height;this.element=d3.select(this.element),this.svg=this.element.select("svg"),this.axisScale=d3.scale.log().domain(d3.extent(e)).range([n,0]),this.delayScale=d3.scale.linear().domain(e).range(i),this.initTriangle(),this.initAxis(),this.redraw()},initAxis:function(){var t=this,e=this.config,i=e.lineWidth,n=e.triangleWidth,r=e.triangleHeight,a=e.height,s=d3.axisLeft().scale(this.axisScale).tickFormat(function(){return""}).tickSizeInner(i).tickSizeOuter(0),l=n+i/2,c=r/2;this.svg.on("mousedown",function(){var e=d3.event.offsetY,i=Math.max(0,Math.min(e-c,a));t.setDelay(Math.round(t.delayScale(t.axisScale.invert(i))),!0,!0)}).select(".vzb-stepped-speed-slider-axis").attr("transform","translate("+l+", "+c+")").call(s),this.drag=d3.drag().on("drag",function(){var e=d3.event.dy,i=(0,o.transform)(t.slide.node()),n=i.translateY,r=Math.max(0,Math.min(e+n,a));t.setDelay(Math.round(t.delayScale(t.axisScale.invert(r)))),t.redraw(r)}).on("end",function(){t.setDelay(t.model.time.delay,!0,!0)}),this.svg.call(this.drag)},initTriangle:function(){var t=this.config;t.triangleWidth,t.triangleHeight,t.lineWidth;this.slide=this.svg.select(".vzb-stepped-speed-slider-triangle"),this.slide.append("g").append("path").attr("d",this.getTrianglePath())},getTrianglePath:function(){var t=this.config,e=t.triangleHeight,i=t.triangleWidth;return"M "+i+","+e/2+" 0,"+e+" 0,0 z"},setDelay:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.model.time.set("delay",t,e,i)},redraw:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.axisScale(this.delayScale.invert(this.model.time.delay));this.slide.attr("transform","translate(0, "+t+")")}});e.default=s},function(t,e){t.exports=function(t,e,i,n){if(!(t instanceof e)||void 0!==n&&n in t)throw TypeError(i+": incorrect invocation!");return t}},function(t,e){t.exports=!1},function(t,e,i){var n=i(3),r=i(167),a=i(94),o=i(106)("IE_PROTO"),s=function(){},l="prototype",c=function(){var t,e=i(93)("iframe"),n=a.length,r="<",o=">";for(e.style.display="none",i(96).appendChild(e),e.src="javascript:",t=e.contentWindow.document,t.open(),t.write(r+"script"+o+"document.F=Object"+r+"/script"+o),t.close(),c=t.F;n--;)delete c[l][a[n]];return c()};t.exports=Object.create||function(t,e){var i;return null!==t?(s[l]=n(t),i=new s,s[l]=null,i[o]=t):i=c(),void 0===e?i:r(i,e)}},function(t,e,i){var n=i(169),r=i(94).concat("length","prototype");e.f=Object.getOwnPropertyNames||function(t){return n(t,r)}},function(t,e,i){var n=i(169),r=i(94);t.exports=Object.keys||function(t){return n(t,r)}},function(t,e,i){var n=i(19);t.exports=function(t,e,i){for(var r in e)n(t,r,e[r],i);return t}},function(t,e,i){"use strict";var n=i(4),r=i(9),a=i(8),o=i(7)("species");t.exports=function(t){var e=n[t];a&&e&&!e[o]&&r.f(e,o,{configurable:!0,get:function(){return this}})}},function(t,e,i){var n=i(45),r=Math.max,a=Math.min;t.exports=function(t,e){return t=n(t),t<0?r(t+e,0):a(t,e)}},function(t,e){var i=0,n=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++i+n).toString(36))}},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var r=i(2),a=n(r);e.default=a.default.extend({init:function(t,e){this.template='<span class="vzb-sc-holder vzb-dialog-checkbox"><input type="checkbox"><label></label></span>';var i=this;this.name="gapminder-simplecheckbox",this.checkbox=t.checkbox,this.submodel=t.submodel,this.model_expects=[{name:"mdl"},{name:"locale",type:"locale"}],this.model_binds={"change:mdl":function(t){i.updateView()},"translate:locale":function(t){i.updateView()}};var n=this.submodel?this.submodel+":":"";this.model_binds["change:mdl."+n+this.checkbox]=function(){i.updateView()},this._super(t,e)},ready:function(){this.parentModel=this.submodel?this.model.mdl[this.submodel]:this.model.mdl,this.updateView()},readyOnce:function(){var t=this;this.element=d3.select(this.element);var e="-check-"+t._id;this.labelEl=this.element.select("label").attr("for",e),this.checkEl=this.element.select("input").attr("id",e).on("change",function(){t._setModel(d3.select(this).property("checked"))})},updateView:function(){this.translator=this.model.locale.getTFunction(),this.labelEl.text(this.translator("check/"+this.checkbox)),this.checkEl.property("checked",!!this.parentModel[this.checkbox])},_setModel:function(t){this.parentModel[this.checkbox]=t}})},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){var i=[],n=!0,r=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done)&&(i.push(o.value),!e||i.length!==e);n=!0);}catch(t){r=!0,a=t}finally{try{!n&&s.return&&s.return()}finally{if(r)throw a}}return i}return function(e,i){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=i(16),o=n(a);e.default=o.default.extend({init:function(t,e){this.context=t,this.context.classed("vzb-dynamic-background",!0),this.width=0,this.height=0,this.topOffset=0,this.leftOffset=0,this.bottomOffset=0,this.rightOffset=0,this.textWidth=0,this.textHeight=0,this.widthRatio=.9,this.heightRatio=.9,this.xAlign="center",this.yAlign="center",this.element=this.context.append("text").style("font-size","20px"),e&&this.setConditions(e)},setConditions:function(t){return!isNaN(parseFloat(t.rightOffset))&&isFinite(t.rightOffset)&&(this.rightOffset=t.rightOffset),!isNaN(parseFloat(t.leftOffset))&&isFinite(t.leftOffset)&&(this.leftOffset=t.leftOffset),!isNaN(parseFloat(t.topOffset))&&isFinite(t.topOffset)&&(this.topOffset=t.topOffset),!isNaN(parseFloat(t.bottomOffset))&&isFinite(t.bottomOffset)&&(this.bottomOffset=t.bottomOffset),t.xAlign&&(this.xAlign=t.xAlign),t.yAlign&&(this.yAlign=t.yAlign),!isNaN(parseFloat(t.widthRatio))&&t.widthRatio>0&&t.widthRatio<=1&&(this.widthRatio=t.widthRatio),!isNaN(parseFloat(t.heightRatio))&&t.heightRatio>0&&t.heightRatio<=1&&(this.heightRatio=t.heightRatio),this},resize:function(t,e,i,n){var a=[t,e].map(function(t){return Number(String(t).replace("px",""))}),o=r(a,2);this.width=o[0],this.height=o[1],i&&(this.topOffset=i),n&&(this.leftOffset=n),this._resizeText()},setText:function(t,e){var i=this;return setTimeout(function(){i.element.text(t),i._resizeText()},e),this},_resizeText:function(){var t=this.element.node().getBBox();if(!(t.width&&t.height&&this.width&&this.height))return this;var e=this.width*this.widthRatio/t.width,i=this.height*this.heightRatio/t.height;switch(this.scalar=e<i?e:i,this.element.attr("transform","scale("+this.scalar+")"),this.textHeight=t.height*this.scalar,this.textWidth=t.width*this.scalar,this.yAlign){case"bottom":this.context.select("text").attr("dy",".325em");break;case"center":this.context.select("text").attr("dy",".325em");break;case"top":this.context.select("text").attr("dy","0")}return this.context.attr("transform","translate("+this._getLeftOffset()+","+this._getTopOffset()+")"),this},_getLeftOffset:function(){switch(this.xAlign){case"right":return this.width-this.textWidth/2-this.rightOffset;case"left":return this.textWidth/2+this.leftOffset;default:return this.width/2}},_getTopOffset:function(){switch(this.yAlign){case"top":return this.textHeight/2+this.topOffset;case"bottom":return this.height-this.textHeight/2-this.bottomOffset;default:return this.height/2}}})},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var a=i(1),o=r(a),s=i(47),l=n(s),c=i(46),u=(n(c),l.default.extend({dataConnectedChildren:[],checkDataChanges:function(t){var e=this;if(t&&this.dataConnectedChildren&&(!o.isArray(t)&&o.isObject(t)&&(t=Object.keys(t)),0!=t.length&&0!=this.dataConnectedChildren.length)){var i=t.filter(function(t){return e.dataConnectedChildren.indexOf(t)!==-1});i.length>0&&(this.trigger("dataConnectedChange"),this.startLoading())}}}));e.default=u},function(t,e,i){var n=i(7)("unscopables"),r=Array.prototype;void 0==r[n]&&i(18)(r,n,{}),t.exports=function(t){r[n][t]=!0}},function(t,e,i){var n=i(37),r=i(163),a=i(98),o=i(3),s=i(12),l=i(115),c={},u={},e=t.exports=function(t,e,i,h,d){var f,p,m,g,v=d?function(){return t}:l(t),y=n(i,h,e?2:1),b=0;if("function"!=typeof v)throw TypeError(t+" is not iterable!");if(a(v)){for(f=s(t.length);f>b;b++)if(g=e?y(o(p=t[b])[0],p[1]):y(t[b]),g===c||g===u)return g}else for(m=v.call(t);!(p=m.next()).done;)if(g=r(m,y,p.value,e),g===c||g===u)return g};e.BREAK=c,e.RETURN=u},function(t,e){t.exports={}},function(t,e,i){var n=i(9).f,r=i(14),a=i(7)("toStringTag");t.exports=function(t,e,i){t&&!r(t=i?t:t.prototype,a)&&n(t,a,{configurable:!0,value:e})}},function(t,e,i){var n=i(0),r=i(29),a=i(5),o=i(111),s="["+o+"]",l="",c=RegExp("^"+s+s+"*"),u=RegExp(s+s+"*$"),h=function(t,e,i){var r={},s=a(function(){return!!o[t]()||l[t]()!=l}),c=r[t]=s?e(d):o[t];i&&(r[i]=c),n(n.P+n.F*s,"String",r)},d=h.trim=function(t,e){return t=String(r(t)),1&e&&(t=t.replace(c,"")),2&e&&(t=t.replace(u,"")),t};t.exports=h},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var a=i(2),o=r(a),s=i(1),l=n(s),c=o.default.extend({init:function(t,e){this.template='<div class="vzb-ss-holder"><input type="range" class="vzb-ss-slider vzb-ss-slider-normal" step="1"></div>',this.model_expects=[{name:"submodel"}];var i=this;this.name="gapminder-simpleSlider",this.arg=t.arg,this.thumb_size=t.thumb_size,this.slider_properties=t.properties,this.model_binds={},this.model_binds["change:submodel."+this.arg]=function(t){i.updateView()},this._super(t,e),this._setModel=l.throttle(this._setModel,50)},readyOnce:function(){var t=0,e=1,i=.1,n=t,r=this;this.element=d3.select(this.element),this.slider=this.element.selectAll(".vzb-ss-slider"),this.elementSize=this.element.node().getBoundingClientRect(),this.sliderSize=this.slider.node().getBoundingClientRect(),this.slider.style("left",this.elementSize.left-this.sliderSize.left+"px"),this.slider_properties&&(null!=this.slider_properties.min&&(t=this.slider_properties.min),null!=this.slider_properties.max&&(e=this.slider_properties.max),null!=this.slider_properties.step&&(i=this.slider_properties.step),this.slider_properties.scale&&(n=this.slider_properties.scale(t))),this.roundTo=i>1?0:Math.round(Math.abs(Math.log(i)/Math.LN10)),this.thumb_size&&(this.slider.classed("vzb-ss-slider-normal",!1),this.slider.classed("vzb-ss-slider-"+this.thumb_size,!0)),this.slider.attr("min",t).attr("max",e).attr("step",i).attr("value",n).on("input",function(){var t=+d3.event.target.value;r._setModel(t,!1,!1)}).on("change",function(){var t=+d3.event.target.value;r._setModel(t,!0)}).on("touchstart",function(){r.scrollAncestor=l.findScrollableAncestor(d3.event.target),d3.select(r.scrollAncestor).style("pointer-events","none")}).on("touchend touchcancel",function(){d3.select(r.scrollAncestor).style("pointer-events",null)}),this.updateView()},updateView:function(){var t=this.model.submodel[this.arg],e=this.slider_properties,i=void 0;e&&(i=e.scale),i&&(t=i.invert(t)),this.slider.node().value=t},_setModel:function(t,e,i){this.slider_properties&&this.slider_properties.scale&&(t=this.slider_properties.scale(t)),this.model.submodel.getModelObject(this.arg).set(t.toFixed(this.roundTo),e,i)}});e.default=c},function(t,e,i){var n=i(28),r=i(7)("toStringTag"),a="Arguments"==n(function(){return arguments}()),o=function(t,e){try{return t[e]}catch(t){}};t.exports=function(t){var e,i,s;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(i=o(e=Object(t),r))?i:a?n(e):"Object"==(s=n(e))&&"function"==typeof e.callee?"Arguments":s}},function(t,e,i){var n=i(28);t.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==n(t)?t.split(""):Object(t)}},function(t,e){e.f={}.propertyIsEnumerable},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=function(t){return t.match(/\//g).length},r=function(t,e){var i=t.keys();return e&&(i=i.filter("function"==typeof e?function(t){return e(n(t))}:function(t){return n(t)===e+1})),i.reduce(function(e,i){var n=/([^\/]+)\..+$/.exec(i)[1];try{var r=t(i);e[n]=r.default||r}catch(t){console.warn("Import error",i,t)}return e},{})};e.default=r},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o=function(){function t(t,e){var i=[],n=!0,r=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done)&&(i.push(o.value),!e||i.length!==e);n=!0);}catch(t){r=!0,a=t}finally{try{!n&&s.return&&s.return()}finally{if(r)throw a}}return i}return function(e,i){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),s=i(1),l=r(s),c=i(16),u=n(c),h=u.default.extend({QUERY_FROM_CONCEPTS:"concepts",QUERY_FROM_DATAPOINTS:"datapoints",QUERY_FROM_ENTITIES:"entities",CONDITION_CALLBACKS:{$gt:function(t,e){return e>t},$gte:function(t,e){return e>=t},$lt:function(t,e){return e<t},$lte:function(t,e){return e<=t},$in:function(t,e){return t.includes(e)}},ERRORS:{GENERIC_ERROR:"reader/error/generic"},_name:"reader",load:function(){return Promise.resolve({data:[],columns:[]})},read:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t=this._normalizeQuery(t,i);var n=t,r=n.select,a=n.from,s=n.order_by,l=void 0===s?[]:s,c=o(l,1),u=c[0];return this.load().then(function(n){var o=n.data,s=n.columns;switch(e.ensureDataIsCorrect(n,i),!0){case a===e.QUERY_FROM_CONCEPTS:return e._getConcepts(s,o.map(e._getRowMapper(t,i)));case e._isDataQuery(a)&&r.key.length>0:return o.reduce(e._applyQuery(t,i),[]).sort(function(t,e){return t[u]-e[u]});default:return[]}}).catch(function(t){throw"[object Error]"==={}.toString.call(t)?e.error(e.ERRORS.GENERIC_ERROR,t):t})},ensureDataIsCorrect:function(){},_normalizeQuery:function(t,e){var i=Object.assign({},t),n=i.where,r=i.join;return n.$and&&(n.$and=n.$and.reduce(function(t,i){return Object.keys(i).forEach(function(n){var o=i[n];if("string"==typeof o&&o.startsWith("$"))!function(){var i=r[o].where;Object.keys(i).forEach(function(n){var r=i[n],o=e[n];t[n]=o?"object"===("undefined"==typeof r?"undefined":a(r))?Object.keys(r).reduce(function(t,e){return t[e]=o(r[e]),t},{}):o(r):r})}();else{var s=e[n];t[n]=s?s(o):o}}),t},{})),i},_getConcepts:function(t,e){var i=this;return t.map(function(n,r){var a={concept:n};if(r<i.keySize)a.concept_type="entity_domain";else if(r===i.keySize)a.concept_type="time";else{a.concept_type="measure";for(var s=e.length-1;s>=0;s--)if(l.isString(e[s][n])&&""!==e[s][n]){a.concept_type="entity_set";var c=o(t,1);a.domain=c[0];break}}return a})},_isDataQuery:function(t){return[this.QUERY_FROM_DATAPOINTS,this.QUERY_FROM_ENTITIES].includes(t)},_getRowMapper:function(t,e){var i=t.select;return function(t){var n=!0,r=Object.keys(t).reduce(function(r,a){if(n){var o=t[a],s=e[a],l=void 0;if(s)l=s(o);else{var c=parseFloat(o);l=!isNaN(c)&&isFinite(c)?parseFloat(o.replace(",",".")):o}l||0===l?r[a]=l:i.key.includes(a)&&(n=!1)}return r},{});return n&&r}},_applyQuery:function(t,e){var i=this,n=t.select,r=t.from,a=o(n.key,1),s=a[0],l=[],c=this._getRowMapper(t,e);return function(e,a){if(a=c(a)){var o=a[s],u=r!==i.QUERY_FROM_ENTITIES||!l.includes(o),h=i._isSuitableRow(t,a);if(h&&u){r===i.QUERY_FROM_ENTITIES&&l.push(o);var d=Object.keys(a).reduce(function(t,e){return(n.key.includes(e)||n.value.includes(e))&&(t[e]=a[e]),t},{});e.push(d)}}return e}},_isSuitableRow:function(t,e){var i=this,n=t.where;return!n.$and||Object.keys(n.$and).every(function(t){var r=n.$and[t],o=e[t];return void 0===o||("object"!==("undefined"==typeof r?"undefined":a(r))?o===r||r===!0&&l.isString(o)&&"true"===o.toLowerCase().trim()||r===!1&&l.isString(o)&&"false"===o.toLowerCase().trim():Object.keys(r).every(function(t){return i.CONDITION_CALLBACKS[t](r[t],o)}))})},error:function(t,e,i){return{code:t,message:e,payload:i}}});e.default=h},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var a=i(1),o=r(a),s=i(16),l=n(s),c=i(10),u=function(t){return function(){function e(t){return t.call(s).each(function(t,e){var i=d3.select(this);i.append("rect").attr("class","vzb-label-glow").attr("filter","url("+location.pathname+"#vzb-glow-filter)"),i.append("rect").attr("class","vzb-label-fill vzb-tooltip-border"),i.append("text").attr("class",a+"-label-content "+a+"-label-shadow vzb-noexport"),i.append("text").attr("class",a+"-label-content");var n=i.append("g").attr("class",a+"-label-x vzb-transparent");o.setIcon(n,c.close),n.insert("circle","svg"),n.select("svg").attr("class",a+"-label-x-icon").attr("width","0px").attr("height","0px"),n.on("click",function(){d3.event.defaultPrevented||(d3.event.stopPropagation(),r.model.marker.clearHighlighted(),r.model.marker.selectMarker(t))})}).on("mouseover",function(t){if(!o.isTouchDevice()){r.model.marker.highlightMarker(t);var e=r.KEY||r.model.entities.getDimension();r.entityLabels.sort(function(i,n){return i[e]!=t[e]?-1:1}),d3.select(this).selectAll("."+a+"-label-x").classed("vzb-transparent",!1)}}).on("mouseout",function(t){o.isTouchDevice()||(r.model.marker.clearHighlighted(),d3.select(this).selectAll("."+a+"-label-x").classed("vzb-transparent",!0))}).on("click",function(t){if(o.isTouchDevice()){var e=d3.select(this).selectAll("."+a+"-label-x"),i=r.KEY||r.model.entities.getDimension(),n=e.classed("vzb-transparent");n&&(r.entityLabels.sort(function(e,n){return e[i]!=t[i]?-1:1}),r.showCloseCross(null,!1)),e.classed("vzb-transparent",!n),r.options.SUPPRESS_HIGHLIGHT_DURING_PLAY&&r.model.time.playing||(n?r.model.marker.setHighlight(t):r.model.marker.clearHighlighted())}}),e}function i(t,e,i,a,o,s,l,c,u,h){var d=r.cached[t[r.KEY]],f=d3.select(i),p=!a&&0!==a||!o&&0!==o||!s&&0!==s||!l&&0!==l;if(p)return f.classed("vzb-invisible",p),void h.classed("vzb-invisible",p);var m=r.context.width,g=r.context.height,v=d.rectBBox,y=v.width,b=v.height;a-y<=0?(a=y,d.labelX_=(a-r.xScale(d.labelX0))/m):a+5>m&&(a=m-5,d.labelX_=(a-r.xScale(d.labelX0))/m),o-.75*b<=0?(o=.75*b,d.labelY_=(o-r.yScale(d.labelY0))/g):o+.35*b>g&&(o=g-.35*b,d.labelY_=(o-r.yScale(d.labelY0))/g),null==c&&(c=r.context.duration),d._new&&(c=0,delete d._new),c?u&&!t.hidden?(f.classed("vzb-invisible",t.hidden),f.attr("transform","translate("+a+","+o+")").style("opacity",0).transition().duration(c).ease(d3.easeExp).style("opacity",1).on("interrupt",function(){f.style("opacity",1)}),h.classed("vzb-invisible",t.hidden),h.attr("transform","translate("+a+","+o+")").style("opacity",0).transition().duration(c).ease(d3.easeExp).style("opacity",1).on("interrupt",function(){h.style("opacity",1)})):u&&t.hidden?(f.style("opacity",1).transition().duration(c).ease(d3.easeExp).style("opacity",0).on("end",function(){f.style("opacity",1).classed("vzb-invisible",t.hidden)}),h.style("opacity",1).transition().duration(c).ease(d3.easeExp).style("opacity",0).on("end",function(){h.style("opacity",1).classed("vzb-invisible",t.hidden)})):(f.transition().duration(c).ease(d3.easeLinear).attr("transform","translate("+a+","+o+")"),h.transition().duration(c).ease(d3.easeLinear).attr("transform","translate("+a+","+o+")")):(f.interrupt().attr("transform","translate("+a+","+o+")").transition(),h.interrupt().attr("transform","translate("+a+","+o+")").transition(),u&&f.classed("vzb-invisible",t.hidden),u&&h.classed("vzb-invisible",t.hidden));var _=s-a,x=l-o,w=f.select("text").node().getBBox(),M=.5*-w.width,z=.2*-b,S=r.model.ui.chart.labels,E=S.removeLabelBox?w:v,k=r.activeProfile.labelLeashCoeff||0,T=n({x:_,y:x,r:d.scaledS0},{x:M,y:z,width:2*E.height*k+E.width,height:E.height*(2*k+1)});if(h.select("line").classed("vzb-invisible",T),!T){if(S.removeLabelBox){var P=180*Math.atan2(_-M,x-z)/Math.PI,O=P>=0&&P<=180?.5*E.width:.5*-E.width,A=Math.abs(P)<=90?.55*E.height:.45*-E.height;M+=Math.abs(_-M)>.5*w.width?O:0,z+=Math.abs(x-z)>.5*w.height?A:.05*w.height}var I=Math.abs(_)>Math.abs(x)?Math.abs(_):Math.abs(x);h.select("line").style("stroke-dasharray","0 "+d.scaledS0+" "+2*~~I),h.selectAll("line").attr("x1",_).attr("y1",x).attr("x2",M).attr("y2",z)}}function n(t,e){var i=Math.abs(t.x-e.x),n=Math.abs(t.y-e.y),r=.5*e.width,a=.5*e.height;if(i>r+t.r)return!1;if(n>a+t.r)return!1;if(i<=r)return!0;if(n<=a)return!0;var o=Math.pow(i-r,2)+Math.pow(n-a,2);return o<=Math.pow(t.r,2)}var r=t,a=void 0;e.setCssPrefix=function(t){return a=t,e};var s=d3.drag().on("start",function(t,e){d3.event.sourceEvent.stopPropagation();r.KEY}).on("drag",function(t,i){var n=r.KEY;if(r.model.ui.chart.labels.dragging){this.druging||(r.druging=t[n]);var a=r.cached[t[n]];a.labelFixed=!0;var o=r.context.width,s=r.context.height;a.labelX_+=d3.event.dx/o,a.labelY_+=d3.event.dy/s;var l=r.xScale(a.labelX0)+a.labelX_*o,c=r.yScale(a.labelY0)+a.labelY_*s,u=r.xScale(a.labelX0),h=r.yScale(a.labelY0),d=r.entityLines.filter(function(e){return e[n]==t[n]});e._repositionLabels(t,i,this,l,c,u,h,0,null,d)}}).on("end",function(t,e){var i=r.KEY;if(r.druging){var n=r.cached[t[i]];r.druging=null,n.labelOffset[0]=n.labelX_,n.labelOffset[1]=n.labelY_,r.model.marker.setLabelOffset(t,[n.labelX_,n.labelY_])}});return e.line=function(t){t.append("line").attr("class",a+"-label-line")},e._repositionLabels=i,e}()},h={LABELS_CONTAINER_CLASS:"",LINES_CONTAINER_CLASS:"",LINES_CONTAINER_SELECTOR:"",CSS_PREFIX:"",SUPPRESS_HIGHLIGHT_DURING_PLAY:!0},d=l.default.extend({init:function(t,e){this.context=t,this.options=o.extend({},h),this.label=u(this),this._xScale=null,this._yScale=null,this._closeCrossHeight=0,this.labelSizeTextScale=null},ready:function(){this.updateIndicators(),this.updateLabelSizeLimits()},readyOnce:function(){var t=this;this.model=this.context.model,this.model.on("change:marker.select",function(){t.context._readyOnce&&t.selectDataPoints()}),this.model.marker.size_label&&this.model.on("change:marker.size_label.extent",function(e,i){t.context._readyOnce&&(t.updateLabelSizeLimits(),t.model.time.splash||t.updateLabelsOnlyTextSize())}),this.model.ui.chart.labels.hasOwnProperty("removeLabelBox")&&this.model.on("change:ui.chart.labels.removeLabelBox",function(e,i){t.context._readyOnce&&t.updateLabelsOnlyTextSize()}),this.KEY=this.context.model.entities.getDimension(),this.cached={},this.label.setCssPrefix(this.options.CSS_PREFIX),this.rootEl=this.context.root.element instanceof Array?this.context.root.element:d3.select(this.context.root.element),this.labelsContainer=this.rootEl.select("."+this.options.LABELS_CONTAINER_CLASS),this.linesContainer=this.rootEl.select("."+this.options.LINES_CONTAINER_CLASS),this.updateIndicators(),this.updateSize(),this.selectDataPoints()},config:function(t){o.extend(this.options,t)},updateLabelSizeLimits:function(){var t=this;if(this.model.marker.size_label){var e=this.model.marker.size_label.extent||[0,1],i=this.activeProfile.minLabelTextSize,n=this.activeProfile.maxLabelTextSize,r=n-i;this.minLabelTextSize=Math.max(i+r*e[0],i),this.maxLabelTextSize=Math.max(i+r*e[1],i),"constant"==this.model.marker.size_label.use&&(this.minLabelTextSize=this.maxLabelTextSize),"ordinal"!==this.model.marker.size_label.scaleType||"constant"==this.model.marker.size_label.use?this.labelSizeTextScale.range([t.minLabelTextSize,t.maxLabelTextSize]):this.labelSizeTextScale.rangePoints([t.minLabelTextSize,t.maxLabelTextSize],0).range()}},updateIndicators:function(){this.model.marker.size_label&&(this.labelSizeTextScale=this.model.marker.size_label.getScale())},setScales:function(t,e){this._xScale=t,this._yScale=e},setCloseCrossHeight:function(t){this._closeCrossHeight!=t&&(this._closeCrossHeight=t,this.updateLabelCloseGroupSize(this.entityLabels.selectAll("."+this.options.CSS_PREFIX+"-label-x"),this._closeCrossHeight))},xScale:function(t){return this._xScale?this._xScale(t):t*this.context.width},yScale:function(t){return this._yScale?this._yScale(t):t*this.context.height},selectDataPoints:function(){var t=this,e=this.KEY,i=this.options.CSS_PREFIX;this.entityLabels=this.labelsContainer.selectAll("."+i+"-entity").data(t.model.marker.select,function(t){return t[e]}),this.entityLines=this.linesContainer.selectAll("g.entity-line."+i+"-entity").data(t.model.marker.select,function(t){return t[e]}),this.entityLabels.exit().each(function(i){null!=t.cached[i[e]]&&(t.cached[i[e]]=void 0)}).remove(),this.entityLines.exit().remove(),this.entityLines=this.entityLines.enter().insert("g",function(i){return this.querySelector("."+t.options.LINES_CONTAINER_SELECTOR_PREFIX+i[e])}).attr("class",function(t,n){return i+"-entity entity-line line-"+t[e]}).each(function(e,i){t.label.line(d3.select(this))}).merge(this.entityLines),this.entityLabels=this.entityLabels.enter().append("g").attr("class",function(t,n){return i+"-entity label-"+t[e]}).each(function(i,n){t.cached[i[e]]={_new:!0},t.label(d3.select(this))}).merge(this.entityLabels)},showCloseCross:function(t,e){var i=this.KEY;this.entityLabels.filter(function(e){return!t||e[i]==t[i]}).select("."+this.options.CSS_PREFIX+"-label-x").classed("vzb-transparent",!e)},highlight:function(t,e){var i=this.KEY,n=this.entityLabels;t&&(n=n.filter(function(e){return!t||e[i]==t[i]})),n.classed("vzb-highlighted",e)},updateLabel:function(t,e,i,n,r,a,s,l,c,u,h){var d=this,f=this,p=this.KEY;if(t[p]!=f.druging){var m=this.options.CSS_PREFIX;f.model.marker.isSelected(t)&&null!=f.entityLabels&&!function(){null==f.cached[t[p]]&&d.selectDataPoints();var g=f.cached[t[p]];if(i&&o.extend(g,i),null!=g.scaledS0&&null!=g.labelX0&&null!=g.labelY0||((a||0===a)&&(g.scaledS0=o.areaToRadius(d.context.sScale(a))),g.labelX0=n,g.labelY0=r,g.valueLST=c,g.scaledC0=null!=s?d.context.cScale(s):d.context.COLOR_WHITEISH),null==g.labelX_||null==g.labelY_){var v=o.find(f.model.marker.select,function(e){return e[p]==t[p]});g.labelOffset=v.labelOffset||[0,0]}var y=!g.labelX0&&0!==g.labelX0||!g.labelY0&&0!==g.labelY0||!g.scaledS0&&0!==g.scaledS0,b=f.entityLines.filter(function(e){return e[p]==t[p]});f.entityLabels.filter(function(e){return e[p]==t[p]}).each(function(i){var n=d3.select(this);if(y)return n.classed("vzb-invisible",y),void b.classed("vzb-invisible",y);var r=n.selectAll("."+m+"-label-content").text(l);f._updateLabelSize(t,e,n,c,r),f.positionLabel(t,e,this,u,h,b)})}()}},_updateLabelSize:function(t,e,i,n,r){var a=this,o=this.KEY,s=a.cached[t[o]],l=this.options.CSS_PREFIX,c=a.model.ui.chart.labels||{};i.classed("vzb-label-boxremoved",c.removeLabelBox);var u=r||i.selectAll("."+l+"-label-content");if(a.labelSizeTextScale)if(null!=n){var h=a.labelSizeTextScale.range(),d=h[0]+Math.sqrt((a.labelSizeTextScale(n)-h[0])*(h[1]-h[0]));u.attr("font-size",d+"px")}else u.attr("font-size","");var f=u.node().getBBox(),p=i.selectAll("rect");if(!s.textWidth||s.textWidth!=f.width){s.textWidth=f.width;var m=a._closeCrossHeight||f.height,g=a.model.locale.isRTL(),v=i.select("."+l+"-label-x").attr("transform","translate("+(g?-f.width-4:4)+","+.85*-f.height+")");this.updateLabelCloseGroupSize(v,m),p.attr("width",f.width+8).attr("height",1.2*f.height).attr("x",-f.width-4).attr("y",.85*-f.height).attr("rx",.2*f.height).attr("ry",.2*f.height),s.rectBBox=p.node().getBBox()}var y=i.select(".vzb-label-glow");y.attr("stroke")!==s.scaledC0&&y.attr("stroke",s.scaledC0)},updateLabelCloseGroupSize:function(t,e){t.select("circle").attr("cx",0).attr("cy",0).attr("r",.5*e),t.select("svg").attr("x",.5*-e).attr("y",e*-.5).attr("width",e).attr("height",e)},updateLabelsOnlyTextSize:function(){var t=this,e=this.KEY;this.entityLabels.each(function(i,n){t.cached[i[e]];t._updateLabelSize(i,n,d3.select(this),t.context.frame.size_label[i[e]]);var r=t.entityLines.filter(function(t){return t[e]==i[e]});t.positionLabel(i,n,this,0,null,r)})},updateLabelOnlyPosition:function(t,e,i){var n=this,r=this.KEY,a=this.cached[t[r]];i&&o.extend(a,i);var s=n.entityLines.filter(function(e){return e[r]==t[r]});this.entityLabels.filter(function(e){return e[r]==t[r]}).each(function(i){n.positionLabel(t,e,this,0,null,s)})},updateLabelOnlyColor:function(t,e,i){var n=this,r=this.KEY,a=this.cached[t[r]];i&&o.extend(a,i);var s=n.entityLabels.filter(function(e){return e[r]==t[r]});n._updateLabelSize(t,e,s,null)},positionLabel:function(t,e,i,n,r,a){var o=this.KEY,s=this.cached[t[o]],l=this.context.width,c=this.context.height,u=this.xScale(s.labelX0),h=this.yScale(s.labelY0);s.labelOffset||(s.labelOffset=[0,0]),s.labelX_=s.labelOffset[0]||(.75*-s.scaledS0-5)/l,s.labelY_=s.labelOffset[1]||(.75*-s.scaledS0-11)/c;var d=u+s.labelX_*l;0==s.labelOffset[0]&&(d-s.rectBBox.width<=0?(s.labelX_=(.75*s.scaledS0+s.rectBBox.width)/l,d=u+s.labelX_*l):d+15>l&&(s.labelX_=(l-15-u)/l,
d=u+s.labelX_*l));var f=h+s.labelY_*c;0==s.labelOffset[1]&&(f-s.rectBBox.height<=0?(s.labelY_=(.75*s.scaledS0+s.rectBBox.height)/c,f=h+s.labelY_*c):f+10>c&&(s.labelY_=(c-10-h)/c,f=h+s.labelY_*c)),this.label._repositionLabels(t,e,i,d,f,u,h,n,r,a)},updateSize:function(){var t={small:{minLabelTextSize:7,maxLabelTextSize:21,defaultLabelTextSize:12,labelLeashCoeff:.4},medium:{minLabelTextSize:7,maxLabelTextSize:30,defaultLabelTextSize:15,labelLeashCoeff:.3},large:{minLabelTextSize:6,maxLabelTextSize:48,defaultLabelTextSize:20,labelLeashCoeff:.2}},e={medium:{minLabelTextSize:15,maxLabelTextSize:35,defaultLabelTextSize:15,labelLeashCoeff:.3},large:{minLabelTextSize:20,maxLabelTextSize:55,defaultLabelTextSize:20,labelLeashCoeff:.2}};this.activeProfile=this.context.getActiveProfile(t,e),this.updateLabelSizeLimits()}});e.default=d},function(t,e,i){var n=i(21),r=i(12),a=i(57);t.exports=function(t){return function(e,i,o){var s,l=n(e),c=r(l.length),u=a(o,c);if(t&&i!=i){for(;c>u;)if(s=l[u++],s!=s)return!0}else for(;c>u;u++)if((t||u in l)&&l[u]===i)return t||u||0;return!t&&-1}}},function(t,e,i){"use strict";var n=i(4),r=i(0),a=i(19),o=i(55),s=i(43),l=i(63),c=i(50),u=i(6),h=i(5),d=i(80),f=i(65),p=i(97);t.exports=function(t,e,i,m,g,v){var y=n[t],b=y,_=g?"set":"add",x=b&&b.prototype,w={},M=function(t){var e=x[t];a(x,t,"delete"==t?function(t){return!(v&&!u(t))&&e.call(this,0===t?0:t)}:"has"==t?function(t){return!(v&&!u(t))&&e.call(this,0===t?0:t)}:"get"==t?function(t){return v&&!u(t)?void 0:e.call(this,0===t?0:t)}:"add"==t?function(t){return e.call(this,0===t?0:t),this}:function(t,i){return e.call(this,0===t?0:t,i),this})};if("function"==typeof b&&(v||x.forEach&&!h(function(){(new b).entries().next()}))){var z=new b,S=z[_](v?{}:-0,1)!=z,E=h(function(){z.has(1)}),k=d(function(t){new b(t)}),T=!v&&h(function(){for(var t=new b,e=5;e--;)t[_](e,e);return!t.has(-0)});k||(b=e(function(e,i){c(e,b,t);var n=p(new y,e,b);return void 0!=i&&l(i,g,n[_],n),n}),b.prototype=x,x.constructor=b),(E||T)&&(M("delete"),M("has"),g&&M("get")),(T||S)&&M(_),v&&x.clear&&delete x.clear}else b=m.getConstructor(e,t,g,_),o(b.prototype,i),s.NEED=!0;return f(b,t),w[t]=b,r(r.G+r.W+r.F*(b!=y),w),v||m.setStrong(b,t,g),b}},function(t,e,i){"use strict";var n=i(18),r=i(19),a=i(5),o=i(29),s=i(7);t.exports=function(t,e,i){var l=s(t),c=i(o,l,""[t]),u=c[0],h=c[1];a(function(){var e={};return e[l]=function(){return 7},7!=""[t](e)})&&(r(String.prototype,t,u),n(RegExp.prototype,l,2==e?function(t,e){return h.call(t,this,e)}:function(t){return h.call(t,this)}))}},function(t,e,i){"use strict";var n=i(3);t.exports=function(){var t=n(this),e="";return t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.unicode&&(e+="u"),t.sticky&&(e+="y"),e}},function(t,e){t.exports=function(t,e,i){var n=void 0===i;switch(e.length){case 0:return n?t():t.call(i);case 1:return n?t(e[0]):t.call(i,e[0]);case 2:return n?t(e[0],e[1]):t.call(i,e[0],e[1]);case 3:return n?t(e[0],e[1],e[2]):t.call(i,e[0],e[1],e[2]);case 4:return n?t(e[0],e[1],e[2],e[3]):t.call(i,e[0],e[1],e[2],e[3])}return t.apply(i,e)}},function(t,e,i){var n=i(6),r=i(28),a=i(7)("match");t.exports=function(t){var e;return n(t)&&(void 0!==(e=t[a])?!!e:"RegExp"==r(t))}},function(t,e,i){var n=i(7)("iterator"),r=!1;try{var a=[7][n]();a.return=function(){r=!0},Array.from(a,function(){throw 2})}catch(t){}t.exports=function(t,e){if(!e&&!r)return!1;var i=!1;try{var a=[7],o=a[n]();o.next=function(){return{done:i=!0}},a[n]=function(){return o},t(a)}catch(t){}return i}},function(t,e,i){t.exports=i(51)||!i(5)(function(){var t=Math.random();__defineSetter__.call(null,t,function(){}),delete i(4)[t]})},function(t,e){e.f=Object.getOwnPropertySymbols},function(t,e,i){var n=i(4),r="__core-js_shared__",a=n[r]||(n[r]={});t.exports=function(t){return a[t]||(a[t]={})}},function(t,e,i){for(var n,r=i(4),a=i(18),o=i(58),s=o("typed_array"),l=o("view"),c=!(!r.ArrayBuffer||!r.DataView),u=c,h=0,d=9,f="Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array".split(",");h<d;)(n=r[f[h++]])?(a(n.prototype,s,!0),a(n.prototype,l,!0)):u=!1;t.exports={ABV:c,CONSTR:u,TYPED:s,VIEW:l}},function(t,e){var i;i=function(){return this}();try{i=i||Function("return this")()||(0,eval)("this")}catch(t){"object"==typeof window&&(i=window)}t.exports=i},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var a=i(1),o=r(a),s=i(2),l=n(s),c={EXTENT_MIN:0,EXTENT_MAX:1,TEXT_PARAMS:{TOP:11,LEFT:10,MAX_WIDTH:42,MAX_HEIGHT:16},BAR_WIDTH:6,THUMB_RADIUS:10,THUMB_STROKE_WIDTH:4,INTRO_DURATION:250},u={small:{minRadius:.5,maxRadius:40},medium:{minRadius:1,maxRadius:55},large:{minRadius:1,maxRadius:65}},h=l.default.extend({init:function(t,e){function n(t,e){var i=a.model.size.extent||[c.EXTENT_MIN,c.EXTENT_MAX];a._updateLabels(i),a._moveBrush(i)}function r(t){a.sizeScaleMinMax=a.model.size.getScale().domain(),a._setLabelsText()}this.name="bubblesize",this.template=this.template||i(435),this.model_expects=[{name:"size",type:"size"}];var a=this;this.model_binds={"change:size.domainMin":n,"change:size.domainMax":n,"change:size.extent":n,ready:r},this._setModel=o.throttle(this._setModel,50),this._super(t,e)},readyOnce:function(){var t=this,e=t.model.size.extent||[c.EXTENT_MIN,c.EXTENT_MAX];this.showArcs=t.model.size.showArcs!==!1,this.element=d3.select(this.element),this.sliderSvg=this.element.select(".vzb-bs-svg"),this.sliderWrap=this.sliderSvg.select(".vzb-bs-slider-wrap"),this.sliderEl=this.sliderWrap.select(".vzb-bs-slider");var i={v:c.TEXT_PARAMS.TOP,h:c.TEXT_PARAMS.LEFT},n=c.TEXT_PARAMS.MAX_WIDTH,r=c.TEXT_PARAMS.MAX_HEIGHT,a=c.BAR_WIDTH,o=c.THUMB_RADIUS,s=c.THUMB_STROKE_WIDTH;this.padding={top:s,left:i.h+n,right:i.h+n,bottom:a+r};var l=this.getMinMaxBubbleRadius();this.xScale=d3.scale.linear().domain([c.EXTENT_MIN,c.EXTENT_MAX]).range([2*l.min,2*l.max]).clamp(!0),this.brush=d3.brushX().extent([[0,0],[2*l.max,a]]).handleSize(2*o+2*a).on("start",function(){if(!t.nonBrushChange&&d3.event.sourceEvent){if(d3.event.selection&&d3.event.selection[0]==d3.event.selection[1]){var e=t.sliderEl.node().__brush;e.selection[1][0]+=.01}t._setFromExtent(!1,!1,!1)}}).on("brush",function(){if(!t.nonBrushChange&&d3.event.sourceEvent){if(d3.event.selection&&d3.event.selection[0]==d3.event.selection[1]){var e=t.sliderEl.node().__brush;e.selection[1][0]+=.01}t._setFromExtent(!0,!1,!1)}}).on("end",function(){!t.nonBrushChange&&d3.event.sourceEvent&&t._setFromExtent(!0,!0)}),this.sliderThumbs=this.sliderEl.selectAll(".handle").data([{type:"w"},{type:"e"}],function(t){return t.type}).enter().append("svg").attr("class",function(t){return"handle handle--"+t.type}).classed("vzb-bs-slider-thumb",!0),this.sliderThumbs.append("g").attr("class","vzb-bs-slider-thumb-badge").append("path").attr("d","M"+(o+a)+" "+(o+1.5*a)+"l"+-o+" "+1.5*o+"h"+2*o+"Z"),this.sliderEl.call(t.brush),t.showArcs&&this.sliderEl.selectAll(".vzb-bs-slider-thumb-arc").data([0,0]).enter().append("path").attr("class","vzb-bs-slider-thumb-arc"),this.sliderArcsEl=this.sliderEl.selectAll(".vzb-bs-slider-thumb-arc"),this.sliderEl.selectAll("text").data([0,0]).enter().append("text").attr("class","vzb-bs-slider-thumb-label").attr("text-anchor",function(t,e){return e?"start":"end"}).attr("dy",function(t,e){return e?"-0.7em":"1.4em"}),this.sliderLabelsEl=this.sliderEl.selectAll("text.vzb-bs-slider-thumb-label"),this.sliderEl.selectAll(".selection,.overlay").attr("height",a).attr("rx",.25*a).attr("ry",.25*a).attr("transform","translate(0,"+.5*-a+")"),this.on("resize",function(){var e=t.getMinMaxBubbleRadius();t.xScale.range([2*e.min,2*e.max]),t._updateSize(),t.sliderEl.call(t.brush.extent([[0,0],[2*e.max,a]]));var i=t.model.size.extent||[c.EXTENT_MIN,c.EXTENT_MAX];t._moveBrush(i)}),this._updateSize(),this._moveBrush(e),this.sizeScaleMinMax=this.model.size.getScale().domain(),this.sizeScaleMinMax&&this._setLabelsText()},getMinMaxBubbleRadius:function(){return{min:u[this.getLayoutProfile()].minRadius,max:u[this.getLayoutProfile()].maxRadius}},_moveBrush:function(t){var e=t.map(this.xScale);this.nonBrushChange=!0,this.sliderEl.call(this.brush.move,[e[0],e[1]+.01]),this.nonBrushChange=!1,this._setFromExtent(!1,!1,!1)},_updateSize:function(){var t=this.showArcs?this.getMinMaxBubbleRadius().max:2*c.TEXT_PARAMS.TOP;this.sliderSvg.attr("height",t+this.padding.top+this.padding.bottom).attr("width",2*this.getMinMaxBubbleRadius().max+this.padding.left+this.padding.right),this.sliderWrap.attr("transform","translate("+this.padding.left+","+(t+this.padding.top)+")")},_updateArcs:function(t){if(this.showArcs){var e=this,i=d3.arc().outerRadius(function(t){return.5*e.xScale(t)}).innerRadius(function(t){return.5*e.xScale(t)}).startAngle(.5*-Math.PI).endAngle(.5*Math.PI);this.sliderArcsEl.data(t).attr("d",i).attr("transform",function(t){return"translate("+.5*e.xScale(t)+",0)"})}},_updateLabels:function(t){var e=this;this.sliderLabelsEl.data(t).attr("transform",function(t,i){var n={v:c.TEXT_PARAMS.TOP,h:c.TEXT_PARAMS.LEFT},r=n.h*(i?.5:-1)+e.xScale(t),a=0;return"translate("+r+","+a+")"})},_setLabelsText:function(){var t=this;t.sliderLabelsEl.data([t.model.size.getTickFormatter()(t.sizeScaleMinMax[0]),t.model.size.getTickFormatter()(t.sizeScaleMinMax[1])]).text(function(t){return t})},_setFromExtent:function(t,e,i){var n=d3.brushSelection(this.sliderEl.node());n&&(n=[this.xScale.invert(n[0]),this.xScale.invert(+n[1].toFixed(1))],this._updateArcs(n),this._updateLabels(n),t&&this._setModel(n,e,i))},_setModel:function(t,e,i){t=[+t[0].toFixed(2),+t[1].toFixed(2)],this.model.size.set({extent:t},e,i)}});e.default=h},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var a=i(1),o=r(a),s=i(2),l=n(s),c=i(210),u=n(c),h=i(41),d=n(h),f=l.default.extend({init:function(t,e){var i=this;this.template='<div class="vzb-cl-outer"></div>',this.name="colorlegend",this.model_expects=[{name:"time",type:"time"},{name:"entities",type:"entities"},{name:"marker",type:"model"},{name:"locale",type:"locale"}],this.model_binds={"change:marker.color.scaleType":function(t,e){i._readyOnce&&!i.colorModel.isDiscrete()&&i.updateView()},"change:marker.color.palette":function(t,e){!i._readyOnce||i.colorModel.isDiscrete()&&!i.frame||i.updateView()},"change:marker.highlight":function(t,e){i.colorModel.isDiscrete()&&i.model.marker.getFrame(i.model.time.value,function(t){if(t){var e=i.model.marker.getHighlighted(i.KEY);i.updateGroupsOpacity(e.map(function(e){return t[i.colorModel._name][e]}))}else i.updateGroupsOpacity()})},"translate:locale":function(){i.colorPicker.translate(i.model.locale.getTFunction())}},this._super(t,e)},readyOnce:function(){var t=this;this.element=d3.select(this.element),d3.select(this.placeholder.parentNode).classed("vzb-dialog-scrollable",!0),this.colorModel=this.model.marker.color,this.colorlegendMarker=this.colorModel.getColorlegendMarker(),this.colorlegendMarker&&this.colorlegendMarker.on("ready",function(){t.ready()}),this.listColorsEl=this.element.append("div").attr("class","vzb-cl-holder").append("div").attr("class","vzb-cl-colorlist"),this.rainbowEl=this.listColorsEl.append("div").attr("class","vzb-cl-rainbow"),this.minimapEl=this.listColorsEl.append("div").attr("class","vzb-cl-minimap"),this.rainbowLegendEl=this.listColorsEl.append("div").attr("class","vzb-cl-rainbow-legend"),this.rainbowLegendSVG=this.rainbowLegendEl.append("svg"),this.rainbowLegendG=this.rainbowLegendSVG.append("g"),this.rainbowLegend=null,this.labelScaleEl=this.listColorsEl.append("div").attr("class","vzb-cl-labelscale"),this.labelScaleSVG=this.labelScaleEl.append("svg"),this.labelScaleG=this.labelScaleSVG.append("g"),this.unitDiv=this.listColorsEl.append("div").attr("class","vzb-cl-unit"),this.unitText=this.unitDiv.append("span").attr("class","vzb-cl-unit-text"),this.minimapSVG=this.minimapEl.append("svg"),this.minimapG=this.minimapSVG.append("g"),this.colorPicker=(0,u.default)(),this.root.element instanceof Array?this.root.element:d3.select(this.root.element).call(this.colorPicker),this.colorPicker.translate(this.model.locale.getTFunction())},ready:function(){var t=this;if(this.KEY=this.model.entities.getDimension(),this.colorlegendDim=this.KEY,this.canShowMap=!1,this.colorModel.isDiscrete()&&"constant"!==this.colorModel.use&&this.colorlegendMarker){if(!this.colorlegendMarker._ready)return;return this.colorlegendDim=this.colorModel.getColorlegendEntities().getDimension(),void this.colorlegendMarker.getFrame(this.model.time.value,function(e){t.frame=e,t.canShowMap=o.keys((t.frame||{}).hook_geoshape||{}).length,t.colorlegendKeys=t.colorlegendMarker.getKeys(t.colorlegendDim),t.colorlegendKeys.forEach(function(e){((t.frame||{}).hook_geoshape||{})[e[t.colorlegendDim]]||(t.canShowMap=!1)}),t.updateView(),t.updateGroupsOpacity()})}t.updateView(),t.updateGroupsOpacity()},updateView:function(){var t=this,e=this,i=(this.KEY,this.colorModel.getPalette()),n=this.canShowMap,r=this.colorlegendKeys||[],a=this.listColorsEl.selectAll(".vzb-cl-option"),s=n||"_default"==this.colorModel.which||this.colorlegendMarker&&this.colorlegendDim==this.KEY&&o.comparePlainObjects(this.colorModel.getColorlegendEntities().getFilter(),this.model.entities.getFilter());a.classed("vzb-hidden",s),this.rainbowEl.classed("vzb-hidden",this.colorModel.isDiscrete()),this.labelScaleEl.classed("vzb-hidden",this.colorModel.isDiscrete()),this.rainbowLegendEl.classed("vzb-hidden",this.colorModel.isDiscrete()),this.minimapEl.classed("vzb-hidden",!n||!this.colorModel.isDiscrete()),this.unitDiv.classed("vzb-hidden",!0);var l=this.colorModel.getScale();this.colorModel.isDiscrete()?n?!function(){var i=t.minimapEl.append("div").attr("class","vzb-temp");t.minimapSVG.attr("viewBox",null),t.minimapSVG.selectAll("g").remove(),t.minimapG=t.minimapSVG.append("g"),t.minimapG.selectAll("path").data(r,function(t){return t[e.colorlegendDim]}).enter().append("path").on("mouseover",e._interact().mouseover).on("mouseout",e._interact().mouseout).on("click",e._interact().clickToSelect).on("dblclick",e._interact().clickToShow).each(function(t){var n=e.frame.hook_geoshape[t[e.colorlegendDim]].trim();"<svg"==n.slice(0,4)&&(i.html(n),n=i.select("svg").select("path").attr("d")),d3.select(this).attr("d",n).style("fill",l(t[e.colorlegendDim])).append("title").html(e.frame.label[t[e.colorlegendDim]]),i.html("")});var n=t.minimapG.node().getBBox();t.minimapSVG.attr("viewBox","0 0 "+1.05*n.width+" "+1.05*n.height),i.remove()}():(a="_default"==this.colorModel.which?a.data([]):a.data(s?[]:r.length?r:Object.keys(this.colorModel.getPalette()).map(function(t){var i={};return i[e.colorlegendDim]=t,i}),function(t){return t[e.colorlegendDim]}),a.exit().remove(),a.enter().append("div").attr("class","vzb-cl-option").each(function(){d3.select(this).append("div").attr("class","vzb-cl-color-sample").on("click",e._interact().clickToShow),d3.select(this).append("div").attr("class","vzb-cl-color-legend")}).on("mouseover",e._interact().mouseover).on("mouseout",e._interact().mouseout).on("click",e._interact().clickToSelect),a.each(function(t,i){d3.select(this).select(".vzb-cl-color-sample").style("background-color",l(t[e.colorlegendDim])).style("border","1px solid "+l(t[e.colorlegendDim]));var n=e.colorlegendMarker?e.frame.label[t[e.colorlegendDim]]:null;n||0===n||(n=t[e.colorlegendDim]),d3.select(this).select(".vzb-cl-color-legend").text(n)})):!function(){var n=t.rainbowEl.node().getBoundingClientRect().width,r=Object.keys(i).map(parseFloat),o=void 0,s=void 0,c=t.colorModel.getTickFormatter(),u=null,h=t.colorModel.paletteLabels;h?!function(){u="optimistic",o=h.map(function(t){return parseFloat(t)});var t=d3.max(o);s=o.map(function(e){return e/t*n})}():!function(){o=l.domain();var t=d3.max(r);s=r.map(function(e){return e/t*n})}();var f=d3.min(o)<=0&&d3.max(o)>=0&&"log"===t.colorModel.scaleType?"genericLog":t.colorModel.scaleType,p=d3.scale["time"==f?"linear":f]().domain(o).range(s),m=parseInt(t.rainbowEl.style("left"),10)||0,g=parseInt(t.rainbowEl.style("right"),10)||m;t.labelScaleSVG.style("width",m+n+g+"px"),t.labelScaleG.attr("transform","translate("+m+",0)"),t.rainbowLegendSVG.style("width",m+n+g+"px"),t.rainbowLegendG.attr("transform","translate("+m+", 7)");var v=(0,d.default)("bottom");v.scale(p).tickSizeOuter(0).tickPadding(6).tickSizeMinor(3,0).labelerOptions({scaleType:t.colorModel.scaleType,toolMargin:{right:g,left:m},showOuter:!0,formatter:c,bump:m,cssFontSize:"11px",fitIntoScale:u}),t.labelScaleG.call(v);var y=l.range(),b=s.map(function(t,e){return{val:t,color:y[e],paletteKey:r[e]}});t.rainbowLegend=t.rainbowLegendG.selectAll("circle").data(b),t.rainbowLegend.exit().remove(),t.rainbowLegend=t.rainbowLegend.enter().append("circle").attr("r","6px").attr("stroke","#000").on("click",e._interact().clickToChangeColor).merge(t.rainbowLegend),t.rainbowLegend.each(function(t,e){d3.select(this).attr("fill",t.color),d3.select(this).attr("cx",t.val)});var _=r.map(function(t,e){return y[e]+" "+d3.format("%")(.01*t)}).join(", ");t.rainbowEl.style("background","linear-gradient(90deg,"+_+")");var x=t.colorModel.getConceptprops().unit||"";t.unitDiv.classed("vzb-hidden",""==x),t.unitText.text(x),a.classed("vzb-hidden",!0)}()},_interact:function(){var t=this,e=this.KEY,i=this.colorlegendDim;return{mouseover:function(n,r){if(t.colorModel.isDiscrete()){var a=(d3.select(this),n[i]),s=t.colorModel.getValidItems().filter(function(e){return e[t.colorModel.which]==a}).map(function(t){return o.clone(t,[e])});t.model.marker.setHighlight(s)}},mouseout:function(e,i){t.colorModel.isDiscrete()&&t.model.marker.clearHighlighted()},clickToChangeColor:function(e,n){if(t.colorModel.isUserSelectable()){var r=t.colorModel.getPalette(),a=t.colorModel.getDefaultPalette(),o=(d3.select(this),t.colorModel.isDiscrete()?e[i]:e.paletteKey);t.colorPicker.colorOld(r[o]).colorDef(a[o]).callback(function(e,i){t.colorModel.setColor(e,o)}).fitToScreen([d3.event.pageX,d3.event.pageY]).show(!0)}},clickToShow:function(e,n){if(t.colorModel.isDiscrete()){var r=(d3.select(this),e[i],t.model.entities.show[i]&&t.model.entities.show[i].$in?o.clone(t.model.entities.show[i].$in):[]),a=r.indexOf(e[i]);a!==-1?r.splice(a,1):r.push(e[i]);var s={};r.length>0&&(s[i]={$in:r}),t.model.entities.set({show:s})}},clickToSelect:function(n,r){if(t.colorModel.isDiscrete()){var a=(d3.select(this),n[i]),s=t.colorModel.getValidItems().filter(function(e){return e[t.colorModel.which]==a}).map(function(t){return o.clone(t,[e])});s.filter(function(e){return t.model.marker.isSelected(e)}).length==s.length?t.model.marker.clearSelected():t.model.marker.setSelect(s)}}}},resize:function(){this.colorModel.isDiscrete()||this.updateView(),this.colorPicker.resize(d3.select(".vzb-colorpicker-svg"))},updateGroupsOpacity:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=this,i=this.colorModel.getColorlegendMarker()||{},n=i.opacityRegular||.8,r=i.opacityHighlightDim||.5,a=1,o=e.canShowMap?".vzb-cl-minimap path":".vzb-cl-option .vzb-cl-color-sample";this.listColorsEl.selectAll(o).style("opacity",function(i){return t.length?t.indexOf(i[e.colorlegendDim])>-1?a:r:n})}});e.default=f},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var a=i(1),o=r(a),s=i(2),l=n(s),c="domainMin",u="domainMax",h="zoomedMin",d="zoomedMax",f=l.default.extend({init:function(t,e){this.name="gapminder-minmaxinputs",this.template=i(453);var n=this;this.model_expects=[{name:"marker",type:"model"},{name:"time",type:"time"},{name:"locale",type:"locale"}],this.markerID=t.markerID,t.markerID||o.warn("minmaxinputs.js complains on 'markerID' property: "+t.markerID),this.model_binds={},this.model_binds["translate:locale"]=function(t){n.updateView()},this.model_binds["change:marker."+this.markerID]=function(t){n.updateView()},this.model_binds.ready=function(t){n.updateView()},this._super(t,e),this.ui=o.extend({selectDomainMinMax:!1,selectZoomedMinMax:!1},this.ui.getPlainObject())},ready:function(){this.updateView()},readyOnce:function(){var t=this;this.element=d3.select(this.element),this.el_domain_labelMin=this.element.select(".vzb-mmi-domainmin-label"),this.el_domain_labelMax=this.element.select(".vzb-mmi-domainmax-label"),this.el_domain_fieldMin=this.element.select(".vzb-mmi-domainmin"),this.el_domain_fieldMax=this.element.select(".vzb-mmi-domainmax"),this.el_break=this.element.select(".vzb-mmi-break"),this.el_zoomed_labelMin=this.element.select(".vzb-mmi-zoomedmin-label"),this.el_zoomed_labelMax=this.element.select(".vzb-mmi-zoomedmax-label"),this.el_zoomed_fieldMin=this.element.select(".vzb-mmi-zoomedmin"),this.el_zoomed_fieldMax=this.element.select(".vzb-mmi-zoomedmax"),t.el_domain_fieldMin.on("change",function(){t._setModel(c,this.value)}),t.el_domain_fieldMax.on("change",function(){t._setModel(u,this.value)}),t.el_zoomed_fieldMin.on("change",function(){t._setModel(h,this.value)}),t.el_zoomed_fieldMax.on("change",function(){t._setModel(d,this.value)}),this.element.selectAll("input").on("keypress",function(t){13==d3.event.which&&document.activeElement.blur()})},updateView:function(){var t=this;this.translator=this.model.locale.getTFunction(),this.el_domain_labelMin.text(this.translator("hints/min")+":"),this.el_domain_labelMax.text(this.translator("hints/max")+":"),this.el_zoomed_labelMin.text(this.translator("hints/min")+":"),this.el_zoomed_labelMax.text(this.translator("hints/max")+":"),this.el_domain_labelMin.classed("vzb-hidden",!this.ui.selectDomainMinMax),this.el_domain_labelMax.classed("vzb-hidden",!this.ui.selectDomainMinMax),this.el_domain_fieldMin.classed("vzb-hidden",!this.ui.selectDomainMinMax),this.el_domain_fieldMax.classed("vzb-hidden",!this.ui.selectDomainMinMax),this.el_break.classed("vzb-hidden",!(this.ui.selectDomainMinMax&&this.ui.selectZoomedMinMax)),this.el_zoomed_labelMin.classed("vzb-hidden",!this.ui.selectZoomedMinMax),this.el_zoomed_labelMax.classed("vzb-hidden",!this.ui.selectZoomedMinMax),this.el_zoomed_fieldMin.classed("vzb-hidden",!this.ui.selectZoomedMinMax),this.el_zoomed_fieldMax.classed("vzb-hidden",!this.ui.selectZoomedMinMax);var e=function(e){return e||0===e?o.isDate(e)?t.model.time.formatDate(e):d3.format(".2r")(e):e};this.el_domain_fieldMin.property("value",e(this.model.marker[this.markerID].getScale().domain()[0])),this.el_domain_fieldMax.property("value",e(this.model.marker[this.markerID].getScale().domain()[1])),this.el_zoomed_fieldMin.property("value",e(this.model.marker[this.markerID].zoomedMin)),this.el_zoomed_fieldMax.property("value",e(this.model.marker[this.markerID].zoomedMax))},_setModel:function(t,e){this.model.marker[this.markerID][t]=o.strToFloat(e)}});e.default=f},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){function t(t,i){return{type:"Feature",id:t.id,properties:t.properties,geometry:e(t.geometry,i)}}function e(t,i){if(!t)return null;if("GeometryCollection"===t.type)return{type:"GeometryCollection",geometries:object.geometries.map(function(t){return e(t,i)})};if(!fe.hasOwnProperty(t.type))return null;var n=fe[t.type];return d3.geoUstream(t,i(n)),n.result()}function i(){}function n(t){if((e=t.length)<4)return!1;for(var e,i=0,n=t[e-1][1]*t[0][0]-t[e-1][0]*t[0][1];++i<e;)n+=t[i-1][1]*t[i][0]-t[i-1][0]*t[i][1];return n<=0}function r(t,e){for(var i=e[0],n=e[1],r=!1,a=0,o=t.length,s=o-1;a<o;s=a++){var l=t[a],c=l[0],u=l[1],h=t[s],d=h[0],f=h[1];u>n^f>n&&i<(d-c)*(n-u)/(f-u)+c&&(r=!r)}return r}function a(t){return t?t/Math.sin(t):1}function o(t){return t>0?1:t<0?-1:0}function s(t){return t>1?ve:t<-1?-ve:Math.asin(t)}function l(t){return t>1?0:t<-1?ge:Math.acos(t)}function c(t){return t>0?Math.sqrt(t):0}function u(t){function e(t,e){var i=Math.cos(t),r=Math.cos(e),a=Math.sin(e),o=r*i,s=-((1-o?Math.log(.5*(1+o))/(1-o):-.5)+n/(1+o));return[s*r*Math.sin(t),s*a]}var i=Math.tan(.5*t),n=2*Math.log(Math.cos(.5*t))/(i*i);return e.invert=function(e,i){var r,a=Math.sqrt(e*e+i*i),o=t*-.5,l=50;if(!a)return[0,0];do{var c=.5*o,u=Math.cos(c),h=Math.sin(c),d=Math.tan(c),f=Math.log(1/u);o-=r=(2/d*f-n*d-a)/(-f/(h*h)+1-n/(2*u*u))}while(Math.abs(r)>pe&&--l>0);var p=Math.sin(o);return[Math.atan2(e*p,a*Math.cos(o)),s(i*p/a)]},e}function h(){var t=ve,e=we(u),i=e(t);return i.radius=function(i){return arguments.length?e(t=i*ge/180):t/ge*180},i}function d(t,e){var i=Math.cos(e),n=a(l(i*Math.cos(t/=2)));return[2*i*Math.sin(t)*n,Math.sin(e)*n]}function f(t){function e(t,e){var s=Math.cos(e),l=Math.cos(t/=2);return[(1+s)*Math.sin(t),(r*e>-Math.atan2(l,a)-.001?0:10*-r)+o+Math.sin(e)*n-(1+s)*i*l]}var i=Math.sin(t),n=Math.cos(t),r=t>0?1:-1,a=Math.tan(r*t),o=(1+i-n)/2;return e.invert=function(t,e){var s=0,l=0,c=50;do{var u=Math.cos(s),h=Math.sin(s),d=Math.cos(l),f=Math.sin(l),p=1+d,m=p*h-t,g=o+f*n-p*i*u-e,v=.5*p*u,y=-h*f,b=.5*i*p*h,_=n*d+i*u*f,x=y*b-_*v,w=.5*(g*y-m*_)/x,M=(m*b-g*v)/x;s-=w,l-=M}while((Math.abs(w)>pe||Math.abs(M)>pe)&&--c>0);return r*l>-Math.atan2(Math.cos(s),a)-.001?[2*s,l]:null},e}function p(){var t=ge/9,e=t>0?1:-1,i=Math.tan(e*t),n=we(f),r=n(t),a=r.stream;return r.parallel=function(r){return arguments.length?(i=Math.tan((e=(t=r*ge/180)>0?1:-1)*t),n(t)):t/ge*180},r.stream=function(n){var o=r.rotate(),s=a(n),l=(r.rotate([0,0]),a(n));return r.rotate(o),s.sphere=function(){l.polygonStart(),l.lineStart();for(var n=e*-180;e*n<180;n+=90*e)l.point(n,90*e);for(;e*(n-=t)>=-180;)l.point(n,e*-Math.atan2(Math.cos(n*be/2),i)*_e);l.lineEnd(),l.polygonEnd()},s},r}function m(t){return t=Math.exp(2*t),(t-1)/(t+1)}function g(t){return.5*(Math.exp(t)-Math.exp(-t))}function v(t){return.5*(Math.exp(t)+Math.exp(-t))}function y(t){return Math.log(t+c(t*t+1))}function b(t){return Math.log(t+c(t*t-1))}function _(t,e){var i=Math.tan(e/2),n=c(1-i*i),r=1+n*Math.cos(t/=2),a=Math.sin(t)*n/r,o=i/r,s=a*a,l=o*o;return[4/3*a*(3+s-3*l),4/3*o*(3+3*s-l)]}function x(t,e){var i=Math.abs(e);return i<ge/4?[t,Math.log(Math.tan(ge/4+e/2))]:[t*Math.cos(i)*(2*Math.SQRT2-1/Math.sin(i)),o(e)*(2*Math.SQRT2*(i-ge/4)-Math.log(Math.tan(i/2)))]}function w(t){function e(t,e){var n=ze(t,e);if(Math.abs(t)>ve){var r=Math.atan2(n[1],n[0]),a=Math.sqrt(n[0]*n[0]+n[1]*n[1]),o=i*Math.round((r-ve)/i)+ve,l=Math.atan2(Math.sin(r-=o),2-Math.cos(r));r=o+s(ge/a*Math.sin(l))-l,n[0]=a*Math.cos(r),n[1]=a*Math.sin(r)}return n}var i=2*ge/t;return e.invert=function(t,e){var n=Math.sqrt(t*t+e*e);if(n>ve){var r=Math.atan2(e,t),a=i*Math.round((r-ve)/i)+ve,o=r>a?-1:1,s=n*Math.cos(a-r),l=1/Math.tan(o*Math.acos((s-ge)/Math.sqrt(ge*(ge-2*s)+n*n)));r=a+2*Math.atan((l+o*Math.sqrt(l*l-3))/3),t=n*Math.cos(r),e=n*Math.sin(r)}return ze.invert(t,e)},e}function M(){var t=5,e=we(w),i=e(t),n=i.stream,r=.01,a=-Math.cos(r*be),o=Math.sin(r*be);return i.lobes=function(i){return arguments.length?e(t=+i):t},i.stream=function(e){var l=i.rotate(),c=n(e),u=(i.rotate([0,0]),n(e));return i.rotate(l),c.sphere=function(){u.polygonStart(),u.lineStart();for(var e=0,i=360/t,n=2*ge/t,l=90-180/t,c=ve;e<t;++e,l-=i,c-=n)u.point(Math.atan2(o*Math.cos(c),a)*_e,s(o*Math.sin(c))*_e),l<-90?(u.point(-90,-180-l-r),u.point(-90,-180-l+r)):(u.point(90,l+r),u.point(90,l-r));u.lineEnd(),u.polygonEnd()},c},i}function z(t){return function(e){var i,n=t*Math.sin(e),r=30;do e-=i=(e+Math.sin(e)-n)/(1+Math.cos(e));while(Math.abs(i)>pe&&--r>0);return e/2}}function S(t,e,i){function n(i,n){return[t*i*Math.cos(n=r(n)),e*Math.sin(n)]}var r=z(i);return n.invert=function(n,r){var a=s(r/e);return[n/(t*Math.cos(a)),s((2*a+Math.sin(2*a))/i)]},n}function E(t,e){var i=2.00276,n=Se(e);return[i*t/(1/Math.cos(e)+1.11072/Math.cos(n)),(e+Math.SQRT2*Math.sin(n))/i]}function k(t){var e=0,i=we(t),n=i(e);return n.parallel=function(t){return arguments.length?i(e=t*ge/180):e/ge*180},n}function T(t,e){return[t*Math.cos(e),e]}function P(t){function e(e,n){var r=i+t-n,a=r?e*Math.cos(n)/r:r;return[r*Math.sin(a),i-r*Math.cos(a)]}if(!t)return T;var i=1/Math.tan(t);return e.invert=function(e,n){var r=Math.sqrt(e*e+(n=i-n)*n),a=i+t-r;return[r/Math.cos(a)*Math.atan2(e,n),a]},e}function O(t){function e(e,i){for(var n=Math.sin(i),r=Math.cos(i),a=new Array(3),c=0;c<3;++c){var u=t[c];if(a[c]=I(i-u[1],u[3],u[2],r,n,e-u[0]),!a[c][0])return u.point;a[c][1]=L(a[c][1]-u.v[1])}for(var h=l.slice(),c=0;c<3;++c){var d=2==c?0:c+1,f=C(t[c].v[0],a[c][0],a[d][0]);a[c][1]<0&&(f=-f),c?1==c?(f=o-f,h[0]-=a[c][0]*Math.cos(f),h[1]-=a[c][0]*Math.sin(f)):(f=s-f,h[0]+=a[c][0]*Math.cos(f),h[1]+=a[c][0]*Math.sin(f)):(h[0]+=a[c][0]*Math.cos(f),h[1]-=a[c][0]*Math.sin(f))}return h[0]/=3,h[1]/=3,h}t=t.map(function(t){return[t[0],t[1],Math.sin(t[1]),Math.cos(t[1])]});for(var i,n=t[2],r=0;r<3;++r,n=i)i=t[r],n.v=I(i[1]-n[1],n[3],n[2],i[3],i[2],i[0]-n[0]),n.point=[0,0];var a=C(t[0].v[0],t[2].v[0],t[1].v[0]),o=C(t[0].v[0],t[1].v[0],t[2].v[0]),s=ge-a;t[2].point[1]=0,t[0].point[0]=-(t[1].point[0]=.5*t[0].v[0]);var l=[t[2].point[0]=t[0].point[0]+t[2].v[0]*Math.cos(a),2*(t[0].point[1]=t[1].point[1]=t[2].v[0]*Math.sin(a))];return e}function A(){var t=[[0,0],[0,0],[0,0]],e=we(O),i=e(t),n=i.rotate;return delete i.rotate,i.points=function(r){if(!arguments.length)return t;t=r;var a=d3.geoCentroid({type:"MultiPoint",coordinates:t}),o=[-a[0],-a[1]];return n.call(i,o),e(t.map(d3.geoRotation(o)).map(D))},i.points([[-150,55],[-35,55],[-92.5,10]])}function I(t,e,i,n,r,a){var o,c=Math.cos(a);if(Math.abs(t)>1||Math.abs(a)>1)o=l(i*r+e*n*c);else{var u=Math.sin(.5*t),h=Math.sin(.5*a);o=2*s(Math.sqrt(u*u+e*n*h*h))}return Math.abs(o)>pe?[o,Math.atan2(n*Math.sin(a),e*r-i*n*c)]:[0,0]}function C(t,e,i){return l(.5*(t*t+e*e-i*i)/(t*e))}function L(t){return t-2*ge*Math.floor((t+ge)/(2*ge))}function D(t){return[t[0]*be,t[1]*be]}function R(t,e){var i=c(1-Math.sin(e));return[2/ye*t*i,ye*(1-i)]}function B(t){function e(t,e){return[t,(t?t/Math.sin(t):1)*(Math.sin(e)*Math.cos(t)-i*Math.cos(e))]}var i=Math.tan(t);return e.invert=i?function(t,e){t&&(e*=Math.sin(t)/t);var n=Math.cos(t);return[t,2*Math.atan2(Math.sqrt(n*n+i*i-e*e)-n,i-e)]}:function(t,e){return[t,s(t?e*Math.tan(t)/t:e)]},e}function j(t,e){var i=Math.sqrt(3);return[i*t*(2*Math.cos(2*e/3)-1)/ye,i*ye*Math.sin(e/3)]}function F(t){function e(t,e){return[t*i,Math.sin(e)/i]}var i=Math.cos(t);return e.invert=function(t,e){return[t/i,s(e*i)]},e}function N(t){function e(t,e){return[t*i,(1+i)*Math.tan(.5*e)]}var i=Math.cos(t);return e.invert=function(t,e){return[t/i,2*Math.atan(e/(1+i))]},e}function q(t,e){var i=Math.sqrt(8/(3*ge));return[i*t*(1-Math.abs(e)/ge),i*e]}function V(t,e){var i=Math.sqrt(4-3*Math.sin(Math.abs(e)));return[2/Math.sqrt(6*ge)*t*i,o(e)*Math.sqrt(2*ge/3)*(2-i)]}function U(t,e){var i=Math.sqrt(ge*(4+ge));return[2/i*t*(1+Math.sqrt(1-4*e*e/(ge*ge))),4/i*e]}function H(t,e){var i=(2+ve)*Math.sin(e);e/=2;for(var n=0,r=1/0;n<10&&Math.abs(r)>pe;n++){var a=Math.cos(e);e-=r=(e+Math.sin(e)*(a+2)-i)/(2*a*(1+a))}return[2/Math.sqrt(ge*(4+ge))*t*(1+Math.cos(e)),2*Math.sqrt(ge/(4+ge))*Math.sin(e)]}function X(t,e){return[t*(1+Math.cos(e))/Math.sqrt(2+ge),2*e/Math.sqrt(2+ge)]}function Y(t,e){for(var i=(1+ve)*Math.sin(e),n=0,r=1/0;n<10&&Math.abs(r)>pe;n++)e-=r=(e+Math.sin(e)-i)/(1+Math.cos(e));return i=Math.sqrt(2+ge),[t*(1+Math.cos(e))/i,2*e/i]}function W(t,e){var i=Math.sin(t/=2),n=Math.cos(t),r=Math.sqrt(Math.cos(e)),a=Math.cos(e/=2),o=Math.sin(e)/(a+Math.SQRT2*n*r),s=Math.sqrt(2/(1+o*o)),l=Math.sqrt((Math.SQRT2*a+(n+i)*r)/(Math.SQRT2*a+(n-i)*r));return[Te*(s*(l-1/l)-2*Math.log(l)),Te*(s*o*(l+1/l)-2*Math.atan(o))]}function G(t,e){var i=Math.tan(e/2);return[t*Pe*c(1-i*i),(1+Pe)*i]}function K(t,e){var i=e/2,n=Math.cos(i);return[2*t/ye*Math.cos(e)*n*n,ye*Math.tan(i)];
}function Z(t,e){function i(e,i){var a=Oe(e,i),o=a[0],s=a[1],l=o*o+s*s;if(l>r){var c=Math.sqrt(l),u=Math.atan2(s,o),h=n*Math.round(u/n),d=u-h,f=t*Math.cos(d),p=(t*Math.sin(d)-d*Math.sin(f))/(ve-f),m=Q(d,p),g=(ge-t)/$(m,f,ge);o=c;var v,y=50;do o-=v=(t+$(m,f,o)*g-c)/(m(o)*g);while(Math.abs(v)>pe&&--y>0);s=d*Math.sin(o),o<ve&&(s-=p*(o-ve));var b=Math.sin(h),_=Math.cos(h);a[0]=o*_-s*b,a[1]=o*b+s*_}return a}var n=2*ge/e,r=t*t;return i.invert=function(e,i){var a=e*e+i*i;if(a>r){var o=Math.sqrt(a),s=Math.atan2(i,e),l=n*Math.round(s/n),c=s-l,e=o*Math.cos(c);i=o*Math.sin(c);for(var u=e-ve,h=Math.sin(e),d=i/h,f=e<ve?1/0:0,p=10;;){var m=t*Math.sin(d),g=t*Math.cos(d),v=Math.sin(g),y=ve-g,b=(m-d*v)/y,_=Q(d,b);if(Math.abs(f)<me||!--p)break;d-=f=(d*h-b*u-i)/(h-2*u*(y*(g+d*m*Math.cos(g)-v)-m*(m-d*v))/(y*y))}o=t+$(_,g,e)*(ge-t)/$(_,g,ge),s=l+d,e=o*Math.cos(s),i=o*Math.sin(s)}return Oe.invert(e,i)},i}function Q(t,e){return function(i){var n=t*Math.cos(i);return i<ve&&(n-=e),Math.sqrt(1+n*n)}}function J(){var t=6,e=30*be,i=Math.cos(e),n=Math.sin(e),r=we(Z),a=r(e,t),o=a.stream,s=.01,l=-Math.cos(s*be),c=Math.sin(s*be);return a.radius=function(a){return arguments.length?(i=Math.cos(e=a*be),n=Math.sin(e),r(e,t)):e*_e},a.lobes=function(i){return arguments.length?r(e,t=+i):t},a.stream=function(e){var r=a.rotate(),s=o(e),u=(a.rotate([0,0]),o(e));return a.rotate(r),s.sphere=function(){u.polygonStart(),u.lineStart();for(var e=0,r=2*ge/t,a=0;e<t;++e,a-=r)u.point(Math.atan2(c*Math.cos(a),l)*_e,Math.asin(c*Math.sin(a))*_e),u.point(Math.atan2(n*Math.cos(a-r/2),i)*_e,Math.asin(n*Math.sin(a-r/2))*_e);u.lineEnd(),u.polygonEnd()},s},a}function $(t,e,i){for(var n=50,r=(i-e)/n,a=t(e)+t(i),o=1,s=e;o<n;++o)a+=2*t(s+=r);return.5*a*r}function tt(t,e,i,n,r,a,o,s){function l(l,c){if(!c)return[t*l/ge,0];var u=c*c,h=t+u*(e+u*(i+u*n)),d=c*(r-1+u*(a-s+u*o)),f=(h*h+d*d)/(2*d),p=l*Math.asin(h/f)/ge;return[f*Math.sin(p),c*(1+u*s)+f*(1-Math.cos(p))]}return arguments.length<8&&(s=0),l.invert=function(l,u){var h,d,f=ge*l/t,p=u,m=50;do{var g=p*p,v=t+g*(e+g*(i+g*n)),y=p*(r-1+g*(a-s+g*o)),b=v*v+y*y,_=2*y,x=b/_,w=x*x,M=Math.asin(v/x)/ge,z=f*M;if(xB2=v*v,dxBd=(2*e+g*(4*i+6*g*n))*p,dyBd=r+g*(3*a+5*g*o),dpd=2*(v*dxBd+y*(dyBd-1)),dqd=2*(dyBd-1),dmd=(dpd*_-b*dqd)/(_*_),cos=Math.cos(z),sin=Math.sin(z),mcos=x*cos,msin=x*sin,dd=f/ge*(1/c(1-xB2/w))*(dxBd*x-v*dmd)/w,fx=msin-l,fy=p*(1+g*s)+x-mcos-u,x=dmd*sin+mcos*dd,x=mcos*M,y=1+dmd-(dmd*cos-msin*dd),y=msin*M,denominator=x*y-y*x,!denominator)break;f-=h=(fy*x-fx*y)/denominator,p-=d=(fx*y-fy*x)/denominator}while((Math.abs(h)>pe||Math.abs(d)>pe)&&--m>0);return[f,p]},l}function et(t,e){var i=t*t,n=e*e;return[t*(1-.162388*n)*(.87-952426e-9*i*i),e*(1+n/12)]}function it(t){function e(){var t=!1,e=we(i),n=e(t);return n.quincuncial=function(i){return arguments.length?e(t=!!i):t},n}function i(e){var i=e?function(e,i){var r=Math.abs(e)<ve,a=t(r?e:e>0?e-ge:e+ge,i),s=(a[0]-a[1])*Math.SQRT1_2,l=(a[0]+a[1])*Math.SQRT1_2;if(r)return[s,l];var c=n*Math.SQRT1_2,u=s>0^l>0?-1:1;return[u*s-o(l)*c,u*l-o(s)*c]}:function(e,i){var r=e>0?-.5:.5,a=t(e+r*ge,i);return a[0]-=r*n,a};return t.invert&&(i.invert=e?function(e,i){var r=(e+i)*Math.SQRT1_2,a=(i-e)*Math.SQRT1_2,o=Math.abs(r)<.5*n&&Math.abs(a)<.5*n;if(!o){var s=n*Math.SQRT1_2,l=r>0^a>0?-1:1,c=-l*(e+(a>0?1:-1)*s),u=-l*(i+(r>0?1:-1)*s);r=(-c-u)*Math.SQRT1_2,a=(c-u)*Math.SQRT1_2}var h=t.invert(r,a);return o||(h[0]+=r>0?ge:-ge),h}:function(e,i){var r=e>0?-.5:.5,a=t.invert(e+r*n,i),o=a[0]-r*ge;return o<-ge?o+=2*ge:o>ge&&(o-=2*ge),a[0]=o,a}),i}var n=t(ve,0)[0]-t(-ve,0)[0];return e.raw=i,e}function nt(t,e){var i=o(t),n=o(e),r=Math.cos(e),a=Math.cos(t)*r,l=Math.sin(t)*r,c=Math.sin(n*e);t=Math.abs(Math.atan2(l,c)),e=s(a),Math.abs(t-ve)>pe&&(t%=ve);var u=rt(t>ge/4?ve-t:t,e);return t>ge/4&&(c=u[0],u[0]=-u[1],u[1]=-c),u[0]*=i,u[1]*=-n,u}function rt(t,e){if(e===ve)return[0,0];var i=Math.sin(e),n=i*i,r=n*n,a=1+r,o=1+3*r,l=1-r,u=s(1/Math.sqrt(a)),h=l+n*a*u,d=(1-i)/h,f=Math.sqrt(d),p=d*a,m=Math.sqrt(p),g=f*l;if(0===t)return[0,-(g+n*m)];var v=Math.cos(e),y=1/v,b=2*i*v,_=(-3*n+u*o)*b,x=(-h*v-(1-i)*_)/(h*h),w=.5*x/f,M=l*w-2*n*f*b,z=n*a*x+d*o*b,S=-y*b,E=-y*z,k=-2*y*M,T=4*t/ge;if(t>.222*ge||e<ge/4&&t>.175*ge){var P=(g+n*c(p*(1+r)-g*g))/(1+r);if(t>ge/4)return[P,P];var O=P,A=.5*P,I=50;P=.5*(A+O);do{var C=Math.sqrt(p-P*P),L=P*(k+S*C)+E*s(P/m)-T;if(!L)break;L<0?A=P:O=P,P=.5*(A+O)}while(Math.abs(O-A)>pe&&--I>0)}else{var D,P=pe,I=25;do{var R=P*P,C=c(p-R),B=k+S*C,L=P*B+E*s(P/m)-T,j=B+(E-S*R)/C;P-=D=C?L/j:0}while(Math.abs(D)>pe&&--I>0)}return[P,-g-n*c(p-P*P)]}function at(t,e){for(var i=0,n=1,r=.5,a=50;;){var o=r*r,s=Math.sqrt(r),l=Math.asin(1/Math.sqrt(1+o)),c=1-o+r*(1+o)*l,u=(1-s)/c,h=Math.sqrt(u),d=u*(1+o),f=h*(1-o),p=d-t*t,m=Math.sqrt(p),g=e+f+r*m;if(Math.abs(n-i)<me||0===--a||0===g)break;g>0?i=r:n=r,r=.5*(i+n)}if(!a)return null;var v=Math.asin(s),y=Math.cos(v),b=1/y,_=2*s*y,x=(-3*r+l*(1+3*o))*_,w=(-c*y-(1-s)*x)/(c*c),M=.5*w/h,z=(1-o)*M-2*r*h*_,S=-2*b*z,E=-b*_,k=-b*(r*(1+o)*w+u*(1+3*o)*_);return[ge/4*(t*(S+E*m)+k*Math.asin(t/Math.sqrt(d))),v]}function ot(t,e,i){if(!t){var n=st(e,1-i);return[[0,n[0]/n[1]],[1/n[1],0],[n[2]/n[1],0]]}var r=st(t,i);if(!e)return[[r[0],0],[r[1],0],[r[2],0]];var n=st(e,1-i),a=n[1]*n[1]+i*r[0]*r[0]*n[0]*n[0];return[[r[0]*n[2]/a,r[1]*r[2]*n[0]*n[1]/a],[r[1]*n[1]/a,-r[0]*r[2]*n[0]*n[2]/a],[r[2]*n[1]*n[2]/a,-i*r[0]*r[1]*n[0]/a]]}function st(t,e){var i,n,r,a,o;if(e<pe)return a=Math.sin(t),n=Math.cos(t),i=.25*e*(t-a*n),[a-i*n,n+i*a,1-.5*e*a*a,t-i];if(e>=1-pe)return i=.25*(1-e),n=v(t),a=m(t),r=1/n,o=n*g(t),[a+i*(o-t)/(n*n),r-i*a*r*(o-t),r+i*a*r*(o+t),2*Math.atan(Math.exp(t))-ve+i*(o-t)/n];var l=[1,0,0,0,0,0,0,0,0],u=[Math.sqrt(e),0,0,0,0,0,0,0,0],h=0;for(n=Math.sqrt(1-e),o=1;Math.abs(u[h]/l[h])>pe&&h<8;)i=l[h++],u[h]=.5*(i-n),l[h]=.5*(i+n),n=c(i*n),o*=2;r=o*l[h]*t;do a=u[h]*Math.sin(n=r)/l[h],r=.5*(s(a)+r);while(--h);return[Math.sin(r),a=Math.cos(r),a/Math.cos(r-n),r]}function lt(t,e,i){var n=Math.abs(t),r=Math.abs(e),a=g(r);if(n){var s=1/Math.sin(n),l=1/(Math.tan(n)*Math.tan(n)),u=-(l+i*a*a*s*s-1+i),h=(i-1)*l,d=.5*(-u+Math.sqrt(u*u-4*h));return[ct(Math.atan(1/Math.sqrt(d)),i)*o(t),ct(Math.atan(c((d/l-1)/i)),1-i)*o(e)]}return[0,ct(Math.atan(a),1-i)*o(e)]}function ct(t,e){if(!e)return t;if(1===e)return Math.log(Math.tan(t/2+ge/4));for(var i=1,n=Math.sqrt(1-e),r=Math.sqrt(e),a=0;Math.abs(r)>pe;a++){if(t%ge){var o=Math.atan(n*Math.tan(t)/i);o<0&&(o+=ge),t+=o+~~(t/ge)*ge}else t+=t;r=(i+n)/2,n=Math.sqrt(i*n),r=((i=r)-n)/2}return t/(Math.pow(2,a)*i)}function ut(t,e){var i=(Math.SQRT2-1)/(Math.SQRT2+1),n=Math.sqrt(1-i*i),r=ct(ve,n*n),a=-1,o=Math.log(Math.tan(ge/4+Math.abs(e)/2)),s=Math.exp(a*o)/Math.sqrt(i),l=ht(s*Math.cos(a*t),s*Math.sin(a*t)),c=lt(l[0],l[1],n*n);return[-c[1],(e>=0?1:-1)*(.5*r-c[0])]}function ht(t,e){var i=t*t,n=e+1,r=1-i-e*e;return[.5*((t>=0?ve:-ve)-Math.atan2(r,2*t)),-.25*Math.log(r*r+4*i)+.5*Math.log(n*n+i)]}function dt(t,e){var i=e[0]*e[0]+e[1]*e[1];return[(t[0]*e[0]+t[1]*e[1])/i,(t[1]*e[0]-t[0]*e[1])/i]}function ft(t){function e(t,e){var a=r(t,e);t=a[0],e=a[1];var o=Math.sin(e),s=Math.cos(e),c=Math.cos(t),u=l(i*o+n*s*c),h=Math.sin(u),d=Math.abs(h)>pe?u/h:1;return[d*n*Math.sin(t),(Math.abs(t)>ve?d:-d)*(i*s-n*o*c)]}var i=Math.sin(t),n=Math.cos(t),r=pt(t);return r.invert=pt(-t),e.invert=function(t,e){var n=Math.sqrt(t*t+e*e),a=-Math.sin(n),o=Math.cos(n),s=n*o,l=-e*a,u=n*i,h=c(s*s+l*l-u*u),d=Math.atan2(s*u+l*h,l*u-s*h),f=(n>ve?-1:1)*Math.atan2(t*a,n*Math.cos(d)*o+e*Math.sin(d)*a);return r.invert(f,d)},e}function pt(t){var e=Math.sin(t),i=Math.cos(t);return function(t,n){var r=Math.cos(n),a=Math.cos(t)*r,o=Math.sin(t)*r,l=Math.sin(n);return[Math.atan2(o,a*i-l*e),s(l*i+a*e)]}}function mt(){var t=0,e=we(ft),i=e(t),n=i.rotate,r=i.stream,a=d3.geoCircle();return i.parallel=function(n){if(!arguments.length)return t/ge*180;var r=i.rotate();return e(t=n*ge/180).rotate(r)},i.rotate=function(e){return arguments.length?(n.call(i,[e[0],e[1]-t/ge*180]),a.center([-e[0],-e[1]]),i):(e=n.call(i),e[1]+=t/ge*180,e)},i.stream=function(t){return t=r(t),t.sphere=function(){t.polygonStart();var e,i=.01,n=a.radius(90-i)().coordinates[0],r=n.length-1,o=-1;for(t.lineStart();++o<r;)t.point((e=n[o])[0],e[1]);for(t.lineEnd(),n=a.radius(90+i)().coordinates[0],r=n.length-1,t.lineStart();--o>=0;)t.point((e=n[o])[0],e[1]);t.lineEnd(),t.polygonEnd()},t},i}function gt(t,e){function i(i,n){var r=De(i/e,n);return r[0]*=t,r}return arguments.length<2&&(e=t),1===e?De:e===1/0?yt:(i.invert=function(i,n){var r=De.invert(i/t,n);return r[0]*=e,r},i)}function vt(){var t=2,e=we(gt),i=e(t);return i.coefficient=function(i){return arguments.length?e(t=+i):t},i}function yt(t,e){return[t*Math.cos(e)/Math.cos(e/=2),2*Math.sin(e)]}function bt(t,e){for(var i,n=Math.sin(e)*(e<0?2.43763:2.67595),r=0;r<20&&(e-=i=(e+Math.sin(e)-n)/(1+Math.cos(e)),!(Math.abs(i)<pe));r++);return[.85*t*Math.cos(e*=.5),Math.sin(e)*(e<0?1.93052:1.75859)]}function _t(t){function e(e,u){var h,d=Math.abs(u);if(d>n){var f=Math.min(t-1,Math.max(0,Math.floor((e+ge)/c)));e+=ge*(t-1)/t-f*c,h=d3.geoCollignon.raw(e,d),h[0]=h[0]*r/a-r*(t-1)/(2*t)+f*r/t,h[1]=o+4*(h[1]-s)*l/r,u<0&&(h[1]=-h[1])}else h=i(e,u);return h[0]/=2,h}var i=d3.geoCylindricalEqualArea.raw(0),n=Re*ge/180,r=2*ge,a=d3.geoCollignon.raw(ge,n)[0]-d3.geoCollignon.raw(-ge,n)[0],o=i(0,n)[1],s=d3.geoCollignon.raw(0,n)[1],l=d3.geoCollignon.raw(0,ve)[1]-s,c=2*ge/t;return e.invert=function(e,n){e*=2;var u=Math.abs(n);if(u>o){var h=Math.min(t-1,Math.max(0,Math.floor((e+ge)/c)));e=(e+ge*(t-1)/t-h*c)*a/r;var d=d3.geoCollignon.raw.invert(e,.25*(u-o)*r/l+s);return d[0]-=ge*(t-1)/t-h*c,n<0&&(d[1]=-d[1]),d}return i.invert(e,n)},e}function xt(){function t(){var t=180/e;return{type:"Polygon",coordinates:[d3.range(-180,180+t/2,t).map(function(t,e){return[t,1&e?90-1e-6:Re]}).concat(d3.range(180,-180-t/2,-t).map(function(t,e){return[t,1&e?-90+1e-6:-Re]}))]}}var e=2,i=we(_t),n=i(e),r=n.stream;return n.lobes=function(t){return arguments.length?i(e=+t):e},n.stream=function(e){var i=n.rotate(),a=r(e),o=(n.rotate([0,0]),r(e));return n.rotate(i),a.sphere=function(){d3.geoStream(t(),o)},a},n}function wt(t){function e(e,r){var s,l,d=1-Math.sin(r);if(d&&d<2){var f,p=ve-r,m=25;do{var g=Math.sin(p),v=Math.cos(p),y=a+Math.atan2(g,n-v),b=1+h-2*n*v;p-=f=(p-u*a-n*g+b*y-.5*d*i)/(2*n*g*y)}while(Math.abs(f)>me&&--m>0);s=o*Math.sqrt(b),l=e*y/ge}else s=o*(t+d),l=e*a/ge;return[s*Math.sin(l),c-s*Math.cos(l)]}var i,n=1+t,r=Math.sin(1/n),a=s(r),o=2*Math.sqrt(ge/(i=ge+4*a*n)),c=.5*o*(n+Math.sqrt(t*(2+t))),u=t*t,h=n*n;return e.invert=function(t,e){var r=t*t+(e-=c)*e,d=(1+h-r/(o*o))/(2*n),f=l(d),p=Math.sin(f),m=a+Math.atan2(p,n-d);return[s(t/Math.sqrt(r))*ge/m,s(1-2*(f-u*a-n*p+(1+h-2*n*d)*m)/i)]},e}function Mt(){var t=1,e=we(wt),i=e(t);return i.ratio=function(i){return arguments.length?e(t=+i):t},i}function zt(t,e){return e>-Be?(t=Ee(t,e),t[1]+=je,t):T(t,e)}function St(t,e){return Math.abs(e)>Be?(t=Ee(t,e),t[1]-=e>0?je:-je,t):T(t,e)}function Et(t,e){return[3*t/(2*ge)*Math.sqrt(ge*ge/3-e*e),e]}function kt(t){function e(e,i){if(Math.abs(Math.abs(i)-ve)<pe)return[0,i<0?-2:2];var n=Math.sin(i),r=Math.pow((1+n)/(1-n),t/2),a=.5*(r+1/r)+Math.cos(e*=t);return[2*Math.sin(e)/a,(r-1/r)/a]}return e.invert=function(e,i){var n=Math.abs(i);if(Math.abs(n-2)<pe)return e?null:[0,o(i)*ve];if(n>2)return null;e/=2,i/=2;var r=e*e,a=i*i,l=2*i/(1+r+a);return l=Math.pow((1+l)/(1-l),1/t),[Math.atan2(2*e,1-r-a)/t,s((l-1)/(l+1))]},e}function Tt(){var t=.5,e=we(kt),i=e(t);return i.spacing=function(i){return arguments.length?e(t=+i):t},i}function Pt(t,e){return[t*(1+Math.sqrt(Math.cos(e)))/2,e/(Math.cos(e/2)*Math.cos(t/6))]}function Ot(t,e){var i=t*t,n=e*e;return[t*(.975534+n*(-.119161+i*-.0143059+n*-.0547009)),e*(1.00384+i*(.0802894+n*-.02855+199025e-9*i)+n*(.0998909+n*-.0491032))]}function At(t,e){return[Math.sin(t)/Math.cos(e),Math.tan(e)*Math.cos(t)]}function It(t){function e(e,r){var a=r-t,o=Math.abs(a)<pe?e*i:Math.abs(o=ge/4+r/2)<pe||Math.abs(Math.abs(o)-ve)<pe?0:e*a/Math.log(Math.tan(o)/n);return[o,a]}var i=Math.cos(t),n=Math.tan(ge/4+t/2);return e.invert=function(e,r){var a,o=r+t;return[Math.abs(r)<pe?e/i:Math.abs(a=ge/4+o/2)<pe||Math.abs(Math.abs(a)-ve)<pe?0:e*Math.log(Math.tan(a)/n)/r,o]},e}function Ct(t,e){return[t,1.25*Math.log(Math.tan(ge/4+.4*e))]}function Lt(t){function e(e,n){for(var r,a=Math.cos(n),o=2/(1+a*Math.cos(e)),s=o*a*Math.sin(e),l=o*Math.sin(n),c=i,u=t[c],h=u[0],d=u[1];--c>=0;)u=t[c],h=u[0]+s*(r=h)-l*d,d=u[1]+s*d+l*r;return h=s*(r=h)-l*d,d=s*d+l*r,[h,d]}var i=t.length-1;return e.invert=function(e,n){var r=20,a=e,o=n;do{for(var l,c=i,u=t[c],h=u[0],d=u[1],f=0,p=0;--c>=0;)u=t[c],f=h+a*(l=f)-o*p,p=d+a*p+o*l,h=u[0]+a*(l=h)-o*d,d=u[1]+a*d+o*l;f=h+a*(l=f)-o*p,p=d+a*p+o*l,h=a*(l=h)-o*d-e,d=a*d+o*l-n;var m,g,v=f*f+p*p;a-=m=(h*f+d*p)/v,o-=g=(d*f-h*p)/v}while(Math.abs(m)+Math.abs(g)>pe*pe&&--r>0);if(r){var y=Math.sqrt(a*a+o*o),b=2*Math.atan(.5*y),_=Math.sin(b);return[Math.atan2(a*_,y*Math.cos(b)),y?s(o*_/y):0]}},e}function Dt(){var t=Fe.miller,e=we(Lt),i=e(t);return i.coefficients=function(i){return arguments.length?e(t="string"==typeof i?Fe[i]:i):t},i}function Rt(t,e){var i=Math.sqrt(6),n=Math.sqrt(7),r=Math.asin(7*Math.sin(e)/(3*i));return[i*t*(2*Math.cos(2*r/3)-1)/n,9*Math.sin(r/3)/n]}function Bt(t,e){for(var i,n=(1+Math.SQRT1_2)*Math.sin(e),r=e,a=0;a<25&&(r-=i=(Math.sin(r/2)+Math.sin(r)-n)/(.5*Math.cos(r/2)+Math.cos(r)),!(Math.abs(i)<pe));a++);return[t*(1+2*Math.cos(r)/Math.cos(r/2))/(3*Math.SQRT2),2*Math.sqrt(3)*Math.sin(r/2)/Math.sqrt(2+Math.SQRT2)]}function jt(t,e){for(var i,n=Math.sqrt(6/(4+ge)),r=(1+ge/4)*Math.sin(e),a=e/2,o=0;o<25&&(a-=i=(a/2+Math.sin(a)-r)/(.5+Math.cos(a)),!(Math.abs(i)<pe));o++);return[n*(.5+Math.cos(a))*t/1.5,n*a]}function Ft(t,e){var i=e*e,n=i*i;return[t*(.8707-.131979*i+n*(-.013791+n*(.003971*i-.001529*n))),e*(1.007226+i*(.015085+n*(-.044475+.028874*i-.005916*n)))]}function Nt(t,e){return[t*(1+Math.cos(e))/2,2*(e-Math.tan(e/2))]}function qt(t,e){var i=e*e;return[t,e*(Ne+i*i*(qe+i*(Ve+Ue*i)))]}function Vt(t,e){if(Math.abs(e)<pe)return[t,0];var i=Math.tan(e),n=t*Math.sin(e);return[Math.sin(n)/i,e+(1-Math.cos(n))/i]}function Ut(t){function e(e,n){var r=i?Math.tan(e*i/2)/i:e/2;if(!n)return[2*r,-t];var a=2*Math.atan(r*Math.sin(n)),o=1/Math.tan(n);return[Math.sin(a)*o,n+(1-Math.cos(a))*o-t]}var i=Math.sin(t);return e.invert=function(e,n){if(Math.abs(n+=t)<pe)return[i?2*Math.atan(i*e/2)/i:e,0];var r,a=e*e+n*n,o=0,c=10;do{var u=Math.tan(o),h=1/Math.cos(o),d=a-2*n*o+o*o;o-=r=(u*d+2*(o-n))/(2+d*h*h+2*(o-n)*u)}while(Math.abs(r)>pe&&--c>0);var f=e*(u=Math.tan(o)),p=Math.tan(Math.abs(n)<Math.abs(o+1/u)?.5*s(f):.5*l(f)+ge/4)/Math.sin(o);return[i?2*Math.atan(i*p)/i:2*p,o]},e}function Ht(t,e){var i,n=Math.min(18,36*Math.abs(e)/ge),r=Math.floor(n),a=n-r,o=(i=Ze[r])[0],s=i[1],l=(i=Ze[++r])[0],c=i[1],u=(i=Ze[Math.min(19,++r)])[0],h=i[1];return[t*(l+a*(u-o)/2+a*a*(u-2*l+o)/2),(e>0?ve:-ve)*(c+a*(h-s)/2+a*a*(h-2*c+s)/2)]}function Xt(t){function e(e,i){var n=Math.cos(i),r=(t-1)/(t-n*Math.cos(e));return[r*n*Math.sin(e),r*Math.sin(i)]}return e.invert=function(e,i){var n=e*e+i*i,r=Math.sqrt(n),a=(t-Math.sqrt(1-n*(t+1)/(t-1)))/((t-1)/r+r/(t-1));return[Math.atan2(e*a,r*Math.sqrt(1-a*a)),r?s(i*a/r):0]},e}function Yt(t,e){function i(e,i){var o=n(e,i),s=o[1],l=s*a/(t-1)+r;return[o[0]*r/l,s/l]}var n=Xt(t);if(!e)return n;var r=Math.cos(e),a=Math.sin(e);return i.invert=function(e,i){var o=(t-1)/(t-1-i*a);return n.invert(o*e,o*i*r)},i}function Wt(){var t=1.4,e=0,i=we(Yt),n=i(t,e);return n.distance=function(n){return arguments.length?i(t=+n,e):t},n.tilt=function(n){return arguments.length?i(t,e=n*ge/180):180*e/ge},n}function Gt(t,e){var i=Math.tan(e/2),n=Math.sin(ge/4*i);return[t*(.74482-.34588*n*n),1.70711*i]}function Kt(t){function e(e,a){var o=l(Math.cos(a)*Math.cos(e-i)),s=l(Math.cos(a)*Math.cos(e-n)),u=a<0?-1:1;return o*=o,s*=s,[(o-s)/(2*t),u*c(4*r*s-(r-o+s)*(r-o+s))/(2*t)]}if(!t)return d3.geoAzimuthalEquidistant.raw;var i=-t/2,n=-i,r=t*t,a=Math.tan(n),o=.5/Math.sin(n);return e.invert=function(t,e){var r,s,c=e*e,u=Math.cos(Math.sqrt(c+(r=t+i)*r)),h=Math.cos(Math.sqrt(c+(r=t+n)*r));return[Math.atan2(s=u-h,r=(u+h)*a),(e<0?-1:1)*l(Math.sqrt(r*r+s*s)*o)]},e}function Zt(){var t=[[0,0],[0,0]],e=we(Kt),i=e(0),n=i.rotate;return delete i.rotate,i.points=function(i){if(!arguments.length)return t;t=i;var r=d3.geoInterpolate(i[0],i[1]),a=r(.5),o=d3.geoRotation([-a[0],-a[1]])(i[0]),l=.5*r.distance,c=-s(Math.sin(o[1]*be)/Math.sin(l));return o[0]>0&&(c=ge-c),n.call(o,[-a[0],-a[1],-c*_e]),e(2*l)},i}function Qt(t){function e(t,e){var n=d3.geoGnomonic.raw(t,e);return n[0]*=i,n}var i=Math.cos(t);return e.invert=function(t,e){return d3.geoGnomonic.raw.invert(t/i,e)},e}function Jt(){var t=[[0,0],[0,0]],e=we(Qt),i=e(0),n=i.rotate;return delete i.rotate,i.points=function(i){if(!arguments.length)return t;t=i;var r=d3.geoInterpolate(i[0],i[1]),a=r(.5),o=d3.geoRotation([-a[0],-a[1]])(i[0]),l=.5*r.distance,c=-s(Math.sin(o[1]*be)/Math.sin(l));return o[0]>0&&(c=ge-c),n.call(o,[-a[0],-a[1],-c*_e]),e(l)},i}function $t(t,e){if(Math.abs(e)<pe)return[t,0];var i=Math.abs(e/ve),n=s(i);if(Math.abs(t)<pe||Math.abs(Math.abs(e)-ve)<pe)return[0,o(e)*ge*Math.tan(n/2)];var r=Math.cos(n),a=Math.abs(ge/t-t/ge)/2,l=a*a,c=r/(i+r-1),u=c*(2/i-1),h=u*u,d=h+l,f=c-h,p=l+c;return[o(t)*ge*(a*f+Math.sqrt(l*f*f-d*(c*c-h)))/d,o(e)*ge*(u*p-a*Math.sqrt((l+1)*d-p*p))/d]}function te(t,e){if(Math.abs(e)<pe)return[t,0];var i=Math.abs(e/ve),n=s(i);if(Math.abs(t)<pe||Math.abs(Math.abs(e)-ve)<pe)return[0,o(e)*ge*Math.tan(n/2)];var r=Math.cos(n),a=Math.abs(ge/t-t/ge)/2,l=a*a,u=r*(Math.sqrt(1+l)-a*r)/(1+l*i*i);return[o(t)*ge*u,o(e)*ge*c(1-u*(2*a+u))]}function ee(t,e){if(Math.abs(e)<pe)return[t,0];var i=e/ve,n=s(i);if(Math.abs(t)<pe||Math.abs(Math.abs(e)-ve)<pe)return[0,ge*Math.tan(n/2)];var r=(ge/t-t/ge)/2,a=i/(1+Math.cos(n));return[ge*(o(t)*c(r*r+1-a*a)-r),ge*a]}function ie(t,e){if(!e)return[t,0];var i=Math.abs(e);if(!t||i===ve)return[0,e];var n=i/ve,r=n*n,a=(8*n-r*(r+2)-5)/(2*r*(n-1)),s=a*a,l=n*a,u=r+s+2*l,h=n+3*a,d=t/ve,f=d+1/d,p=o(Math.abs(t)-ve)*Math.sqrt(f*f-4),m=p*p,g=u*(r+s*m-1)+(1-r)*(r*(h*h+4*s)+12*l*s+4*s*s),v=(p*(u+s-1)+2*c(g))/(4*u+m);return[o(t)*ve*v,o(e)*ve*c(1+p*Math.abs(v)-v*v)]}function ne(t,e){return[t*Math.sqrt(1-3*e*e/(ge*ge)),e]}function re(t,e){var i=.90631*Math.sin(e),n=Math.sqrt(1-i*i),r=Math.sqrt(2/(1+n*Math.cos(t/=3)));return[2.66723*n*r*Math.sin(t),1.24104*i*r]}function ae(t,e){var i=Math.cos(e),n=Math.cos(t)*i,r=1-n,a=Math.cos(t=Math.atan2(Math.sin(t)*i,-Math.sin(e))),o=Math.sin(t);return i=c(1-n*n),[o*i-a*r,-a*i-o*r]}function oe(t,e){var i=d(t,e);return[(i[0]+t/ve)/2,(i[1]+e)/2]}d3.geoProject=function(t,i){var n=i.stream;if(!n)throw new Error("not yet supported");return(t&&se.hasOwnProperty(t.type)?se[t.type]:e)(t,n)};var se={Feature:t,FeatureCollection:function(e,i){return{type:"FeatureCollection",features:e.features.map(function(e){return t(e,i)})}}},le=[],ce=[],ue={point:function(t,e){le.push([t,e])},result:function t(){var t=le.length?le.length<2?{type:"Point",coordinates:le[0]}:{type:"MultiPoint",coordinates:le}:null;return le=[],t}},he={lineStart:i,point:function(t,e){le.push([t,e])},lineEnd:function(){le.length&&(ce.push(le),le=[])},result:function t(){var t=ce.length?ce.length<2?{type:"LineString",coordinates:ce[0]}:{type:"MultiLineString",coordinates:ce}:null;return ce=[],t}},de={polygonStart:i,lineStart:i,point:function(t,e){le.push([t,e])},lineEnd:function(){var t=le.length;if(t){do le.push(le[0].slice());while(++t<4);ce.push(le),le=[]}},polygonEnd:i,result:function(){if(!ce.length)return null;var t=[],e=[];return ce.forEach(function(i){n(i)?t.push([i]):e.push(i)}),e.forEach(function(e){var i=e[0];t.some(function(t){return!!r(t[0],i)&&(t.push(e),!0)})||t.push([e])}),ce=[],t.length?t.length>1?{type:"MultiPolygon",coordinates:t}:{type:"Polygon",coordinates:t[0]}:null}},fe={Point:ue,MultiPoint:ue,LineString:he,MultiLineString:he,Polygon:de,MultiPolygon:de,Sphere:de},pe=1e-6,me=pe*pe,ge=Math.PI,ve=ge/2,ye=Math.sqrt(ge),be=ge/180,_e=180/ge,xe=d3.geoProjection,we=d3.geoProjectionMutator;d3.geoInterrupt=function(t){function e(e,i){for(var n=i<0?-1:1,r=s[+(i<0)],a=0,o=r.length-1;a<o&&e>r[a][2][0];++a);var l=t(e-r[a][1][0],i);return l[0]+=t(r[a][1][0],n*i>n*r[a][0][1]?r[a][0][1]:i)[0],l}function i(){o=s.map(function(e){return e.map(function(e){var i,n=t(e[0][0],e[0][1])[0],r=t(e[2][0],e[2][1])[0],a=t(e[1][0],e[0][1])[1],o=t(e[1][0],e[1][1])[1];return a>o&&(i=a,a=o,o=i),[[n,a],[r,o]]})})}function n(){for(var t=1e-6,e=[],i=0,n=s[0].length;i<n;++i){var a=s[0][i],o=180*a[0][0]/ge,l=180*a[0][1]/ge,c=180*a[1][1]/ge,u=180*a[2][0]/ge,h=180*a[2][1]/ge;e.push(r([[o+t,l+t],[o+t,c-t],[u-t,c-t],[u-t,h+t]],30))}for(var i=s[1].length-1;i>=0;--i){var a=s[1][i],o=180*a[0][0]/ge,l=180*a[0][1]/ge,c=180*a[1][1]/ge,u=180*a[2][0]/ge,h=180*a[2][1]/ge;e.push(r([[u-t,h-t],[u-t,c+t],[o+t,c+t],[o+t,l-t]],30))}return{type:"Polygon",coordinates:[d3.merge(e)]}}function r(t,e){for(var i,n,r,a=-1,o=t.length,s=t[0],l=[];++a<o;){i=t[a],n=(i[0]-s[0])/e,r=(i[1]-s[1])/e;for(var c=0;c<e;++c)l.push([s[0]+c*n,s[1]+c*r]);s=i}return l.push(i),l}function a(t,e){return Math.abs(t[0]-e[0])<pe&&Math.abs(t[1]-e[1])<pe}var o,s=[[[[-ge,0],[0,ve],[ge,0]]],[[[-ge,0],[0,-ve],[ge,0]]]];t.invert&&(e.invert=function(i,n){for(var r=o[+(n<0)],l=s[+(n<0)],c=0,u=r.length;c<u;++c){var h=r[c];if(h[0][0]<=i&&i<h[1][0]&&h[0][1]<=n&&n<h[1][1]){var d=t.invert(i-t(l[c][1][0],0)[0],n);return d[0]+=l[c][1][0],a(e(d[0],d[1]),[i,n])?d:null}}});var l=d3.geoProjection(e),c=l.stream;return l.stream=function(t){var e=l.rotate(),i=c(t),r=(l.rotate([0,0]),c(t));return l.rotate(e),i.sphere=function(){d3.geoStream(n(),r)},i},l.lobes=function(t){return arguments.length?(s=t.map(function(t){return t.map(function(t){return[[t[0][0]*ge/180,t[0][1]*ge/180],[t[1][0]*ge/180,t[1][1]*ge/180],[t[2][0]*ge/180,t[2][1]*ge/180]]})}),i(),l):s.map(function(t){return t.map(function(t){return[[180*t[0][0]/ge,180*t[0][1]/ge],[180*t[1][0]/ge,180*t[1][1]/ge],[180*t[2][0]/ge,180*t[2][1]/ge]]})})},l},(d3.geoAiry=h).raw=u,d.invert=function(t,e){if(!(t*t+4*e*e>ge*ge+pe)){var i=t,n=e,r=25;do{var a,o=Math.sin(i),s=Math.sin(i/2),c=Math.cos(i/2),u=Math.sin(n),h=Math.cos(n),d=Math.sin(2*n),f=u*u,p=h*h,m=s*s,g=1-p*c*c,v=g?l(h*c)*Math.sqrt(a=1/g):a=0,y=2*v*h*s-t,b=v*u-e,_=a*(p*m+v*h*c*f),x=a*(.5*o*d-2*v*u*s),w=.25*a*(d*s-v*u*p*o),M=a*(f*c+v*m*h),z=x*w-M*_;if(!z)break;var S=(b*x-y*M)/z,E=(y*w-b*_)/z;i-=S,n-=E}while((Math.abs(S)>pe||Math.abs(E)>pe)&&--r>0);return[i,n]}},(d3.geoAitoff=function(){return xe(d)}).raw=d,(d3.geoArmadillo=p).raw=f,_.invert=function(t,e){if(t*=3/8,e*=3/8,!t&&Math.abs(e)>1)return null;var i=t*t,n=e*e,r=1+i+n,a=Math.sqrt(.5*(r-Math.sqrt(r*r-4*e*e))),l=s(a)/3,c=a?b(Math.abs(e/a))/3:y(Math.abs(t))/3,u=Math.cos(l),h=v(c),d=h*h-u*u;return[2*o(t)*Math.atan2(g(c)*u,.25-d),2*o(e)*Math.atan2(h*Math.sin(l),.25+d)]},(d3.geoAugust=function(){return xe(_)}).raw=_;var Me=Math.log(1+Math.SQRT2);x.invert=function(t,e){if((n=Math.abs(e))<Me)return[t,2*Math.atan(Math.exp(e))-ve];var i,n,r=Math.sqrt(8),a=ge/4,s=25;do{var l=Math.cos(a/2),c=Math.tan(a/2);a-=i=(r*(a-ge/4)-Math.log(c)-n)/(r-.5*l*l/c)}while(Math.abs(i)>me&&--s>0);return[t/(Math.cos(a)*(r-1/Math.sin(a))),o(e)*a]},(d3.geoBaker=function(){return xe(x)}).raw=x;var ze=d3.geoAzimuthalEquidistant.raw;(d3.geoBerghaus=M).raw=w;var Se=z(ge),Ee=S(Math.SQRT2/ve,Math.SQRT2,ge);(d3.geoMollweide=function(){return xe(Ee)}).raw=Ee,E.invert=function(t,e){var i,n,r=2.00276,a=r*e,o=e<0?-ge/4:ge/4,s=25;do n=a-Math.SQRT2*Math.sin(o),o-=i=(Math.sin(2*o)+2*o-ge*Math.sin(n))/(2*Math.cos(2*o)+2+ge*Math.cos(n)*Math.SQRT2*Math.cos(o));while(Math.abs(i)>pe&&--s>0);return n=a-Math.SQRT2*Math.sin(o),[t*(1/Math.cos(n)+1.11072/Math.cos(o))/r,n]},(d3.geoBoggs=function(){return xe(E)}).raw=E,T.invert=function(t,e){return[t/Math.cos(e),e]},(d3.geoSinusoidal=function(){return xe(T)}).raw=T,(d3.geoBonne=function(){return k(P).parallel(45)}).raw=P;var ke=S(1,4/ge,ge);(d3.geoBromley=function(){return xe(ke)}).raw=ke,(d3.geoChamberlin=A).raw=O,R.invert=function(t,e){var i=(i=e/ye-1)*i;return[i>0?t*Math.sqrt(ge/i)/2:0,s(1-i)]},(d3.geoCollignon=function(){return xe(R)}).raw=R,(d3.geoCraig=function(){return k(B)}).raw=B,j.invert=function(t,e){var i=Math.sqrt(3),n=3*s(e/(i*ye));return[ye*t/(i*(2*Math.cos(2*n/3)-1)),n]},(d3.geoCraster=function(){return xe(j)}).raw=j,(d3.geoCylindricalEqualArea=function(){return k(F)}).raw=F,(d3.geoCylindricalStereographic=function(){return k(N)}).raw=N,q.invert=function(t,e){var i=Math.sqrt(8/(3*ge)),n=e/i;return[t/(i*(1-Math.abs(n)/ge)),n]},(d3.geoEckert1=function(){return xe(q)}).raw=q,V.invert=function(t,e){var i=2-Math.abs(e)/Math.sqrt(2*ge/3);return[t*Math.sqrt(6*ge)/(2*i),o(e)*s((4-i*i)/3)]},(d3.geoEckert2=function(){return xe(V)}).raw=V,U.invert=function(t,e){var i=Math.sqrt(ge*(4+ge))/2;return[t*i/(1+c(1-e*e*(4+ge)/(4*ge))),e*i/2]},(d3.geoEckert3=function(){return xe(U)}).raw=U,H.invert=function(t,e){var i=.5*e*Math.sqrt((4+ge)/ge),n=s(i),r=Math.cos(n);return[t/(2/Math.sqrt(ge*(4+ge))*(1+r)),s((n+i*(r+2))/(2+ve))]},(d3.geoEckert4=function(){return xe(H)}).raw=H,X.invert=function(t,e){var i=Math.sqrt(2+ge),n=e*i/2;return[i*t/(1+Math.cos(n)),n]},(d3.geoEckert5=function(){return xe(X)}).raw=X,Y.invert=function(t,e){var i=1+ve,n=Math.sqrt(i/2);return[2*t*n/(1+Math.cos(e*=n)),s((e+Math.sin(e))/i)]},(d3.geoEckert6=function(){return xe(Y)}).raw=Y,W.invert=function(t,e){var i=d3.geoAugust.raw.invert(t/1.2,1.065*e);if(!i)return null;var n=i[0],r=i[1],a=20;t/=Te,e/=Te;do{var o=n/2,s=r/2,l=Math.sin(o),c=Math.cos(o),u=Math.sin(s),h=Math.cos(s),d=Math.cos(r),f=Math.sqrt(d),p=u/(h+Math.SQRT2*c*f),m=p*p,g=Math.sqrt(2/(1+m)),v=Math.SQRT2*h+(c+l)*f,y=Math.SQRT2*h+(c-l)*f,b=v/y,_=Math.sqrt(b),x=_-1/_,w=_+1/_,M=g*x-2*Math.log(_)-t,z=g*p*w-2*Math.atan(p)-e,S=u&&Math.SQRT1_2*f*l*m/u,E=(Math.SQRT2*c*h+f)/(2*(h+Math.SQRT2*c*f)*(h+Math.SQRT2*c*f)*f),k=-.5*p*g*g*g,T=k*S,P=k*E,O=(O=2*h+Math.SQRT2*f*(c-l))*O*_,A=(Math.SQRT2*c*h*f+d)/O,I=-(Math.SQRT2*l*u)/(f*O),C=x*T-2*A/_+g*(A+A/b),L=x*P-2*I/_+g*(I+I/b),D=p*w*T-2*S/(1+m)+g*w*S+g*p*(A-A/b),R=p*w*P-2*E/(1+m)+g*w*E+g*p*(I-I/b),B=L*D-R*C;if(!B)break;var j=(z*L-M*R)/B,F=(M*D-z*C)/B;n-=j,r=Math.max(-ve,Math.min(ve,r-F))}while((Math.abs(j)>pe||Math.abs(F)>pe)&&--a>0);return Math.abs(Math.abs(r)-ve)<pe?[0,r]:a&&[n,r]};var Te=3+2*Math.SQRT2;(d3.geoEisenlohr=function(){return xe(W)}).raw=W,G.invert=function(t,e){var i=e/(1+Pe);return[t?t/(Pe*c(1-i*i)):0,2*Math.atan(i)]};var Pe=Math.cos(35*be);(d3.geoFahey=function(){return xe(G)}).raw=G,K.invert=function(t,e){var i=Math.atan(e/ye),n=Math.cos(i),r=2*i;return[t*ye*.5/(Math.cos(r)*n*n),r]},(d3.geoFoucaut=function(){return xe(K)}).raw=K,d3.geoGilbert=function(t){function e(e){return t([.5*e[0],s(Math.tan(.5*e[1]*be))*_e])}var i=d3.geoEquirectangular().scale(_e).translate([0,0]);return t.invert&&(e.invert=function(e){return e=t.invert(e),e[0]*=2,e[1]=2*Math.atan(Math.sin(e[1]*be))*_e,e}),e.stream=function(e){e=t.stream(e);var n=i.stream({point:function(t,i){e.point(.5*t,s(Math.tan(.5*-i*be))*_e)},lineStart:function(){e.lineStart()},lineEnd:function(){e.lineEnd()},polygonStart:function(){e.polygonStart()},polygonEnd:function(){e.polygonEnd()}});return n.sphere=function(){e.sphere()},n.valid=!1,n},e};var Oe=d3.geoAzimuthalEquidistant.raw;(d3.geoGingery=J).raw=Z;var Ae=tt(2.8284,-1.6988,.75432,-.18071,1.76003,-.38914,.042555);(d3.geoGinzburg4=function(){return xe(Ae)}).raw=Ae;var Ie=tt(2.583819,-.835827,.170354,-.038094,1.543313,-.411435,.082742);(d3.geoGinzburg5=function(){return xe(Ie)}).raw=Ie;var Ce=tt(5/6*ge,-.62636,-.0344,0,1.3493,-.05524,0,.045);(d3.geoGinzburg6=function(){return xe(Ce)}).raw=Ce,et.invert=function(t,e){var i,n=t,r=e,a=50;do{var o=r*r;r-=i=(r*(1+o/12)-e)/(1+o/4)}while(Math.abs(i)>pe&&--a>0);a=50,t/=1-.162388*o;do{var s=(s=n*n)*s;n-=i=(n*(.87-952426e-9*s)-t)/(.87-.00476213*s)}while(Math.abs(i)>pe&&--a>0);return[n,r]},(d3.geoGinzburg8=function(){return xe(et)}).raw=et;var Le=tt(2.6516,-.76534,.19123,-.047094,1.36289,-.13965,.031762);(d3.geoGinzburg9=function(){return xe(Le)}).raw=Le,nt.invert=function(t,e){var i=o(t),n=o(e),r=-i*t,a=-n*e,l=a/r<1,c=at(l?a:r,l?r:a),u=c[0],h=c[1];l&&(u=-ve-u);var d=Math.cos(h),t=Math.cos(u)*d,e=Math.sin(u)*d,f=Math.sin(h);return[i*(Math.atan2(e,-f)+ge),n*s(t)]},d3.geoGringorten=it(nt),ut.invert=function(t,e){var i=(Math.SQRT2-1)/(Math.SQRT2+1),n=Math.sqrt(1-i*i),r=ct(ve,n*n),a=-1,o=ot(.5*r-e,-t,n*n),s=dt(o[0],o[1]),l=Math.atan2(s[1],s[0])/a;return[l,2*Math.atan(Math.exp(.5/a*Math.log(i*s[0]*s[0]+i*s[1]*s[1])))-ve]},d3.geoGuyou=it(ut),(d3.geoHammerRetroazimuthal=mt).raw=ft;var De=d3.geoAzimuthalEqualArea.raw;yt.invert=function(t,e){var i=2*s(e/2);return[t*Math.cos(i/2)/Math.cos(i),i]},(d3.geoHammer=vt).raw=gt,bt.invert=function(t,e){var i=Math.abs(i=e*(e<0?.5179951515653813:.5686373742600607))>1-pe?i>0?ve:-ve:s(i);return[1.1764705882352942*t/Math.cos(i),Math.abs(i=((i+=i)+Math.sin(i))*(e<0?.4102345310814193:.3736990601468637))>1-pe?i>0?ve:-ve:s(i)]},(d3.geoHatano=function(){return xe(bt)}).raw=bt;var Re=41+48/36+37/3600;(d3.geoHealpix=xt).raw=_t,(d3.geoHill=Mt).raw=wt;var Be=.7109889596207567,je=.0528035274542;zt.invert=function(t,e){return e>-Be?Ee.invert(t,e-je):T.invert(t,e)},(d3.geoSinuMollweide=function(){return xe(zt).rotate([-20,-55])}).raw=zt,St.invert=function(t,e){return Math.abs(e)>Be?Ee.invert(t,e+(e>0?je:-je)):T.invert(t,e)},(d3.geoHomolosine=function(){return xe(St)}).raw=St,Et.invert=function(t,e){return[2/3*ge*t/Math.sqrt(ge*ge/3-e*e),e]},(d3.geoKavrayskiy7=function(){return xe(Et)}).raw=Et,(d3.geoLagrange=Tt).raw=kt,Pt.invert=function(t,e){var i=Math.abs(t),n=Math.abs(e),r=ge/Math.SQRT2,a=pe,o=ve;n<r?o*=n/r:a+=6*l(r/n);for(var s=0;s<25;s++){var u=Math.sin(o),h=c(Math.cos(o)),d=Math.sin(o/2),f=Math.cos(o/2),p=Math.sin(a/6),m=Math.cos(a/6),g=.5*a*(1+h)-i,v=o/(f*m)-n,y=h?-.25*a*u/h:0,b=.5*(1+h),_=(1+.5*o*d/f)/(f*m),x=o/f*(p/6)/(m*m),w=y*x-_*b,M=(g*x-v*b)/w,z=(v*y-g*_)/w;if(o-=M,a-=z,Math.abs(M)<pe&&Math.abs(z)<pe)break}return[t<0?-a:a,e<0?-o:o]},(d3.geoLarrivee=function(){return xe(Pt)}).raw=Pt,Ot.invert=function(t,e){var i=o(t)*ge,n=e/2,r=50;do{var a=i*i,s=n*n,l=i*n,c=i*(.975534+s*(-.119161+a*-.0143059+s*-.0547009))-t,u=n*(1.00384+a*(.0802894+s*-.02855+199025e-9*a)+s*(.0998909+s*-.0491032))-e,h=.975534-s*(.119161+3*a*.0143059+.0547009*s),d=-l*(.238322+.2188036*s+.0286118*a),f=l*(.1605788+7961e-7*a+-.0571*s),p=1.00384+a*(.0802894+199025e-9*a)+s*(3*(.0998909-.02855*a)-.245516*s),m=d*f-p*h,g=(u*d-c*p)/m,v=(c*f-u*h)/m;i-=g,n-=v}while((Math.abs(g)>pe||Math.abs(v)>pe)&&--r>0);return r&&[i,n]},(d3.geoLaskowski=function(){return xe(Ot)}).raw=Ot,At.invert=function(t,e){var i=t*t,n=e*e,r=n+1,a=t?Math.SQRT1_2*Math.sqrt((r-Math.sqrt(i*i+2*i*(n-1)+r*r))/i+1):1/Math.sqrt(r);return[s(t*a),o(e)*l(a)]},(d3.geoLittrow=function(){return xe(At)}).raw=At,(d3.geoLoximuthal=function(){return k(It).parallel(40)}).raw=It,Ct.invert=function(t,e){return[t,2.5*Math.atan(Math.exp(.8*e))-.625*ge]},(d3.geoMiller=function(){return xe(Ct)}).raw=Ct;var Fe={alaska:[[.9972523,0],[.0052513,-.0041175],[.0074606,.0048125],[-.0153783,-.1968253],[.0636871,-.1408027],[.3660976,-.2937382]],gs48:[[.98879,0],[0,0],[-.050909,0],[0,0],[.075528,0]],gs50:[[.984299,0],[.0211642,.0037608],[-.1036018,-.0575102],[-.0329095,-.0320119],[.0499471,.1223335],[.026046,.0899805],[7388e-7,-.1435792],[.0075848,-.1334108],[-.0216473,.0776645],[-.0225161,.0853673]],miller:[[.9245,0],[0,0],[.01943,0]],lee:[[.721316,0],[0,0],[-.00881625,-.00617325]]};(d3.geoModifiedStereographic=Dt).raw=Lt,Rt.invert=function(t,e){var i=Math.sqrt(6),n=Math.sqrt(7),r=3*s(e*n/9);return[t*n/(i*(2*Math.cos(2*r/3)-1)),s(3*Math.sin(r)*i/7)]},(d3.geoMtFlatPolarParabolic=function(){return xe(Rt)}).raw=Rt,Bt.invert=function(t,e){var i=e*Math.sqrt(2+Math.SQRT2)/(2*Math.sqrt(3)),n=2*s(i);return[3*Math.SQRT2*t/(1+2*Math.cos(n)/Math.cos(n/2)),s((i+Math.sin(n))/(1+Math.SQRT1_2))]},(d3.geoMtFlatPolarQuartic=function(){return xe(Bt)}).raw=Bt,jt.invert=function(t,e){var i=Math.sqrt(6/(4+ge)),n=e/i;return Math.abs(Math.abs(n)-ve)<pe&&(n=n<0?-ve:ve),
[1.5*t/(i*(.5+Math.cos(n))),s((n/2+Math.sin(n))/(1+ge/4))]},(d3.geoMtFlatPolarSinusoidal=function(){return xe(jt)}).raw=jt,Ft.invert=function(t,e){var i,n=e,r=25;do{var a=n*n,o=a*a;n-=i=(n*(1.007226+a*(.015085+o*(-.044475+.028874*a-.005916*o)))-e)/(1.007226+a*(.045255+o*(-.311325+.259866*a-.005916*11*o)))}while(Math.abs(i)>pe&&--r>0);return[t/(.8707+(a=n*n)*(-.131979+a*(-.013791+a*a*a*(.003971-.001529*a)))),n]},(d3.geoNaturalEarth=function(){return xe(Ft)}).raw=Ft,Nt.invert=function(t,e){for(var i=e/2,n=0,r=1/0;n<10&&Math.abs(r)>pe;n++){var a=Math.cos(e/2);e-=r=(e-Math.tan(e/2)-i)/(1-.5/(a*a))}return[2*t/(1+Math.cos(e)),e]},(d3.geoNellHammer=function(){return xe(Nt)}).raw=Nt;var Ne=1.0148,qe=.23185,Ve=-.14499,Ue=.02406,He=Ne,Xe=5*qe,Ye=7*Ve,We=9*Ue,Ge=1.790857183;qt.invert=function(t,e){e>Ge?e=Ge:e<-Ge&&(e=-Ge);var i,n=e;do{var r=n*n;n-=i=(n*(Ne+r*r*(qe+r*(Ve+Ue*r)))-e)/(He+r*r*(Xe+r*(Ye+We*r)))}while(Math.abs(i)>pe);return[t,n]},(d3.geoPatterson=function(){return xe(qt)}).raw=qt;var Ke=it(ut);(d3.geoPeirceQuincuncial=function(){return Ke().quincuncial(!0).rotate([-90,-90,45]).clipAngle(180-1e-6)}).raw=Ke.raw,Vt.invert=function(t,e){if(Math.abs(e)<pe)return[t,0];var i,n=t*t+e*e,r=.5*e,a=10;do{var c=Math.tan(r),u=1/Math.cos(r),h=n-2*e*r+r*r;r-=i=(c*h+2*(r-e))/(2+h*u*u+2*(r-e)*c)}while(Math.abs(i)>pe&&--a>0);return c=Math.tan(r),[(Math.abs(e)<Math.abs(r+1/c)?s(t*c):o(t)*(l(Math.abs(t*c))+ve))/Math.sin(r),r]},(d3.geoPolyconic=function(){return xe(Vt)}).raw=Vt,(d3.geoRectangularPolyconic=function(){return k(Ut)}).raw=Ut;var Ze=[[.9986,-.062],[1,0],[.9986,.062],[.9954,.124],[.99,.186],[.9822,.248],[.973,.31],[.96,.372],[.9427,.434],[.9216,.4958],[.8962,.5571],[.8679,.6176],[.835,.6769],[.7986,.7346],[.7597,.7903],[.7186,.8435],[.6732,.8936],[.6213,.9394],[.5722,.9761],[.5322,1]];Ze.forEach(function(t){t[1]*=1.0144}),Ht.invert=function(t,e){var i=e/ve,n=90*i,r=Math.min(18,Math.abs(n/5)),a=Math.max(0,Math.floor(r));do{var o=Ze[a][1],s=Ze[a+1][1],l=Ze[Math.min(19,a+2)][1],c=l-o,u=l-2*s+o,h=2*(Math.abs(i)-s)/c,d=u/c,f=h*(1-d*h*(1-2*d*h));if(f>=0||1===a){n=(e>=0?5:-5)*(f+r);var p,m=50;do r=Math.min(18,Math.abs(n)/5),a=Math.floor(r),f=r-a,o=Ze[a][1],s=Ze[a+1][1],l=Ze[Math.min(19,a+2)][1],n-=(p=(e>=0?ve:-ve)*(s+f*(l-o)/2+f*f*(l-2*s+o)/2)-e)*_e;while(Math.abs(p)>me&&--m>0);break}}while(--a>=0);var g=Ze[a][0],v=Ze[a+1][0],y=Ze[Math.min(19,a+2)][0];return[t/(v+f*(y-g)/2+f*f*(y-2*v+g)/2),n*be]},(d3.geoRobinson=function(){return xe(Ht)}).raw=Ht,(d3.geoSatellite=Wt).raw=Yt,Gt.invert=function(t,e){var i=e/1.70711,n=Math.sin(ge/4*i);return[t/(.74482-.34588*n*n),2*Math.atan(i)]},(d3.geoTimes=function(){return xe(Gt)}).raw=Gt,(d3.geoTwoPointEquidistant=Zt).raw=Kt,(d3.geoTwoPointAzimuthal=Jt).raw=Qt,$t.invert=function(t,e){if(Math.abs(e)<pe)return[t,0];if(Math.abs(t)<pe)return[0,ve*Math.sin(2*Math.atan(e/ge))];var i=(t/=ge)*t,n=(e/=ge)*e,r=i+n,a=r*r,s=-Math.abs(e)*(1+r),c=s-2*n+i,u=-2*s+1+2*n+a,h=n/u+(2*c*c*c/(u*u*u)-9*s*c/(u*u))/27,d=(s-c*c/(3*u))/u,f=2*Math.sqrt(-d/3),p=l(3*h/(d*f))/3;return[ge*(r-1+Math.sqrt(1+2*(i-n)+a))/(2*t),o(e)*ge*(-f*Math.cos(p+ge/3)-c/(3*u))]},(d3.geoVanDerGrinten=function(){return xe($t)}).raw=$t,te.invert=function(t,e){if(!t)return[0,ve*Math.sin(2*Math.atan(e/ge))];var i=Math.abs(t/ge),n=(1-i*i-(e/=ge)*e)/(2*i),r=n*n,a=Math.sqrt(r+1);return[o(t)*ge*(a-n),o(e)*ve*Math.sin(2*Math.atan2(Math.sqrt((1-2*n*i)*(n+a)-i),Math.sqrt(a+n+i)))]},(d3.geoVanDerGrinten2=function(){return xe(te)}).raw=te,ee.invert=function(t,e){if(!e)return[t,0];var i=e/ge,n=(ge*ge*(1-i*i)-t*t)/(2*ge*t);return[t?ge*(o(t)*Math.sqrt(n*n+1)-n):0,ve*Math.sin(2*Math.atan(i))]},(d3.geoVanDerGrinten3=function(){return xe(ee)}).raw=ee,ie.invert=function(t,e){if(!t||!e)return[t,e];e/=ge;var i=o(t)*t/ve,n=(i*i-1+4*e*e)/Math.abs(i),r=n*n,a=2*e,s=50;do{var l=a*a,c=(8*a-l*(l+2)-5)/(2*l*(a-1)),u=(3*a-l*a-10)/(2*l*a),h=c*c,d=a*c,f=a+c,p=f*f,m=a+3*c,g=p*(l+h*r-1)+(1-l)*(l*(m*m+4*h)+h*(12*d+4*h)),v=-2*f*(4*d*h+(1-4*l+3*l*l)*(1+u)+h*(-6+14*l-r+(-8+8*l-2*r)*u)+d*(-8+12*l+(-10+10*l-r)*u)),y=Math.sqrt(g),b=n*(p+h-1)+2*y-i*(4*p+r),_=n*(2*c*u+2*f*(1+u))+v/y-8*f*(n*(-1+h+p)+2*y)*(1+u)/(r+4*p);a-==b/_}while(>pe&&--s>0);return[o(t)*(Math.sqrt(n*n+4)+n)*ge/4,ve*a]},(d3.geoVanDerGrinten4=function(){return xe(ie)}).raw=ie;var Qe=function(){var t=4*ge+3*Math.sqrt(3),e=2*Math.sqrt(2*ge*Math.sqrt(3)/t);return S(e*Math.sqrt(3)/ge,e,t/6)}();(d3.geoWagner4=function(){return xe(Qe)}).raw=Qe,ne.invert=function(t,e){return[t/Math.sqrt(1-3*e*e/(ge*ge)),e]},(d3.geoWagner6=function(){return xe(ne)}).raw=ne,re.invert=function(t,e){var i=t/2.66723,n=e/1.24104,r=Math.sqrt(i*i+n*n),a=2*s(r/2);return[3*Math.atan2(t*Math.tan(a),2.66723*r),r&&s(e*Math.sin(a)/(1.24104*.90631*r))]},(d3.geoWagner7=function(){return xe(re)}).raw=re,ae.invert=function(t,e){var i=-.5*(t*t+e*e),n=Math.sqrt(-i*(2+i)),r=e*i+t*n,a=t*i-e*n,o=Math.sqrt(a*a+r*r);return[Math.atan2(n*r,o*(1+i)),o?-s(n*a/o):0]},(d3.geoWiechel=function(){return xe(ae)}).raw=ae,oe.invert=function(t,e){var i=t,n=e,r=25;do{var a,o=Math.cos(n),s=Math.sin(n),c=Math.sin(2*n),u=s*s,h=o*o,d=Math.sin(i),f=Math.cos(i/2),p=Math.sin(i/2),m=p*p,g=1-h*f*f,v=g?l(o*f)*Math.sqrt(a=1/g):a=0,y=.5*(2*v*o*p+i/ve)-t,b=.5*(v*s+n)-e,_=.5*a*(h*m+v*o*f*u)+.5/ve,x=a*(d*c/4-v*s*p),w=.125*a*(c*p-v*s*h*d),M=.5*a*(u*f+v*m*o)+.5,z=x*w-M*_,S=(b*x-y*M)/z,E=(y*w-b*_)/z;i-=S,n-=E}while((Math.abs(S)>pe||Math.abs(E)>pe)&&--r>0);return[i,n]},(d3.geoWinkel3=function(){return xe(oe)}).raw=oe}},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var a=i(1),o=r(a),s=i(42),l=n(s),c=l.default.extend({_important:!0,getClassDefaults:function(){var t={use:null,which:null,domainMin:null,domainMax:null,zoomedMin:null,zoomedMax:null,scaleType:"linear",allow:{scales:["linear","log","genericLog","time","pow"]}};return o.deepExtend(this._super(),t)},autoGenerateModel:function(){if(null==this.which&&this.autogenerate){var t=this.dataSource.getConceptByIndex(this.autogenerate.conceptIndex,this.autogenerate.conceptType);t||(t=this.dataSource.getConceptByIndex(0,"time")),this.which=t.concept}},_type:"axis",validate:function(){if(this._super(),this.scale&&"time"==this.scaleType){var t={};null==this.zoomedMin||o.isDate(this.zoomedMin)||(t.zoomedMin=this._space.time.parse(this.zoomedMin.toString())),null==this.zoomedMax||o.isDate(this.zoomedMax)||(t.zoomedMax=this._space.time.parse(this.zoomedMax.toString())),this.set(t)}},buildScale:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.scaleType,e=void 0;if("time"==t){var i=this._space.time,n=i.splash?{min:i.parse(i.startOrigin),max:i.parse(i.endOrigin)}:{min:i.start,max:i.end};e=[n.min,n.max],this.scale=d3.time.scale.utc().domain(e)}else{if(this.isDiscrete())e="constant"===this.use?[this.which]:this.getUnique(this.which);else{var r=this.getLimits(this.which);e=[r.min,r.max],e[0]=null!=this.domainMin?+this.domainMin:e[0],e[1]=null!=this.domainMax?+this.domainMax:e[1]}t=d3.min(e)<=0&&d3.max(e)>=0&&"log"===t?"genericLog":t,this.scale=d3.scale[t||"linear"]().domain(e)}this.scaleType=t},formatDate:function(t){return this._space.time.formatDate(t)}});e.default=c},function(t,e,i){"use strict";var n=i(13),r=i(57),a=i(12);t.exports=function(t){for(var e=n(this),i=a(e.length),o=arguments.length,s=r(o>1?arguments[1]:void 0,i),l=o>2?arguments[2]:void 0,c=void 0===l?i:r(l,i);c>s;)e[s++]=t;return e}},function(t,e,i){"use strict";var n=i(9),r=i(44);t.exports=function(t,e,i){e in t?n.f(t,e,r(0,i)):t[e]=i}},function(t,e,i){var n=i(6),r=i(4).document,a=n(r)&&n(r.createElement);t.exports=function(t){return a?r.createElement(t):{}}},function(t,e){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(t,e,i){var n=i(7)("match");t.exports=function(t){var e=/./;try{"/./"[t](e)}catch(i){try{return e[n]=!1,!"/./"[t](e)}catch(t){}}return!0}},function(t,e,i){t.exports=i(4).document&&document.documentElement},function(t,e,i){var n=i(6),r=i(105).set;t.exports=function(t,e,i){var a,o=e.constructor;return o!==i&&"function"==typeof o&&(a=o.prototype)!==i.prototype&&n(a)&&r&&r(t,a),t}},function(t,e,i){var n=i(64),r=i(7)("iterator"),a=Array.prototype;t.exports=function(t){return void 0!==t&&(n.Array===t||a[r]===t)}},function(t,e,i){var n=i(28);t.exports=Array.isArray||function(t){return"Array"==n(t)}},function(t,e,i){"use strict";var n=i(52),r=i(44),a=i(65),o={};i(18)(o,i(7)("iterator"),function(){return this}),t.exports=function(t,e,i){t.prototype=n(o,{next:r(1,i)}),a(t,e+" Iterator")}},function(t,e,i){"use strict";var n=i(51),r=i(0),a=i(19),o=i(18),s=i(14),l=i(64),c=i(100),u=i(65),h=i(25),d=i(7)("iterator"),f=!([].keys&&"next"in[].keys()),p="@@iterator",m="keys",g="values",v=function(){return this};t.exports=function(t,e,i,y,b,_,x){c(i,e,y);var w,M,z,S=function(t){if(!f&&t in P)return P[t];switch(t){case m:return function(){return new i(this,t)};case g:return function(){return new i(this,t)}}return function(){return new i(this,t)}},E=e+" Iterator",k=b==g,T=!1,P=t.prototype,O=P[d]||P[p]||b&&P[b],A=O||S(b),I=b?k?S("entries"):A:void 0,C="Array"==e?P.entries||O:O;if(C&&(z=h(C.call(new t)),z!==Object.prototype&&(u(z,E,!0),n||s(z,d)||o(z,d,v))),k&&O&&O.name!==g&&(T=!0,A=function(){return O.call(this)}),n&&!x||!f&&!T&&P[d]||o(P,d,A),l[e]=A,l[E]=v,b)if(w={values:k?A:S(g),keys:_?A:S(m),entries:I},x)for(M in w)M in P||a(P,M,w[M]);else r(r.P+r.F*(f||T),e,w);return w}},function(t,e){var i=Math.expm1;t.exports=!i||i(10)>22025.465794806718||i(10)<22025.465794806718||i(-2e-17)!=-2e-17?function(t){return 0==(t=+t)?t:t>-1e-6&&t<1e-6?t+t*t/2:Math.exp(t)-1}:i},function(t,e){t.exports=Math.sign||function(t){return 0==(t=+t)||t!=t?t:t<0?-1:1}},function(t,e,i){var n=i(4),r=i(112).set,a=n.MutationObserver||n.WebKitMutationObserver,o=n.process,s=n.Promise,l="process"==i(28)(o);t.exports=function(){var t,e,i,c=function(){var n,r;for(l&&(n=o.domain)&&n.exit();t;){r=t.fn,t=t.next;try{r()}catch(n){throw t?i():e=void 0,n}}e=void 0,n&&n.enter()};if(l)i=function(){o.nextTick(c)};else if(a){var u=!0,h=document.createTextNode("");new a(c).observe(h,{characterData:!0}),i=function(){h.data=u=!u}}else if(s&&s.resolve){var d=s.resolve();i=function(){d.then(c)}}else i=function(){r.call(n,c)};return function(n){var r={fn:n,next:void 0};e&&(e.next=r),t||(t=r,i()),e=r}}},function(t,e,i){var n=i(6),r=i(3),a=function(t,e){if(r(t),!n(e)&&null!==e)throw TypeError(e+": can't set as prototype!")};t.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(t,e,n){try{n=i(37)(Function.call,i(24).f(Object.prototype,"__proto__").set,2),n(t,[]),e=!(t instanceof Array)}catch(t){e=!0}return function(t,i){return a(t,i),e?t.__proto__=i:n(t,i),t}}({},!1):void 0),check:a}},function(t,e,i){var n=i(83)("keys"),r=i(58);t.exports=function(t){return n[t]||(n[t]=r(t))}},function(t,e,i){var n=i(3),r=i(17),a=i(7)("species");t.exports=function(t,e){var i,o=n(t).constructor;return void 0===o||void 0==(i=n(o)[a])?e:r(i)}},function(t,e,i){var n=i(45),r=i(29);t.exports=function(t){return function(e,i){var a,o,s=String(r(e)),l=n(i),c=s.length;return l<0||l>=c?t?"":void 0:(a=s.charCodeAt(l),a<55296||a>56319||l+1===c||(o=s.charCodeAt(l+1))<56320||o>57343?t?s.charAt(l):a:t?s.slice(l,l+2):(a-55296<<10)+(o-56320)+65536)}}},function(t,e,i){var n=i(79),r=i(29);t.exports=function(t,e,i){if(n(e))throw TypeError("String#"+i+" doesn't accept regex!");return String(r(t))}},function(t,e,i){"use strict";var n=i(45),r=i(29);t.exports=function(t){var e=String(r(this)),i="",a=n(t);if(a<0||a==1/0)throw RangeError("Count can't be negative");for(;a>0;(a>>>=1)&&(e+=e))1&a&&(i+=e);return i}},function(t,e){t.exports="\t\n\v\f\r \u2028\u2029\ufeff"},function(t,e,i){var n,r,a,o=i(37),s=i(78),l=i(96),c=i(93),u=i(4),h=u.process,d=u.setImmediate,f=u.clearImmediate,p=u.MessageChannel,m=0,g={},v="onreadystatechange",y=function(){var t=+this;if(g.hasOwnProperty(t)){var e=g[t];delete g[t],e()}},b=function(t){y.call(t.data)};d&&f||(d=function(t){for(var e=[],i=1;arguments.length>i;)e.push(arguments[i++]);return g[++m]=function(){s("function"==typeof t?t:Function(t),e)},n(m),m},f=function(t){delete g[t]},"process"==i(28)(h)?n=function(t){h.nextTick(o(y,t,1))}:p?(r=new p,a=r.port2,r.port1.onmessage=b,n=o(a.postMessage,a,1)):u.addEventListener&&"function"==typeof postMessage&&!u.importScripts?(n=function(t){u.postMessage(t+"","*")},u.addEventListener("message",b,!1)):n=v in c("script")?function(t){l.appendChild(c("script"))[v]=function(){l.removeChild(this),y.call(t)}}:function(t){setTimeout(o(y,t,1),0)}),t.exports={set:d,clear:f}},function(t,e,i){"use strict";var n=i(4),r=i(8),a=i(51),o=i(84),s=i(18),l=i(55),c=i(5),u=i(50),h=i(45),d=i(12),f=i(53).f,p=i(9).f,m=i(91),g=i(65),v="ArrayBuffer",y="DataView",b="prototype",_="Wrong length!",x="Wrong index!",w=n[v],M=n[y],z=n.Math,S=n.RangeError,E=n.Infinity,k=w,T=z.abs,P=z.pow,O=z.floor,A=z.log,I=z.LN2,C="buffer",L="byteLength",D="byteOffset",R=r?"_b":C,B=r?"_l":L,j=r?"_o":D,F=function(t,e,i){var n,r,a,o=Array(i),s=8*i-e-1,l=(1<<s)-1,c=l>>1,u=23===e?P(2,-24)-P(2,-77):0,h=0,d=t<0||0===t&&1/t<0?1:0;for(t=T(t),t!=t||t===E?(r=t!=t?1:0,n=l):(n=O(A(t)/I),t*(a=P(2,-n))<1&&(n--,a*=2),t+=n+c>=1?u/a:u*P(2,1-c),t*a>=2&&(n++,a/=2),n+c>=l?(r=0,n=l):n+c>=1?(r=(t*a-1)*P(2,e),n+=c):(r=t*P(2,c-1)*P(2,e),n=0));e>=8;o[h++]=255&r,r/=256,e-=8);for(n=n<<e|r,s+=e;s>0;o[h++]=255&n,n/=256,s-=8);return o[--h]|=128*d,o},N=function(t,e,i){var n,r=8*i-e-1,a=(1<<r)-1,o=a>>1,s=r-7,l=i-1,c=t[l--],u=127&c;for(c>>=7;s>0;u=256*u+t[l],l--,s-=8);for(n=u&(1<<-s)-1,u>>=-s,s+=e;s>0;n=256*n+t[l],l--,s-=8);if(0===u)u=1-o;else{if(u===a)return n?NaN:c?-E:E;n+=P(2,e),u-=o}return(c?-1:1)*n*P(2,u-e)},q=function(t){return t[3]<<24|t[2]<<16|t[1]<<8|t[0]},V=function(t){return[255&t]},U=function(t){return[255&t,t>>8&255]},H=function(t){return[255&t,t>>8&255,t>>16&255,t>>24&255]},X=function(t){return F(t,52,8)},Y=function(t){return F(t,23,4)},W=function(t,e,i){p(t[b],e,{get:function(){return this[i]}})},G=function(t,e,i,n){var r=+i,a=h(r);if(r!=a||a<0||a+e>t[B])throw S(x);var o=t[R]._b,s=a+t[j],l=o.slice(s,s+e);return n?l:l.reverse()},K=function(t,e,i,n,r,a){var o=+i,s=h(o);if(o!=s||s<0||s+e>t[B])throw S(x);for(var l=t[R]._b,c=s+t[j],u=n(+r),d=0;d<e;d++)l[c+d]=u[a?d:e-d-1]},Z=function(t,e){u(t,w,v);var i=+e,n=d(i);if(i!=n)throw S(_);return n};if(o.ABV){if(!c(function(){new w})||!c(function(){new w(.5)})){w=function(t){return new k(Z(this,t))};for(var Q,J=w[b]=k[b],$=f(k),tt=0;$.length>tt;)(Q=$[tt++])in w||s(w,Q,k[Q]);a||(J.constructor=w)}var et=new M(new w(2)),it=M[b].setInt8;et.setInt8(0,2147483648),et.setInt8(1,2147483649),!et.getInt8(0)&&et.getInt8(1)||l(M[b],{setInt8:function(t,e){it.call(this,t,e<<24>>24)},setUint8:function(t,e){it.call(this,t,e<<24>>24)}},!0)}else w=function(t){var e=Z(this,t);this._b=m.call(Array(e),0),this[B]=e},M=function(t,e,i){u(this,M,y),u(t,w,y);var n=t[B],r=h(e);if(r<0||r>n)throw S("Wrong offset!");if(i=void 0===i?n-r:d(i),r+i>n)throw S(_);this[R]=t,this[j]=r,this[B]=i},r&&(W(w,L,"_l"),W(M,C,"_b"),W(M,L,"_l"),W(M,D,"_o")),l(M[b],{getInt8:function(t){return G(this,1,t)[0]<<24>>24},getUint8:function(t){return G(this,1,t)[0]},getInt16:function(t){var e=G(this,2,t,arguments[1]);return(e[1]<<8|e[0])<<16>>16},getUint16:function(t){var e=G(this,2,t,arguments[1]);return e[1]<<8|e[0]},getInt32:function(t){return q(G(this,4,t,arguments[1]))},getUint32:function(t){return q(G(this,4,t,arguments[1]))>>>0},getFloat32:function(t){return N(G(this,4,t,arguments[1]),23,4)},getFloat64:function(t){return N(G(this,8,t,arguments[1]),52,8)},setInt8:function(t,e){K(this,1,t,V,e)},setUint8:function(t,e){K(this,1,t,V,e)},setInt16:function(t,e){K(this,2,t,U,e,arguments[2])},setUint16:function(t,e){K(this,2,t,U,e,arguments[2])},setInt32:function(t,e){K(this,4,t,H,e,arguments[2])},setUint32:function(t,e){K(this,4,t,H,e,arguments[2])},setFloat32:function(t,e){K(this,4,t,Y,e,arguments[2])},setFloat64:function(t,e){K(this,8,t,X,e,arguments[2])}});g(w,v),g(M,y),s(M[b],o.VIEW,!0),e[v]=w,e[y]=M},function(t,e,i){var n=i(4),r=i(36),a=i(51),o=i(176),s=i(9).f;t.exports=function(t){var e=r.Symbol||(r.Symbol=a?{}:n.Symbol||{});"_"==t.charAt(0)||t in e||s(e,t,{value:o.f(t)})}},function(t,e,i){var n=i(68),r=i(7)("iterator"),a=i(64);t.exports=i(36).getIteratorMethod=function(t){if(void 0!=t)return t[r]||t["@@iterator"]||a[n(t)]}},function(t,e,i){"use strict";var n=i(62),r=i(164),a=i(64),o=i(21);t.exports=i(101)(Array,"Array",function(t,e){this._t=o(t),this._i=0,this._k=e},function(){var t=this._t,e=this._k,i=this._i++;return!t||i>=t.length?(this._t=void 0,r(1)):"keys"==e?r(0,i):"values"==e?r(0,t[i]):r(0,[i,t[i]])},"values"),a.Arguments=a.Array,n("keys"),n("values"),n("entries")},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var a=i(1),o=(r(a),i(22)),s=n(o),l=i(10),c=(r(l),"vzb-active"),u=s.default.extend({init:function(t,e){this.name="gapminder-optionsbuttonlist",this._super(t,e)},readyOnce:function(){var t=this;Object.keys(this._available_buttons).forEach(function(e){var i=t._available_buttons[e];i.required=!i.required}),this.buttonListComp=this.root.findChildByName("gapminder-buttonlist"),this.buttonListComp.on("click",function(e,i){var n=t.element.selectAll(".vzb-buttonlist-btn[data-btn='"+i.id+"']");n.classed(c,i.active)}),this.buttonListComp.on("toggle",function(e,i){var n=t.element.selectAll(".vzb-buttonlist-btn"),r=0;n.each(function(t){var e=d3.select(this),n=i.hiddenButtons.indexOf(t.id)==-1;e.style("display",n?"none":""),n||r++})}),this._super()},proceedClick:function(t){var e=this;this.buttonListComp.proceedClick(t);var i=this.element.selectAll(".vzb-buttonlist-btn[data-btn='"+t+"']").datum();i.func&&setTimeout(function(){e.root.findChildByName("gapminder-dialogs").closeAllDialogs()},200)},_toggleButtons:function(){}});e.default=u},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var a=i(1),o=(r(a),i(11)),s=n(o),l=i(34),c=n(l),u=s.default.extend({init:function(t,e){this.name="about",this._super(t,e)},readyOnce:function(){var t=c.default.version,e=new Date(parseInt(c.default.build));this.element=d3.select(this.element),this.element.select(".vzb-about-text0").html("This chart is made with Vizabi,"),this.element.select(".vzb-about-text1").html("a project by <a href='http://gapminder.org'>Gapminder Foundation</a>"),this.element.select(".vzb-about-version").html("<a href='https://github.com/Gapminder/vizabi/releases/tag/v"+t+"'>Version: "+t+" (alpha)</a>"),this.element.select(".vzb-about-updated").html("Build: "+d3.time.format("%Y-%m-%d at %H:%M")(e)),this.element.select(".vzb-about-text2").html("Alpha version: don't expect too much!"),this.element.select(".vzb-about-report").html("<a href='https://getsatisfaction.com/gapminder/'>Report a problem</a>"),this.element.select(".vzb-about-credits").html("<a href='https://github.com/Gapminder/vizabi/graphs/contributors'>Contributors</a>")}});e.default=u},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var a=i(1),o=(r(a),i(2)),s=(n(o),i(11)),l=n(s),c=i(48),u=n(c),h=i(88),d=n(h),f=l.default.extend({init:function(t,e){this.name="axes";this.components=[{component:u.default,placeholder:".vzb-xaxis-selector",model:["state.time","state.entities","state.marker","locale"],markerID:"axis_x"},{component:d.default,placeholder:".vzb-xaxis-minmax",model:["state.marker","state.time","locale"],markerID:"axis_x",ui:{selectDomainMinMax:!1,selectZoomedMinMax:!0}},{component:u.default,placeholder:".vzb-yaxis-selector",model:["state.time","state.entities","state.marker","locale"],markerID:"axis_y"},{component:d.default,placeholder:".vzb-yaxis-minmax",model:["state.marker","state.time","locale"],markerID:"axis_y",ui:{selectDomainMinMax:!1,selectZoomedMinMax:!0}}],this._super(t,e)}});e.default=f},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var a=i(1),o=(r(a),i(2)),s=(n(o),i(11)),l=n(s),c=i(88),u=n(c),h=l.default.extend({init:function(t,e){this.name="axesmc";var i=this;this.model_binds={"change:ui.chart.xLogStops":function(){i.updateView()},"change:ui.chart.yMaxMethod":function(){i.updateView()}},this.components=[{component:u.default,placeholder:".vzb-xlimits-container",model:["state.marker","state.time","locale"],markerID:"axis_x",ui:{selectDomainMinMax:!1,selectZoomedMinMax:!0}}],this._super(t,e)},readyOnce:function(){this._super();var t=this;this.yMaxRadio=this.element.select(".vzb-yaxis-container").selectAll("input").on("change",function(){t.setModel("yMaxMethod",d3.select(this).node().value)}),this.xLogStops=this.element.select(".vzb-xaxis-container").selectAll("input").on("change",function(){t.setModel("xLogStops",d3.select(this).node().value)}),this.probeCheck=this.element.select(".vzb-probe-check").on("change",function(){t.setModel("showProbeX",d3.select(this).property("checked"))}),this.probeFieldEl=this.element.select(".vzb-probe-field").on("change",function(){var e=parseFloat(this.value.replace(",","."));return!e||e<=t.model.state.marker.axis_x.tailCutX?void(this.value=t.model.ui.chart.probeX):(e>t.model.state.marker.axis_x.domainMax&&(e=t.model.state.marker.axis_x.domainMax),this.value=e,void t.setModel("probeX",e))}),this.updateView()},updateView:function(){var t=this;this.yMaxRadio.property("checked",function(){return d3.select(this).node().value===t.model.ui.chart.yMaxMethod}),this.xLogStops.property("checked",function(){return t.model.ui.chart.xLogStops.indexOf(+d3.select(this).node().value)!==-1}),this.probeCheck.property("checked",this.model.ui.chart.showProbeX),this.probeFieldEl.property("value",this.model.ui.chart.probeX)},setModel:function(t,e){var i=void 0;"yMaxMethod"==t&&(i=e),"xLogStops"==t&&(i=[],this.xLogStops.each(function(){d3.select(this).property("checked")&&i.push(+d3.select(this).node().value)})),"probeX"!=t&&"showProbeX"!=t||(i=e),this.model.ui.chart[t]=i}});e.default=h},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var a=i(1),o=(r(a),i(2)),s=(n(o),i(11)),l=n(s),c=i(87),u=n(c),h=i(48),d=n(h),f=l.default.extend({init:function(t,e){this.name="colors",this.components=[{component:d.default,placeholder:".vzb-caxis-selector",model:["state.time","state.entities","state.marker","locale"],markerID:"color",showHoverValues:!0},{component:u.default,placeholder:".vzb-clegend-container",model:["state.time","state.entities","state.marker","locale"]}],this._super(t,e)}});e.default=f},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var a=i(1),o=r(a),s=i(2),l=(n(s),i(11)),c=n(l),u=i(67),h=n(u),d=c.default.extend({init:function(t,e){this.name="find";var i=this;this.components=[{component:h.default,placeholder:".vzb-dialog-bubbleopacity",model:["state.marker"],arg:"opacitySelectDim",properties:{step:.01}}],this.model_binds={"change:state.marker.select":function(t){i.selectDataPoints(),i.showHideDeselect()},"change:state.time.playing":function(t){i.model.state.time.playing||(i.time=i.model.state.time.value,i.model.state.marker.getFrame(i.time,function(t,e){!t||i.time-e||i.redrawDataPoints(t)}))},"change:state.time.value":function(t){(i.placeholderEl.classed("vzb-active")||i.placeholderEl.classed("vzb-sidebar"))&&(i.time=i.model.state.time.value,i.model.state.marker.getFrame(i.time,function(t){t&&i.redrawDataPoints(t)}))},"translate:locale":function(){i.input_search.attr("placeholder",i.translator("placeholder/search")+"...")}},this._super(t,e)},readyOnce:function(){this._super(),this.list=this.element.select(".vzb-find-list"),this.input_search=this.element.select(".vzb-find-search"),this.deselect_all=this.element.select(".vzb-find-deselect"),this.opacity_nonselected=this.element.select(".vzb-dialog-bubbleopacity"),this.KEY=this.model.state.entities.getDimension();var t=this;this.input_search.on("keyup",function(){var e=d3.event;13==e.keyCode&&"select all"==t.input_search.node().value&&(t.input_search.node().value="",o.isTouchDevice()||t.model.state.marker.clearHighlighted(),t.model.state.marker.selectAll())}),this.input_search.on("input",function(){t.showHideSearch()}),this.deselect_all.on("click",function(){t.deselectMarkers()}),this.translator=this.model.locale.getTFunction(),this.input_search.attr("placeholder",this.translator("placeholder/search")+"..."),this.root.on("ready",function(){t.ready()})},open:function(){var t=this;this._super(),this.input_search.node().value="",this.showHideSearch(),this.time=this.model.state.time.value,this.model.state.marker.getFrame(this.time,function(e){e&&t.redrawDataPoints(e)})},ready:function(){this._super();var t=this,e=this.KEY;this.time=this.model.state.time.value,this.model.state.marker.getFrame(this.time,function(i){if(i){var n=t.model.state.marker.getKeys().map(function(t){var n={};return n[e]=t[e],n.brokenData=!1,n.name=i.label[t[e]],n});n.sort(function(t,e){return t.name<e.name?-1:1}),t.list.html(""),t.items=t.list.selectAll(".vzb-find-item").data(n).enter().append("div").attr("class","vzb-find-item vzb-dialog-checkbox"),t.items.append("input").attr("type","checkbox").attr("class","vzb-find-item").attr("id",function(i){return"-find-"+i[e]+"-"+t._id}).on("change",function(e){o.isTouchDevice()||t.model.state.marker.clearHighlighted(),t.model.state.marker.selectMarker(e),o.isTouchDevice()||e.brokenData||t.model.state.marker.highlightMarker(e)}),t.items.append("label").attr("for",function(i){return"-find-"+i[e]+"-"+t._id}).text(function(t){return t.name}).on("mouseover",function(e){o.isTouchDevice()||e.brokenData||t.model.state.marker.highlightMarker(e)}).on("mouseout",function(e){o.isTouchDevice()||t.model.state.marker.clearHighlighted()}),o.preventAncestorScrolling(t.element.select(".vzb-dialog-scrollable")),t.redrawDataPoints(i),t.selectDataPoints(),t.showHideSearch(),t.showHideDeselect()}})},redrawDataPoints:function(t){var e=this,i=this.KEY;e.items.each(function(n){var r=d3.select(this).select("label");n.brokenData=!1,o.forEach(t,function(t,r){"color"===r||"size_label"===r||"constant"===e.model.state.marker[r].use||t[n[i]]||0===t[n[i]]||(n.brokenData=!0)}),r.classed("vzb-find-item-brokendata",n.brokenData).attr("title",n.brokenData?e.model.state.time.formatDate(e.time)+": "+e.translator("hints/nodata"):"")})},selectDataPoints:function(){var t=this.KEY,e=this.model.state.marker.getSelected(t);this.items.selectAll("input").property("checked",function(i){return e.indexOf(i[t])!==-1})},showHideSearch:function(){var t=this.input_search.node().value||"";t=t.toLowerCase(),this.list.selectAll(".vzb-find-item").classed("vzb-hidden",function(e){var i=(e.name||"").toLowerCase();return i.indexOf(t)===-1})},showHideDeselect:function(){var t=!!this.model.state.marker.select.length;this.deselect_all.classed("vzb-hidden",!t),this.opacity_nonselected.classed("vzb-hidden",!t)},deselectMarkers:function(){this.model.state.marker.clearSelected()},transitionEnd:function(t){this._super(t),o.isTouchDevice()||this.input_search.node().focus()}});e.default=d},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var a=i(1),o=(r(a),i(2)),s=(n(o),i(11)),l=n(s),c=i(136),u=n(c),h=i(48),d=n(h),f=i(59),p=n(f),m=l.default.extend({init:function(t,e){this.name="label",this.components=[{component:u.default,placeholder:".vzb-dialog-sizeslider",model:["state.marker.size_label","locale"],propertyname:"LabelTextSize",ui:{constantUnit:"unit/pixels"}},{component:d.default,placeholder:".vzb-saxis-selector",model:["state.time","state.entities","state.marker","locale"],markerID:"size_label",showHoverValues:!0},{component:p.default,placeholder:".vzb-removelabelbox-switch",model:["ui.chart","locale"],checkbox:"removeLabelBox",submodel:"labels"}],this._super(t,e)}});e.default=m},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var a=i(1),o=(r(a),i(2)),s=(n(o),i(11)),l=n(s),c=l.default.extend({init:function(t,e){this.name="mapoptions",this.selectedLayer={},this.mapEngines=[{title:"Topojson",value:"topojson"},{title:"Google",value:"google"},{title:"Mapbox",value:"mapbox"}],this.mapLayers={google:[{title:"Land",value:"terrain"},{title:"Satellite",value:"satellite"}],mapbox:[{title:"Land",value:"mapbox://styles/mapbox/streets-v9"},{title:"Satellite",value:"mapbox://styles/mapbox/satellite-v9"},{title:"Satellite Street",value:"mapbox://styles/mapbox/satellite-streets-v9"}]},this.components=[],this._super(t,e)},readyOnce:function(){this._super(),this.selectedLayer[this.model.ui.map.mapEngine]=this.model.ui.map.mapLayer;var t=this;this.mapEngineForm=this.element.select(".vzb-dialog-paragraph.map-api").selectAll("input").data(t.mapEngines),this.mapEngineForm.exit().remove(),this.mapEngineForm.enter().append("label").attr("for",function(t,e){return"a"+e}).each(function(e,i){d3.select(this).append("input").attr("id","a"+i).attr("type","radio").attr("name","engine").attr("value",e.value).property("checked",e.value==t.model.ui.map.mapEngine).on("change",function(){return t.setModel("mapEngine",e.value)}),d3.select(this).append("span").text(e.title)}),this.updateView()},updateView:function(){var t=this;this.element.select(".vzb-dialog-paragraph.map-layer").selectAll("label").remove();var e=t.mapLayers[t.model.ui.map.mapEngine]?t.mapLayers[t.model.ui.map.mapEngine]:[];this.mapLayerForm=this.element.select(".vzb-dialog-paragraph.map-layer").selectAll("label").data(e),this.mapLayerForm.enter().append("label").attr("for",function(t,e){return"a"+e}).each(function(e,i){d3.select(this).append("input").attr("id","a"+i).attr("type","radio").attr("name","layer").attr("value",e.value).property("checked",e.value==t.selectedLayer[t.model.ui.map.mapEngine]).on("change",function(){return t.setModel("mapLayer",e.value)}),d3.select(this).append("span").text(e.title)})},setModel:function(t,e){"mapEngine"==t&&this.model.ui.map.mapEngine!=e&&(this.selectedLayer[e]||(this.selectedLayer[e]=this.mapLayers[e]?this.mapLayers[e][0].value:null),this.model.ui.map.mapEngine=e,this.updateView(),this.model.ui.map.mapLayer=this.selectedLayer[e]),"mapLayer"==t&&(this.selectedLayer[this.model.ui.map.mapEngine]=e,this.model.ui.map.mapLayer=e)}});e.default=c},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);
return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var a=i(1),o=r(a),s=i(2),l=(n(s),i(11)),c=n(l),u=i(67),h=(n(u),i(86)),d=(n(h),i(87)),f=(n(d),i(48)),p=(n(f),i(59)),m=(n(p),i(117)),g=n(m),v=c.default.extend({init:function(t,e){this.name="moreoptions",this.components=[{component:g.default,placeholder:".vzb-dialog-options-buttonlist",model:["state","ui","locale"]}],this._super(t,e)},readyOnce:function(){this._super();var t=this;this.accordionEl=this.contentEl.select(".vzb-accordion"),this.on("dragend",function(){t._setMaxHeight()});var e=(this.model.ui.dialogs||{}).popup||[],i=(this.model.ui.dialogs||{}).moreoptions||[];if(i===!0&&(i=e,(this.model.ui.dialogs||{}).moreoptions=i),this._addDialogs(i),this.accordionEl){var n=this.accordionEl.selectAll(".vzb-accordion-section").select(".vzb-dialog-title>span:first-child");n.on("click",function(e){var i=(t.components[e.component].element,t.components[e.component].placeholderEl),n=t.accordionEl.select(".vzb-accordion-active");n&&n.classed("vzb-accordion-active",!1),i.node()!==n.node()&&i.classed("vzb-accordion-active",!0)})}},_addDialogs:function(t){this._components_config=[];var e=[];if(t.length){for(var i=0;i<t.length;i++)if("moreoptions"!==t[i]){var n=t[i],r=o.deepClone(this.parent._available_dialogs[n]);if(r&&r.dialog){var a=this._components_config;a.push({component:r.dialog,placeholder:'.vzb-dialogs-dialog[data-dlg="'+n+'"]',model:["state","ui","locale"]}),r.component=a.length-1,r.id=n,e.push(r)}}this.accordionEl.selectAll("div").data(e).enter().append("div").attr("class",function(t){var e="vzb-dialogs-dialog vzb-moreoptions vzb-accordion-section";return e}).attr("data-dlg",function(t){return t.id}),this.loadSubComponents();var s=this;o.forEach(this.components,function(t){t.render(),s.on("resize",function(){t.trigger("resize")})})}}});e.default=v},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var a=i(1),o=(r(a),i(2)),s=(n(o),i(11)),l=n(s),c=i(67),u=n(c),h=l.default.extend({init:function(t,e){this.name="opacity",this.components=[{component:u.default,placeholder:".vzb-dialog-bubbleopacity-regular",model:["state.marker"],arg:"opacityRegular",properties:{step:.01}},{component:u.default,placeholder:".vzb-dialog-bubbleopacity-selectdim",model:["state.marker"],arg:"opacitySelectDim",properties:{step:.01}}],this._super(t,e)}});e.default=h},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var a=i(1),o=(r(a),i(2)),s=(n(o),i(11)),l=n(s),c=i(59),u=n(c),h=l.default.extend({init:function(t,e){this.name="presentation",this.components=[{component:u.default,placeholder:".vzb-presentationmode-switch",model:["ui","locale"],checkbox:"presentation"}],this._super(t,e)}});e.default=h},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var a=i(1),o=r(a),s=i(2),l=(n(s),i(11)),c=n(l),u=c.default.extend({init:function(t,e){this.name="show";var i=this;this.model_binds={"change:state.entities.show":function(t){i.redraw()}},this._super(t,e)},readyOnce:function(){this._super(),this.list=this.element.select(".vzb-show-list"),this.input_search=this.element.select(".vzb-show-search"),this.deselect_all=this.element.select(".vzb-show-deselect"),this.KEY=this.model.state.entities.getDimension(),this.TIMEDIM=this.model.state.time.getDimension();var t=this;this.input_search.on("input",function(){t.showHideSearch()}),this.deselect_all.on("click",function(){t.deselectEntities()}),this.root.on("ready",function(){t.redraw()})},open:function(){this._super(),this.input_search.node().value="",this.showHideSearch()},ready:function(){this._super(),this.redraw(),o.preventAncestorScrolling(this.element.select(".vzb-dialog-scrollable"))},redraw:function(){var t=this;this.translator=this.model.locale.getTFunction(),this.model.state.marker_allpossible.getFrame(this.model.state.time.value,function(e){if(e){var i=o.keys(e.label).map(function(i){var n={};return n[t.KEY]=i,n.label=e.label[i],n});i.sort(function(t,e){return t.label<e.label?-1:1}),t.list.html("");var n=t.list.selectAll(".vzb-show-item").data(i).enter().append("div").attr("class","vzb-show-item vzb-dialog-checkbox");n.append("input").attr("type","checkbox").attr("class","vzb-show-item").attr("id",function(e){return"-show-"+e[t.KEY]+"-"+t._id}).property("checked",function(e){return t.model.state.entities.isShown(e)}).on("change",function(e){t.model.state.marker.clearSelected(),t.model.state.entities.showEntity(e),t.showHideDeselect()}),n.append("label").attr("for",function(e){return"-show-"+e[t.KEY]+"-"+t._id}).text(function(t){return t.label}),t.input_search.attr("placeholder",t.translator("placeholder/search")+"..."),t.showHideSearch(),t.showHideDeselect()}})},showHideSearch:function(){var t=this.input_search.node().value||"";t=t.toLowerCase(),this.list.selectAll(".vzb-show-item").classed("vzb-hidden",function(e){var i=e.label.toLowerCase();return i.indexOf(t)===-1})},showHideDeselect:function(){var t=this.model.state.entities.show[this.KEY];this.deselect_all.classed("vzb-hidden",!t||0==t.length)},deselectEntities:function(){this.model.state.entities.clearShow(),this.showHideDeselect()},transitionEnd:function(t){this._super(t),o.isTouchDevice()||this.input_search.node().focus()}});e.default=u},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var a=i(1),o=r(a),s=i(2),l=(n(s),i(11)),c=n(l),u=i(48),h=n(u),d=i(59),f=(n(d),c.default.extend({init:function(t,e){this.name="side";var i=this;this.model_binds={"change:state.marker.side.which":function(t){if(i.model.state.entities_allpossibleside){var e="constant"==i.model.state.marker.side.use?null:i.model.state.marker.side.which;i.model.state.entities_allpossibleside.set("dim",e)}},"change:state.entities_side.show":function(t){i._readyOnce&&(i.updateState(),i.redraw())},"change:ui.chart.flipSides":function(t){i._readyOnce&&(i.updateState(),i.redraw())}},this.components=[{component:h.default,placeholder:".vzb-side-selector",model:["state.time","state.entities_side","state.marker","locale"],markerID:"side",showHoverValues:!1}],this._super(t,e)},readyOnce:function(){this._super(),this.listLeft=this.element.select(".vzb-side-list-left"),this.listRight=this.element.select(".vzb-side-list-right"),this.switchSides=this.element.select(".vzb-side-switch-sides"),this.TIMEDIM=this.model.state.time.getDimension(),this.state={};var t=this;this.switchSides.on("click",function(){t.model.ui.chart.flipSides=!t.model.ui.chart.flipSides}),this.root.on("ready",function(){t.redraw()})},ready:function(){this._super(),this.KEY=this.model.state.entities_side.getDimension(),this.updateState(),this.redraw(),o.preventAncestorScrolling(this.element.select(".vzb-dialog-scrollable"))},updateState:function(){var t=this,e=this,i=this.model.state.marker.side.getEntity().getDimension(),n=this.model.state.marker.side;this.state.right={},this.state.left={},n.state.left[i]&&n.state.right[i]?(this.state.left[i]=n.state.left[i],this.state.right[i]=n.state.right[i]):!function(){var n=t.model.state.marker.getKeys(i),r=[],a=!!t.model.state.marker.side.getEntity().show[i];if(r=n.filter(function(t){return!a||e.model.state.marker.side.getEntity().isShown(t)}).map(function(t){return t[i]}),r.length>2&&(r.length=2),r.length>1){var o=t.ui.chart.flipSides?d3.ascending:d3.descending;r.sort(o)}t.state.right={},t.state.right[i]=r[0],t.state.left={},t.state.left[i]=r[1]?r[1]:r[0]}();var r="constant"==this.model.state.marker.side.use;this.listLeft.classed("vzb-hidden",r),this.listRight.classed("vzb-hidden",r),this.switchSides.classed("vzb-hidden",r||this.state.left[i]==this.state.right[i])},redraw:function(){var t=this;this.translator=this.model.locale.getTFunction(),t.model.state.entities_allpossibleside.dim&&this.model.state.marker_allpossibleside.getFrame(this.model.state.time.value,function(e){if(e){var i=o.keys(e.label).map(function(i){var n={};return n[t.KEY]=i,n.label=e.label[i],n});i.sort(function(t,e){return t.label<e.label?-1:1}),t.listLeft.html(""),t.listRight.html(""),t.createList(t.listLeft,"left",i),t.createList(t.listRight,"right",i)}})},createList:function(t,e,i){var n=this,r=this.model.state.marker.side.getEntity().getDimension(),a=t.selectAll(".vzb-side-item").data(i).enter().append("div").attr("class","vzb-side-item vzb-dialog-radio");a.append("input").attr("type","radio").attr("name",e+"-"+n._id).attr("class","vzb-side-item").attr("id",function(t){return"-side-"+e+"-"+t[r]+"-"+n._id}).property("checked",function(t){return n.state[e][r]===t[r]}).on("change",function(t,i){var r=n.model.state.entities_side,a=r.getDimension(),o="left"==e?"right":"left",s=n.model.state.marker.side;s.state[e][a]=t[a],s.state[o][a]=n.state[o][a];var l=[];if(r.isShown(t)||l.push(t),t[a]===n.state[o][a]||r.isShown(n.state[o])||l.push(n.state[o]),n.state[e][a]!==n.state[o][a]&&r.isShown(n.state[e])&&l.push(n.state[e]),t[a]!==n.state[o][a]){var c=[t[a],n.state[o][a]],u=n.ui.chart.flipSides?d3.ascending:d3.descending;c.sort(u),c["left"==e?0:1]==t[a]&&(n.model.state.marker.side.switchSideState(),n.ui.chart.flipSides=!n.ui.chart.flipSides)}l.length&&r.showEntity(l)}),a.append("label").attr("for",function(t){return"-side-"+e+"-"+t[n.KEY]+"-"+n._id}).text(function(t){return t.label})}}));e.default=f},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var a=i(1),o=(r(a),i(2)),s=(n(o),i(11)),l=n(s),c=i(86),u=n(c),h=i(48),d=n(h),f=l.default.extend({init:function(t,e){this.name="size",this.components=[{component:d.default,placeholder:".vzb-saxis-selector",model:["state.time","state.entities","state.marker","locale"],markerID:"size",showHoverValues:!0}],t.ui.chart&&0===t.ui.chart.sizeSelectorActive||this.components.push({component:u.default,placeholder:".vzb-dialog-bubblesize",model:["state.marker.size"],ui:{show_button:!1}}),this._super(t,e)}});e.default=f},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var a=i(1),o=(r(a),i(2)),s=(n(o),i(11)),l=n(s),c=i(67),u=n(c),h=l.default.extend({init:function(t,e){this.name="speed",this.components=[{component:u.default,placeholder:".vzb-dialog-placeholder",model:["state.time"],arg:"delay",properties:{min:1,max:6,step:.1,scale:d3.scale.linear().domain([1,2,3,4,5,6]).range([1200,900,450,200,150,100])}}],this._super(t,e)}});e.default=h},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var a=i(1),o=(r(a),i(2)),s=(n(o),i(11)),l=n(s),c=i(135),u=n(c),h=l.default.extend({init:function(t,e){this.name="stack";var i=this;this.components=[{component:u.default,placeholder:".vzb-dialog-draggablelist",model:["state.marker.group","state.marker.color","locale","ui.chart"],groupID:"manualSorting",isEnabled:"manualSortingEnabled",dataArrFn:i.manualSorting.bind(i),lang:""}],this.model_binds={"change:state.marker.group":function(t){i._ready&&i.updateView()}},this._super(t,e)},readyOnce:function(){this._super();var t=this;this.group=this.model.state.marker.group,this.stack=this.model.state.marker.stack,this.howToStackEl=this.element.select(".vzb-howtostack").selectAll("input").on("change",function(){t.setModel("stack",d3.select(this).node().value)}),this.howToMergeEl=this.element.select(".vzb-howtomerge").selectAll("input").on("change",function(){t.setModel("merge",d3.select(this).node().value)}),this.updateView()},ready:function(){if(this._super(),!this.model.state.marker.color.isDiscrete()){if("property"==this.stack.use)return void this.setModel("stack","none");if(this.group.merge)return void this.setModel("merge","none")}this.updateView()},updateView:function(){var t=this;this.howToStackEl.property("checked",function(){return"none"===d3.select(this).node().value?"none"===t.stack.which:"bycolor"===d3.select(this).node().value?t.stack.which===t.model.state.marker.color.which:"all"===d3.select(this).node().value?"all"===t.stack.which:void 0}).attr("disabled",function(){return"none"===d3.select(this).node().value?null:"all"===d3.select(this).node().value?null:"bycolor"===d3.select(this).node().value?"property"!==t.model.state.marker.color.use||null:void 0}),t.model.ui.chart.manualSortingEnabled="all"==t.stack.which,this.howToMergeEl.property("checked",function(){return"none"===d3.select(this).node().value?!t.group.merge&&!t.stack.merge:"grouped"===d3.select(this).node().value?t.group.merge:"stacked"===d3.select(this).node().value?t.stack.merge:void 0}).attr("disabled",function(){return"none"===d3.select(this).node().value?null:"grouped"===d3.select(this).node().value?"none"===t.stack.which||"property"!==t.model.state.marker.color.use||null:"stacked"===d3.select(this).node().value?"all"!==t.stack.which||null:void 0})},manualSorting:function(t){return 0===arguments.length?this.model.state.marker.group.manualSorting:void(this.model.state.marker.group.manualSorting=t)},setModel:function(t,e){var i={stack:{},group:{}};if("merge"===t)switch(e){case"none":i.group.merge=!1,i.stack.merge=!1;break;case"grouped":i.group.merge=!0,i.stack.merge=!1;break;case"stacked":i.group.merge=!1,i.stack.merge=!0}if("stack"===t){switch(e){case"all":i.stack.use="constant",i.stack.which="all";break;case"none":i.stack.use="constant",i.stack.which="none";break;case"bycolor":i.stack.use="property",i.stack.which=this.model.state.marker.color.which}"none"===e&&this.group.merge&&(i.group.merge=!1),"all"!==e&&this.stack.merge&&(i.stack.merge=!1)}this.model.state.marker.set(i)}});e.default=h},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var r=i(11),a=n(r),o=i(60),s=n(o),l=a.default.extend({init:function(t,e){var i=this;this.name="timedisplay",this.model_binds={"change:state.time.value":function(){i.updateTime()}},this._super(t,e)},ready:function(){this.updateTime()},readyOnce:function(){this._super(),this.timeLabel=new s.default(this.element.select(".vzb-timedisplay")),this.timeLabel.setConditions({widthRatio:1,heightRatio:1}),this.timeLabel.resize(this.contentEl.style("width"),this.contentEl.style("height"))},updateTime:function(){var t=this.model.state.time;this.time_1=null==this.time?t.value:this.time,this.time=t.value;var e=t.playing&&this.time-this.time_1>0?t.delayAnimations:0;this.timeLabel.setText(t.formatDate(this.time,"ui"),e)}});e.default=l},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var a=i(1),o=(r(a),i(2)),s=(n(o),i(11)),l=n(s),c=i(137),u=n(c),h=i(59),d=n(h),f=l.default.extend({init:function(t,e){this.name="zoom",this.components=[{component:u.default,placeholder:".vzb-dialog-zoom-buttonlist",model:["state","ui","locale"]},{component:d.default,placeholder:".vzb-panwitharrow-switch",model:["ui","locale"],checkbox:"panWithArrow"},{component:d.default,placeholder:".vzb-zoomonscrolling-switch",model:["ui","locale"],checkbox:"zoomOnScrolling"},{component:d.default,placeholder:".vzb-adaptminmaxzoom-switch",model:["ui","locale"],checkbox:"adaptMinMaxZoom"}],this._super(t,e)}});e.default=f},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var a=i(1),o=r(a),s=i(2),l=n(s),c=l.default.extend({init:function(t,e){this.template='<span class="vzb-dl-holder"><ul class="vzb-draggable list vzb-dialog-scrollable"></ul></span>';var i=this;this.name="draggableList",this.dataArrFn=t.dataArrFn,this.lang=t.lang,this.model_expects=[{name:"group",type:"model"},{name:"color",type:"color"},{name:"locale",type:"locale"},{name:"chart",type:"model"}],this.groupID=t.groupID,this.isEnabled=t.isEnabled,this.draggable=!0,t.groupID||o.warn("draggablelist.js complains on 'groupID' property: "+t.groupID),this.model_binds={"translate:locale":function(t){i.updateView()},"change:group.which":function(t){i.updateView()}},this.model_binds["change:group."+this.groupID]=function(t){i.updateView()},this.model_binds["change:chart."+this.isEnabled]=function(t){i.draggable=i.model.chart[i.isEnabled],i.updateView()},this._super(t,e),this.updateData=o.debounce(this.updateData,1e3),this.itemDragger=d3.drag().on("start",function(t,e){!i.dataUpdateFlag&&i.draggable&&(d3.event.sourceEvent.stopPropagation(),i.parentBoundRect=i.element.node().getBoundingClientRect(),i.element.selectAll("div").each(function(e,n){var r=this.getBoundingClientRect();e._y=r.top,e._top=0,t.data===e.data&&(e._height=r.height,i.selectedNode=this)}),d3.select(i.selectedNode).classed("dragged",!0))}).on("drag",function(t,e){if(!i.dataUpdateFlag&&i.draggable){t._top+=d3.event.dy;var n=t._y+t._top;n>i.parentBoundRect.top&&n+t._height<i.parentBoundRect.top+i.parentBoundRect.height&&i.itemsEl.style("top",function(i,r){var a=0;return r<e&&i._y+.5*t._height>n?a=t._height:r>e&&i._y-.5*t._height<n&&(a=-t._height),r!=e&&(i._top=a),i._top+"px"})}}).on("end",function(t,e){!i.dataUpdateFlag&&i.draggable&&i.getData()})},ready:function(){var t=this,e=t.model.color.getColorlegendMarker().label.getItems();this.dataArrFn(o.keys(e)),this.updateView(),this.itemsEl=this.element.selectAll("div"),this.itemsEl.call(t.itemDragger);this.itemsEl.select("li").on("mouseover",function(){d3.select(this).classed("hover",!0)}).on("mouseout",function(){d3.select(this).classed("hover",!1)}).on("touchstart",function(){d3.event.preventDefault()})},updateView:function(){var t=this;this.items=this.element.selectAll("div").data(function(){return t.dataArrFn().map(function(t){return{data:t}})}),this.items.exit().remove(),this.items=this.items.enter().append("div").append("li").merge(this.items);var e=t.model.color.getColorlegendMarker().label.getItems();this.items.select("li").classed("hover",!1).each(function(t,i){d3.select(this).attr("data",t.data).text(e[t.data])});var i=!!t.draggable||null;this.element.selectAll("div").style("top","").attr("draggable",i).classed("dragged",!1),this.dataUpdateFlag=!1},getData:function(){var t=[],e=this.element.selectAll("div").data();t=e.sort(function(t,e){return t._y+t._top-(e._y+e._top)}).map(function(t){return t.data}),o.arrayEquals(this.dataArrFn(),t)?this.updateView():(this.dataUpdateFlag=!0,this.updateData(t))},updateData:function(t){this.dataArrFn(t)},readyOnce:function(){this.element=d3.select(this.element).select(".list")}});e.default=c},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var a=i(1),o=r(a),s=i(2),l=n(s),c={EXTENT_MIN:0,EXTENT_MAX:1,TEXT_PARAMS:{TOP:18,LEFT:10,MAX_WIDTH:42,MAX_HEIGHT:16},BAR_WIDTH:6,THUMB_RADIUS:10,THUMB_STROKE_WIDTH:4,INTRO_DURATION:250,MARGIN:{TOP:2,LEFT:5,RIGHT:5}},u={small:{minLabelTextSize:7,maxLabelTextSize:21,defaultLabelTextSize:12},medium:{minLabelTextSize:7,maxLabelTextSize:30,defaultLabelTextSize:15},large:{minLabelTextSize:6,maxLabelTextSize:48,defaultLabelTextSize:20}},h=l.default.extend({init:function(t,e){function n(t,e){var i=r.model.size.extent||[c.EXTENT_MIN,c.EXTENT_MAX];r._updateLabels(i),r._moveBrush(i)}this.name="sizeslider",this.template=this.template||i(454),this.propertyName=t.propertyname,this.model_expects=[{name:"size",type:"size"},{name:"locale",type:"locale"}];var r=this;this.model_binds={"change:size.domainMin":n,"change:size.domainMax":n,"change:size.extent":n,ready:function(){r.modelReady()}},this._setModel=o.throttle(this._setModel,50),this._super(t,e)},modelReady:function(){var t=this;t.modelUse=t.model.size.use;var e=t.model.size.extent||[c.EXTENT_MIN,c.EXTENT_MAX];if("constant"!=t.modelUse)t.sizeScaleMinMax=t.model.size.getScale().domain(),t.sliderEl.selectAll(".w").classed("vzb-hidden",!1),t.sliderEl.select(".selection").classed("vzb-hidden",!1),t.sliderEl.select(".overlay").classed("vzb-pointerevents-none",!1),t._setLabelsText();else if(t.sliderEl.selectAll(".w").classed("vzb-hidden",!0),t.sliderEl.select(".selection").classed("vzb-hidden",!0),t.sliderEl.select(".overlay").classed("vzb-pointerevents-none",!0),!t.model.size.which){var i=t.propertyActiveProfile;e[1]=(i.default-i.min)/(i.max-i.min),t.model.size.which="_default"}t._moveBrush(e)},readyOnce:function(){var t=this,e=t.model.size.extent||[c.EXTENT_MIN,c.EXTENT_MAX];this.element=d3.select(this.element),this.sliderSvg=this.element.select(".vzb-szs-svg"),this.sliderWrap=this.sliderSvg.select(".vzb-szs-slider-wrap"),this.sliderEl=this.sliderWrap.select(".vzb-szs-slider");var i=({v:c.TEXT_PARAMS.TOP,h:c.TEXT_PARAMS.LEFT},c.TEXT_PARAMS.MAX_WIDTH,c.TEXT_PARAMS.MAX_HEIGHT),n=c.BAR_WIDTH,r=c.THUMB_RADIUS,a=(c.THUMB_STROKE_WIDTH,{top:c.MARGIN.TOP+1.25*n,left:r,right:r,bottom:n+i}),o=this.element.node().offsetWidth;this.padding=a,this.propertyActiveProfile=this.getPropertyActiveProfile(),this.translator=this.model.locale.getTFunction(),this.propertyScale=d3.scale.linear().domain([c.EXTENT_MIN,c.EXTENT_MAX]).range([this.propertyActiveProfile.min,this.propertyActiveProfile.max]).clamp(!0),this.xScale=d3.scale.linear().domain([c.EXTENT_MIN,c.EXTENT_MAX]).range([0,o-a.left-a.right]).clamp(!0),this.brush=d3.brushX().extent([[0,0],[o-a.left-a.right,n]]).handleSize(2*r+2*n).on("start",function(){if(!t.nonBrushChange&&d3.event.sourceEvent){if(d3.event.selection&&d3.event.selection[0]==d3.event.selection[1]){var e=t.sliderEl.node().__brush;e.selection[1][0]+=.01}t._setFromExtent(!1,!1,!1)}}).on("brush",function(){if(!t.nonBrushChange&&d3.event.sourceEvent){if(d3.event.selection&&d3.event.selection[0]==d3.event.selection[1]){var e=t.sliderEl.node().__brush;e.selection[1][0]+=.01}t._setFromExtent(!0,!1,!1)}}).on("end",function(){!t.nonBrushChange&&d3.event.sourceEvent&&t._setFromExtent(!0,!0)}),this.sliderThumbs=this.sliderEl.selectAll(".handle").data([{type:"w"},{type:"e"}],function(t){return t.type}).enter().append("svg").attr("class",function(t){return"handle handle--"+t.type+" "+t.type}).classed("vzb-szs-slider-thumb",!0),this.sliderThumbs.append("g").attr("class","vzb-szs-slider-thumb-badge").append("path").attr("d","M"+(r+n)+" "+(r+1.5*n)+"l"+-r+" "+1.5*r+"h"+2*r+"Z"),this.sliderEl.call(t.brush),this.sliderEl.selectAll("text").data([0,0]).enter().append("text").attr("class",function(t,e){return"vzb-szs-slider-thumb-label "+(e?"e":"w")}).attr("dy",1.25*-n+"px").attr("text-anchor",function(t,e){return 1-e?"start":"end"}),this.sliderLabelsEl=this.sliderEl.selectAll("text.vzb-szs-slider-thumb-label"),this.sliderEl.selectAll(".selection,.overlay").attr("height",n).attr("rx",.25*n).attr("ry",.25*n).attr("transform","translate(0,"+.5*-n+")"),this.sliderEl.select(".extent").classed("vzb-szs-slider-extent",!0),this.on("resize",function(){t.propertyActiveProfile=t.getPropertyActiveProfile(),t.propertyScale.range([t.propertyActiveProfile.min,t.propertyActiveProfile.max]);var e=t.element.node().offsetWidth;t.xScale.range([0,e-t.padding.left-t.padding.right]),t._updateSize(),t.sliderEl.call(t.brush.extent([[0,0],[e-a.left-a.right,n]]));var i=t.model.size.extent||[c.EXTENT_MIN,c.EXTENT_MAX];t._moveBrush(i)}),this._updateSize(),this._moveBrush(e),t.sizeScaleMinMax=t.model.size.getScale().domain(),t.sizeScaleMinMax&&t._setLabelsText(),t.model._ready&&this.modelReady()},getPropertyActiveProfile:function(){var t=u[this.getLayoutProfile()];return{min:t["min"+this.propertyName],max:t["max"+this.propertyName],default:t["default"+this.propertyName]}},_moveBrush:function(t){var e=t.map(this.xScale);this.nonBrushChange=!0,this.sliderEl.call(this.brush.move,[e[0],e[1]+.01]),this.nonBrushChange=!1,this._setFromExtent(!1,!1,!1)},_updateSize:function(){this.sliderSvg.attr("height",this.propertyActiveProfile.max+this.padding.top+this.padding.bottom).attr("width","100%"),this.sliderWrap.attr("transform","translate("+this.padding.left+","+(this.propertyActiveProfile.max+this.padding.top)+")")},_updateLabels:function(t){var e=this;this.sliderLabelsEl.data(t).attr("transform",function(t,i){var n=e.xScale(i),r=0;return"translate("+n+","+r+")"}).attr("font-size",function(t,i){return e.propertyScale(t)}),"constant"===e.model.size.use&&this.sliderLabelsEl.text(function(t){return~~e.propertyScale(t)+(e.translator(e.ui.constantUnit)||"")})},_setLabelsText:function(){var t=this;t.sliderLabelsEl.data([t.model.size.getTickFormatter()(t.sizeScaleMinMax[0]),t.model.size.getTickFormatter()(t.sizeScaleMinMax[1])]).text(function(t){return t})},_setFromExtent:function(t,e,i){var n=d3.brushSelection(this.sliderEl.node());n&&(n=[this.xScale.invert(n[0]),this.xScale.invert(+n[1].toFixed(1))],this._updateLabels(n),t&&this._setModel(n,e,i))},_setModel:function(t,e,i){t=[+t[0].toFixed(2),+t[1].toFixed(2)],this.model.size.set({extent:t},e,i)}});e.default=h},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var a=i(1),o=r(a),s=i(2),l=n(s),c=i(10),u=r(c),h="vzb-active",d=l.default.extend({init:function(t,e){var i=this;this.name="gapminder-zoombuttonlist",this.model_expects=[{name:"state",type:"model"},{name:"ui",type:"ui"},{name:"locale",type:"locale"}],this._available_buttons={arrow:{title:"buttons/cursorarrow",icon:"cursorArrow",func:this.toggleCursorMode.bind(this),required:!0,statebind:"ui.cursorMode",statebindfunc:this.setCursorMode.bind(this)},plus:{title:"buttons/cursorplus",icon:"cursorPlus",func:this.toggleCursorMode.bind(this),required:!0,statebind:"ui.cursorMode",statebindfunc:this.setCursorMode.bind(this)},minus:{title:"buttons/cursorminus",icon:"cursorMinus",func:this.toggleCursorMode.bind(this),required:!0,statebind:"ui.cursorMode",statebindfunc:this.setCursorMode.bind(this)},hand:{title:"buttons/cursorhand",icon:"cursorHand",func:this.toggleCursorMode.bind(this),required:!0,statebind:"ui.cursorMode",statebindfunc:this.setCursorMode.bind(this)},hundredpercent:{title:"buttons/hundredpercent",icon:"hundredPercent",func:this.toggleHundredPercent.bind(this),required:!0}},this.model_binds={},Object.keys(this._available_buttons).forEach(function(t){var e=i._available_buttons[t];e&&e.statebind&&(i.model_binds["change:"+e.statebind]=function(i){e.statebindfunc(t,i.source.value)})}),this._super(t,e)},readyOnce:function(){this.element=d3.select(this.placeholder),this.element.selectAll("div").remove(),this._addButtons(Object.keys(this._available_buttons),[]),this.setCursorMode("arrow")},_addButtons:function(t,e){var i=this;this._components_config=[];var n=[];if(t.length){for(var r=0;r<t.length;r++){var a=t[r],s=this._available_buttons[a],l=s?a:"_default",c=o.clone(this._available_buttons[l]);c.id=a,c.icon=u[c.icon],n.push(c)}var h=this.getTranslationFunction(!0);this.element.selectAll("button").data(n).enter().append("button").attr("class",function(t){var i="vzb-buttonlist-btn";return e.length>0&&e.indexOf(t.id)>-1&&(i+=" vzb-dialog-side-btn"),i}).attr("data-btn",function(t){return t.id}).html(function(t){return"<span class='vzb-buttonlist-btn-icon fa'>"+t.icon+"</span><span class='vzb-buttonlist-btn-title'>"+h(t.title)+"</span>"});var d=this.element.selectAll(".vzb-buttonlist-btn");d.on("click",function(){d3.event.preventDefault(),d3.event.stopPropagation();var t=d3.select(this).attr("data-btn");i.proceedClick(t)})}},proceedClick:function(t){var e=this,i=e.element.selectAll(".vzb-buttonlist-btn[data-btn='"+t+"']"),n=i.attr("class"),r=e._available_buttons[t];if(r&&r.func)r.func(t);else{var a=n.indexOf(h)===-1;i.classed(h,a);var o={};o.id=t,o.active=a,e.trigger("click",o)}},setButtonActive:function(t,e){var i=this.element.selectAll(".vzb-buttonlist-btn[data-btn='"+t+"']");i.classed(h,e)},toggleCursorMode:function(t){var e=t;this.model.ui.set("cursorMode",e,!1,!1)},setCursorMode:function(t){var e=this.model.ui.cursorMode?this.model.ui.cursorMode:"arrow";this.element.selectAll(".vzb-buttonlist-btn").classed(h,function(t){return t.id==e})},toggleHundredPercent:function(t){this.root.trigger("resetZoom")}});e.default=d},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var r=i(16),a=n(r),o="",s=[],l='<?xml version="1.0" encoding="utf-8"?>';e.default=a.default.extend({init:function(t){this.context=t,this.shapes=[],this.groups=[],this.counter=0,this.name="",this.label=""},reset:function(){this.container.remove(),this.context.element.selectAll(".vzb-export-redball").remove(),this.context.element.selectAll(".vzb-export-counter").remove(),this.counter=0},prefix:function(t){return arguments.length?(o=t,this):o},deleteClasses:function(t){return arguments.length?(s=t,this):s},open:function(t,e){var i=this;this.svg&&this.reset(),t||(t=this.context.element),e||(e=this.context.name),this.name=e;var n=parseInt(t.style("width"),10)||0,r=parseInt(t.style("height"),10)||0;this.container=t.append("div").attr("class","vzb-svg-export"),this.svg=this.container.node().appendChild(t.select("svg").node().cloneNode(!0)),this.svg=d3.select(this.svg),this.svg.attr("viewBox","0 0 "+n+" "+r).attr("version","1.1").attr("param1","http://www.w3.org/2000/svg").attr("param2","http://www.w3.org/1999/xlink").attr("x","0px").attr("y","0px").attr("style","enable-background:new 0 0 "+n+" "+r).attr("xml:space","preserve"),this.redBall=t.append("div").attr("class","vzb-export-redball").style("position","absolute").style("top","20px").style("right","20px").style("width","20px").style("height","20px").style("background","red").style("color","white").style("text-align","center").style("border-radius","10px").style("font-size","14px").style("line-height","20px").style("opacity",.8).style("cursor","pointer").on("mouseover",function(){d3.select(this).style("opacity",1).text(""),i.counterEl.text("Download")}).on("mouseout",function(){d3.select(this).style("opacity",.8).text(""),i.counterEl.text(i.label)}).on("click",function(){i.close()}),this.counterEl=t.append("div").attr("class","vzb-export-counter").style("position","absolute").style("top","20px").style("right","45px").style("color","red").style("opacity",.8).style("line-height","20px").style("font-size","14px").style("text-align","center"),this.root=this.svg.select("."+o+"graph"),this.root.selectAll("g, text, svg, line, rect").filter(function(){var t=d3.select(this),e=!1;return s.forEach(function(i){
e=e||t.classed(i)}),e}).remove(),this.svg.selectAll(".tick line").attr("fill","none").attr("stroke","#999"),this.svg.selectAll("."+o+"axis-x path").attr("fill","none").attr("stroke","#999"),this.svg.selectAll("."+o+"axis-y path").attr("fill","none").attr("stroke","#999")},write:function(t){var e="time";if(this.root||this.open(),!(this.shapes.indexOf(t.id+"_"+t.time)>-1)){this.shapes.push(t.id+"_"+t.time),this.groups.indexOf(t[e])==-1&&(this.root.append("g").attr("id","g_"+t[e]),this.groups.push(t[e])),null==t.opacity&&(t.opacity=.5),null==t.fill&&(t.fill="#ff80dd");var i=this.root.select("#g_"+t[e]).append(t.type).attr("id",t.id+"_"+t.time).style("fill",t.fill).style("opacity",t.opacity);switch(t.type){case"path":i.attr("d",t.d);break;case"circle":i.attr("cx",t.cx).attr("cy",t.cy).attr("r",t.r)}this.counter++,this.redBall.style("opacity",this.counter%10/12+.2),this.label=t.type+" shapes: "+this.counter,this.counterEl.text(this.label)}},close:function(){var t=l+" "+this.container.node().innerHTML.replace("param1","xmlns").replace("param2","xmlns:xlink").replace(/\d+(\.\d+)/g,function(t){return Math.round(100*+t)/100+""});if(t.length/1024/1024>2)alert("The file size is "+Math.round(t.length/1024)+"kB, which is too large to download. Will try to print it in the console instead..."),console.log(t);else{var e=document.createElement("a");e.download=this.name+" "+this.counter+" shapes.svg",e.href="data:,"+t,e.click()}}})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){function t(t,e){function i(e){var i,n=t.arcs[e<0?~e:e],r=n[0];return t.transform?(i=[0,0],n.forEach(function(t){i[0]+=t[0],i[1]+=t[1]})):i=n[n.length-1],e<0?[i,r]:[r,i]}function n(t,e){for(var i in t){var n=t[i];delete e[n.start],delete n.start,delete n.end,n.forEach(function(t){r[t<0?~t:t]=1}),s.push(n)}}var r={},a={},o={},s=[],l=-1;return e.forEach(function(i,n){var r,a=t.arcs[i<0?~i:i];a.length<3&&!a[1][0]&&!a[1][1]&&(r=e[++l],e[l]=i,e[n]=r)}),e.forEach(function(t){var e,n,r=i(t),s=r[0],l=r[1];if(e=o[s])if(delete o[e.end],e.push(t),e.end=l,n=a[l]){delete a[n.start];var c=n===e?e:e.concat(n);a[c.start=e.start]=o[c.end=n.end]=c}else a[e.start]=o[e.end]=e;else if(e=a[l])if(delete a[e.start],e.unshift(t),e.start=s,n=o[s]){delete o[n.end];var u=n===e?e:n.concat(e);a[u.start=n.start]=o[u.end=e.end]=u}else a[e.start]=o[e.end]=e;else e=[t],a[e.start=s]=o[e.end=l]=e}),n(o,a),n(a,o),e.forEach(function(t){r[t<0?~t:t]||s.push([t])}),s}function e(e,i,n){function r(t){var e=t<0?~t:t;(u[e]||(u[e]=[])).push({i:t,g:c})}function a(t){t.forEach(r)}function o(t){t.forEach(a)}function s(t){"GeometryCollection"===t.type?t.geometries.forEach(s):t.type in h&&(c=t,h[t.type](t.arcs))}var l=[];if(arguments.length>1){var c,u=[],h={LineString:a,MultiLineString:o,Polygon:o,MultiPolygon:function(t){t.forEach(o)}};s(i),u.forEach(arguments.length<3?function(t){l.push(t[0].i)}:function(t){n(t[0].g,t[t.length-1].g)&&l.push(t[0].i)})}else for(var d=0,f=e.arcs.length;d<f;++d)l.push(d);return{type:"MultiLineString",arcs:t(e,l)}}function i(e,i){function r(t){t.forEach(function(e){e.forEach(function(e){(s[e=e<0?~e:e]||(s[e]=[])).push(t)})}),l.push(t)}function a(t){return h(o(e,{type:"Polygon",arcs:[t]}).coordinates[0])>0}var s={},l=[],c=[];return i.forEach(function(t){"Polygon"===t.type?r(t.arcs):"MultiPolygon"===t.type&&t.arcs.forEach(r)}),l.forEach(function(t){if(!t._){var e=[],i=[t];for(t._=1,c.push(e);t=i.pop();)e.push(t),t.forEach(function(t){t.forEach(function(t){s[t<0?~t:t].forEach(function(t){t._||(t._=1,i.push(t))})})})}}),l.forEach(function(t){delete t._}),{type:"MultiPolygon",arcs:c.map(function(i){var r=[];if(i.forEach(function(t){t.forEach(function(t){t.forEach(function(t){s[t<0?~t:t].length<2&&r.push(t)})})}),r=t(e,r),(n=r.length)>1)for(var o,l=a(i[0][0]),c=0;c<n;++c)if(l===a(r[c])){o=r[0],r[0]=r[c],r[c]=o;break}return r})}}function r(t,e){return"GeometryCollection"===e.type?{type:"FeatureCollection",features:e.geometries.map(function(e){return a(t,e)})}:a(t,e)}function a(t,e){var i={type:"Feature",id:e.id,properties:e.properties||{},geometry:o(t,e)};return null==e.id&&delete i.id,i}function o(t,e){function i(t,e){e.length&&e.pop();for(var i,n=u[t<0?~t:t],r=0,a=n.length;r<a;++r)e.push(i=n[r].slice()),c(i,r);t<0&&s(e,a)}function n(t){return t=t.slice(),c(t,0),t}function r(t){for(var e=[],n=0,r=t.length;n<r;++n)i(t[n],e);return e.length<2&&e.push(e[0].slice()),e}function a(t){for(var e=r(t);e.length<4;)e.push(e[0].slice());return e}function o(t){return t.map(a)}function l(t){var e=t.type;return"GeometryCollection"===e?{type:e,geometries:t.geometries.map(l)}:e in h?{type:e,coordinates:h[e](t)}:null}var c=m(t.transform),u=t.arcs,h={Point:function(t){return n(t.coordinates)},MultiPoint:function(t){return t.coordinates.map(n)},LineString:function(t){return r(t.arcs)},MultiLineString:function(t){return t.arcs.map(r)},Polygon:function(t){return o(t.arcs)},MultiPolygon:function(t){return t.arcs.map(o)}};return l(e)}function s(t,e){for(var i,n=t.length,r=n-e;r<--n;)i=t[r],t[r++]=t[n],t[n]=i}function l(t,e){for(var i=0,n=t.length;i<n;){var r=i+n>>>1;t[r]<e?i=r+1:n=r}return i}function c(t){function e(t,e){t.forEach(function(t){t<0&&(t=~t);var i=r[t];i?i.push(e):r[t]=[e]})}function i(t,i){t.forEach(function(t){e(t,i)})}function n(t,e){"GeometryCollection"===t.type?t.geometries.forEach(function(t){n(t,e)}):t.type in o&&o[t.type](t.arcs,e)}var r={},a=t.map(function(){return[]}),o={LineString:e,MultiLineString:i,Polygon:i,MultiPolygon:function(t,e){t.forEach(function(t){i(t,e)})}};t.forEach(n);for(var s in r)for(var c=r[s],u=c.length,h=0;h<u;++h)for(var d=h+1;d<u;++d){var f,p=c[h],m=c[d];(f=a[p])[s=l(f,m)]!==m&&f.splice(s,0,m),(f=a[m])[s=l(f,p)]!==p&&f.splice(s,0,p)}return a}function u(t,e){function i(t){a.remove(t),t[1][2]=e(t),a.push(t)}var n=m(t.transform),r=g(t.transform),a=p();return e||(e=d),t.arcs.forEach(function(t){for(var o,s,l=[],c=0,u=0,h=t.length;u<h;++u)s=t[u],n(t[u]=[s[0],s[1],1/0],u);for(var u=1,h=t.length-1;u<h;++u)o=t.slice(u-1,u+2),o[1][2]=e(o),l.push(o),a.push(o);for(var u=0,h=l.length;u<h;++u)o=l[u],o.previous=l[u-1],o.next=l[u+1];for(;o=a.pop();){var d=o.previous,f=o.next;o[1][2]<c?o[1][2]=c:c=o[1][2],d&&(d.next=f,d[2]=o[2],i(d)),f&&(f.previous=d,f[0]=o[0],i(f))}t.forEach(r)}),t}function h(t){for(var e,i=-1,n=t.length,r=t[n-1],a=0;++i<n;)e=r,r=t[i],a+=e[0]*r[1]-e[1]*r[0];return.5*a}function d(t){var e=t[0],i=t[1],n=t[2];return Math.abs((e[0]-n[0])*(i[1]-e[1])-(e[0]-i[0])*(n[1]-e[1]))}function f(t,e){return t[1][2]-e[1][2]}function p(){function t(t,e){for(;e>0;){var i=(e+1>>1)-1,r=n[i];if(f(t,r)>=0)break;n[r._=e]=r,n[t._=e=i]=t}}function e(t,e){for(;;){var i=e+1<<1,a=i-1,o=e,s=n[o];if(a<r&&f(n[a],s)<0&&(s=n[o=a]),i<r&&f(n[i],s)<0&&(s=n[o=i]),o===e)break;n[s._=e]=s,n[t._=e=o]=t}}var i={},n=[],r=0;return i.push=function(e){return t(n[e._=r]=e,r++),r},i.pop=function(){if(!(r<=0)){var t,i=n[0];return--r>0&&(t=n[r],e(n[t._=0]=t,0)),i}},i.remove=function(i){var a,o=i._;if(n[o]===i)return o!==--r&&(a=n[r],(f(a,i)<0?t:e)(n[a._=o]=a,o)),o},i}function m(t){if(!t)return v;var e,i,n=t.scale[0],r=t.scale[1],a=t.translate[0],o=t.translate[1];return function(t,s){s||(e=i=0),t[0]=(e+=t[0])*n+a,t[1]=(i+=t[1])*r+o}}function g(t){if(!t)return v;var e,i,n=t.scale[0],r=t.scale[1],a=t.translate[0],o=t.translate[1];return function(t,s){s||(e=i=0);var l=(t[0]-a)/n|0,c=(t[1]-o)/r|0;t[0]=l-e,t[1]=c-i,e=l,i=c}}function v(){}var y={version:"1.6.19",mesh:function(t){return o(t,e.apply(this,arguments))},meshArcs:e,merge:function(t){return o(t,i.apply(this,arguments))},mergeArcs:i,feature:r,neighbors:c,presimplify:u};return y}()},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var a=i(1),o=r(a),s=i(42),l=n(s),c={_continuous:{_default:"#ffb600",0:"#B4DE79",50:"#E1CE00",100:"#F77481"},_discrete:{_default:"#ffb600",0:"#4cd843",1:"#e83739",2:"#ff7f00",3:"#c027d4",4:"#d66425",5:"#0ab8d8",6:"#bcfa83",7:"#ff8684",8:"#ffb04b",9:"#f599f5",10:"#f4f459",11:"#7fb5ed"},_default:{_default:"#93daec"}},u=l.default.extend({getClassDefaults:function(){var t={use:null,which:null,scaleType:null,syncModels:[],palette:{},paletteLabels:null,allow:{scales:["linear","log","genericLog","time","pow","ordinal"]}};return o.deepExtend(this._super(),t)},autoGenerateModel:function(){if(null==this.which){var t=void 0;this.autogenerate&&(t=this.dataSource.getConceptByIndex(this.autogenerate.conceptIndex,this.autogenerate.conceptType),t&&(this.which=t.concept,this.use="indicator",this.scaleType="linear")),t||(this.which="_default",this.use="constant",this.scaleType="ordinal")}null==this.scaleType&&(this.scaleType=this.dataSource.getConceptprops(this.which).scales[0])},init:function(t,e,i,n){var r=this;this._type="color",this._super(t,e,i,n),this._syncModelReferences={},this._hasDefaultColor=!1,this.on("hook_change",function(){r._readyOnce||r.palette&&0!==Object.keys(r.palette._data).length&&!function(){var t=r.getDefaultPalette(),e=r.getPalette(!0),i={};Object.keys(t).forEach(function(n){e[n]&&t[n]!=e[n]||(i[n]=t[n])}),r.set("palette",i,!1,!1)}()})},setInterModelListeners:function(){this._super(),this._setSyncModels()},getColorShade:function(t){var e=this.getPalette();if(!t)return o.warn("getColorShade() is missing arguments");if(t.colorID&&e[t.colorID]||(t.colorID="_default"),!o.isArray(e[t.colorID]))return e[t.colorID];var i=this.getConceptprops().color,n=t.shadeID&&i&&i.shades&&i.shades[t.shadeID]?i.shades[t.shadeID]:0;return e[t.colorID][n]},isUserSelectable:function(){var t=this.getConceptprops().color;return null==t||null==t.selectable||t.selectable},setWhich:function(t){this._super(t),this.palette&&(this.palette._data={}),this._setSyncModels()},_setSyncModels:function(){var t=this;this.syncModels.forEach(function(e){var i=t.getClosestModel(e),n=i.isHook()?i._parent:i,r=n.getClosestModel(n.space[0]);t._syncModelReferences[e]={model:i,marker:n,entities:r},t.isDiscrete()&&t._setSyncModel(i,n,r)})},_setSyncModel:function(t,e,i){if(t==e){var n={dim:this.which,show:{}};e.setDataSourceForAllSubhooks(this.data),i.set(n,!1,!1)}else t.isDiscrete()&&"constant"!==t.use&&t.set({which:this.which,data:this.data},!1,!1)},getColorlegendMarker:function(){return(this._syncModelReferences.marker_colorlegend||{}).marker},getColorlegendEntities:function(){return(this._syncModelReferences.marker_colorlegend||{}).entities},setColor:function(t,e){var i=this.getPalette();i[e]=t,this.scale.range(o.values(i)),this.palette[e]=t},mapValue:function(t){return null!=this.scale&&this.isDiscrete()&&this._hasDefaultColor&&this.scale.domain().indexOf(t)==-1&&(t="_default"),this._super(t)},getDefaultPalette:function(){var t=this.getConceptprops().color,e=void 0;return this.discreteDefaultPalette=!1,t&&t.palette?e=o.clone(t.palette):c[this.which]?e=o.clone(c[this.which]):"constant"===this.use?e=/^#([0-9a-f]{3}|[0-9a-f]{6})$/.test(this.which)?{_default:this.which}:o.clone(c._default):(e=o.clone(c[this.isDiscrete()?"_discrete":"_continuous"]),this.discreteDefaultPalette=!0),e},_getPaletteLabels:function(){var t=this.getConceptprops().color,e=null;return t&&t.paletteLabels&&(e=o.clone(t.paletteLabels)),e},getPaletteLabels:function(){return this.paletteLabels.getPlainObject()},getPalette:function(t){if(!this.palette||0===Object.keys(this.palette._data).length){var e=this.getDefaultPalette();this.set("palette",e,!1,!1);var i=this._getPaletteLabels();this.set("paletteLabels",i,!1,!1)}var n=this.palette.getPlainObject();return"indicator"!==this.use||t||delete n._default,n},buildScale:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.scaleType,i=this,n=i.getPalette(),r=Object.keys(n),a=o.values(n);this._hasDefaultColor=r.indexOf("_default")>-1,"time"==e?!function(){var e=t._space.time,i=e.splash?{min:e.parse(e.startOrigin),max:e.parse(e.endOrigin)}:{min:e.start,max:e.end},o=i.max-i.min==0;r=r.sort(function(t,e){return t-e}),a=r.map(function(t){return o?n[r[0]]:n[t]}),r=r.map(function(t){return i.min.valueOf()+t/100*(i.max.valueOf()-i.min.valueOf())}),t.scale=d3.time.scale.utc().domain(r).range(a).interpolate(d3.interpolateRgb)}():this.isDiscrete()?(a=a.map(function(t){return o.isArray(t)?t[0]:t}),e="ordinal",this.discreteDefaultPalette&&(r=r.concat(this.getUnique(this.which))),this.scale=d3.scale[e]().domain(r).range(a)):!function(){var i=t.getLimits(t.which);i=[i.min,i.max],i=t.getConceptprops().domain?t.getConceptprops().domain:i;var o=i[1]-i[0]==0;r=r.sort(function(t,e){return t-e}),a=r.map(function(t){return o?n[r[0]]:n[t]}),r=r.map(function(t){return i[0]+t/100*(i[1]-i[0])}),d3.min(r)<=0&&d3.max(r)>=0&&"log"===e&&(e="genericLog"),"log"!=e&&"genericLog"!=e||!function(){var t=d3.scale.genericLog().domain(i).range(i);r=r.map(function(e){return t.invert(e)})}(),t.scale=d3.scale[e]().domain(r).range(a).interpolate(d3.interpolateRgb)}(),this.scaleType=e}});e.default=u},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o=i(1),s=r(o),l=i(47),c=n(l),u=i(72),h=n(u),d=i(46),f=n(d),p=c.default.extend({getClassDefaults:function(){var t={reader:"csv"};return s.deepExtend(this._super(),t)},trackInstances:!0,init:function(t,e,i,n){this._type="data",this.queryQueue={},this._collection={},this._collectionPromises={},this._super(t,e,i,n),this.readerObject=this.getReader()},preloadData:function(){return this.loadConceptProps()},load:function(t){var e=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.dataset&&(t.dataset=this.dataset),this.version&&(t.version=this.version);var n=this.getDataId(t);return n?Promise.resolve(n):(s.timeStamp("Vizabi Data: Loading Data"),f.default.freezeAll(["hook_change","resize"]),this.loadFromReader(t,i).then(function(t){return f.default.unfreezeAll(),t}).catch(function(i){return e.handleReaderError(i,t)}))},loadFromReader:function(t,e){var i=this,n=s.hashCode([t]),r=s.hashCode([t.select.key,t.where,t.join]);if(this.queryQueue[r])return Array.prototype.push.apply(this.queryQueue[r].query.select.value,t.select.value),s.extend(this.queryQueue[r].parsers,e),this.queryQueue[r].promise;var a=new Promise(function(a,o){s.defer(function(){t.select.value=s.unique(t.select.value),i.readerObject.read(t,e).then(function(e){i.checkQueryResponse(t,e),i._collection[n]={},i._collectionPromises[n]={};var o=i._collection[n];o.data=e,o.valid={},o.nested={},o.unique={},o.limits={},o.frames={},o.haveNoDataPointsPerKey={},o.query=t,i.queryQueue[r]=null,a(n)}).catch(function(t){i.queryQueue[r]=null,o(t)})})});return this.queryQueue[r]={query:t,parsers:e,promise:a},this.queryQueue[r].promise},getReader:function(){var t=h.default.get(this.reader);if(!t)throw new Error("Unknown reader: "+this.reader);return new t({path:this.path,delimiter:this.delimiter,keySize:this.keySize,data:this.data})},checkQueryResponse:function(t,e){if(0==e.length&&s.warn("Reader for data source '"+this._name+"' returned empty array for query:",JSON.stringify(t,null,2)),e.length>0){for(var i=(t.select.key||[]).concat(t.select.value||[]),n=e.length-1;n>=0;n--){for(var r=i.length-1;r>=0;r--)(e[n][i[r]]||0===e[n][i[r]])&&i.splice(r,1);if(!i.length)break}i.forEach(function(i){t.select.key.indexOf(i)==-1?s.warn('Reader result: Column "'+i+'" is missing from "'+t.from+'" data, but it might be ok'):(s.error('Reader result: Key column "'+i+'" is missing from "'+t.from+'" data for query:',JSON.stringify(t)),console.log(e))})}},getData:function(t,e,i,n){if(!t)return s.warn("Data.js 'get' method doesn't like the dataId you gave it: "+t);if(!e||"data"==e)return this._collection[t].data;if(!i)return this._collection[t][e];var r="string"==typeof i?i:JSON.stringify(i);if(this._collection[t][e][r])return this._collection[t][e][r];switch(e){case"unique":this._collection[t][e][r]=this._getUnique(t,i);break;case"valid":this._collection[t][e][r]=this._getValid(t,i);break;case"limits":this._collection[t][e][r]=this._getLimits(t,i);break;case"nested":this._collection[t][e][r]=this._getNested(t,i);break;case"haveNoDataPointsPerKey":}return this._collection[t][e][r]},loadConceptProps:function(){var t=this,e={select:{key:["concept"],value:["concept_type","domain","indicator_url","color","scales","interpolation","tags","name","unit","description","format"]},from:"concepts",where:{},language:this.getClosestModel("locale").id};return this.load(e).then(this.handleConceptPropsResponse.bind(this)).catch(function(i){return t.handleReaderError(i,e)})},handleConceptPropsResponse:function(t){var e=this;this.conceptDictionary={_default:{concept_type:"string",use:"constant",scales:["ordinal"],tags:"_root"}},this.conceptArray=[],this.getData(t).forEach(function(t){var i={};t.concept_type&&(i.use="measure"==t.concept_type||"time"==t.concept_type?"indicator":"property"),i.concept_type=t.concept_type,i.sourceLink=t.indicator_url;try{i.color=t.color&&""!==t.color?JSON.parse(t.color):null}catch(t){i.color=null}try{i.scales=t.scales?JSON.parse(t.scales):null}catch(t){i.scales=null}if(!i.scales)switch(t.concept_type){case"measure":i.scales=["linear","log"];break;case"string":i.scales=["nominal"];break;case"entity_domain":i.scales=["ordinal"];break;case"entity_set":i.scales=["ordinal"];break;case"time":i.scales=["time"]}null==i.scales&&(i.scales=["linear","log"]),t.interpolation?i.interpolation=t.interpolation:"measure"==t.concept_type?i.interpolation=i.scales&&"log"==i.scales[0]?"exp":"linear":"time"==t.concept_type?i.interpolation="linear":i.interpolation="stepMiddle",i.concept=t.concept,i.domain=t.domain,i.tags=t.tags,i.format=t.format,i.name=t.name||t.concept||"",i.unit=t.unit||"",i.description=t.description,e.conceptDictionary[t.concept]=i,e.conceptArray.push(i)})},getConceptprops:function(t){return t?this.conceptDictionary[t]||s.warn("The concept "+t+" is not found in the dictionary"):this.conceptDictionary},getConceptByIndex:function(t,e){return this.conceptArray.filter(function(t){return!e||!t.concept_type||t.concept_type===e})[t]},getDatasetName:function(){if(this.readerObject.getDatasetInfo){var t=this.readerObject.getDatasetInfo();return t.name+(t.version?" "+t.version:"")}return this._name},_getCacheKey:function(t,e){var i=t[0]+" - "+t[t.length-1];return e&&(i=i+"_"+e.join()),i},getFrames:function(t,e,i){var n=this,r=this._getCacheKey(e,i);return this._collectionPromises[t][r]||(this._collectionPromises[t][r]={queue:this.framesQueue(e,r),promise:null}),this._collectionPromises[t][r]&&this._collectionPromises[t][r].promise instanceof Promise?this._collectionPromises[t][r].promise:(this._collectionPromises[t][r].promise=new Promise(function(a,o){t||o(s.warn("Data.js 'get' method doesn't like the dataId you gave it: "+t)),n._getFrames(t,r,e,i).then(function(e){n._collection[t].frames[r]=e,a(n._collection[t].frames[r])})}),this._collectionPromises[t][r].promise)},getFrame:function(t,e,i,n){var r=this,a=this._getCacheKey(e,n);return new Promise(function(e,n){r._collection[t].frames[a]&&r._collection[t].frames[a][i]?e(r._collection[t].frames[a]):r._collectionPromises[t][a].queue.forceFrame(i,function(){e(r._collection[t].frames[a])})})},listenFrame:function(t,e,i,n){var r=this._getCacheKey(e,i);this._collectionPromises[t][r].queue.defaultCallbacks.push(function(e){n(t,e)}),this._collection[t].frames[r]&&s.forEach(this._collection[t].frames[r],function(e,i){n(t,new Date(i))})},_muteAllQueues:function(t){s.forEach(this._collectionPromises,function(e,i){s.forEach(e,function(e,i){1==e.queue.isActive&&e.queue.whatId!=t&&e.queue.mute()})})},_checkForcedQueuesExists:function(){s.forEach(this._collectionPromises,function(t,e){s.forEach(t,function(t,e){t.queue.forcedQueue.length>0&&t.queue.unMute()})})},_unmuteQueue:function(){s.forEach(this._collectionPromises,function(t,e){s.forEach(t,function(t,e){0==t.queue.isActive&&t.queue.unMute()})})},framesQueue:function(t,e){var i=this;return new function(){this.defaultCallbacks=[],this.callbacks={},this.forcedQueue=[],this.isActive=!0,this.delayedAction=null,this.whatId=e,this.queue=t.slice(0);var n=this;this.queue.splice(0,0,this.queue.splice(this.queue.length-1,1)[0]),this.key=0,this.mute=function(){this.isActive=!1,this.delayedAction=Promise.resolve.bind(Promise)},this.unMute=function(){this.isActive=!0,"function"==typeof this.delayedAction&&this.delayedAction(),this.delayedAction=null,0==this.forcedQueue.length&&0==this.queue.length&&i._unmuteQueue()},this.frameComplete=function(t){var e=void 0;if(n.defaultCallbacks.length>0)for(e=0;e<n.defaultCallbacks.length;e++)n.defaultCallbacks[e](t);if(n.callbacks[t]&&n.callbacks[t].length>0)for(e=0;e<n.callbacks[t].length;e++)n.callbacks[t][e]()},this._waitingForActivation=function(){var t=this;return new Promise(function(e,i){return t.isActive?e():void(t.delayedAction=e)})},this._getNextFrameName=function(){var t=null;return this.forcedQueue.length>0||this.queue.length>0?this.forcedQueue.length>0?t=this.forcedQueue.shift():(0==this.forcedQueue.length&&this.key>=this.queue.length-1&&(this.key=0),t=this.queue.splice(this.key,1).pop()):i._unmuteQueue(),t},this.checkForcedFrames=function(){this.forcedQueue.length>0||i._checkForcedQueuesExists()},this.getNext=function(){var t=this;return new Promise(function(e,i){t.checkForcedFrames(),t.isActive?e(t._getNextFrameName()):t._waitingForActivation().then(function(){e(t._getNextFrameName())})})},this.forceFrame=function(t,e){var n=function(t,e){for(var i=e.toString(),n=-1,r=0,a=t.length;r<a;r++)if(t[r].toString()==i){n=r;break}return n};if(this.callbacks[t])this.callbacks[t].push(e);else{var r=n(this.queue,t);r!==-1?(this.forcedQueue.unshift(this.queue.splice(r,1).pop()),i._muteAllQueues(this.whatId),this.unMute(),"function"==typeof e&&("object"!=a(this.callbacks[t])&&(this.callbacks[t]=[]),this.callbacks[t].push(e)),this.key=r):"object"===a(this.callbacks[t])?this.callbacks[t].push(e):this.callbacks[t]=[e]}}}},_getFrames:function(t,e,i,n){var r=this;return r._collection[t].frames[e]||(r._collection[t].frames[e]={}),new Promise(function(a,o){var l=r.getConceptprops();l||s.warn("_getFrames in data.js is missing indicatorsDB, it's needed for gap filling"),i||s.warn("_getFrames in data.js is missing framesArray, it's needed so much");var c=r._collection[t].query.animatable,u=r._collection[t].query.select.key.slice(0);c&&u.indexOf(c)!=-1&&u.splice(u.indexOf(c),1);var h={},d=void 0,f=void 0,p=void 0,m=void 0,g=void 0,v=void 0,y=void 0,b={};if(u.length>1)for(d=1;d<u.length;d++){var _=r.getData(t,"nested",[u[d]].concat([c]));b[u[d]]=Object.keys(_)}var x=r.getData(t,"nested",u.concat([c]));n=n?n:Object.keys(x),b[u[0]]=n;var w=r._collection[t].query,M=w.select.value.filter(function(t){return"_default"!==t}),z=M.length,S=void 0,E=void 0,k=u.length-1,T=function t(e,i){for(var n=b[u[i]],r=0,a=n.length;r<a;r++)if(e[n[r]]={},i==k)for(E=0;E<z;E++)e[n[r]][M[E]]=null;else{var o=i+1;t(e[n[r]],o)}};for(T(h,0),E=0;E<z;E++)r._collection[t].haveNoDataPointsPerKey[M[E]]={};var P=function t(i,n,o,u,d){var b={};if("datapoints"!==w.from){var _=r._collection[u].data;for(E=0;E<z;E++)b[M[E]]={};for(var T=0;T<_.length;T++){var P=_[T];for(E=0;E<z;E++)b[M[E]][P[o[0]]]=P[M[E]],null==P[M[E]]&&(r._collection[u].haveNoDataPointsPerKey[M[E]][P[o[0]]]=_.length)}}else!function(){var t=function(t,e,n,a,o,h,d){if(g=l[t]?l[t].interpolation:null,v=l[t]?l[t].use:"indicator",a?b[t][e]=a[e]:o=b[t],h&&h[i]&&(h[i][0][t]||0===h[i][0][t]))o[n]=h[i][0][t];else if("none"===g)o[n]=null;else{if(f=d[t],null===f){var _=Object.keys(h);f=new Array(_.length),p=0;for(var x=0,w=_.length;x<w;x++)m=h[_[x]],(m[0][t]||0===m[0][t])&&(f[p++]=m[0]);f.length=p,0===p?d[t]=[]:d[t]=f,0==f.length&&(r._collection[u].haveNoDataPointsPerKey[t][S]=f.length)}f&&f.length>0&&(y=null,o[n]=s.interpolatePoint(f,v,t,y,c,i,g))}};for(E=0;E<z;E++)b[M[E]]={};var e=function e(i,r,a,s,l,c){for(var u=n[o[c]],h=0,d=u.length;h<d;h++)if(0==c&&(a=u[h]),c==k)for(E=0;E<z;E++)t(M[E],a,u[h],i,r,s[u[h]],l[u[h]]);else{0==c&&(r=i={});var f=c+1;r[u[h]]={},e(i,r[u[h]],a,s[u[h]],l[u[h]],f)}};e(null,null,null,x,h,0)}();r._collection[u].frames[e][i]=b,"function"==typeof d&&d(i),r._collectionPromises[u][e].queue.getNext().then(function(i){i?s.defer(function(){t(i,n,o,u,r._collectionPromises[u][e].queue.frameComplete)}):a(r._collection[u].frames[e])})};r._collectionPromises[t][e].queue.getNext().then(function(i){i&&P(i,b,u,t,r._collectionPromises[t][e].queue.frameComplete)})})},_getNested:function(t,e){for(var i=d3.nest(),n=0;n<e.length;n++)i=i.key(function(t){return function(e){return e[t]}}(e[n]));return s.nestArrayToObj(i.entries(this._collection[t].data))},_getUnique:function(t,e){var i=void 0,n=this._collection[t].data;if(s.isArray(e)){var r=n.map(function(t){return s.clone(t,e)});i=s.unique(r,function(t){return JSON.stringify(t)})}else{var a=n.map(function(t){return t[e]});i=s.unique(a)}return i},_getValid:function(t,e){return this._collection[t].data.filter(function(t){return t[e]||0===t[e]})},_getLimits:function(t,e){for(var i=this._collection[t].data,n=i.reduce(function(t,i){var n=s.isDate(i[e])?i[e]:parseFloat(i[e]);return isNaN(n)||t.push(n),t},[]),r=void 0,a=void 0,o={},l=0;l<n.length;l+=1){var c=n[l];("undefined"==typeof r||c<r)&&(r=c),("undefined"==typeof a||c>a)&&(a=c)}return o.min=r||0,o.max=a||100,o},getDataId:function(t){var e=s.hashCode([t]);return Object.keys(this._collection).indexOf(e)!==-1&&e},handleReaderError:function(t,e){if(s.isObject(t)){var i=this.getClosestModel("locale"),n=i.getTFunction()(t.code,t.payload)||"";t=(n+" "+(t.message||"")).trim()}throw s.warn("Problem with query: ",e),t}});e.default=p},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function a(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}Object.defineProperty(e,"__esModule",{value:!0});var o=i(1),s=r(o),l=i(61),c=n(l),u=c.default.extend({getClassDefaults:function(){var t={show:{},dim:null,skipFilter:!1};return s.deepExtend(this._super(),t)},objectLeafs:["show","autogenerate"],dataConnectedChildren:["show","dim"],init:function(t,e,i,n){this._type="entities",this._super(t,e,i,n)},afterPreload:function(){if(null==this.dim&&this.autogenerate){var t=this.getClosestModel(this.autogenerate.data);this.dim=t.getConceptByIndex(this.autogenerate.conceptIndex).concept}},getDimension:function(){return this.dim},getFilter:function(){return this.skipFilter?[]:this.show},showEntity:function(t){var e=this,i=s.deepClone(this.show),n=this.getDimension(),r=void 0;r=s.isArray(t)?t:[t];var a=[];this.show[n]&&this.show[n].$in&&s.isArray(this.show[n].$in)&&(a=this.show[n].$in),s.forEach(r,function(t){var i=t[n];a=e.isShown(t)?a.filter(function(t){return t!==i}):a.concat(i)}),0===a.length?delete i[n]:i[n]={$in:a},this.show=i},isShown:function(t){var e=this.getDimension();return this.show[e]&&this.show[e].$in&&this.show[e].$in.indexOf(t[e])!==-1},clearShow:function(){var t=this.getDimension(),e=s.deepClone(this.show);delete e[t],this.show=e},getFilteredEntities:function(){var t=this.getDimension(),e=this.show[t]||{},i=e.$in,n=void 0===i?[]:i;return n.map(function(e){return a({},t,e)})}});e.default=u},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var a=i(1),o=r(a),s=i(42),l=n(s),c=l.default.extend({getClassDefaults:function(){var t={use:null,which:null,merge:!1,manualSorting:null};return o.deepExtend(this._super(),t)},init:function(t,e,i,n){this._type="model",this._super(t,e,i,n)},validate:function(){this.scale&&(this.scale=null),"property"!=this.use&&(o.warn("group model: use must be 'property'. Resetting..."),this.use="property")}});e.default=c},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var a=i(1),o=r(a),s=i(42),l=n(s),c=l.default.extend({getClassDefaults:function(){var t={use:null,which:null};return o.deepExtend(this._super(),t)},init:function(t,e,i,n){this._type="label",this._super(t,e,i,n)}});e.default=c},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var a=i(1),o=r(a),s=i(61),l=n(s),c=["ar","ar-SA"],u=l.default.extend({getClassDefaults:function(){var t={id:"en",filePath:"assets/translation/"};return o.deepExtend(this._super(),t)},dataConnectedChildren:["id"],strings:{},init:function(t,e,i,n){this._type="locale",this._super(t,e,i,n)},_isLoading:function(){return!this._loadedOnce||this._loadCall},preloadData:function(){return this.loadData()},loadData:function(){var t=this;this.setReady(!1),this._loadCall=!0;var e=[];return o.forEach(this._root._data,function(t){"data"===t._type&&e.push(t.loadConceptProps())}),e.push(new Promise(function(e,i){d3.json(t.filePath+t.id+".json",function(n,r){n&&i(n),t.handleNewStrings(r),e()})})),Promise.all(e).then(function(){return t.trigger("translate")})},handleNewStrings:function(t){this.strings[this.id]=this.strings[this.id]?o.extend(this.strings[this.id],t):t},getUIString:function(t){return this.strings&&this.strings[this.id]&&(this.strings[this.id][t]||""===this.strings[this.id][t])?this.strings[this.id][t]:(this.strings&&this.strings[this.id]||o.warn("Strings are not loaded for the "+this.id+" locale. Check if translation JSON is valid"),t)},getTFunction:function(){var t=this;return function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object.keys(i).reduce(function(t,e){var n=new RegExp("{{"+e+"}}","g");return t.replace(n,i[e])},t.getUIString(e))}},isRTL:function(){return c.indexOf(this.id)!==-1}});e.default=u},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var a=i(1),o=r(a),s=i(47),l=n(s),c=l.default.extend({getClassDefaults:function(){var t={select:[],highlight:[],opacityHighlightDim:.1,opacitySelectDim:.3,opacityRegular:1,allowSelectMultiple:!0};return o.deepExtend(this._super(),t)},init:function(t,e,i,n,r){var a=this;this._visible=[],this._super(t,e,i,n,r),this.on("ready",this.checkTimeLimits.bind(this)),this.on("readyOnce",function(){var t={exceptType:"time"},e=a._getAllDimensions(t);a._multiDim=e.length>1})},setDataSourceForAllSubhooks:function(t){var e={};this.getSubhooks().forEach(function(i){e[i._name]={data:t}}),this.set(e,null,!1)},validate:function(){var t=this.getDimension(),e=this._visible.map(function(e){return e[t]});e.length&&(this.select=this.select.filter(function(i){return e.indexOf(i[t])!==-1}),this.setHighlight(this.highlight.filter(function(i){return e.indexOf(i[t])!==-1})))},setVisible:function(t){this._visible=t},getVisible:function(t){return this._visible},getSelected:function(t){return t?this.select.map(function(e){
return e[t]}):this.select},selectMarker:function(t){var e=this,i=this._createValue(t);this.isSelected(t)?this.select=this.select.filter(function(t){return JSON.stringify(e._createValue(t))!==JSON.stringify(i)}):this.select=this.allowSelectMultiple?this.select.concat(i):[i]},selectAll:function(t,e){if(this.allowSelectMultiple){var i=void 0,n=this._getFirstDimension({exceptType:"time"});this.select=this._visible.map(function(t){return i={},i[n]=t[n],i})}},isSelected:function(t){var e=this,i=this._createValue(t);return this.select.map(function(t){return JSON.stringify(e._createValue(t))===JSON.stringify(i)}).indexOf(!0)!==-1},_createValue:function(t){var e=this._getAllDimensions({exceptType:"time"});return e.reduce(function(e,i){return e[i]=t[i],e},{})},getHighlighted:function(t){return t?this.highlight.map(function(e){return e[t]}):this.highlight},setHighlight:function(t){return o.isArray(t)?void this.getModelObject("highlight").set(t,!1,!1):void this.setHighlight([].concat(t))},setSelect:function(t){return o.isArray(t)?void this.getModelObject("select").set(t):void this.setSelect([].concat(t))},highlightMarker:function(t){var e=this._createValue(t);this.isHighlighted(t)||this.setHighlight(this.highlight.concat(e))},unhighlightEntity:function(t){var e=this._createValue(t);this.isHighlighted(t)&&this.setHighlight(this.highlight.filter(function(t){return t[dimension]!==e}))},isHighlighted:function(t){var e=this,i=this._createValue(t);return this.highlight.map(function(t){return JSON.stringify(e._createValue(t))===JSON.stringify(i)}).indexOf(!0)!==-1},clearHighlighted:function(){this.setHighlight([])},clearSelected:function(){this.select=[]},setLabelOffset:function(t,e){0===e[0]&&1===e[1]||(this.select.find(function(e){return o.comparePlainObjects(e,t)}).labelOffset=[Math.round(1e3*e[0])/1e3,Math.round(1e3*e[1])/1e3],this.set("select",this.select,!0))},checkTimeLimits:function(){var t=this._parent.time;if(t){var e=this.getTimeLimits();if(e){if(!o.isDate(e.min)||!o.isDate(e.max))return o.warn("checkTimeLimits(): min-max look wrong: "+e.min+" "+e.max+". Expecting Date objects. Ensure that time is properly parsed in the data from reader");var i={};t.start-e.min==0&&(t.start||this.startOrigin)||(i.start=d3.max([e.min,t.parse(t.startOrigin)])),t.end-e.max==0&&(t.end||this.endOrigin)||(i.end=d3.min([e.max,t.parse(t.endOrigin)])),t.set(i,!1,!1),(i.start||i.end)&&o.forEach(this.getSubhooks(),function(t){"time"==t.which&&t.buildScale()}),t.validate()}}},getTimeLimits:function(){var t=this,e=this._parent.time,i=[],n=[],r=void 0,a=void 0,s={};this.cachedTimeLimits||(this.cachedTimeLimits={}),o.forEach(this.getSubhooks(),function(l){if("indicator"===l.use&&l._important){var c=t.cachedTimeLimits[l._dataId+l.which];c?(r=c.min,a=c.max):(s=l.getValidItems().map(function(t){return t[e.getDimension()]}),0==s.length&&o.warn("getTimeLimits() was unable to work with an empty array of valid datapoints"),r=d3.min(s),a=d3.max(s)),t.cachedTimeLimits[l._dataId+l.which]={min:r,max:a},i.push(r),n.push(a)}});var l=d3.max(i),c=d3.min(n);return l>c&&(o.warn("getTimeLimits(): Availability of the indicator's data has no intersection. I give up and just return some valid time range where you'll find no data points. Enjoy!"),l=d3.min(i),c=d3.max(n)),!(!r&&!a)&&{min:l,max:c}},getKeys:function(t){var e=[];t=t||this._getFirstDimension();var i=this._getFirstDimension({type:"time"});return o.forEach(this._dataCube||this.getSubhooks(!0),function(n,r){if("constant"!==n.use){var a=n.getNestedItems([t,i]),o=n.getHaveNoDataPointsPerKey();a.undefined&&delete a.undefined;var s=Object.keys(a),l=Object.keys(o||[]);0==e.length&&(e=s),n._important&&(e=e.filter(function(t){return s.indexOf(t)>-1&&l.indexOf(t)==-1}))}}),e.map(function(e){var i={};return i[t]=e,i})},_getCachePath:function(t){var e=this._parent.time.getAllSteps(),i=this.getClosestModel("locale").id+" - "+e[0]+" - "+e[e.length-1];this._dataCube=this._dataCube||this.getSubhooks(!0);var n=!1;return o.forEach(this._dataCube,function(t,e){t._loadCall&&(n=!0),i=i+"_"+t._dataId+t.which}),n?null:(t&&(i=i+"_"+t.join(",")),i)},_getAllDimensions:function(t){var e=[],i=this;o.forEach(this.space,function(t){e.push(i.getClosestModel(t))}),t=t||{};var n=[],r=void 0;return o.forEach(e,function(e){return!(!t.exceptType||e.getType()!==t.exceptType)||(!(!t.onlyType||e.getType()===t.onlyType)||void((r=e.getDimension())&&n.push(r)))}),n},_getFirstDimension:function(t){var e=[],i=this;o.forEach(this.space,function(t){e.push(i.getClosestModel(t))}),t=t||{};var n=!1;return o.forEach(e,function(e){return t.exceptType&&e.getType()!==t.exceptType?(n=e.getDimension(),!1):t.type&&e.getType()===t.type?(n=e.getDimension(),!1):t.exceptType||t.type?void 0:(n=e.getDimension(),!1)}),n},framesAreReady:function(){var t=this._getCachePath();return!!this.cachedFrames&&Object.keys(this.cachedFrames[t]).length==this._parent.time.getAllSteps().length},getFrame:function(t,e,i){var n=this;this.cachedFrames||(this.cachedFrames={});var r=this._parent.time.getAllSteps(),a=this._getCachePath();if(!a)return e(null,t);if(t&&n.cachedFrames[a]&&n.cachedFrames[a][t])return e(n.cachedFrames[a][t],t);if(a=this._getCachePath(i),!a)return e(null,t);if(t&&n.cachedFrames[a]&&n.cachedFrames[a][t])return e(n.cachedFrames[a][t],t);if(t&&r.length>1){var s=d3.bisectLeft(r,t);if(!r[s])return o.warn("The requested frame is out of range: "+t),e(null,t),null;if(r[s].toString()!=t.toString())return this._interpolateBetweenFrames(t,s,r,function(i){e(i,t)},i),null}n.getFrames(t,i).then(function(){return!t&&n.cachedFrames[a]?e(n.cachedFrames[a],t):n.cachedFrames[a]&&n.cachedFrames[a][t]?e(n.cachedFrames[a][t],t):(o.warn("marker.js getFrame: Data is not available for frame: "+t),e(null,t))})},_interpolateBetweenFrames:function(t,e,i,n,r){var a=this,s=this;0==e?this.getFrame(i[e],function(t){return n(t)},r):!function(){var l=i[e-1],c=i[e];a.getFrame(l,function(e){s.getFrame(c,function(i){function r(e,i,n,r,s,l,c){e[i]=r[i],o.isDate(l)?s[n]=t:o.isNumber(l)?s[n]=null==l||null==c?null:l+(c-l)*a:s[n]=l}var a=(t-l)/(c-l),u={};o.forEach(e,function(e,n){u[n]={},s._multiDim&&"indicator"==s[n].use?!function(){var t=u[n],a=s[n].dataSource._collection[s[n]._dataId].query.animatable,o=s[n].dataSource._collection[s[n]._dataId].query.select.key.slice(0);a&&o.indexOf(a)!=-1&&o.splice(o.indexOf(a),1);var l=o.length-1,c=function e(i,n,a,o,s,c){for(var u=Object.keys(o),h=0,d=u.length;h<d;h++)if(0==c&&(a=u[h]),c==l)r(t,a,u[h],i,n,o[u[h]],s[u[h]]);else{0==c&&(n=i={});var f=c+1;n[u[h]]={},e(i,n[u[h]],a,o[u[h]],s[u[h]],f)}};c(null,null,null,e,i[n],0)}():o.forEach(e,function(e,r){var s=i[n][r];o.isDate(e)?u[n][r]=t:o.isNumber(e)?u[n][r]=null==e||null==s?null:e+(s-e)*a:u[n][r]=e})}),n(u)},r)},r)}()},getFrames:function(t,e){var i=this;this.cachedFrames||(this.cachedFrames={});var n=this._getFirstDimension(),r=this._getFirstDimension({type:"time"});this.frameQueues||(this.frameQueues={}),this.partialResult||(this.partialResult={});var a=this._parent.time.getAllSteps(),s=this._getCachePath(e);return s?(this.frameQueues[s]&&this.frameQueues[s]instanceof Promise||(this.frameQueues[s]=new Promise(function(t,l){i.partialResult[s]={},a.forEach(function(t){i.partialResult[s][t]={}});var c=i.getKeys(),u=[];o.forEach(i._dataCube,function(t,e){"constant"===t.use?a.forEach(function(r){i.partialResult[s][r][e]={},c.forEach(function(a){i.partialResult[s][r][e][a[n]]=t.which})}):t.which===n?a.forEach(function(t){i.partialResult[s][t][e]={},c.forEach(function(r){i.partialResult[s][t][e][r[n]]=r[n]})}):t.which===r?a.forEach(function(t){i.partialResult[s][t][e]={},c.forEach(function(r){i.partialResult[s][t][e][r[n]]=new Date(t)})}):u.push(t)}),u.length>0?!function(){var n=[];o.forEach(u,function(t){n.push(new Promise(function(n,r){var l={name:t._name,which:t.which};t.getFrames(a,e).then(function(t){o.forEach(t,function(t,e){i.partialResult[s][e][l.name]=t[l.which]}),n()})}))}),Promise.all(n).then(function(){i.cachedFrames[s]=i.partialResult[s],t()})}():(i.cachedFrames[s]=i.partialResult[s],t())})),new Promise(function(l,c){a.length<2||!t?i.frameQueues[s].then(function(){l()}):!function(){var c=[];o.forEach(i._dataCube,function(o,l){"constant"!==o.use&&o.which!==n&&o.which!==r&&!function(n,r){c.push(new Promise(function(o,l){n.getFrame(a,t,e).then(function(e){i.partialResult[s][t][r]=e[t][n.which],o()})}))}(o,l)}),c.length>0&&Promise.all(c).then(function(){i.cachedFrames[s]||(i.cachedFrames[s]={}),i.cachedFrames[s][t]=i.partialResult[s][t],l()})}()})):new Promise(function(t,e){t()})},listenFramesQueue:function(t,e){var i=this,n=this._getFirstDimension(),r=this._getFirstDimension({type:"time"}),a=this._parent.time.getAllSteps(),s={};this.getFrames();var l=[];o.forEach(i._dataCube,function(i,o){"constant"!==i.use&&i.which!==n&&i.which!==r&&l.indexOf(i._dataId)==-1&&(l.push(i._dataId),i.dataSource.listenFrame(i._dataId,a,t,function(t,i){var n=i.toString();"undefined"==typeof s[n]&&(s[n]=[]),s[n].indexOf(t)==-1&&s[n].push(t),s[n].length==l.length&&e(i)}))})},getValues:function(t,e,i){if(this.isHook())return[];var n=void 0,r=void 0,a=void 0,s=void 0,l=void 0,c=void 0;this._dataCube=this._dataCube||this.getSubhooks(!0),t=o.clone(t,this._getAllDimensions());var u=this._getFirstDimension({type:"time"}),h=new Date(t[u]);t=o.clone(t,null,u);var d={},f=Object.keys(t),p=f.map(function(e){return t[e]});return f.length?o.forEach(this._dataCube,function(e,m){if(s=e.use,l=e.which,"property"!==e.use&&(r=r||d3.bisectLeft(e.getUnique(u),h)),a=e.getConceptprops?e.getConceptprops().interpolation:null,n=e.getNestedItems(f),o.forEach(p,function(t){n=n[t]}),c=o.interpolatePoint(n,s,l,r,u,h,a),d[m]=e.mapValue(c),i){var g=o.filter(n,t).filter(function(t){return t[u]<=h}).map(function(t){return e.mapValue(t[l])}).concat(d[m]);d[m]=g}}):o.forEach(this._dataCube,function(f,p){n=f.getNestedItems(e),d[p]={},s=f.use,l=f.which,"property"!==f.use&&(r="undefined"==typeof r?d3.bisectLeft(f.getUnique(u),h):r),a=f.getConceptprops?f.getConceptprops().interpolation:null;var m=function(e,n,d){if(r=d3.bisectLeft(e.map(function(t){return t[u]}),h),c=o.interpolatePoint(e,s,l,r,u,h,a),n[d]=f.mapValue(c),i){var p=o.filter(e,t).filter(function(t){return t[u]<=h}).map(function(t){return f.mapValue(t[l])}).concat(n[d]);n[d]=p}},g=function t(e,i,n,r){i--,o.forEach(e,function(e,a){i?(n[a]={},t(e,i,n[a],r)):r(e,n,a)})};g(n,e.length,d[p],m)}),d},getEntityLimits:function(t){var e=this,i=this._parent.time.getAllSteps(),n=[],r=[];o.forEach(e.getSubhooks(),function(t){"constant"!=t.use&&t._important&&r.push(t._name)});var a=function(e){if(!e)return!1;for(var i=0,n=r.length;i<n;i++)if(!e[r[i]][t]&&0!==e[r[i]][t])return!1;return!0},s=function t(n,r){var o=n();null!=o&&e.getFrame(i[o],function(e){a(e)?r(o):t(n,r)})},l=[];return l.push(new Promise(function(t,e){s(function(){var t=i.length,e=0;return function(){return e<t?e++:null}}(),function(e){n[0]=i[e],t()})})),l.push(new Promise(function(t,e){s(function(){var t=i.length-1;return function(){return t>=0?t--:null}}(),function(e){n[1]=i[e],t()})})),Promise.all(l).then(function(){return{min:n[0],max:n[1]}})},getSpace:function(){return o.isArray(this.space)?this.space:void o.error('ERROR: space not found.\n You must specify the objects this hook will use under the "space" attribute in the state.\n Example:\n space: ["entities", "time"]')}});e.default=c},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var a=i(1),o=r(a),s=i(42),l=n(s),c=l.default.extend({getClassDefaults:function(){var t={use:null,which:null};return o.deepExtend(this._super(),t)},init:function(t,e,i,n){this._type="side",n.readyOnce=this.readyOnce,this.state={left:{},right:{}},this._super(t,e,i,n)},readyOnce:function(){if(this.spaceRef){var t=this._space[this.spaceRef].dataConnectedChildren.slice(0);t.splice(t.indexOf("show"),1),this._space[this.spaceRef].dataConnectedChildren=t}},switchSideState:function(){var t=this.state.left;this.state.left=this.state.right,this.state.right=t},clearSideState:function(){this.state={left:{},right:{}}}});e.default=c},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var a=i(90),o=r(a),s=i(1),l=n(s),c=o.default.extend({getClassDefaults:function(){var t={use:null,which:null,domainMin:null,domainMax:null,zoomedMin:null,zoomedMax:null,extent:[0,.85],scaleType:null,allow:{scales:["linear","log","genericLog","pow"]}};return l.deepExtend(this._super(),t)},_type:"size",buildScale:function(){this._super(),"ordinal"!==this.scaleType&&this.scale.clamp(!0)},autoGenerateModel:function(){if(null==this.which){var t=void 0;this.autogenerate&&(t=this.dataSource.getConceptByIndex(this.autogenerate.conceptIndex,this.autogenerate.conceptType),t&&(this.which=t.concept,this.use="indicator",this.scaleType="linear")),t||(this.which="_default",this.use="constant",this.scaleType="ordinal")}null==this.scaleType&&(this.scaleType=this.dataSource.getConceptprops(this.which).scales[0])}});e.default=c},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var a=i(1),o=r(a),s=i(42),l=n(s),c={ALL:"all",_default:"none"},u=l.default.extend({getClassDefaults:function(){var t={use:null,which:null,merge:!1};return o.deepExtend(this._super(),t)},init:function(t,e,i,n){this._type="model",this._super(t,e,i,n)},validate:function(){this.scale&&(this.scale=null),"indicator"===this.use&&(o.warn("stack model: use must not be 'indicator'. Resetting use to 'constant' and which to '"+c._default),this.use="constant",this.which=c._default),"constant"===this.use&&o.values(c).indexOf(this.which)==-1&&(o.warn("stack model: the requested value '"+this.which+"' is not allowed. resetting to '"+c._default),this.which==c._default)},getPalettes:function(){return c},buildScale:function(){}});e.default=u},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function a(){var t=function(t){return e(t)+"w"+i(t)};t.parse=function(t){var e=t.match(/^(\d{4})w(\d{2})$/);return e?n(e[1],e[2]):null};var e=function(t){var e=+t;return new Date(e+864e5*(4-(t.getUTCDay()||7))).getUTCFullYear()},i=function(t){var e=+t,i=new Date(e+864e5*(4-(t.getUTCDay()||7))),n=Math.ceil(((i.getTime()-i.setUTCMonth(0,1))/864e5+1)/7);return n<10?"0"+n:n},n=function(t,e){var i=parseInt(e),n=t,r=new Date;r.setUTCFullYear(n),r.setUTCMonth(0),r.setUTCDate(4);var a=r.getUTCDay()||7,o=1,s=7*i+o-(a+4),l=h.year.parse(n);return l=new Date(l.getTime()+24*s*60*60*1e3)};return t}function o(){var t=function(t){return h.year.data(t)+"q"+e(t)};t.parse=function(t){var e=t.match(/^(\d{4})q(\d)$/);return e?i(e[1],e[2]):null};var e=function(t){return(t.getUTCMonth()/3|0)+1},i=function(t,e){var i=parseInt(e),n=3*i-2,r=t;return h.month.data.parse([r,(n<9?"0":"")+n].join("-"))};return t}Object.defineProperty(e,"__esModule",{value:!0});var s=i(1),l=r(s),c=i(61),u=n(c);Date.prototype.utc=Date.prototype.toUTCString;var h={year:{data:d3.time.format.utc("%Y"),ui:d3.time.format.utc("%Y")},month:{data:d3.time.format.utc("%Y-%m"),ui:d3.time.format.utc("%b %Y")},day:{data:d3.time.format.utc("%Y%m%d"),ui:d3.time.format.utc("%c")},hour:{data:d3.time.format.utc("%Y%m%dT%H"),ui:d3.time.format.utc("%b %d %Y, %H")},minute:{data:d3.time.format.utc("%Y%m%dT%H%M"),ui:d3.time.format.utc("%b %d %Y, %H:%M")},second:{data:d3.time.format.utc("%Y%m%dT%H%M%S"),ui:d3.time.format.utc("%b %d %Y, %H:%M:%S")},week:{data:a(),ui:a()},quarter:{data:o(),ui:o()}},d=u.default.extend({objectLeafs:["autogenerate"],getClassDefaults:function(){var t={dim:null,value:null,start:null,end:null,startOrigin:null,endOrigin:null,startSelected:null,endSelected:null,playable:!0,playing:!1,loop:!1,round:"round",delay:150,delayThresholdX2:90,delayThresholdX4:45,unit:"year",format:{data:null,ui:null},step:1,immediatePlay:!0,record:!1};return l.deepExtend(this._super(),t)},dataConnectedChildren:["startOrigin","endOrigin","dim"],init:function(t,e,i,n){this._type="time",this._super(t,e,i,n);var r=this;this.initFormatters(),this.dragging=!1,this.postponePause=!1,this.allSteps={},this.delayAnimations=this.delay,this.on({"change:playing":function(){r.playing===!0?r._startPlaying():r._stopPlaying()},"change:format":function(){r.initFormatters()}})},initFormatters:function(){h[this.unit]&&(this.formatters=h[this.unit]),"string"==typeof this.format?this.formatters.data=this.formatters.ui=d3.time.format.utc(this.format):(this.format.data&&(this.formatters.data=d3.time.format.utc(this.format.data)),this.format.ui&&(this.formatters.ui=d3.time.format.utc(this.format.ui))),this.validateFormatting()},afterPreload:function(){if(null==this.dim&&this.autogenerate){var t=this.getClosestModel(this.autogenerate.data);this.dim=t.getConceptByIndex(this.autogenerate.conceptIndex,this.autogenerate.conceptType).concept}},_formatToDates:function(){for(var t=["value"],e=["value","start","end","startSelected","endSelected"],i=0;i<e.length;i++){var n=e[i];if(!l.isDate(this[n])){var r=this.parse(this[n]);this.set(n,r,null,t.indexOf(n)!==-1)}}},formatDate:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"data";return["data","ui"].indexOf(e)===-1&&(l.warn("Time.formatDate type parameter ("+e+') invalid. Using "data".'),e=data),null==t?null:this.formatters[e](t)},parse:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"data";return null==t?null:this.formatters[e].parse(t.toString())},findFormat:function(t){for(var e=Object.keys(h),i=0;i<e.length;i++){var n=h[e[i]].data.parse(t);if(n)return{unit:e[i],time:n,type:"data"};if(n=h[e[i]].ui.parse(t))return{unit:e[i],time:n,type:"ui"}}return null},validate:function(){null==this.start&&this.startOrigin&&this.set("start",this.startOrigin,null,!1),null==this.end&&this.endOrigin&&this.set("end",this.endOrigin,null,!1),this.formatters&&this.validateFormatting(),h[this.unit]||(l.warn(this.unit+' is not a valid time unit, using "year" instead.'),this.unit="year"),this.step<1&&(this.step=1),this.end<this.start&&null!=this.start&&this.set("end",new Date(this.start),null,!1),this.value<this.startSelected&&null!=this.startSelected&&(this.value=new Date(this.startSelected)),this.value>this.endSelected&&null!=this.endSelected&&(this.value=new Date(this.endSelected)),this.splash===!1&&(this.startSelected<this.start&&null!=this.start&&this.set({startSelected:new Date(this.start)},null,!1),this.endSelected>this.end&&null!=this.end&&this.set({endSelected:new Date(this.end)},null,!1)),this.value<this.start&&null!=this.start?this.value=new Date(this.start):this.value>this.end&&null!=this.end&&(this.value=new Date(this.end)),this.playable===!1&&this.playing===!0&&this.set("playing",!1,null,!1)},validateFormatting:function(){null==this.value&&this.set("value",this.parse(this.formatDate(new Date)),null,!1),l.isDate(this.start)&&l.isDate(this.end)&&l.isDate(this.value)&&l.isDate(this.startSelected)&&l.isDate(this.endSelected)||this._formatToDates()},play:function(){this._startPlaying()},pause:function(t){t?this.postponePause=!0:this.playing&&(this.set("playing",!1,null,!1),this.set("value",this.value,!0,!0))},dragStart:function(){this.dragging=!0},dragStop:function(){this.dragging=!1},getRange:function(){var t=this.getIntervalAndStep();return d3["utc"+t.interval].range(this.start,this.end,t.step)},getIntervalAndStep:function(){var t=void 0,e=void 0;switch(this.unit){case"week":t="monday",e=this.step;break;case"quarter":t="month",e=3*this.step;break;default:t=this.unit,e=this.step}return{interval:l.capitalize(t),step:e}},getFilter:function(t){var e=this.parse(this.startOrigin),i=this.parse(this.endOrigin),n=this.getDimension(),r=null;if(t)null!=this.value&&(r={},r[n]=this.formatters.data(this.value));else{var a=void 0,o=void 0;null!=e&&(a=this.formatters.data(e)),null!=i&&(o=this.formatters.data(i)),(a||o)&&(r={},r[n]={},a&&(r[n].$gte=a),o&&(r[n].$lte=o))}return r},getParser:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"data";return this.formatters[t].parse},getFormatter:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"data";return this.formatters[t]},getAllSteps:function(){if(!this.start||!this.end)return l.warn("getAllSteps(): invalid start/end time is detected: "+this.start+", "+this.end),[];var t=""+this.start+this.end+this.step;if(this.allSteps[t])return this.allSteps[t];this.allSteps[t]=[];for(var e=this.start;+e<=+this.end;){var i=this.getIntervalAndStep();this.allSteps[t].push(e),e=d3["utc"+i.interval].offset(e,i.step)}return this.allSteps[t]},snap:function(t){if(this.round){null==t&&(t="value");var e="round";"ceil"===this.round&&(e="ceil"),"floor"===this.round&&(e="floor");var i=this.getIntervalAndStep(),n=d3["utc"+i.interval][e](this[t]);this.value-n==0&&this.value-this.start!=0&&this.value-this.end!=0||this.set(t,n,!0)}},_startPlaying:function(){if(this.playable){var t=this;this.value>=this.endSelected&&t.getModelObject("value").set(t.startSelected,null,!1),this.set("playing",!0,null,!1),this.playInterval(this.immediatePlay),this.trigger("play")}},playInterval:function(t){if(this.playing){var e=this;this.delayAnimations=this.delay,this.delay<this.delayThresholdX2&&(this.delayAnimations*=2),this.delay<this.delayThresholdX4&&(this.delayAnimations*=2);var i=t?1:this.delayAnimations;this._intervals.setInterval("playInterval_"+this._id,function(){if(e.value>=e.endSelected)e.loop?e.getModelObject("value").set(e.startSelected,null,!1):e.set("playing",!1,null,!1);else if(e._intervals.clearInterval("playInterval_"+e._id),e.postponePause||!e.playing)e.set("playing",!1,null,!1),e.postponePause=!1,e.getModelObject("value").set(e.value,!0,!0);else{var t=e.getIntervalAndStep();e.delay<e.delayThresholdX2&&(t.step*=2),e.delay<e.delayThresholdX4&&(t.step*=2);var i=d3["utc"+t.interval].offset(e.value,t.step);i>=e.endSelected?e.getModelObject("value").set(e.endSelected,null,!0):e.getModelObject("value").set(i,null,!1),e.playInterval()}},i)}},incrementTime:function(t){var e=this.getIntervalAndStep();return d3["utc"+e.interval].offset(t,e.step)},decrementTime:function(t){var e=this.getIntervalAndStep();return d3["utc"+e.interval].offset(t,-e.step)},_stopPlaying:function(){this._intervals.clearInterval("playInterval_"+this._id),this.trigger("pause")}});e.default=d},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var a=i(1),o=r(a),s=i(47),l=n(s),c="vzb-",u="presentation",h="rtl",d="vzb-portrait",f="vzb-landscape",p=l.default.extend({screen_profiles:{small:{min_width:0,min_height:0},medium:{min_width:600,min_height:400},large:{min_width:900,min_height:520}},getClassDefaults:function(){var t={presentation:!1,buttons:[],dialogs:{popup:[],sidebar:[],moreoptions:[]},splash:!1};return o.deepExtend(this._super(),t)},init:function(t,e,i,n){this._type="ui",this._container=null,this._curr_profile=null,this._prev_size={},this.resizeHandler=this.resizeHandler.bind(this),window.addEventListener("resize",this.resizeHandler),n["change:presentation"]=this.updatePresentation.bind(this),this._super(t,e,i,n)},resizeHandler:function(){this._container&&this.setSize()},setSize:function(t){var e=this,i=this._container.clientWidth,n=this._container.clientHeight;if(/^((?!chrome|android).)*safari/i.test(navigator.userAgent)&&navigator.userAgent.match(/iPhone/i)&&(this._container.style.top=0,this._container.clientWidth>this._container.clientHeight&&this._container.clientWidth<700)){var r=this._container.clientHeight,a=window.innerHeight;2<r-a&&r-a<=45&&(this._container.style.top="44px",document.body.scrollTop=44)}!t&&this._prev_size&&this._prev_size.width===i&&this._prev_size.height===n||(o.forEach(this.screen_profiles,function(t,r){o.removeClass(e._container,c+r),i>=t.min_width&&n>=t.min_height&&(e._curr_profile=r)}),o.addClass(this._container,c+this._curr_profile),o.classed(this._container,d,i<n),o.classed(this._container,f,!(i<n)),this._prev_size.width=i,this._prev_size.height=n,this.trigger("resize"))},setContainer:function(t){this._container=t,this.setSize(),this.updatePresentation()},updatePresentation:function(){o.classed(this._container,c+u,this.presentation),this.trigger("resize")},getPresentationMode:function(){return this.presentation},setRTL:function(t){o.classed(this._container,c+h,t)},currentProfile:function(){return this._curr_profile},clear:function(){window.removeEventListener("resize",this.resizeHandler)}});e.default=p},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(t,e){var i=[],n=!0,r=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done)&&(i.push(o.value),!e||i.length!==e);n=!0);}catch(t){r=!0,a=t}finally{try{!n&&s.return&&s.return()}finally{if(r)throw a}}return i}return function(e,i){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=i(72),o=n(a),s={},l=o.default.extend({_name:"csv",init:function(t){this._data=[],this._basepath=t.path,this.delimiter=t.delimiter,this.keySize=t.keySize||1,Object.assign(this.ERRORS,{WRONG_TIME_COLUMN_OR_UNITS:"reader/error/wrongTimeUnitsOrColumn",NOT_ENOUGH_ROWS_IN_FILE:"reader/error/notEnoughRows",UNDEFINED_DELIMITER:"reader/error/undefinedDelimiter",EMPTY_HEADERS:"reader/error/emptyHeaders"})},ensureDataIsCorrect:function(t,e){var i=t.columns,n=t.data,a=i[this.keySize],o=r(n,1),s=o[0],l=e[a],c=s[a];if(l&&!l(c))throw this.error(this.ERRORS.WRONG_TIME_COLUMN_OR_UNITS,void 0,{currentYear:(new Date).getFullYear(),foundYear:c});if(!i.filter(Boolean).length)throw this.error(this.ERRORS.EMPTY_HEADERS)},getDatasetInfo:function(){return{name:this._basepath.split("/").pop()}},load:function(){var t=this,e=this._basepath;return new Promise(function(i,n){var r=s[e];r?i(r):d3.text(e).get(function(r,a){if(!a)return n("No permissions or empty file: "+e+". "+r);if(r)return n("Error happened while loading csv file: "+e+". "+r);try{var o=t.delimiter,l=void 0===o?t._guessDelimiter(a):o,c=d3.dsvFormat(l),u=c.parse(a),h={columns:u.columns,data:u};s[e]=h,i(h)}catch(t){return n(t)}})})},_guessDelimiter:function(t){var e=2,i=this._getRows(t,e).map(function(t){return t.replace(/".*?"/g,"")});if(i.length!==e)throw this.error(this.ERRORS.NOT_ENOUGH_ROWS_IN_FILE);var n=r(i,2),a=n[0],o=n[1],s=",",l=";",c=this._countCharsInLine(a,s),u=this._countCharsInLine(a,l),h=this._countCharsInLine(o,s),d=this._countCharsInLine(o,l);if(c===h&&c>1&&(u!==d||!u&&!d||c>u&&h>d))return s;if(u===d&&u>1&&(c!==h||!c&&!h||u>c&&d>h))return l;throw this.error(this.ERRORS.UNDEFINED_DELIMITER)},_getRows:function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=/([^\r\n]+)/g,n=[],r=0,a=!0;a&&r!==e;)a=i.exec(t),a&&a.length>1&&(++r,n.push(a[1]));return n},_countCharsInLine:function(t,e){var i=new RegExp(e,"g"),n=t.match(i);return n?n.length:0}});e.default=l},function(t,e,i){var n=i(28);t.exports=function(t,e){if("number"!=typeof t&&"Number"!=n(t))throw TypeError(e);return+t}},function(t,e,i){"use strict";var n=i(13),r=i(57),a=i(12);t.exports=[].copyWithin||function(t,e){var i=n(this),o=a(i.length),s=r(t,o),l=r(e,o),c=arguments.length>2?arguments[2]:void 0,u=Math.min((void 0===c?o:r(c,o))-l,o-s),h=1;for(l<s&&s<l+u&&(h=-1,l+=u-1,s+=u-1);u-- >0;)l in i?i[s]=i[l]:delete i[s],s+=h,l+=h;return i}},function(t,e,i){var n=i(63);t.exports=function(t,e){var i=[];return n(t,!1,i.push,i,e),i}},function(t,e,i){var n=i(17),r=i(13),a=i(69),o=i(12);t.exports=function(t,e,i,s,l){n(e);var c=r(t),u=a(c),h=o(c.length),d=l?h-1:0,f=l?-1:1;if(i<2)for(;;){if(d in u){s=u[d],d+=f;break}if(d+=f,l?d<0:h<=d)throw TypeError("Reduce of empty array with no initial value")}for(;l?d>=0:h>d;d+=f)d in u&&(s=e(s,u[d],d,c));return s}},function(t,e,i){"use strict";var n=i(17),r=i(6),a=i(78),o=[].slice,s={},l=function(t,e,i){if(!(e in s)){for(var n=[],r=0;r<e;r++)n[r]="a["+r+"]";s[e]=Function("F,a","return new F("+n.join(",")+")")}return s[e](t,i)};t.exports=Function.bind||function(t){var e=n(this),i=o.call(arguments,1),s=function(){var n=i.concat(o.call(arguments));return this instanceof s?l(e,n.length,n):a(e,n,t)};return r(e.prototype)&&(s.prototype=e.prototype),s}},function(t,e,i){"use strict";var n=i(9).f,r=i(52),a=i(55),o=i(37),s=i(50),l=i(29),c=i(63),u=i(101),h=i(164),d=i(56),f=i(8),p=i(43).fastKey,m=f?"_s":"size",g=function(t,e){var i,n=p(e);if("F"!==n)return t._i[n];for(i=t._f;i;i=i.n)if(i.k==e)return i};t.exports={getConstructor:function(t,e,i,u){var h=t(function(t,n){s(t,h,e,"_i"),t._i=r(null),t._f=void 0,t._l=void 0,t[m]=0,void 0!=n&&c(n,i,t[u],t)});return a(h.prototype,{clear:function(){for(var t=this,e=t._i,i=t._f;i;i=i.n)i.r=!0,i.p&&(i.p=i.p.n=void 0),delete e[i.i];t._f=t._l=void 0,t[m]=0},delete:function(t){var e=this,i=g(e,t);if(i){var n=i.n,r=i.p;delete e._i[i.i],i.r=!0,r&&(r.n=n),n&&(n.p=r),e._f==i&&(e._f=n),e._l==i&&(e._l=r),e[m]--}return!!i},forEach:function(t){s(this,h,"forEach");for(var e,i=o(t,arguments.length>1?arguments[1]:void 0,3);e=e?e.n:this._f;)for(i(e.v,e.k,this);e&&e.r;)e=e.p},has:function(t){return!!g(this,t)}}),f&&n(h.prototype,"size",{get:function(){return l(this[m])}}),h},def:function(t,e,i){var n,r,a=g(t,e);return a?a.v=i:(t._l=a={i:r=p(e,!0),k:e,v:i,p:n=t._l,n:void 0,r:!1},t._f||(t._f=a),n&&(n.n=a),t[m]++,"F"!==r&&(t._i[r]=a)),t},getEntry:g,setStrong:function(t,e,i){u(t,e,function(t,e){this._t=t,this._k=e,this._l=void 0},function(){for(var t=this,e=t._k,i=t._l;i&&i.r;)i=i.p;return t._t&&(t._l=i=i?i.n:t._t._f)?"keys"==e?h(0,i.k):"values"==e?h(0,i.v):h(0,[i.k,i.v]):(t._t=void 0,h(1))},i?"entries":"values",!i,!0),d(e)}}},function(t,e,i){var n=i(68),r=i(155);t.exports=function(t){return function(){if(n(this)!=t)throw TypeError(t+"#toJSON isn't generic");return r(this)}}},function(t,e,i){"use strict";var n=i(55),r=i(43).getWeak,a=i(3),o=i(6),s=i(50),l=i(63),c=i(31),u=i(14),h=c(5),d=c(6),f=0,p=function(t){return t._l||(t._l=new m)},m=function(){this.a=[]},g=function(t,e){return h(t.a,function(t){return t[0]===e})};m.prototype={get:function(t){var e=g(this,t);if(e)return e[1]},has:function(t){return!!g(this,t)},set:function(t,e){var i=g(this,t);i?i[1]=e:this.a.push([t,e])},delete:function(t){var e=d(this.a,function(e){return e[0]===t});return~e&&this.a.splice(e,1),!!~e}},t.exports={getConstructor:function(t,e,i,a){var c=t(function(t,n){s(t,c,e,"_i"),t._i=f++,t._l=void 0,void 0!=n&&l(n,i,t[a],t)});return n(c.prototype,{delete:function(t){if(!o(t))return!1;var e=r(t);return e===!0?p(this).delete(t):e&&u(e,this._i)&&delete e[this._i]},has:function(t){if(!o(t))return!1;var e=r(t);return e===!0?p(this).has(t):e&&u(e,this._i)}}),c},def:function(t,e,i){var n=r(a(e),!0);return n===!0?p(t).set(e,i):n[t._i]=i,t},ufstore:p}},function(t,e,i){t.exports=!i(8)&&!i(5)(function(){return 7!=Object.defineProperty(i(93)("div"),"a",{get:function(){return 7}}).a})},function(t,e,i){var n=i(6),r=Math.floor;t.exports=function(t){return!n(t)&&isFinite(t)&&r(t)===t}},function(t,e,i){var n=i(3);t.exports=function(t,e,i,r){try{return r?e(n(i)[0],i[1]):e(i)}catch(e){var a=t.return;throw void 0!==a&&n(a.call(t)),e}}},function(t,e){
t.exports=function(t,e){return{value:e,done:!!t}}},function(t,e){t.exports=Math.log1p||function(t){return(t=+t)>-1e-8&&t<1e-8?t-t*t/2:Math.log(1+t)}},function(t,e,i){"use strict";var n=i(54),r=i(82),a=i(70),o=i(13),s=i(69),l=Object.assign;t.exports=!l||i(5)(function(){var t={},e={},i=Symbol(),n="abcdefghijklmnopqrst";return t[i]=7,n.split("").forEach(function(t){e[t]=t}),7!=l({},t)[i]||Object.keys(l({},e)).join("")!=n})?function(t,e){for(var i=o(t),l=arguments.length,c=1,u=r.f,h=a.f;l>c;)for(var d,f=s(arguments[c++]),p=u?n(f).concat(u(f)):n(f),m=p.length,g=0;m>g;)h.call(f,d=p[g++])&&(i[d]=f[d]);return i}:l},function(t,e,i){var n=i(9),r=i(3),a=i(54);t.exports=i(8)?Object.defineProperties:function(t,e){r(t);for(var i,o=a(e),s=o.length,l=0;s>l;)n.f(t,i=o[l++],e[i]);return t}},function(t,e,i){var n=i(21),r=i(53).f,a={}.toString,o="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],s=function(t){try{return r(t)}catch(t){return o.slice()}};t.exports.f=function(t){return o&&"[object Window]"==a.call(t)?s(t):r(n(t))}},function(t,e,i){var n=i(14),r=i(21),a=i(74)(!1),o=i(106)("IE_PROTO");t.exports=function(t,e){var i,s=r(t),l=0,c=[];for(i in s)i!=o&&n(s,i)&&c.push(i);for(;e.length>l;)n(s,i=e[l++])&&(~a(c,i)||c.push(i));return c}},function(t,e,i){var n=i(54),r=i(21),a=i(70).f;t.exports=function(t){return function(e){for(var i,o=r(e),s=n(o),l=s.length,c=0,u=[];l>c;)a.call(o,i=s[c++])&&u.push(t?[i,o[i]]:o[i]);return u}}},function(t,e,i){var n=i(53),r=i(82),a=i(3),o=i(4).Reflect;t.exports=o&&o.ownKeys||function(t){var e=n.f(a(t)),i=r.f;return i?e.concat(i(t)):e}},function(t,e,i){var n=i(4).parseFloat,r=i(66).trim;t.exports=1/n(i(111)+"-0")!==-(1/0)?function(t){var e=r(String(t),3),i=n(e);return 0===i&&"-"==e.charAt(0)?-0:i}:n},function(t,e,i){var n=i(4).parseInt,r=i(66).trim,a=i(111),o=/^[\-+]?0[xX]/;t.exports=8!==n(a+"08")||22!==n(a+"0x16")?function(t,e){var i=r(String(t),3);return n(i,e>>>0||(o.test(i)?16:10))}:n},function(t,e){t.exports=Object.is||function(t,e){return t===e?0!==t||1/t===1/e:t!=t&&e!=e}},function(t,e,i){var n=i(12),r=i(110),a=i(29);t.exports=function(t,e,i,o){var s=String(a(t)),l=s.length,c=void 0===i?" ":String(i),u=n(e);if(u<=l||""==c)return s;var h=u-l,d=r.call(c,Math.ceil(h/c.length));return d.length>h&&(d=d.slice(0,h)),o?d+s:s+d}},function(t,e,i){e.f=i(7)},function(t,e,i){"use strict";var n=i(158);t.exports=i(75)("Map",function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},{get:function(t){var e=n.getEntry(this,t);return e&&e.v},set:function(t,e){return n.def(this,0===t?0:t,e)}},n,!0)},function(t,e,i){i(8)&&"g"!=/./g.flags&&i(9).f(RegExp.prototype,"flags",{configurable:!0,get:i(77)})},function(t,e,i){"use strict";var n=i(158);t.exports=i(75)("Set",function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},{add:function(t){return n.def(this,t=0===t?0:t,t)}},n)},function(t,e,i){"use strict";var n,r=i(31)(0),a=i(19),o=i(43),s=i(166),l=i(160),c=i(6),u=o.getWeak,h=Object.isExtensible,d=l.ufstore,f={},p=function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},m={get:function(t){if(c(t)){var e=u(t);return e===!0?d(this).get(t):e?e[this._i]:void 0}},set:function(t,e){return l.def(this,t,e)}},g=t.exports=i(75)("WeakMap",p,m,l,!0,!0);7!=(new g).set((Object.freeze||Object)(f),7).get(f)&&(n=l.getConstructor(p),s(n.prototype,m),o.NEED=!0,r(["delete","has","get","set"],function(t){var e=g.prototype,i=e[t];a(e,t,function(e,r){if(c(e)&&!h(e)){this._f||(this._f=new n);var a=this._f[t](e,r);return"set"==t?this:a}return i.call(this,e,r)})}))},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var a=i(1),o=(r(a),i(15)),s=n(o),l=i(215),c=n(l),u=i(26),h=n(u),d=i(23),f=n(d),p=i(22),m=n(p),g=i(27),v=n(g),y=i(35),b=n(y),_=i(49),x=n(_),w=s.default.extend("AgePyramid",{init:function(t,e){this.name="agepyramid",this.components=[{component:c.default,placeholder:".vzb-tool-viz",model:["state.time","state.marker","state.entities","state.entities_side","locale","ui"]},{component:h.default,placeholder:".vzb-tool-timeslider",model:["state.time","state.entities","state.marker","ui"]},{component:f.default,placeholder:".vzb-tool-dialogs",model:["state","ui","locale"]},{component:m.default,placeholder:".vzb-tool-buttonlist",model:["state","ui","locale"]},{component:v.default,placeholder:".vzb-tool-treemenu",model:["state.marker","state.marker_tags","state.time","locale"]},{component:b.default,placeholder:".vzb-tool-datanotes",model:["state.marker","locale"]},{component:x.default,placeholder:".vzb-tool-stepped-speed-slider",model:["state.time","locale"]}],this._super(t,e)},default_model:{state:{marker_tags:{}},ui:{chart:{stacked:!0,inpercent:!1,flipSides:!0},buttons:["colors","inpercent","side","moreoptions","fullscreen"],dialogs:{popup:["timedisplay","colors","side","moreoptions"],sidebar:["timedisplay","colors","show"],moreoptions:["opacity","speed","colors","side","presentation","about"]},presentation:!1},locale:{}}});e.default=w},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var a=i(1),o=(r(a),i(15)),s=n(o),l=i(216),c=n(l),u=0,h=[[-123,123],[1,1e4],[4,123],[6e-4,123],[123,4],[123,6e-4],[-123,-4],[-123,-6e-4],[-4,-123],[-6e-4,-123],[-123,1800],[1800,-123],[123,-18e3],[-18e3,123],[-6e-4,1800],[1800,-6e-4],[6e-4,-1800],[-1800,6e-4],[-12,-2],[-80,40],[5,8],[42,42],[5e-11,4554545484715],[-2611968678575,4554545484715],[-.002,.002],[-123,-.1,.002,1540],[-123,-.001,.5,1540],[123,.1,-.002,-1540],[123,.001,-.5,-1540]],d=s.default.extend("AxisLabeler",{init:function(t,e){this.name="axislabeler",this.components=[{component:c.default,placeholder:".vzb-tool-viz",model:["state.scales","state.show"]}],this._super(t,e)},default_model:{state:{scales:{domain:h[u],xScaleType:"linear",yScaleType:"genericLog"},show:{labelSize:"16px",labelMargin:{LR:"5px",TB:"5px"},toolMargin:{top:30,right:20,left:40,bottom:40}}},data:{noConceptprops:!0},locale:{},ui:{}}});e.default=d},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var a=i(1),o=(r(a),i(15)),s=n(o),l=i(217),c=n(l),u=i(26),h=n(u),d=i(23),f=n(d),p=i(22),m=n(p),g=i(27),v=n(g),y=s.default.extend("BarChart",{init:function(t,e){this.name="barchart",this.components=[{component:c.default,placeholder:".vzb-tool-viz",model:["state.time","state.entities","state.marker","locale"]},{component:h.default,placeholder:".vzb-tool-timeslider",model:["state.time","state.entities","state.marker","ui"]},{component:f.default,placeholder:".vzb-tool-dialogs",model:["state","ui","locale"]},{component:m.default,placeholder:".vzb-tool-buttonlist",model:["state","ui","locale"]},{component:v.default,placeholder:".vzb-tool-treemenu",model:["state.marker","state.marker_tags","state.time","locale"]}],this._super(t,e)},default_model:{state:{time:{},entities:{},marker:{label:{},axis_y:{allow:{scales:["linear","log"]}},axis_x:{allow:{scales:["ordinal","nominal"]}},color:{}}},locale:{},ui:{presentation:!1,chart:{},buttons:["axes","colors","fullscreen"],dialogs:{popup:["axes","colors"]}}}});e.default=y},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var a=i(1),o=(r(a),i(15)),s=n(o),l=i(218),c=n(l),u=i(26),h=n(u),d=i(23),f=n(d),p=i(22),m=n(p),g=i(27),v=n(g),y=i(35),b=n(y),_=i(40),x=n(_),w=i(49),M=n(w),z=s.default.extend("BarRankChart",{init:function(t,e){this.name="barrankchart",this.components=[{component:c.default,placeholder:".vzb-tool-viz",model:["state.time","state.entities","state.marker","locale","ui"]},{component:h.default,placeholder:".vzb-tool-timeslider",model:["state.time","state.entities","state.marker","ui"]},{component:f.default,placeholder:".vzb-tool-dialogs",model:["state","ui","locale"]},{component:m.default,placeholder:".vzb-tool-buttonlist",model:["state","ui","locale"]},{component:v.default,placeholder:".vzb-tool-treemenu",model:["state.marker","state.marker_tags","state.time","locale"]},{component:b.default,placeholder:".vzb-tool-datanotes",model:["state.marker","locale"]},{component:x.default,placeholder:".vzb-tool-datawarning",model:["locale"]},{component:M.default,placeholder:".vzb-tool-stepped-speed-slider",model:["state.time","locale"]}],this._super(t,e)},default_model:{state:{entities:{dim:"id"},time:{},marker:{axis_x:{allow:{scales:["linear","log"]}},axis_y:{allow:{scales:["ordinal","nominal"]}},color:{}}},locale:{},ui:{chart:{},datawarning:{doubtDomain:[],doubtRange:[]},buttons:["colors","find","show","moreoptions","fullscreen","presentation"],dialogs:{popup:["timedisplay","colors","find","axes","show","moreoptions"],sidebar:["timedisplay","colors","find"],moreoptions:["opacity","speed","colors","presentation","about"]},presentation:!1}}});e.default=z},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var a=i(1),o=(r(a),i(15)),s=n(o),l=i(219),c=n(l),u=i(26),h=n(u),d=i(23),f=n(d),p=i(22),m=n(p),g=i(27),v=n(g),y=i(40),b=n(y),_=i(35),x=n(_),w=i(49),M=n(w),z=s.default.extend("BubbleChart",{init:function(t,e){this.name="bubblechart",this.components=[{component:c.default,placeholder:".vzb-tool-viz",model:["state.time","state.entities","state.marker","locale","ui"]},{component:h.default,placeholder:".vzb-tool-timeslider",model:["state.time","state.entities","state.marker","ui"]},{component:f.default,placeholder:".vzb-tool-dialogs",model:["state","ui","locale"]},{component:m.default,placeholder:".vzb-tool-buttonlist",model:["state","ui","locale"]},{component:v.default,placeholder:".vzb-tool-treemenu",model:["state.marker","state.marker_tags","state.time","locale"]},{component:b.default,placeholder:".vzb-tool-datawarning",model:["locale"]},{component:x.default,placeholder:".vzb-tool-datanotes",model:["state.marker","locale"]},{component:M.default,placeholder:".vzb-tool-stepped-speed-slider",model:["state.time","locale"]}],this._super(t,e)},validate:function(t){if(t=this.model||t,this._super(t),t.ui.chart.lockNonSelected){var e=t.state.time.parse(""+t.ui.chart.lockNonSelected);e<t.state.time.start&&(t.ui.chart.lockNonSelected=t.state.time.formatDate(t.state.time.start)),e>t.state.time.end&&(t.ui.chart.lockNonSelected=t.state.time.formatDate(t.state.time.end))}},default_model:{state:{time:{autogenerate:{data:"data",conceptIndex:0,conceptType:"time"}},entities:{autogenerate:{data:"data",conceptIndex:0}},entities_colorlegend:{autogenerate:{data:"data",conceptIndex:0}},entities_tags:{},marker_tags:{space:["entities_tags"],label:{},hook_parent:{}},marker:{space:["entities","time"],axis_x:{use:"indicator",autogenerate:{conceptIndex:1,conceptType:"measure"}},axis_y:{use:"indicator",autogenerate:{conceptIndex:0,conceptType:"measure"}},label:{use:"property",autogenerate:{conceptIndex:0}},size:{autogenerate:{conceptIndex:2,conceptType:"measure"}},color:{syncModels:["marker_colorlegend"],autogenerate:{conceptIndex:0,conceptType:"entity_set"}},size_label:{use:"constant",which:"_default",scaleType:"ordinal",_important:!1,extent:[0,.33],allow:{names:["_default"]}}},marker_colorlegend:{space:["entities_colorlegend"],label:{use:"property",which:"name"},hook_rank:{use:"property",which:"rank"},hook_geoshape:{use:"property",which:"shape_lores_svg"}}},locale:{},ui:{chart:{whenHovering:{showProjectionLineX:!0,showProjectionLineY:!0,higlightValueX:!0,higlightValueY:!0},labels:{dragging:!0,removeLabelBox:!1},trails:!0,lockNonSelected:0},datawarning:{doubtDomain:[],doubtRange:[]},presentation:!1,panWithArrow:!1,adaptMinMaxZoom:!1,cursorMode:"arrow",zoomOnScrolling:!1,buttons:["colors","find","trails","lock","moreoptions","fullscreen","presentation"],dialogs:{popup:["colors","find","size","zoom","moreoptions"],sidebar:["colors","find","size","zoom"],moreoptions:["opacity","speed","axes","size","colors","label","zoom","presentation","about"]}}}});e.default=z},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var a=i(1),o=(r(a),i(15)),s=n(o),l=i(222),c=n(l),u=i(26),h=n(u),d=i(23),f=n(d),p=i(22),m=n(p),g=i(27),v=n(g),y=i(40),b=n(y),_=i(35),x=n(_),w=i(49),M=n(w),z=s.default.extend("BubbleMap",{init:function(t,e){this.name="bubblemap",this.components=[{component:c.default,placeholder:".vzb-tool-viz",model:["state.time","state.entities","state.marker","locale","ui"]},{component:h.default,placeholder:".vzb-tool-timeslider",model:["state.time","state.entities","state.marker","ui"]},{component:f.default,placeholder:".vzb-tool-dialogs",model:["state","ui","locale"]},{component:m.default,placeholder:".vzb-tool-buttonlist",model:["state","ui","locale"]},{component:v.default,placeholder:".vzb-tool-treemenu",model:["state.marker","state.marker_tags","state.time","locale"]},{component:b.default,placeholder:".vzb-tool-datawarning",model:["locale"]},{component:x.default,placeholder:".vzb-tool-datanotes",model:["state.marker","locale"]},{component:M.default,placeholder:".vzb-tool-stepped-speed-slider",model:["state.time","locale"]}],this._super(t,e)},default_model:{state:{time:{delay:100,delayThresholdX2:50,delayThresholdX4:25},entities:{opacitySelectDim:.3,opacityRegular:1}},locale:{},ui:{map:{path:null,colorGeo:!1,preserveAspectRatio:!0,scale:.95,offset:{top:0,right:0,bottom:0,left:0},projection:"robinson",topology:{path:null,objects:{geo:"land",boundaries:"countries"},geoIdProperty:null}},chart:{labels:{dragging:!0}},datawarning:{doubtDomain:[],doubtRange:[]},buttons:["colors","find","size","moreoptions","fullscreen","presentation"],dialogs:{popup:["colors","find","size","moreoptions"],sidebar:["colors","find","size"],moreoptions:["opacity","speed","size","colors","presentation","about"]},presentation:!1}}});e.default=z},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var a=i(1),o=(r(a),i(15)),s=n(o),l=i(223),c=n(l),u=i(26),h=n(u),d=i(23),f=n(d),p=i(22),m=n(p),g=i(27),v=n(g),y=i(40),b=n(y),_=i(35),x=n(_),w=s.default.extend("Cartogram",{init:function(t,e){this.name="cartogram",this.components=[{component:c.default,placeholder:".vzb-tool-viz",model:["state.time","state.entities","state.marker","locale","ui"]},{component:h.default,placeholder:".vzb-tool-timeslider",model:["state.time","state.entities","state.marker","ui"]},{component:f.default,placeholder:".vzb-tool-dialogs",model:["state","ui","locale"]},{component:m.default,placeholder:".vzb-tool-buttonlist",model:["state","ui","locale"]},{component:v.default,placeholder:".vzb-tool-treemenu",model:["state.marker","locale"]},{component:b.default,placeholder:".vzb-tool-datawarning",model:["locale"]},{component:x.default,placeholder:".vzb-tool-datanotes",model:["state.marker","locale"]}],this._super(t,e)},default_model:{state:{},ui:{chart:{labels:{dragging:!0},lockNonSelected:0,lockActive:0,sizeSelectorActive:0},datawarning:{doubtDomain:[],doubtRange:[]},presentation:!1}}});e.default=w},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var a=i(1),o=(r(a),i(15)),s=n(o),l=i(224),c=(n(l),i(26)),u=(n(c),i(23)),h=(n(u),i(22)),d=(n(h),i(27)),f=(n(d),s.default.extend("DonutChart",{init:function(t,e){this.name="donutchart",this.components=[{component:"donut",placeholder:".vzb-tool-viz",model:["state.time","state.marker"]},{component:"timeslider",placeholder:".vzb-tool-timeslider",model:["state.time","state.entities","state.marker","ui"]}],this._super(t,e)},default_model:{state:{},ui:{presentation:!1},locale:{}}}));e.default=f},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var a=i(1),o=(r(a),i(15)),s=n(o),l=i(225),c=n(l),u=i(26),h=n(u),d=i(23),f=n(d),p=i(22),m=n(p),g=i(27),v=n(g),y=i(40),b=n(y),_=i(35),x=n(_),w=s.default.extend("LBubbleMap",{init:function(t,e){this.name="bubblemap",this.components=[{component:c.default,placeholder:".vzb-tool-viz",model:["state.time","state.entities","state.marker","locale","ui"]},{component:h.default,placeholder:".vzb-tool-timeslider",model:["state.time","state.entities","state.marker","ui"]},{component:f.default,placeholder:".vzb-tool-dialogs",model:["state","ui","locale"]},{component:m.default,placeholder:".vzb-tool-buttonlist",model:["state","ui","locale"]},{component:v.default,placeholder:".vzb-tool-treemenu",model:["state.marker","state.marker_tags","state.time","locale"]},{component:b.default,placeholder:".vzb-tool-datawarning",model:["locale"]},{component:x.default,placeholder:".vzb-tool-datanotes",model:["state.marker","locale"]}],this._super(t,e)},default_model:{state:{time:{delay:100,delayThresholdX2:50,delayThresholdX4:25},entities:{opacitySelectDim:.3,opacityRegular:1}},locale:{},ui:{map:{path:null,colorGeo:!1,preserveAspectRatio:!0,mapEngine:"google",mapLayer:"terrain",topojsonLayer:!0,bounds:{north:37,west:-30,south:-39,east:58},offset:{top:0,right:0,bottom:0,left:0},projection:"mercator",topology:{path:null,objects:{geo:"countries",boundaries:"countries"},geoIdProperty:null}},chart:{labels:{dragging:!0}},datawarning:{doubtDomain:[],doubtRange:[]},presentation:!1}}});e.default=w},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var a=i(1),o=(r(a),i(15)),s=n(o),l=i(227),c=n(l),u=i(26),h=n(u),d=i(23),f=n(d),p=i(22),m=n(p),g=i(27),v=n(g),y=i(40),b=n(y),_=i(35),x=n(_),w=i(49),M=n(w),z=s.default.extend("LineChart",{init:function(t,e){this.name="linechart",this.components=[{component:c.default,placeholder:".vzb-tool-viz",model:["state.time","state.entities","state.marker","locale","ui"]},{component:h.default,placeholder:".vzb-tool-timeslider",model:["state.time","state.entities","state.marker","ui"],ui:{show_value_when_drag_play:!1,axis_aligned:!0}},{component:f.default,placeholder:".vzb-tool-dialogs",model:["state","ui","locale"]},{component:m.default,placeholder:".vzb-tool-buttonlist",model:["state","ui","locale"]},{component:v.default,placeholder:".vzb-tool-treemenu",model:["state.marker","state.marker_tags","state.time","locale"]},{component:b.default,placeholder:".vzb-tool-datawarning",model:["locale"]},{component:x.default,placeholder:".vzb-tool-datanotes",model:["state.marker","locale"]},{component:M.default,placeholder:".vzb-tool-stepped-speed-slider",model:["state.time","locale"]}],this._super(t,e)},default_model:{state:{time:{},marker:{axis_x:{allow:{scales:["time"]}},axis_y:{allow:{scales:["linear","log"]}}}},locale:{},ui:{chart:{labels:{min_number_of_entities_when_values_hide:2},whenHovering:{hideVerticalNow:!1,showProjectionLineX:!0,showProjectionLineY:!0,higlightValueX:!0,higlightValueY:!0,showTooltip:!1}},datawarning:{doubtDomain:[],doubtRange:[]},buttons:["colors","find","show","moreoptions","fullscreen","presentation"],dialogs:{popup:["colors","find","show","moreoptions"],sidebar:["colors","show"],moreoptions:["opacity","speed","axes","colors","presentation","about"]},presentation:!1}}});e.default=z},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var a=i(1),o=(r(a),i(15)),s=n(o),l=i(228),c=n(l),u=i(26),h=n(u),d=i(23),f=n(d),p=i(22),m=n(p),g=i(27),v=n(g),y=i(40),b=n(y),_=i(35),x=n(_),w=i(49),M=n(w),z=s.default.extend("MountainChart",{init:function(t,e){this.name="mountainchart",this.components=[{component:c.default,placeholder:".vzb-tool-viz",model:["state.time","state.entities","state.marker","locale","ui"]},{component:h.default,placeholder:".vzb-tool-timeslider",model:["state.time","state.entities","state.marker","ui"]},{component:f.default,placeholder:".vzb-tool-dialogs",model:["state","ui","locale"]},{component:m.default,placeholder:".vzb-tool-buttonlist",model:["state","ui","locale"]},{component:v.default,placeholder:".vzb-tool-treemenu",model:["state.marker","state.marker_tags","state.time","locale"]},{component:b.default,placeholder:".vzb-tool-datawarning",model:["locale"]},{component:x.default,placeholder:".vzb-tool-datanotes",model:["state.marker","locale"]},{component:M.default,placeholder:".vzb-tool-stepped-speed-slider",model:["state.time","locale"]}],this._super(t,e)},default_model:{state:{time:{delay:100,delayThresholdX2:50,delayThresholdX4:25},entities:{opacitySelectDim:.3,opacityRegular:.7}},locale:{},ui:{chart:{manualSortingEnabled:!0,yMaxMethod:"latest",showProbeX:!0,probeX:1.85,xLogStops:[1,2,5],xPoints:50},buttons:["colors","find","stack","show","moreoptions","fullscreen","presentation"],dialogs:{popup:["colors","find","stack","show","moreoptions"],sidebar:["colors","find","stack"],moreoptions:["opacity","speed","stack","axesmc","colors","presentation","about"]},datawarning:{doubtDomain:[],doubtRange:[]},presentation:!1}}});e.default=z},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function r(t){return t&&t.__esModule?t:{default:t}}function a(t,e,i){return function(){var n=i.apply(e,arguments);return n===e?t:n}}Object.defineProperty(e,"__esModule",{value:!0});var o=i(71),s=r(o),l=i(1),c=n(l),u=i(15),h=r(u),d=i(2),f=r(d),p=i(47),m=r(p),g=i(72),v=r(g),y=i(46),b=r(y),_=i(34),x=r(_),w=i(211),M=r(w),z=i(212),S=function t(e,i,n){var r=h.default.get(e);if(r){var a=new r(i,n);return t._instances[a._id]=a,a}c.error('Tool "'+e+'" was not found.')};S._instances={},S._globals=x.default,S.clearInstances=function(t){if(t)S._instances[t]=void 0;else{for(var e in S._instances)S._instances[e].clear();S._instances={}}};var E=(0,s.default)(i(477));c.forEach(E,function(t,e){v.default.register(e,t)});var k=(0,s.default)(i(473),1);c.forEach(k,function(t,e){f.default.register(e,t)}),d3.rebind=function(t,e){for(var i=1,n=void 0,r=arguments.length;++i<r;)t[n=arguments[i]]=a(t,e,e[n]);return t},d3.scale={},d3.scale.linear=d3.scaleLinear,d3.scale.sqrt=d3.scaleSqrt,d3.scale.pow=d3.scalePow,d3.scale.log=d3.scaleLog,d3.scale.quantize=d3.scaleQuantize,d3.scale.threshold=d3.scaleThreshold,d3.scale.quantile=d3.scaleQuantile,d3.scale.identity=d3.scaleIdentity,d3.scale.ordinal=d3.scaleOrdinal,d3.time={},d3.time.scale=d3.scaleTime,d3.time.scale.utc=d3.scaleUtc,d3.time.format=function(t){var e=d3.timeFormat(t);return e.parse=d3.timeParse(t),e},d3.time.format.utc=function(t){var e=d3.utcFormat(t);return e.parse=d3.utcParse(t),e},d3.time.format.iso=function(t){var e=d3.isoFormat(t);return e.parse=d3.isoParse(t),e},d3.round=function(t,e){return e?Math.round(t*(e=Math.pow(10,e)))/e:Math.round(t)},d3.scale.genericLog=M.default,d3.selection.prototype.onTap=z.onTap,d3.selection.prototype.onLongTap=z.onLongTap,S.Tool=h.default,S.Component=f.default,S.Model=m.default,S.Reader=v.default,S.Events=b.default,S.utils=c,e.default=S},function(t,e,i){"use strict";(function(t){function e(t,e,i){t[e]||Object[n](t,e,{writable:!0,configurable:!0,value:i})}if(i(414),i(471),i(234),t._babelPolyfill)throw new Error("only one instance of babel-polyfill is allowed");t._babelPolyfill=!0;var n="defineProperty";e(String.prototype,"padLeft","".padStart),e(String.prototype,"padRight","".padEnd),"pop,reverse,shift,keys,values,entries,indexOf,every,some,forEach,map,filter,find,findIndex,includes,join,slice,concat,push,splice,unshift,sort,lastIndexOf,reduce,reduceRight,copyWithin,fill".split(",").forEach(function(t){[][t]&&e(Array,t,Function.call.bind([][t]))})}).call(e,i(85))},function(t,e){},,,,,,,,,,,,,,function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var r=i(16),a=n(r),o=a.default.extend({init:function(){this.intervals={}},setInterval:function(t){function e(e,i,n){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(t,e,i){this.clearInterval(t),this.intervals[t]=setInterval(e,i)}),clearInterval:function(t){function e(e){return t.apply(this,arguments)}return e.toString=function(){return t.toString()},e}(function(t){return t?clearInterval(this.intervals[t]):this.clearAllIntervals()}),clearAllIntervals:function(){for(var t in this.intervals)this.clearInterval(t)}});e.default=o},function(t,e,i){"use strict";function n(){return function(){function t(d){return null==r?void console.warn("D3 collision resolver stopped: missing data to work with. Example: data = {asi: {valueY: 45, valueX: 87}, ame: {valueY: 987, valueX: 767}}"):null==a?void console.warn("D3 collision resolver stopped: missing a CSS slector"):null==o?void console.warn("D3 collision resolver stopped: missing height of the canvas"):null==l?void console.warn("D3 collision resolver stopped: missing pointer within data objects. Example: value = 'valueY' "):null==h?void console.warn("D3 collision resolver stopped: missing a key for data. Example: key = 'geo' "):(d.each(function(t,e){i[t[h]]=d3.select(this).select(a).node().getBBox().height}),n=t.calculatePositions(r,l,o,s),void d.each(function(t,i){if(r[t[h]]&&!r[t[h]][c]){var o=n[t[h]]||s(r[t[h]][l])||0,d=null;return null!=u?void u(t,i,this,d,o):void d3.select(this).selectAll(a).transition().duration(e).attr("transform","translate(0,"+o+")")}}))}var e=300,i={},n={};t.calculatePositions=function(t,e,n,r){var a={},o=Object.keys(t).sort(function(i,n){return t[i][e]-t[n][e]});o.forEach(function(n,s){a[n]=r(t[n][e]);for(var l=s;l>0;l--){var c=a[o[l-1]]-a[o[l]]-i[o[l]];if(c<0&&(a[o[l-1]]-=c),c>0)break}});var s=n-a[o[0]]-i[o[0]];if(s<0){a[o[0]]+=s;for(var l=0;l<o.length-1&&(s=a[o[l]]-a[o[l+1]]-i[o[l+1]],s<0&&(a[o[l+1]]+=s),!(s>0));l++);}return a};var r=null;t.data=function(e){return arguments.length?(r=e,t):r};var a=null;t.selector=function(e){return arguments.length?(a=e,t):a};var o=null;t.height=function(e){return arguments.length?(o=e,t):o};var s=d3.scale.linear().domain([0,1]).range([0,1]);t.scale=function(e){return arguments.length?(s=e,t):s};var l=null;t.value=function(e){return arguments.length?(l=e,t):l};var c=null;t.fixed=function(e){return arguments.length?(c=e,t):c};var u=null;t.handleResult=function(e){return arguments.length?(u=e,t):u};var h=null;return t.KEY=function(e){return arguments.length?(h=e,t):h},t}()}Object.defineProperty(e,"__esModule",{value:!0}),e.default=n},function(t,e,i){"use strict";function n(){function t(){function t(){for(var t=[],i=0;i<a;i++){var h=o+(1-o)/a*i;t.push([]);for(var d=0;d<=n;d++){var f=r+(1-r)/n*d;t[i].push({display:e(f,0==d?u:s,0==i?l:h),meaning:e(f,0==d?u:s,0==i?c:h)})}}return t}function e(t,e,i){var n=void 0,r=void 0,a=void 0;if(0==e)n=r=a=i;else{var o=function(t,e,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?t+6*(e-t)*i:i<.5?e:i<2/3?t+(e-t)*(2/3-i)*6:t},s=i<.5?i*(1+e):i+e-i*e,l=2*i-s;n=o(l,s,t+1/3),r=o(l,s,t),a=o(l,s,t-1/3)}return"#"+Math.round(255*n).toString(16)+Math.round(255*r).toString(16)+Math.round(255*a).toString(16)}function i(e){if(i.container=e,w=e.select("."+y.COLOR_PICKER),w.empty()){e.on("click",function(){i.show(!1),d3.event.stopPropagation()}),b=t(),w=e.append("svg").style("position","absolute").style("top","0").style("left","0").style("width","100%").style("max-width",d+"px").style("height","100%").style("max-height",f+"px").style("z-index",9999).attr("class",y.COLOR_PICKER+" vzb-dialog-shadow").classed(y.INVISIBLE,!z).on("mouseout",function(t){A(m)});var n=parseInt(w.style("width")),r=parseInt(w.style("height")),o=n/2*(1-p.left-p.right);k=w.append("rect").attr("width",n).attr("height",f).attr("class",y.COLOR_BUTTON+" "+y.COLOR_BACKGR).on("mouseover",function(t){A(m)});var s=w.append("g").attr("class",y.COLOR_CIRCLES).attr("transform","translate("+(o+n*p.left)+","+(o+r*p.top)+")");w.append("rect").attr("class",y.COLOR_SAMPLE).attr("width",n/2).attr("height",r*p.top/2),S=w.append("rect").attr("class",y.COLOR_SAMPLE).attr("width",n/2).attr("x",n/2).attr("height",r*p.top/2),w.append("text").attr("x",n*p.left).attr("y",r*p.top/2).attr("dy","1.3em").attr("class",y.COLOR_SAMPLE).style("text-anchor","start"),E=w.append("text").attr("x",n*(1-p.right)).attr("y",r*p.top/2).attr("dy","1.3em").attr("class",y.COLOR_SAMPLE).style("text-anchor","end"),w.append("text").attr("x",.1*n).attr("y",r*(1-p.bottom)).attr("dy","1.2em").attr("class","vzb-default-label").style("text-anchor","start").text("default"),w.append("circle").attr("class",y.COLOR_DEFAULT+" "+y.COLOR_BUTTON).attr("r",n*p.left/2).attr("cx",n*p.left*1.5).attr("cy",r*(1-1.5*p.bottom)).on("mouseover",function(){d3.select(this).style("stroke","#444"),A(g)}).on("mouseout",function(){d3.select(this).style("stroke","none")}),s.selectAll("."+y.COLOR_CIRCLE).data(b).enter().append("g").attr("class",y.COLOR_CIRCLE).each(function(t,e){_.outerRadius(h+(o-h)/a*(a-e)).innerRadius(h+(o-h)/a*(a-e-1));var i=d3.select(this).selectAll("."+y.COLOR_SEGMENT).data(x(t)).enter().append("g").attr("class",y.COLOR_SEGMENT);i.append("path").attr("class",y.COLOR_BUTTON).attr("d",_).style("fill",function(t){return t.data.display}).style("stroke",function(t){return t.data.display}).on("mouseover",function(t){A(t.data.meaning,this)}).on("mouseout",function(t){I()})}),s.append("circle").attr("r",h).attr("fill",v).attr("class",y.COLOR_BUTTON).on("mouseover",function(){d3.select(this).style("stroke","#555"),A(v)}).on("mouseout",function(){d3.select(this).style("stroke","none")}),M=s.append("path").attr("class",y.COLOR_POINTER+" "+y.INVISIBLE),w.selectAll("."+y.COLOR_BUTTON).on("click",function(){d3.event.stopPropagation(),O.show(!1)}),P(w),i.resize(w)}}var n=15,r=0,a=4,o=.5,s=.7,l=.4,c=.3,u=0,h=15,d=280,f=323,p={top:.1,bottom:.1,left:.1,right:.1},m="#000",g="#000",v="#f8f8f8",y={INVISIBLE:"vzb-invisible",COLOR_POINTER:"vzb-colorpicker-pointer",COLOR_BUTTON:"vzb-colorpicker-cell",COLOR_DEFAULT:"vzb-colorpicker-default",COLOR_SAMPLE:"vzb-colorpicker-sample",COLOR_PICKER:"vzb-colorpicker-svg",COLOR_CIRCLE:"vzb-colorpicker-circle",COLOR_CIRCLES:"vzb-colorpicker-circles",COLOR_SEGMENT:"vzb-colorpicker-segment",COLOR_BACKGR:"vzb-colorpicker-background"},b=[],_=d3.arc(),x=d3.pie().sort(null).value(function(t){return 1}),w=null,M=null,z=!1,S=null,E=null,k=null,T=function(t){console.info("Color picker callback example. Setting color to "+t);
},P=function(t){t.select("."+y.COLOR_BACKGR).style("fill","white"),t.select("."+y.COLOR_POINTER).style("stroke-width",2).style("stroke",v).style("pointer-events","none").style("fill","none"),t.selectAll("."+y.COLOR_BUTTON).style("cursor","pointer"),t.selectAll("text").style("fill","#D9D9D9").style("font-size","0.7em").style("text-transform","uppercase"),t.selectAll("circle."+y.COLOR_BUTTON).style("stroke-width",2)},O=i,A=function(t,e){null!=e&&M.classed(y.INVISIBLE,!1).attr("d",d3.select(e).attr("d")),S.style("fill",t),E.text(t),T(t)},I=function(){M.classed(y.INVISIBLE,!0)},C="toggle";return i.show=function(t){return arguments.length?(null==w&&console.warn("Color picker is missing SVG element. Was init sequence performed?"),z=t==C?!z:t,z||(T=function(){}),void w.classed(y.INVISIBLE,!z)):z},i.nCellsH=function(t){return arguments.length?(n=t,i):n},i.minH=function(t){return arguments.length?(r=t,i):r},i.nCellsL=function(t){return arguments.length?(a=t,i):a},i.minL=function(t){return arguments.length?(o=t,i):o},i.outerL_display=function(t){return arguments.length?(l=t,i):l},i.outerL_meaning=function(t){return arguments.length?(c=t,i):c},i.satConstant=function(t){return arguments.length?(s=t,i):s},i.firstAngleSat=function(t){return arguments.length?(u=t,i):u},i.minRadius=function(t){return arguments.length?(h=t,i):h},i.margin=function(t){return arguments.length?(p=t,i):p},i.callback=function(t){return arguments.length?(T=t,i):T},i.colorDef=function(t){return arguments.length?("undefined"!=typeof t&&(g=t),null==w&&console.warn("Color picker is missing SVG element. Was init sequence performed?"),w.select("."+y.COLOR_DEFAULT).style("fill",g),i):g},i.translate=function(t){return t instanceof Function&&w.select(".vzb-default-label").text(t("colorpicker/default")),i},i.fitToScreen=function(t){var e=i.container.node().getBoundingClientRect(),n=void 0,r=void 0,a=parseInt(w.style("width")),o=parseInt(w.style("height"));t?(n=t[0]-e.left,r=t[1]-e.top):(n=e.width-parseInt(w.style("right"))-a,r=parseInt(w.style("top")));var s={left:""};return.8*e.width<=a?s.right=.5*(e.width-a)+"px":n+a>e.width?s.right=Math.min(.1*e.width,20)+"px":s.right=e.width-n-a+"px",s.right&&w.style("right",s.right),.8*e.height<=o?s.top=.5*(e.height-o)+"px":r+1.2*o>e.height?s.top=.9*e.height-o+"px":s.top=r+"px",s.top&&w.style("top",s.top),w.style("left",s.left),i},i.colorOld=function(t){return arguments.length?(m=t,null==w&&console.warn("Color picker is missing SVG element. Was init sequence performed?"),w.select("rect."+y.COLOR_SAMPLE).style("fill",m),w.select("text."+y.COLOR_SAMPLE).text(m),i):m},i.resize=function(t){if(!arguments.length)return resize;if("undefined"!=typeof t){var e=t,n=parseInt(e.style("width")),r=parseInt(e.style("height")),a=n/2*(1-p.left-p.right),o=e.select("."+y.COLOR_DEFAULT),s=e.select(".vzb-default-label"),l=e.select("."+y.COLOR_CIRCLES),c=a+r*p.top,u=(1+.5*p.top)*r*.5;c=c>u?u:c,l.attr("transform","translate("+(a+n*p.left)+","+c+")"),o.attr("cx",n*p.left*1.5).attr("cy",r*(1-1.5*p.bottom)),s.attr("x",.1*n).attr("y",r*(1-p.bottom))}return i.fitToScreen(),i},i}return function(){return null==r&&(r=t()),r}()}Object.defineProperty(e,"__esModule",{value:!0}),e.default=n;var r=null},function(t,e,i){"use strict";function n(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}function r(){return function t(e){function i(t){var e=y(t);return u?u(e.scale(t*e.sign)):e.scale(t*e.sign)}var r=[],a=[],o=.1,s=5,l=e.domain(),c=e.range(),u=null,h=void 0,d=void 0,f=function(t){return t instanceof Array?t.map(function(t){return Math.abs(t)}):Math.abs(t)},p=function(t,e){return{domain:t,sign:1,range:e,scale:d3.scale.linear().domain(t).range(e)}},m=function(t,e,i){var n=t;return i&&(n=f(t)),{domain:t,sign:i?-1:1,range:e,scale:d3.scale.log().domain(n).range(e)}},g=function(){h=c[0]<c[c.length-1];var t=h?1:-1;if(r=[],1==a.length)r=a[0][0]<=0&&a[0][1]>=0?[p(a[0],c)]:[m(a[0],c,a[0][0]<=0)];else{var i=d3.max(f(l)),n=f(d3.max(c)-d3.min(c)),u=1,g=0,v=0,y=0,b=0;e.domain([o,i]).range([0,n]);var _=s;0!=l[0]&&f(l[0])>o&&(g=e(f(l[0]))),0!=l[l.length-1]&&f(l.length-1)>o&&(v=e(f(l[l.length-1]))),f(l[0])>o&&(y=_),f(l[l.length-1])>o&&(b=_),n=n-y-b,0!=v&&(u=f(g/v));var x=void 0,w=void 0;2==a.length?0==l[0]||f(l[0])<=o?(x=c[0]+g*u*t+b*t,r=[p(a[0],[c[0],x]),m(a[1],[x,c[c.length-1]],!d)]):(0==l[l.length-1]||f(l[l.length-1])<=o)&&(x=c[c.length-1]-(y+b)*u*t,r=[m(a[0],[c[0],x],d),p(a[1],[x,c[c.length-1]])]):(x=c[0]+n/(1/u+1)*t,w=c[0]+(n/(1/u+1)+y+b)*t,r=[m(a[0],[c[0],x],d),p(a[1],[x,w]),m(a[2],[w,c[c.length-1]],!d)])}},v=function(){if(d=l[0]<l[l.length-1],a=[],d3.min(l)>0&&d3.max(l)>0||d3.min(l)<0&&d3.max(l)<0)a=[l];else{var t=void 0,e=void 0;d?(t=l[0],e=l[l.length-1]):(t=l[l.length-1],e=l[0]);for(var i=function(t,e){d?a.push([t,e]):a.unshift([e,t])};t!=e;)e<=-o||t>=-o&&e<=o||t>=o?(i(t,e),t=e):t<-o&&e>=-o?(i(t,-o),t=-o):t>=-o&&e>=o?(i(t,o),t=o):(console.warn("Something wrong while build subdomains: "+t+" "+e),t=e)}g()},y=function(t){if(d){if(t<l[0])return r[0];if(t>l[l.length-1])return r[r.length-1];for(var e=0;e<r.length;e++)if(t>=r[e].domain[0]&&t<=r[e].domain[r[e].domain.length-1])return r[e]}else{if(t>l[0])return r[0];if(t<l[l.length-1])return r[r.length-1];for(var i=0;i<r.length;i++)if(t<=r[i].domain[0]&&t>=r[i].domain[r[i].domain.length-1])return r[i]}},b=function(t){if(h){if(t<c[0])return r[0];if(t>c[c.length-1])return r[r.length-1];for(var e=0;e<r.length;e++)if(t>=r[e].range[0]&&t<=r[e].range[r[e].range.length-1])return r[e]}else{if(t>c[0])return r[0];if(t<c[c.length-1])return r[r.length-1];for(var i=0;i<r.length;i++)if(t<=r[i].range[0]&&t>=r[i].range[1])return r[i]}};return Math.sign=Math.sign||function(t){return t=+t,0===t||isNaN(t)?t:t>0?1:-1},i.eps=function(t){return arguments.length?(o=t,i.domain(l),i):o},i.delta=function(t){return arguments.length?(s=t,i.range(c),i):s},i.domain=function(t){if(!arguments.length)return l;switch(t.length){case 0:t=l;break;case 1:t=[t[0]/2,2*t[0]]}t[0]==t[t.length-1]&&(t[0]/=2,t[t.length-1]=2*t[t.length-1]),l=t;var e=d3.min(f(l).filter(function(t){return!!t}));return e&&(o=Math.min(o,e/100)),v(),i},i.range=function(t,e){if(!arguments.length)return u?u.range():c;switch(t.length){case 0:t=c;break;case 1:t=[t[0]-100,t[0]+100]}if(u&&!e)u.range(t);else{c=t;var n=d3.min(f(c).filter(function(t){return!!t}));n&&(s=Math.min(s,n/100)),g()}return i},i.interpolate=function(t){return u=d3.scale.linear().domain(l).range(c).interpolate(t),i.range(u.domain(),!0),i},i.invert=function(t){var e=b(t);return e.scale.invert(t)*e.sign},i.ticks=function(t){for(var e=void 0,i=[],a=0;a<r.length;a++)e=r[a].sign==-1?r[a].scale.ticks().reverse().map(function(t){return t*-1}):r[a].scale.ticks(),i.length>0&&e.length>0&&i[i.length-1]==e[0]&&e.splice(0,1),i.push.apply(i,n(e));return i},i.copy=function(){return t(e).domain(l).range(c).delta(s).eps(o)},d3.rebind(i,e,"base","rangeRound","clamp","nice","tickFormat")}(d3.scale.log().domain([.1,200]).range([0,1e3]))}Object.defineProperty(e,"__esModule",{value:!0}),e.default=r},function(t,e,i){"use strict";function n(t,e,i){var n,r,a,o=e?".onTap":".onLongTap";d3.select(t).on("touchstart"+o,function(t,e){n=d3.event.timeStamp,r=d3.event.changedTouches[0].screenX,a=d3.event.changedTouches[0].screenY}).on("touchend"+o,function(t,o){return r=Math.abs(r-d3.event.changedTouches[0].screenX),a=Math.abs(a-d3.event.changedTouches[0].screenY),r<5&&a<5?d3.event.timeStamp-n<500?e?e(t,o):void 0:i?i(t,o):void 0:void 0})}Object.defineProperty(e,"__esModule",{value:!0});var r=function(t){return this.each(function(){n(this,t)})},a=function(t){return this.each(function(){n(this,null,t)})};e.default={onTap:r,onLongTap:a},e.onTap=r,e.onLongTap=a},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}Object.defineProperty(e,"__esModule",{value:!0});var a=function(){function t(t,e){var i=[],n=!0,r=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done)&&(i.push(o.value),!e||i.length!==e);n=!0);}catch(t){r=!0,a=t}finally{try{!n&&s.return&&s.return()}finally{if(r)throw a}}return i}return function(e,i){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o=i(152),s=n(o),l=(i(1),s.default.extend({_name:"csv-time_in_columns",init:function(t){this._super(t),this.timeKey="time"},load:function(){var t=this;return this._super().then(function(e){var i=e.data,n=e.columns,o=n[t.keySize],s=i.reduce(function(t,e){return Object.keys(e).forEach(function(i){i=i===o?e[o]:i,Number(i)==i||t.includes(i)||t.push(i)}),t},[]);s.splice(1,0,t.timeKey);var l=s.slice(2),c=a(s,1),u=c[0];return{columns:s,data:i.reduce(function(e,i){var n=e.filter(function(t){return t[u]===i[u]});return n.length?n.forEach(function(e){e[i[o]]=i[e[t.timeKey]]}):Object.keys(i).forEach(function(n){if(![u,o].includes(n)){var a;e.push(Object.assign((a={},r(a,u,i[u]),r(a,t.timeKey,n),a),l.reduce(function(t,e){return t[e]=i[o]===e?i[n]:null,t},{})))}}),e},[])}})}}));e.default=l},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var r=i(72),a=n(r),o=a.default.extend({_name:"inline",init:function(t){this._data=t.data||[{}]},load:function(){return Promise.resolve({columns:Object.keys(this._data[0]),data:this._data})}});e.default=o},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function a(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}Object.defineProperty(e,"__esModule",{value:!0});var o=i(1),s=r(o),l=i(2),c=n(l),u=i(41),h=n(u),d=i(10),f=c.default.extend({init:function(t,e){this.name="agepyramid",this.template=i(457),this.model_expects=[{name:"time",type:"time"},{name:"marker",type:"model"},{name:"entities",type:"entities"},{name:"entities_side",type:"entities"},{name:"locale",type:"locale"},{name:"ui",type:"ui"}];var n=this;this.model_binds={"change:time.value":function(t){if(n._readyOnce){if(1!=n.model.time.step&&!n.snapped&&!n.model.time.playing&&!n.model.time.dragging){var e=d3.bisectLeft(n.timeSteps,n.model.time.value);if(0!=e&&n.timeSteps[e]-n.model.time.value){n.snapped=!0;var i=n.model.time.value,r=n.timeSteps[e-1];e=n.timeSteps[e];var a=i-r<e-i?r:e;n.model.time.value=new Date(a)}}n.snapped||(n.timeSteps.filter(function(t){return t-n.model.time.value==0}).length?n.model.marker.getFrame(n.model.time.value,function(t){n.frame=t,n.frameAxisX=t.axis_x,n._updateEntities(),n.updateBarsOpacity()}):!function(){var t=d3.bisectLeft(n.timeSteps,n.model.time.value),e=n.timeSteps[t-1],i=n.timeSteps[t],r=(n.model.time.value-e)/(i-e);n.model.marker.getFrame(i,function(t){n.model.marker.getFrame(e,function(e){n.frameAxisX=n.interpolateDiagonal(e.axis_x,t.axis_x,r),n._updateEntities(),n.updateBarsOpacity()})})}()),n.snapped=!1}},"change:marker.select":function(t){n.someSelected=n.model.marker.select.length>0,n.nonSelectedOpacityZero=!1},"change:marker.highlight":function(t,e){n._readyOnce&&n._highlightBars()},"change:marker.opacitySelectDim":function(){n.updateBarsOpacity()},"change:marker.opacityRegular":function(){n.updateBarsOpacity()},"change:marker.color.palette":function(t){n._readyOnce&&n._updateEntities()},"change:marker.color.scaleType":function(t){n._readyOnce&&n._updateEntities()},"change:marker.side.which":function(t){if(n._readyOnce){var e="constant"==n.model.marker.side.use?null:n.model.marker.side.which;n.model.marker.side.clearSideState(),n.model.entities_side.clearShow(),n.model.entities_side.set("dim",e)}},"change:entities.show":function(t){n._readyOnce&&(n.model.entities.dim!==n.model.entities_side.dim||s.isEmpty(n.model.entities.show)||s.isEmpty(n.model.entities_side.show)||s.forEach(n.model.entities_side.getFilteredEntities(),function(t){n.model.entities.isShown(t)||(n.model.marker.side.clearSideState(),n.model.entities_side.showEntity(t))}))},"change:entities_side.show":function(t){if(n._readyOnce){var e=!1,i=null;s.forEach(n.model.marker.side._space,function(t){t.dim===n.model.entities_side.dim&&t._name!==n.model.entities_side._name&&(i=t)}),i&&!s.isEmpty(i.show)&&s.forEach(n.model.entities_side.getFilteredEntities(),function(t){i.isShown(t)||(i.showEntity(t),e=!0)}),e||(n._updateIndicators(),n._updateLimits(),n.resize(),n._updateEntities())}},"change:ui.chart.inpercent":function(t){n._readyOnce&&(n._updateLimits(),n.resize(),n._updateEntities())},"change:ui.chart.flipSides":function(t){n._readyOnce&&(n.model.marker.side.switchSideState(),n._updateIndicators(),n.resize(),n._updateEntities())}},this._super(t,e),this.xScale=null,this.yScale=null,this.cScale=null,this.xAxis=(0,h.default)("bottom"),this.xAxisLeft=(0,h.default)("bottom"),this.yAxis=(0,h.default)("left"),this.xScales=[],this.SHIFTEDAGEDIM="s_age",this.totalFieldName="Total"},readyOnce:function(){var t=this;this.el=this.el?this.el:d3.select(this.element),this.element=this.el,this.interaction=this._interaction(),this.graph=this.element.select(".vzb-bc-graph"),this.yAxisEl=this.graph.select(".vzb-bc-axis-y"),this.xAxisEl=this.graph.select(".vzb-bc-axis-x"),this.xAxisLeftEl=this.graph.select(".vzb-bc-axis-x-left"),this.xTitleEl=this.element.select(".vzb-bc-axis-x-title"),this.xInfoEl=this.element.select(".vzb-bc-axis-x-info"),this.yTitleEl=this.graph.select(".vzb-bc-axis-y-title"),this.barsCrop=this.graph.select(".vzb-bc-bars-crop"),this.labelsCrop=this.graph.select(".vzb-bc-labels-crop"),this.bars=this.graph.select(".vzb-bc-bars"),this.labels=this.graph.select(".vzb-bc-labels"),this.title=this.element.select(".vzb-bc-title"),this.titleRight=this.element.select(".vzb-bc-title-right"),this.year=this.element.select(".vzb-bc-year"),this.on("resize",function(){t._updateEntities()}),this._attributeUpdaters={_newWidth:function(e,i){e.x_=0;var n=void 0;return n=t.stackSkip?e[t.PREFIXEDSIDEDIM]==e[t.PREFIXEDSTACKDIM]?t.frameAxisX[e[t.PREFIXEDSIDEDIM]][e[t.AGEDIM]+t.ageShift]:0:t.sideSkip?t.frameAxisX[e[t.PREFIXEDSTACKDIM]][e[t.AGEDIM]+t.ageShift]:t.frameAxisX[e[t.PREFIXEDSTACKDIM]][e[t.PREFIXEDSIDEDIM]][e[t.AGEDIM]+t.ageShift],e.width_=n?t.xScale(n):0,t.ui.chart.inpercent&&(e.width_/=t.total[e[t.PREFIXEDSIDEDIM]]),e.width_},_newX:function(t,e){var i=this.previousSibling;if(i){var n=d3.select(i).datum();t.x_=n.x_+n.width_}else t.x_=0;return t.x_}}},ready:function(){if(this.model.marker._ready){var t=this;this.timeSteps=this.model.time.getAllSteps(),this.shiftScale=d3.scale.linear().domain([this.timeSteps[0],this.timeSteps[this.timeSteps.length-1]]).range([0,this.timeSteps.length-1]),this.side=this.model.marker.label_side.getEntity(),this.SIDEDIM=this.side.getDimension(),this.PREFIXEDSIDEDIM="side_"+this.SIDEDIM,this.stack=this.model.marker.label_stack.getEntity(),this.STACKDIM=this.stack.getDimension()||this.model.marker.color.which,this.PREFIXEDSTACKDIM="stack_"+this.STACKDIM,this.age=this.model.marker.axis_y.getEntity(),this.AGEDIM=this.age.getDimension(),this.TIMEDIM=this.model.time.getDimension(),this.groupBy=this.age.grouping||1,this.stackSkip=this.STACKDIM==this.SIDEDIM,this.sideSkip="constant"==t.model.marker.side.use,this.updateUIStrings(),this._updateIndicators(),this.model.marker.getFrame(t.model.time.value,function(e){t.frame=e,t.frameAxisX=e.axis_x,t._createLimits(),t._updateLimits(),t.resize(),t._updateEntities(!0),t.updateBarsOpacity()})}},interpolateDiagonal:function(t,e,i){var n=this,r={},a=void 0,o=void 0,l=void 0,c=void 0,u=this.groupBy;return this.stackSkip?s.forEach(n.sideKeys,function(h){a=r[h]={},s.forEach(n.ageKeys,function(n){c=+n+u,o=t[h][n],l=e[h][c]||0,a[c]=null==o||null==l?null:o+(l-o)*i}),a[0]=e[h][0]||0}):this.sideSkip?s.forEach(n.stackKeys,function(h){a=r[h]={},s.forEach(n.ageKeys,function(n){c=+n+u,o=t[h][n],l=e[h][c]||0,a[c]=null==o||null==l?null:o+(l-o)*i}),a[0]=e[h][0]||0}):s.forEach(n.stackKeys,function(h){r[h]={},s.forEach(n.sideKeys,function(d){a=r[h][d]={},s.forEach(n.ageKeys,function(n){c=+n+u,o=t[h][d][n],l=e[h][d][c]||0,a[c]=null==o||null==l?null:o+(l-o)*i}),a[0]=e[h][d][0]||0})}),r},updateUIStrings:function(){var t=this;this.translator=this.model.locale.getTFunction();var e=this.model.marker.axis_x.getConceptprops().name,i=this.xTitleEl.selectAll("text").data([0]);i.enter().append("text"),i.text(e).on("click",function(){t.parent.findChildByName("gapminder-treemenu").markerID("axis_x").alignX(t.model.locale.isRTL()?"right":"left").alignY("top").updateView().toggle()}),s.setIcon(this.xInfoEl,d.question).select("svg").attr("width","0px").attr("height","0px"),this.xInfoEl.on("click",function(){t.parent.findChildByName("gapminder-datanotes").pin()}),this.xInfoEl.on("mouseover",function(){if(!t.model.time.dragging){var e=this.getBBox(),i=s.makeAbsoluteContext(this,this.farthestViewportElement)(e.x-10,e.y+e.height+10),n=t.root.element.getBoundingClientRect(),r=t.element.node().getBoundingClientRect();t.parent.findChildByName("gapminder-datanotes").setHook("axis_x").show().setPos(i.x+r.left-n.left,i.y)}}),this.xInfoEl.on("mouseout",function(){t.model.time.dragging||t.parent.findChildByName("gapminder-datanotes").hide()})},_updateIndicators:function(){var t=this,e=this;this.duration=this.model.time.delayAnimations,this.yScale=this.model.marker.axis_y.getScale(),this.xScale=this.model.marker.axis_x.getScale(),this.yAxis.tickFormat(e.model.marker.axis_y.getTickFormatter()),this.xAxis.tickFormat(e.model.marker.axis_x.getTickFormatter()),this.xAxisLeft.tickFormat(e.model.marker.axis_x.getTickFormatter());var i=this.SIDEDIM,n=this.STACKDIM,r=this.AGEDIM,a=this.groupBy,o=this.model.marker.getKeys(r),l=[];l=o.map(function(t){return t[r]}),this.ageKeys=l,this.shiftedAgeKeys=this.timeSteps.map(function(t,e){return-e*a}).slice(1).reverse().concat(l);var c=this.model.marker.label_side.getItems(),u=[];s.isEmpty(c)||!function(){var e=!!t.model.marker.side.getEntity().show[i],n=t.model.marker.getKeys(i).filter(function(i){return!e||t.model.marker.side.getEntity().isShown(i)});if(u=n.map(function(t){return t[i]}),u.length>2&&(u.length=2),u.length>1){var r=t.ui.chart.flipSides?d3.ascending:d3.descending;u.sort(r)}}(),u.length||u.push("undefined"),this.sideKeys=u;var h=this.model.marker.getKeys(n),d=s.without(h.map(function(t){return t[n]==e.totalFieldName&&(e.dataWithTotal=!0),t[n]}),this.totalFieldName),f=s.keys(this.model.marker.color.getPalette()).reduce(function(t,e){return d.indexOf(e)!=-1&&t.push(e),t},[]);if(f.length!=d.length&&(f=d.reduce(function(t,e){return t.indexOf(e)==-1&&t.push(e),t},f)),this.stackKeys=f,this.stackItems=this.model.marker.label_stack.getItems(),this.stacked=this.ui.chart.stacked&&"constant"!=this.model.marker.color.use&&this.stack.getDimension(),this.twoSided=this.sideKeys.length>1,this.titleRight.classed("vzb-hidden",!this.twoSided),this.twoSided)this.xScaleLeft=this.xScale.copy(),this.title.text(c[this.sideKeys[1]]),this.titleRight.text(c[this.sideKeys[0]]);else{var p=this.sideKeys.length&&c[this.sideKeys[0]]?c[this.sideKeys[0]]:"";this.title.text(p)}this.cScale=this.model.marker.color.getScale();this.SHIFTEDAGEDIM;this.markers=this.model.marker.getKeys(r)},_createLimits:function(){var t=this,e=this.model.marker.axis_x,i=Object.keys(this.model.marker.side.getItems());i.length||i.push("undefined");var n=this.sideSkip?[this.STACKDIM]:this.stackSkip?[this.SIDEDIM]:[this.STACKDIM,this.SIDEDIM],r=e.getLimitsByDimensions(n.concat([this.AGEDIM,this.TIMEDIM])),o=e.getUnique(),l={},c={},u={};i.forEach(function(t){u[t]=[],c[t]=[]}),t.sideSkip?s.forEach(o,function(e){l[e]={};var n=0,a=[];s.forEach(t.ageKeys,function(i){var o=0;s.forEach(t.stackKeys,function(t){r[t]&&r[t][i]&&r[t][i][e]&&(o+=r[t][i][e].max,n+=o)}),a.push(o)}),l[e][i[0]]=n;var o=Math.max.apply(Math,a);c[i[0]].push(o/n),u[i[0]].push(o)}):t.stackSkip?s.forEach(o,function(e){l[e]={},s.forEach(i,function(i){var n=0,a=[];s.forEach(t.ageKeys,function(t){var o=0;r[i]&&r[i][t]&&r[i][t][e]&&(o+=r[i][t][e].max,n+=o),a.push(o)}),l[e][i]=n;var o=Math.max.apply(Math,a);c[i].push(o/n),u[i].push(o)})}):s.forEach(o,function(e){l[e]={},s.forEach(i,function(i){var n=0,a=[];s.forEach(t.ageKeys,function(o){var l=0;s.forEach(t.stackKeys,function(t){r[t][i]&&r[t][i][o]&&r[t][i][o][e]&&(l+=r[t][i][o][e].max,n+=l)}),a.push(l)}),l[e][i]=n;var o=Math.max.apply(Math,a);c[i].push(o/n),u[i].push(o)})}),this.maxLimits={},this.inpercentMaxLimits={},i.forEach(function(e){t.maxLimits[e]=Math.max.apply(Math,a(u[e])),t.inpercentMaxLimits[e]=Math.max.apply(Math,a(c[e]))}),this.totals=l},_updateLimits:function(){var t=this,e=this.model.marker.axis_x,i=void 0;i=this.ui.chart.inpercent?[0,Math.max.apply(Math,a(this.sideKeys.map(function(e){return t.inpercentMaxLimits[e]})))]:null!=e.domainMin&&null!=e.domainMax?[+e.domainMin,+e.domainMax]:[0,Math.max.apply(Math,a(this.sideKeys.map(function(e){return t.maxLimits[e]})))],this.xScale.domain(i),this.xScaleLeft&&this.xScaleLeft.domain(this.xScale.domain())},_interpolateBetweenTotals:function(t,e,i){var n=d3.bisectLeft(t,i),r=(i-t[n-1])/(t[n]-t[n-1]),a={};return s.forEach(this.sideKeys,function(i){a[i]=e[t[n]][i]*r+e[t[n-1]][i]*(1-r)}),a},_updateEntities:function(t){var e=this,i=this.model.time,n=this.SIDEDIM,r=this.PREFIXEDSIDEDIM,a=this.AGEDIM,o=this.STACKDIM,s=this.PREFIXEDSTACKDIM,l=(this.TIMEDIM,i.playing?i.delayAnimations:0),c=this.groupBy;this.ui.chart.inpercent&&(this.total=this.totals[i.value]?this.totals[i.value]:this._interpolateBetweenTotals(this.timeSteps,this.totals,i.value));var u=this.yScale.domain(),h=d3.bisectLeft(this.timeSteps,i.value),d=this.SHIFTEDAGEDIM,f=this.markers.map(function(t){var e={};return e[a]=e[d]=+t[a],e[a]-=h*c,e}),p=f.slice(0),m={};m[d]=f.length*c,m[a]=m[d]-h*c,this.ageShift=h*c,h&&p.push(m),this.entityBars=this.bars.selectAll(".vzb-bc-bar").data(p,function(t){return t[a]}),this.entityBars.exit().remove();var g=this.oneBarHeight,v=this.barHeight,y=this.firstBarOffsetY;this.entityBars=this.entityBars.enter().append("g").attr("class",function(t){return"vzb-bc-bar vzb-bc-bar-"+t[a]}).attr("transform",function(t,e){return"translate(0,"+(y-(t[d]-u[0]-c)*g)+")"}).merge(this.entityBars),this.sideBars=this.entityBars.selectAll(".vzb-bc-side").data(function(t){return e.sideKeys.map(function(e){var i={};return i[a]=t[a],i[d]=t[d],i[r]=e,i[n]=e,i})},function(t){return t[r]}),this.sideBars.exit().remove(),this.sideBars=this.sideBars.enter().append("g").attr("class",function(t,i){return"vzb-bc-side vzb-bc-side-"+(!i!=!e.twoSided?"right":"left")}).merge(this.sideBars),this.sideBars.attr("transform",function(t,i){return i?"scale(-1,1) translate("+e.activeProfile.centerWidth+",0)":""}),t&&this.sideBars.attr("transform",function(t,i){return i?"scale(-1,1) translate("+e.activeProfile.centerWidth+",0)":""});var b=this._attributeUpdaters;this.stackBars=this.sideBars.selectAll(".vzb-bc-stack").data(function(t,i){var l=e.stacked?e.stackKeys:[e.totalFieldName];return l.map(function(e){var i={};return i[a]=t[a],i[d]=t[d],i[n]=t[n],i[o]=e,i[r]=t[r],i[s]=e,i})},function(t){return t[s]}),this.stackBars.exit().remove(),this.stackBars=this.stackBars.enter().append("rect").attr("class",function(t,i){return"vzb-bc-stack vzb-bc-stack-"+i+(e.highlighted?" vzb-dimmed":"")}).attr("y",0).attr("height",v).attr("fill",function(t){return e.cScale(t[s])}).attr("width",b._newWidth).attr("x",b._newX).on("mouseover",e.interaction.mouseover).on("mouseout",e.interaction.mouseout).on("click",e.interaction.click).onTap(e.interaction.tap).merge(this.stackBars),t&&this.stackBars.order();var _=p[0][d]-p[0][a]-this.shiftScale(i.value)*c;if(l){var x=d3.transition().duration(l).ease(d3.easeLinear);this.entityBars.transition(x).attr("transform",function(t,e){return"translate(0,"+(y-(t[d]-u[0]-_)*g)+")"}),this.stackBars.transition(x).attr("width",b._newWidth).attr("x",b._newX)}else this.entityBars.interrupt().attr("transform",function(t,e){return"translate(0,"+(y-(t[d]-u[0]-_)*g)+")"}),this.stackBars.interrupt().attr("width",b._newWidth).attr("x",b._newX);this.entityLabels=this.labels.selectAll(".vzb-bc-label").data(f),this.entityLabels.exit().remove(),this.entityLabels.enter().append("g").attr("class","vzb-bc-label").attr("id",function(t){return"vzb-bc-label-"+t[d]+"-"+e._id}).append("text").attr("class","vzb-bc-age").merge(this.entityLabels).each(function(t,i){var n=e.translator("agepyramid/yearOlds"),r=parseInt(t[a],10);c>1&&(r=r+"-to-"+(r+c-1)),t.text=r+n}).attr("y",function(t,e){return y-(t[d]-u[0])*g-10}),l?this.year.transition().duration(l).ease(d3.easeLinear).on("end",this._setYear(i.value)):this.year.interrupt().text(i.formatDate(i.value)).transition()},_setYear:function(t){var e=this.model.time.formatDate(t);return function(){d3.select(this).text(e)}},_interaction:function(){var t=this;return{mouseover:function(e,i){s.isTouchDevice()||(t.model.marker.highlightMarker(e),t._showLabel(e))},mouseout:function(e,i){s.isTouchDevice()||t.model.marker.clearHighlighted()},click:function(e,i){s.isTouchDevice()||t.model.marker.selectMarker(e)},tap:function(e){d3.event.stopPropagation(),t.model.marker.selectMarker(e)}}},_highlightBars:function(t){var e=this;e.someHighlighted=e.model.marker.highlight.length>0,e.updateBarsOpacity(),e.someHighlighted||e.labels.selectAll(".vzb-hovered").classed("vzb-hovered",!1)},_showLabel:function(t){var e=this,i=e.ui.chart.inpercent?d3.format(".1%"):e.model.marker.axis_x.getTickFormatter(),n=e.SIDEDIM,r=(e.AGEDIM,e.STACKDIM),a="s_age",o=e.sideKeys.indexOf(t[n]),s=e.labels.select("#vzb-bc-label-"+t[a]+"-"+e._id);s.selectAll(".vzb-bc-age").text(function(n){var a=e.stackKeys.length>1?e.stackItems[t[r]]:n.text;a=e.twoSided?a:n.text+" "+e.stackItems[t[r]];var o=e.xScale.invert(t.width_);return a+": "+i(o)}).attr("x",(o?-1:1)*(.5*e.activeProfile.centerWidth+7)).classed("vzb-text-left",o),s.classed("vzb-hovered",!0)},presentationProfileChanges:{medium:{margin:{right:80,bottom:80},infoElHeight:32},large:{margin:{top:100,right:100,left:100,bottom:80},infoElHeight:32}},profiles:{small:{margin:{top:70,right:20,left:40,bottom:40},infoElHeight:16,minRadius:2,maxRadius:40,centerWidth:2,titlesSpacing:5},medium:{margin:{top:80,right:60,left:60,bottom:40},infoElHeight:20,minRadius:3,maxRadius:60,centerWidth:2,titlesSpacing:10},large:{margin:{top:100,right:60,left:60,bottom:40},infoElHeight:22,minRadius:4,maxRadius:80,centerWidth:2,titlesSpacing:20}},resize:function(){var t=this;this.activeProfile=this.getActiveProfile(this.profiles,this.presentationProfileChanges);var e=this.activeProfile.margin,i=this.activeProfile.infoElHeight;if(this.height=parseInt(this.element.style("height"),10)-e.top-e.bottom||0,this.width=parseInt(this.element.style("width"),10)-e.left-e.right||0,this.height<=0||this.width<=0)return s.warn("Pop by age resize() abort: vizabi container is too little or has display:none");this.graph.attr("transform","translate("+e.left+","+e.top+")"),this.barsCrop.attr("width",this.width).attr("height",Math.max(0,this.height)),this.labelsCrop.attr("width",this.width).attr("height",Math.max(0,this.height));var n=this.groupBy,r=this.yScale.domain();this.oneBarHeight=this.height/(r[1]-r[0]);var a=this.barHeight=this.oneBarHeight*n;this.firstBarOffsetY=this.height-this.barHeight,this.stackBars&&this.stackBars.attr("height",a),this.sideBars&&this.sideBars.attr("transform",function(e,i){return i?"scale(-1,1) translate("+t.activeProfile.centerWidth+",0)":""}),"ordinal"!==this.model.marker.axis_y.scaleType?this.yScale.range([this.height,0]):this.yScale.rangePoints([this.height,0]).range();var o=this.twoSided?.5*(this.width-this.activeProfile.centerWidth):this.width;"ordinal"!==this.model.marker.axis_x.scaleType?this.xScale.range([0,o]):this.xScale.rangePoints([0,o]).range(),this.yAxis.scale(this.yScale).tickSizeInner(-this.width).tickSizeOuter(0).tickPadding(6).tickSizeMinor(-this.width,0).labelerOptions({scaleType:this.model.marker.axis_y.scaleType,toolMargin:e,limitMaxTickNumber:19});var l=this.ui.chart.inpercent?d3.format((n>3?"":".1")+"%"):this.model.marker.axis_x.getTickFormatter();this.xAxis.scale(this.xScale).tickFormat(l).tickSizeInner(-this.height).tickSizeOuter(0).tickPadding(6).tickSizeMinor(-this.height,0).labelerOptions({scaleType:this.model.marker.axis_x.scaleType,toolMargin:e,limitMaxTickNumber:6});var c=this.twoSided?.5*(this.width+t.activeProfile.centerWidth):0;if(this.xAxisEl.attr("transform","translate("+c+","+this.height+")").call(this.xAxis),this.yAxisEl.attr("transform","translate(0,0)").call(this.yAxis),this.xAxisLeftEl.classed("vzb-hidden",!this.twoSided),this.twoSided){"ordinal"!==this.model.marker.axis_x.scaleType?this.xScaleLeft.range([.5*(this.width-this.activeProfile.centerWidth),0]):this.xScaleLeft.rangePoints([.5*(this.width-this.activeProfile.centerWidth),0]).range(),this.xAxisLeft.scale(this.xScaleLeft).tickFormat(l).tickSizeInner(-this.height).tickSizeOuter(0).tickPadding(6).tickSizeMinor(-this.height,0).labelerOptions({scaleType:this.model.marker.axis_x.scaleType,toolMargin:e,limitMaxTickNumber:6}),this.xAxisLeftEl.attr("transform","translate(0,"+this.height+")").call(this.xAxisLeft);var u=this.xAxisEl.select(".tick text");if(!u.empty()){var h=u.node().getBBox().width;u.attr("dx",.5*-(this.activeProfile.centerWidth+h))}}var d=this.model.locale.isRTL();if(this.bars.attr("transform","translate("+c+",0)"),this.labels.attr("transform","translate("+c+",0)"),this.title.attr("x",e.left+(this.twoSided?c-this.activeProfile.titlesSpacing:0)).style("text-anchor",this.twoSided?"end":"").attr("y",.7*e.top),this.titleRight.attr("x",e.left+c+this.activeProfile.titlesSpacing).attr("y",.7*e.top),this.xTitleEl.style("font-size",i+"px").attr("transform","translate("+(d?this.width:.4*e.left)+","+.4*e.top+")"),this.xInfoEl.select("svg").node()){var f=this.xTitleEl.node().getBBox(),p=s.transform(this.xTitleEl.node()),m=d?f.x+p.translateX-1.4*i:f.x+p.translateX+f.width+.4*i;this.xInfoEl.select("svg").attr("width",i+"px").attr("height",i+"px"),this.xInfoEl.attr("transform","translate("+m+","+(p.translateY-.8*i)+")")}this.year.attr("x",this.width+e.left).attr("y",.4*e.top)},updateBarsOpacity:function(t){var e=this,i=1,n=this.model.marker.opacityHighlightDim,r=this.model.marker.opacityRegular,a=this.model.marker.opacityRegular,o=this.model.marker.opacitySelectDim;this.stackBars.style("opacity",function(t){return e.someHighlighted&&e.model.marker.isHighlighted(t)?i:e.someSelected?e.model.marker.isSelected(t)?r:o:e.someHighlighted?n:a});var s=e.model.marker.opacitySelectDim<.01;s!=this.nonSelectedOpacityZero&&this.stackBars.style("pointer-events",function(t){return e.someSelected&&s&&!e.model.marker.isSelected(t)?"none":"visible"}),this.nonSelectedOpacityZero=e.model.marker.opacitySelectDim<.01}});e.default=f},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var a=i(1),o=r(a),s=i(2),l=n(s),c=i(41),u=n(c),h=l.default.extend({init:function(t,e){this.name="axislabeler",this.template=i(458),this.model_expects=[{name:"scales"},{name:"show"}];var n=this;this.model_binds={"change:scales":function(t){n.initScales(),n.update()},"change:show":function(t,e){n.initScales(),n.update()}},this._super(t,e),this.xScale=null,this.yScale=null,this.xAxis=(0,u.default)("bottom"),this.yAxis=(0,u.default)("left")},readyOnce:function(){var t=this;this.element=d3.select(this.element),this.graph=this.element.select(".vzb-al-graph"),this.xAxisEl=this.graph.select(".vzb-al-axis-x"),this.yAxisEl=this.graph.select(".vzb-al-axis-y"),this.xInvert=function(e){return t.xScale(t.xScale.invert(t.xScale(e)))},this.yInvert=function(e){return t.yScale(t.yScale.invert(t.yScale(e)));
},this.line=d3.svg.line().x(function(e){return t.xScale(e)}).y(function(e){return t.yScale(e)}),this.lineInvert=d3.svg.line().x(function(e){return t.xInvert(e)}).y(function(e){return t.yInvert(e)}),this.on("resize",function(){t.update()})},ready:function(){console.log("Model ready"),this.initScales(),this.update()},initScales:function(){var t=this.model.scales.domain;this.xScale=d3.scale[this.model.scales.xScaleType](),this.yScale=d3.scale[this.model.scales.yScaleType](),this.xScale.domain(t),this.yScale.domain(t),this.mockData=d3.range(t[0],t[t.length-1],(t[t.length-1]-t[0])/1e4),this.mockData.push(t[t.length-1])},update:function(){var t=this,e=this.model.show.toolMargin.getPlainObject(),i=parseInt(this.element.style("height"),10)-e.top-e.bottom||0,n=parseInt(this.element.style("width"),10)-e.left-e.right||0;if(i<=0||n<=0)return o.warn("Axis Labeler update() call interrupted for Vizabi container is too little or has display:none");this.graph.attr("transform","translate("+e.left+","+e.top+")");var r=this.xScale.domain().length,a=this.yScale.domain().length;this.xScale.range(d3.range(r).map(function(t){return n/(r-1)*t})),this.yScale.range(d3.range(a).map(function(t){return i/(a-1)*t}).reverse()),this.xAxis.scale(this.xScale).tickSize(6,0).tickSizeMinor(3,0).labelerOptions({scaleType:this.model.scales.xScaleType,toolMargin:e}),this.yAxis.scale(this.yScale).tickSize(6,0).tickSizeMinor(3,0).labelerOptions({scaleType:this.model.scales.yScaleType,toolMargin:e}),this.xAxisEl.attr("transform","translate(0,"+i+")"),this.xAxisEl.call(this.xAxis),this.yAxisEl.call(this.yAxis);var s=this.graph.selectAll(".vzb-al-line").data([0]);s.enter().append("path").attr("class","vzb-al-line"),s.datum(this.mockData).attr("d",this.line);var l=this.graph.selectAll(".vzb-al-line-invert").data([0]);l.enter().append("path").attr("class","vzb-al-line-invert"),l.datum(this.mockData).attr("d",this.lineInvert);var c=d3.format(".4r"),u=this.graph.selectAll(".vzb-al-dots").data(this.mockData);u.enter().append("circle").attr("class","vzb-al-dots").attr("r",5).on("mouseenter",function(e,i){console.log("Point #"+i+": "+e+" x="+c(t.xScale(e))+" y="+c(t.yScale(e)))}),u.exit().remove(),u.attr("cx",function(e){return t.xScale(e)}).attr("cy",function(e){return t.yScale(e)});var h=this.graph.selectAll(".vzb-al-dots-invert").data(this.mockData);h.enter().append("circle").attr("class","vzb-al-dots-invert").attr("r",5).on("mouseenter",function(e,i){console.log("Point #"+i+": "+e+" x="+c(t.xScale(e))+" y="+c(t.yScale(e)))}),h.exit().remove(),h.attr("cx",function(e){return t.xInvert(e)}).attr("cy",function(e){return t.yInvert(e)})}});e.default=h},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var a=i(1),o=r(a),s=i(2),l=n(s),c=i(41),u=n(c),h=l.default.extend({init:function(t,e){this.name="barchart",this.template=i(459),this.model_expects=[{name:"time",type:"time"},{name:"entities",type:"entities"},{name:"marker",type:"model"},{name:"locale",type:"locale"}];var n=this;this.model_binds={"change:time.value":function(t){n.model.marker.getFrame(n.model.time.value,function(t){n.values=t,n.updateEntities()})},"change:marker":function(t,e){n._readyOnce&&(e.indexOf("color.palette")>-1||e.indexOf("which")>-1||e.indexOf("use")>-1||n.ready())},"change:marker.color.palette":o.debounce(function(t){n._readyOnce&&n.updateEntities()},200)},this._super(t,e),this.xScale=null,this.yScale=null,this.cScale=d3.scale.category10(),this.xAxis=(0,u.default)("bottom"),this.yAxis=(0,u.default)("left")},readyOnce:function(){this.element=d3.select(this.element),this.graph=this.element.select(".vzb-bc-graph"),this.yAxisEl=this.graph.select(".vzb-bc-axis-y"),this.xAxisEl=this.graph.select(".vzb-bc-axis-x"),this.yTitleEl=this.graph.select(".vzb-bc-axis-y-title"),this.xTitleEl=this.graph.select(".vzb-bc-axis-x-title"),this.bars=this.graph.select(".vzb-bc-bars"),this.year=this.element.select(".vzb-bc-year");var t=this;this.on("resize",function(){t.updateEntities()})},ready:function(){var t=this;this.model.marker.getFrame(this.model.time.value,function(e){t.values=e,t.updateIndicators(),t.resize(),t.updateEntities()})},updateIndicators:function(){var t=this;this.translator=this.model.locale.getTFunction(),this.duration=this.model.time.delayAnimations;var e=this.translator("indicator/"+this.model.marker.axis_y.which),i=this.translator("indicator/"+this.model.marker.axis_x.which),n=this.yTitleEl.selectAll("text").data([0]);n.enter().append("text"),n.attr("y","-6px").attr("x","-9px").attr("dx","-0.72em").text(e).on("click",function(){t.parent.findChildByName("gapminder-treemenu").markerID("axis_y").alignX("left").alignY("top").updateView().toggle()});var r=this.xTitleEl.selectAll("text").data([0]);r.enter().append("text"),r.attr("y","-3px").attr("dx","-0.72em").text(i).on("click",function(){t.parent.findChildByName("gapminder-treemenu").markerID("axis_x").alignY("bottom").alignX("center").updateView().toggle()}),this.yScale=this.model.marker.axis_y.getScale(),this.xScale=this.model.marker.axis_x.getScale(),this.cScale=this.model.marker.color.getScale();var a="geo.world_4region"==this.model.marker.axis_x.which?function(e){return t.translator("entity/geo.world_4region/"+e)}:t.model.marker.axis_x.getTickFormatter();this.yAxis.tickFormat(t.model.marker.axis_y.getTickFormatter()),this.xAxis.tickFormat(a)},updateEntities:function(){var t=this,e=this.model.time,i=e.getDimension(),n=this.model.entities.getDimension(),r=e.playing?e.delayAnimations:0,a={};a[i]=e.value;var o=this.model.marker.getKeys(a);this.entityBars=this.bars.selectAll(".vzb-bc-bar").data(o),this.entityBars.exit().remove(),this.entityBars.enter().append("rect").attr("class","vzb-bc-bar").on("mousemove",function(t,e){}).on("mouseout",function(t,e){}).on("click",function(t,e){});var s=(this.bars.selectAll(".vzb-bc-bar"),this.xScale.rangeBand());this.bars.selectAll(".vzb-bc-bar").attr("width",s).attr("fill",function(e){return t.cScale(t.values.color[e[n]])}).attr("x",function(e){return t.xScale(t.values.axis_x[e[n]])}).transition().duration(r).ease(d3.easeLinear).attr("y",function(e){return t.yScale(t.values.axis_y[e[n]])}).attr("height",function(e){return t.height-t.yScale(t.values.axis_y[e[n]])}),this.year.text(this.model.time.formatDate(this.model.time.value))},resize:function(){var t=this;this.profiles={small:{margin:{top:30,right:20,left:40,bottom:50},padding:2,minRadius:2,maxRadius:40},medium:{margin:{top:30,right:60,left:60,bottom:60},padding:2,minRadius:3,maxRadius:60},large:{margin:{top:30,right:60,left:60,bottom:80},padding:2,minRadius:4,maxRadius:80}},this.activeProfile=this.profiles[this.getLayoutProfile()];var e=this.activeProfile.margin;if(this.height=parseInt(this.element.style("height"),10)-e.top-e.bottom||0,this.width=parseInt(this.element.style("width"),10)-e.left-e.right||0,this.height<=0||this.width<=0)return o.warn("Bar chart resize() abort: vizabi container is too little or has display:none");this.graph.attr("transform","translate("+e.left+","+e.top+")"),"ordinal"!==this.model.marker.axis_y.scaleType?this.yScale.range([this.height,0]):this.yScale.rangePoints([this.height,0],t.activeProfile.padding).range(),"ordinal"!==this.model.marker.axis_x.scaleType?this.xScale.range([0,this.width]):this.xScale.rangePoints([0,this.width],t.activeProfile.padding).range(),this.yAxis.scale(this.yScale).tickSize(6,0).tickSizeMinor(3,0).labelerOptions({scaleType:this.model.marker.axis_y.scaleType,timeFormat:this.model.time.getFormatter(),toolMargin:{top:5,right:e.right,left:e.left,bottom:e.bottom},limitMaxTickNumber:6}),this.xAxis.scale(this.xScale).tickSize(6,0).tickSizeMinor(3,0).labelerOptions({scaleType:this.model.marker.axis_x.scaleType,timeFormat:this.model.time.getFormatter(),toolMargin:e,viewportLength:this.width}),this.xAxisEl.attr("transform","translate(0,"+this.height+")").call(this.xAxis),this.xScale.rangeRoundBands([0,this.width],.1,.2),this.yAxisEl.call(this.yAxis),this.xAxisEl.call(this.xAxis);var i=this.xAxisEl.node().getBoundingClientRect(),n=this.xTitleEl.node().getBoundingClientRect(),r=i.width/2-n.width/2,a=this.height+i.height+n.height;this.xTitleEl.attr("transform","translate("+r+","+a+")"),this.year.attr("x",this.width).attr("y",0)}});e.default=h},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function a(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}Object.defineProperty(e,"__esModule",{value:!0});var o=i(1),s=r(o),l=i(2),c=n(l),u=i(41),h=n(u),d=i(10),f="#333",p="#fdfdfd",m=c.default.extend({init:function(t,e){var n=this;this.name="barrankchart-component",this.template=i(460),this.model_expects=[{name:"time",type:"time"},{name:"entities",type:"entities"},{name:"marker",type:"model"},{name:"locale",type:"locale"},{name:"ui",type:"ui"}],this.model_binds={"change:time.value":function(){n._readyOnce&&n.onTimeChange()},"change:marker.select":function(){n._readyOnce&&(n._selectBars(),n._updateOpacity(),n._updateDoubtOpacity(),n._scroll())},"change:marker.axis_x.scaleType":function(){n._readyOnce&&(n.loadData(),n.draw(!0))},"change:marker.color.palette":function(){n._drawColors()},"change:marker.highlight":function(){n._updateOpacity()},"change:marker.opacitySelectDim":function(){n._updateOpacity()},"change:marker.opacityRegular":function(){n._updateOpacity()}},this._super(t,e),this.xScale=null,this.cScale=d3.scaleOrdinal(d3.schemeCategory10),this.xAxis=(0,h.default)("bottom")},onTimeChange:function(){var t=this;this.model.marker.getFrame(this.model.time.value,function(e){t.values=e,t.loadData(),t.draw()})},readyOnce:function(){this.element=d3.select(this.element),this.header=this.element.select(".vzb-br-header"),this.infoEl=this.element.select(".vzb-br-axis-info"),this.barViewport=this.element.select(".vzb-br-barsviewport"),this.barSvg=this.element.select(".vzb-br-bars-svg"),this.barContainer=this.element.select(".vzb-br-bars"),this.dataWarningEl=this.element.select(".vzb-data-warning"),this.wScale=d3.scale.linear().domain(this.model.ui.datawarning.doubtDomain).range(this.model.ui.datawarning.doubtRange),this.xAxis.tickFormat(this.model.marker.axis_x.getTickFormatter()),this._localeId=this.model.locale.id,this._presentation=!this.model.ui.presentation,this._formatter=this.model.marker.axis_x.getTickFormatter(),this.ready(),this._selectBars()},ready:function(){var t=this;this.model.marker.getFrame(this.model.time.value,function(e){t.values=e,t.loadData(),t.draw(!0),t._updateOpacity(),t._drawColors()})},resize:function(){this.draw(!0)},loadData:function(){var t=this,e=this;this.translator=this.model.locale.getTFunction(),this.sortedEntities=this._sortByIndicator(this.values.axis_x),this.header.select(".vzb-br-title").select("text").on("click",function(){return t.parent.findChildByName("gapminder-treemenu").markerID("axis_x").alignX("left").alignY("top").updateView().toggle()}),this.xScale=this.model.marker.axis_x.getScale(),this.cScale=this.model.marker.color.getScale(),s.setIcon(this.dataWarningEl,d.warn).select("svg").attr("width",0).attr("height",0),this.dataWarningEl.append("text").text(this.translator("hints/dataWarning")),this.dataWarningEl.on("click",function(){return t.parent.findChildByName("gapminder-datawarning").toggle()}).on("mouseover",function(){return t._updateDoubtOpacity(1)}).on("mouseout",function(){return t._updateDoubtOpacity()}),s.setIcon(this.infoEl,d.question).select("svg").attr("width",0).attr("height",0),this.infoEl.on("click",function(){t.parent.findChildByName("gapminder-datanotes").pin()}),this.infoEl.on("mouseover",function(){var t=this.getBBox(),i=s.makeAbsoluteContext(this,this.farthestViewportElement),n=i(t.x-10,t.y+t.height+10);e.parent.findChildByName("gapminder-datanotes").setHook("axis_y").show().setPos(n.x,n.y)}),this.infoEl.on("mouseout",function(){e.parent.findChildByName("gapminder-datanotes").hide()})},draw:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.time_1=null==this.time?this.model.time.value:this.time,this.time=this.model.time.value;var e=this.model.time.playing&&this.time-this.time_1>0?this.model.time.delayAnimations:0;this.drawAxes(e,t)||this.drawData(e,t)},drawAxes:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e={small:{margin:{top:60,right:5,left:5,bottom:20},headerMargin:{top:10,right:20,bottom:20,left:20},infoElHeight:16,infoElMargin:5,barHeight:18,barMargin:3,barRectMargin:5,barValueMargin:5,scrollMargin:20},medium:{margin:{top:60,right:5,left:5,bottom:20},headerMargin:{top:10,right:20,bottom:20,left:20},infoElHeight:16,infoElMargin:5,barHeight:21,barMargin:3,barRectMargin:5,barValueMargin:5,scrollMargin:25},large:{margin:{top:60,right:5,left:5,bottom:20},headerMargin:{top:10,right:20,bottom:20,left:20},infoElHeight:16,infoElMargin:5,barHeight:28,barMargin:4,barRectMargin:5,barValueMargin:5,scrollMargin:25}},i={medium:{margin:{top:60,right:10,left:10,bottom:40},headerMargin:{top:10,right:20,bottom:20,left:20},infoElHeight:25,infoElMargin:10,barHeight:25,barMargin:6},large:{margin:{top:60,right:10,left:10,bottom:40},headerMargin:{top:10,right:20,bottom:20,left:20},infoElHeight:16,infoElMargin:10,barHeight:30,barMargin:6}};this.activeProfile=this.getActiveProfile(e,i);var n=this.activeProfile,r=n.margin,a=n.headerMargin,o=n.infoElHeight,s=n.infoElMargin;this.height=+this.element.style("height").replace("px",""),this.width=+this.element.style("width").replace("px",""),this.barViewport.style("height",this.height-r.bottom-r.top+"px"),this.header.attr("height",r.top);var l=this.header.select(".vzb-br-title"),c=this.model.marker.axis_x.getConceptprops(),u=c.name,h=c.unit,d=l.select("text");if(h){d.text(u+", "+h);var f=a.left+l.node().getBBox().width+s+o;f>this.width-a.right&&d.text(u)}var p=l.node().getBBox(),m=a.left,g=a.top+p.height;l.attr("transform","translate("+m+", "+g+")");var v=this.infoEl;v.select("svg").attr("width",o+"px").attr("height",o+"px");var y=m+l.node().getBBox().width+s,b=a.top+o/4;v.attr("transform","translate("+y+", "+b+")");var _=this.header.select(".vzb-br-total");t?_.select("text").transition("text").delay(t).text(this.model.time.formatDate(this.time)):_.select("text").interrupt().text(this.model.time.formatDate(this.time)),_.style("opacity",Number("large"!==this.getLayoutProfile()));var x=_.node().getBBox(),w=this.width-a.right-x.width,M=a.top+x.height;_.attr("transform","translate("+w+", "+M+")").classed("vzb-transparent",p.width+x.width+10>this.width),this.element.select(".vzb-data-warning-svg").style("height",r.bottom+"px");var z=this.dataWarningEl.select("text").node().getBBox();this.dataWarningEl.attr("transform","translate("+(this.width-r.right-z.width)+", "+z.height+")").select("text"),this.dataWarningEl.select("svg").attr("width",z.height).attr("height",z.height).attr("x",-z.height-5).attr("y",-z.height+1),this._updateDoubtOpacity()},drawData:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=this._localeId!==this.model.locale.id;(i||n)&&(this._localeId=this.model.locale.id,this.barContainer.selectAll(".vzb-br-bar").remove()),this._createAndDeleteBars(this.barContainer.selectAll(".vzb-br-bar").data(this.sortedEntities,function(t){return t.entity}));var r=this.model.ui.presentation,a=this._presentation!==r;a&&(this._presentation=r);var o="undefined"==typeof this._entitiesCount||this._entitiesCount!==this.sortedEntities.length;(a||o)&&o&&(this._entitiesCount=this.sortedEntities.length),this._resizeSvg(),this._scroll(e);var s=this.activeProfile,l=s.barRectMargin,c=s.barValueMargin,u=s.scrollMargin,h=s.margin,d=this.model.marker.axis_x,f=d.getLimits(d.which),p=Math.abs(f.max)>=Math.abs(f.min),m=this.width-h.right-h.left-this._getWidestLabelWidth()-l-u;this.xScale.range([0,m]);var g=this.xScale(0)||0,v=this._getWidestLabelWidth();g>(p?h.left:h.right)+this._getWidestLabelWidth()&&(v=g),g<0&&(this.xScale.range([0,m-Math.abs(g)]),g=this.xScale(0)||0);var y=function(e){return t.xScale(e)-g},b=p?"end":"start",_=p?"start":"end",x=p?h.left+v:this.width-v-u-h.right,w=p?x+l:x-l,M=p?w+c:w-c,z=this._getWidestLabelWidth(!0)+(p?h.left:h.right)<v;this.sortedEntities.forEach(function(n){var r=n.value;if((i||a||n.isNew)&&(n.barLabel.attr("x",x).attr("y",t.activeProfile.barHeight/2).attr("text-anchor",b).text(z?n.labelFull:n.labelSmall),n.barRect.attr("rx",t.activeProfile.barHeight/4).attr("ry",t.activeProfile.barHeight/4).attr("height",t.activeProfile.barHeight),n.barValue.attr("x",M).attr("y",t.activeProfile.barHeight/2).attr("text-anchor",_)),i||n.changedWidth||a){var o=Math.max(0,r&&y(Math.abs(r)));(i||n.changedWidth||a)&&n.barRect.transition().duration(e).ease(d3.easeLinear).attr("width",o),n.barRect.attr("x",w-(r<0?o:0)),(i||n.changedValue)&&n.barValue.text(t._formatter(r)||t.translator("hints/nodata"))}(i||n.changedIndex||a)&&n.self.transition().duration(e).ease(d3.easeLinear).attr("transform","translate(0, "+t._getBarPosition(n.index)+")")})},_resizeSvg:function(){var t=this.activeProfile,e=t.barHeight,i=t.barMargin;this.barSvg.attr("height",(e+i)*this.sortedEntities.length+"px")},_scroll:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=this.barContainer.select(".vzb-selected");if(!e.empty()){var i=e.datum(),n=this._getBarPosition(i.index),r=this.activeProfile.margin,a=this.height-r.top-r.bottom,o=n-(a+this.activeProfile.barHeight)/2;this.barViewport.transition().duration(t).tween("scrollfor"+i.entity,this._scrollTopTween(o))}},_createAndDeleteBars:function(t){var e=this;t.exit().remove(),t=t.enter().append("g").each(function(t){var i=d3.select(this);i.attr("class","vzb-br-bar").classed("vzb-selected",e.model.marker.isSelected(t)).attr("id","vzb-br-bar-"+t.entity+"-"+e._id).on("mousemove",function(t){return e.model.marker.highlightMarker(t)}).on("mouseout",function(){return e.model.marker.clearHighlighted()}).on("click",function(t){e.model.marker.selectMarker(t)});var n=i.append("rect").attr("stroke","transparent"),r=e.values.label[t.entity],a=r.length<12?r:r.substring(0,9)+"...",o=i.append("text").attr("class","vzb-br-label").attr("dy",".325em"),s=o.text(r).node().getBBox().width,l=o.text(a).node().getBBox().width,c=i.append("text").attr("class","vzb-br-value").attr("dy",".325em");Object.assign(t,{self:i,barRect:n,barLabel:o,barValue:c,isNew:!0,labelFullWidth:s,labelSmallWidth:l,labelFull:r,labelSmall:a})}).merge(t)},_getWidestLabelWidth:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=t?"labelFullWidth":"labelSmallWidth",i=t?"labelFull":"labelSmall",n=this.sortedEntities.reduce(function(t,i){return t[e]<i[e]?i:t}),r=n.barLabel.text(),a=n.barLabel.text(n[i]).node().getBBox().width;return n.barLabel.text(r),a},_drawColors:function(){var t=this,e=this;this.barContainer.selectAll(".vzb-br-bar>rect").each(function(t){var i=t.entity,n=d3.select(this),r=e.values.color[i];r||0===r?n.style("fill",e._getColor(r)).attr("stroke","transparent"):n.style("fill",p).attr("stroke",f)}),this.barContainer.selectAll(".vzb-br-bar>text").style("fill",function(e){var i=e.entity;return t._getDarkerColor(t.values.color[i])})},_getColor:function(t){return d3.rgb(this.cScale(t))},_getDarkerColor:function(t){return this._getColor(t).darker(2)},_scrollTopTween:function(t){return function(){var e=this,i=d3.interpolateNumber(this.scrollTop,t);return function(t){e.scrollTop=i(t)}}},_getBarPosition:function(t){return(this.activeProfile.barHeight+this.activeProfile.barMargin)*t},_entities:{},_sortByIndicator:function(t){var e=this;return Object.keys(t).map(function(i){var n,r=e._entities[i],o=t[i],s=e._formatter(o);return r?Object.assign(r,{value:o,formattedValue:s,changedValue:s!==r.formattedValue,changedWidth:o!==r.value,isNew:!1}):e._entities[i]=(n={entity:i,value:o,formattedValue:s},a(n,e.model.entities.dim,i),a(n,"changedValue",!0),a(n,"changedWidth",!0),a(n,"isNew",!0),n)}).sort(function(t,e){var i=t.value,n=e.value;return n-i}).map(function(t,e){return Object.assign(t,{index:e,changedIndex:e!==t.index})})},_selectBars:function(){var t=this,e=this.model.entities.dim,i=this.model.marker.select;this.barContainer.classed("vzb-dimmed-selected",!1),this.barContainer.selectAll(".vzb-br-bar.vzb-selected").classed("vzb-selected",!1),i.length&&(this.barContainer.classed("vzb-dimmed-selected",!0),i.forEach(function(i){t.barContainer.select("#vzb-br-bar-"+i[e]+"-"+t._id).classed("vzb-selected",!0)}))},_updateOpacity:function(){var t=this.model.marker,e=1,i=t.highlight,n=t.select,r=t.opacityHighlightDim,a=t.opacitySelectDim,o=t.opacityRegular,s=i.length>0,l=n.length>0;this.barContainer.selectAll(".vzb-br-bar").style("opacity",function(i){return s&&t.isHighlighted(i)?e:l?t.isSelected(i)?o:a:s?r:o})},_updateDoubtOpacity:function(t){this.dataWarningEl.style("opacity",t||(this.model.marker.select.length?1:this.wScale(+this.model.time.value.getUTCFullYear().toString())))}});e.default=m},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var a=i(1),o=r(a),s=i(2),l=n(s),c=i(221),u=n(c),h=i(220),d=n(h),f=i(138),p=n(f),m=i(73),g=n(m),v=i(41),y=n(v),b=i(60),_=n(b),x=i(10),w=l.default.extend({init:function(t,e){var n=this;this.name="bubblechart",this.template=i(461),this.model_expects=[{name:"time",type:"time"},{name:"entities",type:"entities"},{name:"marker",type:"model"},{name:"locale",type:"locale"},{name:"ui",type:"ui"}],this.model_binds={"change:time.playing":function(t,e){o.isTouchDevice()&&n.model.time.playing&&n.someHighlighted&&n.model.marker.clearHighlighted()},"change:time.start":function(t,e){"time"===n.model.marker.color.scaleType&&(n.model.marker.color.scale=null),n._readyOnce&&!n.model.time.splash&&n._trails.create().then(function(){n._trails.run(["findVisible","reveal","opacityHandler"])})},"change:time.end":function(t,e){n._readyOnce&&!n.model.time.splash&&n._trails.create().then(function(){n._trails.run(["findVisible","reveal","opacityHandler"])})},"change:time.record":function(){n.model.time.record?n._export.open(this.element,this.name):n._export.reset()},"change:ui.chart.trails":function(t){n._trails.toggle(n.model.ui.chart.trails),n.redrawDataPoints()},"change:ui.chart.lockNonSelected":function(t){n.redrawDataPoints(500)},"change:marker":function(t,e){if(n._readyOnce){if(e.indexOf("scaleType")>-1)return void n.ready();if(e.indexOf("marker.color")===-1&&e.indexOf("marker.size")===-1&&e.indexOf("marker.size_label")===-1)if(e.indexOf("domainMin")>-1||e.indexOf("domainMax")>-1){if(!n.yScale||!n.xScale)return;n.updateSize(),n.updateMarkerSizeLimits(),n._trails.run("findVisible"),n.redrawDataPoints(),n._trails.run("resize",null,500)}else if(e.indexOf("zoomedMin")>-1||e.indexOf("zoomedMax")>-1){if(n.draggingNow)return;if(o.approxEqual(n._zoomedXYMinMax.axis_x.zoomedMin,n.model.marker.axis_x.zoomedMin,.01)&&o.approxEqual(n._zoomedXYMinMax.axis_x.zoomedMax,n.model.marker.axis_x.zoomedMax,.01)&&o.approxEqual(n._zoomedXYMinMax.axis_y.zoomedMin,n.model.marker.axis_y.zoomedMin,.01)&&o.approxEqual(n._zoomedXYMinMax.axis_y.zoomedMax,n.model.marker.axis_y.zoomedMax,.01))return;var i=!1;n.model.time.playing&&(i=!0,n.model.time.pause(!0)),n._trails.run("abortAnimation"),n._panZoom.zoomToMaxMin(n.model.marker.axis_x.zoomedMin,n.model.marker.axis_x.zoomedMax,n.model.marker.axis_y.zoomedMin,n.model.marker.axis_y.zoomedMax,500,"don't feed these zoom values back to state"),i&&(n.model.time.postponePause=!1)}}},"change:marker.select":function(t,e){n._readyOnce&&n.entityBubbles&&((t.source._val||[]).length-(t.source._previousVal||[]).length>50&&(n.model.ui.chart.trails=!1),n.selectDataPoints(),n.redrawDataPoints(),n._trails.create().then(function(){n._trails.run(["findVisible","reveal","opacityHandler"])}),n.updateBubbleOpacity(),n._updateDoubtOpacity())},"change:marker.highlight":function(t,e){if(n._readyOnce)if("highlight"==e)n.highlightDataPoints();else if(null!==e){var i=n._formatSTitleValues(e.size,e.color);n._updateSTitle(i[0],i[1])}else n._updateSTitle()},"change:time.value":function(){n._readyOnce&&n.entityBubbles&&(n.calculationQueue?n.calculationQueue.push(n.model.time.value.toString()):n.calculationQueue=[n.model.time.value.toString()],function(t){n.model.marker.getFrame(t,function(t,e){if(!n._frameIsValid(t))return o.warn("change:time.value: empty data received from marker.getFrame(). doing nothing");var i=n.calculationQueue.indexOf(e.toString());i!=-1&&(n.calculationQueue.splice(0,i+1),n.frameChanged(t,e))})}(n.model.time.value))},"change:ui.adaptMinMaxZoom":function(){n.model.ui.adaptMinMaxZoom?n._panZoom.expandCanvas(500):n._panZoom.reset()},"change:marker.size.extent":function(t,e){n._readyOnce&&(n.updateMarkerSizeLimits(),n.redrawDataPointsOnlySize(),n._trails.run("resize"))},"change:marker.color":function(t,e){n._readyOnce&&(n.redrawDataPointsOnlyColors(),n._trails.run("recolor"))},"change:marker.opacitySelectDim":function(){n.updateBubbleOpacity()},"change:marker.opacityRegular":function(){n.updateBubbleOpacity(),n._trails.run("opacityHandler")},"change:ui.cursorMode":function(){var t=n.chartSvg;"plus"===n.model.ui.cursorMode?(t.classed("vzb-zoomin",!0),t.classed("vzb-zoomout",!1),t.classed("vzb-panhand",!1)):"minus"===n.model.ui.cursorMode?(t.classed("vzb-zoomin",!1),t.classed("vzb-zoomout",!0),t.classed("vzb-panhand",!1)):"hand"===n.model.ui.cursorMode?(t.classed("vzb-zoomin",!1),t.classed("vzb-zoomout",!1),t.classed("vzb-panhand",!0)):(t.classed("vzb-zoomin",!1),t.classed("vzb-zoomout",!1),t.classed("vzb-panhand",!1))},ready:function(){}},this._super(t,e),this.xScale=null,this.yScale=null,this.sScale=null,this.cScale=null,this.xAxis=(0,y.default)("bottom"),this.yAxis=(0,y.default)("left"),n.COLOR_BLACKISH="#333",n.COLOR_WHITEISH="#fdfdfd",this.isCanvasPreviouslyExpanded=!1,this.draggingNow=null,this._trails=new u.default(this),this._panZoom=new d.default(this),this._export=new p.default(this),this._export.prefix("vzb-bc-").deleteClasses(["vzb-bc-bubbles-crop","vzb-hidden","vzb-bc-year","vzb-bc-zoom-rect","vzb-bc-projection-x","vzb-bc-projection-y","vzb-bc-axis-c-title"]),this._labels=new g.default(this),this._labels.config({CSS_PREFIX:"vzb-bc",LABELS_CONTAINER_CLASS:"vzb-bc-labels",LINES_CONTAINER_CLASS:"vzb-bc-bubbles",LINES_CONTAINER_SELECTOR_PREFIX:"bubble-"})},_rangeBump:function(t,e){var i=this.activeProfile.maxRadius/2;if(e=e?-1:1,o.isArray(t)&&t.length>1){var n=t[0],r=t[t.length-1];return n<r?(n+=i*e,r-=i*e,n>r&&(n=r=(n+r)/2)):n>r?(n-=i*e,r+=i*e,n<r&&(n=r=(n+r)/2)):o.warn("rangeBump error: the input scale range has 0 length. that sucks"),[n,r]}o.warn("rangeBump error: input is not an array or empty")},readyOnce:function(){var t=this;this._readyOnce=!1,this.scrollableAncestor=o.findScrollableAncestor(this.element),this.element=d3.select(this.element),this.chartSvg=this.element.select("svg"),this.graph=this.element.select(".vzb-bc-graph"),this.yAxisElContainer=this.graph.select(".vzb-bc-axis-y"),this.yAxisEl=this.yAxisElContainer.select("g"),this.xAxisElContainer=this.graph.select(".vzb-bc-axis-x"),this.xAxisEl=this.xAxisElContainer.select("g"),this.yTitleEl=this.graph.select(".vzb-bc-axis-y-title"),this.xTitleEl=this.graph.select(".vzb-bc-axis-x-title"),this.sTitleEl=this.graph.select(".vzb-bc-axis-s-title"),this.cTitleEl=this.graph.select(".vzb-bc-axis-c-title"),this.yearEl=this.graph.select(".vzb-bc-year"),this.year=new _.default(this.yearEl),this.yInfoEl=this.graph.select(".vzb-bc-axis-y-info"),this.xInfoEl=this.graph.select(".vzb-bc-axis-x-info"),this.dataWarningEl=this.graph.select(".vzb-data-warning"),this.projectionX=this.graph.select(".vzb-bc-projection-x"),this.projectionY=this.graph.select(".vzb-bc-projection-y"),this.lineEqualXY=this.graph.select(".vzb-bc-line-equal-xy"),this.trailsContainer=this.graph.select(".vzb-bc-trails"),this.bubbleContainerCrop=this.graph.select(".vzb-bc-bubbles-crop"),this.zoomSelection=this.graph.select(".vzb-zoom-selection"),this.labelsContainerCrop=this.graph.select(".vzb-bc-labels-crop"),this.bubbleContainer=this.graph.select(".vzb-bc-bubbles"),this.labelsContainer=this.graph.select(".vzb-bc-labels"),this.linesContainer=this.graph.select(".vzb-bc-lines"),this.zoomRect=this.element.select(".vzb-bc-zoom-rect"),this.eventArea=this.element.select(".vzb-bc-eventarea"),this.entityBubbles=null,this.bubbleCrown=this.element.select(".vzb-bc-bubble-crown"),this.bubbleCrown.selectAll(".vzb-crown-glow").attr("filter","url("+location.pathname+"#vzb-glow-filter)"),this.tooltip=this.element.select(".vzb-bc-tooltip"),this.tooltip.select(".vzb-tooltip-glow").attr("filter","url("+location.pathname+"#vzb-glow-filter)"),this.tooltipMobile=this.element.select(".vzb-tooltip-mobile"),this.on("resize",function(){t._trails.run("abortAnimation"),t.updateSize()||(t.updateMarkerSizeLimits(),t._labels.updateSize(),function(e,i,n,r){t._panZoom.zoomer.dontFeedToState=!0,t._panZoom.rerun(),t._panZoom.zoomToMaxMin(e,i,n,r,0,!0)}(t._zoomedXYMinMax.axis_x.zoomedMin,t._zoomedXYMinMax.axis_x.zoomedMax,t._zoomedXYMinMax.axis_y.zoomedMin,t._zoomedXYMinMax.axis_y.zoomedMax))}),d3.select("body").on("keydown",function(){"arrow"!==t.model.ui.cursorMode&&"hand"!==t.model.ui.cursorMode||(d3.event.metaKey||d3.event.ctrlKey)&&t.element.select("svg").classed("vzb-zoomin",!0)}).on("keyup",function(){"arrow"!==t.model.ui.cursorMode&&"hand"!==t.model.ui.cursorMode||d3.event.metaKey||d3.event.ctrlKey||t.element.select("svg").classed("vzb-zoomin",!1)}).on("mouseenter",function(){"arrow"!==t.model.ui.cursorMode&&"hand"!==t.model.ui.cursorMode||d3.event.metaKey||d3.event.ctrlKey||t.element.select("svg").classed("vzb-zoomin",!1)}),this.root.on("resetZoom",function(){t._panZoom.reset(null,500)}),this._panZoom.zoomSelection(this.bubbleContainerCrop),this.bubbleContainerCrop.call(this._panZoom.dragRectangle).call(this._panZoom.zoomer).on("dblclick.zoom",null).on("mouseup",function(){t.draggingNow=!1}).on("click",function(){var e=t.model.ui.cursorMode;d3.event.defaultPrevented||"arrow"===e||"hand"===e||t._panZoom.zoomByIncrement(e,500)}),this.KEY=this.model.entities.getDimension(),this.TIMEDIM=this.model.time.getDimension(),this.updateUIStrings(),this.wScale=d3.scale.linear().domain(this.model.ui.datawarning.doubtDomain).range(this.model.ui.datawarning.doubtRange),this._labels.readyOnce(),t._readyOnce=!0},_frameIsValid:function(t){return!(!t||0===Object.keys(t.axis_y).length||0===Object.keys(t.axis_x).length||0===Object.keys(t.size).length)},ready:function(){var t=this;this.updateUIStrings();this.model.time.end;this.updateIndicators(),this.updateTime(),t.model.time.splash||t._trails.create(),this.model.marker.getFrame(this.model.time.value,function(e,i){return i.toString()!=t.model.time.value.toString()?void o.defer(function(){t.ready()}):t._frameIsValid(e)?(t.frame=e,t.updateSize(),t.updateMarkerSizeLimits(),t.updateEntities(),t._labels.ready(),t.redrawDataPoints(),t.selectDataPoints(),t.updateBubbleOpacity(),t._updateDoubtOpacity(),t.zoomToMarkerMaxMin(),t.model.time.splash||t._trails.run(["findVisible","reveal","opacityHandler"]),void(t.model.ui.adaptMinMaxZoom&&t._panZoom.expandCanvas())):o.warn("ready: empty data received from marker.getFrame(). doing nothing")})},zoomToMarkerMaxMin:function(){this._panZoom.resetZoomState();var t=this.model.marker.axis_x,e=this.model.marker.axis_y,i=t.getScale().domain(),n=e.getScale().domain(),r=t.zoomedMin?t.zoomedMin:i[0],a=t.zoomedMax?t.zoomedMax:i[1],o=e.zoomedMin?e.zoomedMin:n[0],s=e.zoomedMax?e.zoomedMax:n[1];this._panZoom.zoomToMaxMin(r,a,o,s,0,"don't feed these zoom values back to state");
},updateIndicators:function(){var t=this;this.yScale=this.model.marker.axis_y.getScale(),this.xScale=this.model.marker.axis_x.getScale(),this.sScale=this.model.marker.size.getScale(),this.cScale=this.model.marker.color.getScale(),this._labels.setScales(this.xScale,this.yScale),this.yAxis.tickFormat(t.model.marker.axis_y.getTickFormatter()),this.xAxis.tickFormat(t.model.marker.axis_x.getTickFormatter())},frameChanged:function(t,e){this.frame=t,this.updateTime(),this._updateDoubtOpacity(),this._trails.run("findVisible"),this.model.ui.adaptMinMaxZoom?this._panZoom.expandCanvas():this.redrawDataPoints(),this._trails.run("reveal",null,this.duration),this.tooltipMobile.classed("vzb-hidden",!0),this._reorderEntities()},updateUIStrings:function(){var t=this,e=t.model.marker.axis_y.getConceptprops(),i=t.model.marker.axis_x.getConceptprops(),n=t.model.marker.size.getConceptprops(),r=t.model.marker.color.getConceptprops();this.translator=this.model.locale.getTFunction(),this.strings={title:{Y:e.name,X:i.name,S:n.name,C:r.name},unit:{Y:e.unit||"",X:i.unit||"",S:n.unit||"",C:r.unit||""}};var a=this.yTitleEl.selectAll("text").data([0]);a.enter().append("text"),a.on("click",function(){t.parent.findChildByName("gapminder-treemenu").markerID("axis_y").alignX(t.model.locale.isRTL()?"right":"left").alignY("top").updateView().toggle()});var s=this.xTitleEl.selectAll("text").data([0]);s.enter().append("text"),s.on("click",function(){t.parent.findChildByName("gapminder-treemenu").markerID("axis_x").alignX(t.model.locale.isRTL()?"right":"left").alignY("bottom").updateView().toggle()});var l=this.sTitleEl.selectAll("text").data([0]);l.enter().append("text"),l.attr("text-anchor","end"),o.setIcon(this.dataWarningEl,x.warn).select("svg").attr("width","0px").attr("height","0px"),this.dataWarningEl.append("text").attr("text-anchor","end").text(this.translator("hints/dataWarning")),o.setIcon(this.yInfoEl,x.question).select("svg").attr("width","0px").attr("height","0px"),o.setIcon(this.xInfoEl,x.question).select("svg").attr("width","0px").attr("height","0px"),this.yInfoEl.on("click",function(){t.parent.findChildByName("gapminder-datanotes").pin()}),this.yInfoEl.on("mouseover",function(){var e=this.getBBox(),i=o.makeAbsoluteContext(this,this.farthestViewportElement)(e.x-10,e.y+e.height+10),n=t.root.element.getBoundingClientRect(),r=t.element.node().getBoundingClientRect();t.parent.findChildByName("gapminder-datanotes").setHook("axis_y").show().setPos(i.x+r.left-n.left,i.y)}),this.yInfoEl.on("mouseout",function(){t.parent.findChildByName("gapminder-datanotes").hide()}),this.xInfoEl.on("click",function(){t.parent.findChildByName("gapminder-datanotes").pin()}),this.xInfoEl.on("mouseover",function(){if(!t.model.time.dragging){var e=this.getBBox(),i=o.makeAbsoluteContext(this,this.farthestViewportElement)(e.x-10,e.y+e.height+10),n=t.root.element.getBoundingClientRect(),r=t.element.node().getBoundingClientRect();t.parent.findChildByName("gapminder-datanotes").setHook("axis_x").show().setPos(i.x+r.left-n.left,i.y)}}),this.xInfoEl.on("mouseout",function(){t.model.time.dragging||t.parent.findChildByName("gapminder-datanotes").hide()}),this.dataWarningEl.on("click",function(){t.parent.findChildByName("gapminder-datawarning").toggle()}).on("mouseover",function(){t._updateDoubtOpacity(1)}).on("mouseout",function(){t._updateDoubtOpacity()})},_updateDoubtOpacity:function(t){null==t&&(t=this.wScale(+this.model.time.formatDate(this.time))),this.someSelected&&(t=1),this.dataWarningEl.style("opacity",t)},updateEntities:function(){var t=this,e=this.KEY,i=this.TIMEDIM,n=function(n){return n=n||"",t.model.marker.getKeys().map(function(a){var o={};return o[e]=a[e],o[i]=r,o.sortValue=t.frame.size[a[e]]||0,o[e]=n+a[e],o}).sort(function(t,e){return e.sortValue-t.sortValue})},r=this.model.time.end,a=n.call(this);this.model.marker.setVisible(a),this.model.time.splash||this.unselectBubblesWithNoData(a),this.entityBubbles=this.bubbleContainer.selectAll("circle.vzb-bc-entity").data(this.model.marker.getVisible(),function(t){return t[e]}),this.entityBubbles.exit().remove(),this.entityBubbles=this.entityBubbles.enter().append("circle").attr("class",function(t){return"vzb-bc-entity bubble-"+t[e]}).on("mouseover",function(e,i){o.isTouchDevice()||"arrow"!==t.model.ui.cursorMode&&"hand"!==t.model.ui.cursorMode||t._bubblesInteract().mouseover(e,i)}).on("mouseout",function(e,i){o.isTouchDevice()||"arrow"!==t.model.ui.cursorMode&&"hand"!==t.model.ui.cursorMode||t._bubblesInteract().mouseout(e,i)}).on("click",function(e,i){o.isTouchDevice()||"arrow"!==t.model.ui.cursorMode&&"hand"!==t.model.ui.cursorMode||t._bubblesInteract().click(e,i)}).onTap(function(e,i){d3.event.stopPropagation(),t._bubblesInteract().click(e,i)}).onLongTap(function(t,e){}).merge(this.entityBubbles),this._reorderEntities()},unselectBubblesWithNoData:function(t){var e=this,i=this.KEY;if(this.model.marker.select.length){var n=[],r=t.map(function(t){return t[i]});this.model.marker.select.forEach(function(t){r.indexOf(t[i])!==-1&&n.push(t)}),n.length!==e.model.marker.select.length&&(e.model.marker.select=n)}},_reorderEntities:function(){var t=this,e=this.KEY;this.bubbleContainer.selectAll(".vzb-bc-entity").sort(function(i,n){var r=t.frame.size[i[e]],a=t.frame.size[n[e]];return"undefined"==typeof r&&"undefined"!=typeof a?-1:"undefined"!=typeof r&&"undefined"==typeof a?1:r!=a?d3.descending(r,a):i[e]!=n[e]?d3.ascending(i[e],n[e]):"undefined"!=typeof i.trailStartTime||"undefined"!=typeof n.trailStartTime?"undefined"!=typeof i.trailStartTime?-1:1:"undefined"!=typeof i.limits||"undefined"!=typeof n.limits?"undefined"!=typeof i.limits?-1:1:d3.descending(r,a)})},_bubblesInteract:function(){var t=this;this.KEY,this.TIMEDIM;return{mouseover:function(e,i){t.model.marker.highlightMarker(e),t._labels.showCloseCross(e,!0)},mouseout:function(e,i){t.model.marker.clearHighlighted(),t._labels.showCloseCross(e,!1)},click:function(e,i){if(!t.draggingNow){var n=t.model.marker.isSelected(e);t.model.marker.selectMarker(e),o.isTouchDevice()||(n&&t.model.marker.highlightMarker(e),t.highlightDataPoints())}}}},updateTime:function(){this.time_1=null==this.time?this.model.time.value:this.time,this.time=this.model.time.value,this.duration=this.model.time.playing&&this.time-this.time_1>0?this.model.time.delayAnimations:0,this.year.setText(this.model.time.formatDate(this.time,"ui"),this.duration)},updateSize:function(){var t={small:{margin:{top:30,right:10,left:40,bottom:35},padding:2,minRadius:.5,maxRadius:30,infoElHeight:16,yAxisTitleBottomMargin:6,xAxisTitleBottomMargin:4},medium:{margin:{top:40,right:15,left:60,bottom:55},padding:2,minRadius:1,maxRadius:55,infoElHeight:20,yAxisTitleBottomMargin:6,xAxisTitleBottomMargin:5},large:{margin:{top:50,right:20,left:60,bottom:60},padding:2,minRadius:1,maxRadius:65,infoElHeight:22,yAxisTitleBottomMargin:6,xAxisTitleBottomMargin:5,hideSTitle:!0}},e={medium:{margin:{top:80,bottom:80,left:100},yAxisTitleBottomMargin:20,xAxisTitleBottomMargin:20,infoElHeight:26},large:{margin:{top:80,bottom:100,left:100},yAxisTitleBottomMargin:20,xAxisTitleBottomMargin:20,infoElHeight:32,hideSTitle:!0}},i=this;this.activeProfile=this.getActiveProfile(t,e);var n=this.activeProfile.margin,r=this.activeProfile.infoElHeight;if(i._labels.setCloseCrossHeight(1.2*i.activeProfile.infoElHeight),this.height=parseInt(this.element.style("height"),10)-n.top-n.bottom||0,this.width=parseInt(this.element.style("width"),10)-n.left-n.right||0,this.height<=0||this.width<=0)return o.warn("Bubble chart updateSize() abort: vizabi container is too little or has display:none");this.graph.attr("transform","translate("+n.left+","+n.top+")"),this.year.resize(this.width,this.height),this.eventArea.attr("width",this.width).attr("height",Math.max(0,this.height)),"ordinal"!==this.model.marker.axis_y.scaleType?this.yScale.range(this._rangeBump([this.height,0])):this.yScale.rangePoints([this.height,0],i.activeProfile.padding).range(),"ordinal"!==this.model.marker.axis_x.scaleType?this.xScale.range(this._rangeBump([0,this.width])):this.xScale.rangePoints([0,this.width],i.activeProfile.padding).range(),this.yAxis.scale(this.yScale).tickSizeInner(-this.width).tickSizeOuter(0).tickPadding(6).tickSizeMinor(-this.width,0).labelerOptions({scaleType:this.model.marker.axis_y.scaleType,toolMargin:n,limitMaxTickNumber:6,bump:this.activeProfile.maxRadius/2,viewportLength:this.height,formatter:this.model.marker.axis_y.getTickFormatter()}),this.xAxis.scale(this.xScale).tickSizeInner(-this.height).tickSizeOuter(0).tickPadding(6).tickSizeMinor(-this.height,0).labelerOptions({scaleType:this.model.marker.axis_x.scaleType,toolMargin:n,bump:this.activeProfile.maxRadius/2,viewportLength:this.width,formatter:this.model.marker.axis_x.getTickFormatter()}),this.bubbleContainerCrop.attr("width",this.width).attr("height",Math.max(0,this.height)),this.labelsContainerCrop.attr("width",this.width).attr("height",Math.max(0,this.height)),this.xAxisElContainer.attr("width",this.width+1).attr("height",this.activeProfile.margin.bottom+this.height).attr("y",-1).attr("x",-1),this.xAxisEl.attr("transform","translate(1,"+(1+this.height)+")"),this.yAxisElContainer.attr("width",this.activeProfile.margin.left+this.width).attr("height",Math.max(0,this.height)).attr("x",-this.activeProfile.margin.left),this.yAxisEl.attr("transform","translate("+(this.activeProfile.margin.left-1)+",0)"),this.yAxisEl.call(this.yAxis),this.xAxisEl.call(this.xAxis),this.projectionX.attr("y1",i.yScale.range()[0]+this.activeProfile.maxRadius/2),this.projectionY.attr("x2",i.xScale.range()[0]-this.activeProfile.maxRadius/2),this._updateSTitle(),this.sTitleEl.attr("transform","translate("+this.width+",20) rotate(-90)");var a=this.model.locale.isRTL();this.yTitleEl.style("font-size",r+"px").attr("transform","translate("+(a?this.width:10-this.activeProfile.margin.left)+", -"+this.activeProfile.yAxisTitleBottomMargin+")"),this.xTitleEl.style("font-size",r+"px").attr("transform","translate("+(a?this.width:0)+","+(this.height+n.bottom-this.activeProfile.xAxisTitleBottomMargin)+")");var s=this.strings.unit.Y?", ":"",l=this.yTitleEl.select("text").text(this.strings.title.Y+s+this.strings.unit.Y);l.node().getBBox().width>this.width&&l.text(this.strings.title.Y);var c=this.strings.unit.Y?", ":"",u=this.xTitleEl.select("text").text(this.strings.title.X+c+this.strings.unit.X);if(u.node().getBBox().width>this.width-100&&u.text(this.strings.title.X),this.yInfoEl.select("svg").node()){var h=this.yTitleEl.node().getBBox(),d=o.transform(this.yTitleEl.node()),f=a?h.x+d.translateX-1.4*r:h.x+d.translateX+h.width+.4*r;this.yInfoEl.select("svg").attr("width",r+"px").attr("height",r+"px"),this.yInfoEl.attr("transform","translate("+f+","+(d.translateY-.8*r)+")")}if(this.xInfoEl.select("svg").node()){var p=this.xTitleEl.node().getBBox(),m=o.transform(this.xTitleEl.node()),g=a?p.x+m.translateX-1.4*r:p.x+m.translateX+p.width+.4*r;this.xInfoEl.select("svg").attr("width",r+"px").attr("height",r+"px"),this.xInfoEl.attr("transform","translate("+g+","+(m.translateY-.8*r)+")")}this._resizeDataWarning()},_updateLineEqualXY:function(t){var e=this.model.marker.axis_x.which==this.model.marker.axis_y.which;if(this.lineEqualXY.classed("vzb-invisible",!e),e){var i=d3.min(this.yScale.domain().concat(this.xScale.domain())),n=d3.max(this.yScale.domain().concat(this.xScale.domain()));this.lineEqualXY.transition().duration(t||0).attr("y1",this.yScale(i)).attr("y2",this.yScale(n)).attr("x1",this.xScale(i)).attr("x2",this.xScale(n))}},_resizeDataWarning:function(){var t=this.dataWarningEl.select("text").style("font-size",null),e=t.node().getBBox().width+3*t.node().getBBox().height,i=this.width-this.xTitleEl.node().getBBox().width-this.activeProfile.infoElHeight,n=parseInt(t.style("font-size"))*i/e;t.style("font-size",e>i?n+"px":null);var r=t.node().getBBox();this.dataWarningEl.select("svg").attr("width",.75*r.height).attr("height",.75*r.height).attr("x",-r.width-1.2*r.height).attr("y",.65*-r.height),this.dataWarningEl.attr("transform","translate("+(this.model.locale.isRTL()?r.width+r.height:this.width)+","+(this.height+this.activeProfile.margin.bottom-this.activeProfile.xAxisTitleBottomMargin)+")")},updateMarkerSizeLimits:function(){var t=this,e=this.model.marker.size.extent||[0,1];if(!this.activeProfile)return o.warn("updateMarkerSizeLimits() is called before ready(). This can happen if events get unfrozen and getFrame() still didn't return data");var i=this.activeProfile.minRadius,n=this.activeProfile.maxRadius;this.minRadius=Math.max(n*e[0],i),this.maxRadius=Math.max(n*e[1],i),"ordinal"!==this.model.marker.size.scaleType?this.sScale.range([o.radiusToArea(t.minRadius),o.radiusToArea(t.maxRadius)]):this.sScale.rangePoints([o.radiusToArea(t.minRadius),o.radiusToArea(t.maxRadius)],t.activeProfile.padding).range()},redrawDataPointsOnlyColors:function(){var t=this;if(!this.entityBubbles)return o.warn("redrawDataPointsOnlyColors(): no entityBubbles defined. likely a premature call, fix it!");var e=void 0,i=this.KEY,n=this.model.time.value;this.model.ui.chart.lockNonSelected&&this.someSelected&&(n=this.model.time.parse(""+this.model.ui.chart.lockNonSelected)),this.model.marker.getFrame(n,function(n){return t._frameIsValid(n)?(e=t.frame,void t.entityBubbles.each(function(r,a){var s=t.model.marker.isSelected(r),l=s?e.color[r[i]]:n.color[r[i]],c=null!=l?t.cScale(l):t.COLOR_WHITEISH;d3.select(this).style("fill",c),s&&!function(){var e=o.find(t.model.marker.select,function(t){return t[i]==r[i]}),n=t.model.time.parse(""+e.trailStartTime);t.model.marker.getFrame(n,function(e){if(!e)return o.warn("redrawDataPointsOnlyColor: empty data received from marker.getFrames(). doing nothing");var s={};if(t.model.ui.chart.trails&&n-t.time!=0){var l=e.color[r[i]];s.scaledC0=null!=l?t.cScale(l):t.COLOR_WHITEISH}else s.scaledC0=c;t._labels.updateLabelOnlyColor(r,a,s)})}()})):o.warn("redrawDataPointsOnlyColor: empty data received from marker.getFrame(). doing nothing")})},redrawDataPointsOnlySize:function(){var t=this,e=void 0,i=this.KEY,n=this.model.time.value;this.model.ui.chart.lockNonSelected&&this.someSelected&&(n=this.model.time.parse(""+this.model.ui.chart.lockNonSelected)),this.model.marker.getFrame(n,function(n){return t._frameIsValid(n)?(e=t.frame,void t.entityBubbles.each(function(r,a){var s=t.model.marker.isSelected(r),l=s?e.size[r[i]]:n.size[r[i]];if(null!=l){var c=o.areaToRadius(t.sScale(l));d3.select(this).attr("r",c),s&&!function(){var e=o.find(t.model.marker.select,function(t){return t[i]==r[i]}),n=t.model.time.parse(""+e.trailStartTime);t.model.marker.getFrame(n,function(e){if(!e)return o.warn("redrawDataPointsOnlySize: empty data received from marker.getFrames(). doing nothing");var s={};t.model.ui.chart.trails&&n-t.time!=0?s.scaledS0=o.areaToRadius(t.sScale(e.size[r[i]])):s.scaledS0=c,t._labels.updateLabelOnlyPosition(r,a,s)})}()}})):o.warn("redrawDataPointsOnlySize: empty data received from marker.getFrame(). doing nothing")})},redrawDataPoints:function(t){var e=this;this.KEY;if(null==t&&(t=e.duration),this.model.ui.chart.lockNonSelected&&this.someSelected){var i=this.model.time.parse(""+this.model.ui.chart.lockNonSelected);this.model.marker.getFrame(i,function(i){return i?void e.entityBubbles.each(function(n,r){var a=e.model.marker.isSelected(n)?e.frame:i;e._updateBubble(n,a,r,d3.select(this),t)}):o.warn("redrawDataPoints: empty data received from marker.getFrames(). doing nothing")})}else e.entityBubbles.each(function(i,n){e._updateBubble(i,e.frame,n,d3.select(this),t)});this._updateLineEqualXY(t)},_updateBubble:function(t,e,i,n,r){var a=this,s=this.KEY,l=!1,c=e.axis_y[t[s]],u=e.axis_x[t[s]],h=e.size[t[s]],d=e.label[t[s]],f=e.color[t[s]],p=e.size_label[t[s]];if(!d&&0!==d||!c&&0!==c||!u&&0!==u||!h&&0!==h)t.hidden||(t.hidden=!0,l=!0),l&&(r?!function(){var e=n.style("opacity");n.transition().duration(r).ease(d3.easeExp).style("opacity",0).on("end",function(){n.classed("vzb-invisible",t.hidden),n.style("opacity",e)})}():n.classed("vzb-invisible",t.hidden));else{(t.hidden||n.classed("vzb-invisible"))&&(t.hidden=!1,l=!0);var m=o.areaToRadius(a.sScale(h));if(n.style("fill",null!=f?a.cScale(f):a.COLOR_WHITEISH),r)if(l){var g=n.style("opacity");n.classed("vzb-invisible",t.hidden),n.style("opacity",0).attr("cy",a.yScale(c)).attr("cx",a.xScale(u)).attr("r",m).transition().duration(r).ease(d3.easeExp).style("opacity",g)}else n.transition().duration(r).ease(d3.easeLinear).attr("cy",a.yScale(c)).attr("cx",a.xScale(u)).attr("r",m);else n.interrupt().attr("cy",a.yScale(c)).attr("cx",a.xScale(u)).attr("r",m).transition(),l&&n.classed("vzb-invisible",t.hidden);this.model.time.record&&a._export.write({type:"circle",id:t[s],time:this.model.time.value.getUTCFullYear(),fill:null!=f?a.cScale(f):a.COLOR_WHITEISH,cx:a.xScale(u),cy:a.yScale(c),r:m})}a._updateLabel(t,i,u,c,h,f,d,p,r,l)},_updateLabel:function(t,e,i,n,r,a,s,l,c,u){var h=this,d=this.KEY;if(h.model.marker.isSelected(t)){var f={},p=o.find(h.model.marker.select,function(e){return e[d]==t[d]}),m=h.model.time.formatDate(h.time);this.model.ui.chart.trails&&p.trailStartTime!=m&&null!=p.trailStartTime||(this.model.ui.chart.trails&&null==p.trailStartTime&&(p.trailStartTime=m),f.labelX0=i,f.labelY0=n,f.scaledC0=null!=a?h.cScale(a):h.COLOR_WHITEISH,f.scaledS0=r||0===r?o.areaToRadius(h.sScale(r)):null);var g=h.model.time.parse(""+p.trailStartTime),v=s+(h.model.ui.chart.trails?" "+p.trailStartTime:"");u&&t.hidden&&h.model.ui.chart.trails&&g&&g<h.time&&(u=!1),t.hidden&&!h.model.ui.chart.trails&&(u=!0),this._labels.updateLabel(t,e,f,i,n,r,a,v,l,c,u)}},_formatSTitleValues:function(t,e){var i=this.strings.unit.S,n=this.strings.unit.C,r=this.model.marker.size.getTickFormatter(),a=this.model.marker.color.getTickFormatter();return this.model.marker.color.isDiscrete()&&"constant"!==this.model.marker.color.use&&e&&this.model.marker.color.getColorlegendMarker()&&(e=this.model.marker.color.getColorlegendMarker().label.getItems()[e]||""),[r(t)+" "+i,e||0===e?a(e)+" "+n:this.translator("hints/nodata")]},_updateSTitle:function(t,e){if(this.activeProfile.hideSTitle&&this.model.ui.dialogs.sidebar.indexOf("colors")>-1&&this.model.ui.dialogs.sidebar.indexOf("size")>-1)return void this.sTitleEl.classed("vzb-invisible",!0);this.sTitleEl.classed("vzb-invisible")&&this.sTitleEl.classed("vzb-invisible",!1);var i="constant"!==this.model.marker.size.use,n="constant"!==this.model.marker.color.use,r=this.sTitleEl.select("text").style("font-size",null).text((i?this.translator("buttons/size")+": "+(t?t:this.strings.title.S):"")+(i&&n?", ":"")+(n?this.translator("buttons/colors")+": "+(e?e:this.strings.title.C):"")),a=r.node().getBBox().width,o=this.height-30,s=parseInt(r.style("font-size"))*o/a;r.style("font-size",a>o?s+"px":null)},selectDataPoints:function(){var t=this;this.KEY;o.isTouchDevice()?(t.model.marker.clearHighlighted(),t._labels.showCloseCross(null,!1)):(t._setTooltip(),t._setBubbleCrown()),t.someSelected=t.model.marker.select.length>0,t.nonSelectedOpacityZero=!1},_setBubbleCrown:function(t,e,i,n,r){null!=t?(this.bubbleCrown.classed("vzb-hidden",!1),this.bubbleCrown.select(".vzb-crown").attr("cx",t).attr("cy",e).attr("r",i).attr("fill",r?"none":n),this.bubbleCrown.selectAll(".vzb-crown-glow").attr("cx",t).attr("cy",e).attr("r",i+10).attr("stroke",n)):this.bubbleCrown.classed("vzb-hidden",!0)},_setTooltip:function(t,e,i,n,r){if(t){var a=void 0,o=void 0,s=-1,l=-1,c=0,u=0;n&&(c=.71*n,u=.71*n),this.tooltip.classed("vzb-hidden",!1).selectAll("text").text(t);var h=this.tooltip.select("text").node().getBBox();e-c-h.width<0?(s=1,e+=h.width+5):e-=5,i-u-h.height<0?(l=1,i+=h.height):i-=11,n?(a=e+c*s,o=i+u*l):(a=e+c*s,o=i+u*l),this.tooltip.attr("transform","translate("+a+","+o+")"),this.tooltip.selectAll("rect").attr("width",h.width+8).attr("height",1.2*h.height).attr("x",-h.width-4).attr("y",.85*-h.height).attr("rx",.2*h.height).attr("ry",.2*h.height),this.tooltip.select(".vzb-tooltip-glow").attr("stroke",r)}else this.tooltip.classed("vzb-hidden",!0)},_axisProjections:function(t){var e=this,i=this.TIMEDIM,n=this.KEY;null!=t?this.model.marker.getFrame(t[i],function(i){var r=i.axis_y[t[n]],a=i.axis_x[t[n]],s=i.size[t[n]],l=o.areaToRadius(e.sScale(s));!r&&0!==r||!a&&0!==a||!s&&0!==s||(e.model.ui.chart.whenHovering.showProjectionLineX&&e.xScale(a)>0&&e.xScale(a)<e.width&&e.yScale(r)+l<e.height&&e.projectionX.style("opacity",1).attr("y2",e.yScale(r)+l).attr("x1",e.xScale(a)).attr("x2",e.xScale(a)),e.model.ui.chart.whenHovering.showProjectionLineY&&e.yScale(r)>0&&e.yScale(r)<e.height&&e.xScale(a)-l>0&&e.projectionY.style("opacity",1).attr("y1",e.yScale(r)).attr("y2",e.yScale(r)).attr("x1",e.xScale(a)-l),e.model.ui.chart.whenHovering.higlightValueX&&e.xAxisEl.call(e.xAxis.highlightValue(a)),e.model.ui.chart.whenHovering.higlightValueY&&e.yAxisEl.call(e.yAxis.highlightValue(r)))}):(this.projectionX.style("opacity",0),this.projectionY.style("opacity",0),this.xAxisEl.call(this.xAxis.highlightValue("none")),this.yAxisEl.call(this.yAxis.highlightValue("none")))},highlightDataPoints:function(){var t=this,e=this,i=this.TIMEDIM,n=this.KEY;this.someHighlighted=this.model.marker.highlight.length>0,this.updateBubbleOpacity(),1===this.model.marker.highlight.length?!function(){var r=o.clone(t.model.marker.highlight[0]);e.model.ui.chart.lockNonSelected&&e.someSelected&&!e.model.marker.isSelected(r)?r[i]=e.model.time.parse(""+e.model.ui.chart.lockNonSelected):r[i]=e.model.time.parse(""+r.trailStartTime)||e.time,e.model.marker.getFrame(r[i],function(t){if(t){var a=e.xScale(t.axis_x[r[n]]),s=e.yScale(t.axis_y[r[n]]),l=o.areaToRadius(e.sScale(t.size[r[n]])),c=null!=t.color[r[n]]?e.cScale(t.color[r[n]]):e.COLOR_WHITEISH,u=!1,h=e._formatSTitleValues(t.size[r[n]],t.color[r[n]]);e._updateSTitle(h[0],h[1]),(a+l<0||a-l>e.width||s+l<0||s-l>e.height)&&(u=!0);var d="",f=!1;if(e.model.marker.isSelected(r)&&e.model.ui.chart.trails){d=e.model.time.formatDate(e.time);var p=o.find(e.model.marker.select,function(t){return t[n]==r[n]});f=d!==p.trailStartTime&&!d3.select(d3.event.target).classed("bubble-"+r[n]),d=d!==p.trailStartTime&&e.time===r[i]?d:""}else d=e.model.marker.isSelected(r)?"":t.label[r[n]];if(e._labels.highlight(null,!1),e._labels.highlight(r,!0),e.model.marker.isSelected(r)){var m=!r.trailStartTime||r.trailStartTime==e.model.time.formatDate(e.time);e._setBubbleCrown(a,s,l,c,m)}u||f||e._axisProjections(r),!d||u||f||e._setTooltip(d,a,s,l+3,c);var g=o.find(e.model.marker.select,function(t){return t[n]==r[n]});if(g){var v=o.clone(g);v.opacity=1,e._trails.run(["opacityHandler"],v)}}})}():(this._axisProjections(),this._trails.run(["opacityHandler"]),e._updateSTitle(),this._setTooltip(),this._setBubbleCrown(),this._labels.highlight(null,!1))},updateBubbleOpacity:function(t){var e=this,i=1,n=this.model.marker.opacityHighlightDim,r=this.model.marker.opacityRegular,a=this.model.marker.opacityRegular,o=this.model.marker.opacitySelectDim;this.entityBubbles.style("opacity",function(t){return e.someHighlighted&&e.model.marker.isHighlighted(t)?i:e.someSelected?e.model.marker.isSelected(t)?r:o:e.someHighlighted?n:a});var s=e.model.marker.opacitySelectDim<.01;s!=this.nonSelectedOpacityZero&&this.entityBubbles.style("pointer-events",function(t){return e.someSelected&&s&&!e.model.marker.isSelected(t)?"none":"visible"}),this.nonSelectedOpacityZero=e.model.marker.opacitySelectDim<.01}});e.default=w},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var a=i(1),o=r(a),s=i(16),l=n(s);e.default=l.default.extend({init:function(t){this.context=t,this.dragRectangle=d3.drag(),this.zoomer=d3.zoom(),this.dragRectangle.subject(this.dragSubject()).on("start",this.drag().start).on("drag",this.drag().go).on("end",this.drag().stop),this.zoomer.filter(this.zoomFilter()).on("start",this.zoom().start).on("zoom",this.zoom().go).on("end",this.zoom().stop),this.zoomer.ratioX=1,this.zoomer.ratioY=1,t._zoomedXYMinMax={axis_x:{zoomedMin:null,zoomedMax:null},axis_y:{zoomedMin:null,zoomedMax:null}}},dragSubject:function(){var t=this.context;return function(e){return!d3.event.sourceEvent.ctrlKey&&!d3.event.sourceEvent.metaKey&&"plus"!==t.ui.cursorMode||"minus"===t.ui.cursorMode||("touchmove"===d3.event.sourceEvent.type||"touchstart"===d3.event.sourceEvent.type)&&(d3.event.sourceEvent.touches.length>1||d3.event.sourceEvent.targetTouches.length>1)?null:{x:d3.mouse(this)[0],y:d3.mouse(this)[1]}}},drag:function(){var t=this.context,e=this;return{start:function(e,i){this.origin={x:d3.mouse(this)[0],y:d3.mouse(this)[1]},t.zoomRect.classed("vzb-invisible",!1)},go:function(e,i){var n=this.origin,r={x:d3.event.x,y:d3.event.y};t.zoomRect.attr("x",Math.min(r.x,n.x)).attr("y",Math.min(r.y,n.y)).attr("width",Math.abs(r.x-n.x)).attr("height",Math.abs(r.y-n.y))},stop:function(i){if(t.zoomRect.attr("width",0).attr("height",0).classed("vzb-invisible",!0),this.target={x:d3.mouse(this)[0],y:d3.mouse(this)[1]},!(Math.abs(this.origin.x-this.target.x)<10||Math.abs(this.origin.y-this.target.y)<10)){var n=d3.event.sourceEvent.ctrlKey||d3.event.sourceEvent.metaKey||"plus"===t.ui.cursorMode;e._zoomOnRectangle(d3.select(this),this.origin.x,this.origin.y,this.target.x,this.target.y,n,500)}}}},zoomFilter:function(){var t=this.context;return function(e){var i=d3.event;return!i.ctrlKey&&!i.metaKey&&(("touchmove"===i.type||"touchstart"===i.type)&&(i.touches.length>1||i.targetTouches.length>1)||(!("wheel"!==i.type&&"mousewheel"!==i.type||!t.ui.zoomOnScrolling)||!("mousedown"!==i.type&&"touchstart"!==i.type||"plus"===t.ui.cursorMode||"minus"===t.ui.cursorMode||!t.ui.panWithArrow&&"hand"!==t.ui.cursorMode)))}},zoom:function(){var t=this.context,e=this.zoomer;return{start:function(){"plus"!==t.ui.cursorMode&&"minus"!==t.ui.cursorMode&&t.chartSvg.classed("vzb-zooming",!0),t.model._data.marker.clearHighlighted(),t._setTooltip()},go:function(){var i=d3.event.sourceEvent,n=d3.event.transform.k,r=[d3.event.transform.x,d3.event.transform.y],a=e.ratioY,s=e.ratioX;t.draggingNow=!0,(isNaN(n)||null==n)&&(n=e.scale),(isNaN(n)||null==n)&&(n=1),1===n&&null!==i&&(("wheel"===i.type||"mousewheel"===i.type)&&(i.deltaY||-i.wheelDelta)>0||"touchmove"===i.type&&i.touches.length>1)&&(e.ratioX=1,s=1,e.ratioY=1,a=1),(isNaN(r[0])||isNaN(r[1])||null==r[0]||null==r[1])&&(r=[0,0]);var l=e.scaleExtent()[0];n*a<l&&(a=l/n,e.ratioY=a),n*s<l&&(s=l/n,e.ratioX=s);var c=n*s<1,u=n*a<1;c?(r[0]<0&&(r[0]=0),r[0]>(1-n*s)*t.width&&(r[0]=(1-n*s)*t.width)):(r[0]>0&&(r[0]=0),r[0]<(1-n*s)*t.width&&(r[0]=(1-n*s)*t.width)),u?(r[1]<0&&(r[1]=0),r[1]>(1-n*a)*t.height&&(r[1]=(1-n*a)*t.height)):(r[1]>0&&(r[1]=0),r[1]<(1-n*a)*t.height&&(r[1]=(1-n*a)*t.height));var h=t.width*n*s,d=t.height*n*a,f=[0*n*s+r[0],h+r[0]],p=[d+r[1],0*n*a+r[1]],m=t._rangeBump(f),g=t._rangeBump(p),v=(m[0]-f[0])*n*s,y=(m[1]-f[1])*n*s,b=(g[0]-p[0])*n*a,_=(g[1]-p[1])*n*a;f[0]+=v,f[1]+=y,p[0]+=b,p[1]+=_;var x=[0,t.width],w=[t.height,0],M=t._rangeBump(x),z=t._rangeBump(w);c?(f[0]<M[0]&&(r[0]=M[0]-v),f[1]>M[1]&&(r[0]=M[1]-y-h)):(f[0]>M[0]&&(r[0]=M[0]-v),f[1]<M[1]&&(r[0]=M[1]-y-h)),u?(p[0]>z[0]&&(r[1]=z[0]-b-d),p[1]<z[1]&&(r[1]=z[1]-_)):(p[0]<z[0]&&(r[1]=z[0]-b-d),p[1]>z[1]&&(r[1]=z[1]-_)),c?(f[0]<M[0]&&(f[1]+=Math.abs(f[0]-M[0]),f[0]=M[0]),f[1]>M[1]&&(f[0]-=Math.abs(f[1]-M[1]),f[1]=M[1])):(f[0]>M[0]&&(f[1]-=Math.abs(f[0]-M[0]),f[0]=M[0]),f[1]<M[1]&&(f[0]+=Math.abs(f[1]-M[1]),f[1]=M[1])),u?(p[0]>z[0]&&(p[1]-=Math.abs(p[0]-z[0]),p[0]=z[0]),p[1]<z[1]&&(p[0]+=Math.abs(p[1]-z[1]),p[1]=z[1])):(p[0]<z[0]&&(p[1]+=Math.abs(p[0]-z[0]),p[0]=z[0]),p[1]>z[1]&&(p[0]-=Math.abs(p[1]-z[1]),p[1]=z[1])),"ordinal"===t.model.marker.axis_x.scaleType?t.xScale.rangeBands(f):t.xScale.range(f),"ordinal"===t.model.marker.axis_y.scaleType?t.yScale.rangeBands(p):t.yScale.range(p);var S=function(t){return o.isDate(t)?t:d3.round(t,2)},E=M,k=z;t._zoomedXYMinMax={axis_x:{zoomedMin:S(t.xScale.invert(E[0])),zoomedMax:S(t.xScale.invert(E[1]))},axis_y:{zoomedMin:S(t.yScale.invert(k[0])),zoomedMax:S(t.yScale.invert(k[1]))}},e.dontFeedToState||t.model.marker.set(t._zoomedXYMinMax,null,!1);var T=t.yAxis.labelerOptions(),P=t.xAxis.labelerOptions();T.limitMaxTickNumber=n*a<1.5?8:n*a*8,P.limitMaxTickNumber=n*s<1.5?8:n*s*8,T.transitionDuration=e.duration,P.transitionDuration=e.duration,t.xAxisEl.call(t.xAxis.labelerOptions(P)),t.yAxisEl.call(t.yAxis.labelerOptions(T)),t.redrawDataPoints(e.duration),t._trails.run("resize",null,e.duration),e.duration=0},stop:function(){t.chartSvg.classed("vzb-zooming",!1),t.draggingNow=!1,e.dontFeedToState||t.model.marker.set(t._zoomedXYMinMax,!0,!0),e.dontFeedToState=null}}},expandCanvas:function(t){var e=this.context;t||(t=e.duration);var i=d3.extent(o.values(e.frame.axis_x)),n=d3.extent(o.values(e.frame.axis_y));if(!i[0]&&0!==i[0]||!i[1]&&0!==i[1]||!n[0]&&0!==n[0]||!n[1]&&0!==n[1])return o.warn("panZoom.expandCanvas: X or Y min/max are broken. Aborting with no action");var r={x1:e.xScale(i[0]),y1:e.yScale(n[0]),x2:e.xScale(i[1]),y2:e.yScale(n[1])},a=[0,e.width],s=[e.height,0],l={x1:a[0],x2:a[1],y1:s[0],y2:s[1]},c=0;if(!e.isCanvasPreviouslyExpanded||r.x1<l.x1*(1-c)||r.x2>l.x2*(1+c)||r.y2<l.y2*(1-c)||r.y1>l.y1*(1+c)){if(e.isCanvasPreviouslyExpanded){var u=e._rangeBump(a),h=e._rangeBump(s);r.x1>u[0]&&(r.x1=u[0]),r.x2<u[1]&&(r.x2=u[1]),r.y1<h[0]&&(r.y1=h[0]),r.y2>h[0]&&(r.y2=h[1])}e.isCanvasPreviouslyExpanded=!0,this._zoomOnRectangle(e.element,r.x1,r.y1,r.x2,r.y2,!1,t)}else e.redrawDataPoints(t)},zoomToMaxMin:function(t,e,i,n,r,a){var o=this.context,s=t,l=e,c=i,u=n,h=o.xScale.domain(),d=o.yScale.domain();s<h[0]&&l<h[1]&&(s=h[0]),s>h[0]&&l>h[1]&&(l=h[1]),c<d[0]&&u<d[1]&&(c=d[0]),c>d[0]&&u>d[1]&&(u=d[1]);var f=[o.xScale(s),o.xScale(l)],p=[o.yScale(c),o.yScale(u)];this._zoomOnRectangle(o.element,f[0],p[0],f[1],p[1],!1,r,a)},_zoomOnRectangle:function(t,e,i,n,r,a,o,s){var l=this.context,c=this.zoomer,u=d3.zoomTransform(this.zoomSelection.node()),h=e,d=i,f=n,p=r;a&&u.translate(h-f,d-p);var m=[0,l.width],g=[l.height,0],v=l._rangeBump(m),y=l._rangeBump(g),b=c.scaleExtent()[0],_=c.scaleExtent()[1],x=void 0,w=void 0,M=void 0;Math.abs(h-f)>Math.abs(d-p)?(x=Math.abs(y[0]-y[1])/Math.abs(d-p)*u.k,x<b&&(c.ratioY*=x/u.k,x=b),x>_&&(x=_),w=Math.abs(v[0]-v[1])/Math.abs(h-f)*u.k/x*c.ratioX,M=c.ratioY):(x=Math.abs(v[0]-v[1])/Math.abs(h-f)*u.k,x<b&&(c.ratioX*=x/u.k,x=b),x>_&&(x=_),M=Math.abs(y[0]-y[1])/Math.abs(d-p)*u.k/x*c.ratioY,w=c.ratioX);var z=[(u.x-Math.min(h,f))/u.k/c.ratioX*x*w+(v[0]-m[0]),(u.y-Math.min(d,p))/u.k/c.ratioY*x*M+(y[1]-g[1])];c.dontFeedToState=s,c.ratioY=M,c.ratioX=w,c.duration=o?o:0,this.zoomSelection.call(c.transform,d3.zoomIdentity.translate(z[0],z[1]).scale(x))},zoomByIncrement:function(t,e){var i=(this.context,d3.zoomTransform(this.zoomSelection.node())),n=i.k,r=[i.x,i.y],a=d3.mouse(this.zoomSelection.node()),o=Math.log(n)/Math.LN2;"plus"!=t&&t||(o=Math.floor(o)+1),"minus"==t&&(o=Math.ceil(o)-1);var s=[(a[0]-r[0])/n,(a[1]-r[1])/n],l=this.zoomer.scaleExtent();n==l[0]&&(this.zoomer.ratioY=1,this.zoomer.ratioX=1),n=Math.max(l[0],Math.min(l[1],Math.pow(2,o))),s=[s[0]*n+r[0],s[1]*n+r[1]],r[0]+=a[0]-s[0],r[1]+=a[1]-s[1],this.zoomer.duration=e||0,this.zoomSelection.call(this.zoomer.transform,d3.zoomIdentity.translate(r[0],r[1]).scale(n))},resetZoomState:function(t){this.zoomer.ratioY=1,this.zoomer.ratioX=1,(t||this.zoomSelection).property("__zoom",d3.zoomIdentity)},reset:function(t,e){var i=this.context;i.isCanvasPreviouslyExpanded=!1,this.zoomer.ratioY=1,this.zoomer.ratioX=1,this.zoomer.duration=e||0,(t||this.zoomSelection).call(this.zoomer.transform,d3.zoomIdentity)},rerun:function(t){this.context;(t||this.zoomSelection).call(this.zoomer.scaleBy,1)},zoomSelection:function(t){this.zoomSelection=t}})},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,
e}Object.defineProperty(e,"__esModule",{value:!0});var a=i(1),o=r(a),s=i(16),l=n(s);e.default=l.default.extend({init:function(t){this.context=t,this._isCreated=null,this.actionsQueue={},this.entityTrails={},this.trailsData=[],this.trailsInProgress={},this.activePromises={},this.trailTransitions={},this.delayedIterations={},this.drawingQueue={}},toggle:function(t){var e=this.context;t?e._trails.create().then(function(){e._trails.run(["findVisible","reveal","opacityHandler"])}):(e._trails.run("remove"),e.model.marker.select.forEach(function(t){t.trailStartTime=null}))},create:function(t){var e=this.context,i=this,n=e.KEY,r=e.TIMEDIM;return this._isCreated=new Promise(function(a,s){if(e.model.ui.chart.trails){var l=e.model.time.getAllSteps(),c=[];t=null==t?e.model.marker.select:[t],i._clearActions(t),i.trailsData=e.model.marker.select.map(function(t){var e={status:"created",selectedEntityData:t};return e[n]=t[n],e}),i.trailTransitions={};var u=e.bubbleContainer.selectAll("g.vzb-bc-entity.entity-trail").data(i.trailsData,function(t){return t[n]});u.exit().remove(),u.enter().insert("g",function(t){return this.querySelector(".bubble-"+t[n])}).attr("class",function(t){return"vzb-bc-entity entity-trail trail-"+t[n]}).merge(u).each(function(t,a){var s=this;c.push(new Promise(function(a,c){var u=l.map(function(e){return{t:e,key:t[n]}}),h=d3.select(s).selectAll("g").data(u).classed("vzb-invisible",!0);h.exit().remove(),i.entityTrails[t[n]]=h.enter().append("g").attr("class","vzb-bc-trailsegment").on("mouseover",function(i,a){if(!o.isTouchDevice()){var s={};s[n]=i.key,s[r]=i.t,e._axisProjections(s),e._labels.highlight(t,!0);var l=e.model.time.formatDate(i.t),c=o.find(e.model.marker.select,function(e){return e[n]==t[n]});e.model.marker.getFrame(s[r],function(t){var i=e.xScale(t.axis_x[s[n]]),r=e.yScale(t.axis_y[s[n]]),a=o.areaToRadius(e.sScale(t.size[s[n]])),u=null!=t.color[s[n]]?e.cScale(t.color[s[n]]):e.COLOR_WHITEISH;l!==c.trailStartTime&&e._setTooltip(l,i,r,a+3,u),e._setBubbleCrown(i,r,a,u),e.model.marker.getModelObject("highlight").trigger("change",{size:t.size[s[n]],color:t.color[s[n]]})}),d3.select(this).style("opacity",1)}}).on("mouseout",function(t,i){o.isTouchDevice()||(e._axisProjections(),e._setTooltip(),e._setBubbleCrown(),e._labels.highlight(null,!1),e.model.marker.getModelObject("highlight").trigger("change",null),d3.select(this).style("opacity",e.model.marker.opacityRegular))}).each(function(t,e){var i=d3.select(this);i.append("circle"),i.append("line")}).merge(h),a()}))}),c.length>0?Promise.all(c).then(function(t){a(!0)}):a(!0)}}),this._isCreated},_addActions:function(t,e){var i=this.context,n=this,r=i.KEY;t.forEach(function(t){n.actionsQueue[t[r]]||(n.actionsQueue[t[r]]=[]),n.actionsQueue[t[r]]=[].concat(n.actionsQueue[t[r]].filter(function(t){return e.indexOf(t)==-1}),e)})},_clearActions:function(t){var e=this.context,i=this,n=e.KEY;t.forEach(function(t){i.actionsQueue[t[n]]||(i.actionsQueue[t[n]]=[]),i.actionsQueue[t[n]]=[],i.drawingQueue[t[n]]={},i.delayedIterations[t[n]]={},i.activePromises[t[n]]||(i.activePromises[t[n]]=[]),o.forEach(i.activePromises[t[n]],function(t,e){"pending"===t.status&&t.reject()}),i.trailsInProgress[t[n]]=null,i.activePromises[t[n]]=[]})},_getNextAction:function(t){return this.actionsQueue[t].shift()},run:function(t,e,i){var n=this.context,r=this,a=n.KEY;this._isCreated&&!n.model.time.splash&&("string"==typeof t&&(t=[t]),this._isCreated.then(function(){if(n.model.ui.chart.trails&&n.model.marker.select.length||"remove"==t){i||(i=0),e=null==e?n.model.marker.select:[e];for(var o=0;o<t.length;o++)["resize","recolor","remove"].indexOf(t[o])!=-1&&!function(){var e=t.splice(o,1).pop();--o,r.trailsData.forEach(function(t){var o=r.entityTrails[t[a]];n._trails["_"+e](o,i,t)})}();0!=t.length&&(r._addActions(e,t),r.trailsData.forEach(function(e){t.indexOf("findVisible")!=-1&&(r.drawingQueue[e[a]]={},r.delayedIterations[e[a]]={});var o=r.entityTrails[e[a]],s=function t(s){var l=r._getNextAction(e[a]);if(l){r.trailsInProgress[e[a]]=l;var c=n._trails["_"+l](o,i,e);c&&c instanceof Promise?c.then(function(){r.trailsInProgress[e[a]]=null,t(s+1)},function(){r.trailsInProgress[e[a]]=null}):(r.trailsInProgress[e[a]]=null,t(s+1))}};r.trailsInProgress[e[a]]||s(0)}))}}))},_remove:function(t,e,i){this.actionsQueue[i[this.context.KEY]]=[],t&&(d3.select(this.entityTrails[i[this.context.KEY]].node().parentNode).remove(),this.entityTrails[i[this.context.KEY]]=null)},_resize:function(t,e,i){var n=this.context;if(!n.model.time.splash){var r=!1;t.each(function(t,a){if(null!=t.valueY&&null!=t.valueX&&null!=t.valueS){var s=d3.select(this);if(e?s.select("circle").transition().duration(e).ease(d3.easeLinear).attr("cy",n.yScale(t.valueY)).attr("cx",n.xScale(t.valueX)).attr("r",o.areaToRadius(n.sScale(t.valueS))):s.select("circle").interrupt().attr("cy",n.yScale(t.valueY)).attr("cx",n.xScale(t.valueX)).attr("r",o.areaToRadius(n.sScale(t.valueS))).transition(),r||t.transparent||(r=!0,n._labels.updateLabelOnlyPosition(i,null,{scaledS0:o.areaToRadius(n.sScale(t.valueS))})),t.next){var l=t.next;if(null!=l&&null!=l.valueY&&null!=l.valueX){var c=Math.sqrt(Math.pow(n.xScale(t.valueX)-n.xScale(l.valueX),2)+Math.pow(n.yScale(t.valueY)-n.yScale(l.valueY),2));e?s.select("line").transition().duration(e).ease(d3.easeLinear).attr("x1",n.xScale(l.valueX)).attr("y1",n.yScale(l.valueY)).attr("x2",n.xScale(t.valueX)).attr("y2",n.yScale(t.valueY)).attr("stroke-dasharray",c).attr("stroke-dashoffset",o.areaToRadius(n.sScale(t.valueS))):s.select("line").interrupt().attr("x1",n.xScale(l.valueX)).attr("y1",n.yScale(l.valueY)).attr("x2",n.xScale(t.valueX)).attr("y2",n.yScale(t.valueY)).attr("stroke-dasharray",c).attr("stroke-dashoffset",o.areaToRadius(n.sScale(t.valueS))).transition()}}}})}},_recolor:function(t,e,i){var n=this.context;t.each(function(t,e){var i=d3.select(this),r="geo.world_4region"==n.model.marker.color.which?n.model.marker.color.getColorShade({colorID:t.valueC,shadeID:"shade"}):null!=t.valueC?n.cScale(t.valueC):n.COLOR_BLACKISH;i.select("circle").style("fill",null!=t.valueC?n.cScale(t.valueC):n.COLOR_WHITEISH),i.select("line").style("stroke",r)})},_opacityHandler:function(t,e,i){var n=this.context;t.each(function(t,e){var r=d3.select(this);r.style("opacity",i.opacity||n.model.marker.opacityRegular)})},_findVisible:function(t,e,i){var n=this.context,r=this,a=n.KEY;return new Promise(function(e,s){new Promise(function(t,e){i.limits?t():n.model.marker.getEntityLimits(i[a]).then(function(e){i.limits=e,t()})}).then(function(){i.selectedEntityData.trailStartTime||(i.selectedEntityData.trailStartTime=n.model.time.formatDate(n.time));var s=n.model.time.parse(""+i.selectedEntityData.trailStartTime);if(n.time-s<0||i.limits.min-s>0){n.time-s<0?(i.selectedEntityData.trailStartTime=n.model.time.formatDate(d3.max([n.time,i.limits.min])),s=n.model.time.parse(""+i.selectedEntityData.trailStartTime)):(i.selectedEntityData.trailStartTime=n.model.time.formatDate(i.limits.min),s=n.model.time.parse(""+i.selectedEntityData.trailStartTime));var l=n._labels.cached[i[a]],c=n.frame.size[i[a]],u=n.frame.color[i[a]];l.labelX0=n.frame.axis_x[i[a]],l.labelY0=n.frame.axis_y[i[a]],l.scaledS0=c||0===c?o.areaToRadius(n.sScale(c)):null,l.scaledC0=null!=u?n.cScale(u):n.COLOR_WHITEISH,n._updateLabel(i,0,n.frame.axis_x[i[a]],n.frame.axis_y[i[a]],n.frame.size[i[a]],n.frame.color[i[a]],n.frame.label[i[a]],n.frame.size_label[i[a]],0,!0)}t.each(function(e,r){var a=e.transparent;e.transparent=null==i.selectedEntityData.trailStartTime||e.t-n.time>0||s-e.t>0||i.selectedEntityData.trailStartTime-n.model.time.formatDate(n.time)>=0,(a!=e.transparent||Math.abs(n.model.time.formatDate(e.t)-n.model.time.formatDate(n.time))<2)&&(e.visibilityChanged=!0),e.transparent&&d3.select(t._groups[0][r]).classed("vzb-invisible",e.transparent)}),r.drawingQueue[i[a]]={},r.delayedIterations[i[a]]={},e()})})},_abortAnimation:function(){var t=this.context,e=this,i=t.KEY;e.trailsData.forEach(function(t){e.trailTransitions[t[i]]&&e.trailTransitions[t[i]].select("line").interrupt().transition()})},_reveal:function(t,e,i){var n=this.context,r=this,a=n.KEY;i.status="reveal";var s=n.model.time.parse(""+i.selectedEntityData.trailStartTime),l=function(t,l,c,h){return new Promise(function(h,d){var f=d3.select(t._groups[0][l]),p=f.datum();if(c-l==1){if(p.transparent)return f.classed("vzb-invisible",p.transparent),h();if(!p.visibilityChanged)return h()}n.model.marker.getFrame(p.t,function(d){if("reveal"!=i.status)return h();if(!d)return h();if(p.valueY=d.axis_y[i[a]],p.valueX=d.axis_x[i[a]],p.valueS=d.size[i[a]],p.valueC=d.color[i[a]],null==p.valueY||null==p.valueX||null==p.valueS)return h();if(s&&s.toString()==p.t.toString()){var m=n._labels.cached[i[a]];m.labelX0=p.valueX,m.labelY0=p.valueY;var g=p.valueS;m.scaledS0=g||0===g?o.areaToRadius(n.sScale(g)):null,m.scaledC0=null!=p.valueC?n.cScale(p.valueC):n.COLOR_WHITEISH,n._updateLabel(i,l,p.valueX,p.valueY,p.valueS,p.valueC,d.label[i[a]],d.size_label[i[a]],0,!0)}if(f.select("circle").attr("cy",n.yScale(p.valueY)).attr("cx",n.xScale(p.valueX)).attr("r",o.areaToRadius(n.sScale(p.valueS))).style("fill",null!=p.valueC?n.cScale(p.valueC):n.COLOR_WHITEISH),f.select("line").attr("x2",n.xScale(p.valueX)).attr("y2",n.yScale(p.valueY)).attr("x1",n.xScale(p.valueX)).attr("y1",n.yScale(p.valueY)),n.time-p.t>0?(p.visibilityChanged=!1,f.classed("vzb-invisible",p.transparent)):f.classed("vzb-invisible",!0),!t._groups[0][c]||n.time.toString()==p.t.toString())return h();var v=d3.select(t._groups[0][c]),y=v.datum();y.previous=p,p.next=y;var b=y.t;n.time-y.t<0&&(p.visibilityChanged=!0,b=n.time),n.model.marker.getFrame(b,function(t){if("reveal"!=i.status)return h();if(!t||null==p.valueY||null==p.valueX||null==p.valueS)return h();if(null==t.axis_x[i[a]]||null==t.axis_y[i[a]])return h();y.valueY=t.axis_y[i[a]],y.valueX=t.axis_x[i[a]],y.valueS=t.size[i[a]],y.valueC=t.color[i[a]],r.trailTransitions[i[a]]=f;var s="geo.world_4region"==n.model.marker.color.which?n.model.marker.color.getColorShade({colorID:p.valueC,shadeID:"shade"}):null!=p.valueC?n.cScale(p.valueC):n.COLOR_BLACKISH,d=Math.sqrt(Math.pow(n.xScale(p.valueX)-n.xScale(t.axis_x[i[a]]),2)+Math.pow(n.yScale(p.valueY)-n.yScale(t.axis_y[i[a]]),2));return f.select("line").transition().duration(e).ease(d3.easeLinear).attr("x1",n.xScale(y.valueX)).attr("y1",n.yScale(y.valueY)).attr("x2",n.xScale(p.valueX)).attr("y2",n.yScale(p.valueY)).attr("stroke-dasharray",d).attr("stroke-dashoffset",o.areaToRadius(n.sScale(p.valueS))).style("stroke",s),c-l>1?(u(l,c),h()):h()})})})},c=function(r,s,l){return new Promise(function(c,h){var d=d3.select(t._groups[0][r]),f=d3.select(t._groups[0][s]),p=d3.select(t._groups[0][l]),m=d.datum(),g=f.datum(),v=p.datum();return!m.previous&&!m.next||!g.previous&&!g.next?c():void n.model.marker.getFrame(v.t,function(t){if("reveal"!=i.status)return c();if(!t||"undefined"==typeof t.axis_x||null==t.axis_x[i[a]]||"undefined"==typeof t.axis_y||null==t.axis_y[i[a]])return o.warn("Frame for trail missed: "+v.t),c();if(v.valueY=t.axis_y[i[a]],v.valueX=t.axis_x[i[a]],v.valueS=t.size[i[a]],v.valueC=t.color[i[a]],v.previous=m,v.next=g,m.next=v,g.previous=v,null==v.valueY||null==v.valueX||null==v.valueS)return o.warn("Data for trail point missed: "+v.t),c();var h="geo.world_4region"==n.model.marker.color.which?n.model.marker.color.getColorShade({colorID:v.valueC,shadeID:"shade"}):null!=v.valueC?n.cScale(v.valueC):n.COLOR_BLACKISH,f=Math.sqrt(Math.pow(n.xScale(m.valueX)-n.xScale(v.valueX),2)+Math.pow(n.yScale(m.valueY)-n.yScale(v.valueX),2));if(d.select("line").transition().duration(e).ease(d3.easeLinear).attr("x1",n.xScale(v.valueX)).attr("y1",n.yScale(v.valueY)).attr("x2",n.xScale(m.valueX)).attr("y2",n.yScale(m.valueY)).attr("stroke-dasharray",f).attr("stroke-dashoffset",o.areaToRadius(n.sScale(m.valueS))).style("stroke",h),p.classed("vzb-invisible",v.transparent),!v.transparent){p.select("circle").attr("cy",n.yScale(v.valueY)).attr("cx",n.xScale(v.valueX)).attr("r",o.areaToRadius(n.sScale(v.valueS))).style("fill",null!=v.valueC?n.cScale(v.valueC):n.COLOR_WHITEISH);var y=Math.sqrt(Math.pow(n.xScale(v.valueX)-n.xScale(g.valueX),2)+Math.pow(n.yScale(v.valueY)-n.yScale(g.valueY),2));p.select("line").transition().duration(e).ease(d3.easeLinear).attr("x1",n.xScale(g.valueX)).attr("y1",n.yScale(g.valueY)).attr("x2",n.xScale(v.valueX)).attr("y2",n.yScale(v.valueY)).attr("stroke-dasharray",y).attr("stroke-dashoffset",o.areaToRadius(n.sScale(v.valueS))).style("stroke",h)}u(r,l,s),c()})})},u=function(t,e,n){var o=void 0;e-t>1&&(o=h(t,e),r.delayedIterations[i[a]][t]={first:t,next:e,medium:o}),n&&n-e>1&&(o=h(e,n),r.delayedIterations[i[a]][e]={first:e,next:n,medium:o})},h=function(t,e){return Math.round(t+(e-t)/2)},d=function(t,e,i){var r=[],a=0,s=0,l=d3.min([t.limits.max,n.time]),c=d3.max([t.limits.min,n.model.time.parse(""+t.selectedEntityData.trailStartTime)]);return o.forEach(e._groups[0],function(t,e){var o=t.__data__;o.t-c==0?a=e:o.t-l==0?s=e:o.t>c&&o.t<l&&(n.model.time.formatDate(o.t)%i==0||o.next&&o.previous)&&r.push(e)}),r.unshift(a),s>0&&r.push(s),r},f=function(){return new Promise(function(t,e){var n=function e(){var n=Object.keys(r.drawingQueue[i[a]])[Math.floor(Math.random()*Object.keys(r.drawingQueue[i[a]]).length)],o=JSON.parse(JSON.stringify(r.drawingQueue[i[a]][n]));delete r.drawingQueue[i[a]][n],c(o.first,o.next,o.medium).then(function(){Object.keys(r.drawingQueue[i[a]]).length>0?e():t()})};Object.keys(r.drawingQueue[i[a]]).length>0?n(r.drawingQueue[i[a]]):t()})};return new Promise(function(e,o){var s=function t(i,n){return n<0||n>=i._groups[0].length?e():void l(i,n,n+1).then(function(){t(i,n+1)},function(){return e()})},c=function t(){f().then(function(){return 0==Object.keys(r.delayedIterations[i[a]]).length?e():(r.drawingQueue[i[a]]=r.delayedIterations[i[a]],r.delayedIterations[i[a]]={},void t())},function(){return e()})};if(n.model.marker.framesAreReady())s(t,0);else{r.delayedIterations[i[a]]={},r.drawingQueue[i[a]]={};var u=d(i,t,50),h=[];if(u.length<=1)return e();r.delayedIterations[i[a]]={};for(var p=0;p<u.length-1;p++)h.push(l(t,u[p],u[p+1],1));Promise.all(h).then(function(){0==Object.keys(r.delayedIterations[i[a]]).length?e():(r.drawingQueue[i[a]]=r.delayedIterations[i[a]],r.delayedIterations[i[a]]={},c())},function(){e()})}})}})},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var a=i(1),o=r(a),s=i(2),l=n(s),c=i(73),u=n(c),h=i(10),d=i(139),f=n(d),p=i(89),m=n(p),g=i(60),v=n(g),y=i(34),b=n(y),_=l.default.extend({init:function(t,e){this.name="bubblemap",this.template=i(462),this.bubblesDrawing=null,this.isMobile=o.isMobileOrTablet(),this.model_expects=[{name:"time",type:"time"},{name:"entities",type:"entities"},{name:"marker",type:"model"},{name:"locale",type:"locale"},{name:"ui",type:"ui"}];var n=this;this.model_binds={"change:time.value":function(t){n._readyOnce&&n.model.marker.getFrame(n.model.time.value,n.frameChanged.bind(n))},"change:marker.highlight":function(t){n._readyOnce&&(n.highlightMarkers(),n.updateOpacity())},"change:marker":function(t,e){n._readyOnce&&e.indexOf("scaleType")>-1&&n.ready()},"change:marker.size.extent":function(t,e){n._readyOnce&&n.entityBubbles&&(n.updateMarkerSizeLimits(),n.redrawDataPoints(null,!1))},"change:marker.color.palette":function(t,e){n._readyOnce&&n.redrawDataPoints(null,!1)},"change:marker.select":function(t){n._readyOnce&&(n.selectMarkers(),n.redrawDataPoints(null,!1),n.updateOpacity(),n.updateDoubtOpacity())},"change:marker.opacitySelectDim":function(t){n.updateOpacity()},"change:marker.opacityRegular":function(t){n.updateOpacity()}},this._super(t,e),this.sScale=null,this.cScale=d3.scaleOrdinal(d3.schemeCategory10),n.COLOR_WHITEISH="#fdfdfd",(0,m.default)(),this._labels=new u.default(this),this._labels.config({CSS_PREFIX:"vzb-bmc",LABELS_CONTAINER_CLASS:"vzb-bmc-labels",LINES_CONTAINER_CLASS:"vzb-bmc-lines",SUPPRESS_HIGHLIGHT_DURING_PLAY:!1})},readyOnce:function(){this.element=d3.select(this.element),this.graph=this.element.select(".vzb-bmc-graph"),this.mapSvg=this.element.select(".vzb-bmc-map-background"),this.bubbleContainerCrop=this.graph.select(".vzb-bmc-bubbles-crop"),this.bubbleContainer=this.graph.select(".vzb-bmc-bubbles"),this.labelListContainer=this.graph.select(".vzb-bmc-bubble-labels"),this.dataWarningEl=this.graph.select(".vzb-data-warning"),this.yTitleEl=this.graph.select(".vzb-bmc-axis-y-title"),this.cTitleEl=this.graph.select(".vzb-bmc-axis-c-title"),this.yInfoEl=this.graph.select(".vzb-bmc-axis-y-info"),this.cInfoEl=this.graph.select(".vzb-bmc-axis-c-info"),this.entityBubbles=null,this.tooltip=this.element.select(".vzb-bmc-tooltip"),this.yearEl=this.graph.select(".vzb-bmc-year"),this.year=new v.default(this.yearEl),this.year.setConditions({xAlign:"left",yAlign:"bottom"});var t=this;this.on("resize",function(){t.updateSize()||(t.updateMarkerSizeLimits(),t._labels.updateSize(),t.redrawDataPoints())}),this.initMap(),this.KEY=this.model.entities.getDimension(),this.TIMEDIM=this.model.time.getDimension(),this.updateUIStrings(),this.wScale=d3.scale.linear().domain(this.model.ui.datawarning.doubtDomain).range(this.model.ui.datawarning.doubtRange),this._labels.readyOnce()},ready:function(){var t=this;this.updateUIStrings(),this.updateIndicators(),this.updateSize(),this.updateMarkerSizeLimits(),this.model.marker.getFrame(this.model.time.value,function(e,i){return i.toString()!=t.model.time.value.toString()?void o.defer(function(){t.ready()}):void(e&&(t.values=e,t.updateEntities(),t.updateTime(),t._labels.ready(),t.redrawDataPoints(),t.highlightMarkers(),t.selectMarkers(),t.updateDoubtOpacity(),t.updateOpacity()))})},frameChanged:function(t,e){e.toString()==this.model.time.value.toString()&&t&&(this.values=t,this.updateTime(),this.updateDoubtOpacity(),this.redrawDataPoints(null,!1))},updateUIStrings:function(){var t=this;this.translator=this.model.locale.getTFunction();var e=t.model.marker.size.getConceptprops(),i=t.model.marker.color.getConceptprops();this.strings={title:{S:e.name,C:i.name}},this.yTitleEl.select("text").text(this.translator("buttons/size")+": "+this.strings.title.S).on("click",function(){t.parent.findChildByName("gapminder-treemenu").markerID("size").alignX(t.model.locale.isRTL()?"right":"left").alignY("top").updateView().toggle()}),this.cTitleEl.select("text").text(this.translator("buttons/color")+": "+this.strings.title.C).on("click",function(){t.parent.findChildByName("gapminder-treemenu").markerID("color").alignX(t.model.locale.isRTL()?"right":"left").alignY("top").updateView().toggle()}),o.setIcon(this.dataWarningEl,h.warn).select("svg").attr("width","0px").attr("height","0px"),this.dataWarningEl.append("text").attr("text-anchor","end").text(this.translator("hints/dataWarning")),this.dataWarningEl.on("click",function(){t.parent.findChildByName("gapminder-datawarning").toggle()}).on("mouseover",function(){t.updateDoubtOpacity(1)}).on("mouseout",function(){t.updateDoubtOpacity()}),this.yInfoEl.html(h.question).select("svg").attr("width","0px").attr("height","0px"),this.yInfoEl.on("click",function(){t.parent.findChildByName("gapminder-datanotes").pin()}),this.yInfoEl.on("mouseover",function(){var e=this.getBBox(),i=o.makeAbsoluteContext(this,this.farthestViewportElement)(e.x-10,e.y+e.height+10),n=t.root.element.getBoundingClientRect(),r=t.element.node().getBoundingClientRect();t.parent.findChildByName("gapminder-datanotes").setHook("size").show().setPos(i.x+r.left-n.left,i.y)}),this.yInfoEl.on("mouseout",function(){t.parent.findChildByName("gapminder-datanotes").hide()}),this.cInfoEl.html(h.question).select("svg").attr("width","0px").attr("height","0px"),this.cInfoEl.on("click",function(){t.parent.findChildByName("gapminder-datanotes").pin()}),this.cInfoEl.on("mouseover",function(){var e=this.getBBox(),i=o.makeAbsoluteContext(this,this.farthestViewportElement)(e.x-10,e.y+e.height+10),n=t.root.element.getBoundingClientRect(),r=t.element.node().getBoundingClientRect();t.parent.findChildByName("gapminder-datanotes").setHook("color").show().setPos(i.x+r.left-n.left,i.y)}),this.cInfoEl.on("mouseout",function(){t.parent.findChildByName("gapminder-datanotes").hide()})},updateTitleNumbers:function(){var t=this,e=void 0;if(t.isMobile&&t.model.marker.select&&1===t.model.marker.select.length&&(e=t.model.marker.select[0]),t.hovered||e){var i=t.model.marker.size.getConceptprops(),n=t.model.marker.color.getConceptprops(),r=t.hovered||e,a=t.model.marker.size.getTickFormatter(),o=t.model.marker.color.getTickFormatter(),s=i.unit||"",l=n.unit||"",c=t.values.size[r[t.KEY]],u=t.values.color[r[t.KEY]];t.model.marker.color.isDiscrete()&&u&&(u=this.model.marker.color.getColorlegendMarker().label.getItems()[u]||""),t.yTitleEl.select("text").text(t.translator("buttons/size")+": "+a(c)+" "+s),t.cTitleEl.select("text").text(t.translator("buttons/color")+": "+(u||0===u?o(u)+" "+l:t.translator("hints/nodata"))),this.yInfoEl.classed("vzb-hidden",!0),this.cInfoEl.classed("vzb-hidden",!0)}else this.yTitleEl.select("text").text(this.translator("buttons/size")+": "+this.strings.title.S),this.cTitleEl.select("text").text(this.translator("buttons/color")+": "+this.strings.title.C),this.yInfoEl.classed("vzb-hidden",!1),this.cInfoEl.classed("vzb-hidden",this.cTitleEl.classed("vzb-hidden"))},updateDoubtOpacity:function(t){null==t&&(t=this.wScale(+this.time.getUTCFullYear().toString())),this.someSelected&&(t=1),this.dataWarningEl.style("opacity",t)},updateOpacity:function(){var t=this,e=1,i=.3,n=this.model.marker.opacityRegular,r=this.model.marker.opacityRegular,a=this.model.marker.opacitySelectDim;this.entityBubbles.style("opacity",function(o){return t.someHighlighted&&t.model.marker.isHighlighted(o)?e:t.someSelected?t.model.marker.isSelected(o)?n:a:t.someHighlighted?i:r}),this.entityBubbles.classed("vzb-selected",function(e){return t.model.marker.isSelected(e)});var o=t.model.marker.opacitySelectDim<.01;o!==this.nonSelectedOpacityZero&&this.entityBubbles.style("pointer-events",function(e){return t.someSelected&&o&&!t.model.marker.isSelected(e)?"none":"visible"}),this.nonSelectedOpacityZero=t.model.marker.opacitySelectDim<.01},updateIndicators:function(){this.sScale=this.model.marker.size.getScale(),this.cScale=this.model.marker.color.getScale()},updateEntities:function(){var t=this,e=this.KEY,i=this.TIMEDIM,n=function(n){return n=n||"",t.model.marker.getKeys().map(function(a){var o={};return o[e]=a[e],o[i]=r,o.sortValue=t.values.size[a[e]]||0,o[e]=n+a[e],o}).sort(function(t,e){return e.sortValue-t.sortValue})},r=this.model.time.end;this.model.marker.setVisible(n.call(this)),this.model.time.splash||this.unselectBubblesWithNoData(),this.entityBubbles=this.bubbleContainer.selectAll(".vzb-bmc-bubble").data(this.model.marker.getVisible(),function(t){return t[e]}).order(),this.entityBubbles.exit().remove(),this.entityBubbles=this.entityBubbles.enter().append("circle").attr("class","vzb-bmc-bubble").on("mouseover",function(e,i){o.isTouchDevice()||t._interact()._mouseover(e,i)}).on("mouseout",function(e,i){o.isTouchDevice()||t._interact()._mouseout(e,i)}).on("click",function(e,i){o.isTouchDevice()||(t._interact()._click(e,i),t.highlightMarkers())}).onTap(function(e,i){t._interact()._click(e,i),d3.event.stopPropagation()}).onLongTap(function(t,e){}).merge(this.entityBubbles)},unselectBubblesWithNoData:function(t){var e=this,i=this.KEY;t||(t=this.values),t&&t.size&&this.model.marker.select.forEach(function(n){t.size[n[i]]||0===t.size[n[i]]||e.model.marker.selectMarker(n)})},redrawDataPoints:function(t,e){var i=this;return t||(t=this.duration),e||(e=!0),this.entityBubbles?void this.entityBubbles.each(function(n,r){var a=d3.select(this),s=d3.select("#"+n[i.KEY]),l=i.values.hook_lng[n[i.KEY]],c=i.values.hook_lat[n[i.KEY]],u=i.values.size[n[i.KEY]],h=i.values.color[n[i.KEY]],d=i.values.label[n[i.KEY]];n.hidden_1=n.hidden,n.hidden=!u&&0!==u||null==l||null==c,n.hidden!==n.hidden_1&&(t?a.transition().duration(t).ease(d3.easeLinear).style("opacity",0).on("end",function(){return a.classed("vzb-hidden",n.hidden).style("opacity",i.model.marker.opacityRegular)}):a.classed("vzb-hidden",n.hidden)),n.hidden?i._updateLabel(n,r,0,0,u,h,d,t):(n.r=o.areaToRadius(i.sScale(u||0)),n.label=d,a.classed("vzb-hidden",!1).attr("fill",null!=h?i.cScale(h):i.COLOR_WHITEISH),i.model.ui.map.colorGeo&&s.style("fill",null!=h?i.cScale(h):"#999"),e&&(n.cLoc=i.skew(i.projection([l||0,c||0])),a.attr("cx",n.cLoc[0]).attr("cy",n.cLoc[1])),t?a.transition().duration(t).ease(d3.easeLinear).attr("r",n.r):a.interrupt().attr("r",n.r).transition(),i._updateLabel(n,r,n.cLoc[0],n.cLoc[1],u,h,n.label,t))}):o.warn("redrawDataPoints(): no entityBubbles defined. likely a premature call, fix it!")},updateTime:function(){this.time_1=null==this.time?this.model.time.value:this.time,this.time=this.model.time.value,this.duration=this.model.time.playing&&this.time-this.time_1>0?this.model.time.delayAnimations:0,this.year.setText(this.model.time.formatDate(this.time),this.duration),this.updateTitleNumbers()},fitSizeOfTitles:function(){var t=this.yTitleEl.select("text");t.style("font-size",null);var e=this.cTitleEl.select("text");e.style("font-size",null);var i=t.node().getBBox(),n=this.cTitleEl.classed("vzb-hidden")?i:e.node().getBBox(),r=Math.max(parseInt(t.style("font-size")),parseInt(e.style("font-size")))*this.width/Math.max(i.width,n.width);Math.max(i.width,n.width)>this.width?(t.style("font-size",r+"px"),e.style("font-size",r+"px")):(t.style("font-size",null),e.style("font-size",null))},initMap:function(){var t=this;this.topology||o.warn("bubble map afterPreload: missing country shapes "+this.topology),this.projection=d3["geo"+o.capitalize(this.model.ui.map.projection)](),this.mapPath=d3.geoPath().projection(this.projection),this.mapGraph=this.element.select(".vzb-bmc-map-graph"),this.mapGraph.html(""),this.mapFeature=f.default.feature(this.topology,this.topology.objects[this.model.ui.map.topology.objects.geo]);var e=f.default.mesh(this.topology,this.topology.objects[this.model.ui.map.topology.objects.boundaries],function(t,e){return t!==e});this.projection.scale(1).translate([0,0]),this.mapBounds=this.mapPath.bounds(this.mapFeature),this.mapFeature.features?this.mapGraph.selectAll(".land").data(this.mapFeature.features).enter().insert("path").attr("d",this.mapPath).attr("id",function(e){return e.properties[t.model.ui.map.topology.geoIdProperty].toLowerCase()}).attr("class","land"):this.mapGraph.insert("path").datum(this.mapFeature).attr("class","land"),this.mapGraph.insert("path").datum(e).attr("class","boundary")},profiles:{small:{margin:{top:10,right:10,left:10,bottom:0},infoElHeight:16,minRadius:.5,maxRadius:30},medium:{margin:{top:20,right:20,left:20,bottom:30},infoElHeight:20,minRadius:1,maxRadius:55},large:{margin:{top:30,right:30,left:30,bottom:35},infoElHeight:22,minRadius:1,maxRadius:65}},presentationProfileChanges:{medium:{infoElHeight:26},large:{infoElHeight:32}},updateSize:function(){this.activeProfile=this.getActiveProfile(this.profiles,this.presentationProfileChanges);var t=this.activeProfile.margin;return this.height=parseInt(this.element.style("height"),10)-t.top-t.bottom||0,this.width=parseInt(this.element.style("width"),10)-t.left-t.right||0,this.height<=0||this.width<=0?o.warn("Bubble map updateSize() abort: vizabi container is too little or has display:none"):(this.repositionElements(),void this.rescaleMap())},repositionElements:function(){var t=this.activeProfile.margin,e=this.activeProfile.infoElHeight,i=this.model.locale.isRTL();this.graph.attr("transform","translate("+t.left+","+t.top+")"),this.year.setConditions({widthRatio:.2}),this.year.resize(this.width,this.height),this.yTitleEl.style("font-size",e).attr("transform","translate("+(i?this.width:0)+","+t.top+")");var n=this.yTitleEl.select("text").node().getBBox();this.cTitleEl.attr("transform","translate("+(i?this.width:0)+","+(t.top+n.height)+")").classed("vzb-hidden","large"===this.getLayoutProfile()||"constant"==this.model.marker.color.use);var r=this.dataWarningEl.select("text").node().getBBox();if(this.dataWarningEl.select("svg").attr("width",.75*r.height).attr("height",.75*r.height).attr("x",-r.width-1.2*r.height).attr("y",.65*-r.height),this.dataWarningEl.attr("transform","translate("+this.width+","+(this.height-.5*r.height)+")").select("text"),this.yInfoEl.select("svg").node()){var a=this.yTitleEl.node().getBBox(),s=o.transform(this.yTitleEl.node()),l=i?a.x+s.translateX-1.4*e:a.x+s.translateX+a.width+.4*e;this.yInfoEl.select("svg").attr("width",e).attr("height",e),this.yInfoEl.attr("transform","translate("+l+","+(s.translateY-.8*e)+")")}if(this.cInfoEl.classed("vzb-hidden",this.cTitleEl.classed("vzb-hidden")),!this.cInfoEl.classed("vzb-hidden")&&this.cInfoEl.select("svg").node()){var c=this.cTitleEl.node().getBBox(),u=o.transform(this.cTitleEl.node()),h=i?c.x+u.translateX-1.4*e:c.x+u.translateX+c.width+.4*e;this.cInfoEl.select("svg").attr("width",e).attr("height",e),this.cInfoEl.attr("transform","translate("+h+","+(u.translateY-.8*e)+")")}},rescaleMap:function(){var t=this.model.ui.map.offset,e=this.activeProfile.margin,i=this.model.ui.map.scale/Math.max((this.mapBounds[1][0]-this.mapBounds[0][0])/this.width,(this.mapBounds[1][1]-this.mapBounds[0][1])/this.height),n=i*(this.mapBounds[1][0]-this.mapBounds[0][0]),r=i*(this.mapBounds[1][1]-this.mapBounds[0][1]),a=r*(1+t.top+t.bottom),o=n*(1+t.left+t.right),s=r*t.top,l=n*t.left,c=[(n-i*(this.mapBounds[1][0]+this.mapBounds[0][0]))/2,(r-i*(this.mapBounds[1][1]+this.mapBounds[0][1]))/2];this.projection.scale(i).translate(c),this.mapGraph.selectAll("path").attr("d",this.mapPath);var u=void 0,h=void 0;if(this.model.ui.map.preserveAspectRatio)u=1,h=1;else{var d=a,f=o;a=this.height*this.model.ui.map.scale,o=this.width*this.model.ui.map.scale,this.mapSvg.attr("preserveAspectRatio","none").attr("viewBox",[0,0,f,d].join(" ")),u=o/n/(1+t.left+t.right),h=a/r/(1+t.top+t.bottom)}this.mapGraph.attr("transform","translate("+l+","+s+")"),this.mapSvg.style("transform","translate3d("+(e.left+(this.width-o)/2)+"px,"+(e.top+(this.height-a)/2)+"px,0)").attr("width",o).attr("height",a);var p=this;this.skew=function(){var t=p.width,e=p.height;return function(i){var n=i[0]*u+(t-o)/2+l*u,r=i[1]*h+(e-a)/2+s*h;return[n,r]}}()},updateMarkerSizeLimits:function(){var t=this,e=this.model.marker.size.extent||[0,1],i=this.activeProfile.minRadius,n=this.activeProfile.maxRadius;this.minRadius=Math.max(n*e[0],i),this.maxRadius=Math.max(n*e[1],i),"ordinal"!==this.model.marker.size.scaleType?this.sScale.range([o.radiusToArea(t.minRadius),o.radiusToArea(t.maxRadius)]):this.sScale.rangePoints([o.radiusToArea(t.minRadius),o.radiusToArea(t.maxRadius)],0).range()},_interact:function(){var t=this;return{_mouseover:function(e,i){t.model.time.dragging||(t.model.marker.highlightMarker(e),t.hovered=e,t.updateTitleNumbers(),t.fitSizeOfTitles(),t.model.marker.isSelected(e)?t._setTooltip():t._setTooltip(e))},_mouseout:function(e,i){t.model.time.dragging||(t._setTooltip(),t.hovered=null,t.updateTitleNumbers(),t.fitSizeOfTitles(),t.model.marker.clearHighlighted())},_click:function(e,i){t.model.marker.selectMarker(e)}}},highlightMarkers:function(){var t=this;this.someHighlighted=this.model.marker.highlight.length>0,o.isTouchDevice()&&(this.someHighlighted?t.hovered=this.model.marker.highlight[0]:t.hovered=null,t.updateTitleNumbers(),t.fitSizeOfTitles())},_updateLabel:function(t,e,i,n,r,a,s,l){var c=this,u=this.KEY;if(t[u]!=c.druging&&(null==l&&(l=c.duration),c.model.marker.isSelected(t))){var h=t.hidden!==t.hidden_1,d=null,f={};f.labelX0=i/this.width,f.labelY0=n/this.height,f.scaledS0=r?o.areaToRadius(c.sScale(r)):null,f.scaledC0=null!=a?c.cScale(a):c.COLOR_WHITEISH,this._labels.updateLabel(t,e,f,i/this.width,n/this.height,r,a,s,d,l,h)}},selectMarkers:function(){var t=this;this.KEY;this.someSelected=this.model.marker.select.length>0,
o.isTouchDevice()?(t._labels.showCloseCross(null,!1),t.someHighlighted?t.model.marker.clearHighlighted():(t.updateTitleNumbers(),t.fitSizeOfTitles())):t.hovered&&!t.model.marker.isSelected(t.hovered)||t._setTooltip(),this.nonSelectedOpacityZero=!1},_setTooltip:function(t){if(t){var e=t.label,i=t.cLoc[0],n=t.cLoc[1],r=t.r,a=d3.mouse(this.graph.node()).map(function(t){return parseInt(t)}),o=void 0,s=void 0,l=-1,c=-1,u=0,h=0;r&&(u=.71*r,h=.71*r),this.tooltip.classed("vzb-hidden",!1).selectAll("text").text(e);var d=this.tooltip.select("text").node().getBBox();i-u-d.width<0?(l=1,i+=d.width+5):i-=5,n-h-d.height<0?(c=1,n+=d.height):n-=11,r?(o=i+u*l,s=n+h*c):(o=i+u*l,s=n+h*c),this.tooltip.attr("transform","translate("+(o?o:a[0])+","+(s?s:a[1])+")"),this.tooltip.select("rect").attr("width",d.width+8).attr("height",1.2*d.height).attr("x",-d.width-4).attr("y",.85*-d.height).attr("rx",.2*d.height).attr("ry",.2*d.height)}else this.tooltip.classed("vzb-hidden",!0)},preload:function(){var t=this,e=this.model.ui.map.topology.path||b.default.ext_resources.host+b.default.ext_resources.preloadPath+"world-50m.json";return new Promise(function(i,n){d3.json(e,function(n,r){return n?console.warn("Failed loading json "+e+". "+n):(t.topology=r,void i())})})}});e.default=_},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var a=i(1),o=r(a),s=i(2),l=n(s),c=i(73),u=n(c),h=i(10),d=i(89),f=n(d),p=i(60),m=n(p),g=i(34),v=n(g),y=l.default.extend({init:function(t,e){this.name="cartogram",this.template=i(463),this.isMobile=o.isMobileOrTablet(),this.model_expects=[{name:"time",type:"time"},{name:"entities",type:"entities"},{name:"marker",type:"model"},{name:"locale",type:"locale"},{name:"ui",type:"ui"}];var n=this;this.model_binds={"change:time.value":function(t){n._readyOnce&&(n.calculationQueue?n.calculationQueue.push(n.model.time.value.toString()):n.calculationQueue=[n.model.time.value.toString()],function(t){n.model.marker.getFrame(t,function(t,e){var i=n.calculationQueue.indexOf(e.toString());i!=-1&&(n.calculationQueue.splice(0,i+1),n.frameChanged(t,e))})}(n.model.time.value))},"change:marker.size.extent":function(t,e){n._readyOnce&&(n.updateMarkerSizeLimits(),n.updateEntities())},"change:marker.color.scaleType":function(t,e){n.updateIndicators(),n.updateEntitityColor()},"change:marker.size.use":function(t,e){n.model.ui.chart.lockActive="constant"!=n.model.marker.size.use},"change:marker.color.palette":function(t,e){n.updateEntitityColor()},"change:ui.chart.lockNonSelected":function(t){n.updateEntities(900)},"change:entities.select":function(){n._readyOnce&&n.updateLandOpacity()},"change:entities.highlight":function(){n._readyOnce&&n.updateLandOpacity()},"change:entities.opacitySelectDim":function(){n.updateLandOpacity()},"change:entities.opacityRegular":function(){n.updateLandOpacity()}},this._super(t,e),n.COLOR_LAND_DEFAULT="#fdfdfd",this.lands=null,this.features=null,this.topo_features=null,this.borderArcs=null,this.defaultWidth=700,this.defaultHeight=550,this.updateEntitiesQueue=[],this.boundBox=[[.05,0],[.95,1]],(0,f.default)(),this.cached=[],this.projection=d3.geo.mercator().center([25,-29]).scale(1900).translate([this.defaultWidth/2,this.defaultHeight/2]).precision(.1),this.cartogram=d3.cartogram().projection(this.projection).properties(function(t){return t.properties}),this._labels=new u.default(this),this._labels.config({CSS_PREFIX:"vzb-ct",LABELS_CONTAINER_CLASS:"vzb-ct-labels",LINES_CONTAINER_CLASS:"vzb-ct-lines"})},afterPreload:function(){var t=this;this.world||o.warn("cartogram afterPreload: missing country shapes "+this.world),this.geometries||o.warn("cartogram afterPreload: missing country shapes "+this.geometries),this.borderArcs=t.cartogram.meshArcs(this.world,this.world.objects.topo,function(t,e){return t.properties.MN_NAME&&t.properties.PR_NAME!==e.properties.PR_NAME})},_getKey:function(t){return t.properties[this.id_lookup]?t.properties[this.id_lookup].toString():t.id.toString()},readyOnce:function(){var t=this;this.element=d3.select(this.element),this.graph=this.element.select(".vzb-ct-graph"),this.mapSvg=this.element.select(".vzb-ct-map-background"),this.labelsContainerCrop=this.graph.select(".vzb-ct-labels-crop"),this.labelsContainer=this.graph.select(".vzb-ct-labels"),this.yTitleEl=this.graph.select(".vzb-ct-axis-y-title"),this.sTitleEl=this.graph.select(".vzb-ct-axis-c-title"),this.yInfoEl=this.graph.select(".vzb-ct-axis-y-info"),this.sInfoEl=this.graph.select(".vzb-ct-axis-c-info"),this.dataWarningEl=this.graph.select(".vzb-data-warning"),this.entityBubbles=null,this.tooltip=this.element.select(".vzb-ct-tooltip"),this.yearEl=this.graph.select(".vzb-ct-year"),this.year=new m.default(this.yearEl),this.year.setConditions({xAlign:"left",yAlign:"bottom",bottomOffset:5}),this.mapGraph=this.element.select(".vzb-ct-map-graph").attr("width",this.defaultWidth).attr("height",this.defaultHeight),this.mapGraph.html(""),this.KEY=this.model.entities.getDimension(),this.TIMEDIM=this.model.time.getDimension();var e=this;this.updateUIStrings(),this.on("resize",function(){return t.updateSize()}),this.wScale=d3.scale.linear().domain(this.model.ui.datawarning.doubtDomain).range(this.model.ui.datawarning.doubtRange),this.cartogram.iterations(0),this.redrawInProgress=!0,this.cartogram(this.world,this.geometries).then(function(t){if(e.redrawInProgress=!1,e.features=e.topo_features=t.features,e.lands=e.mapGraph.selectAll(".land").data(e.topo_features).enter().append("path").attr("class",function(t){return"land "+(t.properties[e.id_lookup]?t.properties[e.id_lookup]:t.id)}).attr("d",e.cartogram.path).on("mouseover",function(t,i){o.isTouchDevice()||e._interact()._mouseover(t,i)}).on("mouseout",function(t,i){o.isTouchDevice()||e._interact()._mouseout(t,i)}).on("click",function(t,i){o.isTouchDevice()||e._interact()._click(t,i)}).each(function(t){t[e.KEY]=e._getKey(t)}),e.borderArcs){var i=e.cartogram.stitchArcs(t,e.borderArcs);e.borders=e.mapGraph.append("path").datum(i).attr("class","boundary").attr("d",e.cartogram.path)}})},frameChanged:function(t,e){e.toString()==this.model.time.value.toString()&&t&&(this.values=t,this.updateTime(),this.updateTitleNumbers(),this.updateEntities(this.duration))},ready:function(){var t=this;this.cached=[],this.updateIndicators(),this.updateUIStrings(),this.updateMarkerSizeLimits(),this.updateSize(),this.model.marker.getFrame(t.model.time.value,t.frameChanged.bind(t))},updateIndicators:function(){this.sScale=this.model.marker.size.getScale(),this.cScale=this.model.marker.color.getScale()},updateMarkerSizeLimits:function(){var t=this.model.marker.size.extent||[0,1];this.minRadius=Math.max(100*t[0],0),this.maxRadius=Math.max(100*t[1],0),this.sScale.domain([0,this.sScale.domain()[1]]),"ordinal"!==this.model.marker.size.scaleType?this.sScale.range([this.minRadius,this.maxRadius]):this.sScale.rangePoints([this.minRadius,this.maxRadius],0).range()},_calculateTotalSize:function(t,e){if(this.cached[t])return this.cached[t];var i=this;return this.cached[t]=0,o.forEach(e,function(e){i.cached[t]+=i.sScale(e)}),this.cached[t]},_redrawEntities:function(){var t=this;if(0!=this.updateEntitiesQueue.length){if(this.redrawInProgress)return void setTimeout(function(){t._redrawEntities()},100);this.redrawInProgress=!0;var e=this.updateEntitiesQueue[this.updateEntitiesQueue.length-1].time,i=this.updateEntitiesQueue[this.updateEntitiesQueue.length-1].duration;this.updateEntitiesQueue=[],this.model.ui.chart.lockNonSelected&&(e=this.model.time.parse(""+this.model.ui.chart.lockNonSelected)),this.model.marker.getFrame(e,function(e){var n=null;"constant"==t.model.marker.size.use?t.cartogram.iterations(0):(t.cartogram.iterations(8),t.cartogram.value(function(i){if(t.model.ui.chart.lockNonSelected){var n=t.sScale(e.size[t._getKey(i)]),r=t.sScale(t.values.size[t._getKey(i)]);return d3.geo.path().projection(null).area(i)*Math.pow(r/n,2)}return t.sScale(t.values.size[t._getKey(i)])}));var r=(new Date).getTime();t.cartogram(t.world,t.geometries,n).then(function(e){var n=(new Date).getTime();if(i&&(i=Math.max(i,n-r)),t.features=e.features,t.borderArcs){var a=t.cartogram.stitchArcs(e,t.borderArcs);t.borders.datum(a).transition().duration(i).ease(d3.easeLinear).attr("d",t.cartogram.path)}t.lands.data(t.features).each(function(e){e[t.KEY]=t._getKey(e)}),i?(t.lands.interrupt().transition().duration(i).ease(d3.easeLinear).style("fill",function(e){return null!=t.values.color[t._getKey(e)]?t.cScale(t.values.color[t._getKey(e)]):t.COLOR_LAND_DEFAULT}).attr("d",t.cartogram.path),t.borderArcs&&t.borders.interrupt().transition().duration(i).ease(d3.easeLinear).attr("d",t.cartogram.path)):(t.borders.attr("d",t.cartogram.path),t.lands.style("fill",function(e){return null!=t.values.color[t._getKey(e)]?t.cScale(t.values.color[t._getKey(e)]):t.COLOR_LAND_DEFAULT}).attr("d",t.cartogram.path)),t.updateLandOpacity(),t.redrawInProgress=!1,t._redrawEntities()})})}},updateEntities:function(t){var e=this.model.time.value;this.updateEntitiesQueue.push({time:e,duration:t}),this._redrawEntities()},updateEntitityColor:function(){var t=this;this.lands.transition().duration(t.duration).ease(d3.easeLinear).style("fill",function(e){return null!=t.values.color[t._getKey(e)]?t.cScale(t.values.color[t._getKey(e)]):t.COLOR_LAND_DEFAULT})},updateUIStrings:function(){var t=this;this.translator=this.model.locale.getTFunction();this.model.marker.size.getConceptprops();this.strings={title:{C:("constant"!==t.model.marker.size.use?this.translator("buttons/color")+": ":"")+this.translator("indicator/"+t.model.marker.color.which),S:this.translator("buttons/size")+": "+this.translator("indicator/"+t.model.marker.size.which)}},this.yTitleEl.select("text").text(this.strings.title.C).on("click",function(){t.parent.findChildByName("gapminder-treemenu").markerID("color").alignX("left").alignY("top").updateView().toggle()}),this.sTitleEl.select("text").text(this.strings.title.S).on("click",function(){t.parent.findChildByName("gapminder-treemenu").markerID("size").alignX("left").alignY("top").updateView().toggle()}),o.setIcon(this.dataWarningEl,h.warn).select("svg").attr("width","0px").attr("height","0px"),this.dataWarningEl.append("text").attr("text-anchor","end").text(this.translator("hints/dataWarning")),this.dataWarningEl.on("click",function(){t.parent.findChildByName("gapminder-datawarning").toggle()}).on("mouseover",function(){t.updateDoubtOpacity(1)}).on("mouseout",function(){t.updateDoubtOpacity()}),this.yInfoEl.html(h.question).select("svg").attr("width","0px").attr("height","0px"),this.yInfoEl.on("click",function(){t.parent.findChildByName("gapminder-datanotes").pin()}),this.yInfoEl.on("mouseover",function(){var e=this.getBBox(),i=o.makeAbsoluteContext(this,this.farthestViewportElement)(e.x-10,e.y+e.height+10);t.parent.findChildByName("gapminder-datanotes").setHook("size").show().setPos(i.x,i.y)}),this.yInfoEl.on("mouseout",function(){t.parent.findChildByName("gapminder-datanotes").hide()}),this.sInfoEl.html(h.question).select("svg").attr("width","0px").attr("height","0px"),this.sInfoEl.on("click",function(){t.parent.findChildByName("gapminder-datanotes").pin()}),this.sInfoEl.on("mouseover",function(){var e=this.getBBox(),i=o.makeAbsoluteContext(this,this.farthestViewportElement)(e.x-10,e.y+e.height+10);t.parent.findChildByName("gapminder-datanotes").setHook("color").show().setPos(i.x,i.y)}),this.sInfoEl.on("mouseout",function(){t.parent.findChildByName("gapminder-datanotes").hide()})},updateDoubtOpacity:function(t){null==t&&(t=this.wScale(+this.time.getUTCFullYear().toString())),this.someSelected&&(t=1),this.dataWarningEl.style("opacity",t)},updateTime:function(){this.time_1=null==this.time?this.model.time.value:this.time,this.time=this.model.time.value,this.duration=this.model.time.playing&&this.time-this.time_1>0?this.model.time.delayAnimations:0,this.year.setText(this.model.time.formatDate(this.time),this.duration)},updateSize:function(){var t={small:{margin:{top:10,right:10,left:10,bottom:0},infoElHeight:16},medium:{margin:{top:20,right:20,left:20,bottom:30},infoElHeight:20},large:{margin:{top:30,right:30,left:30,bottom:35},infoElHeight:22}},e={medium:{infoElHeight:26},large:{infoElHeight:32}};this.activeProfile=this.getActiveProfile(t,e);var i=this.activeProfile.margin,n=this.activeProfile.infoElHeight,r=this.height=parseInt(this.element.style("height"),10)-i.top-i.bottom||0,a=this.width=parseInt(this.element.style("width"),10)-i.left-i.right||0;if(this.height<=0||this.width<=0)return o.warn("Bubble map updateSize() abort: vizabi container is too little or has display:none");var s=this.boundBox,l=[s[0][0]*this.defaultWidth,s[0][1]*this.defaultHeight,Math.abs(s[1][0]-s[0][0])*this.defaultWidth,Math.abs(s[1][1]-s[0][1])*this.defaultHeight];this.graph.attr("transform","translate("+i.left+","+i.top+")"),this.year.resize(this.width,this.height),this.mapSvg.attr("width",a).attr("height",r).attr("viewBox",l.join(" ")).attr("preserveAspectRatio","xMidYMid").attr("x",i.left).attr("y",i.top).style("transform","translate3d("+i.left+"px,"+i.top+"px,0)"),this.yTitleEl.style("font-size",n).attr("transform","translate(0,"+i.top+")");var c=this.yTitleEl.select("text").node().getBBox();this.sTitleEl.attr("transform","translate(0,"+(i.top+c.height)+")").classed("vzb-hidden","constant"==this.model.marker.size.use);var u=this.dataWarningEl.select("text").node().getBBox();if(this.dataWarningEl.select("svg").attr("width",.75*u.height).attr("height",.75*u.height).attr("x",-u.width-1.2*u.height).attr("y",.65*-u.height),this.dataWarningEl.attr("transform","translate("+this.width+","+(this.height-.5*u.height)+")").select("text"),this.yInfoEl.select("svg").node()){var h=this.yTitleEl.node().getBBox(),d=d3.transform(this.yTitleEl.attr("transform")).translate;this.yInfoEl.select("svg").attr("width",n).attr("height",n),this.yInfoEl.attr("transform","translate("+(h.x+d[0]+h.width+.4*n)+","+(d[1]-.8*n)+")")}if(this.sInfoEl.classed("vzb-hidden",this.sTitleEl.classed("vzb-hidden")),!this.sInfoEl.classed("vzb-hidden")&&this.sInfoEl.select("svg").node()){var f=this.sTitleEl.node().getBBox(),p=d3.transform(this.sTitleEl.attr("transform")).translate;this.sInfoEl.select("svg").attr("width",n).attr("height",n),this.sInfoEl.attr("transform","translate("+(f.x+p[0]+f.width+.4*n)+","+(p[1]-.8*n)+")")}},fitSizeOfTitles:function(){var t=this.yTitleEl.select("text").style("font-size",null),e=this.sTitleEl.select("text").style("font-size",null),i=t.node().getBBox(),n=this.sTitleEl.classed("vzb-hidden")?i:e.node().getBBox(),r=Math.max(parseInt(t.style("font-size")),parseInt(e.style("font-size")))*this.width/Math.max(i.width,n.width);Math.max(i.width,n.width)>this.width?(t.style("font-size",r+"px"),e.style("font-size",r+"px")):(t.style("font-size",null),e.style("font-size",null))},_interact:function(){var t=this;return{_mouseover:function(e,i){t.model.time.dragging||(t.model.entities.highlightEntity(e),t.hovered=e,t.updateTitleNumbers(),t.fitSizeOfTitles(),t.model.entities.isSelected(e)?t._setTooltip():t._setTooltip(e))},_mouseout:function(e,i){t.model.time.dragging||(t._setTooltip(),t.hovered=null,t.updateTitleNumbers(),t.fitSizeOfTitles(),t.model.entities.clearHighlighted())},_click:function(e,i){t.model.entities.selectEntity(e)}}},updateTitleNumbers:function(){var t=this,e=void 0;if(t.isMobile&&t.model.entities.select&&1===t.model.entities.select.length&&(e=t.model.entities.select[0]),t.hovered||e){var i=t.hovered||e,n=t.model.marker.color.getTickFormatter(),r=t.translator("unit/"+t.model.marker.color.which);r==="unit/"+t.model.marker.color.which&&(r="");var a=t.values.color[t._getKey(i)];if(t.yTitleEl.select("text").text(this.strings.title.C+": "+(a||0===a?n(a)+" "+r:t.translator("hints/nodata"))),"constant"!==this.model.marker.size.use){var o=t.model.marker.size.getTickFormatter(),s=t.translator("unit/"+t.model.marker.size.which);s==="unit/"+t.model.marker.size.which&&(s="");var l=t.values.size[t._getKey(i)];t.sTitleEl.select("text").text(this.strings.title.S+": "+o(l)+" "+s)}this.yInfoEl.classed("vzb-hidden",!0),this.sInfoEl.classed("vzb-hidden",!0)}else this.yTitleEl.select("text").text(this.strings.title.C),this.sTitleEl.select("text").text(this.strings.title.S),this.yInfoEl.classed("vzb-hidden",!1),this.sInfoEl.classed("vzb-hidden",!1)},_setTooltip:function(t){if(t){var e=this.values.label[this._getKey(t)]?this.values.label[this._getKey(t)]:t.properties.MN_NAME,i=10,n=d3.mouse(this.graph.node()).map(function(t){return parseInt(t)}),r=n[0],a=n[1],o=void 0,s=void 0,l=-1,c=-1,u=0,h=0;i&&(u=.71*i,h=.71*i),this.tooltip.classed("vzb-hidden",!1).selectAll("text").text(e);var d=this.tooltip.select("text").node().getBBox();r-u-d.width<0?(l=1,r+=d.width+5):r-=5,a-h-d.height<0?(c=1,a+=d.height):a-=11,i?(o=r+u*l,s=a+h*c):(o=r+u*l,s=a+h*c),this.tooltip.attr("transform","translate("+(o?o:n[0])+","+(s?s:n[1])+")"),this.tooltip.select("rect").attr("width",d.width+8).attr("height",1.2*d.height).attr("x",-d.width-4).attr("y",.85*-d.height).attr("rx",.2*d.height).attr("ry",.2*d.height)}else this.tooltip.classed("vzb-hidden",!0)},updateLandOpacity:function(){var t=this,e=.8,i=.3,n=this.model.entities.opacityRegular,r=this.model.entities.opacityRegular,a=this.model.entities.opacitySelectDim;this.someHighlighted=this.model.entities.highlight.length>0,this.someSelected=this.model.entities.select.length>0,this.lands.style("opacity",function(o){return t.someHighlighted&&t.model.entities.isHighlighted(o)?e:t.someSelected?t.model.entities.isSelected(o)?n:a:t.someHighlighted?i:r});var o=t.someSelected&&t.model.entities.opacitySelectDim<.01;o!=this.someSelectedAndOpacityZero_1&&this.lands.style("pointer-events",function(e){return!o||t.model.entities.isSelected(e)?"visible":"none"}),this.someSelectedAndOpacityZero_1=t.someSelected&&t.model.entities.opacitySelectDim<.01},preload:function(){var t=this,e=v.default.ext_resources.shapePath?v.default.ext_resources.shapePath:v.default.ext_resources.host+v.default.ext_resources.preloadPath+"municipalities.json";return new Promise(function(i,n){d3.json(e,function(n,r){return n?console.warn("Failed loading json "+e+". "+n):(t.world=r,t.geometries=r.objects.topo.geometries,t.id_lookup=r.objects.id_lookup,void i())})})}});e.default=y},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var a=i(1),o=r(a),s=i(2),l=n(s),c=l.default.extend("donut",{init:function(t,e){var i=this;this.name="donutchart",this.template='<div class="vzb-donutchart"><svg class="vzb-donutchart-svg"></svg></div>',this.model_expects=[{name:"time",type:"time"},{name:"marker",type:"model"}],this.model_binds={"change:time:value":function(t){i._readyOnce&&(i.time=i.model.time.value,i.yearEl.text(i.timeFormatter(i.time)),i.redraw())}},this._super(t,e),this.colorScale=null,this.arc=d3.svg.arc(),this.pie=d3.layout.pie().sort(null).value(function(t){return t.pop})},readyOnce:function(){var t=this;this.element=d3.select(this.element),this.svgEl=this.element.select("svg").append("g"),this.yearEl=this.svgEl.append("text").attr("class","year").style({"font-size":"4em"}),this.titleEl=this.svgEl.append("text").attr("class","title").style({"font-size":"2em"}),this.on("resize",function(){t.resize(),t.redraw()}),this.resize(),this.update(),this.redraw()},update:function(){this.timeFormatter=this.model.time.formatters.data("%Y"),this.colorScale=this.model.marker.color.getScale(),this.titleEl.text("Population"),this.keys=this.model.marker.getKeys(),this.entities=this.svgEl.selectAll(".vzb-dc-entity").data(this.keys),this.entities.exit().remove(),this.entities.enter().append("g").attr("class","vzb-dc-entity").each(function(){d3.select(this).append("path"),d3.select(this).append("text").attr("class","label").style({"font-size":"1.2em"})})},redraw:function(){var t=this;this.values=this.model.marker.getValues({time:t.time},["geo"]);var e=this.keys.map(function(e){return{geo:e.geo,pop:t.values.axis[e.geo],color:t.values.color[e.geo],label:t.values.label[e.geo]}});e=this.pie(e),this.entities.data(e).select("path").attr("d",this.arc).style("fill",function(e){return t.colorScale(e.data.color)}).style("stroke","white"),this.entities.select("text").style({"text-transform":"capitalize"}).attr("transform",function(e){return"translate("+t.arc.centroid(e)+")"}).text(function(t){return t.data.geo})},resize:function(){var t=parseInt(this.element.style("height"),10)||0,e=parseInt(this.element.style("width"),10)||0,i=Math.min(t,e);return t<=0||e<=0?o.warn("Donut chart resize() abort: vizabi container is too little or has display:none"):(this.svgEl.attr("transform","translate("+e/2+","+t/2+")"),this.titleEl.attr("y","-0.1em"),this.yearEl.attr("y","0.1em"),void this.arc.outerRadius(i/2*.9).innerRadius(i/2-.1*i))}});e.default=c},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var a=i(1),o=r(a),s=i(2),l=n(s),c=i(73),u=n(c),h=i(10),d=i(60),f=n(d),p=i(34),m=(n(p),i(226)),g=n(m),v=l.default.extend({init:function(t,e){this.name="bubblemap",this.template=i(464),this.bubblesDrawing=null,this.isMobile=o.isMobileOrTablet(),this.model_expects=[{name:"time",type:"time"},{name:"entities",type:"entities"},{name:"marker",type:"model"},{name:"locale",type:"locale"},{name:"ui",type:"ui"}];var n=this;this.model_binds={"change:time.value":function(t){n._readyOnce&&n.model.marker.getFrame(n.model.time.value,n.frameChanged.bind(n))},"change:marker.highlight":function(t){n._readyOnce&&(n.highlightMarkers(),n.updateOpacity())},"change:marker":function(t,e){n._readyOnce&&e.indexOf("scaleType")>-1&&n.ready()},"change:marker.size.extent":function(t,e){n._readyOnce&&n.entityBubbles&&(n.updateMarkerSizeLimits(),n.redrawDataPoints(null,!1))},"change:marker.color.palette":function(t,e){n._readyOnce&&n.redrawDataPoints(null,!1)},"change:marker.select":function(t){n._readyOnce&&(n.selectMarkers(),n.redrawDataPoints(null,!1),n.updateOpacity(),n.updateDoubtOpacity())},"change:marker.opacitySelectDim":function(t){n.updateOpacity()},"change:marker.opacityRegular":function(t){n.updateOpacity()},"change:ui.map.mapLayer":function(t){n.map.layerChanged()}},this._super(t,e),this.sScale=null,this.cScale=d3.scaleOrdinal(d3.schemeCategory10),n.COLOR_WHITEISH="#fdfdfd",this._labels=new u.default(this),this._labels.config({CSS_PREFIX:"vzb-bmc",LABELS_CONTAINER_CLASS:"vzb-bmc-labels",LINES_CONTAINER_CLASS:"vzb-bmc-lines",SUPPRESS_HIGHLIGHT_DURING_PLAY:!1})},readyOnce:function(){this.element=d3.select(this.element),this.graph=this.element.select(".vzb-bmc-graph"),this.bubbleContainerCrop=this.graph.select(".vzb-bmc-bubbles-crop"),this.bubbleContainer=this.graph.select(".vzb-bmc-bubbles"),this.labelListContainer=this.graph.select(".vzb-bmc-bubble-labels"),this.dataWarningEl=this.graph.select(".vzb-data-warning"),this.yTitleEl=this.graph.select(".vzb-bmc-axis-y-title"),this.cTitleEl=this.graph.select(".vzb-bmc-axis-c-title"),this.yInfoEl=this.graph.select(".vzb-bmc-axis-y-info"),this.cInfoEl=this.graph.select(".vzb-bmc-axis-c-info"),this.entityBubbles=null,this.tooltip=this.element.select(".vzb-bmc-tooltip"),this.yearEl=this.graph.select(".vzb-bmc-year"),this.year=new f.default(this.yearEl),this.year.setConditions({xAlign:"left",yAlign:"bottom"});var t=this;this.on("resize",function(){t.updateSize()||t.map.rescaleMap()}),this.KEY=this.model.entities.getDimension(),this.TIMEDIM=this.model.time.getDimension(),this.updateUIStrings(),this.wScale=d3.scale.linear().domain(this.model.ui.datawarning.doubtDomain).range(this.model.ui.datawarning.doubtRange),this._labels.readyOnce()},ready:function(){var t=this;this.updateUIStrings(),this.updateIndicators(),this.updateSize(),this.map.rescaleMap(),this.updateMarkerSizeLimits(),this.model.marker.getFrame(this.model.time.value,function(e,i){return i.toString()!=t.model.time.value.toString()?void o.defer(function(){t.ready()}):void(e&&(t.values=e,t.updateEntities(),t.updateTime(),t._labels.ready(),t.redrawDataPoints(),t.highlightMarkers(),t.selectMarkers(),t.updateDoubtOpacity(),t.updateOpacity()))})},frameChanged:function(t,e){e.toString()==this.model.time.value.toString()&&t&&(this.values=t,this.updateTime(),this.updateDoubtOpacity(),this.redrawDataPoints(null,!1))},updateUIStrings:function(){var t=this;this.translator=this.model.locale.getTFunction();var e=t.model.marker.size.getConceptprops(),i=t.model.marker.color.getConceptprops();this.strings={title:{S:e.name,C:i.name}},this.yTitleEl.select("text").text(this.translator("buttons/size")+": "+this.strings.title.S).on("click",function(){t.parent.findChildByName("gapminder-treemenu").markerID("size").alignX(t.model.locale.isRTL()?"right":"left").alignY("top").updateView().toggle()}),this.cTitleEl.select("text").text(this.translator("buttons/color")+": "+this.strings.title.C).on("click",function(){t.parent.findChildByName("gapminder-treemenu").markerID("color").alignX(t.model.locale.isRTL()?"right":"left").alignY("top").updateView().toggle()}),o.setIcon(this.dataWarningEl,h.warn).select("svg").attr("width","0px").attr("height","0px"),this.dataWarningEl.append("text").attr("text-anchor","end").text(this.translator("hints/dataWarning")),this.dataWarningEl.on("click",function(){t.parent.findChildByName("gapminder-datawarning").toggle()}).on("mouseover",function(){t.updateDoubtOpacity(1)}).on("mouseout",function(){t.updateDoubtOpacity()}),this.yInfoEl.html(h.question).select("svg").attr("width","0px").attr("height","0px"),this.yInfoEl.on("click",function(){t.parent.findChildByName("gapminder-datanotes").pin()}),this.yInfoEl.on("mouseover",function(){var e=this.getBBox(),i=o.makeAbsoluteContext(this,this.farthestViewportElement)(e.x-10,e.y+e.height+10),n=t.root.element.getBoundingClientRect(),r=t.element.node().getBoundingClientRect();t.parent.findChildByName("gapminder-datanotes").setHook("size").show().setPos(i.x+r.left-n.left,i.y)}),this.yInfoEl.on("mouseout",function(){t.parent.findChildByName("gapminder-datanotes").hide()}),this.cInfoEl.html(h.question).select("svg").attr("width","0px").attr("height","0px"),this.cInfoEl.on("click",function(){t.parent.findChildByName("gapminder-datanotes").pin()}),this.cInfoEl.on("mouseover",function(){var e=this.getBBox(),i=o.makeAbsoluteContext(this,this.farthestViewportElement)(e.x-10,e.y+e.height+10),n=t.root.element.getBoundingClientRect(),r=t.element.node().getBoundingClientRect();t.parent.findChildByName("gapminder-datanotes").setHook("color").show().setPos(i.x+r.left-n.left,i.y)}),this.cInfoEl.on("mouseout",function(){t.parent.findChildByName("gapminder-datanotes").hide()})},updateTitleNumbers:function(){var t=this,e=void 0;if(t.isMobile&&t.model.marker.select&&1===t.model.marker.select.length&&(e=t.model.marker.select[0]),t.hovered||e){var i=t.model.marker.size.getConceptprops(),n=t.model.marker.color.getConceptprops(),r=t.hovered||e,a=t.model.marker.size.getTickFormatter(),o=t.model.marker.color.getTickFormatter(),s=i.unit||"",l=n.unit||"",c=t.values.size[r[t.KEY]],u=t.values.color[r[t.KEY]];t.model.marker.color.isDiscrete()&&u&&(u=this.model.marker.color.getColorlegendMarker().label.getItems()[u]||""),t.yTitleEl.select("text").text(t.translator("buttons/size")+": "+a(c)+" "+s),t.cTitleEl.select("text").text(t.translator("buttons/color")+": "+(u||0===u?o(u)+" "+l:t.translator("hints/nodata"))),this.yInfoEl.classed("vzb-hidden",!0),this.cInfoEl.classed("vzb-hidden",!0)}else this.yTitleEl.select("text").text(this.translator("buttons/size")+": "+this.strings.title.S),this.cTitleEl.select("text").text(this.translator("buttons/color")+": "+this.strings.title.C),this.yInfoEl.classed("vzb-hidden",!1),this.cInfoEl.classed("vzb-hidden",this.cTitleEl.classed("vzb-hidden"))},updateDoubtOpacity:function(t){null==t&&(t=this.wScale(+this.time.getUTCFullYear().toString())),this.someSelected&&(t=1),this.dataWarningEl.style("opacity",t)},updateOpacity:function(){var t=this,e=1,i=.3,n=this.model.marker.opacityRegular,r=this.model.marker.opacityRegular,a=this.model.marker.opacitySelectDim;this.entityBubbles.style("opacity",function(o){return t.someHighlighted&&t.model.marker.isHighlighted(o)?e:t.someSelected?t.model.marker.isSelected(o)?n:a:t.someHighlighted?i:r}),this.entityBubbles.classed("vzb-selected",function(e){return t.model.marker.isSelected(e)});var o=t.model.marker.opacitySelectDim<.01;o!==this.nonSelectedOpacityZero&&this.entityBubbles.style("pointer-events",function(e){return t.someSelected&&o&&!t.model.marker.isSelected(e)?"none":"visible"}),this.nonSelectedOpacityZero=t.model.marker.opacitySelectDim<.01},updateIndicators:function(){this.sScale=this.model.marker.size.getScale(),this.cScale=this.model.marker.color.getScale()},updateEntities:function(){var t=this,e=this.KEY,i=this.TIMEDIM,n=function(n){return n=n||"",t.model.marker.getKeys().map(function(a){var o={};return o[e]=a[e],o[i]=r,o.sortValue=t.values.size[a[e]]||0,o[e]=n+a[e],o}).sort(function(t,e){return e.sortValue-t.sortValue})},r=this.model.time.end;this.model.marker.setVisible(n.call(this)),this.model.time.splash||this.unselectBubblesWithNoData(),this.entityBubbles=this.bubbleContainer.selectAll(".vzb-bmc-bubble").data(this.model.marker.getVisible(),function(t){return t[e]}).order(),this.entityBubbles.exit().remove(),this.entityBubbles=this.entityBubbles.enter().append("circle").attr("class","vzb-bmc-bubble").on("mouseover",function(e,i){o.isTouchDevice()||t._interact()._mouseover(e,i)}).on("mouseout",function(e,i){o.isTouchDevice()||t._interact()._mouseout(e,i)}).on("click",function(e,i){o.isTouchDevice()||(t._interact()._click(e,i),t.highlightMarkers())}).onTap(function(e,i){t._interact()._click(e,i),d3.event.stopPropagation()}).onLongTap(function(t,e){}).merge(this.entityBubbles)},unselectBubblesWithNoData:function(t){var e=this,i=this.KEY;t||(t=this.values),t&&t.size&&this.model.marker.select.forEach(function(n){t.size[n[i]]||0===t.size[n[i]]||e.model.marker.selectMarker(n)})},redrawDataPoints:function(t,e){var i=this;return t||(t=this.duration),e||(e=!0),this.entityBubbles?void this.entityBubbles.each(function(n,r){var a=d3.select(this),s=d3.select("#"+n[i.KEY]),l=i.values.hook_lng[n[i.KEY]],c=i.values.hook_lat[n[i.KEY]],u=i.values.size[n[i.KEY]],h=i.values.color[n[i.KEY]],d=i.values.label[n[i.KEY]];n.hidden_1=n.hidden,n.hidden=!u&&0!==u||null==l||null==c,n.hidden!==n.hidden_1&&(t?a.transition().duration(t).ease(d3.easeLinear).style("opacity",0).on("end",function(){return a.classed("vzb-hidden",n.hidden).style("opacity",i.model.marker.opacityRegular)}):a.classed("vzb-hidden",n.hidden)),n.hidden?i._updateLabel(n,r,0,0,u,h,d,t):(n.r=o.areaToRadius(i.sScale(u||0)),n.label=d,a.classed("vzb-hidden",!1).attr("fill",null!=h?i.cScale(h):i.COLOR_WHITEISH),i.model.ui.map.colorGeo&&s.style("fill",null!=h?i.cScale(h):"#999"),e&&(n.cLoc=i.map.invert(l,c),a.attr("cx",n.cLoc[0]).attr("cy",n.cLoc[1])),t?a.transition().duration(t).ease(d3.easeLinear).attr("r",n.r):a.interrupt().attr("r",n.r).transition(),i._updateLabel(n,r,n.cLoc[0],n.cLoc[1],u,h,n.label,t))}):o.warn("redrawDataPoints(): no entityBubbles defined. likely a premature call, fix it!")},updateTime:function(){this.time_1=null==this.time?this.model.time.value:this.time,this.time=this.model.time.value,this.duration=this.model.time.playing&&this.time-this.time_1>0?this.model.time.delayAnimations:0,this.year.setText(this.model.time.formatDate(this.time),this.duration),this.updateTitleNumbers()},fitSizeOfTitles:function(){var t=this.yTitleEl.select("text");t.style("font-size",null);var e=this.cTitleEl.select("text");
e.style("font-size",null);var i=t.node().getBBox(),n=this.cTitleEl.classed("vzb-hidden")?i:e.node().getBBox(),r=Math.max(parseInt(t.style("font-size")),parseInt(e.style("font-size")))*this.width/Math.max(i.width,n.width);Math.max(i.width,n.width)>this.width?(t.style("font-size",r+"px"),e.style("font-size",r+"px")):(t.style("font-size",null),e.style("font-size",null))},profiles:{small:{margin:{top:10,right:10,left:10,bottom:0},infoElHeight:16,minRadius:.5,maxRadius:30},medium:{margin:{top:20,right:20,left:20,bottom:30},infoElHeight:20,minRadius:1,maxRadius:55},large:{margin:{top:30,right:30,left:30,bottom:35},infoElHeight:22,minRadius:1,maxRadius:65}},presentationProfileChanges:{medium:{infoElHeight:26},large:{infoElHeight:32}},updateSize:function(){this.activeProfile=this.getActiveProfile(this.profiles,this.presentationProfileChanges);var t=this.activeProfile.margin;return this.height=parseInt(this.element.style("height"),10)-t.top-t.bottom||0,this.width=parseInt(this.element.style("width"),10)-t.left-t.right||0,this.height<=0||this.width<=0?o.warn("Bubble map updateSize() abort: vizabi container is too little or has display:none"):void this.repositionElements()},mapBoundsChanged:function(){this.updateMarkerSizeLimits(),this._labels.updateSize(),this.redrawDataPoints()},repositionElements:function(){var t=this.activeProfile.margin,e=this.activeProfile.infoElHeight,i=this.model.locale.isRTL();this.graph.attr("transform","translate("+t.left+","+t.top+")"),this.year.setConditions({widthRatio:.2}),this.year.resize(this.width,this.height),this.yTitleEl.style("font-size",e).attr("transform","translate("+(i?this.width:0)+","+t.top+")");var n=this.yTitleEl.select("text").node().getBBox();this.cTitleEl.attr("transform","translate("+(i?this.width:0)+","+(t.top+n.height)+")").classed("vzb-hidden","large"===this.getLayoutProfile()||"constant"==this.model.marker.color.use);var r=this.dataWarningEl.select("text").node().getBBox();if(this.dataWarningEl.select("svg").attr("width",.75*r.height).attr("height",.75*r.height).attr("x",-r.width-1.2*r.height).attr("y",.65*-r.height),this.dataWarningEl.attr("transform","translate("+this.width+","+(this.height-.5*r.height)+")").select("text"),this.yInfoEl.select("svg").node()){var a=this.yTitleEl.node().getBBox(),s=o.transform(this.yTitleEl.node()),l=i?a.x+s.translateX-1.4*e:a.x+s.translateX+a.width+.4*e;this.yInfoEl.select("svg").attr("width",e).attr("height",e),this.yInfoEl.attr("transform","translate("+l+","+(s.translateY-.8*e)+")")}if(this.cInfoEl.classed("vzb-hidden",this.cTitleEl.classed("vzb-hidden")),!this.cInfoEl.classed("vzb-hidden")&&this.cInfoEl.select("svg").node()){var c=this.cTitleEl.node().getBBox(),u=o.transform(this.cTitleEl.node()),h=i?c.x+u.translateX-1.4*e:c.x+u.translateX+c.width+.4*e;this.cInfoEl.select("svg").attr("width",e).attr("height",e),this.cInfoEl.attr("transform","translate("+h+","+(u.translateY-.8*e)+")")}},updateMarkerSizeLimits:function(){var t=this,e=this.model.marker.size.extent||[0,1],i=this.activeProfile.minRadius,n=this.activeProfile.maxRadius;this.minRadius=Math.max(n*e[0],i),this.maxRadius=Math.max(n*e[1],i),"ordinal"!==this.model.marker.size.scaleType?this.sScale.range([o.radiusToArea(t.minRadius),o.radiusToArea(t.maxRadius)]):this.sScale.rangePoints([o.radiusToArea(t.minRadius),o.radiusToArea(t.maxRadius)],0).range()},_interact:function(){var t=this;return{_mouseover:function(e,i){t.model.time.dragging||(t.model.marker.highlightMarker(e),t.hovered=e,t.updateTitleNumbers(),t.fitSizeOfTitles(),t.model.marker.isSelected(e)?t._setTooltip():t._setTooltip(e))},_mouseout:function(e,i){t.model.time.dragging||(t._setTooltip(),t.hovered=null,t.updateTitleNumbers(),t.fitSizeOfTitles(),t.model.marker.clearHighlighted())},_click:function(e,i){t.model.marker.selectMarker(e)}}},highlightMarkers:function(){var t=this;this.someHighlighted=this.model.marker.highlight.length>0,o.isTouchDevice()&&(this.someHighlighted?t.hovered=this.model.marker.highlight[0]:t.hovered=null,t.updateTitleNumbers(),t.fitSizeOfTitles())},_updateLabel:function(t,e,i,n,r,a,s,l){var c=this,u=this.KEY;if(t[u]!=c.druging&&(null==l&&(l=c.duration),c.model.marker.isSelected(t))){var h=t.hidden!==t.hidden_1,d=null,f={};f.labelX0=i/this.width,f.labelY0=n/this.height,f.scaledS0=r?o.areaToRadius(c.sScale(r)):null,f.scaledC0=null!=a?c.cScale(a):c.COLOR_WHITEISH,this._labels.updateLabel(t,e,f,i/this.width,n/this.height,r,a,s,d,l,h)}},selectMarkers:function(){var t=this;this.KEY;this.someSelected=this.model.marker.select.length>0,o.isTouchDevice()?(t._labels.showCloseCross(null,!1),t.someHighlighted?t.model.marker.clearHighlighted():(t.updateTitleNumbers(),t.fitSizeOfTitles())):t.hovered&&!t.model.marker.isSelected(t.hovered)||t._setTooltip(),this.nonSelectedOpacityZero=!1},_setTooltip:function(t){if(t){var e=t.label,i=t.cLoc[0],n=t.cLoc[1],r=t.r,a=d3.mouse(this.graph.node()).map(function(t){return parseInt(t)}),o=void 0,s=void 0,l=-1,c=-1,u=0,h=0;r&&(u=.71*r,h=.71*r),this.tooltip.classed("vzb-hidden",!1).selectAll("text").text(e);var d=this.tooltip.select("text").node().getBBox();i-u-d.width<0?(l=1,i+=d.width+5):i-=5,n-h-d.height<0?(c=1,n+=d.height):n-=11,r?(o=i+u*l,s=n+h*c):(o=i+u*l,s=n+h*c),this.tooltip.attr("transform","translate("+(o?o:a[0])+","+(s?s:a[1])+")"),this.tooltip.select("rect").attr("width",d.width+8).attr("height",1.2*d.height).attr("x",-d.width-4).attr("y",.85*-d.height).attr("rx",.2*d.height).attr("ry",.2*d.height)}else this.tooltip.classed("vzb-hidden",!0)},preload:function(){this.initMap()},initMap:function(){return this.map=new g.default(this,"#vzb-map-background").getMap(),this.map.initMap()}});e.default=v},function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var a=i(16),o=r(a),s=i(34),l=r(s),c=i(1),u=n(c),h=i(139),d=r(h),f=i(89),p=r(f),m=i(469),g=r(m),v=i(434),y=o.default.extend({init:function(t,e){this.shapes=null,this.parent=e,this.context=t,(0,p.default)()},initMap:function(){var t=this;this.mapGraph=this.parent.mapSvg.html("").append("g").attr("class","vzb-bmc-map-graph");var e=this,i=this.context.model.ui.map.topology.path||l.default.ext_resources.host+l.default.ext_resources.preloadPath+"world-50m.json",n="geo"+u.capitalize(this.context.model.ui.map.projection);return this.zeroProjection=d3[n](),this.zeroProjection.scale(1).translate([0,0]),this.projection=d3[n](),this.projection.scale(1).translate([0,0]),this.mapPath=d3.geoPath().projection(this.projection),this.context.model.ui.map.scale=1,this._loadShapes(i).then(function(i){e.shapes=i,e.mapFeature=d.default.feature(e.shapes,e.shapes.objects[t.context.model.ui.map.topology.objects.geo]),e.mapBounds=e.mapPath.bounds(e.mapFeature);var n=d.default.mesh(e.shapes,e.shapes.objects[e.context.model.ui.map.topology.objects.boundaries],function(t,e){return t!==e});e.mapFeature.features?e.mapGraph.selectAll(".land").data(e.mapFeature.features).enter().insert("path").attr("d",e.mapPath).attr("id",function(t){return t.properties[e.context.model.ui.map.topology.geoIdProperty]?t.properties[e.context.model.ui.map.topology.geoIdProperty].toLowerCase():t.id}).attr("class","land"):e.mapGraph.insert("path").datum(e.mapFeature).attr("class","land"),e.mapGraph.insert("path").datum(n).attr("class","boundary")})},_loadShapes:function(t){return new Promise(function(e,i){d3.json(t,function(i,n){return i?console.warn("Failed loading json "+t+". "+i):void e(n)})})},rescaleMap:function(t){var e=!1,i=this.context.activeProfile.margin,n=this.zeroProjection([this.context.model.ui.map.bounds.west,this.context.model.ui.map.bounds.north]),r=this.zeroProjection([this.context.model.ui.map.bounds.east,this.context.model.ui.map.bounds.south]),a=1,o=0,s=0;if(t)a=(t[1][0]-t[0][0])/(r[0]-n[0]);else{e=!0,t=[[0,0],[this.context.width,this.context.height]];var l=(t[1][0]-t[0][0])/(r[0]-n[0]),c=(t[1][1]-t[0][1])/(r[1]-n[1]);l!=c&&(l>c?(a=c,s=(this.context.width-Math.abs(a*(n[1]-r[1])))/2):(a=l,o=(this.context.height-Math.abs(a*(n[0]-r[0])))/2))}this.projection.translate([t[0][0]-n[0]*a+s,t[0][1]-n[1]*a+o]).scale(a).precision(.1),this.mapGraph.selectAll("path").attr("d",this.mapPath),this.parent.mapSvg.style("transform","translate("+i.left+"px,"+i.top+"px)").attr("width",this.context.width).attr("height",this.context.height);e&&this.parent.boundsChanged()},invert:function(t,e){return this.projection([t||0,e||0])}}),b=o.default.extend({init:function(t,e){this.context=t,this.parent=e},initMap:function(t){var e=this;return this.mapCanvas=this.parent.mapRoot.append("div"),v.KEY="AIzaSyAP0vMZwYojifwGYHTnEtYV40v6-MdLGFM",new Promise(function(t,i){v.load(function(i){e.map=new i.maps.Map(e.mapCanvas.node(),{disableDefaultUI:!0,backgroundColor:"#FFFFFF",mapTypeId:e.context.model.ui.map.mapLayer}),e.overlay=new i.maps.OverlayView,e.overlay.draw=function(){},e.overlay.setMap(e.map),i.maps.event.addListener(e.map,"bounds_changed",function(){e.map.getBounds()&&e.parent.boundsChanged()}),t()})})},updateLayer:function(){this.map&&this.map.setMapTypeId(this.context.model.ui.map.mapLayer)},rescaleMap:function(){var t=this.context.activeProfile.margin;this.mapCanvas.style("width",this.context.width+"px").style("height",this.context.height+"px"),this.parent.mapRoot.attr("width",this.context.width).attr("height",this.context.height).style("position","absolute").style("left",t.left+"px").style("right",t.right+"px").style("top",t.top+"px").style("bottom",t.bottom+"px"),google.maps.event.trigger(this.map,"resize");var e=new google.maps.LatLngBounds(new google.maps.LatLng(this.context.model.ui.map.bounds.north,this.context.model.ui.map.bounds.west),new google.maps.LatLng(this.context.model.ui.map.bounds.south,this.context.model.ui.map.bounds.east));this.map.fitBounds(e)},invert:function(t,e){var i=this.overlay.getProjection();if(!i)return[0,0];var n=i.fromLatLngToContainerPixel(new google.maps.LatLng(e,t));return[n.x,n.y]},getZoom:function(){return this.map.getZoom()},getCanvas:function(){return[this.invert(this.context.model.ui.map.bounds.west,this.context.model.ui.map.bounds.north),this.invert(this.context.model.ui.map.bounds.east,this.context.model.ui.map.bounds.south)]},getCenter:function(){var t=this.map.getCenter();return this.centerMapker.setPosition(t),{lat:t.lat(),lng:t.lng()}}}),_=o.default.extend({init:function(t,e){g.default.accessToken="pk.eyJ1Ijoic2VyZ2V5ZiIsImEiOiJjaXlqeWo5YnYwMDBzMzJwZnlwZXJ2bnA2In0.e711ku9KzcFW_x5wmOZTag",this.context=t,this.parent=e},initMap:function(t){var e=this,i=this;return this.mapCanvas=this.parent.mapRoot.append("div"),new Promise(function(t,n){i.map=new g.default.Map({container:i.mapCanvas.node(),interactive:!1,style:e.context.model.ui.map.mapLayer,hash:!1}),i.bounds=[[i.context.model.ui.map.bounds.west,i.context.model.ui.map.bounds.south],[i.context.model.ui.map.bounds.east,i.context.model.ui.map.bounds.north]],i.map.fitBounds(i.bounds),t()})},rescaleMap:function(){var t=this,e=(this.context.model.ui.map.offset,this.context.activeProfile.margin),i=this.context.height*this.context.model.ui.map.scale,n=this.context.width*this.context.model.ui.map.scale;this.mapCanvas.style("width",n+"px").style("height",i+"px"),this.parent.mapRoot.attr("width",n).attr("height",i).style("position","absolute").style("left",e.left+"px").style("right",e.right+"px").style("top",e.top+"px").style("bottom",e.bottom+"px"),u.defer(function(){t.map.fitBounds(t.bounds,{duration:0}),t.map.resize(),t.parent.boundsChanged()})},updateLayer:function(){this.map&&this.map.setStyle(this.context.model.ui.map.mapLayer)},getCanvas:function(){return[this.invert(this.context.model.ui.map.bounds.west,this.context.model.ui.map.bounds.north),this.invert(this.context.model.ui.map.bounds.east,this.context.model.ui.map.bounds.south)]},invert:function(t,e){var i=this.map.project([t,e]);return[i.x,i.y]}});e.default=o.default.extend({init:function(t,e){return this.context=t,this.domSelector=e,this.topojsonMap=null,this.mapEngine=this.context.model.ui.map.mapEngine,this.mapInstance=null,this.context.element instanceof d3.selection?(this.mapRoot=this.context.element.select(e),this.mapSvg=this.context.element.select(".vzb-bmc-map-background")):(this.mapRoot=d3.select(this.context.element).select(e),this.mapSvg=d3.select(this.context.element).select(".vzb-bmc-map-background")),this.mapRoot.html(""),this.mapSvg.html(""),this},getMap:function(){if(!this.mapInstance){switch(this.context.model.ui.map.mapEngine){case"google":this.mapInstance=new b(this.context,this);break;case"mapbox":this.mapInstance=new _(this.context,this)}return this.mapInstance?this.topojsonMap=new y(this.context,this):this.mapInstance=new y(this.context,this),this}},layerChanged:function(){var t=this;this.mapEngine==this.context.model.ui.map.mapEngine?this.mapInstance.updateLayer():(this.mapEngine=this.context.model.ui.map.mapEngine,this.topojsonMap=null,this.mapInstance=null,this.mapRoot.html(""),this.mapSvg.html(""),this.getMap(),this.initMap().then(function(e){t.rescaleMap()}))},initMap:function(){return this.topojsonMap?this.mapInstance?Promise.all([this.mapInstance.initMap(this.domSelector),this.topojsonMap.initMap(this.domSelector)]):this.topojsonMap.initMap(this.domSelector):this.mapInstance.initMap(this.domSelector)},rescaleMap:function(){this.mapInstance?this.mapInstance.rescaleMap():this.topojsonMap.rescaleMap()},boundsChanged:function(){this.topojsonMap&&this.topojsonMap.rescaleMap(this.mapInstance.getCanvas()),this.context.mapBoundsChanged()},invert:function(t,e){return this.mapInstance?this.mapInstance.invert(t,e):this.topojsonMap.invert(t,e)}})},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var a=i(1),o=r(a),s=i(2),l=n(s),c=i(41),u=n(c),h=i(209),d=n(h),f=i(10),p=l.default.extend({init:function(t,e){var n=this;this.name="linechart",this.template=i(465),this.model_expects=[{name:"time",type:"time"},{name:"entities",type:"entities"},{name:"marker",type:"model"},{name:"locale",type:"locale"},{name:"ui",type:"ui"}],this.model_binds={"change:time.value":function(){n._readyOnce&&n.model.marker.getFrame(n.model.time.value,function(t,e){return n._frameIsValid(t)?void n.frameChanged(t,e):o.warn("change:time.value: empty data received from marker.getFrame(). doing nothing")})},"change:time.playing":function(){n.model.time.playing&&o.isTouchDevice()&&!n.tooltip.classed("vzb-hidden")&&n.tooltip.classed("vzb-hidden",!0)},"change:time.start":function(){n._readyOnce&&n.updateShow()},"change:time.end":function(){n._readyOnce&&n.updateShow()},"change:marker":function(t,e){if(n._readyOnce){if(e.indexOf("domainMin")>-1||e.indexOf("domainMax")>-1||e.indexOf("zoomedMin")>-1||e.indexOf("zoomedMax")>-1){if(!n.yScale||!n.xScale)return;return n.updateShow(),n.zoomToMaxMin(),n.updateSize(),n.updateTime(),void n.redrawDataPoints()}e.indexOf("scaleType")>-1&&(n.updateShow(),n.zoomToMaxMin(),n.updateSize(),n.redrawDataPoints())}},"change:marker.highlight":function(){n._readyOnce&&n.highlightLines()},"change:marker.select":function(){n._readyOnce&&(n.updateDoubtOpacity(),n.highlightLines())},"change:marker.opacitySelectDim":function(){n._readyOnce&&n.highlightLines()},"change:marker.opacityRegular":function(){n._readyOnce&&n.highlightLines()}},this._super(t,e),this.xScale=null,this.yScale=null,this.rangeXRatio=1,this.rangeXShift=0,this.rangeYRatio=1,this.rangeYShift=0,this.lineWidthScale=d3.scale.linear().domain([0,20]).range([7,1]).clamp(!0),this.xAxis=(0,u.default)("bottom"),this.yAxis=(0,u.default)("left"),this.isDataPreprocessed=!1,this.timeUpdatedOnce=!1,this.sizeUpdatedOnce=!1,this.getNearestKey=o.memoize(this.getNearestKey)},readyOnce:function(){var t=this;this.element=d3.select(this.element),this.graph=this.element.select(".vzb-lc-graph"),this.yAxisElContainer=this.graph.select(".vzb-lc-axis-y"),this.yAxisEl=this.yAxisElContainer.select("g"),this.xAxisElContainer=this.graph.select(".vzb-lc-axis-x"),this.xAxisEl=this.xAxisElContainer.select("g"),this.xTitleEl=this.graph.select(".vzb-lc-axis-x-title"),this.yTitleEl=this.graph.select(".vzb-lc-axis-y-title"),this.yInfoEl=this.graph.select(".vzb-lc-axis-y-info"),this.linesContainerCrop=this.graph.select(".vzb-lc-lines-crop"),this.linesContainer=this.graph.select(".vzb-lc-lines"),this.labelsContainerCrop=this.graph.select(".vzb-lc-labels-crop"),this.labelsContainer=this.graph.select(".vzb-lc-labels"),this.dataWarningEl=this.graph.select(".vzb-data-warning"),this.verticalNow=this.labelsContainer.select(".vzb-lc-vertical-now"),this.tooltip=this.element.select(".vzb-tooltip"),this.projectionX=this.graph.select(".vzb-lc-projection-x"),this.projectionY=this.graph.select(".vzb-lc-projection-y"),this.entityLines=null,this.entityLabels=null,this.totalLength_1={},this.KEY=this.model.entities.getDimension(),this.collisionResolver=(0,d.default)().selector(".vzb-lc-label").value("valueY"),o.setIcon(this.yInfoEl,f.question).select("svg").attr("width","0px").attr("height","0px"),this.yInfoEl.on("click",function(){t.parent.findChildByName("gapminder-datanotes").pin()}),this.yInfoEl.on("mouseover",function(){var e=this.getBBox(),i=o.makeAbsoluteContext(this,this.farthestViewportElement)(e.x-10,e.y+e.height+10);t.parent.findChildByName("gapminder-datanotes").setHook("axis_y").show().setPos(i.x,i.y)}),this.yInfoEl.on("mouseout",function(){t.parent.findChildByName("gapminder-datanotes").hide()}),this.wScale=d3.scale.linear().domain(this.model.ui.datawarning.doubtDomain).range(this.model.ui.datawarning.doubtRange),this.on("resize",function(){t.updateSize()||(t.updateTime(),t.redrawDataPoints())})},ready:function(){this.all_steps=this.model.time.getAllSteps(),this.all_values=this.values=null,this.updateTime(),this.updateUIStrings(),this.updateShow();var t=this;this.model.marker.getFrame(null,function(e){t.all_values=e,t.model.marker.getFrame(t.model.time.value,function(e){t._frameIsValid(e)&&(t.values=e,t.updateShow(),t.updateSize(),t.updateDoubtOpacity(),t.zoomToMaxMin(),t.redrawDataPoints(),t.linesContainerCrop.on("mousemove",t.entityMousemove.bind(t,null,null,t)).on("mouseleave",t.entityMouseout.bind(t,null,null,t)))})})},_frameIsValid:function(t){return!(!t||0===Object.keys(t.axis_y).length||0===Object.keys(t.axis_x).length||0===Object.keys(t.color).length)},frameChanged:function(t,e){this.frame=t,this.updateTime(),this.all_values&&this.redrawDataPoints()},updateUIStrings:function(){var t=this,e=t.model.marker.axis_y.getConceptprops(),i=t.model.marker.axis_x.getConceptprops(),n=t.model.marker.color.getConceptprops();this.translator=this.model.locale.getTFunction(),this.strings={title:{Y:e.name,X:i.name,C:n.name},unit:{Y:e.unit||"",X:i.unit||"",C:n.unit||""}},this.strings.unit.Y==="unit/"+this.model.marker.axis_y.which&&(this.strings.unit.Y=""),this.strings.unit.X==="unit/"+this.model.marker.axis_x.which&&(this.strings.unit.X=""),this.strings.unit.C==="unit/"+this.model.marker.color.which&&(this.strings.unit.C=""),this.strings.unit.Y&&(this.strings.unit.Y=", "+this.strings.unit.Y),this.strings.unit.X&&(this.strings.unit.X=", "+this.strings.unit.X),this.strings.unit.C&&(this.strings.unit.C=", "+this.strings.unit.C),o.setIcon(this.dataWarningEl,f.warn).select("svg").attr("width","0px").attr("height","0px"),this.dataWarningEl.append("text").attr("text-anchor","end").text(this.translator("hints/dataWarning")),this.dataWarningEl.on("click",function(){t.parent.findChildByName("gapminder-datawarning").toggle()}).on("mouseover",function(){t.updateDoubtOpacity(1)}).on("mouseout",function(){t.updateDoubtOpacity()});var r=this.xTitleEl.selectAll("text").data([0]);r=r.enter().append("text").merge(r);var a=this.yTitleEl.selectAll("text").data([0]);a=a.enter().append("text").merge(a),a.on("click",function(){t.parent.findChildByName("gapminder-treemenu").markerID("axis_y").alignX("left").alignY("top").updateView().toggle()})},updateDoubtOpacity:function(t){null==t&&(t=this.wScale(+this.time.getUTCFullYear().toString())),this.someSelected&&(t=1),this.dataWarningEl.style("opacity",t)},updateShow:function(){var t=this,e=this.KEY;if(this.cached={},this.yScale=this.model.marker.axis_y.getScale(),!this.splash){var i=this.model.marker.axis_y.getLimits(this.model.marker.axis_y.which);this.yScale.domain([i.min,i.max])}this.xScale=this.model.marker.axis_x.getScale(),this.cScale=this.model.marker.color.getScale(),this.yAxis.tickFormat(this.model.marker.axis_y.getTickFormatter()),this.xAxis.tickFormat(this.model.marker.axis_x.getTickFormatter()),this.collisionResolver.scale(this.yScale).KEY(e),this.data=this.model.marker.getKeys(),this.entityLines=this.linesContainer.selectAll(".vzb-lc-entity").data(this.data),this.entityLines.exit().remove(),this.entityLines=this.entityLines.enter().append("g").attr("class","vzb-lc-entity").each(function(t,e){var i=d3.select(this);i.append("path").attr("class","vzb-lc-line-shadow"),i.append("path").attr("class","vzb-lc-line")}).merge(this.entityLines),this.entityLabels=this.labelsContainer.selectAll(".vzb-lc-entity").data(this.data),this.entityLabels.exit().remove(),this.entityLabels=this.entityLabels.enter().append("g").attr("class","vzb-lc-entity").on("mouseover",function(e){t.model.marker.highlightMarker(e)}).on("mouseout",function(e){t.model.marker.clearHighlighted()}).each(function(t,e){var i=d3.select(this);i.append("circle").attr("class","vzb-lc-circle").attr("cx",0);var n=i.append("g").attr("class","vzb-lc-label");n.append("text").attr("class","vzb-lc-labelname").attr("dy",".35em"),n.append("text").attr("class","vzb-lc-label-value").attr("dy","1.6em")}).merge(this.entityLabels),this.all_values&&this.values&&this.entityLabels.each(function(i,n){var r=d3.select(this),a=t.cScale(t.values.color[i[e]]),o="geo.world_4region"==t.model.marker.color.which?t.model.marker.color.getColorShade({colorID:t.values.color[i[e]],shadeID:"shade"}):d3.rgb(a).darker(.5).toString(),s=t.values.label[i[e]],l=t.yAxis.tickFormat()(t.values.axis_y[i[e]]),c=s.length<13?s:s.substring(0,10)+"...",u=t.ui.chart.labels.min_number_of_entities_when_values_hide;r.select("circle").style("fill",a),r.select(".vzb-lc-labelname").style("fill",o).text(c+" "+(t.data.length<u?l:"")),r.select(".vzb-lc-label-value").style("fill",o)}),this.line=d3.line().curve(d3.curveCardinal).x(function(e){return t.xScale(e[0])}).y(function(e){return t.yScale(e[1])})},updateTime:function(){var t=this,e=(this.KEY,null===this.time?this.model.time.value:this.time);this.time=this.model.time.value,this.duration=this.model.time.playing&&this.time-e>0?this.model.time.delayAnimations:0;var i=this.model.time.getDimension(),n={};n[i]=this.time,this.prev_steps=this.all_steps.filter(function(e){return e<t.time}),this.timeUpdatedOnce=!0},profiles:{small:{margin:{top:30,right:20,left:40,bottom:20},infoElHeight:16,yAxisTitleBottomMargin:6,tick_spacing:60,text_padding:12,lollipopRadius:6,limitMaxTickNumberX:5},medium:{margin:{top:40,right:60,left:60,bottom:25},infoElHeight:20,yAxisTitleBottomMargin:6,tick_spacing:80,text_padding:15,lollipopRadius:7,limitMaxTickNumberX:10},large:{margin:{top:50,right:60,left:60,bottom:30},infoElHeight:22,yAxisTitleBottomMargin:6,tick_spacing:100,text_padding:20,lollipopRadius:9,limitMaxTickNumberX:0}},presentationProfileChanges:{medium:{margin:{top:70,bottom:40,left:70},yAxisTitleBottomMargin:20,xAxisTitleBottomMargin:20,infoElHeight:26,text_padding:30},large:{margin:{top:70,bottom:50,left:70},yAxisTitleBottomMargin:20,xAxisTitleBottomMargin:20,infoElHeight:32,text_padding:36,hideSTitle:!0}},timeSliderProfiles:{small:{margin:{top:9,right:15,bottom:10,left:10}},medium:{margin:{top:9,right:15,bottom:10,left:20}},large:{margin:{top:9,right:15,bottom:10,left:25}}},updateSize:function(){var t=this;this.values,this.KEY;this.activeProfile=this.getActiveProfile(this.profiles,this.presentationProfileChanges),this.margin=this.activeProfile.margin,this.tick_spacing=this.activeProfile.tick_spacing;var e=this.activeProfile.infoElHeight,i=0;if(this.entityLabels.selectAll(".vzb-lc-labelname").attr("dx",t.activeProfile.text_padding).each(function(t,e){var n=this.getComputedTextLength();n>i&&(i=n)}),this.entityLabels.selectAll(".vzb-lc-circle").attr("r",t.activeProfile.lollipopRadius),this.margin.right=Math.max(this.margin.right,i+this.activeProfile.text_padding+20),this.height=parseInt(this.element.style("height"),10)-this.margin.top-this.margin.bottom||0,this.width=parseInt(this.element.style("width"),10)-this.margin.left-this.margin.right||0,this.linesContainerCrop.attr("width",this.width).attr("height",Math.max(0,this.height)),this.labelsContainerCrop.attr("width",this.width+this.margin.right).attr("height",Math.max(0,this.height)),this.height<=0||this.width<=0)return o.warn("Line chart updateSize() abort: vizabi container is too little or has display:none");this.collisionResolver.height(this.height),this.graph.attr("transform","translate("+this.margin.left+","+this.margin.top+")"),this.yScale.range([this.height-this.activeProfile.lollipopRadius,this.activeProfile.lollipopRadius]),this.xScale.range([this.rangeXShift,this.width*this.rangeXRatio+this.rangeXShift]),this.yAxis.scale(this.yScale).tickSizeInner(-this.width).tickSizeOuter(0).tickPadding(6).tickSizeMinor(-this.width,0).labelerOptions({scaleType:this.model.marker.axis_y.scaleType,toolMargin:this.margin,limitMaxTickNumber:6,viewportLength:this.height,formatter:this.model.marker.axis_y.getTickFormatter()}),this.xAxis.scale(this.xScale).tickSizeInner(-this.height).tickSizeOuter(0).tickSizeMinor(-this.height,0).tickPadding(6).labelerOptions({scaleType:this.model.marker.axis_x.scaleType,limitMaxTickNumber:this.activeProfile.limitMaxTickNumberX,toolMargin:this.margin,bump:2*this.activeProfile.text_padding,formatter:this.model.marker.axis_x.getTickFormatter()}),this.xAxisElContainer.attr("width",this.width+2*this.activeProfile.text_padding).attr("height",this.activeProfile.margin.bottom+this.height).attr("y",-1).attr("x",-this.activeProfile.text_padding),this.xAxisEl.attr("transform","translate("+(this.activeProfile.text_padding-1)+","+(this.height+1)+")"),this.yAxisElContainer.attr("width",this.activeProfile.margin.left+this.width).attr("height",Math.max(0,this.height)).attr("x",-this.activeProfile.margin.left),this.yAxisEl.attr("transform","translate("+(this.activeProfile.margin.left-1)+",0)"),this.yAxisEl.call(this.yAxis),this.xAxisEl.call(this.xAxis),this.yTitleEl.style("font-size",e+"px").attr("transform","translate("+(10-this.activeProfile.margin.left)+", -"+this.activeProfile.yAxisTitleBottomMargin+")");var n=this.yTitleEl.select("text").text(this.strings.title.Y+this.strings.unit.Y);if(n.node().getBBox().width>this.width&&n.text(this.strings.title.Y),this.yInfoEl.select("svg").node()){var r=this.yTitleEl.node().getBBox(),a=o.transform(this.yTitleEl.node());this.yInfoEl.select("svg").attr("width",e+"px").attr("height",e+"px"),this.yInfoEl.attr("transform","translate("+(r.x+a.translateX+r.width+.4*e)+","+(a.translateY-.8*e)+")")}var s=this.dataWarningEl.select("text").node().getBBox();this.dataWarningEl.select("svg").attr("width",.75*s.height).attr("height",.75*s.height).attr("x",-s.width-1.2*s.height).attr("y",.65*-s.height),this.dataWarningEl.attr("transform","translate("+(this.width+s.width+2*s.height)+",-"+this.activeProfile.yAxisTitleBottomMargin+")").select("text");var l=this.xTitleEl.select("text").text(this.strings.title.X+this.strings.unit.X);this.xTitleEl.style("font-size",e+"px").attr("transform","translate("+(this.width+this.activeProfile.text_padding+this.activeProfile.yAxisTitleBottomMargin)+","+(this.height+.72*l.node().getBBox().height)+")"),l.node().getBBox().width>this.width-100&&l.text(this.strings.title.X),this.verticalNow.attr("y1",this.yScale.range()[0]).attr("y2",this.yScale.range()[1]).attr("x1",0).attr("x2",0),this.projectionX.attr("y1",t.yScale.range()[0]),this.projectionY.attr("x2",t.xScale.range()[0]),o.isTouchDevice()&&(t.tooltip.classed("vzb-hidden",!0),t.verticalNow.style("opacity",1),t.projectionX.style("opacity",0),t.projectionY.style("opacity",0),t.xAxisEl.call(t.xAxis.highlightValue(t.time)),t.yAxisEl.call(t.yAxis.highlightValue("none")),t.graph.selectAll(".vzb-lc-entity").each(function(){d3.select(this).classed("vzb-dimmed",!1).classed("vzb-hovered",!1)}),t.hoveringNow=null);var c={rangeMax:this.xScale.range()[1],mRight:this.margin.right,profile:this.timeSliderProfiles[this.getLayoutProfile()]};this.parent.trigger("myEvent",c),this.sizeUpdatedOnce=!0},redrawDataPoints:function(){var t=this,e=this.KEY;t.all_values&&this.model.marker.getFrame(this.time,function(i,n){t._frameIsValid(i)&&(t.values=i,t.timeUpdatedOnce||t.updateTime(),t.sizeUpdatedOnce||t.updateSize(),t.updateDoubtOpacity(),t.lineWidth=t.lineWidthScale(t.data.length),t.shadowWidth=1.3*t.lineWidth,t.entityLines.each(function(n,r){var a=d3.select(this),o=(i.label[n[e]],t.cScale(i.color[n[e]])),s="geo.world_4region"==t.model.marker.color.which?t.model.marker.color.getColorShade({colorID:i.color[n[e]],shadeID:"shade"}):d3.rgb(o).darker(.5).toString(),l=t.prev_steps.map(function(i,r){return[i,t.all_values[i]?t.all_values[i].axis_y[n[e]]:null]}).filter(function(t){return t[1]||0===t[1]});i.axis_y[n[e]]&&l.push([i.axis_x[n[e]],i.axis_y[n[e]]]),l.length>0?t.cached[n[e]]={valueX:l[l.length-1][0],valueY:l[l.length-1][1]}:delete t.cached[n[e]];var c=a.select(".vzb-lc-line");t.model.time.playing&&null===t.totalLength_1[n[e]]&&(t.totalLength_1[n[e]]=c.node().getTotalLength());var u=a.select(".vzb-lc-line-shadow").style("stroke",s).style("stroke-width",t.shadowWidth+"px").attr("transform","translate(0, "+(t.shadowWidth-t.lineWidth)+")").attr("d",t.line(l));c.style("stroke",o).style("stroke-width",t.lineWidth+"px").attr("d",t.line(l));var h=c.node().getTotalLength();t.model.time.playing?(u.interrupt().attr("stroke-dasharray",h).attr("stroke-dashoffset",h-t.totalLength_1[n[e]]).transition().delay(0).duration(t.duration).ease(d3.easeLinear).attr("stroke-dashoffset",0),c.interrupt().attr("stroke-dasharray",h).attr("stroke-dashoffset",h-t.totalLength_1[n[e]]).transition().delay(0).duration(t.duration).ease(d3.easeLinear).attr("stroke-dashoffset",0),t.totalLength_1[n[e]]=h):(t.totalLength_1[n[e]]=null,u.attr("stroke-dasharray","none").attr("stroke-dashoffset","none"),c.attr("stroke-dasharray","none").attr("stroke-dashoffset","none"))}),t.entityLabels.each(function(i,n){var r=d3.select(this);t.cached[i[e]]?(r.classed("vzb-hidden",!1).transition().duration(t.duration).ease(d3.easeLinear).attr("transform","translate("+t.xScale(d3.min([t.cached[i[e]].valueX]))+",0)"),r.select(".vzb-lc-circle").transition().duration(t.duration).ease(d3.easeLinear).attr("cy",t.yScale(t.cached[i[e]].valueY)+1),r.select(".vzb-lc-label").transition().duration(t.duration).ease(d3.easeLinear).attr("transform","translate(0,"+t.yScale(t.cached[i[e]].valueY)+")")):r.classed("vzb-hidden",!0)}),t.verticalNow.transition().duration(t.duration).ease(d3.easeLinear).attr("transform","translate("+t.xScale(d3.min([t.model.marker.axis_x.zoomedMax,t.time]))+",0)"),t.hoveringNow||t.time-t.model.time.start===0?t.verticalNow.style("opacity",0):(t.ui.chart.hideXAxisValue||t.xAxisEl.call(t.xAxis.highlightTransDuration(t.duration).highlightValue(t.time)),t.verticalNow.style("opacity",1)),0==t.duration&&d3.timerFlush(),clearTimeout(t.collisionTimeout),t.collisionTimeout=setTimeout(function(){t.entityLabels.call(t.collisionResolver.data(t.cached))},1.5*t.model.time.delayAnimations))})},entityMousemove:function(t,e,i,n){var r=i,a=r.KEY,s=(r.values,d3.mouse(r.element.node()).map(function(t){return parseInt(t)})),l=r.xScale.invert(s[0]-r.margin.left);r.time-l<0?l=r.time:l<this.model.time.start&&(l=this.model.time.start);var c=void 0,u=(r.model.time.getDimension(),s[1]-r.margin.top);o.isDate(l)||(l=this.model.time.parse(l)),
this.model.marker.getFrame(l,function(e){if(r._frameIsValid(e)){var i=r.getNearestKey(u,e.axis_y,r.yScale.bind(r));if(c=e.axis_y[i],t||(t={}),t[a]=i,r.model.marker.isHighlighted(t)||(r.model.marker.clearHighlighted(),r.model.marker.highlightMarker(t)),r.hoveringNow=t,!o.isNaN(c)){var n=r.xScale(l),s=r.yScale(c);r.ui.chart.whenHovering.showTooltip&&r.tooltip.style("left",n+r.margin.left+"px").style("bottom",r.height-s+r.margin.bottom+"px").text(r.yAxis.tickFormat()(c)).classed("vzb-hidden",!1),r.ui.chart.whenHovering.hideVerticalNow&&r.verticalNow.style("opacity",0),r.ui.chart.whenHovering.showProjectionLineX&&r.projectionX.style("opacity",1).attr("y2",s).attr("x1",n).attr("x2",n),r.ui.chart.whenHovering.showProjectionLineY&&r.projectionY.style("opacity",1).attr("y1",s).attr("y2",s).attr("x1",n),r.ui.chart.whenHovering.higlightValueX&&r.xAxisEl.call(r.xAxis.highlightValue(l).highlightTransDuration(0)),r.ui.chart.whenHovering.higlightValueY&&r.yAxisEl.call(r.yAxis.highlightValue(c).highlightTransDuration(0)),clearTimeout(r.unhoverTimeout)}}})},entityMouseout:function(t,e,i){var n=i;d3.event.relatedTarget&&d3.select(d3.event.relatedTarget).classed("vzb-tooltip")||(n.unhoverTimeout=setTimeout(function(){n.tooltip.classed("vzb-hidden",!0),n.verticalNow.style("opacity",1),n.projectionX.style("opacity",0),n.projectionY.style("opacity",0),n.xAxisEl.call(n.xAxis.highlightValue(n.time)),n.yAxisEl.call(n.yAxis.highlightValue("none")),n.model.marker.clearHighlighted(),n.hoveringNow=null},300))},highlightLines:function(){var t=this,e=1,i=.3,n=this.model.marker.opacityRegular,r=this.model.marker.opacityRegular,a=this.model.marker.opacitySelectDim,o=this.model.marker.highlight.length>0,s=this.model.marker.select.length>0;this.graph.selectAll(".vzb-lc-entity").each(function(){d3.select(this).style("opacity",function(l){return t.model.marker.isHighlighted(l)?e:s?t.model.marker.isSelected(l)?n:a:o?i:r})})},zoomToMaxMin:function(){null!=this.model.marker.axis_x.zoomedMin&&null!=this.model.marker.axis_x.zoomedMax&&(this.xScale.domain([this.model.marker.axis_x.zoomedMin,this.model.marker.axis_x.zoomedMax]),this.xAxisEl.call(this.xAxis)),null!=this.model.marker.axis_y.zoomedMin&&null!=this.model.marker.axis_y.zoomedMax&&((this.model.marker.axis_y.zoomedMin<=0||this.model.marker.axis_y.zoomedMax<=0)&&"log"==this.model.marker.axis_y.scaleType?(this.yScale=d3.scale.genericLog().domain([this.model.marker.axis_y.zoomedMin,this.model.marker.axis_y.zoomedMax]).range(this.yScale.range()),this.model.marker.axis_y.scale=d3.scale.genericLog().domain([this.model.marker.axis_y.zoomedMin,this.model.marker.axis_y.zoomedMax]).range(this.yScale.range()),this.yScale=this.model.marker.axis_y.scale):this.yScale.domain([this.model.marker.axis_y.zoomedMin,this.model.marker.axis_y.zoomedMax]),this.yAxisEl.call(this.yAxis))},getNearestKey:function(t,e,i){for(var n=Object.keys(e),r=n[0],a=1;a<n.length;a++){var o=n[a];Math.abs((i?i(e[o]):e[o])-t)<Math.abs((i?i(e[r]):e[r])-t)&&(r=o)}return r}});e.default=p},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var a=i(1),o=r(a),s=i(2),l=n(s),c=i(10),u=i(138),h=n(u),d=i(41),f=n(d),p=i(229),m=n(p),g=i(231),v=n(g),y=i(230),b=n(y),_=i(60),x=n(_),w=i(34),M=n(w),z=.001,S="#d3d3d3",E=l.default.extend({init:function(t,e){var n=this;this.name="mountainchart",this.template=i(466),this.model_expects=[{name:"time",type:"time"},{name:"entities",type:"entities"},{name:"marker",type:"model"},{name:"locale",type:"locale"},{name:"ui",type:"ui"}],this.model_binds={"change:time.value":function(t){n._readyOnce&&n.model.marker.getFrame(n.model.time.value,n.frameChanged.bind(n))},"change:time.playing":function(t){n.model.time.playing||n.redrawDataPoints()},"change:marker.axis_x.xScaleFactor":function(){n.ready()},"change:marker.axis_x.xScaleShift":function(){n.ready()},"change:marker.axis_x.tailFatX":function(){n.ready()},"change:marker.axis_x.tailCutX":function(){n.ready()},"change:marker.axis_x.tailFade":function(){n.ready()},"change:ui.chart.probeX":function(){n.ready()},"change:ui.chart.showProbeX":function(){n.ready()},"change:ui.chart.xPoints":function(){n.ready()},"change:ui.chart.xLogStops":function(){n.updateSize()},"change:ui.chart.yMaxMethod":function(){n._adjustMaxY({force:!0}),n.redrawDataPoints()},"change:time.record":function(t){n.model.time.record?n._export.open(this.element,this.name):n._export.reset()},"change:marker.highlight":function(t){n._readyOnce&&(n.highlightMarkers(),n.updateOpacity())},"change:marker.select":function(t){n._readyOnce&&(n.selectMarkers(),n._selectlist.redraw(),n.updateOpacity(),n.updateDoubtOpacity(),n.redrawDataPoints())},"change:marker.opacitySelectDim":function(t){n.updateOpacity()},"change:marker.opacityRegular":function(t){n.updateOpacity()},"change:marker":function(t,e){n._readyOnce&&(e.indexOf("scaleType")>-1?n.ready():(e.indexOf("zoomedMin")>-1||e.indexOf("zoomedMax")>-1)&&(n.zoomToMaxMin(),n.redrawDataPoints(),n._probe.redraw()))},"change:marker.group":function(t,e){n._readyOnce&&(e.indexOf("group.merge")>-1||n.ready())},"change:marker.group.merge":function(t){n._readyOnce&&(n.updatePointers(),n.redrawDataPoints())},"change:marker.stack":function(t){n._readyOnce&&n.ready()},"change:marker.stack.which":function(t){n._readyOnce&&n.model.time.playing&&n.model.time.pause()},"change:marker.stack.use":function(t){n._readyOnce&&n.model.time.playing&&n.model.time.pause()},"change:marker.color.palette":function(t){n._readyOnce&&(n.redrawDataPointsOnlyColors(),n._selectlist.redraw())}},this._super(t,e),this._math=new m.default(this),this._export=new h.default(this),this._export.prefix("vzb-mc-").deleteClasses(["vzb-mc-mountains-mergestacked","vzb-mc-mountains-mergegrouped","vzb-mc-mountains","vzb-mc-year","vzb-mc-mountains-labels","vzb-mc-axis-labels"]),this._probe=new b.default(this),this._selectlist=new v.default(this),this.area=d3.area().curve(d3.curveBasis).x(function(t){return n.xScale(n._math.rescale(t.x))}).y0(function(t){return n.yScale(t.y0)}).y1(function(t){return n.yScale(t.y0+t.y)}),this.stack=d3.stack().order(d3.stackOrderReverse).value(function(t,e){return n.cached[e][t].y}),this.xScale=null,this.yScale=null,this.cScale=null,this.xAxis=(0,f.default)("bottom"),this.rangeRatio=1,this.rangeShift=0,this.cached={},this.mesh=[],this.yMax=0},domReady:function(){var t=this;this.element=d3.select(this.element),this.graph=this.element.select(".vzb-mc-graph"),this.xAxisEl=this.graph.select(".vzb-mc-axis-x"),this.xTitleEl=this.graph.select(".vzb-mc-axis-x-title"),this.yTitleEl=this.graph.select(".vzb-mc-axis-y-title"),this.infoEl=this.graph.select(".vzb-mc-axis-info"),this.dataWarningEl=this.graph.select(".vzb-data-warning"),this.yearEl=this.graph.select(".vzb-mc-year"),this.year=new x.default(this.yearEl),this.mountainMergeStackedContainer=this.graph.select(".vzb-mc-mountains-mergestacked"),this.mountainMergeGroupedContainer=this.graph.select(".vzb-mc-mountains-mergegrouped"),this.mountainAtomicContainer=this.graph.select(".vzb-mc-mountains"),this.mountainLabelContainer=this.graph.select(".vzb-mc-mountains-labels"),this.tooltip=this.element.select(".vzb-mc-tooltip"),this.eventAreaEl=this.element.select(".vzb-mc-eventarea"),this.probeEl=this.element.select(".vzb-mc-probe"),this.probeLineEl=this.probeEl.select("line"),this.probeTextEl=this.probeEl.selectAll("text"),this.element.onTap(function(e,i){t._interact()._mouseout(e,i)})},afterPreload:function(){var t=this,e=t.model.time.formatDate(this.model.time.value),i=t.model.time.formatDate(this.model.time.end);if(this._math.xScaleFactor=this.model.marker.axis_x.xScaleFactor,this._math.xScaleShift=this.model.marker.axis_x.xScaleShift,this.precomputedShapes&&this.precomputedShapes[e]&&this.precomputedShapes[i]){var n=this.precomputedShapes["immediate"==this.model.ui.chart.yMaxMethod?e:i].yMax,r=this.precomputedShapes[e].shape;n&&r&&0!==r.length&&(this.xScale=d3.scale.log().domain([this.model.marker.axis_x.domainMin,this.model.marker.axis_x.domainMax]),this.yScale=d3.scale.linear().domain([0,Math.round(n)]),t.updateSize(r.length),t.zoomToMaxMin(),r=r.map(function(e,i){return{x:t.mesh[i],y0:0,y:+e}}),this.mountainAtomicContainer.selectAll(".vzb-mc-prerender").data([0]).enter().append("path").attr("class","vzb-mc-prerender").style("fill","pink").style("opacity",0).attr("d",t.area(r)).transition().duration(1e3).ease(d3.easeLinear).style("opacity",1))}},readyOnce:function(){this.eventAreaEl.on("mousemove",function(){t.model.time.dragging||t.model.ui.chart.showProbeX&&t._probe.redraw({level:t.xScale.invert(d3.mouse(this)[0]),full:!0})}).on("mouseout",function(){t.model.time.dragging||t.model.ui.chart.showProbeX&&t._probe.redraw()});var t=this;this.on("resize",function(){t.updateSize()||(t.updatePointers(),t.redrawDataPoints(),t._selectlist.redraw(),t._probe.redraw())}),this.KEY=this.model.entities.getDimension(),this.TIMEDIM=this.model.time.getDimension(),this.mountainAtomicContainer.select(".vzb-mc-prerender").remove(),this.year.setText(this.model.time.formatDate(this.model.time.value)),this.wScale=d3.scale.linear().domain(this.model.ui.datawarning.doubtDomain).range(this.model.ui.datawarning.doubtRange)},ready:function(){var t=this;this._math.xScaleFactor=this.model.marker.axis_x.xScaleFactor,this._math.xScaleShift=this.model.marker.axis_x.xScaleShift,this.updateUIStrings(),this.updateIndicators(),this.model.marker.getFrame(this.model.time.value,function(e){e&&(t.values=e,t.updateEntities(),t.updateSize(),t.zoomToMaxMin(),t._spawnMasks(),t.updateTime(),t.updatePointers(),t._adjustMaxY({force:!0}),t.redrawDataPoints(),t.redrawDataPointsOnlyColors(),t.highlightMarkers(),t.selectMarkers(),t._selectlist.redraw(),t.updateOpacity(),t.updateDoubtOpacity(),t._probe.redraw())})},frameChanged:function(t,e){return t?void(e.toString()==this.model.time.value.toString()&&(this.values=t,this.updateTime(),this.updatePointers(),this.redrawDataPoints(),this._selectlist.redraw(),this._probe.redraw(),this.updateDoubtOpacity())):o.warn("change:time.value: empty data received from marker.getFrame(). doing nothing")},updateSize:function(t){var e={small:{margin:{top:10,right:10,left:10,bottom:18},infoElHeight:16},medium:{margin:{top:20,right:20,left:20,bottom:30},infoElHeight:20},large:{margin:{top:30,right:30,left:30,bottom:35},infoElHeight:22}},i={medium:{margin:{top:20,right:20,left:20,bottom:50},infoElHeight:26},large:{margin:{top:30,right:30,left:30,bottom:50},infoElHeight:32}};this.activeProfile=this.getActiveProfile(e,i);var n=this.activeProfile.margin,r=this.activeProfile.infoElHeight;if(this.height=parseInt(this.element.style("height"),10)-n.top-n.bottom||0,this.width=parseInt(this.element.style("width"),10)-n.left-n.right||0,this.height<=0||this.width<=0)return o.warn("Mountain chart updateSize() abort: vizabi container is too little or has display:none");this.graph.attr("transform","translate("+n.left+","+n.top+")");var a=this.model.locale.isRTL(),s={topOffset:"large"===this.getLayoutProfile()?2*n.top:0,xAlign:"large"===this.getLayoutProfile()?a?"left":"right":"center",yAlign:"large"===this.getLayoutProfile()?"top":"center",widthRatio:"large"===this.getLayoutProfile()?3/8:.8};this.year.setConditions(s).resize(this.width,this.height),this.yScale.range([this.height,0]),this.xScale.range([this.rangeShift,this.width*this.rangeRatio+this.rangeShift]);var l=this._readyOnce?this.model.marker.axis_x.scaleType:"log";this.xAxis.scale(this.xScale).tickSizeOuter(0).tickPadding(9).tickSizeMinor(3,0).labelerOptions({scaleType:l,toolMargin:n,pivotingLimit:1.5*n.bottom,method:this.xAxis.METHOD_REPEATING,stops:this._readyOnce?this.model.ui.chart.xLogStops:[1],formatter:this.model.marker.axis_x.getTickFormatter()}),this.xAxisEl.attr("transform","translate(0,"+this.height+")").call(this.xAxis),this.xTitleEl.select("text").attr("transform","translate("+this.width+","+this.height+")").attr("dy","-0.36em"),this.yTitleEl.style("font-size",r+"px").attr("transform","translate("+(a?this.width:0)+","+n.top+")");var c=this.dataWarningEl.select("text").node().getBBox();if(this.dataWarningEl.select("svg").attr("width",c.height).attr("height",c.height).attr("x",.1*c.height).attr("y",1*-c.height+1),this.dataWarningEl.attr("transform","translate("+(a?this.width-c.width-2*c.height:0)+","+(n.top+1.5*c.height)+")").select("text").attr("dx",1.5*c.height),this.infoEl.select("svg").node()){var u=this.yTitleEl.node().getBBox(),h=o.transform(this.yTitleEl.node()),d=a?u.x+h.translateX-1.4*r:u.x+h.translateX+u.width+.4*r;this.infoEl.select("svg").attr("width",r+"px").attr("height",r+"px"),this.infoEl.attr("transform","translate("+d+","+(h.translateY-.8*r)+")")}this.eventAreaEl.attr("y",this.height).attr("width",this.width).attr("height",n.bottom),t||(t=this.model.ui.chart.xPoints),this.mesh=this._math.generateMesh(t,l,this.xScale.domain())},zoomToMaxMin:function(){if(null!=this.model.marker.axis_x.zoomedMin&&null!=this.model.marker.axis_x.zoomedMax){var t=this.xScale(this.model.marker.axis_x.zoomedMin),e=this.xScale(this.model.marker.axis_x.zoomedMax);this.rangeRatio=this.width/(e-t)*this.rangeRatio,this.rangeShift=(this.rangeShift-t)/(e-t)*this.width,this.xScale.range([this.rangeShift,this.width*this.rangeRatio+this.rangeShift]),this.xAxisEl.call(this.xAxis)}},updateUIStrings:function(){var t=this;this.translator=this.model.locale.getTFunction();this.model.marker.axis_x.getConceptprops();this.xTitleEl.select("text").text(this.translator("unit/mountainchart_hardcoded_income_per_day")),this.yTitleEl.select("text").text(this.translator("mount/title")),o.setIcon(this.dataWarningEl,c.warn).select("svg").attr("width","0px").attr("height","0px"),this.dataWarningEl.append("text").text(this.translator("hints/dataWarning")),o.setIcon(this.infoEl,c.question).select("svg").attr("width","0px").attr("height","0px"),this.infoEl.on("click",function(){t.parent.findChildByName("gapminder-datanotes").pin()}),this.infoEl.on("mouseover",function(){var e=this.getBBox(),i=o.makeAbsoluteContext(this,this.farthestViewportElement)(e.x-10,e.y+e.height+10),n=t.root.element.getBoundingClientRect(),r=t.element.node().getBoundingClientRect();t.parent.findChildByName("gapminder-datanotes").setHook("axis_y").show().setPos(i.x+r.left-n.left,i.y)}),this.infoEl.on("mouseout",function(){t.parent.findChildByName("gapminder-datanotes").hide()}),this.dataWarningEl.on("click",function(){t.parent.findChildByName("gapminder-datawarning").toggle()}).on("mouseover",function(){t.updateDoubtOpacity(1)}).on("mouseout",function(){t.updateDoubtOpacity()})},updateDoubtOpacity:function(t){null==t&&(t=this.wScale(+this.time.getUTCFullYear().toString())),this.someSelected&&(t=1),this.dataWarningEl.style("opacity",t)},updateIndicators:function(){var t=this;this.yScale=this.model.marker.axis_y.getScale(),this.xScale=this.model.marker.axis_x.getScale(),this.cScale=this.model.marker.color.getScale(),this.xAxis.tickFormat(t.model.marker.axis_x.getTickFormatter())},updateEntities:function(){var t=this;this.mountainPointers=this.model.marker.getKeys().filter(function(e){return t.values.axis_x[e[t.KEY]]&&t.values.axis_y[e[t.KEY]]&&t.values.axis_s[e[t.KEY]]}).map(function(e){var i={};return i[t.KEY]=e[t.KEY],i.KEY=function(){return this[t.KEY]},i.sortValue=[t.values.axis_y[i.KEY()]||0,0],i.aggrLevel=0,i}),this.groupedPointers=d3.nest().key(function(e){return"property"===t.model.marker.stack.use?t.values.stack[e.KEY()]:t.values.group[e.KEY()]}).sortValues(function(t,e){return e.sortValue[0]-t.sortValue[0]}).entries(this.mountainPointers);var e=this.model.marker.group.manualSorting;this.groupedPointers.forEach(function(i){var n=d3.sum(i.values.map(function(t){return t.sortValue[0]}));e&&e.length>1&&(n=e.length-1-e.indexOf(i.key)),i.values.forEach(function(t){t.sortValue[1]=n}),i[t.model.entities.getDimension()]=i.key,i.KEY=function(){return this.key},i.aggrLevel=1});var i={};t.groupedPointers.forEach(function(t){i[t.key]=t.values[0].sortValue[1]}),"none"===t.model.marker.stack.which?(this.stackedPointers=[],this.mountainPointers.sort(function(t,e){return e.sortValue[0]-t.sortValue[0]})):(this.stackedPointers=d3.nest().key(function(e){return t.values.stack[e.KEY()]}).key(function(e){return t.values.group[e.KEY()]}).sortKeys(function(t,e){return i[e]-i[t]}).sortValues(function(t,e){return e.sortValue[0]-t.sortValue[0]}).entries(this.mountainPointers),this.mountainPointers.sort(function(t,e){return e.sortValue[1]-t.sortValue[1]}),this.stackedPointers.forEach(function(e){e.KEY=function(){return this.key},e[t.model.entities.getDimension()]=e.key,e.aggrLevel=2})),this.mountainsMergeStacked=this.mountainAtomicContainer.selectAll(".vzb-mc-mountain.vzb-mc-aggrlevel2").data(this.stackedPointers),this.mountainsMergeGrouped=this.mountainAtomicContainer.selectAll(".vzb-mc-mountain.vzb-mc-aggrlevel1").data(this.groupedPointers),this.mountainsAtomic=this.mountainAtomicContainer.selectAll(".vzb-mc-mountain.vzb-mc-aggrlevel0").data(this.mountainPointers),this.mountainsMergeStacked.exit().remove(),this.mountainsMergeGrouped.exit().remove(),this.mountainsAtomic.exit().remove(),this.mountainsMergeStacked=this.mountainsMergeStacked.enter().append("path").attr("class","vzb-mc-mountain vzb-mc-aggrlevel2").merge(this.mountainsMergeStacked),this.mountainsMergeGrouped=this.mountainsMergeGrouped.enter().append("path").attr("class","vzb-mc-mountain vzb-mc-aggrlevel1").merge(this.mountainsMergeGrouped),this.mountainsAtomic=this.mountainsAtomic.enter().append("path").attr("class","vzb-mc-mountain vzb-mc-aggrlevel0").merge(this.mountainsAtomic),this.mountains=this.mountainAtomicContainer.selectAll(".vzb-mc-mountain"),this.mountains.on("mousemove",function(e,i){o.isTouchDevice()||t._interact()._mousemove(e,i)}).on("mouseout",function(e,i){o.isTouchDevice()||t._interact()._mouseout(e,i)}).on("click",function(e,i){o.isTouchDevice()||(t._interact()._click(e,i),t.highlightMarkers())}).onTap(function(e,i){t._interact()._click(e,i),d3.event.stopPropagation()}).onLongTap(function(t,e){})},_interact:function(){var t=this;return{_mousemove:function(e,i){if(!t.model.time.dragging&&!t.model.time.playing){t.model.marker.highlightMarker(e);d3.mouse(t.graph.node()).map(function(t){return parseInt(t)});t._setTooltip(e.key?t.model.marker.color.getColorlegendMarker().label.getItems()[e.key]:t.values.label[e.KEY()]),t._selectlist.showCloseCross(e,!0)}},_mouseout:function(e,i){t.model.time.dragging||t.model.time.playing||(t._setTooltip(""),t.model.marker.clearHighlighted(),t._selectlist.showCloseCross(e,!1))},_click:function(e,i){t.model.time.dragging||t.model.time.playing||t.model.marker.selectMarker(e)}}},highlightMarkers:function(){var t=this;this.someHighlighted=this.model.marker.highlight.length>0,this.selectList&&this.someSelected&&this.selectList.classed("vzb-highlight",function(e){return t.model.marker.isHighlighted(e)})},selectMarkers:function(){this.someSelected=this.model.marker.select.length>0,this._selectlist.rebuild(),this.nonSelectedOpacityZero=!1},_sumLeafPointersByMarker:function(t,e){var i=this;return t.key?d3.sum(t.values.map(function(t){return i._sumLeafPointersByMarker(t,e)})):i.values[e][t.KEY()]},updateOpacity:function(){var t=this,e=1,i=.3,n=this.model.marker.opacityRegular,r=this.model.marker.opacityRegular,a=this.model.marker.opacitySelectDim;this.mountains.style("opacity",function(o){return t.someHighlighted&&t.model.marker.isHighlighted(o)?e:t.someSelected?t.model.marker.isSelected(o)?n:a:t.someHighlighted?i:r}),this.mountains.classed("vzb-selected",function(e){return t.model.marker.isSelected(e)});var o=t.model.marker.opacitySelectDim<.01;o!==this.nonSelectedOpacityZero&&this.mountainsAtomic.style("pointer-events",function(e){return t.someSelected&&o&&!t.model.marker.isSelected(e)?"none":"visible"}),this.nonSelectedOpacityZero=t.model.marker.opacitySelectDim<.01},updateTime:function(){this.time_1=null==this.time?this.model.time.value:this.time,this.time=this.model.time.value,this.duration=this.model.time.playing&&this.time-this.time_1>0?this.model.time.delayAnimations:0,this.year.setText(this.model.time.formatDate(this.time),this.duration)},updatePointers:function(){var t=this;this.yMax=0,this.mountainPointers.forEach(function(e,i){var n=t._spawn(t.values,e);t.cached[e.KEY()]=n,e.hidden=0===n.length}),"none"!==t.model.marker.stack.which&&this.stackedPointers.forEach(function(e){var i=[];e.values.forEach(function(t){i=i.concat(t.values.filter(function(t){return!t.hidden}))}),t.stack.keys(i.map(function(t){return t.KEY()}))(d3.range(t.mesh.length)).forEach(function(e,n){var r=i[n].KEY();e.forEach(function(e,i){t.cached[r][i].y0=e[0]})})}),this.mountainPointers.forEach(function(e){e.yMax=d3.max(t.cached[e.KEY()].map(function(t){return t.y0+t.y})),t.yMax<e.yMax&&(t.yMax=e.yMax)});var e=t.model.marker.group.merge,i=t.model.marker.stack.merge;this.stackedPointers.forEach(function(e){var i=t._getFirstLastPointersInStack(e);t.cached[e.key]=t._getVerticesOfaMergedShape(i),t.values.color[e.key]="_default",t.values.axis_y[e.key]=t._sumLeafPointersByMarker(e,"axis_y"),e.yMax=i.first.yMax}),this.groupedPointers.forEach(function(e){var i=t._getFirstLastPointersInStack(e);t.cached[e.key]=t._getVerticesOfaMergedShape(i),t.values.color[e.key]=t.values.color[i.first.KEY()],t.values.axis_y[e.key]=t._sumLeafPointersByMarker(e,"axis_y"),e.yMax=i.first.yMax}),i||e||"property"!==this.model.marker.stack.use||this.groupedPointers.forEach(function(t){var e=t.values.filter(function(t){return!t.hidden});t.yMax=e[0].yMax,t.values.forEach(function(e){e.yMaxGroup=t.yMax})})},_getFirstLastPointersInStack:function(t){var e=void 0,i=void 0,n=void 0,r=void 0;return t.values[0].values?(e=t.values[0].values.filter(function(t){return!t.hidden}),i=t.values[t.values.length-1].values.filter(function(t){return!t.hidden}),n=e[0],r=i[i.length-1]):(e=t.values.filter(function(t){return!t.hidden}),n=e[0],r=e[e.length-1]),(!e.length||i&&!i.length)&&o.warn("mountain chart failed to generate shapes. check the incoming data"),{first:n,last:r}},_getVerticesOfaMergedShape:function(t){var e=this,i=t.first.KEY(),n=t.last.KEY();return e.mesh.map(function(t,r){var a=e.cached[i][r].y0+e.cached[i][r].y-e.cached[n][r].y0,o=e.cached[n][r].y0;return{x:t,y0:o,y:a}})},_spawnMasks:function(){var t=this,e=this._math.unscale(this.model.marker.axis_x.tailFatX),i=this._math.unscale(this.model.marker.axis_x.tailCutX),n=this.model.marker.axis_x.tailFade,r=2*Math.PI/(Math.log(e)-Math.log(i)),a=Math.PI-Math.log(e)*r;this.spawnMask=[],this.cosineShape=[],this.cosineArea=0,this.mesh.forEach(function(o,s){t.spawnMask[s]=o<i?1:o>7*n?0:Math.exp((i-o)/n),t.cosineShape[s]=o>i&&o<e?1+Math.cos(Math.log(o)*r+a):0,t.cosineArea+=t.cosineShape[s]})},_spawn:function(t,e){var i=this,n=t.axis_y[e.KEY()],r=i._math.giniToSigma(t.axis_s[e.KEY()]),a=i._math.gdpToMu(t.axis_x[e.KEY()],r);if(!n||!a||!r)return[];var o=[],s=0;this.mesh.forEach(function(t,e){o[e]=i._math.pdf.lognormal(t,a,r),s+=i.spawnMask[e]*o[e]});var l=this.mesh.map(function(t,e){return{x:t,y0:0,y:n*(o[e]*(1-i.spawnMask[e])+i.cosineShape[e]/i.cosineArea*s)}});return l},_adjustMaxY:function(t){t||(t={});var e=this,i=this.model.ui.chart.yMaxMethod;("immediate"===i||t.force)&&("latest"===i?!function(){var t=e.values;e.model.marker.getFrame(e.model.time.end,function(i){i&&(e.values=i,e.updatePointers(),e.values=t,e.yScale.domain([0,Math.round(e.yMax)]),e.updatePointers(),e.redrawDataPoints())})}():(e.yMax||o.warn("Setting yMax to "+e.yMax+". You failed again :-/"),e.yScale.domain([0,Math.round(e.yMax)])))},redrawDataPoints:function(){var t=this,e=this.model.marker.group.merge,i=this.model.marker.stack.merge,n=this.model.marker.stack.which,r=(this.model.time.dragging||this.model.time.playing)&&"none"!==n;this._adjustMaxY(),this.mountainsMergeStacked.each(function(e){var n=d3.select(this),r=!i;t._renderShape(n,e.KEY(),r)}),this.mountainsMergeGrouped.each(function(n){var a=d3.select(this),o=!e&&!r||i&&!t.model.marker.isSelected(n);t._renderShape(a,n.KEY(),o)}),this.mountainsAtomic.each(function(n,a){var o=d3.select(this),s=n.hidden||(e||i||r)&&!t.model.marker.isSelected(n);t._renderShape(o,n.KEY(),s)}),"none"===n?this.mountainsAtomic.sort(function(t,e){return e.yMax-t.yMax}):"all"===n||e||r||this.mountainsAtomic.sort(function(t,e){return e.yMaxGroup-t.yMaxGroup})},redrawDataPointsOnlyColors:function(){var t=this;if(!this.mountains)return o.warn("redrawDataPointsOnlyColors(): no mountains  defined. likely a premature call, fix it!");var e="indicator"===this.model.marker.color.use;this.mountains.style("fill",function(i){return t.values.color[i.KEY()]?e&&"_default"==t.values.color[i.KEY()]?t.model.marker.color.palette._default:t.cScale(t.values.color[i.KEY()]):S})},_renderShape:function(t,e,i){var n=this.model.marker.stack.which,r=this;if(t.classed("vzb-hidden",i),i)return void("none"!==n&&t.style("stroke-opacity",0));var a={};a[this.KEY]=e,this.model.marker.isSelected(a)?t.attr("d",this.area(this.cached[e].filter(function(t){return t.y>r.values.axis_y[e]*z}))):t.attr("d",this.area(this.cached[e])),"indicator"===this.model.marker.color.use&&t.style("fill",r.values.color[e]?"_default"!==r.values.color[e]?r.cScale(r.values.color[e]):r.model.marker.color.palette._default:S),"none"!==n&&t.transition().duration(900*Math.random()+100).ease(d3.easeCircle).style("stroke-opacity",.5),this.model.time.record&&this._export.write({type:"path",id:e,time:this.model.time.value.getUTCFullYear(),fill:this.cScale(this.values.color[e]),d:this.area(this.cached[e])})},_setTooltip:function(t){if(t){var e=d3.mouse(this.graph.node()).map(function(t){return parseInt(t)});this.tooltip.classed("vzb-hidden",!1).attr("transform","translate("+e[0]+","+e[1]+")").selectAll("text").attr("text-anchor","middle").attr("alignment-baseline","middle").text(t);var i=this.tooltip.select("text").node().getBBox();this.tooltip.select("rect").attr("width",i.width+8).attr("height",i.height+8).attr("x",-i.width-25).attr("y",-i.height-25).attr("rx",.2*i.height).attr("ry",.2*i.height),this.tooltip.selectAll("text").attr("x",-i.width-25+(i.width+8)/2).attr("y",-i.height-25+(i.height+11)/2);var n=e[0]-i.width-25>0?e[0]:i.width+25,r=e[1]-i.height-25>0?e[1]:i.height+25;this.tooltip.attr("transform","translate("+n+","+r+")")}else this.tooltip.classed("vzb-hidden",!0)},preload:function(){var t=M.default.ext_resources.shapePath?M.default.ext_resources.shapePath:M.default.ext_resources.host+M.default.ext_resources.preloadPath+"mc_precomputed_shapes.json",e=this;return new Promise(function(i,n){d3.json(t,function(n,r){return n?console.warn("Failed loading json "+t+". "+n):(e.precomputedShapes=r,void i())})})}});e.default=E},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var a=i(1),o=(r(a),i(16)),s=n(o),l=s.default.extend({init:function(t){this.context=t,this.xScaleFactor=1,this.xScaleShift=0},rescale:function(t){return Math.exp(this.xScaleFactor*Math.log(t)+this.xScaleShift)},unscale:function(t){return Math.exp((Math.log(t)-this.xScaleShift)/this.xScaleFactor)},generateMesh:function(t,e,i){var n="linear"===e?i[0]:Math.log(this.unscale(i[0])),r="linear"===e?i[1]:Math.log(this.unscale(i[1])),a=(r-n)/t,o=d3.range(n,r,a).concat(r);return o="linear"!==e?o.map(function(t){return Math.exp(t)}):o.filter(function(t){return t>0})},gdpToMu:function(t,e,i,n){return Math.log(t/365)-e*e/2},giniToSigma:function(t){return this.normsinv((t/100+1)/2)*Math.pow(2,.5)},pdf:{normal:function(t,e,i){return Math.exp(-.5*Math.log(2*Math.PI)-Math.log(i)-Math.pow(t-e,2)/(2*i*i))},lognormal:function(t,e,i){return Math.exp(-.5*Math.log(2*Math.PI)-Math.log(i)-Math.pow(Math.log(t)-e,2)/(2*i*i))}},normsinv:function(t){var e=[-39.69683028665376,220.9460984245205,-275.9285104469687,138.357751867269,-30.66479806614716,2.506628277459239],i=[-54.47609879822406,161.5858368580409,-155.6989798598866,66.80131188771972,-13.28068155288572],n=[-.007784894002430293,-.3223964580411365,-2.400758277161838,-2.549732539343734,4.374664141464968,2.938163982698783],r=[.007784695709041462,.3224671290700398,2.445134137142996,3.754408661907416],a=.02425,o=1-a;if(t<a){var s=Math.sqrt(-2*Math.log(t));return(((((n[0]*s+n[1])*s+n[2])*s+n[3])*s+n[4])*s+n[5])/((((r[0]*s+r[1])*s+r[2])*s+r[3])*s+1)}if(o<t){var l=Math.sqrt(-2*Math.log(1-t));return-(((((n[0]*l+n[1])*l+n[2])*l+n[3])*l+n[4])*l+n[5])/((((r[0]*l+r[1])*l+r[2])*l+r[3])*l+1)}var c=t-.5,u=c*c;return(((((e[0]*u+e[1])*u+e[2])*u+e[3])*u+e[4])*u+e[5])*c/(((((i[0]*u+i[1])*u+i[2])*u+i[3])*u+i[4])*u+1)}});e.default=l},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var a=i(1),o=(r(a),i(16)),s=n(o),l=s.default.extend({init:function(t){this.context=t},redraw:function(t){var e=this.context;if(t||(t={}),t.level||(t.level=e.model.ui.chart.probeX),e.probeEl.classed("vzb-hidden",!t.level||!e.model.ui.chart.showProbeX),t.level){e.xAxisEl.call(e.xAxis.highlightValue(t.full?t.level:"none"));var i=0,n=0,r=0,a=function(a){i+=e.values.axis_y[a.KEY()],e.cached[a.KEY()].forEach(function(i){n+=i.y,e._math.rescale(i.x)<t.level&&(r+=i.y)})};"all"===e.model.marker.stack.which?e.stackedPointers.forEach(a):"none"===e.model.marker.stack.which?e.mountainPointers.forEach(a):e.groupedPointers.forEach(a);var o=d3.format(".3r"),s=e.model.marker.axis_y.getTickFormatter();e.heightOfLabels=e.heightOfLabels||.66*e.height,e.probeTextEl.each(function(i,n){if(8===n){var r=d3.select(this);t.full||e.model.ui.chart.probeX!=e.model.marker.axis_x.tailFatX?r.classed("vzb-hidden",!0):(r.text(e.translator("mount/extremepoverty")).classed("vzb-hidden",!1).attr("x",-e.height).attr("y",e.xScale(t.level)).attr("dy","-1.15em").attr("dx","0.5em").attr("transform","rotate(-90)"),e.heightOfLabels=e.height-r.node().getBBox().width-1.75*r.node().getBBox().height)}}),e.probeTextEl.each(function(a,l){if(8!==l){var c=d3.select(this),u=void 0;0!==l&&4!==l||(u=o(r/n*100)+"%"),1!==l&&5!==l||(u=o(100-r/n*100)+"%"),2!==l&&6!==l||(u=s(i*r/n)),3!==l&&7!==l||(u=s(i*(1-r/n))+" "+e.translator("mount/people")),c.text(u).classed("vzb-hidden",!t.full&&0!==l&&4!==l).attr("x",e.xScale(t.level)+([0,4,2,6].indexOf(l)>-1?-6:5)).attr("y",e.heightOfLabels).attr("dy",[0,1,4,5].indexOf(l)>-1?0:"1.5em")}}),e.probeLineEl.attr("x1",e.xScale(t.level)).attr("x2",e.xScale(t.level)).attr("y1",e.height+6).attr("y2",0)}}});e.default=l},function(t,e,i){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}Object.defineProperty(e,"__esModule",{value:!0});var a=i(1),o=r(a),s=i(16),l=n(s),c=i(10),u=l.default.extend({init:function(t){this.context=t},rebuild:function(t){var e=this.context,i=this,n=e.mountainPointers.concat(e.groupedPointers).concat(e.stackedPointers).filter(function(t){return e.model.marker.isSelected(t)}).sort(function(t,e){return t.sortValue&&e.sortValue?t.sortValue[1]===e.sortValue[1]?d3.descending(t.sortValue[0],e.sortValue[0]):d3.descending(t.sortValue[1],e.sortValue[1]):t.aggrLevel!=e.aggrLevel?d3.descending(t.aggrLevel,e.aggrLevel):t.aggrLevel&&e.aggrLevel?d3.descending(t.yMax,e.yMax):0});e.selectList=e.mountainLabelContainer.selectAll("g.vzb-mc-label").data(o.unique(n,function(t){return t.KEY()})),e.selectList.exit().remove(),e.selectList=e.selectList.enter().append("g").attr("class","vzb-mc-label").each(function(t,i){var n=d3.select(this);n.append("circle").attr("class","vzb-mc-label-legend"),
n.append("text").attr("class","vzb-mc-label-shadow vzb-mc-label-text"),n.append("text").attr("class","vzb-mc-label-text"),n.append("g").attr("class","vzb-mc-label-x vzb-label-shadow vzb-invisible").on("click",function(t,i){o.isTouchDevice()||(d3.event.stopPropagation(),e.model.marker.clearHighlighted(),e.model.marker.selectMarker(t),d3.event.stopPropagation())}).onTap(function(t,i){d3.select("#"+t.geo+"-label-"+e._id).remove(),e.model.marker.clearHighlighted(),e.model.marker.selectMarker(t)});var r=n.select("g.vzb-mc-label-x");o.isTouchDevice()?(r.append("rect"),r.append("text").attr("class","vzb-mc-label-x-text").text("Deselect")):(o.setIcon(r,c.close).select("svg").attr("class","vzb-mc-label-x-icon").attr("width","0px").attr("height","0px"),r.insert("circle","svg"))}).on("mousemove",function(t,n){o.isTouchDevice()||(i.showCloseCross(t,!0),e.model.marker.highlightMarker(t))}).on("mouseout",function(t,n){o.isTouchDevice()||(i.showCloseCross(t,!1),e.model.marker.clearHighlighted())}).on("click",function(t,i){o.isTouchDevice()||(e.model.marker.clearHighlighted(),e.model.marker.selectMarker(t))}).merge(e.selectList)},redraw:function(){var t=this.context;if(t.selectList&&t.someSelected){var e=t.mountainLabelContainer.append("g").attr("class","vzb-mc-label").append("text").text("0"),i=1.2*e.node().getBBox().height,n=parseFloat(e.style("font-size"))/i;d3.select(e.node().parentNode).remove();var r=t.model.marker.axis_y.getTickFormatter(),a=t.yTitleEl.select("text").node().getBBox().height||0,s=(t.height-3*a)/(t.selectList.data().length+2);i>s&&(i=s);var l="null",c=0,u=t.model.marker.color.getColorlegendMarker().label.getItems(),h=t.model.locale.isRTL();t.selectList.attr("transform",function(e,n){e.aggrLevel!=l&&(c+=i);var r=i*n+1.5*a+c;return l=e.aggrLevel,"translate("+(h?t.width:0)+","+r+")"}).each(function(e,a){var l=d3.select(this).attr("id",e.geo+"-label-"+t._id),c="";c=e.key?"all"===e.key?t.translator("mount/merging/world"):u[e.key]:t.values.label[e.KEY()];var d=t.values.axis_y[e.KEY()],f=c+": "+r(d)+(0===a?" "+t.translator("mount/people"):""),p=l.selectAll(".vzb-mc-label-text").attr("x",(h?-1:1)*i).attr("y",i).text(f).style("font-size",i===s?i*n+"px":null),m=p.node().getBBox(),g=l.select(".vzb-mc-label-x");if(o.isTouchDevice()){var v=g.select("text").node().getBBox();g.classed("vzb-revert-color",!0).select(".vzb-mc-label-x-text").classed("vzb-revert-color",!0).attr("x",m.width+1.12*m.height+.5*v.width).attr("y",.55*m.height),g.select("rect").attr("width",v.width+.6*m.height).attr("height",m.height).attr("x",m.width+.9*m.height).attr("y",0).attr("rx",.25*m.height).attr("ry",.25*m.height)}else g.attr("x",m.width+1.1*m.height).attr("y",m.height/3),g.select("circle").attr("r",.4*m.height).attr("cx",(h?-1:1)*(m.width+1.1*m.height)).attr("cy",m.height/3),g.select("svg").attr("x",(h?-1:1)*(m.width+m.height*(1.1-(h?-.4:.4)))).attr("y",m.height*(1/3-.4)).attr("width",.8*m.height).attr("height",.8*m.height);l.select(".vzb-mc-label-legend").attr("r",i/3).attr("cx",(h?-1:1)*i*.4).attr("cy",i/1.5).style("fill",t.cScale(t.values.color[e.KEY()])),l.onTap(function(e,i){d3.event.stopPropagation(),t.model.marker.highlightMarker(e),setTimeout(function(){t.model.marker.unhighlightMarker(e)},2e3)})})}},showCloseCross:function(t,e){var i=this.context,n=i.KEY;i.selectList.filter(function(e){return e[n]==t[n]}).select(".vzb-mc-label-x").classed("vzb-invisible",!e)}});e.default=u},function(t,e,i){"use strict";function n(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");return"="===t[e-2]?2:"="===t[e-1]?1:0}function r(t){return 3*t.length/4-n(t)}function a(t){var e,i,r,a,o,s,l=t.length;o=n(t),s=new h(3*l/4-o),r=o>0?l-4:l;var c=0;for(e=0,i=0;e<r;e+=4,i+=3)a=u[t.charCodeAt(e)]<<18|u[t.charCodeAt(e+1)]<<12|u[t.charCodeAt(e+2)]<<6|u[t.charCodeAt(e+3)],s[c++]=a>>16&255,s[c++]=a>>8&255,s[c++]=255&a;return 2===o?(a=u[t.charCodeAt(e)]<<2|u[t.charCodeAt(e+1)]>>4,s[c++]=255&a):1===o&&(a=u[t.charCodeAt(e)]<<10|u[t.charCodeAt(e+1)]<<4|u[t.charCodeAt(e+2)]>>2,s[c++]=a>>8&255,s[c++]=255&a),s}function o(t){return c[t>>18&63]+c[t>>12&63]+c[t>>6&63]+c[63&t]}function s(t,e,i){for(var n,r=[],a=e;a<i;a+=3)n=(t[a]<<16)+(t[a+1]<<8)+t[a+2],r.push(o(n));return r.join("")}function l(t){for(var e,i=t.length,n=i%3,r="",a=[],o=16383,l=0,u=i-n;l<u;l+=o)a.push(s(t,l,l+o>u?u:l+o));return 1===n?(e=t[i-1],r+=c[e>>2],r+=c[e<<4&63],r+="=="):2===n&&(e=(t[i-2]<<8)+t[i-1],r+=c[e>>10],r+=c[e>>4&63],r+=c[e<<2&63],r+="="),a.push(r),a.join("")}e.byteLength=r,e.toByteArray=a,e.fromByteArray=l;for(var c=[],u=[],h="undefined"!=typeof Uint8Array?Uint8Array:Array,d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",f=0,p=d.length;f<p;++f)c[f]=d[f],u[d.charCodeAt(f)]=f;u["-".charCodeAt(0)]=62,u["_".charCodeAt(0)]=63},function(t,e,i){"use strict";(function(t){function n(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()&&"function"==typeof t.subarray&&0===t.subarray(1,1).byteLength}catch(t){return!1}}function r(){return o.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function a(t,e){if(r()<e)throw new RangeError("Invalid typed array length");return o.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e),t.__proto__=o.prototype):(null===t&&(t=new o(e)),t.length=e),t}function o(t,e,i){if(!(o.TYPED_ARRAY_SUPPORT||this instanceof o))return new o(t,e,i);if("number"==typeof t){if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return u(this,t)}return s(this,t,e,i)}function s(t,e,i,n){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?f(t,e,i,n):"string"==typeof e?h(t,e,i):p(t,e)}function l(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function c(t,e,i,n){return l(e),e<=0?a(t,e):void 0!==i?"string"==typeof n?a(t,e).fill(i,n):a(t,e).fill(i):a(t,e)}function u(t,e){if(l(e),t=a(t,e<0?0:0|m(e)),!o.TYPED_ARRAY_SUPPORT)for(var i=0;i<e;++i)t[i]=0;return t}function h(t,e,i){if("string"==typeof i&&""!==i||(i="utf8"),!o.isEncoding(i))throw new TypeError('"encoding" must be a valid string encoding');var n=0|v(e,i);t=a(t,n);var r=t.write(e,i);return r!==n&&(t=t.slice(0,r)),t}function d(t,e){var i=e.length<0?0:0|m(e.length);t=a(t,i);for(var n=0;n<i;n+=1)t[n]=255&e[n];return t}function f(t,e,i,n){if(e.byteLength,i<0||e.byteLength<i)throw new RangeError("'offset' is out of bounds");if(e.byteLength<i+(n||0))throw new RangeError("'length' is out of bounds");return e=void 0===i&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,i):new Uint8Array(e,i,n),o.TYPED_ARRAY_SUPPORT?(t=e,t.__proto__=o.prototype):t=d(t,e),t}function p(t,e){if(o.isBuffer(e)){var i=0|m(e.length);return t=a(t,i),0===t.length?t:(e.copy(t,0,0,i),t)}if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!=typeof e.length||Z(e.length)?a(t,0):d(t,e);if("Buffer"===e.type&&$(e.data))return d(t,e.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function m(t){if(t>=r())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+r().toString(16)+" bytes");return 0|t}function g(t){return+t!=t&&(t=0),o.alloc(+t)}function v(t,e){if(o.isBuffer(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var i=t.length;if(0===i)return 0;for(var n=!1;;)switch(e){case"ascii":case"latin1":case"binary":return i;case"utf8":case"utf-8":case void 0:return X(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*i;case"hex":return i>>>1;case"base64":return G(t).length;default:if(n)return X(t).length;e=(""+e).toLowerCase(),n=!0}}function y(t,e,i){var n=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===i||i>this.length)&&(i=this.length),i<=0)return"";if(i>>>=0,e>>>=0,i<=e)return"";for(t||(t="utf8");;)switch(t){case"hex":return C(this,e,i);case"utf8":case"utf-8":return P(this,e,i);case"ascii":return A(this,e,i);case"latin1":case"binary":return I(this,e,i);case"base64":return T(this,e,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return L(this,e,i);default:if(n)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),n=!0}}function b(t,e,i){var n=t[e];t[e]=t[i],t[i]=n}function _(t,e,i,n,r){if(0===t.length)return-1;if("string"==typeof i?(n=i,i=0):i>2147483647?i=2147483647:i<-2147483648&&(i=-2147483648),i=+i,isNaN(i)&&(i=r?0:t.length-1),i<0&&(i=t.length+i),i>=t.length){if(r)return-1;i=t.length-1}else if(i<0){if(!r)return-1;i=0}if("string"==typeof e&&(e=o.from(e,n)),o.isBuffer(e))return 0===e.length?-1:x(t,e,i,n,r);if("number"==typeof e)return e&=255,o.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?r?Uint8Array.prototype.indexOf.call(t,e,i):Uint8Array.prototype.lastIndexOf.call(t,e,i):x(t,[e],i,n,r);throw new TypeError("val must be string, number or Buffer")}function x(t,e,i,n,r){function a(t,e){return 1===o?t[e]:t.readUInt16BE(e*o)}var o=1,s=t.length,l=e.length;if(void 0!==n&&(n=String(n).toLowerCase(),"ucs2"===n||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(t.length<2||e.length<2)return-1;o=2,s/=2,l/=2,i/=2}var c;if(r){var u=-1;for(c=i;c<s;c++)if(a(t,c)===a(e,u===-1?0:c-u)){if(u===-1&&(u=c),c-u+1===l)return u*o}else u!==-1&&(c-=c-u),u=-1}else for(i+l>s&&(i=s-l),c=i;c>=0;c--){for(var h=!0,d=0;d<l;d++)if(a(t,c+d)!==a(e,d)){h=!1;break}if(h)return c}return-1}function w(t,e,i,n){i=Number(i)||0;var r=t.length-i;n?(n=Number(n),n>r&&(n=r)):n=r;var a=e.length;if(a%2!==0)throw new TypeError("Invalid hex string");n>a/2&&(n=a/2);for(var o=0;o<n;++o){var s=parseInt(e.substr(2*o,2),16);if(isNaN(s))return o;t[i+o]=s}return o}function M(t,e,i,n){return K(X(e,t.length-i),t,i,n)}function z(t,e,i,n){return K(Y(e),t,i,n)}function S(t,e,i,n){return z(t,e,i,n)}function E(t,e,i,n){return K(G(e),t,i,n)}function k(t,e,i,n){return K(W(e,t.length-i),t,i,n)}function T(t,e,i){return 0===e&&i===t.length?Q.fromByteArray(t):Q.fromByteArray(t.slice(e,i))}function P(t,e,i){i=Math.min(t.length,i);for(var n=[],r=e;r<i;){var a=t[r],o=null,s=a>239?4:a>223?3:a>191?2:1;if(r+s<=i){var l,c,u,h;switch(s){case 1:a<128&&(o=a);break;case 2:l=t[r+1],128===(192&l)&&(h=(31&a)<<6|63&l,h>127&&(o=h));break;case 3:l=t[r+1],c=t[r+2],128===(192&l)&&128===(192&c)&&(h=(15&a)<<12|(63&l)<<6|63&c,h>2047&&(h<55296||h>57343)&&(o=h));break;case 4:l=t[r+1],c=t[r+2],u=t[r+3],128===(192&l)&&128===(192&c)&&128===(192&u)&&(h=(15&a)<<18|(63&l)<<12|(63&c)<<6|63&u,h>65535&&h<1114112&&(o=h))}}null===o?(o=65533,s=1):o>65535&&(o-=65536,n.push(o>>>10&1023|55296),o=56320|1023&o),n.push(o),r+=s}return O(n)}function O(t){var e=t.length;if(e<=tt)return String.fromCharCode.apply(String,t);for(var i="",n=0;n<e;)i+=String.fromCharCode.apply(String,t.slice(n,n+=tt));return i}function A(t,e,i){var n="";i=Math.min(t.length,i);for(var r=e;r<i;++r)n+=String.fromCharCode(127&t[r]);return n}function I(t,e,i){var n="";i=Math.min(t.length,i);for(var r=e;r<i;++r)n+=String.fromCharCode(t[r]);return n}function C(t,e,i){var n=t.length;(!e||e<0)&&(e=0),(!i||i<0||i>n)&&(i=n);for(var r="",a=e;a<i;++a)r+=H(t[a]);return r}function L(t,e,i){for(var n=t.slice(e,i),r="",a=0;a<n.length;a+=2)r+=String.fromCharCode(n[a]+256*n[a+1]);return r}function D(t,e,i){if(t%1!==0||t<0)throw new RangeError("offset is not uint");if(t+e>i)throw new RangeError("Trying to access beyond buffer length")}function R(t,e,i,n,r,a){if(!o.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>r||e<a)throw new RangeError('"value" argument is out of bounds');if(i+n>t.length)throw new RangeError("Index out of range")}function B(t,e,i,n){e<0&&(e=65535+e+1);for(var r=0,a=Math.min(t.length-i,2);r<a;++r)t[i+r]=(e&255<<8*(n?r:1-r))>>>8*(n?r:1-r)}function j(t,e,i,n){e<0&&(e=4294967295+e+1);for(var r=0,a=Math.min(t.length-i,4);r<a;++r)t[i+r]=e>>>8*(n?r:3-r)&255}function F(t,e,i,n,r,a){if(i+n>t.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("Index out of range")}function N(t,e,i,n,r){return r||F(t,e,i,4,3.4028234663852886e38,-3.4028234663852886e38),J.write(t,e,i,n,23,4),i+4}function q(t,e,i,n,r){return r||F(t,e,i,8,1.7976931348623157e308,-1.7976931348623157e308),J.write(t,e,i,n,52,8),i+8}function V(t){if(t=U(t).replace(et,""),t.length<2)return"";for(;t.length%4!==0;)t+="=";return t}function U(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function H(t){return t<16?"0"+t.toString(16):t.toString(16)}function X(t,e){e=e||1/0;for(var i,n=t.length,r=null,a=[],o=0;o<n;++o){if(i=t.charCodeAt(o),i>55295&&i<57344){if(!r){if(i>56319){(e-=3)>-1&&a.push(239,191,189);continue}if(o+1===n){(e-=3)>-1&&a.push(239,191,189);continue}r=i;continue}if(i<56320){(e-=3)>-1&&a.push(239,191,189),r=i;continue}i=(r-55296<<10|i-56320)+65536}else r&&(e-=3)>-1&&a.push(239,191,189);if(r=null,i<128){if((e-=1)<0)break;a.push(i)}else if(i<2048){if((e-=2)<0)break;a.push(i>>6|192,63&i|128)}else if(i<65536){if((e-=3)<0)break;a.push(i>>12|224,i>>6&63|128,63&i|128)}else{if(!(i<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;a.push(i>>18|240,i>>12&63|128,i>>6&63|128,63&i|128)}}return a}function Y(t){for(var e=[],i=0;i<t.length;++i)e.push(255&t.charCodeAt(i));return e}function W(t,e){for(var i,n,r,a=[],o=0;o<t.length&&!((e-=2)<0);++o)i=t.charCodeAt(o),n=i>>8,r=i%256,a.push(r),a.push(n);return a}function G(t){return Q.toByteArray(V(t))}function K(t,e,i,n){for(var r=0;r<n&&!(r+i>=e.length||r>=t.length);++r)e[r+i]=t[r];return r}function Z(t){return t!==t}var Q=i(232),J=i(467),$=i(468);e.Buffer=o,e.SlowBuffer=g,e.INSPECT_MAX_BYTES=50,o.TYPED_ARRAY_SUPPORT=void 0!==t.TYPED_ARRAY_SUPPORT?t.TYPED_ARRAY_SUPPORT:n(),e.kMaxLength=r(),o.poolSize=8192,o._augment=function(t){return t.__proto__=o.prototype,t},o.from=function(t,e,i){return s(null,t,e,i)},o.TYPED_ARRAY_SUPPORT&&(o.prototype.__proto__=Uint8Array.prototype,o.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&o[Symbol.species]===o&&Object.defineProperty(o,Symbol.species,{value:null,configurable:!0})),o.alloc=function(t,e,i){return c(null,t,e,i)},o.allocUnsafe=function(t){return u(null,t)},o.allocUnsafeSlow=function(t){return u(null,t)},o.isBuffer=function(t){return!(null==t||!t._isBuffer)},o.compare=function(t,e){if(!o.isBuffer(t)||!o.isBuffer(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var i=t.length,n=e.length,r=0,a=Math.min(i,n);r<a;++r)if(t[r]!==e[r]){i=t[r],n=e[r];break}return i<n?-1:n<i?1:0},o.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},o.concat=function(t,e){if(!$(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return o.alloc(0);var i;if(void 0===e)for(e=0,i=0;i<t.length;++i)e+=t[i].length;var n=o.allocUnsafe(e),r=0;for(i=0;i<t.length;++i){var a=t[i];if(!o.isBuffer(a))throw new TypeError('"list" argument must be an Array of Buffers');a.copy(n,r),r+=a.length}return n},o.byteLength=v,o.prototype._isBuffer=!0,o.prototype.swap16=function(){var t=this.length;if(t%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)b(this,e,e+1);return this},o.prototype.swap32=function(){var t=this.length;if(t%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)b(this,e,e+3),b(this,e+1,e+2);return this},o.prototype.swap64=function(){var t=this.length;if(t%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)b(this,e,e+7),b(this,e+1,e+6),b(this,e+2,e+5),b(this,e+3,e+4);return this},o.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?P(this,0,t):y.apply(this,arguments)},o.prototype.equals=function(t){if(!o.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===o.compare(this,t)},o.prototype.inspect=function(){var t="",i=e.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,i).match(/.{2}/g).join(" "),this.length>i&&(t+=" ... ")),"<Buffer "+t+">"},o.prototype.compare=function(t,e,i,n,r){if(!o.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===i&&(i=t?t.length:0),void 0===n&&(n=0),void 0===r&&(r=this.length),e<0||i>t.length||n<0||r>this.length)throw new RangeError("out of range index");if(n>=r&&e>=i)return 0;if(n>=r)return-1;if(e>=i)return 1;if(e>>>=0,i>>>=0,n>>>=0,r>>>=0,this===t)return 0;for(var a=r-n,s=i-e,l=Math.min(a,s),c=this.slice(n,r),u=t.slice(e,i),h=0;h<l;++h)if(c[h]!==u[h]){a=c[h],s=u[h];break}return a<s?-1:s<a?1:0},o.prototype.includes=function(t,e,i){return this.indexOf(t,e,i)!==-1},o.prototype.indexOf=function(t,e,i){return _(this,t,e,i,!0)},o.prototype.lastIndexOf=function(t,e,i){return _(this,t,e,i,!1)},o.prototype.write=function(t,e,i,n){if(void 0===e)n="utf8",i=this.length,e=0;else if(void 0===i&&"string"==typeof e)n=e,i=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(i)?(i|=0,void 0===n&&(n="utf8")):(n=i,i=void 0)}var r=this.length-e;if((void 0===i||i>r)&&(i=r),t.length>0&&(i<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var a=!1;;)switch(n){case"hex":return w(this,t,e,i);case"utf8":case"utf-8":return M(this,t,e,i);case"ascii":return z(this,t,e,i);case"latin1":case"binary":return S(this,t,e,i);case"base64":return E(this,t,e,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return k(this,t,e,i);default:if(a)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),a=!0}},o.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var tt=4096;o.prototype.slice=function(t,e){var i=this.length;t=~~t,e=void 0===e?i:~~e,t<0?(t+=i,t<0&&(t=0)):t>i&&(t=i),e<0?(e+=i,e<0&&(e=0)):e>i&&(e=i),e<t&&(e=t);var n;if(o.TYPED_ARRAY_SUPPORT)n=this.subarray(t,e),n.__proto__=o.prototype;else{var r=e-t;n=new o(r,void 0);for(var a=0;a<r;++a)n[a]=this[a+t]}return n},o.prototype.readUIntLE=function(t,e,i){t|=0,e|=0,i||D(t,e,this.length);for(var n=this[t],r=1,a=0;++a<e&&(r*=256);)n+=this[t+a]*r;return n},o.prototype.readUIntBE=function(t,e,i){t|=0,e|=0,i||D(t,e,this.length);for(var n=this[t+--e],r=1;e>0&&(r*=256);)n+=this[t+--e]*r;return n},o.prototype.readUInt8=function(t,e){return e||D(t,1,this.length),this[t]},o.prototype.readUInt16LE=function(t,e){return e||D(t,2,this.length),this[t]|this[t+1]<<8},o.prototype.readUInt16BE=function(t,e){return e||D(t,2,this.length),this[t]<<8|this[t+1]},o.prototype.readUInt32LE=function(t,e){return e||D(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},o.prototype.readUInt32BE=function(t,e){return e||D(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},o.prototype.readIntLE=function(t,e,i){t|=0,e|=0,i||D(t,e,this.length);for(var n=this[t],r=1,a=0;++a<e&&(r*=256);)n+=this[t+a]*r;return r*=128,n>=r&&(n-=Math.pow(2,8*e)),n},o.prototype.readIntBE=function(t,e,i){t|=0,e|=0,i||D(t,e,this.length);for(var n=e,r=1,a=this[t+--n];n>0&&(r*=256);)a+=this[t+--n]*r;return r*=128,a>=r&&(a-=Math.pow(2,8*e)),a},o.prototype.readInt8=function(t,e){return e||D(t,1,this.length),128&this[t]?(255-this[t]+1)*-1:this[t]},o.prototype.readInt16LE=function(t,e){e||D(t,2,this.length);var i=this[t]|this[t+1]<<8;return 32768&i?4294901760|i:i},o.prototype.readInt16BE=function(t,e){e||D(t,2,this.length);var i=this[t+1]|this[t]<<8;return 32768&i?4294901760|i:i},o.prototype.readInt32LE=function(t,e){return e||D(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},o.prototype.readInt32BE=function(t,e){return e||D(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},o.prototype.readFloatLE=function(t,e){return e||D(t,4,this.length),J.read(this,t,!0,23,4)},o.prototype.readFloatBE=function(t,e){return e||D(t,4,this.length),J.read(this,t,!1,23,4)},o.prototype.readDoubleLE=function(t,e){return e||D(t,8,this.length),J.read(this,t,!0,52,8)},o.prototype.readDoubleBE=function(t,e){return e||D(t,8,this.length),J.read(this,t,!1,52,8)},o.prototype.writeUIntLE=function(t,e,i,n){if(t=+t,e|=0,i|=0,!n){var r=Math.pow(2,8*i)-1;R(this,t,e,i,r,0)}var a=1,o=0;for(this[e]=255&t;++o<i&&(a*=256);)this[e+o]=t/a&255;return e+i},o.prototype.writeUIntBE=function(t,e,i,n){if(t=+t,e|=0,i|=0,!n){var r=Math.pow(2,8*i)-1;R(this,t,e,i,r,0)}var a=i-1,o=1;for(this[e+a]=255&t;--a>=0&&(o*=256);)this[e+a]=t/o&255;return e+i},o.prototype.writeUInt8=function(t,e,i){return t=+t,e|=0,i||R(this,t,e,1,255,0),o.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},o.prototype.writeUInt16LE=function(t,e,i){return t=+t,e|=0,i||R(this,t,e,2,65535,0),o.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):B(this,t,e,!0),e+2},o.prototype.writeUInt16BE=function(t,e,i){return t=+t,e|=0,i||R(this,t,e,2,65535,0),o.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):B(this,t,e,!1),e+2},o.prototype.writeUInt32LE=function(t,e,i){return t=+t,e|=0,i||R(this,t,e,4,4294967295,0),o.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):j(this,t,e,!0),e+4},o.prototype.writeUInt32BE=function(t,e,i){return t=+t,e|=0,i||R(this,t,e,4,4294967295,0),o.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):j(this,t,e,!1),e+4},o.prototype.writeIntLE=function(t,e,i,n){if(t=+t,e|=0,!n){var r=Math.pow(2,8*i-1);R(this,t,e,i,r-1,-r)}var a=0,o=1,s=0;for(this[e]=255&t;++a<i&&(o*=256);)t<0&&0===s&&0!==this[e+a-1]&&(s=1),this[e+a]=(t/o>>0)-s&255;return e+i},o.prototype.writeIntBE=function(t,e,i,n){if(t=+t,e|=0,!n){var r=Math.pow(2,8*i-1);R(this,t,e,i,r-1,-r)}var a=i-1,o=1,s=0;for(this[e+a]=255&t;--a>=0&&(o*=256);)t<0&&0===s&&0!==this[e+a+1]&&(s=1),this[e+a]=(t/o>>0)-s&255;return e+i},o.prototype.writeInt8=function(t,e,i){return t=+t,e|=0,i||R(this,t,e,1,127,-128),o.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},o.prototype.writeInt16LE=function(t,e,i){return t=+t,e|=0,i||R(this,t,e,2,32767,-32768),o.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):B(this,t,e,!0),e+2},o.prototype.writeInt16BE=function(t,e,i){return t=+t,e|=0,i||R(this,t,e,2,32767,-32768),o.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):B(this,t,e,!1),e+2},o.prototype.writeInt32LE=function(t,e,i){return t=+t,e|=0,i||R(this,t,e,4,2147483647,-2147483648),o.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):j(this,t,e,!0),e+4},o.prototype.writeInt32BE=function(t,e,i){return t=+t,e|=0,i||R(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),o.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):j(this,t,e,!1),e+4},o.prototype.writeFloatLE=function(t,e,i){return N(this,t,e,!0,i)},o.prototype.writeFloatBE=function(t,e,i){return N(this,t,e,!1,i)},o.prototype.writeDoubleLE=function(t,e,i){return q(this,t,e,!0,i)},o.prototype.writeDoubleBE=function(t,e,i){return q(this,t,e,!1,i)},o.prototype.copy=function(t,e,i,n){if(i||(i=0),n||0===n||(n=this.length),e>=t.length&&(e=t.length),e||(e=0),n>0&&n<i&&(n=i),n===i)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(i<0||i>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),t.length-e<n-i&&(n=t.length-e+i);var r,a=n-i;if(this===t&&i<e&&e<n)for(r=a-1;r>=0;--r)t[r+e]=this[r+i];else if(a<1e3||!o.TYPED_ARRAY_SUPPORT)for(r=0;r<a;++r)t[r+e]=this[r+i];else Uint8Array.prototype.set.call(t,this.subarray(i,i+a),e);return a},o.prototype.fill=function(t,e,i,n){if("string"==typeof t){if("string"==typeof e?(n=e,e=0,i=this.length):"string"==typeof i&&(n=i,i=this.length),1===t.length){var r=t.charCodeAt(0);r<256&&(t=r)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!o.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<i)throw new RangeError("Out of range index");if(i<=e)return this;e>>>=0,i=void 0===i?this.length:i>>>0,t||(t=0);var a;if("number"==typeof t)for(a=e;a<i;++a)this[a]=t;else{var s=o.isBuffer(t)?t:X(new o(t,n).toString()),l=s.length;for(a=0;a<i-e;++a)this[a+e]=s[a%l]}return this};var et=/[^+\/0-9A-Za-z-_]/g}).call(e,i(85))},function(t,e,i){i(243),t.exports=i(36).RegExp.escape},function(t,e,i){var n=i(6),r=i(99),a=i(7)("species");t.exports=function(t){var e;return r(t)&&(e=t.constructor,"function"!=typeof e||e!==Array&&!r(e.prototype)||(e=void 0),n(e)&&(e=e[a],null===e&&(e=void 0))),void 0===e?Array:e}},function(t,e,i){var n=i(235);t.exports=function(t,e){return new(n(t))(e)}},function(t,e,i){"use strict";var n=i(3),r=i(33),a="number";t.exports=function(t){if("string"!==t&&t!==a&&"default"!==t)throw TypeError("Incorrect hint");return r(n(this),t!=a)}},function(t,e,i){var n=i(54),r=i(82),a=i(70);t.exports=function(t){var e=n(t),i=r.f;if(i)for(var o,s=i(t),l=a.f,c=0;s.length>c;)l.call(t,o=s[c++])&&e.push(o);return e}},function(t,e,i){var n=i(54),r=i(21);t.exports=function(t,e){for(var i,a=r(t),o=n(a),s=o.length,l=0;s>l;)if(a[i=o[l++]]===e)return i}},function(t,e,i){"use strict";var n=i(241),r=i(78),a=i(17);t.exports=function(){for(var t=a(this),e=arguments.length,i=Array(e),o=0,s=n._,l=!1;e>o;)(i[o]=arguments[o++])===s&&(l=!0);return function(){var n,a=this,o=arguments.length,c=0,u=0;if(!l&&!o)return r(t,i,a);if(n=i.slice(),l)for(;e>c;c++)n[c]===s&&(n[c]=arguments[u++]);for(;o>u;)n.push(arguments[u++]);return r(t,n,a)}}},function(t,e,i){t.exports=i(4)},function(t,e){t.exports=function(t,e){var i=e===Object(e)?function(t){return e[t]}:e;return function(e){return String(e).replace(t,i)}}},function(t,e,i){var n=i(0),r=i(242)(/[\\^$*+?.()|[\]{}]/g,"\\$&");n(n.S,"RegExp",{escape:function(t){return r(t)}})},function(t,e,i){var n=i(0);n(n.P,"Array",{copyWithin:i(154)}),i(62)("copyWithin")},function(t,e,i){"use strict";var n=i(0),r=i(31)(4);n(n.P+n.F*!i(30)([].every,!0),"Array",{every:function(t){return r(this,t,arguments[1])}})},function(t,e,i){var n=i(0);n(n.P,"Array",{fill:i(91)}),i(62)("fill")},function(t,e,i){"use strict";var n=i(0),r=i(31)(2);n(n.P+n.F*!i(30)([].filter,!0),"Array",{filter:function(t){return r(this,t,arguments[1])}})},function(t,e,i){"use strict";var n=i(0),r=i(31)(6),a="findIndex",o=!0;a in[]&&Array(1)[a](function(){o=!1}),n(n.P+n.F*o,"Array",{findIndex:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0)}}),i(62)(a)},function(t,e,i){"use strict";var n=i(0),r=i(31)(5),a="find",o=!0;a in[]&&Array(1)[a](function(){o=!1}),n(n.P+n.F*o,"Array",{find:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0)}}),i(62)(a)},function(t,e,i){"use strict";var n=i(0),r=i(31)(0),a=i(30)([].forEach,!0);n(n.P+n.F*!a,"Array",{forEach:function(t){return r(this,t,arguments[1])}})},function(t,e,i){"use strict";var n=i(37),r=i(0),a=i(13),o=i(163),s=i(98),l=i(12),c=i(92),u=i(115);r(r.S+r.F*!i(80)(function(t){Array.from(t)}),"Array",{from:function(t){var e,i,r,h,d=a(t),f="function"==typeof this?this:Array,p=arguments.length,m=p>1?arguments[1]:void 0,g=void 0!==m,v=0,y=u(d);if(g&&(m=n(m,p>2?arguments[2]:void 0,2)),void 0==y||f==Array&&s(y))for(e=l(d.length),i=new f(e);e>v;v++)c(i,v,g?m(d[v],v):d[v]);else for(h=y.call(d),i=new f;!(r=h.next()).done;v++)c(i,v,g?o(h,m,[r.value,v],!0):r.value);return i.length=v,i}})},function(t,e,i){"use strict";var n=i(0),r=i(74)(!1),a=[].indexOf,o=!!a&&1/[1].indexOf(1,-0)<0;n(n.P+n.F*(o||!i(30)(a)),"Array",{indexOf:function(t){return o?a.apply(this,arguments)||0:r(this,t,arguments[1])}})},function(t,e,i){var n=i(0);n(n.S,"Array",{isArray:i(99)})},function(t,e,i){"use strict";var n=i(0),r=i(21),a=[].join;n(n.P+n.F*(i(69)!=Object||!i(30)(a)),"Array",{join:function(t){return a.call(r(this),void 0===t?",":t)}})},function(t,e,i){"use strict";var n=i(0),r=i(21),a=i(45),o=i(12),s=[].lastIndexOf,l=!!s&&1/[1].lastIndexOf(1,-0)<0;n(n.P+n.F*(l||!i(30)(s)),"Array",{lastIndexOf:function(t){if(l)return s.apply(this,arguments)||0;var e=r(this),i=o(e.length),n=i-1;for(arguments.length>1&&(n=Math.min(n,a(arguments[1]))),n<0&&(n=i+n);n>=0;n--)if(n in e&&e[n]===t)return n||0;return-1}})},function(t,e,i){"use strict";var n=i(0),r=i(31)(1);n(n.P+n.F*!i(30)([].map,!0),"Array",{map:function(t){return r(this,t,arguments[1])}})},function(t,e,i){"use strict";var n=i(0),r=i(92);n(n.S+n.F*i(5)(function(){function t(){}return!(Array.of.call(t)instanceof t)}),"Array",{of:function(){for(var t=0,e=arguments.length,i=new("function"==typeof this?this:Array)(e);e>t;)r(i,t,arguments[t++]);return i.length=e,i}})},function(t,e,i){"use strict";var n=i(0),r=i(156);n(n.P+n.F*!i(30)([].reduceRight,!0),"Array",{reduceRight:function(t){return r(this,t,arguments.length,arguments[1],!0)}})},function(t,e,i){"use strict";var n=i(0),r=i(156);n(n.P+n.F*!i(30)([].reduce,!0),"Array",{reduce:function(t){return r(this,t,arguments.length,arguments[1],!1)}})},function(t,e,i){"use strict";var n=i(0),r=i(96),a=i(28),o=i(57),s=i(12),l=[].slice;n(n.P+n.F*i(5)(function(){r&&l.call(r)}),"Array",{slice:function(t,e){var i=s(this.length),n=a(this);if(e=void 0===e?i:e,"Array"==n)return l.call(this,t,e);for(var r=o(t,i),c=o(e,i),u=s(c-r),h=Array(u),d=0;d<u;d++)h[d]="String"==n?this.charAt(r+d):this[r+d];return h}})},function(t,e,i){"use strict";var n=i(0),r=i(31)(3);n(n.P+n.F*!i(30)([].some,!0),"Array",{some:function(t){return r(this,t,arguments[1])}})},function(t,e,i){"use strict";var n=i(0),r=i(17),a=i(13),o=i(5),s=[].sort,l=[1,2,3];n(n.P+n.F*(o(function(){l.sort(void 0)})||!o(function(){l.sort(null)})||!i(30)(s)),"Array",{sort:function(t){return void 0===t?s.call(a(this)):s.call(a(this),r(t))}})},function(t,e,i){i(56)("Array")},function(t,e,i){var n=i(0);n(n.S,"Date",{now:function(){return(new Date).getTime()}})},function(t,e,i){"use strict";var n=i(0),r=i(5),a=Date.prototype.getTime,o=function(t){return t>9?t:"0"+t};n(n.P+n.F*(r(function(){return"0385-07-25T07:06:39.999Z"!=new Date(-5e13-1).toISOString()})||!r(function(){new Date(NaN).toISOString()})),"Date",{toISOString:function(){if(!isFinite(a.call(this)))throw RangeError("Invalid time value");var t=this,e=t.getUTCFullYear(),i=t.getUTCMilliseconds(),n=e<0?"-":e>9999?"+":"";return n+("00000"+Math.abs(e)).slice(n?-6:-4)+"-"+o(t.getUTCMonth()+1)+"-"+o(t.getUTCDate())+"T"+o(t.getUTCHours())+":"+o(t.getUTCMinutes())+":"+o(t.getUTCSeconds())+"."+(i>99?i:"0"+o(i))+"Z"}})},function(t,e,i){"use strict";var n=i(0),r=i(13),a=i(33);n(n.P+n.F*i(5)(function(){return null!==new Date(NaN).toJSON()||1!==Date.prototype.toJSON.call({toISOString:function(){return 1}})}),"Date",{toJSON:function(t){var e=r(this),i=a(e);return"number"!=typeof i||isFinite(i)?e.toISOString():null}})},function(t,e,i){var n=i(7)("toPrimitive"),r=Date.prototype;n in r||i(18)(r,n,i(237))},function(t,e,i){var n=Date.prototype,r="Invalid Date",a="toString",o=n[a],s=n.getTime;new Date(NaN)+""!=r&&i(19)(n,a,function(){var t=s.call(this);return t===t?o.call(this):r})},function(t,e,i){var n=i(0);n(n.P,"Function",{bind:i(157)})},function(t,e,i){"use strict";var n=i(6),r=i(25),a=i(7)("hasInstance"),o=Function.prototype;a in o||i(9).f(o,a,{value:function(t){if("function"!=typeof this||!n(t))return!1;if(!n(this.prototype))return t instanceof this;for(;t=r(t);)if(this.prototype===t)return!0;return!1}})},function(t,e,i){var n=i(9).f,r=i(44),a=i(14),o=Function.prototype,s=/^\s*function ([^ (]*)/,l="name",c=Object.isExtensible||function(){return!0};l in o||i(8)&&n(o,l,{configurable:!0,get:function(){try{var t=this,e=(""+t).match(s)[1];return a(t,l)||!c(t)||n(t,l,r(5,e)),e}catch(t){return""}}})},function(t,e,i){
var n=i(0),r=i(165),a=Math.sqrt,o=Math.acosh;n(n.S+n.F*!(o&&710==Math.floor(o(Number.MAX_VALUE))&&o(1/0)==1/0),"Math",{acosh:function(t){return(t=+t)<1?NaN:t>94906265.62425156?Math.log(t)+Math.LN2:r(t-1+a(t-1)*a(t+1))}})},function(t,e,i){function n(t){return isFinite(t=+t)&&0!=t?t<0?-n(-t):Math.log(t+Math.sqrt(t*t+1)):t}var r=i(0),a=Math.asinh;r(r.S+r.F*!(a&&1/a(0)>0),"Math",{asinh:n})},function(t,e,i){var n=i(0),r=Math.atanh;n(n.S+n.F*!(r&&1/r(-0)<0),"Math",{atanh:function(t){return 0==(t=+t)?t:Math.log((1+t)/(1-t))/2}})},function(t,e,i){var n=i(0),r=i(103);n(n.S,"Math",{cbrt:function(t){return r(t=+t)*Math.pow(Math.abs(t),1/3)}})},function(t,e,i){var n=i(0);n(n.S,"Math",{clz32:function(t){return(t>>>=0)?31-Math.floor(Math.log(t+.5)*Math.LOG2E):32}})},function(t,e,i){var n=i(0),r=Math.exp;n(n.S,"Math",{cosh:function(t){return(r(t=+t)+r(-t))/2}})},function(t,e,i){var n=i(0),r=i(102);n(n.S+n.F*(r!=Math.expm1),"Math",{expm1:r})},function(t,e,i){var n=i(0),r=i(103),a=Math.pow,o=a(2,-52),s=a(2,-23),l=a(2,127)*(2-s),c=a(2,-126),u=function(t){return t+1/o-1/o};n(n.S,"Math",{fround:function(t){var e,i,n=Math.abs(t),a=r(t);return n<c?a*u(n/c/s)*c*s:(e=(1+s/o)*n,i=e-(e-n),i>l||i!=i?a*(1/0):a*i)}})},function(t,e,i){var n=i(0),r=Math.abs;n(n.S,"Math",{hypot:function(t,e){for(var i,n,a=0,o=0,s=arguments.length,l=0;o<s;)i=r(arguments[o++]),l<i?(n=l/i,a=a*n*n+1,l=i):i>0?(n=i/l,a+=n*n):a+=i;return l===1/0?1/0:l*Math.sqrt(a)}})},function(t,e,i){var n=i(0),r=Math.imul;n(n.S+n.F*i(5)(function(){return r(4294967295,5)!=-5||2!=r.length}),"Math",{imul:function(t,e){var i=65535,n=+t,r=+e,a=i&n,o=i&r;return 0|a*o+((i&n>>>16)*o+a*(i&r>>>16)<<16>>>0)}})},function(t,e,i){var n=i(0);n(n.S,"Math",{log10:function(t){return Math.log(t)/Math.LN10}})},function(t,e,i){var n=i(0);n(n.S,"Math",{log1p:i(165)})},function(t,e,i){var n=i(0);n(n.S,"Math",{log2:function(t){return Math.log(t)/Math.LN2}})},function(t,e,i){var n=i(0);n(n.S,"Math",{sign:i(103)})},function(t,e,i){var n=i(0),r=i(102),a=Math.exp;n(n.S+n.F*i(5)(function(){return!Math.sinh(-2e-17)!=-2e-17}),"Math",{sinh:function(t){return Math.abs(t=+t)<1?(r(t)-r(-t))/2:(a(t-1)-a(-t-1))*(Math.E/2)}})},function(t,e,i){var n=i(0),r=i(102),a=Math.exp;n(n.S,"Math",{tanh:function(t){var e=r(t=+t),i=r(-t);return e==1/0?1:i==1/0?-1:(e-i)/(a(t)+a(-t))}})},function(t,e,i){var n=i(0);n(n.S,"Math",{trunc:function(t){return(t>0?Math.floor:Math.ceil)(t)}})},function(t,e,i){"use strict";var n=i(4),r=i(14),a=i(28),o=i(97),s=i(33),l=i(5),c=i(53).f,u=i(24).f,h=i(9).f,d=i(66).trim,f="Number",p=n[f],m=p,g=p.prototype,v=a(i(52)(g))==f,y="trim"in String.prototype,b=function(t){var e=s(t,!1);if("string"==typeof e&&e.length>2){e=y?e.trim():d(e,3);var i,n,r,a=e.charCodeAt(0);if(43===a||45===a){if(i=e.charCodeAt(2),88===i||120===i)return NaN}else if(48===a){switch(e.charCodeAt(1)){case 66:case 98:n=2,r=49;break;case 79:case 111:n=8,r=55;break;default:return+e}for(var o,l=e.slice(2),c=0,u=l.length;c<u;c++)if(o=l.charCodeAt(c),o<48||o>r)return NaN;return parseInt(l,n)}}return+e};if(!p(" 0o1")||!p("0b1")||p("+0x1")){p=function(t){var e=arguments.length<1?0:t,i=this;return i instanceof p&&(v?l(function(){g.valueOf.call(i)}):a(i)!=f)?o(new m(b(e)),i,p):b(e)};for(var _,x=i(8)?c(m):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),w=0;x.length>w;w++)r(m,_=x[w])&&!r(p,_)&&h(p,_,u(m,_));p.prototype=g,g.constructor=p,i(19)(n,f,p)}},function(t,e,i){var n=i(0);n(n.S,"Number",{EPSILON:Math.pow(2,-52)})},function(t,e,i){var n=i(0),r=i(4).isFinite;n(n.S,"Number",{isFinite:function(t){return"number"==typeof t&&r(t)}})},function(t,e,i){var n=i(0);n(n.S,"Number",{isInteger:i(162)})},function(t,e,i){var n=i(0);n(n.S,"Number",{isNaN:function(t){return t!=t}})},function(t,e,i){var n=i(0),r=i(162),a=Math.abs;n(n.S,"Number",{isSafeInteger:function(t){return r(t)&&a(t)<=9007199254740991}})},function(t,e,i){var n=i(0);n(n.S,"Number",{MAX_SAFE_INTEGER:9007199254740991})},function(t,e,i){var n=i(0);n(n.S,"Number",{MIN_SAFE_INTEGER:-9007199254740991})},function(t,e,i){var n=i(0),r=i(172);n(n.S+n.F*(Number.parseFloat!=r),"Number",{parseFloat:r})},function(t,e,i){var n=i(0),r=i(173);n(n.S+n.F*(Number.parseInt!=r),"Number",{parseInt:r})},function(t,e,i){"use strict";var n=i(0),r=i(45),a=i(153),o=i(110),s=1..toFixed,l=Math.floor,c=[0,0,0,0,0,0],u="Number.toFixed: incorrect invocation!",h="0",d=function(t,e){for(var i=-1,n=e;++i<6;)n+=t*c[i],c[i]=n%1e7,n=l(n/1e7)},f=function(t){for(var e=6,i=0;--e>=0;)i+=c[e],c[e]=l(i/t),i=i%t*1e7},p=function(){for(var t=6,e="";--t>=0;)if(""!==e||0===t||0!==c[t]){var i=String(c[t]);e=""===e?i:e+o.call(h,7-i.length)+i}return e},m=function(t,e,i){return 0===e?i:e%2===1?m(t,e-1,i*t):m(t*t,e/2,i)},g=function(t){for(var e=0,i=t;i>=4096;)e+=12,i/=4096;for(;i>=2;)e+=1,i/=2;return e};n(n.P+n.F*(!!s&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0))||!i(5)(function(){s.call({})})),"Number",{toFixed:function(t){var e,i,n,s,l=a(this,u),c=r(t),v="",y=h;if(c<0||c>20)throw RangeError(u);if(l!=l)return"NaN";if(l<=-1e21||l>=1e21)return String(l);if(l<0&&(v="-",l=-l),l>1e-21)if(e=g(l*m(2,69,1))-69,i=e<0?l*m(2,-e,1):l/m(2,e,1),i*=4503599627370496,e=52-e,e>0){for(d(0,i),n=c;n>=7;)d(1e7,0),n-=7;for(d(m(10,n,1),0),n=e-1;n>=23;)f(1<<23),n-=23;f(1<<n),d(1,1),f(2),y=p()}else d(0,i),d(1<<-e,0),y=p()+o.call(h,c);return c>0?(s=y.length,y=v+(s<=c?"0."+o.call(h,c-s)+y:y.slice(0,s-c)+"."+y.slice(s-c))):y=v+y,y}})},function(t,e,i){"use strict";var n=i(0),r=i(5),a=i(153),o=1..toPrecision;n(n.P+n.F*(r(function(){return"1"!==o.call(1,void 0)})||!r(function(){o.call({})})),"Number",{toPrecision:function(t){var e=a(this,"Number#toPrecision: incorrect invocation!");return void 0===t?o.call(e):o.call(e,t)}})},function(t,e,i){var n=i(0);n(n.S+n.F,"Object",{assign:i(166)})},function(t,e,i){var n=i(0);n(n.S,"Object",{create:i(52)})},function(t,e,i){var n=i(0);n(n.S+n.F*!i(8),"Object",{defineProperties:i(167)})},function(t,e,i){var n=i(0);n(n.S+n.F*!i(8),"Object",{defineProperty:i(9).f})},function(t,e,i){var n=i(6),r=i(43).onFreeze;i(32)("freeze",function(t){return function(e){return t&&n(e)?t(r(e)):e}})},function(t,e,i){var n=i(21),r=i(24).f;i(32)("getOwnPropertyDescriptor",function(){return function(t,e){return r(n(t),e)}})},function(t,e,i){i(32)("getOwnPropertyNames",function(){return i(168).f})},function(t,e,i){var n=i(13),r=i(25);i(32)("getPrototypeOf",function(){return function(t){return r(n(t))}})},function(t,e,i){var n=i(6);i(32)("isExtensible",function(t){return function(e){return!!n(e)&&(!t||t(e))}})},function(t,e,i){var n=i(6);i(32)("isFrozen",function(t){return function(e){return!n(e)||!!t&&t(e)}})},function(t,e,i){var n=i(6);i(32)("isSealed",function(t){return function(e){return!n(e)||!!t&&t(e)}})},function(t,e,i){var n=i(0);n(n.S,"Object",{is:i(174)})},function(t,e,i){var n=i(13),r=i(54);i(32)("keys",function(){return function(t){return r(n(t))}})},function(t,e,i){var n=i(6),r=i(43).onFreeze;i(32)("preventExtensions",function(t){return function(e){return t&&n(e)?t(r(e)):e}})},function(t,e,i){var n=i(6),r=i(43).onFreeze;i(32)("seal",function(t){return function(e){return t&&n(e)?t(r(e)):e}})},function(t,e,i){var n=i(0);n(n.S,"Object",{setPrototypeOf:i(105).set})},function(t,e,i){"use strict";var n=i(68),r={};r[i(7)("toStringTag")]="z",r+""!="[object z]"&&i(19)(Object.prototype,"toString",function(){return"[object "+n(this)+"]"},!0)},function(t,e,i){var n=i(0),r=i(172);n(n.G+n.F*(parseFloat!=r),{parseFloat:r})},function(t,e,i){var n=i(0),r=i(173);n(n.G+n.F*(parseInt!=r),{parseInt:r})},function(t,e,i){"use strict";var n,r,a,o=i(51),s=i(4),l=i(37),c=i(68),u=i(0),h=i(6),d=i(17),f=i(50),p=i(63),m=i(107),g=i(112).set,v=i(104)(),y="Promise",b=s.TypeError,_=s.process,x=s[y],_=s.process,w="process"==c(_),M=function(){},z=!!function(){try{var t=x.resolve(1),e=(t.constructor={})[i(7)("species")]=function(t){t(M,M)};return(w||"function"==typeof PromiseRejectionEvent)&&t.then(M)instanceof e}catch(t){}}(),S=function(t,e){return t===e||t===x&&e===a},E=function(t){var e;return!(!h(t)||"function"!=typeof(e=t.then))&&e},k=function(t){return S(x,t)?new T(t):new r(t)},T=r=function(t){var e,i;this.promise=new t(function(t,n){if(void 0!==e||void 0!==i)throw b("Bad Promise constructor");e=t,i=n}),this.resolve=d(e),this.reject=d(i)},P=function(t){try{t()}catch(t){return{error:t}}},O=function(t,e){if(!t._n){t._n=!0;var i=t._c;v(function(){for(var n=t._v,r=1==t._s,a=0,o=function(e){var i,a,o=r?e.ok:e.fail,s=e.resolve,l=e.reject,c=e.domain;try{o?(r||(2==t._h&&C(t),t._h=1),o===!0?i=n:(c&&c.enter(),i=o(n),c&&c.exit()),i===e.promise?l(b("Promise-chain cycle")):(a=E(i))?a.call(i,s,l):s(i)):l(n)}catch(t){l(t)}};i.length>a;)o(i[a++]);t._c=[],t._n=!1,e&&!t._h&&A(t)})}},A=function(t){g.call(s,function(){var e,i,n,r=t._v;if(I(t)&&(e=P(function(){w?_.emit("unhandledRejection",r,t):(i=s.onunhandledrejection)?i({promise:t,reason:r}):(n=s.console)&&n.error&&n.error("Unhandled promise rejection",r)}),t._h=w||I(t)?2:1),t._a=void 0,e)throw e.error})},I=function(t){if(1==t._h)return!1;for(var e,i=t._a||t._c,n=0;i.length>n;)if(e=i[n++],e.fail||!I(e.promise))return!1;return!0},C=function(t){g.call(s,function(){var e;w?_.emit("rejectionHandled",t):(e=s.onrejectionhandled)&&e({promise:t,reason:t._v})})},L=function(t){var e=this;e._d||(e._d=!0,e=e._w||e,e._v=t,e._s=2,e._a||(e._a=e._c.slice()),O(e,!0))},D=function(t){var e,i=this;if(!i._d){i._d=!0,i=i._w||i;try{if(i===t)throw b("Promise can't be resolved itself");(e=E(t))?v(function(){var n={_w:i,_d:!1};try{e.call(t,l(D,n,1),l(L,n,1))}catch(t){L.call(n,t)}}):(i._v=t,i._s=1,O(i,!1))}catch(t){L.call({_w:i,_d:!1},t)}}};z||(x=function(t){f(this,x,y,"_h"),d(t),n.call(this);try{t(l(D,this,1),l(L,this,1))}catch(t){L.call(this,t)}},n=function(t){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1},n.prototype=i(55)(x.prototype,{then:function(t,e){var i=k(m(this,x));return i.ok="function"!=typeof t||t,i.fail="function"==typeof e&&e,i.domain=w?_.domain:void 0,this._c.push(i),this._a&&this._a.push(i),this._s&&O(this,!1),i.promise},catch:function(t){return this.then(void 0,t)}}),T=function(){var t=new n;this.promise=t,this.resolve=l(D,t,1),this.reject=l(L,t,1)}),u(u.G+u.W+u.F*!z,{Promise:x}),i(65)(x,y),i(56)(y),a=i(36)[y],u(u.S+u.F*!z,y,{reject:function(t){var e=k(this),i=e.reject;return i(t),e.promise}}),u(u.S+u.F*(o||!z),y,{resolve:function(t){if(t instanceof x&&S(t.constructor,this))return t;var e=k(this),i=e.resolve;return i(t),e.promise}}),u(u.S+u.F*!(z&&i(80)(function(t){x.all(t).catch(M)})),y,{all:function(t){var e=this,i=k(e),n=i.resolve,r=i.reject,a=P(function(){var i=[],a=0,o=1;p(t,!1,function(t){var s=a++,l=!1;i.push(void 0),o++,e.resolve(t).then(function(t){l||(l=!0,i[s]=t,--o||n(i))},r)}),--o||n(i)});return a&&r(a.error),i.promise},race:function(t){var e=this,i=k(e),n=i.reject,r=P(function(){p(t,!1,function(t){e.resolve(t).then(i.resolve,n)})});return r&&n(r.error),i.promise}})},function(t,e,i){var n=i(0),r=i(17),a=i(3),o=(i(4).Reflect||{}).apply,s=Function.apply;n(n.S+n.F*!i(5)(function(){o(function(){})}),"Reflect",{apply:function(t,e,i){var n=r(t),l=a(i);return o?o(n,e,l):s.call(n,e,l)}})},function(t,e,i){var n=i(0),r=i(52),a=i(17),o=i(3),s=i(6),l=i(5),c=i(157),u=(i(4).Reflect||{}).construct,h=l(function(){function t(){}return!(u(function(){},[],t)instanceof t)}),d=!l(function(){u(function(){})});n(n.S+n.F*(h||d),"Reflect",{construct:function(t,e){a(t),o(e);var i=arguments.length<3?t:a(arguments[2]);if(d&&!h)return u(t,e,i);if(t==i){switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3])}var n=[null];return n.push.apply(n,e),new(c.apply(t,n))}var l=i.prototype,f=r(s(l)?l:Object.prototype),p=Function.apply.call(t,f,e);return s(p)?p:f}})},function(t,e,i){var n=i(9),r=i(0),a=i(3),o=i(33);r(r.S+r.F*i(5)(function(){Reflect.defineProperty(n.f({},1,{value:1}),1,{value:2})}),"Reflect",{defineProperty:function(t,e,i){a(t),e=o(e,!0),a(i);try{return n.f(t,e,i),!0}catch(t){return!1}}})},function(t,e,i){var n=i(0),r=i(24).f,a=i(3);n(n.S,"Reflect",{deleteProperty:function(t,e){var i=r(a(t),e);return!(i&&!i.configurable)&&delete t[e]}})},function(t,e,i){"use strict";var n=i(0),r=i(3),a=function(t){this._t=r(t),this._i=0;var e,i=this._k=[];for(e in t)i.push(e)};i(100)(a,"Object",function(){var t,e=this,i=e._k;do if(e._i>=i.length)return{value:void 0,done:!0};while(!((t=i[e._i++])in e._t));return{value:t,done:!1}}),n(n.S,"Reflect",{enumerate:function(t){return new a(t)}})},function(t,e,i){var n=i(24),r=i(0),a=i(3);r(r.S,"Reflect",{getOwnPropertyDescriptor:function(t,e){return n.f(a(t),e)}})},function(t,e,i){var n=i(0),r=i(25),a=i(3);n(n.S,"Reflect",{getPrototypeOf:function(t){return r(a(t))}})},function(t,e,i){function n(t,e){var i,s,u=arguments.length<3?t:arguments[2];return c(t)===u?t[e]:(i=r.f(t,e))?o(i,"value")?i.value:void 0!==i.get?i.get.call(u):void 0:l(s=a(t))?n(s,e,u):void 0}var r=i(24),a=i(25),o=i(14),s=i(0),l=i(6),c=i(3);s(s.S,"Reflect",{get:n})},function(t,e,i){var n=i(0);n(n.S,"Reflect",{has:function(t,e){return e in t}})},function(t,e,i){var n=i(0),r=i(3),a=Object.isExtensible;n(n.S,"Reflect",{isExtensible:function(t){return r(t),!a||a(t)}})},function(t,e,i){var n=i(0);n(n.S,"Reflect",{ownKeys:i(171)})},function(t,e,i){var n=i(0),r=i(3),a=Object.preventExtensions;n(n.S,"Reflect",{preventExtensions:function(t){r(t);try{return a&&a(t),!0}catch(t){return!1}}})},function(t,e,i){var n=i(0),r=i(105);r&&n(n.S,"Reflect",{setPrototypeOf:function(t,e){r.check(t,e);try{return r.set(t,e),!0}catch(t){return!1}}})},function(t,e,i){function n(t,e,i){var l,d,f=arguments.length<4?t:arguments[3],p=a.f(u(t),e);if(!p){if(h(d=o(t)))return n(d,e,i,f);p=c(0)}return s(p,"value")?!(p.writable===!1||!h(f))&&(l=a.f(f,e)||c(0),l.value=i,r.f(f,e,l),!0):void 0!==p.set&&(p.set.call(f,i),!0)}var r=i(9),a=i(24),o=i(25),s=i(14),l=i(0),c=i(44),u=i(3),h=i(6);l(l.S,"Reflect",{set:n})},function(t,e,i){var n=i(4),r=i(97),a=i(9).f,o=i(53).f,s=i(79),l=i(77),c=n.RegExp,u=c,h=c.prototype,d=/a/g,f=/a/g,p=new c(d)!==d;if(i(8)&&(!p||i(5)(function(){return f[i(7)("match")]=!1,c(d)!=d||c(f)==f||"/a/i"!=c(d,"i")}))){c=function(t,e){var i=this instanceof c,n=s(t),a=void 0===e;return!i&&n&&t.constructor===c&&a?t:r(p?new u(n&&!a?t.source:t,e):u((n=t instanceof c)?t.source:t,n&&a?l.call(t):e),i?this:h,c)};for(var m=(function(t){t in c||a(c,t,{configurable:!0,get:function(){return u[t]},set:function(e){u[t]=e}})}),g=o(u),v=0;g.length>v;)m(g[v++]);h.constructor=c,c.prototype=h,i(19)(n,"RegExp",c)}i(56)("RegExp")},function(t,e,i){i(76)("match",1,function(t,e,i){return[function(i){"use strict";var n=t(this),r=void 0==i?void 0:i[e];return void 0!==r?r.call(i,n):new RegExp(i)[e](String(n))},i]})},function(t,e,i){i(76)("replace",2,function(t,e,i){return[function(n,r){"use strict";var a=t(this),o=void 0==n?void 0:n[e];return void 0!==o?o.call(n,a,r):i.call(String(a),n,r)},i]})},function(t,e,i){i(76)("search",1,function(t,e,i){return[function(i){"use strict";var n=t(this),r=void 0==i?void 0:i[e];return void 0!==r?r.call(i,n):new RegExp(i)[e](String(n))},i]})},function(t,e,i){i(76)("split",2,function(t,e,n){"use strict";var r=i(79),a=n,o=[].push,s="split",l="length",c="lastIndex";if("c"=="abbc"[s](/(b)*/)[1]||4!="test"[s](/(?:)/,-1)[l]||2!="ab"[s](/(?:ab)*/)[l]||4!="."[s](/(.?)(.?)/)[l]||"."[s](/()()/)[l]>1||""[s](/.?/)[l]){var u=void 0===/()??/.exec("")[1];n=function(t,e){var i=String(this);if(void 0===t&&0===e)return[];if(!r(t))return a.call(i,t,e);var n,s,h,d,f,p=[],m=(t.ignoreCase?"i":"")+(t.multiline?"m":"")+(t.unicode?"u":"")+(t.sticky?"y":""),g=0,v=void 0===e?4294967295:e>>>0,y=new RegExp(t.source,m+"g");for(u||(n=new RegExp("^"+y.source+"$(?!\\s)",m));(s=y.exec(i))&&(h=s.index+s[0][l],!(h>g&&(p.push(i.slice(g,s.index)),!u&&s[l]>1&&s[0].replace(n,function(){for(f=1;f<arguments[l]-2;f++)void 0===arguments[f]&&(s[f]=void 0)}),s[l]>1&&s.index<i[l]&&o.apply(p,s.slice(1)),d=s[0][l],g=h,p[l]>=v)));)y[c]===s.index&&y[c]++;return g===i[l]?!d&&y.test("")||p.push(""):p.push(i.slice(g)),p[l]>v?p.slice(0,v):p}}else"0"[s](void 0,0)[l]&&(n=function(t,e){return void 0===t&&0===e?[]:a.call(this,t,e)});return[function(i,r){var a=t(this),o=void 0==i?void 0:i[e];return void 0!==o?o.call(i,a,r):n.call(String(a),i,r)},n]})},function(t,e,i){"use strict";i(178);var n=i(3),r=i(77),a=i(8),o="toString",s=/./[o],l=function(t){i(19)(RegExp.prototype,o,t,!0)};i(5)(function(){return"/a/b"!=s.call({source:"a",flags:"b"})})?l(function(){var t=n(this);return"/".concat(t.source,"/","flags"in t?t.flags:!a&&t instanceof RegExp?r.call(t):void 0)}):s.name!=o&&l(function(){return s.call(this)})},function(t,e,i){"use strict";i(20)("anchor",function(t){return function(e){return t(this,"a","name",e)}})},function(t,e,i){"use strict";i(20)("big",function(t){return function(){return t(this,"big","","")}})},function(t,e,i){"use strict";i(20)("blink",function(t){return function(){return t(this,"blink","","")}})},function(t,e,i){"use strict";i(20)("bold",function(t){return function(){return t(this,"b","","")}})},function(t,e,i){"use strict";var n=i(0),r=i(108)(!1);n(n.P,"String",{codePointAt:function(t){return r(this,t)}})},function(t,e,i){"use strict";var n=i(0),r=i(12),a=i(109),o="endsWith",s=""[o];n(n.P+n.F*i(95)(o),"String",{endsWith:function(t){var e=a(this,t,o),i=arguments.length>1?arguments[1]:void 0,n=r(e.length),l=void 0===i?n:Math.min(r(i),n),c=String(t);return s?s.call(e,c,l):e.slice(l-c.length,l)===c}})},function(t,e,i){"use strict";i(20)("fixed",function(t){return function(){return t(this,"tt","","")}})},function(t,e,i){"use strict";i(20)("fontcolor",function(t){return function(e){return t(this,"font","color",e)}})},function(t,e,i){"use strict";i(20)("fontsize",function(t){return function(e){return t(this,"font","size",e)}})},function(t,e,i){var n=i(0),r=i(57),a=String.fromCharCode,o=String.fromCodePoint;n(n.S+n.F*(!!o&&1!=o.length),"String",{fromCodePoint:function(t){for(var e,i=[],n=arguments.length,o=0;n>o;){if(e=+arguments[o++],r(e,1114111)!==e)throw RangeError(e+" is not a valid code point");i.push(e<65536?a(e):a(((e-=65536)>>10)+55296,e%1024+56320))}return i.join("")}})},function(t,e,i){"use strict";var n=i(0),r=i(109),a="includes";n(n.P+n.F*i(95)(a),"String",{includes:function(t){return!!~r(this,t,a).indexOf(t,arguments.length>1?arguments[1]:void 0)}})},function(t,e,i){"use strict";i(20)("italics",function(t){return function(){return t(this,"i","","")}})},function(t,e,i){"use strict";var n=i(108)(!0);i(101)(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,e=this._t,i=this._i;return i>=e.length?{value:void 0,done:!0}:(t=n(e,i),this._i+=t.length,{value:t,done:!1})})},function(t,e,i){"use strict";i(20)("link",function(t){return function(e){return t(this,"a","href",e)}})},function(t,e,i){var n=i(0),r=i(21),a=i(12);n(n.S,"String",{raw:function(t){for(var e=r(t.raw),i=a(e.length),n=arguments.length,o=[],s=0;i>s;)o.push(String(e[s++])),s<n&&o.push(String(arguments[s]));return o.join("")}})},function(t,e,i){var n=i(0);n(n.P,"String",{repeat:i(110)})},function(t,e,i){"use strict";i(20)("small",function(t){return function(){return t(this,"small","","")}})},function(t,e,i){"use strict";var n=i(0),r=i(12),a=i(109),o="startsWith",s=""[o];n(n.P+n.F*i(95)(o),"String",{startsWith:function(t){var e=a(this,t,o),i=r(Math.min(arguments.length>1?arguments[1]:void 0,e.length)),n=String(t);return s?s.call(e,n,i):e.slice(i,i+n.length)===n}})},function(t,e,i){"use strict";i(20)("strike",function(t){return function(){return t(this,"strike","","")}})},function(t,e,i){"use strict";i(20)("sub",function(t){return function(){return t(this,"sub","","")}})},function(t,e,i){"use strict";i(20)("sup",function(t){return function(){return t(this,"sup","","")}})},function(t,e,i){"use strict";i(66)("trim",function(t){return function(){return t(this,3)}})},function(t,e,i){"use strict";var n=i(4),r=i(14),a=i(8),o=i(0),s=i(19),l=i(43).KEY,c=i(5),u=i(83),h=i(65),d=i(58),f=i(7),p=i(176),m=i(114),g=i(239),v=i(238),y=i(99),b=i(3),_=i(21),x=i(33),w=i(44),M=i(52),z=i(168),S=i(24),E=i(9),k=i(54),T=S.f,P=E.f,O=z.f,A=n.Symbol,I=n.JSON,C=I&&I.stringify,L="prototype",D=f("_hidden"),R=f("toPrimitive"),B={}.propertyIsEnumerable,j=u("symbol-registry"),F=u("symbols"),N=u("op-symbols"),q=Object[L],V="function"==typeof A,U=n.QObject,H=!U||!U[L]||!U[L].findChild,X=a&&c(function(){return 7!=M(P({},"a",{get:function(){return P(this,"a",{value:7}).a}})).a})?function(t,e,i){var n=T(q,e);n&&delete q[e],P(t,e,i),n&&t!==q&&P(q,e,n)}:P,Y=function(t){var e=F[t]=M(A[L]);return e._k=t,e},W=V&&"symbol"==typeof A.iterator?function(t){return"symbol"==typeof t}:function(t){return t instanceof A},G=function(t,e,i){return t===q&&G(N,e,i),b(t),e=x(e,!0),b(i),r(F,e)?(i.enumerable?(r(t,D)&&t[D][e]&&(t[D][e]=!1),i=M(i,{enumerable:w(0,!1)})):(r(t,D)||P(t,D,w(1,{})),t[D][e]=!0),X(t,e,i)):P(t,e,i)},K=function(t,e){b(t);for(var i,n=v(e=_(e)),r=0,a=n.length;a>r;)G(t,i=n[r++],e[i]);return t},Z=function(t,e){return void 0===e?M(t):K(M(t),e)},Q=function(t){var e=B.call(this,t=x(t,!0));return!(this===q&&r(F,t)&&!r(N,t))&&(!(e||!r(this,t)||!r(F,t)||r(this,D)&&this[D][t])||e)},J=function(t,e){if(t=_(t),e=x(e,!0),t!==q||!r(F,e)||r(N,e)){var i=T(t,e);return!i||!r(F,e)||r(t,D)&&t[D][e]||(i.enumerable=!0),i}},$=function(t){for(var e,i=O(_(t)),n=[],a=0;i.length>a;)r(F,e=i[a++])||e==D||e==l||n.push(e);return n},tt=function(t){for(var e,i=t===q,n=O(i?N:_(t)),a=[],o=0;n.length>o;)!r(F,e=n[o++])||i&&!r(q,e)||a.push(F[e]);return a};V||(A=function(){if(this instanceof A)throw TypeError("Symbol is not a constructor!");var t=d(arguments.length>0?arguments[0]:void 0),e=function(i){this===q&&e.call(N,i),r(this,D)&&r(this[D],t)&&(this[D][t]=!1),X(this,t,w(1,i))};return a&&H&&X(q,t,{configurable:!0,set:e}),Y(t)},s(A[L],"toString",function(){return this._k}),S.f=J,E.f=G,i(53).f=z.f=$,i(70).f=Q,i(82).f=tt,a&&!i(51)&&s(q,"propertyIsEnumerable",Q,!0),p.f=function(t){return Y(f(t))}),o(o.G+o.W+o.F*!V,{Symbol:A});for(var et="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),it=0;et.length>it;)f(et[it++]);for(var et=k(f.store),it=0;et.length>it;)m(et[it++]);o(o.S+o.F*!V,"Symbol",{for:function(t){return r(j,t+="")?j[t]:j[t]=A(t)},keyFor:function(t){if(W(t))return g(j,t);throw TypeError(t+" is not a symbol!")},useSetter:function(){H=!0},useSimple:function(){H=!1}}),o(o.S+o.F*!V,"Object",{create:Z,defineProperty:G,defineProperties:K,getOwnPropertyDescriptor:J,getOwnPropertyNames:$,getOwnPropertySymbols:tt}),I&&o(o.S+o.F*(!V||c(function(){var t=A();return"[null]"!=C([t])||"{}"!=C({a:t})||"{}"!=C(Object(t))})),"JSON",{stringify:function(t){if(void 0!==t&&!W(t)){for(var e,i,n=[t],r=1;arguments.length>r;)n.push(arguments[r++]);return e=n[1],"function"==typeof e&&(i=e),!i&&y(e)||(e=function(t,e){if(i&&(e=i.call(this,t,e)),!W(e))return e}),n[1]=e,C.apply(I,n)}}}),A[L][R]||i(18)(A[L],R,A[L].valueOf),h(A,"Symbol"),h(Math,"Math",!0),h(n.JSON,"JSON",!0)},function(t,e,i){"use strict";var n=i(0),r=i(84),a=i(113),o=i(3),s=i(57),l=i(12),c=i(6),u=i(4).ArrayBuffer,h=i(107),d=a.ArrayBuffer,f=a.DataView,p=r.ABV&&u.isView,m=d.prototype.slice,g=r.VIEW,v="ArrayBuffer";n(n.G+n.W+n.F*(u!==d),{ArrayBuffer:d}),n(n.S+n.F*!r.CONSTR,v,{isView:function(t){return p&&p(t)||c(t)&&g in t}}),n(n.P+n.U+n.F*i(5)(function(){return!new d(2).slice(1,void 0).byteLength}),v,{slice:function(t,e){if(void 0!==m&&void 0===e)return m.call(o(this),t);for(var i=o(this).byteLength,n=s(t,i),r=s(void 0===e?i:e,i),a=new(h(this,d))(l(r-n)),c=new f(this),u=new f(a),p=0;n<r;)u.setUint8(p++,c.getUint8(n++));return a}}),i(56)(v)},function(t,e,i){var n=i(0);n(n.G+n.W+n.F*!i(84).ABV,{DataView:i(113).DataView})},function(t,e,i){i(39)("Float32",4,function(t){return function(e,i,n){return t(this,e,i,n)}})},function(t,e,i){i(39)("Float64",8,function(t){return function(e,i,n){return t(this,e,i,n)}})},function(t,e,i){i(39)("Int16",2,function(t){return function(e,i,n){return t(this,e,i,n)}})},function(t,e,i){i(39)("Int32",4,function(t){return function(e,i,n){return t(this,e,i,n)}})},function(t,e,i){i(39)("Int8",1,function(t){return function(e,i,n){return t(this,e,i,n)}})},function(t,e,i){i(39)("Uint16",2,function(t){return function(e,i,n){return t(this,e,i,n)}})},function(t,e,i){i(39)("Uint32",4,function(t){return function(e,i,n){return t(this,e,i,n)}})},function(t,e,i){i(39)("Uint8",1,function(t){return function(e,i,n){return t(this,e,i,n)}})},function(t,e,i){i(39)("Uint8",1,function(t){return function(e,i,n){return t(this,e,i,n)}},!0)},function(t,e,i){"use strict";var n=i(160);i(75)("WeakSet",function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},{add:function(t){return n.def(this,t,!0)}},n,!1,!0)},function(t,e,i){"use strict";var n=i(0),r=i(74)(!0);n(n.P,"Array",{includes:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0)}}),i(62)("includes")},function(t,e,i){var n=i(0),r=i(104)(),a=i(4).process,o="process"==i(28)(a);n(n.G,{asap:function(t){var e=o&&a.domain;r(e?e.bind(t):t)}})},function(t,e,i){var n=i(0),r=i(28);n(n.S,"Error",{isError:function(t){return"Error"===r(t)}})},function(t,e,i){var n=i(0);n(n.P+n.R,"Map",{toJSON:i(159)("Map")})},function(t,e,i){var n=i(0);n(n.S,"Math",{iaddh:function(t,e,i,n){var r=t>>>0,a=e>>>0,o=i>>>0;return a+(n>>>0)+((r&o|(r|o)&~(r+o>>>0))>>>31)|0}})},function(t,e,i){var n=i(0);n(n.S,"Math",{imulh:function(t,e){var i=65535,n=+t,r=+e,a=n&i,o=r&i,s=n>>16,l=r>>16,c=(s*o>>>0)+(a*o>>>16);return s*l+(c>>16)+((a*l>>>0)+(c&i)>>16)}})},function(t,e,i){var n=i(0);n(n.S,"Math",{isubh:function(t,e,i,n){var r=t>>>0,a=e>>>0,o=i>>>0;return a-(n>>>0)-((~r&o|~(r^o)&r-o>>>0)>>>31)|0}})},function(t,e,i){var n=i(0);n(n.S,"Math",{umulh:function(t,e){var i=65535,n=+t,r=+e,a=n&i,o=r&i,s=n>>>16,l=r>>>16,c=(s*o>>>0)+(a*o>>>16);return s*l+(c>>>16)+((a*l>>>0)+(c&i)>>>16)}})},function(t,e,i){"use strict";var n=i(0),r=i(13),a=i(17),o=i(9);i(8)&&n(n.P+i(81),"Object",{__defineGetter__:function(t,e){o.f(r(this),t,{get:a(e),enumerable:!0,configurable:!0})}})},function(t,e,i){"use strict";var n=i(0),r=i(13),a=i(17),o=i(9);i(8)&&n(n.P+i(81),"Object",{__defineSetter__:function(t,e){o.f(r(this),t,{set:a(e),enumerable:!0,configurable:!0})}})},function(t,e,i){var n=i(0),r=i(170)(!0);n(n.S,"Object",{entries:function(t){return r(t)}})},function(t,e,i){var n=i(0),r=i(171),a=i(21),o=i(24),s=i(92);n(n.S,"Object",{getOwnPropertyDescriptors:function(t){for(var e,i=a(t),n=o.f,l=r(i),c={},u=0;l.length>u;)s(c,e=l[u++],n(i,e));return c}})},function(t,e,i){"use strict";var n=i(0),r=i(13),a=i(33),o=i(25),s=i(24).f;i(8)&&n(n.P+i(81),"Object",{__lookupGetter__:function(t){var e,i=r(this),n=a(t,!0);do if(e=s(i,n))return e.get;while(i=o(i))}})},function(t,e,i){"use strict";var n=i(0),r=i(13),a=i(33),o=i(25),s=i(24).f;i(8)&&n(n.P+i(81),"Object",{__lookupSetter__:function(t){var e,i=r(this),n=a(t,!0);do if(e=s(i,n))return e.set;while(i=o(i))}})},function(t,e,i){var n=i(0),r=i(170)(!1);n(n.S,"Object",{values:function(t){return r(t)}})},function(t,e,i){"use strict";var n=i(0),r=i(4),a=i(36),o=i(104)(),s=i(7)("observable"),l=i(17),c=i(3),u=i(50),h=i(55),d=i(18),f=i(63),p=f.RETURN,m=function(t){return null==t?void 0:l(t)},g=function(t){var e=t._c;e&&(t._c=void 0,e())},v=function(t){return void 0===t._o},y=function(t){v(t)||(t._o=void 0,g(t))},b=function(t,e){c(t),this._c=void 0,this._o=t,t=new _(this);try{var i=e(t),n=i;null!=i&&("function"==typeof i.unsubscribe?i=function(){n.unsubscribe()}:l(i),this._c=i)}catch(e){return void t.error(e)}v(this)&&g(this)};b.prototype=h({},{unsubscribe:function(){y(this)}});var _=function(t){this._s=t};_.prototype=h({},{next:function(t){var e=this._s;if(!v(e)){var i=e._o;try{var n=m(i.next);if(n)return n.call(i,t)}catch(t){try{y(e)}finally{throw t}}}},error:function(t){var e=this._s;if(v(e))throw t;var i=e._o;e._o=void 0;try{var n=m(i.error);if(!n)throw t;t=n.call(i,t)}catch(t){try{g(e)}finally{throw t}}return g(e),t},complete:function(t){var e=this._s;if(!v(e)){var i=e._o;e._o=void 0;try{var n=m(i.complete);t=n?n.call(i,t):void 0}catch(t){try{g(e)}finally{throw t}}return g(e),t}}});var x=function(t){u(this,x,"Observable","_f")._f=l(t)};h(x.prototype,{subscribe:function(t){return new b(t,this._f)},forEach:function(t){var e=this;return new(a.Promise||r.Promise)(function(i,n){l(t);var r=e.subscribe({next:function(e){try{return t(e)}catch(t){n(t),r.unsubscribe()}},error:n,complete:i})})}}),h(x,{from:function(t){var e="function"==typeof this?this:x,i=m(c(t)[s]);if(i){var n=c(i.call(t));return n.constructor===e?n:new e(function(t){return n.subscribe(t)})}return new e(function(e){var i=!1;return o(function(){if(!i){try{if(f(t,!1,function(t){if(e.next(t),i)return p})===p)return}catch(t){if(i)throw t;return void e.error(t)}e.complete()}}),function(){i=!0}})},of:function(){for(var t=0,e=arguments.length,i=Array(e);t<e;)i[t]=arguments[t++];return new("function"==typeof this?this:x)(function(t){var e=!1;return o(function(){if(!e){for(var n=0;n<i.length;++n)if(t.next(i[n]),e)return;t.complete()}}),function(){e=!0}})}}),d(x.prototype,s,function(){return this}),n(n.G,{Observable:x}),i(56)("Observable")},function(t,e,i){var n=i(38),r=i(3),a=n.key,o=n.set;n.exp({defineMetadata:function(t,e,i,n){o(t,e,r(i),a(n))}})},function(t,e,i){var n=i(38),r=i(3),a=n.key,o=n.map,s=n.store;n.exp({deleteMetadata:function(t,e){var i=arguments.length<3?void 0:a(arguments[2]),n=o(r(e),i,!1);if(void 0===n||!n.delete(t))return!1;if(n.size)return!0;var l=s.get(e);return l.delete(i),!!l.size||s.delete(e)}})},function(t,e,i){var n=i(179),r=i(155),a=i(38),o=i(3),s=i(25),l=a.keys,c=a.key,u=function(t,e){var i=l(t,e),a=s(t);if(null===a)return i;var o=u(a,e);return o.length?i.length?r(new n(i.concat(o))):o:i};a.exp({getMetadataKeys:function(t){return u(o(t),arguments.length<2?void 0:c(arguments[1]))}})},function(t,e,i){var n=i(38),r=i(3),a=i(25),o=n.has,s=n.get,l=n.key,c=function(t,e,i){var n=o(t,e,i);if(n)return s(t,e,i);var r=a(e);return null!==r?c(t,r,i):void 0};n.exp({getMetadata:function(t,e){return c(t,r(e),arguments.length<3?void 0:l(arguments[2]))}})},function(t,e,i){var n=i(38),r=i(3),a=n.keys,o=n.key;n.exp({getOwnMetadataKeys:function(t){return a(r(t),arguments.length<2?void 0:o(arguments[1]))}})},function(t,e,i){var n=i(38),r=i(3),a=n.get,o=n.key;n.exp({getOwnMetadata:function(t,e){return a(t,r(e),arguments.length<3?void 0:o(arguments[2]))}})},function(t,e,i){var n=i(38),r=i(3),a=i(25),o=n.has,s=n.key,l=function(t,e,i){var n=o(t,e,i);if(n)return!0;var r=a(e);return null!==r&&l(t,r,i)};n.exp({hasMetadata:function(t,e){return l(t,r(e),arguments.length<3?void 0:s(arguments[2]))}})},function(t,e,i){var n=i(38),r=i(3),a=n.has,o=n.key;n.exp({hasOwnMetadata:function(t,e){return a(t,r(e),arguments.length<3?void 0:o(arguments[2]))}})},function(t,e,i){var n=i(38),r=i(3),a=i(17),o=n.key,s=n.set;n.exp({metadata:function(t,e){return function(i,n){s(t,e,(void 0!==n?r:a)(i),o(n))}}})},function(t,e,i){var n=i(0);n(n.P+n.R,"Set",{toJSON:i(159)("Set")})},function(t,e,i){"use strict";var n=i(0),r=i(108)(!0);n(n.P,"String",{at:function(t){return r(this,t)}})},function(t,e,i){"use strict";var n=i(0),r=i(29),a=i(12),o=i(79),s=i(77),l=RegExp.prototype,c=function(t,e){this._r=t,this._s=e};i(100)(c,"RegExp String",function(){var t=this._r.exec(this._s);return{value:t,done:null===t}}),n(n.P,"String",{matchAll:function(t){if(r(this),!o(t))throw TypeError(t+" is not a regexp!");var e=String(this),i="flags"in l?String(t.flags):s.call(t),n=new RegExp(t.source,~i.indexOf("g")?i:"g"+i);return n.lastIndex=a(t.lastIndex),new c(n,e)}})},function(t,e,i){"use strict";var n=i(0),r=i(175);n(n.P,"String",{padEnd:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0,!1)}})},function(t,e,i){"use strict";var n=i(0),r=i(175);n(n.P,"String",{
padStart:function(t){return r(this,t,arguments.length>1?arguments[1]:void 0,!0)}})},function(t,e,i){"use strict";i(66)("trimLeft",function(t){return function(){return t(this,1)}},"trimStart")},function(t,e,i){"use strict";i(66)("trimRight",function(t){return function(){return t(this,2)}},"trimEnd")},function(t,e,i){i(114)("asyncIterator")},function(t,e,i){i(114)("observable")},function(t,e,i){var n=i(0);n(n.S,"System",{global:i(4)})},function(t,e,i){for(var n=i(116),r=i(19),a=i(4),o=i(18),s=i(64),l=i(7),c=l("iterator"),u=l("toStringTag"),h=s.Array,d=["NodeList","DOMTokenList","MediaList","StyleSheetList","CSSRuleList"],f=0;f<5;f++){var p,m=d[f],g=a[m],v=g&&g.prototype;if(v){v[c]||o(v,c,h),v[u]||o(v,u,m),s[m]=h;for(p in n)v[p]||r(v,p,n[p],!0)}}},function(t,e,i){var n=i(0),r=i(112);n(n.G+n.B,{setImmediate:r.set,clearImmediate:r.clear})},function(t,e,i){var n=i(4),r=i(0),a=i(78),o=i(240),s=n.navigator,l=!!s&&/MSIE .\./.test(s.userAgent),c=function(t){return l?function(e,i){return t(a(o,[].slice.call(arguments,2),"function"==typeof e?e:Function(e)),i)}:t};r(r.G+r.B+r.F*l,{setTimeout:c(n.setTimeout),setInterval:c(n.setInterval)})},function(t,e,i){i(363),i(302),i(304),i(303),i(306),i(308),i(313),i(307),i(305),i(315),i(314),i(310),i(311),i(309),i(301),i(312),i(316),i(317),i(269),i(271),i(270),i(319),i(318),i(289),i(299),i(300),i(290),i(291),i(292),i(293),i(294),i(295),i(296),i(297),i(298),i(272),i(273),i(274),i(275),i(276),i(277),i(278),i(279),i(280),i(281),i(282),i(283),i(284),i(285),i(286),i(287),i(288),i(350),i(355),i(362),i(353),i(345),i(346),i(351),i(356),i(358),i(341),i(342),i(343),i(344),i(347),i(348),i(349),i(352),i(354),i(357),i(359),i(360),i(361),i(264),i(266),i(265),i(268),i(267),i(253),i(251),i(257),i(254),i(260),i(262),i(250),i(256),i(247),i(261),i(245),i(259),i(258),i(252),i(255),i(244),i(246),i(249),i(248),i(263),i(116),i(335),i(340),i(178),i(336),i(337),i(338),i(339),i(320),i(177),i(179),i(180),i(375),i(364),i(365),i(370),i(373),i(374),i(368),i(371),i(369),i(372),i(366),i(367),i(321),i(322),i(323),i(324),i(325),i(328),i(326),i(327),i(329),i(330),i(331),i(332),i(334),i(333),i(376),i(402),i(405),i(404),i(406),i(407),i(403),i(408),i(409),i(387),i(390),i(386),i(384),i(385),i(388),i(389),i(379),i(401),i(410),i(378),i(380),i(382),i(381),i(383),i(392),i(393),i(395),i(394),i(397),i(396),i(398),i(399),i(400),i(377),i(391),i(413),i(412),i(411),t.exports=i(36)},,,,,,,,,,,,,,,,,,,,function(t,e,i){var n,r;!function(a,o){if(null===a)throw new Error("Google-maps package can be used only in browser");n=o,r="function"==typeof n?n.call(e,i,e,t):n,!(void 0!==r&&(t.exports=r))}("undefined"!=typeof window?window:null,function(){"use strict";var t="3.18",e=null,i=null,n=!1,r=[],a=[],o=null,s={};s.URL="https://maps.googleapis.com/maps/api/js",s.KEY=null,s.LIBRARIES=[],s.CLIENT=null,s.CHANNEL=null,s.LANGUAGE=null,s.REGION=null,s.VERSION=t,s.WINDOW_CALLBACK_NAME="__google_maps_api_provider_initializator__",s._googleMockApiObject={},s.load=function(t){null===i?n===!0?t&&r.push(t):(n=!0,window[s.WINDOW_CALLBACK_NAME]=function(){l(t)},s.createLoader()):t&&t(i)},s.createLoader=function(){e=document.createElement("script"),e.type="text/javascript",e.src=s.createUrl(),document.body.appendChild(e)},s.isLoaded=function(){return null!==i},s.createUrl=function(){var t=s.URL;return t+="?callback="+s.WINDOW_CALLBACK_NAME,s.KEY&&(t+="&key="+s.KEY),s.LIBRARIES.length>0&&(t+="&libraries="+s.LIBRARIES.join(",")),s.CLIENT&&(t+="&client="+s.CLIENT+"&v="+s.VERSION),s.CHANNEL&&(t+="&channel="+s.CHANNEL),s.LANGUAGE&&(t+="&language="+s.LANGUAGE),s.REGION&&(t+="&region="+s.REGION),t},s.release=function(l){var c=function(){s.KEY=null,s.LIBRARIES=[],s.CLIENT=null,s.CHANNEL=null,s.LANGUAGE=null,s.REGION=null,s.VERSION=t,i=null,n=!1,r=[],a=[],"undefined"!=typeof window.google&&delete window.google,"undefined"!=typeof window[s.WINDOW_CALLBACK_NAME]&&delete window[s.WINDOW_CALLBACK_NAME],null!==o&&(s.createLoader=o,o=null),null!==e&&(e.parentElement.removeChild(e),e=null),l&&l()};n?s.load(function(){c()}):c()},s.onLoad=function(t){a.push(t)},s.makeMock=function(){o=s.createLoader,s.createLoader=function(){window.google=s._googleMockApiObject,window[s.WINDOW_CALLBACK_NAME]()}};var l=function(t){var e;for(n=!1,null===i&&(i=window.google),e=0;e<a.length;e++)a[e](i);for(t&&t(i),e=0;e<r.length;e++)r[e](i);r=[]};return s})},function(t,e){t.exports='<div class="vzb-bs-holder">\n\t<svg class="vzb-bs-svg">\n\t\t<g class="vzb-bs-slider-wrap">\n\t\t\t<g class="vzb-bs-slider">\n\t\t\t</g>\n\t\t</g>\n\t</svg>\n</div>\n'},function(t,e){t.exports='<div class=\'vzb-dialog-modal\'>\n  <div class="vzb-dialog-title"> \n      <%=t ("buttons/about") %>\n  </div>\n      \n  <div class="vzb-dialog-content">\n      <p class="vzb-about-text0"></p>\n      <p class="vzb-about-text1"></p>\n      <br/>\n      <p class="vzb-about-version"></p>\n      <p class="vzb-about-updated"></p>\n      <br/>\n      <p class="vzb-about-text2"></p>\n      <br/>\n      <p class="vzb-about-report"></p>\n      <br/>\n      <p class="vzb-about-credits"></p>\n  </div>\n      \n  <div class="vzb-dialog-buttons">\n    <div data-click="closeDialog" class="vzb-dialog-button vzb-label-primary">\n      <%=t ("buttons/ok") %>\n    </div>\n  </div>\n      \n\n</div>\n'},function(t,e){t.exports='<div class=\'vzb-dialog-modal\'>\n    <span class="thumb-tack-class thumb-tack-class-ico-pin fa" data-dialogtype="axes" data-click="pinDialog"></span>\n    <span class="thumb-tack-class thumb-tack-class-ico-drag fa" data-dialogtype="axes" data-click="dragDialog"></span>\n    <div class="vzb-dialog-title"><%=t ("buttons/axes") %></div>\n    <div class="vzb-dialog-content">\n      <p class="vzb-dialog-sublabel"> <%=t ("buttons/axis_x") %> <span class="vzb-xaxis-selector"></span> </p>\n      <div class="vzb-xaxis-minmax vzb-dialog-paragraph"></div>\n      <p class="vzb-dialog-sublabel"> <%=t ("buttons/axis_y") %> <span class="vzb-yaxis-selector"></span> </p>\n      <div class="vzb-yaxis-minmax vzb-dialog-paragraph"></div>\n    </div>\n    <div class="vzb-dialog-buttons">\n      <div data-click="closeDialog" class="vzb-dialog-button vzb-label-primary"><%=t ( "buttons/ok") %></div>\n    </div>\n</div>'},function(t,e){t.exports='<div class=\'vzb-dialog-modal\'>\n    <span class="thumb-tack-class thumb-tack-class-ico-pin fa" data-dialogtype="axesmc" data-click="pinDialog"></span>\n    <span class="thumb-tack-class thumb-tack-class-ico-drag fa" data-dialogtype="axesmc" data-click="dragDialog"></span>\n    <div class="vzb-dialog-title">\n        <%=t ("buttons/axes") %>\n    </div>\n    <div class="vzb-dialog-content">\n        <div class="vzb-yaxis-container">\n            <p class="vzb-dialog-sublabel"><%=t ("hints/mount/maxYvalue") %></p>\n            <form class="vzb-dialog-paragraph">\n                <label><input type="radio" name="ymax" value="immediate"><%=t ("mount/maxYmode/immediate") %></label>\n                <label><input type="radio" name="ymax" value="latest"><%=t ("mount/maxYmode/latest") %></label>\n            </form>\n        </div>\n        <div class="vzb-xaxis-container">\n            <p class="vzb-dialog-sublabel">\n                <%=t ("hints/mount/logXstops") %>\n            </p>\n            <form class="vzb-dialog-paragraph">\n                <input type="checkbox" name="logstops" value="1">1\n                <input type="checkbox" name="logstops" value="2">2\n                <input type="checkbox" name="logstops" value="5">5\n            </form>\n        </div>\n        <p class="vzb-dialog-sublabel">\n            <%=t ("hints/mount/xlimits") %>\n        </p>\n        <div class="vzb-xlimits-container vzb-dialog-paragraph"></div>\n        <div class="vzb-probe-container">\n            <p class="vzb-dialog-sublabel">\n              <input type="checkbox" name="probe" class="vzb-probe-check"> <%=t ("hints/mount/probe") %>\n            </p>\n            <input type="text" class="vzb-probe-field" name="probe">\n        </div>\n    </div>\n    <div class="vzb-dialog-buttons">\n        <div data-click="closeDialog" class="vzb-dialog-button vzb-label-primary">\n            <%=t ("buttons/ok") %>\n        </div>\n    </div>\n</div>'},function(t,e){t.exports='<div class=\'vzb-dialog-modal\'>\n  <span class="thumb-tack-class thumb-tack-class-ico-pin fa" data-dialogtype="colors" data-click="pinDialog"></span>\n  <span class="thumb-tack-class thumb-tack-class-ico-drag fa" data-dialogtype="colors" data-click="dragDialog"></span>\n  \n  <div class="vzb-dialog-title">\n      <%=t ("buttons/colors") %>\n      <span class="vzb-caxis-selector"></span>\n  </div>\n  \n  \n  \n  <div class="vzb-dialog-content vzb-dialog-scrollable">\n    <div class="vzb-clegend-container"></div>\n  </div>\n\n  <div class="vzb-dialog-buttons">\n    <div data-click="closeDialog" class="vzb-dialog-button vzb-label-primary">\n      <%=t ("buttons/ok") %>\n    </div>\n  </div>\n\n</div>\n'},function(t,e){t.exports='<div class=\'vzb-dialog-modal\'>\n  <span class="thumb-tack-class thumb-tack-class-ico-pin fa" data-dialogtype="find" data-click="pinDialog"></span>\n  <span class="thumb-tack-class thumb-tack-class-ico-drag fa" data-dialogtype="find" data-click="dragDialog"></span>\n  <div class="vzb-dialog-title">\n    <%=t ("dialogs/find") %>\n    <span class="vzb-dialog-content vzb-find-filter">\n      <input class="vzb-find-search" type="search"/>\n    </span>\n  </div>\n  \n  <div class="vzb-dialog-content vzb-dialog-content-fixed vzb-dialog-scrollable">\n    <div class="vzb-find-list">\n      <!-- list will be placed here -->\n    </div>\n  </div>\n\n  <div class="vzb-dialog-buttons">\n    <div class="vzb-dialog-bubbleopacity vzb-dialog-control"></div>\n    <div class="vzb-dialog-button vzb-find-deselect">\n      <%=t ("buttons/deselect") %>\n    </div>\n\n    <div data-click="closeDialog" class="vzb-dialog-button vzb-label-primary">\n      <%=t ("buttons/ok") %>\n    </div>\n  </div>\n\n</div>\n'},function(t,e){t.exports='<div class=\'vzb-dialog-modal\'>\n  <span class="thumb-tack-class thumb-tack-class-ico-pin fa" data-dialogtype="label" data-click="pinDialog"></span>\n  <span class="thumb-tack-class thumb-tack-class-ico-drag fa" data-dialogtype="label" data-click="dragDialog"></span>\n  <div class="vzb-dialog-title"> \n      <%=t ("buttons/label") %>\n  </div>\n      \n      \n  <div class="vzb-dialog-content">\n    <span class="vzb-saxis-selector"></span>\n    <div class="vzb-dialog-sizeslider"></div>\n    <div class="vzb-removelabelbox-switch"></div>\n  </div>\n\n  <div class="vzb-dialog-buttons">\n    <div data-click="closeDialog" class="vzb-dialog-button vzb-label-primary">\n      <%=t ("buttons/ok") %>\n    </div>\n  </div>\n\n</div>\n'},function(t,e){t.exports='<div class=\'vzb-dialog-modal\'>\n    <span class="thumb-tack-class thumb-tack-class-ico-pin fa" data-dialogtype="mapoptions" data-click="pinDialog"></span>\n    <span class="thumb-tack-class thumb-tack-class-ico-drag fa" data-dialogtype="mapoptions" data-click="dragDialog"></span>\n    <div class="vzb-dialog-title">\n        <%=t ("buttons/mapoptions") %>\n    </div>\n    <div class="vzb-dialog-content">\n        <div class="vzb-lmap-container">\n            <p class="vzb-dialog-sublabel"><%=t ("hints/lbubblemap/mapApi") %></p>\n            <form class="vzb-dialog-paragraph map-api">\n            </form>\n        </div>\n        <div class="vzb-lmap-container">\n            <p class="vzb-dialog-sublabel">\n                <%=t ("hints/lbubblemap/mapView") %>\n            </p>\n            <form class="vzb-dialog-paragraph  map-layer">\n            </form>\n        </div>\n    </div>\n    <div class="vzb-dialog-buttons">\n        <div data-click="closeDialog" class="vzb-dialog-button vzb-label-primary">\n            <%=t ("buttons/ok") %>\n        </div>\n    </div>\n</div>'},function(t,e){t.exports='<div class=\'vzb-dialog-modal\'>\n  <span class="thumb-tack-class thumb-tack-class-ico-pin fa" data-dialogtype="moreoptions" data-click="pinDialog"></span>\n  <span class="thumb-tack-class thumb-tack-class-ico-drag fa" data-dialogtype="moreoptions" data-click="dragDialog"></span>\n\n\n  <div class="vzb-dialog-title">\n    <%=t ("buttons/more_options") %>\n  </div>\n\n  <div class="vzb-dialog-content vzb-dialog-scrollable">\n    <div class=\'vzb-dialog-options-buttonlist\'>\n    </div>\n    <div class="vzb-accordion">\n    </div>\n  </div>\n\n  <div class="vzb-dialog-buttons">\n    <div data-click="closeDialog" class="vzb-dialog-button vzb-label-primary">\n      <%=t ("buttons/ok") %>\n    </div>\n  </div>\n\n</div>'},function(t,e){t.exports='<div class=\'vzb-dialog-modal\'>\n  <div class="vzb-dialog-title"> \n      <%=t ("buttons/opacity") %>\n  </div>\n      \n  <div class="vzb-dialog-content">\n      <p class="vzb-dialog-sublabel">\n        <%=t ("buttons/opacityRegular") %>\n      </p>\n      <div class="vzb-dialog-bubbleopacity-regular"></div>\n\n      <p class="vzb-dialog-sublabel">\n        <%=t ("buttons/opacityNonselect") %>\n      </p>\n      <div class="vzb-dialog-bubbleopacity-selectdim"></div>\n    </div>\n  </div>\n\n</div>\n'},function(t,e){t.exports='<div class=\'vzb-dialog-modal\'>\n  <div class="vzb-dialog-title"> \n      <%=t ("dialogs/presentation") %>\n  </div>\n      \n  <div class="vzb-dialog-content">\n      <div class="vzb-presentationmode-switch"></div>\n  </div>\n\n</div>\n'},function(t,e){t.exports='<div class=\'vzb-dialog-modal\'>\n  <span class="thumb-tack-class thumb-tack-class-ico-pin fa" data-dialogtype="show" data-click="pinDialog"></span>\n  <span class="thumb-tack-class thumb-tack-class-ico-drag fa" data-dialogtype="show" data-click="dragDialog"></span>\n  <div class="vzb-dialog-title">\n    <%=t ("buttons/show") %>\n    <span class="vzb-dialog-content vzb-show-filter">\n      <input class="vzb-show-search" type="search"/>\n    </span>\n  </div>\n  \n  <div class="vzb-dialog-content vzb-dialog-content-fixed vzb-dialog-scrollable">\n    <p class="vzb-dialog-sublabel"> <%=t ("hints/mount/onlyshowthefollowing") %> </p>\n    <div class="vzb-show-list">\n      <!-- list will be placed here -->\n    </div>\n  </div>\n\n  <div class="vzb-dialog-buttons">\n    <div class="vzb-dialog-button vzb-show-deselect">\n      <%=t ("buttons/showall") %>\n    </div>\n\n    <div data-click="closeDialog" class="vzb-dialog-button vzb-label-primary">\n      <%=t ("buttons/ok") %>\n    </div>\n  </div>\n\n</div>\n'},function(t,e){t.exports='<div class=\'vzb-dialog-modal\'>\n  <span class="thumb-tack-class thumb-tack-class-ico-pin fa" data-dialogtype="side" data-click="pinDialog"></span>\n  <span class="thumb-tack-class thumb-tack-class-ico-drag fa" data-dialogtype="side" data-click="dragDialog"></span>\n  <div class="vzb-dialog-title">\n    <%=t ("buttons/side") %>\n    <span class="vzb-side-selector"></span>\n  </div>\n  \n  <div class="vzb-dialog-content vzb-dialog-scrollable">\n    <div class="vzb-side-list vzb-side-list-left">\n      <!-- list will be placed here -->\n    </div>\n    <div class="vzb-side-list vzb-side-list-right">\n      <!-- list will be placed here -->\n    </div>\n  </div>\n\n  <div class="vzb-dialog-buttons">\n    <div class="vzb-dialog-button vzb-label-primary vzb-side-switch-sides">\n      <%=t ("buttons/leftright") %>\n    </div>\n\n    <div data-click="closeDialog" class="vzb-dialog-button vzb-label-primary">\n      <%=t ("buttons/ok") %>\n    </div>\n  </div>\n\n</div>\n'},function(t,e){t.exports='<div class=\'vzb-dialog-modal\'>\n  <span class="thumb-tack-class thumb-tack-class-ico-pin fa" data-dialogtype="size" data-click="pinDialog"></span>\n  <span class="thumb-tack-class thumb-tack-class-ico-drag fa" data-dialogtype="size" data-click="dragDialog"></span>\n  <div class="vzb-dialog-title"> \n      <%=t ("buttons/size") %>\n      <span class="vzb-saxis-selector"></span>\n  </div>\n      \n      \n  <div class="vzb-dialog-content">\n    <div class="vzb-dialog-bubblesize"></div>\n  </div>\n\n  <div class="vzb-dialog-buttons">\n    <div data-click="closeDialog" class="vzb-dialog-button vzb-label-primary">\n      <%=t ("buttons/ok") %>\n    </div>\n  </div>\n\n</div>\n'},function(t,e){t.exports='<div class=\'vzb-dialog-modal\'>\n  <div class="vzb-dialog-title"> \n      <%=t ("buttons/speed") %>\n  </div>\n      \n  <div class="vzb-dialog-content">\n    <div class="vzb-dialog-placeholder"></div>\n  </div>\n\n</div>\n'},function(t,e){t.exports='<div class=\'vzb-dialog-modal\'>\n    <span class="thumb-tack-class thumb-tack-class-ico-pin fa" data-dialogtype="stack" data-click="pinDialog"></span>\n    <span class="thumb-tack-class thumb-tack-class-ico-drag fa" data-dialogtype="stack" data-click="dragDialog"></span>\n    <div class="vzb-dialog-title"><%=t ("buttons/stack") %></div>\n        \n    <div class="vzb-dialog-content vzb-dialog-scrollable">\n        \n        <!--p class="vzb-dialog-sublabel"> <%=t ( "hints/mount/howtostack") %></p-->\n        <form class="vzb-howtostack vzb-dialog-paragraph">\n            <label> <input type="radio" name="stack" value="none"> <%=t ("mount/stacking/none") %> </label>\n            <label> <input type="radio" name="stack" value="bycolor"> <%=t ("mount/stacking/color") %> </label>\n            <label> <input type="radio" name="stack" value="all"> <%=t ("mount/stacking/world") %> </label>\n        </form>\n        \n        <form class="vzb-howtomerge vzb-dialog-paragraph">\n            <p class="vzb-dialog-sublabel"> <%=t ("hints/mount/howtomerge") %> </p>\n            <label> <input type="radio" name="merge" value="none"> <%=t ("mount/merging/none") %> </label>\n            <label> <input type="radio" name="merge" value="grouped"> <%=t ("mount/merging/color") %> </label>\n            <label> <input type="radio" name="merge" value="stacked"> <%=t ("mount/merging/world") %> </label>\n        </form>\n        \n        <form class="vzb-manual-sorting">\n            <p class="vzb-dialog-sublabel"> <%=t ("mount/manualSorting") %> </p>\n            <div class="vzb-dialog-draggablelist vzb-dialog-control"></div>\n        </form>\n                \n    </div>\n\n    <div class="vzb-dialog-buttons">\n        <div data-click="closeDialog" class="vzb-dialog-button vzb-label-primary"><%=t ("buttons/ok") %></div>\n    </div>\n\n</div>'},function(t,e){t.exports='<div class="vzb-dialog-modal">\n  <div class="vzb-dialog-content vzb-dialog-content-fixed">\n    <svg>\n      <g class="vzb-timedisplay"></g>\n    </svg>\n  </div>\n  <div class="vzb-dialog-buttons"></div>\n</div>\n'},function(t,e){t.exports='<div class=\'vzb-dialog-modal\'>\n  <span class="thumb-tack-class thumb-tack-class-ico-pin fa" data-dialogtype="label" data-click="pinDialog"></span>\n  <span class="thumb-tack-class thumb-tack-class-ico-drag fa" data-dialogtype="label" data-click="dragDialog"></span>\n  <div class="vzb-dialog-title"> \n    <%=t ("buttons/zoom") %>\n    <div class="vzb-dialog-zoom-buttonlist"></div>\n  </div>\n      \n      \n  <div class="vzb-dialog-content">\n    <div class="vzb-panwitharrow-switch"></div>\n    <div class="vzb-zoomonscrolling-switch"></div>\n    <div class="vzb-adaptminmaxzoom-switch"></div>\n  </div>\n\n  <div class="vzb-dialog-buttons">\n    <div data-click="closeDialog" class="vzb-dialog-button vzb-label-primary">\n      <%=t ("buttons/ok") %>\n    </div>\n  </div>\n\n</div>\n'},function(t,e){t.exports='<div class="vzb-mmi-holder">\n\n    <span class="vzb-mmi-domainmin-label"></span>\n    <input type="text" class="vzb-mmi-domainmin" name="min">\n    <span class="vzb-mmi-domainmax-label"></span>\n    <input type="text" class="vzb-mmi-domainmax" name="max">\n\n    <br class="vzb-mmi-break"/>\n\n    <span class="vzb-mmi-zoomedmin-label"></span>\n    <input type="text" class="vzb-mmi-zoomedmin" name="min">\n    <span class="vzb-mmi-zoomedmax-label"></span>\n    <input type="text" class="vzb-mmi-zoomedmax" name="max">\n    \n</div>'},function(t,e){t.exports='<div class="vzb-szs-holder">\n\t<svg class="vzb-szs-svg">\n\t\t<g class="vzb-szs-slider-wrap">\n\t\t\t<g class="vzb-szs-slider">\n\t\t\t</g>\n\t\t</g>\n\t</svg>\n</div>\n'},function(t,e){t.exports='<div class="vzb-stepped-speed-slider">\n  <svg>\n    <g class="vzb-stepped-speed-slider-triangle"></g>\n    <g class="vzb-stepped-speed-slider-axis"></g>\n  </svg>\n</div>\n'},function(t,e){t.exports='<div class="vzb-timeslider vzb-ts-loading">\n  <div class="vzb-ts-slider-wrapper">\n    <svg class="vzb-ts-slider">\n      <g>\n        <g class="vzb-ts-slider-axis"></g>\n        <g class="vzb-ts-slider-progress"></g>\n        <g class="vzb-ts-slider-select"></g>\n        <circle class="vzb-ts-slider-handle"></circle>\n        <text class="vzb-ts-slider-value"></text>\n        <line class="vzb-ts-slider-slide"></line>\n      </g>\n      </svg>\n  </div>\n\n  <!-- SVG VIZABI ICONS\n       source: https://github.com/encharm/Font-Awesome-SVG-PNG/ -->\n  <div class="vzb-ts-btns">\n    <button class="vzb-ts-btn-loading vzb-ts-btn">\n      <div class=\'vzb-loader\'></div>\n    </button>\n    <button class="vzb-ts-btn-play vzb-ts-btn">\n      <svg class="vzb-icon vzb-icon-play" viewBox="3 3 42 42"\n           xmlns="http://www.w3.org/2000/svg">\n        <path xmlns="http://www.w3.org/2000/svg" d="M24 4C12.95 4 4 12.95 4 24s8.95 20 20 20 20-8.95 20-20S35.05 4 24 4zm-4 29V15l12 9-12 9z"/>\n      </svg>\n    </button>\n    <button class="vzb-ts-btn-pause vzb-ts-btn">\n      <svg class="vzb-icon vzb-icon-pause" viewBox="3 3 42 42"\n           xmlns="http://www.w3.org/2000/svg">\n        <path xmlns="http://www.w3.org/2000/svg" d="M24 4C12.95 4 4 12.95 4 24s8.95 20 20 20 20-8.95 20-20S35.05 4 24 4zm-2 28h-4V16h4v16zm8 0h-4V16h4v16z"/>\n      </svg>\n    </button>\n  </div>\n</div>\n'},function(t,e){t.exports='<!-- Bar Chart Component -->\n<svg class="vzb-agepyramid">\n  <g class="vzb-bc-header">\n    <g class="vzb-bc-axis-x-title"></g>\n    <g class="vzb-bc-axis-x-info vzb-noexport"></g>\n    <text class="vzb-bc-title"></text>\n    <text class="vzb-bc-title vzb-bc-title-right"></text>\n    <text class="vzb-bc-year"></text>\n  </g>\n  <g class="vzb-bc-graph">\n\n    <g class="vzb-bc-axis-y-title"></g>\n\n    <g class="vzb-bc-axis-y"></g>\n\n    <svg class="vzb-bc-bars-crop">\n      <g class="vzb-bc-bars"></g>\n    </svg>\n\n    <g class="vzb-bc-axis-x"></g>\n    <g class="vzb-bc-axis-x vzb-bc-axis-x-left"></g>\n\n    <svg class="vzb-bc-labels-crop">\n      <g class="vzb-bc-labels"></g>        \n    </svg>\n\n    <g class="vzb-bc-axis-labels">\n      <!-- <text class="vzb-x_label">Lifespan</text>\n            <text class="vzb-y_label">Lifespan</text> -->\n    </g>\n  </g>\n</svg>\n'},function(t,e){t.exports='<!-- Axis Labeler Component -->\n<svg class="vzb-axislabeler">\n  <g class="vzb-al-graph">\n\n    <g class="vzb-al-axis-x"></g>\n    <g class="vzb-al-axis-y"></g>\n\n  </g>\n</svg>\n'},function(t,e){t.exports='<!-- Bar Chart Component -->\n<svg class="vzb-barchart">\n  <g class="vzb-bc-graph">\n    <g class="vzb-bc-bars"></g>\n    <g class="vzb-bc-bar-labels"></g>\n\n    <g class="vzb-bc-axis-y-title"></g>\n    <text class="vzb-bc-year"></text>\n    <g class="vzb-bc-axis-x-title"></g>\n\n    <g class="vzb-bc-axis-x"></g>\n    <g class="vzb-bc-axis-y"></g>\n\n    <g class="vzb-bc-axis-labels">\n      <!-- <text class="vzb-x_label">Lifespan</text>\n            <text class="vzb-y_label">Lifespan</text> -->\n    </g>\n  </g>\n</svg>\n'},function(t,e){t.exports='<!-- Bar Chart Component -->\n<div class="vzb-barrankchart">\n  <svg class="vzb-br-header">\n    <g class="vzb-br-title">\n      <text></text>\n    </g>\n    <g class="vzb-br-total">\n      <text></text>\n    </g>\n    <g class="vzb-br-axis-info vzb-noexport"></g>\n  </svg>\n\n  <div class="vzb-br-barsviewport vzb-dialog-scrollable">\n    <svg class="vzb-br-bars-svg">\n      <g class="vzb-br-bars"></g>\n    </svg>\n  </div>\n\n  <svg class="vzb-data-warning-svg">\n    <g class="vzb-data-warning vzb-noexport">\n      <svg></svg>\n      <text></text>\n    </g>\n  </svg>\n</div>\n'},function(t,e){t.exports='<!-- Bubble Chart Component -->\n<div class="vzb-bubblechart">\n  <svg class="vzb-bubblechart-svg vzb-export">\n    <g class="vzb-bc-graph">\n      <g class="vzb-bc-year"></g>\n\n      <svg class="vzb-bc-axis-x"><g></g></svg>\n      <svg class="vzb-bc-axis-y"><g></g></svg>\n      <line class="vzb-bc-projection-x"></line>\n      <line class="vzb-bc-projection-y"></line>\n\n      <svg class="vzb-bc-bubbles-crop">\n      <g class="vzb-zoom-selection"></g>\n        <line class="vzb-bc-line-equal-xy vzb-invisible"></line>\n        <rect class="vzb-bc-eventarea"></rect>\n        <g class="vzb-bc-trails"></g>\n        <g class="vzb-bc-bubbles"></g>\n        <g class="vzb-bc-lines"></g>\n        <g class="vzb-bc-bubble-crown vzb-hidden">\n          <circle class="vzb-crown-glow"></circle>\n          <circle class="vzb-crown"></circle>\n        </g>        \n      </svg>        \n\n      <g class="vzb-bc-axis-y-title"></g>\n      <g class="vzb-bc-axis-x-title"></g>\n      <g class="vzb-bc-axis-s-title"></g>\n      <g class="vzb-bc-axis-c-title"></g>\n\n      <g class="vzb-bc-axis-y-info vzb-noexport"></g>\n      <g class="vzb-bc-axis-x-info vzb-noexport"></g>\n      \n      <svg class="vzb-bc-labels-crop">\n        <g class="vzb-bc-labels"></g>        \n      </svg>       \n\n      <g class="vzb-data-warning vzb-noexport">\n        <svg></svg>\n        <text></text>\n      </g>\n\n      <rect class="vzb-bc-zoom-rect"></rect>\n      <g class="vzb-bc-tooltip vzb-hidden">\n        <rect class="vzb-tooltip-glow"></rect>\n        <rect class="vzb-tooltip-border"></rect>\n        <text class="vzb-tooltip-text"></text>\n      </g>\n    </g>\n  </svg>\n  <svg>\n    <defs>\n      <filter id="vzb-glow-filter" x="-50%" y="-50%" width="200%" height="200%">\n        <feGaussianBlur in="SourceGraphic" stdDeviation="2"></feGaussianBlur>\n      </filter>\n    </defs>\n  </svg>\n  <!-- This could possibly be another component -->\n  <div class="vzb-tooltip vzb-hidden vzb-tooltip-mobile"></div>\n</div>\n'},function(t,e){t.exports='<!-- Bubble Map Chart Component -->\n<div class="vzb-bubblemap">\n  <svg class="vzb-bmc-map-background vzb-export">\n    <g class="vzb-bmc-map-graph"></g>\n  </svg>\n  <svg class="vzb-bubblemap-svg vzb-export">\n    <g class="vzb-bmc-graph">\n      <g class="vzb-bmc-year"></g>\n\n      <g class="vzb-bmc-lines"></g>\n      <g class="vzb-bmc-bubbles"></g>\n      <g class="vzb-bmc-bubble-labels"></g>\n\n\n      <g class="vzb-bmc-axis-y-title">\n          <text></text>\n      </g>\n        \n      <g class="vzb-bmc-axis-c-title">\n          <text></text>\n      </g>\n\n      <g class="vzb-bmc-axis-y-info vzb-noexport">\n      </g>\n\n      <g class="vzb-bmc-axis-c-info vzb-noexport">\n      </g>\n\n      <g class="vzb-data-warning vzb-noexport">\n        <svg></svg>\n        <text></text>\n      </g>\n      <g class="vzb-bmc-labels"></g>\n\n      <g class="vzb-bmc-tooltip vzb-hidden">\n        <rect class="vzb-tooltip-border"></rect>\n        <text class="vzb-tooltip-text"></text>\n      </g>\n    </g>\n  </svg>\n</div>\n'},function(t,e){t.exports='<!-- Cartogram Component -->\n<div class="vzb-cartogram">\n  \n  <svg class="vzb-cartogram-svg">\n    <g class="vzb-ct-graph">\n      <g class="vzb-ct-year"></g>\n      <svg class="vzb-ct-map-background vzb-export">\n        <g class="vzb-ct-map-graph"></g>\n      </svg>\n      <svg class="vzb-ct-labels-crop">\n        <g class="vzb-ct-labels">\n          <line class="vzb-ct-vertical-now"></line>\n        </g>\n      </svg>\n\n      <g class="vzb-ct-axis-y-title"><text></text></g>\n      <g class="vzb-ct-axis-c-title"><text></text></g>\n      <g class="vzb-ct-axis-y-info"></g>\n      <g class="vzb-ct-axis-c-info"></g>\n      <g class="vzb-ct-tooltip vzb-hidden">\n        <rect class="vzb-tooltip-border"></rect>\n        <text class="vzb-tooltip-text"></text>\n\n      </g>\n\n      <g class="vzb-data-warning vzb-noexport">\n        <svg></svg>\n        <text></text>\n      </g>\n    </g>\n  </svg>\n</div>\n'},function(t,e){t.exports='<!-- Bubble Map Chart Component -->\n<div class="vzb-bubblemap">\n  <div id="vzb-map-background"></div>\n  <svg class="vzb-bmc-map-background vzb-export"></svg>\n  <svg class="vzb-bubblemap-svg vzb-export">\n    <g class="vzb-bmc-graph">\n      <g class="vzb-bmc-year"></g>\n\n      <g class="vzb-bmc-lines"></g>\n      <g class="vzb-bmc-bubbles"></g>\n      <g class="vzb-bmc-bubble-labels"></g>\n\n\n      <g class="vzb-bmc-axis-y-title">\n          <text></text>\n      </g>\n        \n      <g class="vzb-bmc-axis-c-title">\n          <text></text>\n      </g>\n\n      <g class="vzb-bmc-axis-y-info vzb-noexport">\n      </g>\n\n      <g class="vzb-bmc-axis-c-info vzb-noexport">\n      </g>\n\n      <g class="vzb-data-warning vzb-noexport">\n        <svg></svg>\n        <text></text>\n      </g>\n      <g class="vzb-bmc-labels"></g>\n\n      <g class="vzb-bmc-tooltip vzb-hidden">\n        <rect class="vzb-tooltip-border"></rect>\n        <text class="vzb-tooltip-text"></text>\n      </g>\n    </g>\n  </svg>\n</div>\n'},function(t,e){t.exports='<!-- Line Chart Component -->\n<div class="vzb-linechart">\n  <svg class="vzb-linechart-svg">\n    <g class="vzb-lc-graph">\n\n      <svg class="vzb-lc-axis-x"><g></g></svg>\n      <svg class="vzb-lc-axis-y"><g></g></svg>\n      <text class="vzb-lc-axis-x-value"></text>\n      <text class="vzb-lc-axis-y-value"></text>\n      <svg class="vzb-lc-lines-crop">\n        <svg class="vzb-lc-lines"></svg>\n        <line class="vzb-lc-projection-x"></line>\n        <line class="vzb-lc-projection-y"></line>\n      </svg>\n      <svg class="vzb-lc-labels-crop">\n        <g class="vzb-lc-labels">\n          <line class="vzb-lc-vertical-now"></line>\n        </g>\n      </svg>\n\n      <g class="vzb-lc-axis-y-title"></g>\n      <g class="vzb-lc-axis-x-title"></g>\n      <g class="vzb-lc-axis-y-info"></g>\n\n      <g class="vzb-data-warning vzb-noexport">\n        <svg></svg>\n        <text></text>\n      </g>\n\n      \n      <!--filter id="vzb-lc-filter-dropshadow"> \n        <feOffset result="offOut" in="SourceGraphic" dx="0" dy="2" />\n        <feColorMatrix result = "matrixOut" in = "offOut" type = "matrix"\n                       values = "0.3 .0 .0 .0 .0\n                                 .0 .3 .0 .0 .0\n                                 .0 .0 .3 .0 .0\n                                 1.0 1.0 1.0 1.0 .0"/>\n        <feGaussianBlur result="blurOut" in="matrixOut" stdDeviation="0.8" />\n        <feBlend in="SourceGraphic" in2="blurOut" mode="normal" />\n      </filter-->\n\n    </g>\n  </svg>\n  <div class="vzb-tooltip vzb-hidden"></div>\n</div>\n'},function(t,e){t.exports='<!-- Mountain Chart Template -->\n<div class="vzb-mountainchart">\n  <svg class="vzb-mountainchart-svg vzb-export">\n        <g class="vzb-mc-graph">\n            <rect class="vzb-mc-eventarea"></rect>\n            <g class="vzb-mc-year"></g>\n\n            <g class="vzb-mc-mountains-mergestacked"></g>\n            <g class="vzb-mc-mountains-mergegrouped"></g>\n            <g class="vzb-mc-mountains"></g>\n            <g class="vzb-mc-mountains-labels"></g>\n\n\n            <g class="vzb-mc-axis-y-title">\n                <text></text>\n            </g>\n\n            <g class="vzb-mc-axis-x-title">\n                <text></text>\n            </g>\n\n            <g class="vzb-mc-axis-info vzb-noexport">\n            </g>\n\n            <g class="vzb-data-warning vzb-noexport">\n                <svg></svg>\n                <text></text>\n            </g>\n\n            <g class="vzb-mc-axis-x"></g>\n\n            <g class="vzb-mc-axis-labels"></g>\n            <g class="vzb-mc-probe">\n                <text class="vzb-shadow vzb-mc-probe-value-ul"></text>\n                <text class="vzb-shadow vzb-mc-probe-value-ur"></text>\n                <text class="vzb-shadow vzb-mc-probe-value-dl"></text>\n                <text class="vzb-shadow vzb-mc-probe-value-dr"></text>\n                <text class="vzb-mc-probe-value-ul"></text>\n                <text class="vzb-mc-probe-value-ur"></text>\n                <text class="vzb-mc-probe-value-dl"></text>\n                <text class="vzb-mc-probe-value-dr"></text>\n                <text class="vzb-mc-probe-extremepoverty"></text>\n                <line></line>\n            </g>\n\n            <g class="vzb-mc-tooltip vzb-hidden">\n                <rect class="vzb-tooltip-border"></rect>\n                <text class="vzb-tooltip-text"></text>\n            </g>\n        </g>\n  </svg>\n</div>\n';
},function(t,e){e.read=function(t,e,i,n,r){var a,o,s=8*r-n-1,l=(1<<s)-1,c=l>>1,u=-7,h=i?r-1:0,d=i?-1:1,f=t[e+h];for(h+=d,a=f&(1<<-u)-1,f>>=-u,u+=s;u>0;a=256*a+t[e+h],h+=d,u-=8);for(o=a&(1<<-u)-1,a>>=-u,u+=n;u>0;o=256*o+t[e+h],h+=d,u-=8);if(0===a)a=1-c;else{if(a===l)return o?NaN:(f?-1:1)*(1/0);o+=Math.pow(2,n),a-=c}return(f?-1:1)*o*Math.pow(2,a-n)},e.write=function(t,e,i,n,r,a){var o,s,l,c=8*a-r-1,u=(1<<c)-1,h=u>>1,d=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,f=n?0:a-1,p=n?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,o=u):(o=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-o))<1&&(o--,l*=2),e+=o+h>=1?d/l:d*Math.pow(2,1-h),e*l>=2&&(o++,l/=2),o+h>=u?(s=0,o=u):o+h>=1?(s=(e*l-1)*Math.pow(2,r),o+=h):(s=e*Math.pow(2,h-1)*Math.pow(2,r),o=0));r>=8;t[i+f]=255&s,f+=p,s/=256,r-=8);for(o=o<<r|s,c+=r;c>0;t[i+f]=255&o,f+=p,o/=256,c-=8);t[i+f-p]|=128*m}},function(t,e){var i={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==i.call(t)}},function(t,e,i){(function(e,i){var n,n;!function(e){t.exports=e()}(function(){var t;return function t(e,i,r){function a(s,l){if(!i[s]){if(!e[s]){var c="function"==typeof n&&n;if(!l&&c)return n(s,!0);if(o)return o(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var h=i[s]={exports:{}};e[s][0].call(h.exports,function(t){var i=e[s][1][t];return a(i?i:t)},h,h.exports,t,e,i,r)}return i[s].exports}for(var o="function"==typeof n&&n,s=0;s<r.length;s++)a(r[s]);return a}({1:[function(t,e,i){"use strict";function n(t,e){var i={};for(var n in t){var r=t[n].paintVertexArray;if(0!==r.length){var a=r.serialize(e),o=r.constructor.serialize();i[n]={array:a,type:o}}}return i}var r=t("./program_configuration"),a=function(t,e){this.vertexOffset=t,this.primitiveOffset=e,this.vertexLength=0,this.primitiveLength=0},o=function(t,e,i){var n=this;this.globalProperties={zoom:i};var a=t.layoutVertexArrayType;this.layoutVertexArray=new a;var o=t.elementArrayType;o&&(this.elementArray=new o);var s=t.elementArrayType2;s&&(this.elementArray2=new s),this.layerData={};for(var l=0,c=e;l<c.length;l+=1){var u=c[l],h=r.createDynamic(t.paintAttributes||[],u,i);n.layerData[u.id]={layer:u,programConfiguration:h,paintVertexArray:new h.PaintVertexArray}}this.segments=[],this.segments2=[]};o.prototype.prepareSegment=function(t){var e=this.segments[this.segments.length-1];return(!e||e.vertexLength+t>o.MAX_VERTEX_ARRAY_LENGTH)&&(e=new a(this.layoutVertexArray.length,this.elementArray.length),this.segments.push(e)),e},o.prototype.prepareSegment2=function(t){var e=this.segments2[this.segments2.length-1];return(!e||e.vertexLength+t>o.MAX_VERTEX_ARRAY_LENGTH)&&(e=new a(this.layoutVertexArray.length,this.elementArray2.length),this.segments2.push(e)),e},o.prototype.populatePaintArrays=function(t){var e=this;for(var i in this.layerData){var n=e.layerData[i];0!==n.paintVertexArray.bytesPerElement&&n.programConfiguration.populatePaintArray(n.layer,n.paintVertexArray,e.layoutVertexArray.length,e.globalProperties,t)}},o.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},o.prototype.serialize=function(t){return{layoutVertexArray:this.layoutVertexArray.serialize(t),elementArray:this.elementArray&&this.elementArray.serialize(t),elementArray2:this.elementArray2&&this.elementArray2.serialize(t),paintVertexArrays:n(this.layerData,t),segments:this.segments,segments2:this.segments2}},o.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,e.exports=o},{"./program_configuration":15}],2:[function(t,e,i){"use strict";var n=t("./array_group"),r=t("./buffer_group"),a=t("../util/util"),o=function(t,e){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.index=t.index,t.arrays?this.buffers=new r(e,t.layers,t.zoom,t.arrays):this.arrays=new n(e,t.layers,t.zoom)};o.prototype.populate=function(t,e){for(var i=this,n=0,r=t;n<r.length;n+=1){var a=r[n];i.layers[0].filter(a)&&(i.addFeature(a),e.featureIndex.insert(a,i.index))}},o.prototype.isEmpty=function(){return this.arrays.isEmpty()},o.prototype.serialize=function(t){return{zoom:this.zoom,layerIds:this.layers.map(function(t){return t.id}),arrays:this.arrays.serialize(t)}},o.prototype.destroy=function(){this.buffers&&(this.buffers.destroy(),this.buffers=null)},e.exports=o,o.deserialize=function(t,e){if(e){for(var i={},n=0,r=t;n<r.length;n+=1){var o=r[n],s=o.layerIds.map(function(t){return e.getLayer(t)}).filter(Boolean);if(0!==s.length)for(var l=s[0].createBucket(a.extend({layers:s},o)),c=0,u=s;c<u.length;c+=1){var h=u[c];i[h.id]=l}}return i}}},{"../util/util":129,"./array_group":1,"./buffer_group":9}],3:[function(t,e,i){"use strict";function n(t,e,i,n,r){t.emplaceBack(2*e+(n+1)/2,2*i+(r+1)/2)}var r=t("../bucket"),a=t("../vertex_array_type"),o=t("../element_array_type"),s=t("../load_geometry"),l=t("../extent"),c={layoutVertexArrayType:a([{name:"a_pos",components:2,type:"Int16"}]),elementArrayType:o(),paintAttributes:[{property:"circle-color",type:"Uint8"},{property:"circle-radius",type:"Uint16",multiplier:10},{property:"circle-blur",type:"Uint16",multiplier:10},{property:"circle-opacity",type:"Uint8",multiplier:255},{property:"circle-stroke-color",type:"Uint8"},{property:"circle-stroke-width",type:"Uint16",multiplier:10},{property:"circle-stroke-opacity",type:"Uint8",multiplier:255}]},u=function(t){function e(e){t.call(this,e,c)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.addFeature=function(t){for(var e=this.arrays,i=0,r=s(t);i<r.length;i+=1)for(var a=r[i],o=0,c=a;o<c.length;o+=1){var u=c[o],h=u.x,d=u.y;if(!(h<0||h>=l||d<0||d>=l)){var f=e.prepareSegment(4),p=f.vertexLength;n(e.layoutVertexArray,h,d,-1,-1),n(e.layoutVertexArray,h,d,1,-1),n(e.layoutVertexArray,h,d,1,1),n(e.layoutVertexArray,h,d,-1,1),e.elementArray.emplaceBack(p,p+1,p+2),e.elementArray.emplaceBack(p,p+3,p+2),f.vertexLength+=4,f.primitiveLength+=2}}e.populatePaintArrays(t.properties)},e}(r);e.exports=u},{"../bucket":2,"../element_array_type":10,"../extent":11,"../load_geometry":13,"../vertex_array_type":17}],4:[function(t,e,i){"use strict";var n=t("../bucket"),r=t("../vertex_array_type"),a=t("../element_array_type"),o=t("../load_geometry"),s=t("earcut"),l=t("../../util/classify_rings"),c=500,u={layoutVertexArrayType:r([{name:"a_pos",components:2,type:"Int16"}]),elementArrayType:a(3),elementArrayType2:a(2),paintAttributes:[{property:"fill-color",type:"Uint8"},{property:"fill-outline-color",type:"Uint8"},{property:"fill-opacity",type:"Uint8",multiplier:255}]},h=function(t){function e(e){t.call(this,e,u)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.addFeature=function(t){for(var e=this.arrays,i=0,n=l(o(t),c);i<n.length;i+=1){for(var r=n[i],a=0,u=0,h=r;u<h.length;u+=1){var d=h[u];a+=d.length}for(var f=e.prepareSegment(a),p=f.vertexLength,m=[],g=[],v=0,y=r;v<y.length;v+=1){var b=y[v];if(0!==b.length){b!==r[0]&&g.push(m.length/2);var _=e.prepareSegment2(b.length),x=_.vertexLength;e.layoutVertexArray.emplaceBack(b[0].x,b[0].y),e.elementArray2.emplaceBack(x+b.length-1,x),m.push(b[0].x),m.push(b[0].y);for(var w=1;w<b.length;w++)e.layoutVertexArray.emplaceBack(b[w].x,b[w].y),e.elementArray2.emplaceBack(x+w-1,x+w),m.push(b[w].x),m.push(b[w].y);_.vertexLength+=b.length,_.primitiveLength+=b.length}}for(var M=s(m,g),z=0;z<M.length;z+=3)e.elementArray.emplaceBack(p+M[z],p+M[z+1],p+M[z+2]);f.vertexLength+=a,f.primitiveLength+=M.length/3}e.populatePaintArrays(t.properties)},e}(n);e.exports=h},{"../../util/classify_rings":113,"../bucket":2,"../element_array_type":10,"../load_geometry":13,"../vertex_array_type":17,earcut:136}],5:[function(t,e,i){"use strict";function n(t,e,i,n,r,a,o,s){t.emplaceBack(e,i,2*Math.floor(n*p)+o,r*p*2,a*p*2,Math.round(s))}function r(t,e){return t.x===e.x&&(t.x<0||t.x>c)||t.y===e.y&&(t.y<0||t.y>c)}var a=t("../bucket"),o=t("../vertex_array_type"),s=t("../element_array_type"),l=t("../load_geometry"),c=t("../extent"),u=t("earcut"),h=t("../../util/classify_rings"),d=500,f={layoutVertexArrayType:o([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal",components:3,type:"Int16"},{name:"a_edgedistance",components:1,type:"Int16"}]),elementArrayType:s(3),paintAttributes:[{property:"fill-extrusion-base",type:"Uint16"},{property:"fill-extrusion-height",type:"Uint16"},{property:"fill-extrusion-color",type:"Uint8"}]},p=Math.pow(2,13),m=function(t){function e(e){t.call(this,e,f)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.addFeature=function(t){for(var e=this.arrays,i=0,a=h(l(t),d);i<a.length;i+=1){for(var o=a[i],s=0,c=0,f=o;c<f.length;c+=1){var p=f[c];s+=p.length}for(var m=e.prepareSegment(5*s),g=[],v=[],y=[],b=0,_=o;b<_.length;b+=1){var x=_[b];if(0!==x.length){x!==o[0]&&v.push(g.length/2);for(var w=0,M=0;M<x.length;M++){var z=x[M];if(n(e.layoutVertexArray,z.x,z.y,0,0,1,1,0),y.push(m.vertexLength++),M>=1){var S=x[M-1];if(!r(z,S)){var E=z.sub(S)._perp()._unit();n(e.layoutVertexArray,z.x,z.y,E.x,E.y,0,0,w),n(e.layoutVertexArray,z.x,z.y,E.x,E.y,0,1,w),w+=S.dist(z),n(e.layoutVertexArray,S.x,S.y,E.x,E.y,0,0,w),n(e.layoutVertexArray,S.x,S.y,E.x,E.y,0,1,w);var k=m.vertexLength;e.elementArray.emplaceBack(k,k+1,k+2),e.elementArray.emplaceBack(k+1,k+2,k+3),m.vertexLength+=4,m.primitiveLength+=2}}g.push(z.x),g.push(z.y)}}}for(var T=u(g,v),P=0;P<T.length;P+=3)e.elementArray.emplaceBack(y[T[P]],y[T[P+1]],y[T[P+2]]);m.primitiveLength+=T.length/3}e.populatePaintArrays(t.properties)},e}(a);e.exports=m},{"../../util/classify_rings":113,"../bucket":2,"../element_array_type":10,"../extent":11,"../load_geometry":13,"../vertex_array_type":17,earcut:136}],6:[function(t,e,i){"use strict";function n(t,e,i,n,r,a,o){t.emplaceBack(e.x<<1|n,e.y<<1|r,Math.round(c*i.x)+128,Math.round(c*i.y)+128,(0===a?0:a<0?-1:1)+1|(o*f&63)<<2,o*f>>6)}var r=t("../bucket"),a=t("../vertex_array_type"),o=t("../element_array_type"),s=t("../load_geometry"),l=t("../extent"),c=63,u=Math.cos(37.5*(Math.PI/180)),h=15,d=15,f=.5,p=Math.pow(2,d-1)/f,m={layoutVertexArrayType:a([{name:"a_pos",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}]),paintAttributes:[{property:"line-color",type:"Uint8"},{property:"line-blur",multiplier:10,type:"Uint8"},{property:"line-opacity",multiplier:10,type:"Uint8"},{property:"line-gap-width",multiplier:10,type:"Uint8",name:"a_gapwidth"},{property:"line-offset",multiplier:1,type:"Int8"}],elementArrayType:o()},g=function(t){function e(e){t.call(this,e,m)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.addFeature=function(t){for(var e=this,i=this.layers[0].layout,n=i["line-join"],r=i["line-cap"],a=i["line-miter-limit"],o=i["line-round-limit"],l=0,c=s(t,d);l<c.length;l+=1){var u=c[l];e.addLine(u,t.properties,n,r,a,o)}},e.prototype.addLine=function(t,e,i,n,r,a){for(var o=this,s=t.length;s>2&&t[s-1].equals(t[s-2]);)s--;if(!(t.length<2)){"bevel"===i&&(r=1.05);var c=h*(l/(512*this.overscaling)),d=t[0],f=t[s-1],p=d.equals(f),m=this.arrays,g=m.prepareSegment(10*s);if(2!==s||!p){this.distance=0;var v,y,b,_,x,w,M,z=n,S=p?"butt":n,E=!0;this.e1=this.e2=this.e3=-1,p&&(v=t[s-2],x=d.sub(v)._unit()._perp());for(var k=0;k<s;k++)if(b=p&&k===s-1?t[1]:t[k+1],!b||!t[k].equals(b)){x&&(_=x),v&&(y=v),v=t[k],x=b?b.sub(v)._unit()._perp():_,_=_||x;var T=_.add(x);0===T.x&&0===T.y||T._unit();var P=T.x*x.x+T.y*x.y,O=0!==P?1/P:1/0,A=P<u&&y&&b;if(A&&k>0){var I=v.dist(y);if(I>2*c){var C=v.sub(v.sub(y)._mult(c/I)._round());o.distance+=C.dist(y),o.addCurrentVertex(C,o.distance,_.mult(1),0,0,!1,g),y=C}}var L=y&&b,D=L?i:b?z:S;if(L&&"round"===D&&(O<a?D="miter":O<=2&&(D="fakeround")),"miter"===D&&O>r&&(D="bevel"),"bevel"===D&&(O>2&&(D="flipbevel"),O<r&&(D="miter")),y&&(o.distance+=v.dist(y)),"miter"===D)T._mult(O),o.addCurrentVertex(v,o.distance,T,0,0,!1,g);else if("flipbevel"===D){if(O>100)T=x.clone().mult(-1);else{var R=_.x*x.y-_.y*x.x>0?-1:1,B=O*_.add(x).mag()/_.sub(x).mag();T._perp()._mult(B*R)}o.addCurrentVertex(v,o.distance,T,0,0,!1,g),o.addCurrentVertex(v,o.distance,T.mult(-1),0,0,!1,g)}else if("bevel"===D||"fakeround"===D){var j=_.x*x.y-_.y*x.x>0,F=-Math.sqrt(O*O-1);if(j?(M=0,w=F):(w=0,M=F),E||o.addCurrentVertex(v,o.distance,_,w,M,!1,g),"fakeround"===D){for(var N,q=Math.floor(8*(.5-(P-.5))),V=0;V<q;V++)N=x.mult((V+1)/(q+1))._add(_)._unit(),o.addPieSliceVertex(v,o.distance,N,j,g);o.addPieSliceVertex(v,o.distance,T,j,g);for(var U=q-1;U>=0;U--)N=_.mult((U+1)/(q+1))._add(x)._unit(),o.addPieSliceVertex(v,o.distance,N,j,g)}b&&o.addCurrentVertex(v,o.distance,x,-w,-M,!1,g)}else"butt"===D?(E||o.addCurrentVertex(v,o.distance,_,0,0,!1,g),b&&o.addCurrentVertex(v,o.distance,x,0,0,!1,g)):"square"===D?(E||(o.addCurrentVertex(v,o.distance,_,1,1,!1,g),o.e1=o.e2=-1),b&&o.addCurrentVertex(v,o.distance,x,-1,-1,!1,g)):"round"===D&&(E||(o.addCurrentVertex(v,o.distance,_,0,0,!1,g),o.addCurrentVertex(v,o.distance,_,1,1,!0,g),o.e1=o.e2=-1),b&&(o.addCurrentVertex(v,o.distance,x,-1,-1,!0,g),o.addCurrentVertex(v,o.distance,x,0,0,!1,g)));if(A&&k<s-1){var H=v.dist(b);if(H>2*c){var X=v.add(b.sub(v)._mult(c/H)._round());o.distance+=X.dist(v),o.addCurrentVertex(X,o.distance,x.mult(1),0,0,!1,g),v=X}}E=!1}m.populatePaintArrays(e)}}},e.prototype.addCurrentVertex=function(t,e,i,r,a,o,s){var l,c=o?1:0,u=this.arrays,h=u.layoutVertexArray,d=u.elementArray;l=i.clone(),r&&l._sub(i.perp()._mult(r)),n(h,t,l,c,0,r,e),this.e3=s.vertexLength++,this.e1>=0&&this.e2>=0&&(d.emplaceBack(this.e1,this.e2,this.e3),s.primitiveLength++),this.e1=this.e2,this.e2=this.e3,l=i.mult(-1),a&&l._sub(i.perp()._mult(a)),n(h,t,l,c,1,-a,e),this.e3=s.vertexLength++,this.e1>=0&&this.e2>=0&&(d.emplaceBack(this.e1,this.e2,this.e3),s.primitiveLength++),this.e1=this.e2,this.e2=this.e3,e>p/2&&(this.distance=0,this.addCurrentVertex(t,this.distance,i,r,a,o,s))},e.prototype.addPieSliceVertex=function(t,e,i,r,a){var o=r?1:0;i=i.mult(r?-1:1);var s=this.arrays,l=s.layoutVertexArray,c=s.elementArray;n(l,t,i,0,o,0,e),this.e3=a.vertexLength++,this.e1>=0&&this.e2>=0&&(c.emplaceBack(this.e1,this.e2,this.e3),a.primitiveLength++),r?this.e2=this.e3:this.e1=this.e3},e}(r);e.exports=g},{"../bucket":2,"../element_array_type":10,"../extent":11,"../load_geometry":13,"../vertex_array_type":17}],7:[function(t,e,i){"use strict";function n(t,e,i,n,r,a,o,s,l,c,u){t.emplaceBack(e,i,Math.round(64*n),Math.round(64*r),a/4,o/4,10*(c||0),u,10*(s||0),10*Math.min(l||25,25))}function r(t,e,i,n,r){return t.emplaceBack(e.x,e.y,Math.round(i.x),Math.round(i.y),10*n,10*r)}var a=t("point-geometry"),o=t("../array_group"),s=t("../buffer_group"),l=t("../vertex_array_type"),c=t("../element_array_type"),u=t("../extent"),h=t("../../symbol/anchor"),d=t("../../symbol/get_anchors"),f=t("../../util/token"),p=t("../../symbol/quads"),m=t("../../symbol/shaping"),g=t("../../symbol/resolve_text"),v=t("../../symbol/mergelines"),y=t("../../symbol/clip_line"),b=t("../../util/util"),_=t("../../util/script_detection"),x=t("../load_geometry"),w=t("../../symbol/collision_feature"),M=t("../../util/find_pole_of_inaccessibility"),z=t("../../util/classify_rings"),S=t("vector-tile").VectorTileFeature,E=t("../../source/rtl_text_plugin"),k=m.shapeText,T=m.shapeIcon,P=m.WritingMode,O=p.getGlyphQuads,A=p.getIconQuads,I=c(),C=l([{name:"a_pos",components:2,type:"Int16"},{name:"a_offset",components:2,type:"Int16"},{name:"a_texture_pos",components:2,type:"Uint16"},{name:"a_data",components:4,type:"Uint8"}]),L={glyph:{layoutVertexArrayType:C,elementArrayType:I},icon:{layoutVertexArrayType:C,elementArrayType:I},collisionBox:{layoutVertexArrayType:l([{name:"a_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"},{name:"a_data",components:2,type:"Uint8"}]),elementArrayType:c(2)}},D=function(t){var e=this;if(this.collisionBoxArray=t.collisionBoxArray,this.symbolQuadsArray=t.symbolQuadsArray,this.symbolInstancesArray=t.symbolInstancesArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.index=t.index,this.sdfIcons=t.sdfIcons,this.iconsNeedLinear=t.iconsNeedLinear,this.adjustedTextSize=t.adjustedTextSize,this.adjustedIconSize=t.adjustedIconSize,this.fontstack=t.fontstack,t.arrays){this.buffers={};for(var i in t.arrays)t.arrays[i]&&(e.buffers[i]=new s(L[i],t.layers,t.zoom,t.arrays[i]))}};D.prototype.populate=function(t,e){var i=this,n=this.layers[0].layout,r=n["text-field"],a=n["text-font"],o=n["icon-image"],s=r&&a,l=o;if(this.features=[],s||l){for(var c=e.iconDependencies,u=e.glyphDependencies,h=u[a]=u[a]||{},d=0;d<t.length;d++){var p=t[d];if(i.layers[0].filter(p)){var m;s&&(m=E.applyArabicShaping?E.applyArabicShaping(g(p,n)):g(p,n));var y;if(l&&(y=f(p.properties,o)),(m||y)&&(i.features.push({text:m,icon:y,index:d,sourceLayerIndex:p.sourceLayerIndex,geometry:x(p),properties:p.properties,type:S.types[p.type]}),y&&(c[y]=!0),m))for(var b=0;b<m.length;b++)h[m.charCodeAt(b)]=!0}}"line"===n["symbol-placement"]&&(this.features=v(this.features))}},D.prototype.isEmpty=function(){return this.arrays.icon.isEmpty()&&this.arrays.glyph.isEmpty()&&this.arrays.collisionBox.isEmpty()},D.prototype.serialize=function(t){return{zoom:this.zoom,layerIds:this.layers.map(function(t){return t.id}),sdfIcons:this.sdfIcons,iconsNeedLinear:this.iconsNeedLinear,adjustedTextSize:this.adjustedTextSize,adjustedIconSize:this.adjustedIconSize,fontstack:this.fontstack,arrays:b.mapObject(this.arrays,function(e){return e.isEmpty()?null:e.serialize(t)})}},D.prototype.destroy=function(){this.buffers&&(this.buffers.icon&&this.buffers.icon.destroy(),this.buffers.glyph&&this.buffers.glyph.destroy(),this.buffers.collisionBox&&this.buffers.collisionBox.destroy(),this.buffers=null)},D.prototype.createArrays=function(){var t=this;this.arrays=b.mapObject(L,function(e){return new o(e,t.layers,t.zoom)})},D.prototype.prepare=function(t,e){var i=this;this.createArrays(),this.adjustedTextMaxSize=this.layers[0].getLayoutValue("text-size",{zoom:18}),this.adjustedTextSize=this.layers[0].getLayoutValue("text-size",{zoom:this.zoom+1}),this.adjustedIconMaxSize=this.layers[0].getLayoutValue("icon-size",{zoom:18}),this.adjustedIconSize=this.layers[0].getLayoutValue("icon-size",{zoom:this.zoom+1});var n=512*this.overscaling;this.tilePixelRatio=u/n,this.compareText={},this.iconsNeedLinear=!1,this.symbolInstancesStartIndex=this.symbolInstancesArray.length;var r=this.layers[0].layout,a=.5,o=.5;switch(r["text-anchor"]){case"right":case"top-right":case"bottom-right":a=1;break;case"left":case"top-left":case"bottom-left":a=0}switch(r["text-anchor"]){case"bottom":case"bottom-right":case"bottom-left":o=1;break;case"top":case"top-right":case"top-left":o=0}for(var s="right"===r["text-justify"]?1:"left"===r["text-justify"]?0:.5,l=24,c=r["text-line-height"]*l,h="line"!==r["symbol-placement"]?r["text-max-width"]*l:0,d=r["text-letter-spacing"]*l,f=[r["text-offset"][0]*l,r["text-offset"][1]*l],p=this.fontstack=r["text-font"].join(","),m="map"===r["text-rotation-alignment"]&&"line"===r["symbol-placement"],g=0,v=this.features;g<v.length;g+=1){var y,x=v[g];if(x.text){var w=_.allowsVerticalWritingMode(x.text);y={},y[P.horizontal]=k(x.text,t[p],h,c,a,o,s,d,f,l,P.horizontal),y[P.vertical]=w&&m&&k(x.text,t[p],h,c,a,o,s,d,f,l,P.vertical)}else y={};var M;if(x.icon){var z=e[x.icon],S=i.layers[0].getLayoutValue("icon-offset",{zoom:i.zoom},x.properties);M=T(z,S),z&&(void 0===i.sdfIcons?i.sdfIcons=z.sdf:i.sdfIcons!==z.sdf&&b.warnOnce("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),1!==z.pixelRatio?i.iconsNeedLinear=!0:0===r["icon-rotate"]&&i.layers[0].isLayoutValueFeatureConstant("icon-rotate")||(i.iconsNeedLinear=!0))}(y[P.horizontal]||M)&&i.addFeature(x,y,M)}this.symbolInstancesEndIndex=this.symbolInstancesArray.length},D.prototype.addFeature=function(t,e,i){var n=this,r=this.layers[0].layout,a=24,o=this.adjustedTextSize/a,s=void 0!==this.adjustedTextMaxSize?this.adjustedTextMaxSize:this.adjustedTextSize,l=this.tilePixelRatio*o,c=this.tilePixelRatio*s/a,f=this.tilePixelRatio*this.adjustedIconSize,p=this.tilePixelRatio*r["symbol-spacing"],m=r["symbol-avoid-edges"],g=r["text-padding"]*this.tilePixelRatio,v=r["icon-padding"]*this.tilePixelRatio,b=r["text-max-angle"]/180*Math.PI,_="map"===r["text-rotation-alignment"]&&"line"===r["symbol-placement"],x="map"===r["icon-rotation-alignment"]&&"line"===r["symbol-placement"],w=r["text-allow-overlap"]||r["icon-allow-overlap"]||r["text-ignore-placement"]||r["icon-ignore-placement"],S=r["symbol-placement"],E=p/2,k=function(r,a){var o=!(a.x<0||a.x>u||a.y<0||a.y>u);if(!m||o){var s=o||w;n.addSymbolInstance(a,r,e,i,n.layers[0],s,n.symbolInstancesArray.length,n.collisionBoxArray,t.index,t.sourceLayerIndex,n.index,l,g,_,f,v,x,{zoom:n.zoom},t.properties)}};if("line"===S)for(var T=0,O=y(t.geometry,0,0,u,u);T<O.length;T+=1)for(var A=O[T],I=d(A,p,b,e[P.vertical]||e[P.horizontal],i,a,c,n.overscaling,u),C=0,L=I;C<L.length;C+=1){var D=L[C],R=e[P.horizontal];R&&n.anchorIsTooClose(R.text,E,D)||k(A,D)}else if("Polygon"===t.type)for(var B=0,j=z(t.geometry,0);B<j.length;B+=1){var F=j[B],N=M(F,16);k(F[0],new h(N.x,N.y,0))}else if("LineString"===t.type)for(var q=0,V=t.geometry;q<V.length;q+=1){var U=V[q];k(U,new h(U[0].x,U[0].y,0))}else if("Point"===t.type)for(var H=0,X=t.geometry;H<X.length;H+=1)for(var Y=X[H],W=0,G=Y;W<G.length;W+=1){var K=G[W];k([K],new h(K.x,K.y,0))}},D.prototype.anchorIsTooClose=function(t,e,i){var n=this.compareText;if(t in n){for(var r=n[t],a=r.length-1;a>=0;a--)if(i.dist(r[a])<e)return!0}else n[t]=[];return n[t].push(i),!1},D.prototype.place=function(t,e){var i=this;this.createArrays();var n=this.layers[0].layout,r=t.maxScale,a="map"===n["text-rotation-alignment"]&&"line"===n["symbol-placement"],o="map"===n["icon-rotation-alignment"]&&"line"===n["symbol-placement"],s=n["text-allow-overlap"]||n["icon-allow-overlap"]||n["text-ignore-placement"]||n["icon-ignore-placement"];if(s){var l=this.symbolInstancesArray.toArray(this.symbolInstancesStartIndex,this.symbolInstancesEndIndex),c=t.angle,u=Math.sin(c),h=Math.cos(c);this.sortedSymbolInstances=l.sort(function(t,e){var i=u*t.anchorPointX+h*t.anchorPointY|0,n=u*e.anchorPointX+h*e.anchorPointY|0;return i-n||e.index-t.index})}for(var d=this.symbolInstancesStartIndex;d<this.symbolInstancesEndIndex;d++){var f=i.sortedSymbolInstances?i.sortedSymbolInstances[d-i.symbolInstancesStartIndex]:i.symbolInstancesArray.get(d),p={boxStartIndex:f.textBoxStartIndex,boxEndIndex:f.textBoxEndIndex},m={boxStartIndex:f.iconBoxStartIndex,boxEndIndex:f.iconBoxEndIndex},g=!(f.textBoxStartIndex===f.textBoxEndIndex),v=!(f.iconBoxStartIndex===f.iconBoxEndIndex),y=n["text-optional"]||!g,b=n["icon-optional"]||!v,_=g?t.placeCollisionFeature(p,n["text-allow-overlap"],n["symbol-avoid-edges"]):t.minScale,x=v?t.placeCollisionFeature(m,n["icon-allow-overlap"],n["symbol-avoid-edges"]):t.minScale;y||b?!b&&_?_=Math.max(x,_):!y&&x&&(x=Math.max(x,_)):x=_=Math.max(x,_),g&&(t.insertCollisionFeature(p,_,n["text-ignore-placement"]),_<=r&&i.addSymbols(i.arrays.glyph,f.glyphQuadStartIndex,f.glyphQuadEndIndex,_,n["text-keep-upright"],a,t.angle,f.writingModes)),v&&(t.insertCollisionFeature(m,x,n["icon-ignore-placement"]),x<=r&&i.addSymbols(i.arrays.icon,f.iconQuadStartIndex,f.iconQuadEndIndex,x,n["icon-keep-upright"],o,t.angle))}e&&this.addToDebugBuffers(t)},D.prototype.addSymbols=function(t,e,i,r,a,o,s,l){for(var c=this,u=t.elementArray,h=t.layoutVertexArray,d=this.zoom,f=Math.max(Math.log(r)/Math.LN2+d,0),p=e;p<i;p++){var m=c.symbolQuadsArray.get(p).SymbolQuad,g=(m.anchorAngle+s+Math.PI)%(2*Math.PI);if(l&P.vertical){if(o&&m.writingMode===P.vertical){if(a&&o&&g<=5*Math.PI/4||g>7*Math.PI/4)continue}else if(a&&o&&g<=3*Math.PI/4||g>5*Math.PI/4)continue}else if(a&&o&&(g<=Math.PI/2||g>3*Math.PI/2))continue;var v=m.tl,y=m.tr,b=m.bl,_=m.br,x=m.tex,w=m.anchorPoint,M=Math.max(d+Math.log(m.minScale)/Math.LN2,f),z=Math.min(d+Math.log(m.maxScale)/Math.LN2,25);if(!(z<=M)){M===f&&(M=0);var S=Math.round(m.glyphAngle/(2*Math.PI)*256),E=t.prepareSegment(4),k=E.vertexLength;n(h,w.x,w.y,v.x,v.y,x.x,x.y,M,z,f,S),n(h,w.x,w.y,y.x,y.y,x.x+x.w,x.y,M,z,f,S),n(h,w.x,w.y,b.x,b.y,x.x,x.y+x.h,M,z,f,S),n(h,w.x,w.y,_.x,_.y,x.x+x.w,x.y+x.h,M,z,f,S),u.emplaceBack(k,k+1,k+2),u.emplaceBack(k+1,k+2,k+3),E.vertexLength+=4,E.primitiveLength+=2}}},D.prototype.addToDebugBuffers=function(t){for(var e=this,i=this.arrays.collisionBox,n=i.layoutVertexArray,o=i.elementArray,s=-t.angle,l=t.yStretch,c=this.symbolInstancesStartIndex;c<this.symbolInstancesEndIndex;c++){var u=e.symbolInstancesArray.get(c);u.textCollisionFeature={boxStartIndex:u.textBoxStartIndex,boxEndIndex:u.textBoxEndIndex},u.iconCollisionFeature={boxStartIndex:u.iconBoxStartIndex,boxEndIndex:u.iconBoxEndIndex};for(var h=0;h<2;h++){var d=u[0===h?"textCollisionFeature":"iconCollisionFeature"];if(d)for(var f=d.boxStartIndex;f<d.boxEndIndex;f++){var p=e.collisionBoxArray.get(f),m=p.anchorPoint,g=new a(p.x1,p.y1*l)._rotate(s),v=new a(p.x2,p.y1*l)._rotate(s),y=new a(p.x1,p.y2*l)._rotate(s),b=new a(p.x2,p.y2*l)._rotate(s),_=Math.max(0,Math.min(25,e.zoom+Math.log(p.maxScale)/Math.LN2)),x=Math.max(0,Math.min(25,e.zoom+Math.log(p.placementScale)/Math.LN2)),w=i.prepareSegment(4),M=w.vertexLength;r(n,m,g,_,x),r(n,m,v,_,x),r(n,m,b,_,x),r(n,m,y,_,x),o.emplaceBack(M,M+1),o.emplaceBack(M+1,M+2),o.emplaceBack(M+2,M+3),o.emplaceBack(M+3,M),w.vertexLength+=4,w.primitiveLength+=4}}}},D.prototype.addSymbolInstance=function(t,e,i,n,r,a,o,s,l,c,u,h,d,f,p,m,g,v,y){var _,x,M,z=this,S=[];for(var E in i){var k=parseInt(E,10);i[k]&&(S=S.concat(a?O(t,i[k],h,e,r,f,k):[]),_=new w(s,e,t,l,c,u,i[k],h,d,f,!1))}var T=this.symbolQuadsArray.length;if(S&&S.length)for(var I=0;I<S.length;I++)z.addSymbolQuad(S[I]);var C=this.symbolQuadsArray.length,L=_?_.boxStartIndex:this.collisionBoxArray.length,R=_?_.boxEndIndex:this.collisionBoxArray.length;n&&(M=a?A(t,n,p,e,r,g,i[P.horizontal],v,y):[],x=new w(s,e,t,l,c,u,n,p,m,g,!0));var B=this.symbolQuadsArray.length;M&&1===M.length&&this.addSymbolQuad(M[0]);var j=this.symbolQuadsArray.length,F=x?x.boxStartIndex:this.collisionBoxArray.length,N=x?x.boxEndIndex:this.collisionBoxArray.length;j>D.MAX_QUADS&&b.warnOnce("Too many symbols being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),C>D.MAX_QUADS&&b.warnOnce("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907");var q=(i[P.vertical]?P.vertical:0)|(i[P.horizontal]?P.horizontal:0);return this.symbolInstancesArray.emplaceBack(L,R,F,N,T,C,B,j,t.x,t.y,o,q)},D.prototype.addSymbolQuad=function(t){return this.symbolQuadsArray.emplaceBack(t.anchorPoint.x,t.anchorPoint.y,t.tl.x,t.tl.y,t.tr.x,t.tr.y,t.bl.x,t.bl.y,t.br.x,t.br.y,t.tex.h,t.tex.w,t.tex.x,t.tex.y,t.anchorAngle,t.glyphAngle,t.maxScale,t.minScale,t.writingMode)},D.MAX_QUADS=65535,e.exports=D},{"../../source/rtl_text_plugin":49,"../../symbol/anchor":75,"../../symbol/clip_line":77,"../../symbol/collision_feature":79,"../../symbol/get_anchors":81,"../../symbol/mergelines":84,"../../symbol/quads":85,"../../symbol/resolve_text":86,"../../symbol/shaping":87,"../../util/classify_rings":113,"../../util/find_pole_of_inaccessibility":119,"../../util/script_detection":126,"../../util/token":128,"../../util/util":129,"../array_group":1,"../buffer_group":9,"../element_array_type":10,"../extent":11,"../load_geometry":13,"../vertex_array_type":17,"point-geometry":197,"vector-tile":206}],8:[function(t,e,i){"use strict";var n={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT"},r=function(t,e,i){this.arrayBuffer=t.arrayBuffer,this.length=t.length,this.attributes=e.members,this.itemSize=e.bytesPerElement,this.type=i,this.arrayType=e};r.fromStructArray=function(t,e){return new r(t.serialize(),t.constructor.serialize(),e)},r.prototype.bind=function(t){var e=t[this.type];this.buffer?t.bindBuffer(e,this.buffer):(this.gl=t,this.buffer=t.createBuffer(),t.bindBuffer(e,this.buffer),t.bufferData(e,this.arrayBuffer,t.STATIC_DRAW),this.arrayBuffer=null)},r.prototype.setVertexAttribPointers=function(t,e,i){for(var r=this,a=0;a<this.attributes.length;a++){var o=r.attributes[a],s=e[o.name];void 0!==s&&t.vertexAttribPointer(s,o.components,t[n[o.type]],!1,r.arrayType.bytesPerElement,o.offset+(r.arrayType.bytesPerElement*i||0))}},r.prototype.destroy=function(){this.buffer&&this.gl.deleteBuffer(this.buffer)},r.BufferType={VERTEX:"ARRAY_BUFFER",ELEMENT:"ELEMENT_ARRAY_BUFFER"},e.exports=r},{}],9:[function(t,e,i){"use strict";var n=t("../util/util"),r=t("./buffer"),a=t("./program_configuration"),o=t("../render/vertex_array_object"),s=function(t,e,i,s){var l=this;this.layoutVertexBuffer=new r(s.layoutVertexArray,t.layoutVertexArrayType.serialize(),r.BufferType.VERTEX),s.elementArray&&(this.elementBuffer=new r(s.elementArray,t.elementArrayType.serialize(),r.BufferType.ELEMENT)),s.elementArray2&&(this.elementBuffer2=new r(s.elementArray2,t.elementArrayType2.serialize(),r.BufferType.ELEMENT)),this.layerData={};for(var c=0,u=e;c<u.length;c+=1){var h=u[c],d=s.paintVertexArrays&&s.paintVertexArrays[h.id],f=a.createDynamic(t.paintAttributes||[],h,i),p=d?new r(d.array,d.type,r.BufferType.VERTEX):null;l.layerData[h.id]={programConfiguration:f,paintVertexBuffer:p}}this.segments=s.segments,this.segments2=s.segments2;for(var m=0,g=[this.segments,this.segments2];m<g.length;m+=1)for(var v=g[m],y=0,b=v||[];y<b.length;y+=1){var _=b[y];_.vaos=n.mapObject(l.layerData,function(){return new o})}};s.prototype.destroy=function(){var t=this;this.layoutVertexBuffer.destroy(),this.elementBuffer&&this.elementBuffer.destroy(),this.elementBuffer2&&this.elementBuffer2.destroy();for(var e in this.layerData){var i=t.layerData[e].paintVertexBuffer;i&&i.destroy()}for(var n=0,r=[this.segments,this.segments2];n<r.length;n+=1)for(var a=r[n],o=0,s=a||[];o<s.length;o+=1){var l=s[o];for(var c in l.vaos)l.vaos[c].destroy()}},e.exports=s},{"../render/vertex_array_object":39,"../util/util":129,"./buffer":8,"./program_configuration":15}],10:[function(t,e,i){"use strict";function n(t){return r({members:[{type:"Uint16",name:"vertices",components:t||3}]})}var r=t("../util/struct_array");e.exports=n},{"../util/struct_array":127}],11:[function(t,e,i){"use strict";e.exports=8192},{}],12:[function(t,e,i){"use strict";function n(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function r(t,e){return e-t}function a(t){return t["line-gap-width"]>0?t["line-gap-width"]+2*t["line-width"]:t["line-width"]}function o(t,e,i,n,r){if(!e[0]&&!e[1])return t;e=l.convert(e),"viewport"===i&&e._rotate(-n);for(var a=[],o=0;o<t.length;o++){for(var s=t[o],c=[],u=0;u<s.length;u++)c.push(s[u].sub(e._mult(r)));a.push(c)}return a}function s(t,e){for(var i=[],n=new l(0,0),r=0;r<t.length;r++){for(var a=t[r],o=[],s=0;s<a.length;s++){var c=a[s-1],u=a[s],h=a[s+1],d=0===s?n:u.sub(c)._unit()._perp(),f=s===a.length-1?n:h.sub(u)._unit()._perp(),p=d._add(f)._unit(),m=p.x*f.x+p.y*f.y;p._mult(1/m),o.push(p._mult(e)._add(u))}i.push(o)}return i}var l=t("point-geometry"),c=t("./load_geometry"),u=t("./extent"),h=t("feature-filter"),d=t("../util/struct_array"),f=t("grid-index"),p=t("../util/dictionary_coder"),m=t("vector-tile"),g=t("pbf"),v=t("../util/vectortile_to_geojson"),y=t("../util/util").arraysIntersect,b=t("../util/intersection_tests"),_=b.multiPolygonIntersectsBufferedMultiPoint,x=b.multiPolygonIntersectsMultiPolygon,w=b.multiPolygonIntersectsBufferedMultiLine,M=d({members:[{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]}),z=function(t,e,i){if(t.grid){var n=t,r=e;t=n.coord,e=n.overscaling,this.grid=new f(n.grid),this.featureIndexArray=new M(n.featureIndexArray),this.rawTileData=r,this.bucketLayerIDs=n.bucketLayerIDs}else this.grid=new f(u,16,0),this.featureIndexArray=new M;this.coord=t,this.overscaling=e,this.x=t.x,this.y=t.y,this.z=t.z-Math.log(e)/Math.LN2,this.setCollisionTile(i)};z.prototype.insert=function(t,e){var i=this,n=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(t.index,t.sourceLayerIndex,e);for(var r=c(t),a=0;a<r.length;a++){for(var o=r[a],s=[1/0,1/0,-(1/0),-(1/0)],l=0;l<o.length;l++){
var u=o[l];s[0]=Math.min(s[0],u.x),s[1]=Math.min(s[1],u.y),s[2]=Math.max(s[2],u.x),s[3]=Math.max(s[3],u.y)}i.grid.insert(n,s[0],s[1],s[2],s[3])}},z.prototype.setCollisionTile=function(t){this.collisionTile=t},z.prototype.serialize=function(t){var e=this.grid.toArrayBuffer();return t&&t.push(e),{coord:this.coord,overscaling:this.overscaling,grid:e,featureIndexArray:this.featureIndexArray.serialize(t),bucketLayerIDs:this.bucketLayerIDs}},z.prototype.query=function(t,e){this.vtLayers||(this.vtLayers=new m.VectorTile(new g(this.rawTileData)).layers,this.sourceLayerCoder=new p(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]));var i={},o=t.params||{},s=u/t.tileSize/t.scale,c=h(o.filter),d=0;for(var f in e){var v=e[f],y=v.paint,b=0;"line"===v.type?b=a(y)/2+Math.abs(y["line-offset"])+n(y["line-translate"]):"fill"===v.type?b=n(y["fill-translate"]):"fill-extrusion"===v.type?b=n(y["fill-extrusion-translate"]):"circle"===v.type&&(b=y["circle-radius"]+n(y["circle-translate"])),d=Math.max(d,b*s)}for(var _=t.queryGeometry.map(function(t){return t.map(function(t){return new l(t.x,t.y)})}),x=1/0,w=1/0,M=-(1/0),z=-(1/0),S=0;S<_.length;S++)for(var E=_[S],k=0;k<E.length;k++){var T=E[k];x=Math.min(x,T.x),w=Math.min(w,T.y),M=Math.max(M,T.x),z=Math.max(z,T.y)}var P=this.grid.query(x-d,w-d,M+d,z+d);P.sort(r),this.filterMatching(i,P,this.featureIndexArray,_,c,o.layers,e,t.bearing,s);var O=this.collisionTile.queryRenderedSymbols(_,t.scale);return O.sort(),this.filterMatching(i,O,this.collisionTile.collisionBoxArray,_,c,o.layers,e,t.bearing,s),i},z.prototype.filterMatching=function(t,e,i,n,r,l,u,h,d){for(var f,p=this,m=0;m<e.length;m++){var g=e[m];if(g!==f){f=g;var b=i.get(g),M=p.bucketLayerIDs[b.bucketIndex];if(!l||y(l,M)){var z=p.sourceLayerCoder.decode(b.sourceLayerIndex),S=p.vtLayers[z],E=S.feature(b.featureIndex);if(r(E))for(var k=null,T=0;T<M.length;T++){var P=M[T];if(!(l&&l.indexOf(P)<0)){var O=u[P];if(O){var A;if("symbol"!==O.type){k||(k=c(E));var I=O.paint;if("line"===O.type){A=o(n,I["line-translate"],I["line-translate-anchor"],h,d);var C=a(I)/2*d;if(I["line-offset"]&&(k=s(k,I["line-offset"]*d)),!w(A,k,C))continue}else if("fill"===O.type||"fill-extrusion"===O.type){var L=O.type;if(A=o(n,I[L+"-translate"],I[L+"-translate-anchor"],h,d),!x(A,k))continue}else if("circle"===O.type){A=o(n,I["circle-translate"],I["circle-translate-anchor"],h,d);var D=I["circle-radius"]*d;if(!_(A,k,D))continue}}var R=new v(E,p.z,p.x,p.y);R.layer=O.serialize();var B=t[P];void 0===B&&(B=t[P]=[]),B.push(R)}}}}}}},e.exports=z},{"../util/dictionary_coder":115,"../util/intersection_tests":122,"../util/struct_array":127,"../util/util":129,"../util/vectortile_to_geojson":130,"./extent":11,"./load_geometry":13,"feature-filter":138,"grid-index":149,pbf:196,"point-geometry":197,"vector-tile":206}],13:[function(t,e,i){"use strict";function n(t){return{min:-1*Math.pow(2,t-1),max:Math.pow(2,t-1)-1}}var r=t("../util/util"),a=t("./extent"),o={15:n(15),16:n(16)};e.exports=function(t,e){for(var i=o[e||16],n=a/t.extent,s=t.loadGeometry(),l=0;l<s.length;l++)for(var c=s[l],u=0;u<c.length;u++){var h=c[u];h.x=Math.round(h.x*n),h.y=Math.round(h.y*n),(h.x<i.min||h.x>i.max||h.y<i.min||h.y>i.max)&&r.warnOnce("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return s}},{"../util/util":129,"./extent":11}],14:[function(t,e,i){"use strict";var n=t("../util/struct_array"),r=n({members:[{name:"a_pos",type:"Int16",components:2}]});e.exports=r},{"../util/struct_array":127}],15:[function(t,e,i){"use strict";function n(t,e,i,n){if(!t.zoomStops)return e.getPaintValue(t.property,i,n);var r=t.zoomStops.map(function(r){return e.getPaintValue(t.property,o.extend({},i,{zoom:r}),n)});return 1===r.length?r[0]:r}function r(t,e){var i=t.property.replace(e.type+"-","").replace(/-/g,"_"),n="color"===e._paintSpecifications[t.property].type;return o.extend({name:"a_"+i,components:n?4:1,multiplier:n?255:1},t)}var a=t("./vertex_array_type"),o=t("../util/util"),s=function(){this.attributes=[],this.uniforms=[],this.interpolationUniforms=[],this.pragmas={vertex:{},fragment:{}},this.cacheKey=""};s.createDynamic=function(t,e,i){for(var n=new s,o=0,l=t;o<l.length;o+=1){var c=l[o],u=r(c,e),h=u.name.slice(2);e.isPaintValueFeatureConstant(u.property)?n.addZoomAttribute(h,u):e.isPaintValueZoomConstant(u.property)?n.addPropertyAttribute(h,u):n.addZoomAndPropertyAttribute(h,u,e,i)}return n.PaintVertexArray=a(n.attributes),n},s.createStatic=function(t){for(var e=new s,i=0,n=t;i<n.length;i+=1){var r=n[i];e.addUniform(r,"u_"+r)}return e},s.prototype.addUniform=function(t,e){var i=this.getPragmas(t);i.define.push("uniform {precision} {type} "+e+";"),i.initialize.push("{precision} {type} "+t+" = "+e+";"),this.cacheKey+="/u_"+t},s.prototype.addZoomAttribute=function(t,e){this.uniforms.push(e),this.addUniform(t,e.name)},s.prototype.addPropertyAttribute=function(t,e){var i=this.getPragmas(t);this.attributes.push(e),i.define.push("varying {precision} {type} "+t+";"),i.vertex.define.push("attribute {precision} {type} "+e.name+";"),i.vertex.initialize.push(t+" = "+e.name+" / "+e.multiplier+".0;"),this.cacheKey+="/a_"+t},s.prototype.addZoomAndPropertyAttribute=function(t,e,i,n){var r=this,a=this.getPragmas(t);a.define.push("varying {precision} {type} "+t+";");for(var s=0,l=i.getPaintValueStopZoomLevels(e.property);s<l.length&&l[s]<n;)s++;var c=Math.max(0,Math.min(l.length-4,s-2)),u="u_"+t+"_t";a.vertex.define.push("uniform lowp float "+u+";"),this.interpolationUniforms.push({name:u,property:e.property,stopOffset:c});for(var h=[],d=0;d<4;d++)h.push(l[Math.min(c+d,l.length-1)]);var f=[];if(1===e.components)this.attributes.push(o.extend({},e,{components:4,zoomStops:h})),a.vertex.define.push("attribute {precision} vec4 "+e.name+";"),f.push(e.name);else for(var p=0;p<4;p++){var m=e.name+p;f.push(m),r.attributes.push(o.extend({},e,{name:m,zoomStops:[h[p]]})),a.vertex.define.push("attribute {precision} {type} "+m+";")}a.vertex.initialize.push(t+" = evaluate_zoom_function_"+e.components+"(            "+f.join(", ")+", "+u+") / "+e.multiplier+".0;"),this.cacheKey+="/z_"+t},s.prototype.getPragmas=function(t){return this.pragmas[t]||(this.pragmas[t]={define:[],initialize:[]},this.pragmas[t].fragment={define:[],initialize:[]},this.pragmas[t].vertex={define:[],initialize:[]}),this.pragmas[t]},s.prototype.applyPragmas=function(t,e){var i=this;return t.replace(/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,function(t,n,r,a,o){return i.pragmas[o][n].concat(i.pragmas[o][e][n]).join("\n").replace(/{type}/g,a).replace(/{precision}/g,r)})},s.prototype.populatePaintArray=function(t,e,i,r,a){var o=e.length;e.resize(i);for(var s=0,l=this.attributes;s<l.length;s+=1)for(var c=l[s],u=n(c,t,r,a),h=o;h<i;h++){var d=e.get(h);if(4===c.components)for(var f=0;f<4;f++)d[c.name+f]=u[f]*c.multiplier;else d[c.name]=u*c.multiplier}},s.prototype.setUniforms=function(t,e,i,n){for(var r=0,a=this.uniforms;r<a.length;r+=1){var o=a[r],s=i.getPaintValue(o.property,n);4===o.components?t.uniform4fv(e[o.name],s):t.uniform1f(e[o.name],s)}for(var l=0,c=this.interpolationUniforms;l<c.length;l+=1){var u=c[l],h=i.getPaintInterpolationT(u.property,n);t.uniform1f(e[u.name],Math.max(0,Math.min(4,h-u.stopOffset)))}},e.exports=s},{"../util/util":129,"./vertex_array_type":17}],16:[function(t,e,i){"use strict";var n=t("../util/struct_array"),r=n({members:[{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]});e.exports=r},{"../util/struct_array":127}],17:[function(t,e,i){"use strict";function n(t){return r({members:t,alignment:4})}var r=t("../util/struct_array");e.exports=n},{"../util/struct_array":127}],18:[function(t,e,i){"use strict";var n=function(t,e,i){this.column=t,this.row=e,this.zoom=i};n.prototype.clone=function(){return new n(this.column,this.row,this.zoom)},n.prototype.zoomTo=function(t){return this.clone()._zoomTo(t)},n.prototype.sub=function(t){return this.clone()._sub(t)},n.prototype._zoomTo=function(t){var e=Math.pow(2,t-this.zoom);return this.column*=e,this.row*=e,this.zoom=t,this},n.prototype._sub=function(t){return t=t.zoomTo(this.zoom),this.column-=t.column,this.row-=t.row,this},e.exports=n},{}],19:[function(t,e,i){"use strict";var n=t("../util/util").wrap,r=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Invalid LngLat object: ("+t+", "+e+")");if(this.lng=+t,this.lat=+e,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};r.prototype.wrap=function(){return new r(n(this.lng,-180,180),this.lat)},r.prototype.toArray=function(){return[this.lng,this.lat]},r.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},r.convert=function(t){if(t instanceof r)return t;if(t&&t.hasOwnProperty("lng")&&t.hasOwnProperty("lat"))return new r(t.lng,t.lat);if(Array.isArray(t)&&2===t.length)return new r(t[0],t[1]);throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")},e.exports=r},{"../util/util":129}],20:[function(t,e,i){"use strict";var n=t("./lng_lat"),r=function(t,e){t&&(e?this.setSouthWest(t).setNorthEast(e):4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))};r.prototype.setNorthEast=function(t){return this._ne=n.convert(t),this},r.prototype.setSouthWest=function(t){return this._sw=n.convert(t),this},r.prototype.extend=function(t){var e,i,a=this._sw,o=this._ne;if(t instanceof n)e=t,i=t;else{if(!(t instanceof r))return Array.isArray(t)?t.every(Array.isArray)?this.extend(r.convert(t)):this.extend(n.convert(t)):this;if(e=t._sw,i=t._ne,!e||!i)return this}return a||o?(a.lng=Math.min(e.lng,a.lng),a.lat=Math.min(e.lat,a.lat),o.lng=Math.max(i.lng,o.lng),o.lat=Math.max(i.lat,o.lat)):(this._sw=new n(e.lng,e.lat),this._ne=new n(i.lng,i.lat)),this},r.prototype.getCenter=function(){return new n((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},r.prototype.getSouthWest=function(){return this._sw},r.prototype.getNorthEast=function(){return this._ne},r.prototype.getNorthWest=function(){return new n(this.getWest(),this.getNorth())},r.prototype.getSouthEast=function(){return new n(this.getEast(),this.getSouth())},r.prototype.getWest=function(){return this._sw.lng},r.prototype.getSouth=function(){return this._sw.lat},r.prototype.getEast=function(){return this._ne.lng},r.prototype.getNorth=function(){return this._ne.lat},r.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},r.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},r.convert=function(t){return!t||t instanceof r?t:new r(t)},e.exports=r},{"./lng_lat":19}],21:[function(t,e,i){"use strict";var n=t("./lng_lat"),r=t("point-geometry"),a=t("./coordinate"),o=t("../util/util"),s=t("../util/interpolate"),l=t("../source/tile_coord"),c=t("../data/extent"),u=t("@mapbox/gl-matrix"),h=u.vec4,d=u.mat4,f=u.mat2,p=function(t,e,i){this.tileSize=512,this._renderWorldCopies=void 0===i||i,this._minZoom=t||0,this._maxZoom=e||22,this.latRange=[-85.05113,85.05113],this.width=0,this.height=0,this._center=new n(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0},m={minZoom:{},maxZoom:{},worldSize:{},centerPoint:{},size:{},bearing:{},pitch:{},fov:{},zoom:{},center:{},unmodified:{},x:{},y:{},point:{}};m.minZoom.get=function(){return this._minZoom},m.minZoom.set=function(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))},m.maxZoom.get=function(){return this._maxZoom},m.maxZoom.set=function(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))},m.worldSize.get=function(){return this.tileSize*this.scale},m.centerPoint.get=function(){return this.size._div(2)},m.size.get=function(){return new r(this.width,this.height)},m.bearing.get=function(){return-this.angle/Math.PI*180},m.bearing.set=function(t){var e=-o.wrap(t,-180,180)*Math.PI/180;this.angle!==e&&(this._unmodified=!1,this.angle=e,this._calcMatrices(),this.rotationMatrix=f.create(),f.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},m.pitch.get=function(){return this._pitch/Math.PI*180},m.pitch.set=function(t){var e=o.clamp(t,0,60)/180*Math.PI;this._pitch!==e&&(this._unmodified=!1,this._pitch=e,this._calcMatrices())},m.fov.get=function(){return this._fov/Math.PI*180},m.fov.set=function(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())},m.zoom.get=function(){return this._zoom},m.zoom.set=function(t){var e=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==e&&(this._unmodified=!1,this._zoom=e,this.scale=this.zoomScale(e),this.tileZoom=Math.floor(e),this.zoomFraction=e-this.tileZoom,this._constrain(),this._calcMatrices())},m.center.get=function(){return this._center},m.center.set=function(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())},p.prototype.coveringZoomLevel=function(t){return(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize))},p.prototype.coveringTiles=function(t){var e=this.coveringZoomLevel(t),i=e;if(e<t.minzoom)return[];e>t.maxzoom&&(e=t.maxzoom);var n=this.pointCoordinate(this.centerPoint,e),a=new r(n.column-.5,n.row-.5),o=[this.pointCoordinate(new r(0,0),e),this.pointCoordinate(new r(this.width,0),e),this.pointCoordinate(new r(this.width,this.height),e),this.pointCoordinate(new r(0,this.height),e)];return l.cover(e,o,t.reparseOverscaled?i:e,this._renderWorldCopies).sort(function(t,e){return a.dist(t)-a.dist(e)})},p.prototype.resize=function(t,e){this.width=t,this.height=e,this.pixelsToGLUnits=[2/t,-2/e],this._constrain(),this._calcMatrices()},m.unmodified.get=function(){return this._unmodified},p.prototype.zoomScale=function(t){return Math.pow(2,t)},p.prototype.scaleZoom=function(t){return Math.log(t)/Math.LN2},p.prototype.project=function(t){return new r(this.lngX(t.lng),this.latY(t.lat))},p.prototype.unproject=function(t){return new n(this.xLng(t.x),this.yLat(t.y))},m.x.get=function(){return this.lngX(this.center.lng)},m.y.get=function(){return this.latY(this.center.lat)},m.point.get=function(){return new r(this.x,this.y)},p.prototype.lngX=function(t){return(180+t)*this.worldSize/360},p.prototype.latY=function(t){var e=180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360));return(180-e)*this.worldSize/360},p.prototype.xLng=function(t){return 360*t/this.worldSize-180},p.prototype.yLat=function(t){var e=180-360*t/this.worldSize;return 360/Math.PI*Math.atan(Math.exp(e*Math.PI/180))-90},p.prototype.setLocationAtPoint=function(t,e){var i=this.pointCoordinate(e)._sub(this.pointCoordinate(this.centerPoint));this.center=this.coordinateLocation(this.locationCoordinate(t)._sub(i))},p.prototype.locationPoint=function(t){return this.coordinatePoint(this.locationCoordinate(t))},p.prototype.pointLocation=function(t){return this.coordinateLocation(this.pointCoordinate(t))},p.prototype.locationCoordinate=function(t){return new a(this.lngX(t.lng)/this.tileSize,this.latY(t.lat)/this.tileSize,this.zoom).zoomTo(this.tileZoom)},p.prototype.coordinateLocation=function(t){var e=t.zoomTo(this.zoom);return new n(this.xLng(e.column*this.tileSize),this.yLat(e.row*this.tileSize))},p.prototype.pointCoordinate=function(t,e){void 0===e&&(e=this.tileZoom);var i=0,n=[t.x,t.y,0,1],r=[t.x,t.y,1,1];h.transformMat4(n,n,this.pixelMatrixInverse),h.transformMat4(r,r,this.pixelMatrixInverse);var o=n[3],l=r[3],c=n[0]/o,u=r[0]/l,d=n[1]/o,f=r[1]/l,p=n[2]/o,m=r[2]/l,g=p===m?0:(i-p)/(m-p);return new a(s(c,u,g)/this.tileSize,s(d,f,g)/this.tileSize,this.zoom)._zoomTo(e)},p.prototype.coordinatePoint=function(t){var e=t.zoomTo(this.zoom),i=[e.column*this.tileSize,e.row*this.tileSize,0,1];return h.transformMat4(i,i,this.pixelMatrix),new r(i[0]/i[3],i[1]/i[3])},p.prototype.calculatePosMatrix=function(t,e){var i=t.toCoordinate(e),n=this.worldSize/this.zoomScale(i.zoom),r=d.identity(new Float64Array(16));return d.translate(r,r,[i.column*n,i.row*n,0]),d.scale(r,r,[n/c,n/c,1]),d.multiply(r,this.projMatrix,r),new Float32Array(r)},p.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var t,e,i,n,a,o,s,l,c=this.size,u=this._unmodified;this.latRange&&(t=this.latY(this.latRange[1]),e=this.latY(this.latRange[0]),a=e-t<c.y?c.y/(e-t):0),this.lngRange&&(i=this.lngX(this.lngRange[0]),n=this.lngX(this.lngRange[1]),o=n-i<c.x?c.x/(n-i):0);var h=Math.max(o||0,a||0);if(h)return this.center=this.unproject(new r(o?(n+i)/2:this.x,a?(e+t)/2:this.y)),this.zoom+=this.scaleZoom(h),this._unmodified=u,void(this._constraining=!1);if(this.latRange){var d=this.y,f=c.y/2;d-f<t&&(l=t+f),d+f>e&&(l=e-f)}if(this.lngRange){var p=this.x,m=c.x/2;p-m<i&&(s=i+m),p+m>n&&(s=n-m)}void 0===s&&void 0===l||(this.center=this.unproject(new r(void 0!==s?s:this.x,void 0!==l?l:this.y))),this._unmodified=u,this._constraining=!1}},p.prototype._calcMatrices=function(){if(this.height){this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var t=this._fov/2,e=Math.PI/2+this._pitch,i=Math.sin(t)*this.cameraToCenterDistance/Math.sin(Math.PI-e-t),n=Math.cos(Math.PI/2-this._pitch)*i+this.cameraToCenterDistance,r=1.01*n,a=new Float64Array(16);d.perspective(a,this._fov,this.width/this.height,1,r),d.scale(a,a,[1,-1,1]),d.translate(a,a,[0,0,-this.cameraToCenterDistance]),d.rotateX(a,a,this._pitch),d.rotateZ(a,a,this.angle),d.translate(a,a,[-this.x,-this.y,0]);var o=this.worldSize/(2*Math.PI*6378137*Math.abs(Math.cos(this.center.lat*(Math.PI/180))));if(d.scale(a,a,[1,1,o,1]),this.projMatrix=a,a=d.create(),d.scale(a,a,[this.width/2,-this.height/2,1]),d.translate(a,a,[1,-1,0]),this.pixelMatrix=d.multiply(new Float64Array(16),a,this.projMatrix),a=d.invert(new Float64Array(16),this.pixelMatrix),!a)throw new Error("failed to invert matrix");this.pixelMatrixInverse=a}},Object.defineProperties(p.prototype,m),e.exports=p},{"../data/extent":11,"../source/tile_coord":53,"../util/interpolate":121,"../util/util":129,"./coordinate":18,"./lng_lat":19,"@mapbox/gl-matrix":133,"point-geometry":197}],22:[function(t,e,i){"use strict";var n,r=t("./util/worker_pool");e.exports=function(){return n||(n=new r),n}},{"./util/worker_pool":132}],23:[function(t,e,i){"use strict";var n={" ":[16,[]],"!":[10,[5,21,5,7,-1,-1,5,2,4,1,5,0,6,1,5,2]],'"':[16,[4,21,4,14,-1,-1,12,21,12,14]],"#":[21,[11,25,4,-7,-1,-1,17,25,10,-7,-1,-1,4,12,18,12,-1,-1,3,6,17,6]],$:[20,[8,25,8,-4,-1,-1,12,25,12,-4,-1,-1,17,18,15,20,12,21,8,21,5,20,3,18,3,16,4,14,5,13,7,12,13,10,15,9,16,8,17,6,17,3,15,1,12,0,8,0,5,1,3,3]],"%":[24,[21,21,3,0,-1,-1,8,21,10,19,10,17,9,15,7,14,5,14,3,16,3,18,4,20,6,21,8,21,10,20,13,19,16,19,19,20,21,21,-1,-1,17,7,15,6,14,4,14,2,16,0,18,0,20,1,21,3,21,5,19,7,17,7]],"&":[26,[23,12,23,13,22,14,21,14,20,13,19,11,17,6,15,3,13,1,11,0,7,0,5,1,4,2,3,4,3,6,4,8,5,9,12,13,13,14,14,16,14,18,13,20,11,21,9,20,8,18,8,16,9,13,11,10,16,3,18,1,20,0,22,0,23,1,23,2]],"'":[10,[5,19,4,20,5,21,6,20,6,18,5,16,4,15]],"(":[14,[11,25,9,23,7,20,5,16,4,11,4,7,5,2,7,-2,9,-5,11,-7]],")":[14,[3,25,5,23,7,20,9,16,10,11,10,7,9,2,7,-2,5,-5,3,-7]],"*":[16,[8,21,8,9,-1,-1,3,18,13,12,-1,-1,13,18,3,12]],"+":[26,[13,18,13,0,-1,-1,4,9,22,9]],",":[10,[6,1,5,0,4,1,5,2,6,1,6,-1,5,-3,4,-4]],"-":[26,[4,9,22,9]],".":[10,[5,2,4,1,5,0,6,1,5,2]],"/":[22,[20,25,2,-7]],0:[20,[9,21,6,20,4,17,3,12,3,9,4,4,6,1,9,0,11,0,14,1,16,4,17,9,17,12,16,17,14,20,11,21,9,21]],1:[20,[6,17,8,18,11,21,11,0]],2:[20,[4,16,4,17,5,19,6,20,8,21,12,21,14,20,15,19,16,17,16,15,15,13,13,10,3,0,17,0]],3:[20,[5,21,16,21,10,13,13,13,15,12,16,11,17,8,17,6,16,3,14,1,11,0,8,0,5,1,4,2,3,4]],4:[20,[13,21,3,7,18,7,-1,-1,13,21,13,0]],5:[20,[15,21,5,21,4,12,5,13,8,14,11,14,14,13,16,11,17,8,17,6,16,3,14,1,11,0,8,0,5,1,4,2,3,4]],6:[20,[16,18,15,20,12,21,10,21,7,20,5,17,4,12,4,7,5,3,7,1,10,0,11,0,14,1,16,3,17,6,17,7,16,10,14,12,11,13,10,13,7,12,5,10,4,7]],7:[20,[17,21,7,0,-1,-1,3,21,17,21]],8:[20,[8,21,5,20,4,18,4,16,5,14,7,13,11,12,14,11,16,9,17,7,17,4,16,2,15,1,12,0,8,0,5,1,4,2,3,4,3,7,4,9,6,11,9,12,13,13,15,14,16,16,16,18,15,20,12,21,8,21]],9:[20,[16,14,15,11,13,9,10,8,9,8,6,9,4,11,3,14,3,15,4,18,6,20,9,21,10,21,13,20,15,18,16,14,16,9,15,4,13,1,10,0,8,0,5,1,4,3]],":":[10,[5,14,4,13,5,12,6,13,5,14,-1,-1,5,2,4,1,5,0,6,1,5,2]],";":[10,[5,14,4,13,5,12,6,13,5,14,-1,-1,6,1,5,0,4,1,5,2,6,1,6,-1,5,-3,4,-4]],"<":[24,[20,18,4,9,20,0]],"=":[26,[4,12,22,12,-1,-1,4,6,22,6]],">":[24,[4,18,20,9,4,0]],"?":[18,[3,16,3,17,4,19,5,20,7,21,11,21,13,20,14,19,15,17,15,15,14,13,13,12,9,10,9,7,-1,-1,9,2,8,1,9,0,10,1,9,2]],"@":[27,[18,13,17,15,15,16,12,16,10,15,9,14,8,11,8,8,9,6,11,5,14,5,16,6,17,8,-1,-1,12,16,10,14,9,11,9,8,10,6,11,5,-1,-1,18,16,17,8,17,6,19,5,21,5,23,7,24,10,24,12,23,15,22,17,20,19,18,20,15,21,12,21,9,20,7,19,5,17,4,15,3,12,3,9,4,6,5,4,7,2,9,1,12,0,15,0,18,1,20,2,21,3,-1,-1,19,16,18,8,18,6,19,5]],A:[18,[9,21,1,0,-1,-1,9,21,17,0,-1,-1,4,7,14,7]],B:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,15,17,13,16,12,13,11,-1,-1,4,11,13,11,16,10,17,9,18,7,18,4,17,2,16,1,13,0,4,0]],C:[21,[18,16,17,18,15,20,13,21,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5]],D:[21,[4,21,4,0,-1,-1,4,21,11,21,14,20,16,18,17,16,18,13,18,8,17,5,16,3,14,1,11,0,4,0]],E:[19,[4,21,4,0,-1,-1,4,21,17,21,-1,-1,4,11,12,11,-1,-1,4,0,17,0]],F:[18,[4,21,4,0,-1,-1,4,21,17,21,-1,-1,4,11,12,11]],G:[21,[18,16,17,18,15,20,13,21,9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,18,8,-1,-1,13,8,18,8]],H:[22,[4,21,4,0,-1,-1,18,21,18,0,-1,-1,4,11,18,11]],I:[8,[4,21,4,0]],J:[16,[12,21,12,5,11,2,10,1,8,0,6,0,4,1,3,2,2,5,2,7]],K:[21,[4,21,4,0,-1,-1,18,21,4,7,-1,-1,9,12,18,0]],L:[17,[4,21,4,0,-1,-1,4,0,16,0]],M:[24,[4,21,4,0,-1,-1,4,21,12,0,-1,-1,20,21,12,0,-1,-1,20,21,20,0]],N:[22,[4,21,4,0,-1,-1,4,21,18,0,-1,-1,18,21,18,0]],O:[22,[9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,19,8,19,13,18,16,17,18,15,20,13,21,9,21]],P:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,14,17,12,16,11,13,10,4,10]],Q:[22,[9,21,7,20,5,18,4,16,3,13,3,8,4,5,5,3,7,1,9,0,13,0,15,1,17,3,18,5,19,8,19,13,18,16,17,18,15,20,13,21,9,21,-1,-1,12,4,18,-2]],R:[21,[4,21,4,0,-1,-1,4,21,13,21,16,20,17,19,18,17,18,15,17,13,16,12,13,11,4,11,-1,-1,11,11,18,0]],S:[20,[17,18,15,20,12,21,8,21,5,20,3,18,3,16,4,14,5,13,7,12,13,10,15,9,16,8,17,6,17,3,15,1,12,0,8,0,5,1,3,3]],T:[16,[8,21,8,0,-1,-1,1,21,15,21]],U:[22,[4,21,4,6,5,3,7,1,10,0,12,0,15,1,17,3,18,6,18,21]],V:[18,[1,21,9,0,-1,-1,17,21,9,0]],W:[24,[2,21,7,0,-1,-1,12,21,7,0,-1,-1,12,21,17,0,-1,-1,22,21,17,0]],X:[20,[3,21,17,0,-1,-1,17,21,3,0]],Y:[18,[1,21,9,11,9,0,-1,-1,17,21,9,11]],Z:[20,[17,21,3,0,-1,-1,3,21,17,21,-1,-1,3,0,17,0]],"[":[14,[4,25,4,-7,-1,-1,5,25,5,-7,-1,-1,4,25,11,25,-1,-1,4,-7,11,-7]],"\\":[14,[0,21,14,-3]],"]":[14,[9,25,9,-7,-1,-1,10,25,10,-7,-1,-1,3,25,10,25,-1,-1,3,-7,10,-7]],"^":[16,[6,15,8,18,10,15,-1,-1,3,12,8,17,13,12,-1,-1,8,17,8,0]],_:[16,[0,-2,16,-2]],"`":[10,[6,21,5,20,4,18,4,16,5,15,6,16,5,17]],a:[19,[15,14,15,0,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],b:[19,[4,21,4,0,-1,-1,4,11,6,13,8,14,11,14,13,13,15,11,16,8,16,6,15,3,13,1,11,0,8,0,6,1,4,3]],c:[18,[15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],d:[19,[15,21,15,0,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],e:[18,[3,8,15,8,15,10,14,12,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],f:[12,[10,21,8,21,6,20,5,17,5,0,-1,-1,2,14,9,14]],g:[19,[15,14,15,-2,14,-5,13,-6,11,-7,8,-7,6,-6,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],h:[19,[4,21,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0]],i:[8,[3,21,4,20,5,21,4,22,3,21,-1,-1,4,14,4,0]],j:[10,[5,21,6,20,7,21,6,22,5,21,-1,-1,6,14,6,-3,5,-6,3,-7,1,-7]],k:[17,[4,21,4,0,-1,-1,14,14,4,4,-1,-1,8,8,15,0]],l:[8,[4,21,4,0]],m:[30,[4,14,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0,-1,-1,15,10,18,13,20,14,23,14,25,13,26,10,26,0]],n:[19,[4,14,4,0,-1,-1,4,10,7,13,9,14,12,14,14,13,15,10,15,0]],o:[19,[8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3,16,6,16,8,15,11,13,13,11,14,8,14]],p:[19,[4,14,4,-7,-1,-1,4,11,6,13,8,14,11,14,13,13,15,11,16,8,16,6,15,3,13,1,11,0,8,0,6,1,4,3]],q:[19,[15,14,15,-7,-1,-1,15,11,13,13,11,14,8,14,6,13,4,11,3,8,3,6,4,3,6,1,8,0,11,0,13,1,15,3]],r:[13,[4,14,4,0,-1,-1,4,8,5,11,7,13,9,14,12,14]],s:[17,[14,11,13,13,10,14,7,14,4,13,3,11,4,9,6,8,11,7,13,6,14,4,14,3,13,1,10,0,7,0,4,1,3,3]],t:[12,[5,21,5,4,6,1,8,0,10,0,-1,-1,2,14,9,14]],u:[19,[4,14,4,4,5,1,7,0,10,0,12,1,15,4,-1,-1,15,14,15,0]],v:[16,[2,14,8,0,-1,-1,14,14,8,0]],w:[22,[3,14,7,0,-1,-1,11,14,7,0,-1,-1,11,14,15,0,-1,-1,19,14,15,0]],x:[17,[3,14,14,0,-1,-1,14,14,3,0]],y:[16,[2,14,8,0,-1,-1,14,14,8,0,6,-4,4,-6,2,-7,1,-7]],z:[17,[14,14,3,0,-1,-1,3,14,14,14,-1,-1,3,0,14,0]],"{":[14,[9,25,7,24,6,23,5,21,5,19,6,17,7,16,8,14,8,12,6,10,-1,-1,7,24,6,22,6,20,7,18,8,17,9,15,9,13,8,11,4,9,8,7,9,5,9,3,8,1,7,0,6,-2,6,-4,7,-6,-1,-1,6,8,8,6,8,4,7,2,6,1,5,-1,5,-3,6,-5,7,-6,9,-7]],"|":[8,[4,25,4,-7]],"}":[14,[5,25,7,24,8,23,9,21,9,19,8,17,7,16,6,14,6,12,8,10,-1,-1,7,24,8,22,8,20,7,18,6,17,5,15,5,13,6,11,10,9,6,7,5,5,5,3,6,1,7,0,8,-2,8,-4,7,-6,-1,-1,8,8,6,6,6,4,7,2,8,1,9,-1,9,-3,8,-5,7,-6,5,-7]],"~":[24,[3,6,3,8,4,11,6,12,8,12,10,11,14,8,16,7,18,7,20,8,21,10,-1,-1,3,8,4,10,6,11,8,11,10,10,14,7,16,6,18,6,20,7,21,10,21,12]]};e.exports=function(t,e,i,r){r=r||1;var a,o,s,l,c,u,h,d,f=[];for(a=0,o=t.length;a<o;a++)if(c=n[t[a]]){for(d=null,s=0,l=c[1].length;s<l;s+=2)c[1][s]===-1&&c[1][s+1]===-1?d=null:(u=e+c[1][s]*r,h=i-c[1][s+1]*r,d&&f.push(d.x,d.y,u,h),d={x:u,y:h});e+=c[0]*r}return f}},{}],24:[function(t,e,i){"use strict";var n=t("./util/browser"),r=e.exports={};r.version=t("../package.json").version,r.workerCount=Math.max(Math.floor(n.hardwareConcurrency/2),1),r.Map=t("./ui/map"),r.NavigationControl=t("./ui/control/navigation_control"),r.GeolocateControl=t("./ui/control/geolocate_control"),r.AttributionControl=t("./ui/control/attribution_control"),r.ScaleControl=t("./ui/control/scale_control"),r.Popup=t("./ui/popup"),r.Marker=t("./ui/marker"),r.Style=t("./style/style"),r.LngLat=t("./geo/lng_lat"),r.LngLatBounds=t("./geo/lng_lat_bounds"),r.Point=t("point-geometry"),r.Evented=t("./util/evented"),r.util=t("./util/util"),r.supported=t("./util/browser").supported;var a=t("./util/ajax");r.util.getJSON=a.getJSON,r.util.getArrayBuffer=a.getArrayBuffer;var o=t("./util/config");r.config=o;var s=t("./source/rtl_text_plugin");r.setRTLTextPlugin=s.setRTLTextPlugin,Object.defineProperty(r,"accessToken",{get:function(){return o.ACCESS_TOKEN},set:function(t){o.ACCESS_TOKEN=t}})},{"../package.json":216,"./geo/lng_lat":19,"./geo/lng_lat_bounds":20,"./source/rtl_text_plugin":49,"./style/style":63,"./ui/control/attribution_control":93,"./ui/control/geolocate_control":94,"./ui/control/navigation_control":95,"./ui/control/scale_control":96,"./ui/map":105,"./ui/marker":106,"./ui/popup":107,"./util/ajax":109,"./util/browser":110,"./util/config":114,"./util/evented":118,"./util/util":129,"point-geometry":197}],25:[function(t,e,i){"use strict";function n(t,e,i){var n=t.gl,a=t.transform,o=a.tileSize,s=i.paint["background-color"],l=i.paint["background-pattern"],c=i.paint["background-opacity"],u=!l&&1===s[3]&&1===c;if(t.isOpaquePass===u){n.disable(n.STENCIL_TEST),t.setDepthSublayer(0);var h;l?(h=t.useProgram("fillPattern",t.basicFillProgramConfiguration),r.prepare(l,t,h),t.tileExtentPatternVAO.bind(n,h,t.tileExtentBuffer)):(h=t.useProgram("fill",t.basicFillProgramConfiguration),n.uniform4fv(h.u_color,s),t.tileExtentVAO.bind(n,h,t.tileExtentBuffer)),n.uniform1f(h.u_opacity,c);for(var d=a.coveringTiles({tileSize:o}),f=0,p=d;f<p.length;f+=1){var m=p[f];l&&r.setTile({coord:m,tileSize:o},t,h),n.uniformMatrix4fv(h.u_matrix,!1,t.transform.calculatePosMatrix(m)),n.drawArrays(n.TRIANGLE_STRIP,0,t.tileExtentBuffer.length)}}}var r=t("./pattern");e.exports=n},{"./pattern":37}],26:[function(t,e,i){"use strict";function n(t,e,i,n){if(!t.isOpaquePass){var a=t.gl;t.setDepthSublayer(0),t.depthMask(!1),a.disable(a.STENCIL_TEST);for(var o=0;o<n.length;o++){var s=n[o],l=e.getTile(s),c=l.getBucket(i);if(c){var u=c.buffers,h=u.layerData[i.id],d=h.programConfiguration,f=t.useProgram("circle",d);d.setUniforms(a,f,i,{zoom:t.transform.zoom}),"map"===i.paint["circle-pitch-scale"]?(a.uniform1i(f.u_scale_with_map,!0),a.uniform2f(f.u_extrude_scale,t.transform.pixelsToGLUnits[0]*t.transform.cameraToCenterDistance,t.transform.pixelsToGLUnits[1]*t.transform.cameraToCenterDistance)):(a.uniform1i(f.u_scale_with_map,!1),a.uniform2fv(f.u_extrude_scale,t.transform.pixelsToGLUnits)),a.uniform1f(f.u_devicepixelratio,r.devicePixelRatio),a.uniformMatrix4fv(f.u_matrix,!1,t.translatePosMatrix(s.posMatrix,l,i.paint["circle-translate"],i.paint["circle-translate-anchor"]));for(var p=0,m=u.segments;p<m.length;p+=1){var g=m[p];g.vaos[i.id].bind(a,f,u.layoutVertexBuffer,u.elementBuffer,h.paintVertexBuffer,g.vertexOffset),a.drawElements(a.TRIANGLES,3*g.primitiveLength,a.UNSIGNED_SHORT,3*g.primitiveOffset*2)}}}}}var r=t("../util/browser");e.exports=n},{"../util/browser":110}],27:[function(t,e,i){"use strict";function n(t,e,i,n){var r=t.gl;r.enable(r.STENCIL_TEST);for(var a=t.useProgram("collisionBox"),o=0;o<n.length;o++){var s=n[o],l=e.getTile(s),c=l.getBucket(i);if(c){var u=c.buffers.collisionBox;if(u){r.uniformMatrix4fv(a.u_matrix,!1,s.posMatrix),t.enableTileClippingMask(s),t.lineWidth(1),r.uniform1f(a.u_scale,Math.pow(2,t.transform.zoom-l.coord.z)),r.uniform1f(a.u_zoom,10*t.transform.zoom),r.uniform1f(a.u_maxzoom,10*(l.coord.z+1));for(var h=0,d=u.segments;h<d.length;h+=1){var f=d[h];f.vaos[i.id].bind(r,a,u.layoutVertexBuffer,u.elementBuffer,null,f.vertexOffset),r.drawElements(r.LINES,2*f.primitiveLength,r.UNSIGNED_SHORT,2*f.primitiveOffset*2)}}}}}e.exports=n},{}],28:[function(t,e,i){"use strict";function n(t,e,i){for(var n=0;n<i.length;n++)r(t,e,i[n])}function r(t,e,i){var n=t.gl;n.disable(n.STENCIL_TEST),t.lineWidth(1*o.devicePixelRatio);var r=i.posMatrix,d=t.useProgram("debug");n.uniformMatrix4fv(d.u_matrix,!1,r),n.uniform4f(d.u_color,1,0,0,1),t.debugVAO.bind(n,d,t.debugBuffer),n.drawArrays(n.LINE_STRIP,0,t.debugBuffer.length);for(var f=a(i.toString(),50,200,5),p=new h,m=0;m<f.length;m+=2)p.emplaceBack(f[m],f[m+1]);var g=c.fromStructArray(p,c.BufferType.VERTEX),v=new u;v.bind(n,d,g),n.uniform4f(d.u_color,1,1,1,1);for(var y=e.getTile(i).tileSize,b=l/(Math.pow(2,t.transform.zoom-i.z)*y),_=[[-1,-1],[-1,1],[1,-1],[1,1]],x=0;x<_.length;x++){var w=_[x];n.uniformMatrix4fv(d.u_matrix,!1,s.translate([],r,[b*w[0],b*w[1],0])),n.drawArrays(n.LINES,0,g.length)}n.uniform4f(d.u_color,0,0,0,1),n.uniformMatrix4fv(d.u_matrix,!1,r),n.drawArrays(n.LINES,0,g.length)}var a=t("../lib/debugtext"),o=t("../util/browser"),s=t("@mapbox/gl-matrix").mat4,l=t("../data/extent"),c=t("../data/buffer"),u=t("./vertex_array_object"),h=t("../data/pos_array");e.exports=n},{"../data/buffer":8,"../data/extent":11,"../data/pos_array":14,"../lib/debugtext":23,"../util/browser":110,"./vertex_array_object":39,"@mapbox/gl-matrix":133}],29:[function(t,e,i){"use strict";function n(t,e,i,n){var s=t.gl;s.enable(s.STENCIL_TEST);var l=!i.paint["fill-pattern"]&&i.isPaintValueFeatureConstant("fill-color")&&i.isPaintValueFeatureConstant("fill-opacity")&&1===i.paint["fill-color"][3]&&1===i.paint["fill-opacity"];t.isOpaquePass===l&&(t.setDepthSublayer(1),r(t,e,i,n,a)),!t.isOpaquePass&&i.paint["fill-antialias"]&&(t.lineWidth(2),t.depthMask(!1),t.setDepthSublayer(i.getPaintProperty("fill-outline-color")?2:0),r(t,e,i,n,o))}function r(t,e,i,n,r){for(var a=!0,o=0,s=n;o<s.length;o+=1){var l=s[o],c=e.getTile(l),u=c.getBucket(i);u&&(t.enableTileClippingMask(l),r(t,e,i,c,l,u.buffers,a),a=!1)}}function a(t,e,i,n,r,a,o){for(var l=t.gl,c=a.layerData[i.id],u=s("fill",i.paint["fill-pattern"],t,c,i,n,r,o),h=0,d=a.segments;h<d.length;h+=1){var f=d[h];f.vaos[i.id].bind(l,u,a.layoutVertexBuffer,a.elementBuffer,c.paintVertexBuffer,f.vertexOffset),l.drawElements(l.TRIANGLES,3*f.primitiveLength,l.UNSIGNED_SHORT,3*f.primitiveOffset*2);
}}function o(t,e,i,n,r,a,o){var l=t.gl,c=a.layerData[i.id],u=i.paint["fill-pattern"]&&!i.getPaintProperty("fill-outline-color"),h=s("fillOutline",u,t,c,i,n,r,o);l.uniform2f(h.u_world,l.drawingBufferWidth,l.drawingBufferHeight);for(var d=0,f=a.segments2;d<f.length;d+=1){var p=f[d];p.vaos[i.id].bind(l,h,a.layoutVertexBuffer,a.elementBuffer2,c.paintVertexBuffer,p.vertexOffset),l.drawElements(l.LINES,2*p.primitiveLength,l.UNSIGNED_SHORT,2*p.primitiveOffset*2)}}function s(t,e,i,n,r,a,o,s){var c,u=i.currentProgram;return e?(c=i.useProgram(t+"Pattern",n.programConfiguration),(s||c!==u)&&(n.programConfiguration.setUniforms(i.gl,c,r,{zoom:i.transform.zoom}),l.prepare(r.paint["fill-pattern"],i,c)),l.setTile(a,i,c)):(c=i.useProgram(t,n.programConfiguration),(s||c!==u)&&n.programConfiguration.setUniforms(i.gl,c,r,{zoom:i.transform.zoom})),i.gl.uniformMatrix4fv(c.u_matrix,!1,i.translatePosMatrix(o.posMatrix,a,r.paint["fill-translate"],r.paint["fill-translate-anchor"])),c}var l=t("./pattern");e.exports=n},{"./pattern":37}],30:[function(t,e,i){"use strict";function n(t,e,i,n){if(0!==i.paint["fill-extrusion-opacity"]){var o=t.gl;o.disable(o.STENCIL_TEST),o.enable(o.DEPTH_TEST),t.depthMask(!0);var s=new r(o,t,i);s.bindFramebuffer(),o.clearColor(0,0,0,0),o.clear(o.COLOR_BUFFER_BIT|o.DEPTH_BUFFER_BIT);for(var l=0;l<n.length;l++)a(t,e,i,n[l]);s.unbindFramebuffer(),s.renderToMap()}}function r(t,e,i){this.gl=t,this.width=e.width,this.height=e.height,this.painter=e,this.layer=i,this.texture=null,this.fbo=null,this.fbos=this.painter.preFbos[this.width]&&this.painter.preFbos[this.width][this.height]}function a(t,e,i,n){if(!t.isOpaquePass){var r=e.getTile(n),a=r.getBucket(i);if(a){var s=a.buffers,l=t.gl,c=i.paint["fill-extrusion-pattern"],u=s.layerData[i.id],d=u.programConfiguration,f=t.useProgram(c?"fillExtrusionPattern":"fillExtrusion",d);d.setUniforms(l,f,i,{zoom:t.transform.zoom}),c&&(h.prepare(c,t,f),h.setTile(r,t,f),l.uniform1f(f.u_height_factor,-Math.pow(2,n.z)/r.tileSize/8)),t.gl.uniformMatrix4fv(f.u_matrix,!1,t.translatePosMatrix(n.posMatrix,r,i.paint["fill-extrusion-translate"],i.paint["fill-extrusion-translate-anchor"])),o(f,t);for(var p=0,m=s.segments;p<m.length;p+=1){var g=m[p];g.vaos[i.id].bind(l,f,s.layoutVertexBuffer,s.elementBuffer,u.paintVertexBuffer,g.vertexOffset),l.drawElements(l.TRIANGLES,3*g.primitiveLength,l.UNSIGNED_SHORT,3*g.primitiveOffset*2)}}}}function o(t,e){var i=e.gl,n=e.style.light,r=n.calculated.position,a=[r.x,r.y,r.z],o=d.create();"viewport"===n.calculated.anchor&&d.fromRotation(o,-e.transform.angle),p.transformMat3(a,a,o),i.uniform3fv(t.u_lightpos,a),i.uniform1f(t.u_lightintensity,n.calculated.intensity),i.uniform3fv(t.u_lightcolor,n.calculated.color.slice(0,3))}var s=t("@mapbox/gl-matrix"),l=t("../data/buffer"),c=t("./vertex_array_object"),u=t("../data/pos_array"),h=t("./pattern"),d=s.mat3,f=s.mat4,p=s.vec3;e.exports=n,r.prototype.bindFramebuffer=function(){var t=this.gl;if(this.texture=this.painter.getViewportTexture(this.width,this.height),t.activeTexture(t.TEXTURE1),this.texture?t.bindTexture(t.TEXTURE_2D,this.texture):(this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.width,this.height,0,t.RGBA,t.UNSIGNED_BYTE,null),this.texture.width=this.width,this.texture.height=this.height),this.fbos)this.fbo=this.fbos.pop(),t.bindFramebuffer(t.FRAMEBUFFER,this.fbo),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.texture,0);else{this.fbo=t.createFramebuffer();var e=t.createRenderbuffer(),i=t.createRenderbuffer();t.bindRenderbuffer(t.RENDERBUFFER,e),t.bindRenderbuffer(t.RENDERBUFFER,i),t.renderbufferStorage(t.RENDERBUFFER,t.RGBA4,this.width,this.height),t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_COMPONENT16,this.width,this.height),t.bindFramebuffer(t.FRAMEBUFFER,this.fbo),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,e),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,i),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.texture,0)}},r.prototype.unbindFramebuffer=function(){this.painter.bindDefaultFramebuffer(),this.fbos?this.fbos.push(this.fbo):(this.painter.preFbos[this.width]||(this.painter.preFbos[this.width]={}),this.painter.preFbos[this.width][this.height]=[this.fbo]),this.painter.saveViewportTexture(this.texture)},r.prototype.renderToMap=function(){var t=this.gl,e=this.painter,i=e.useProgram("extrusionTexture");t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,this.texture),t.uniform1f(i.u_opacity,this.layer.paint["fill-extrusion-opacity"]),t.uniform1i(i.u_texture,1),t.uniformMatrix4fv(i.u_matrix,!1,f.ortho(f.create(),0,e.width,e.height,0,0,1)),t.disable(t.DEPTH_TEST),t.uniform1i(i.u_xdim,e.width),t.uniform1i(i.u_ydim,e.height);var n=new u;n.emplaceBack(0,0),n.emplaceBack(e.width,0),n.emplaceBack(0,e.height),n.emplaceBack(e.width,e.height);var r=l.fromStructArray(n,l.BufferType.VERTEX),a=new c;a.bind(t,i,r),t.drawArrays(t.TRIANGLE_STRIP,0,4),t.enable(t.DEPTH_TEST)}},{"../data/buffer":8,"../data/pos_array":14,"./pattern":37,"./vertex_array_object":39,"@mapbox/gl-matrix":133}],31:[function(t,e,i){"use strict";function n(t,e,i,n,o,s,l,c,u){var h,d,f,p,m=e.gl,g=o.paint["line-dasharray"],v=o.paint["line-pattern"];if(c||u){var y=1/a(i,1,e.transform.tileZoom);if(g){h=e.lineAtlas.getDash(g.from,"round"===o.layout["line-cap"]),d=e.lineAtlas.getDash(g.to,"round"===o.layout["line-cap"]);var b=h.width*g.fromScale,_=d.width*g.toScale;m.uniform2f(t.u_patternscale_a,y/b,-h.height/2),m.uniform2f(t.u_patternscale_b,y/_,-d.height/2),m.uniform1f(t.u_sdfgamma,e.lineAtlas.width/(256*Math.min(b,_)*r.devicePixelRatio)/2)}else if(v){if(f=e.spriteAtlas.getPosition(v.from,!0),p=e.spriteAtlas.getPosition(v.to,!0),!f||!p)return;m.uniform2f(t.u_pattern_size_a,f.size[0]*v.fromScale/y,p.size[1]),m.uniform2f(t.u_pattern_size_b,p.size[0]*v.toScale/y,p.size[1])}m.uniform2f(t.u_gl_units_to_pixels,1/e.transform.pixelsToGLUnits[0],1/e.transform.pixelsToGLUnits[1])}c&&(g?(m.uniform1i(t.u_image,0),m.activeTexture(m.TEXTURE0),e.lineAtlas.bind(m),m.uniform1f(t.u_tex_y_a,h.y),m.uniform1f(t.u_tex_y_b,d.y),m.uniform1f(t.u_mix,g.t)):v&&(m.uniform1i(t.u_image,0),m.activeTexture(m.TEXTURE0),e.spriteAtlas.bind(m,!0),m.uniform2fv(t.u_pattern_tl_a,f.tl),m.uniform2fv(t.u_pattern_br_a,f.br),m.uniform2fv(t.u_pattern_tl_b,p.tl),m.uniform2fv(t.u_pattern_br_b,p.br),m.uniform1f(t.u_fade,v.t)),m.uniform1f(t.u_width,o.paint["line-width"])),e.enableTileClippingMask(s);var x=e.translatePosMatrix(s.posMatrix,i,o.paint["line-translate"],o.paint["line-translate-anchor"]);m.uniformMatrix4fv(t.u_matrix,!1,x),m.uniform1f(t.u_ratio,1/a(i,1,e.transform.zoom));for(var w=0,M=n.segments;w<M.length;w+=1){var z=M[w];z.vaos[o.id].bind(m,t,n.layoutVertexBuffer,n.elementBuffer,l.paintVertexBuffer,z.vertexOffset),m.drawElements(m.TRIANGLES,3*z.primitiveLength,m.UNSIGNED_SHORT,3*z.primitiveOffset*2)}}var r=t("../util/browser"),a=t("../source/pixels_to_tile_units");e.exports=function(t,e,i,r){if(!t.isOpaquePass){t.setDepthSublayer(0),t.depthMask(!1);var a=t.gl;if(a.enable(a.STENCIL_TEST),!(i.paint["line-width"]<=0))for(var o,s=i.paint["line-dasharray"]?"lineSDF":i.paint["line-pattern"]?"linePattern":"line",l=!0,c=0,u=r;c<u.length;c+=1){var h=u[c],d=e.getTile(h),f=d.getBucket(i);if(f){var p=f.buffers.layerData[i.id],m=t.currentProgram,g=t.useProgram(s,p.programConfiguration),v=l||g!==m,y=o!==d.coord.z;v&&p.programConfiguration.setUniforms(t.gl,g,i,{zoom:t.transform.zoom}),n(g,t,d,f.buffers,i,h,p,v,y),o=d.coord.z,l=!1}}}}},{"../source/pixels_to_tile_units":46,"../util/browser":110}],32:[function(t,e,i){"use strict";function n(t,e,i,n){if(!t.isOpaquePass){var a=t.gl;a.enable(a.DEPTH_TEST),t.depthMask(!0),a.depthFunc(a.LESS);for(var o=n.length&&n[0].z,s=0;s<n.length;s++){var l=n[s];t.setDepthSublayer(l.z-o),r(t,e,i,l)}a.depthFunc(a.LEQUAL)}}function r(t,e,i,n){var r=t.gl;r.disable(r.STENCIL_TEST);var c=e.getTile(n),u=t.transform.calculatePosMatrix(n,e.getSource().maxzoom);c.registerFadeDuration(t.style.animationLoop,i.paint["raster-fade-duration"]);var h=t.useProgram("raster");r.uniformMatrix4fv(h.u_matrix,!1,u),r.uniform1f(h.u_brightness_low,i.paint["raster-brightness-min"]),r.uniform1f(h.u_brightness_high,i.paint["raster-brightness-max"]),r.uniform1f(h.u_saturation_factor,s(i.paint["raster-saturation"])),r.uniform1f(h.u_contrast_factor,o(i.paint["raster-contrast"])),r.uniform3fv(h.u_spin_weights,a(i.paint["raster-hue-rotate"]));var d,f,p=c.sourceCache&&c.sourceCache.findLoadedParent(n,0,{}),m=l(c,p,i,t.transform);r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,c.texture),r.activeTexture(r.TEXTURE1),p?(r.bindTexture(r.TEXTURE_2D,p.texture),d=Math.pow(2,p.coord.z-c.coord.z),f=[c.coord.x*d%1,c.coord.y*d%1]):r.bindTexture(r.TEXTURE_2D,c.texture),r.uniform2fv(h.u_tl_parent,f||[0,0]),r.uniform1f(h.u_scale_parent,d||1),r.uniform1f(h.u_buffer_scale,1),r.uniform1f(h.u_fade_t,m.mix),r.uniform1f(h.u_opacity,m.opacity*i.paint["raster-opacity"]),r.uniform1i(h.u_image0,0),r.uniform1i(h.u_image1,1);var g=c.boundsBuffer||t.rasterBoundsBuffer,v=c.boundsVAO||t.rasterBoundsVAO;v.bind(r,h,g),r.drawArrays(r.TRIANGLE_STRIP,0,g.length)}function a(t){t*=Math.PI/180;var e=Math.sin(t),i=Math.cos(t);return[(2*i+1)/3,(-Math.sqrt(3)*e-i+1)/3,(Math.sqrt(3)*e-i+1)/3]}function o(t){return t>0?1/(1-t):1+t}function s(t){return t>0?1-1/(1.001-t):-t}function l(t,e,i,n){var r=i.paint["raster-fade-duration"];if(t.sourceCache&&r>0){var a=Date.now(),o=(a-t.timeAdded)/r,s=e?(a-e.timeAdded)/r:-1,l=t.sourceCache.getSource(),u=n.coveringZoomLevel({tileSize:l.tileSize,roundZoom:l.roundZoom}),h=!e||Math.abs(e.coord.z-u)>Math.abs(t.coord.z-u),d=c.clamp(h?o:1-s,0,1);return e?{opacity:1,mix:1-d}:{opacity:d,mix:0}}return{opacity:1,mix:0}}var c=t("../util/util");e.exports=n},{"../util/util":129}],33:[function(t,e,i){"use strict";function n(t,e,i,n){if(!t.isOpaquePass){var a=!(i.layout["text-allow-overlap"]||i.layout["icon-allow-overlap"]||i.layout["text-ignore-placement"]||i.layout["icon-ignore-placement"]),o=t.gl;a?o.disable(o.STENCIL_TEST):o.enable(o.STENCIL_TEST),t.setDepthSublayer(0),t.depthMask(!1),r(t,e,i,n,!1,i.paint["icon-translate"],i.paint["icon-translate-anchor"],i.layout["icon-rotation-alignment"],i.layout["icon-rotation-alignment"],i.layout["icon-size"],i.paint["icon-halo-width"],i.paint["icon-halo-color"],i.paint["icon-halo-blur"],i.paint["icon-opacity"],i.paint["icon-color"]),r(t,e,i,n,!0,i.paint["text-translate"],i.paint["text-translate-anchor"],i.layout["text-rotation-alignment"],i.layout["text-pitch-alignment"],i.layout["text-size"],i.paint["text-halo-width"],i.paint["text-halo-color"],i.paint["text-halo-blur"],i.paint["text-opacity"],i.paint["text-color"]),e.map.showCollisionBoxes&&c(t,e,i,n)}}function r(t,e,i,n,r,s,l,c,u,h,d,f,p,m,g){if(r||!t.style.sprite||t.style.sprite.loaded()){var v=t.gl,y="map"===c,b="map"===u,_=b;_?v.enable(v.DEPTH_TEST):v.disable(v.DEPTH_TEST);for(var x,w,M=0,z=n;M<z.length;M+=1){var S=z[M],E=e.getTile(S),k=E.getBucket(i);if(k){var T=r?k.buffers.glyph:k.buffers.icon;if(T&&T.segments.length){var P=r||k.sdfIcons;x&&k.fontstack===w||(x=t.useProgram(P?"symbolSDF":"symbolIcon"),a(x,t,r,P,y,b,k.fontstack,h,k.iconsNeedLinear,r?k.adjustedTextSize:k.adjustedIconSize,m)),t.enableTileClippingMask(S),v.uniformMatrix4fv(x.u_matrix,!1,t.translatePosMatrix(S.posMatrix,E,s,l)),o(x,t,i,E,T,r,P,b,h,d,f,p,g),w=k.fontstack}}}_||v.enable(v.DEPTH_TEST)}}function a(t,e,i,n,r,a,o,s,c,u,h){var d=e.gl,f=e.transform;if(d.uniform1i(t.u_rotate_with_map,r),d.uniform1i(t.u_pitch_with_map,a),d.activeTexture(d.TEXTURE0),d.uniform1i(t.u_texture,0),i){var p=o&&e.glyphSource.getGlyphAtlas(o);if(!p)return;p.updateTexture(d),d.uniform2f(t.u_texsize,p.width/4,p.height/4)}else{var m=e.options.rotating||e.options.zooming,g=1!==s||l.devicePixelRatio!==e.spriteAtlas.pixelRatio||c,v=a||f.pitch;e.spriteAtlas.bind(d,n||m||g||v),d.uniform2f(t.u_texsize,e.spriteAtlas.width/4,e.spriteAtlas.height/4)}d.activeTexture(d.TEXTURE1),e.frameHistory.bind(d),d.uniform1i(t.u_fadetexture,1);var y=Math.log(s/u)/Math.LN2||0;d.uniform1f(t.u_zoom,10*(f.zoom-y)),d.uniform1f(t.u_pitch,f.pitch/360*2*Math.PI),d.uniform1f(t.u_bearing,f.bearing/360*2*Math.PI),d.uniform1f(t.u_aspect_ratio,f.width/f.height),d.uniform1f(t.u_opacity,h)}function o(t,e,i,n,r,a,o,l,c,m,g,v,y){var b=e.gl,_=e.transform,x=c/(a?24:1);if(l){var w=u(n,x,_.zoom);b.uniform2f(t.u_extrude_scale,w,w)}else{var M=_.cameraToCenterDistance*x;b.uniform2f(t.u_extrude_scale,_.pixelsToGLUnits[0]*M,_.pixelsToGLUnits[1]*M)}if(o){var z=x*(l?Math.cos(_._pitch):1)*_.cameraToCenterDistance;m&&(b.uniform1f(t.u_gamma,(v*d/h+p)/z),b.uniform4fv(t.u_color,g),b.uniform1f(t.u_buffer,(f-m/x)/h),s(r,i,b,t)),b.uniform1f(t.u_gamma,p/z),b.uniform4fv(t.u_color,y),b.uniform1f(t.u_buffer,.75)}s(r,i,b,t)}function s(t,e,i,n){for(var r=0,a=t.segments;r<a.length;r+=1){var o=a[r];o.vaos[e.id].bind(i,n,t.layoutVertexBuffer,t.elementBuffer,null,o.vertexOffset),i.drawElements(i.TRIANGLES,3*o.primitiveLength,i.UNSIGNED_SHORT,3*o.primitiveOffset*2)}}var l=t("../util/browser"),c=t("./draw_collision_debug"),u=t("../source/pixels_to_tile_units");e.exports=n;var h=8,d=1.19,f=6,p=.105/l.devicePixelRatio},{"../source/pixels_to_tile_units":46,"../util/browser":110,"./draw_collision_debug":27}],34:[function(t,e,i){"use strict";var n=function(){this.changeTimes=new Float64Array(256),this.changeOpacities=new Uint8Array(256),this.opacities=new Uint8ClampedArray(256),this.array=new Uint8Array(this.opacities.buffer),this.previousZoom=0,this.firstFrame=!0};n.prototype.record=function(t,e,i){var n=this;this.firstFrame&&(t=0,this.firstFrame=!1),e=Math.floor(10*e);var r;if(e<this.previousZoom)for(r=e+1;r<=this.previousZoom;r++)n.changeTimes[r]=t,n.changeOpacities[r]=n.opacities[r];else for(r=e;r>this.previousZoom;r--)n.changeTimes[r]=t,n.changeOpacities[r]=n.opacities[r];for(r=0;r<256;r++){var a=t-n.changeTimes[r],o=255*(i?a/i:1);r<=e?n.opacities[r]=n.changeOpacities[r]+o:n.opacities[r]=n.changeOpacities[r]-o}this.changed=!0,this.previousZoom=e},n.prototype.bind=function(t){this.texture?(t.bindTexture(t.TEXTURE_2D,this.texture),this.changed&&(t.texSubImage2D(t.TEXTURE_2D,0,0,0,256,1,t.ALPHA,t.UNSIGNED_BYTE,this.array),this.changed=!1)):(this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texImage2D(t.TEXTURE_2D,0,t.ALPHA,256,1,0,t.ALPHA,t.UNSIGNED_BYTE,this.array))},e.exports=n},{}],35:[function(t,e,i){"use strict";var n=t("../util/util"),r=function(t,e){this.width=t,this.height=e,this.nextRow=0,this.bytes=4,this.data=new Uint8Array(this.width*this.height*this.bytes),this.positions={}};r.prototype.setSprite=function(t){this.sprite=t},r.prototype.getDash=function(t,e){var i=t.join(",")+e;return this.positions[i]||(this.positions[i]=this.addDash(t,e)),this.positions[i]},r.prototype.addDash=function(t,e){var i=this,r=e?7:0,a=2*r+1,o=128;if(this.nextRow+a>this.height)return n.warnOnce("LineAtlas out of space"),null;for(var s=0,l=0;l<t.length;l++)s+=t[l];for(var c=this.width/s,u=c/2,h=t.length%2===1,d=-r;d<=r;d++)for(var f=i.nextRow+r+d,p=i.width*f,m=h?-t[t.length-1]:0,g=t[0],v=1,y=0;y<this.width;y++){for(;g<y/c;)m=g,g+=t[v],h&&v===t.length-1&&(g+=t[0]),v++;var b,_=Math.abs(y-m*c),x=Math.abs(y-g*c),w=Math.min(_,x),M=v%2===1;if(e){var z=r?d/r*(u+1):0;if(M){var S=u-Math.abs(z);b=Math.sqrt(w*w+S*S)}else b=u-Math.sqrt(w*w+z*z)}else b=(M?1:-1)*w;i.data[3+4*(p+y)]=Math.max(0,Math.min(255,b+o))}var E={y:(this.nextRow+r+.5)/this.height,height:2*r/this.height,width:s};return this.nextRow+=a,this.dirty=!0,E},r.prototype.bind=function(t){this.texture?(t.bindTexture(t.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,t.texSubImage2D(t.TEXTURE_2D,0,0,0,this.width,this.height,t.RGBA,t.UNSIGNED_BYTE,this.data))):(this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.width,this.height,0,t.RGBA,t.UNSIGNED_BYTE,this.data))},e.exports=r},{"../util/util":129}],36:[function(t,e,i){"use strict";var n=t("../util/browser"),r=t("@mapbox/gl-matrix").mat4,a=t("./frame_history"),o=t("../source/source_cache"),s=t("../data/extent"),l=t("../source/pixels_to_tile_units"),c=t("../util/util"),u=t("../data/buffer"),h=t("./vertex_array_object"),d=t("../data/raster_bounds_array"),f=t("../data/pos_array"),p=t("../data/program_configuration"),m=t("./shaders"),g={symbol:t("./draw_symbol"),circle:t("./draw_circle"),line:t("./draw_line"),fill:t("./draw_fill"),"fill-extrusion":t("./draw_fill_extrusion"),raster:t("./draw_raster"),background:t("./draw_background"),debug:t("./draw_debug")},v=function(t,e){this.gl=t,this.transform=e,this.reusableTextures={tiles:{},viewport:null},this.preFbos={},this.frameHistory=new a,this.setup(),this.numSublayers=o.maxUnderzooming+o.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.lineWidthRange=t.getParameter(t.ALIASED_LINE_WIDTH_RANGE),this.basicFillProgramConfiguration=p.createStatic(["color","opacity"]),this.emptyProgramConfiguration=new p};v.prototype.resize=function(t,e){var i=this.gl;this.width=t*n.devicePixelRatio,this.height=e*n.devicePixelRatio,i.viewport(0,0,this.width,this.height)},v.prototype.setup=function(){var t=this.gl;t.verbose=!0,t.enable(t.BLEND),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA),t.enable(t.STENCIL_TEST),t.enable(t.DEPTH_TEST),t.depthFunc(t.LEQUAL),this._depthMask=!1,t.depthMask(!1);var e=new f;e.emplaceBack(0,0),e.emplaceBack(s,0),e.emplaceBack(0,s),e.emplaceBack(s,s),this.tileExtentBuffer=u.fromStructArray(e,u.BufferType.VERTEX),this.tileExtentVAO=new h,this.tileExtentPatternVAO=new h;var i=new f;i.emplaceBack(0,0),i.emplaceBack(s,0),i.emplaceBack(s,s),i.emplaceBack(0,s),i.emplaceBack(0,0),this.debugBuffer=u.fromStructArray(i,u.BufferType.VERTEX),this.debugVAO=new h;var n=new d;n.emplaceBack(0,0,0,0),n.emplaceBack(s,0,32767,0),n.emplaceBack(0,s,0,32767),n.emplaceBack(s,s,32767,32767),this.rasterBoundsBuffer=u.fromStructArray(n,u.BufferType.VERTEX),this.rasterBoundsVAO=new h},v.prototype.clearColor=function(){var t=this.gl;t.clearColor(0,0,0,0),t.clear(t.COLOR_BUFFER_BIT)},v.prototype.clearStencil=function(){var t=this.gl;t.clearStencil(0),t.stencilMask(255),t.clear(t.STENCIL_BUFFER_BIT)},v.prototype.clearDepth=function(){var t=this.gl;t.clearDepth(1),this.depthMask(!0),t.clear(t.DEPTH_BUFFER_BIT)},v.prototype._renderTileClippingMasks=function(t){var e=this,i=this.gl;i.colorMask(!1,!1,!1,!1),this.depthMask(!1),i.disable(i.DEPTH_TEST),i.enable(i.STENCIL_TEST),i.stencilMask(248),i.stencilOp(i.KEEP,i.KEEP,i.REPLACE);var n=1;this._tileClippingMaskIDs={};for(var r=0,a=t;r<a.length;r+=1){var o=a[r],s=e._tileClippingMaskIDs[o.id]=n++<<3;i.stencilFunc(i.ALWAYS,s,248);var l=e.useProgram("fill",e.basicFillProgramConfiguration);i.uniformMatrix4fv(l.u_matrix,!1,o.posMatrix),e.tileExtentVAO.bind(i,l,e.tileExtentBuffer),i.drawArrays(i.TRIANGLE_STRIP,0,e.tileExtentBuffer.length)}i.stencilMask(0),i.colorMask(!0,!0,!0,!0),this.depthMask(!0),i.enable(i.DEPTH_TEST)},v.prototype.enableTileClippingMask=function(t){var e=this.gl;e.stencilFunc(e.EQUAL,this._tileClippingMaskIDs[t.id],248)},v.prototype.prepareBuffers=function(){},v.prototype.bindDefaultFramebuffer=function(){var t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,null)},v.prototype.render=function(t,e){if(this.style=t,this.options=e,this.lineAtlas=t.lineAtlas,this.spriteAtlas=t.spriteAtlas,this.spriteAtlas.setSprite(t.sprite),this.glyphSource=t.glyphSource,this.frameHistory.record(Date.now(),this.transform.zoom,t.getTransition().duration),this.prepareBuffers(),this.clearColor(),this.clearDepth(),this.showOverdrawInspector(e.showOverdrawInspector),this.depthRange=(t._order.length+2)*this.numSublayers*this.depthEpsilon,this.isOpaquePass=!0,this.renderPass(),this.isOpaquePass=!1,this.renderPass(),this.options.showTileBoundaries){var i=this.style.sourceCaches[Object.keys(this.style.sourceCaches)[0]];i&&g.debug(this,i,i.getVisibleCoordinates())}},v.prototype.renderPass=function(){var t,e,i=this,n=this.style._order;this.currentLayer=this.isOpaquePass?n.length-1:0,this.isOpaquePass?this._showOverdrawInspector||this.gl.disable(this.gl.BLEND):this.gl.enable(this.gl.BLEND);for(var r=0;r<n.length;r++){var a=i.style._layers[n[i.currentLayer]];a.source!==(t&&t.id)&&(t=i.style.sourceCaches[a.source],e=[],t&&(t.prepare&&t.prepare(),i.clearStencil(),e=t.getVisibleCoordinates(),t.getSource().isTileClipped&&i._renderTileClippingMasks(e)),i.isOpaquePass||e.reverse()),i.renderLayer(i,t,a,e),i.currentLayer+=i.isOpaquePass?-1:1}},v.prototype.depthMask=function(t){t!==this._depthMask&&(this._depthMask=t,this.gl.depthMask(t))},v.prototype.renderLayer=function(t,e,i,n){i.isHidden(this.transform.zoom)||("background"===i.type||n.length)&&(this.id=i.id,g[i.type](t,e,i,n))},v.prototype.setDepthSublayer=function(t){var e=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon,i=e-1+this.depthRange;this.gl.depthRange(i,e)},v.prototype.translatePosMatrix=function(t,e,i,n){if(!i[0]&&!i[1])return t;if("viewport"===n){var a=Math.sin(-this.transform.angle),o=Math.cos(-this.transform.angle);i=[i[0]*o-i[1]*a,i[0]*a+i[1]*o]}var s=[l(e,i[0],this.transform.zoom),l(e,i[1],this.transform.zoom),0],c=new Float32Array(16);return r.translate(c,t,s),c},v.prototype.saveTileTexture=function(t){var e=this.reusableTextures.tiles[t.size];e?e.push(t):this.reusableTextures.tiles[t.size]=[t]},v.prototype.saveViewportTexture=function(t){this.reusableTextures.viewport=t},v.prototype.getTileTexture=function(t){var e=this.reusableTextures.tiles[t];return e&&e.length>0?e.pop():null},v.prototype.getViewportTexture=function(t,e){var i=this.reusableTextures.viewport;if(i)return i.width===t&&i.height===e?i:(this.gl.deleteTexture(i),void(this.reusableTextures.viewport=null))},v.prototype.lineWidth=function(t){this.gl.lineWidth(c.clamp(t,this.lineWidthRange[0],this.lineWidthRange[1]))},v.prototype.showOverdrawInspector=function(t){if(t||this._showOverdrawInspector){this._showOverdrawInspector=t;var e=this.gl;if(t){e.blendFunc(e.CONSTANT_COLOR,e.ONE);var i=8,n=1/i;e.blendColor(n,n,n,0),e.clearColor(0,0,0,1),e.clear(e.COLOR_BUFFER_BIT)}else e.blendFunc(e.ONE,e.ONE_MINUS_SRC_ALPHA)}},v.prototype.createProgram=function(t,e){var i=this.gl,r=i.createProgram(),a=m[t],o="#define MAPBOX_GL_JS\n#define DEVICE_PIXEL_RATIO "+n.devicePixelRatio.toFixed(1)+"\n";this._showOverdrawInspector&&(o+="#define OVERDRAW_INSPECTOR;\n");var s=i.createShader(i.FRAGMENT_SHADER);i.shaderSource(s,e.applyPragmas(o+m.prelude.fragmentSource+a.fragmentSource,"fragment")),i.compileShader(s),i.attachShader(r,s);var l=i.createShader(i.VERTEX_SHADER);i.shaderSource(l,e.applyPragmas(o+m.prelude.vertexSource+a.vertexSource,"vertex")),i.compileShader(l),i.attachShader(r,l),i.linkProgram(r);for(var c=i.getProgramParameter(r,i.ACTIVE_ATTRIBUTES),u={program:r,numAttributes:c},h=0;h<c;h++){var d=i.getActiveAttrib(r,h);u[d.name]=i.getAttribLocation(r,d.name)}for(var f=i.getProgramParameter(r,i.ACTIVE_UNIFORMS),p=0;p<f;p++){var g=i.getActiveUniform(r,p);u[g.name]=i.getUniformLocation(r,g.name)}return u},v.prototype._createProgramCached=function(t,e){this.cache=this.cache||{};var i=""+t+(e.cacheKey||"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[i]||(this.cache[i]=this.createProgram(t,e)),this.cache[i]},v.prototype.useProgram=function(t,e){var i=this.gl,n=this._createProgramCached(t,e||this.emptyProgramConfiguration);return this.currentProgram!==n&&(i.useProgram(n.program),this.currentProgram=n),n},e.exports=v},{"../data/buffer":8,"../data/extent":11,"../data/pos_array":14,"../data/program_configuration":15,"../data/raster_bounds_array":16,"../source/pixels_to_tile_units":46,"../source/source_cache":51,"../util/browser":110,"../util/util":129,"./draw_background":25,"./draw_circle":26,"./draw_debug":28,"./draw_fill":29,"./draw_fill_extrusion":30,"./draw_line":31,"./draw_raster":32,"./draw_symbol":33,"./frame_history":34,"./shaders":38,"./vertex_array_object":39,"@mapbox/gl-matrix":133}],37:[function(t,e,i){"use strict";var n=t("../source/pixels_to_tile_units");i.prepare=function(t,e,i){var n=e.gl,r=e.spriteAtlas.getPosition(t.from,!0),a=e.spriteAtlas.getPosition(t.to,!0);r&&a&&(n.uniform1i(i.u_image,0),n.uniform2fv(i.u_pattern_tl_a,r.tl),n.uniform2fv(i.u_pattern_br_a,r.br),n.uniform2fv(i.u_pattern_tl_b,a.tl),n.uniform2fv(i.u_pattern_br_b,a.br),n.uniform1f(i.u_mix,t.t),n.uniform2fv(i.u_pattern_size_a,r.size),n.uniform2fv(i.u_pattern_size_b,a.size),n.uniform1f(i.u_scale_a,t.fromScale),n.uniform1f(i.u_scale_b,t.toScale),n.activeTexture(n.TEXTURE0),e.spriteAtlas.bind(n,!0))},i.setTile=function(t,e,i){var r=e.gl;r.uniform1f(i.u_tile_units_to_pixels,1/n(t,1,e.transform.tileZoom));var a=Math.pow(2,t.coord.z),o=t.tileSize*Math.pow(2,e.transform.tileZoom)/a,s=o*(t.coord.x+t.coord.w*a),l=o*t.coord.y;r.uniform2f(i.u_pixel_coord_upper,s>>16,l>>16),r.uniform2f(i.u_pixel_coord_lower,65535&s,65535&l)}},{"../source/pixels_to_tile_units":46}],38:[function(t,e,i){"use strict";t("path");e.exports={prelude:{fragmentSource:"#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif\n",vertexSource:"#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif\n\nfloat evaluate_zoom_function_1(const vec4 values, const float t) {\n    if (t < 1.0) {\n        return mix(values[0], values[1], t);\n    } else if (t < 2.0) {\n        return mix(values[1], values[2], t - 1.0);\n    } else {\n        return mix(values[2], values[3], t - 2.0);\n    }\n}\nvec4 evaluate_zoom_function_4(const vec4 value0, const vec4 value1, const vec4 value2, const vec4 value3, const float t) {\n    if (t < 1.0) {\n        return mix(value0, value1, t);\n    } else if (t < 2.0) {\n        return mix(value1, value2, t - 1.0);\n    } else {\n        return mix(value2, value3, t - 2.0);\n    }\n}\n\n// The offset depends on how many pixels are between the world origin and the edge of the tile:\n// vec2 offset = mod(pixel_coord, size)\n//\n// At high zoom levels there are a ton of pixels between the world origin and the edge of the tile.\n// The glsl spec only guarantees 16 bits of precision for highp floats. We need more than that.\n//\n// The pixel_coord is passed in as two 16 bit values:\n// pixel_coord_upper = floor(pixel_coord / 2^16)\n// pixel_coord_lower = mod(pixel_coord, 2^16)\n//\n// The offset is calculated in a series of steps that should preserve this precision:\nvec2 get_pattern_pos(const vec2 pixel_coord_upper, const vec2 pixel_coord_lower,\n    const vec2 pattern_size, const float tile_units_to_pixels, const vec2 pos) {\n\n    vec2 offset = mod(mod(mod(pixel_coord_upper, pattern_size) * 256.0, pattern_size) * 256.0 + pixel_coord_lower, pattern_size);\n    return (tile_units_to_pixels * pos + offset) / pattern_size;\n}\n"},circle:{fragmentSource:"#pragma mapbox: define lowp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\n\nvarying vec2 v_extrude;\nvarying lowp float v_antialiasblur;\n\nvoid main() {\n    #pragma mapbox: initialize lowp vec4 color\n    #pragma mapbox: initialize mediump float radius\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n    #pragma mapbox: initialize lowp vec4 stroke_color\n    #pragma mapbox: initialize mediump float stroke_width\n    #pragma mapbox: initialize lowp float stroke_opacity\n\n    float extrude_length = length(v_extrude);\n    float antialiased_blur = -max(blur, v_antialiasblur);\n\n    float opacity_t = smoothstep(0.0, antialiased_blur, extrude_length - 1.0);\n\n    float color_t = stroke_width < 0.01 ? 0.0 : smoothstep(\n        antialiased_blur,\n        0.0,\n        extrude_length - radius / (radius + stroke_width)\n    );\n\n    gl_FragColor = opacity_t * mix(color * opacity, stroke_color * stroke_opacity, color_t);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform bool u_scale_with_map;\nuniform vec2 u_extrude_scale;\n\nattribute vec2 a_pos;\n\n#pragma mapbox: define lowp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\n\nvarying vec2 v_extrude;\nvarying lowp float v_antialiasblur;\n\nvoid main(void) {\n    #pragma mapbox: initialize lowp vec4 color\n    #pragma mapbox: initialize mediump float radius\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n    #pragma mapbox: initialize lowp vec4 stroke_color\n    #pragma mapbox: initialize mediump float stroke_width\n    #pragma mapbox: initialize lowp float stroke_opacity\n\n    // unencode the extrusion vector that we snuck into the a_pos vector\n    v_extrude = vec2(mod(a_pos, 2.0) * 2.0 - 1.0);\n\n    vec2 extrude = v_extrude * (radius + stroke_width) * u_extrude_scale;\n    // multiply a_pos by 0.5, since we had it * 2 in order to sneak\n    // in extrusion data\n    gl_Position = u_matrix * vec4(floor(a_pos * 0.5), 0, 1);\n\n    if (u_scale_with_map) {\n        gl_Position.xy += extrude;\n    } else {\n        gl_Position.xy += extrude * gl_Position.w;\n    }\n\n    // This is a minimum blur distance that serves as a faux-antialiasing for\n    // the circle. since blur is a ratio of the circle's size and the intent is\n    // to keep the blur at roughly 1px, the two are inversely related.\n    v_antialiasblur = 1.0 / DEVICE_PIXEL_RATIO / (radius + stroke_width);\n}\n"},collisionBox:{fragmentSource:"uniform float u_zoom;\nuniform float u_maxzoom;\n\nvarying float v_max_zoom;\nvarying float v_placement_zoom;\n\nvoid main() {\n\n    float alpha = 0.5;\n\n    gl_FragColor = vec4(0.0, 1.0, 0.0, 1.0) * alpha;\n\n    if (v_placement_zoom > u_zoom) {\n        gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0) * alpha;\n    }\n\n    if (u_zoom >= v_max_zoom) {\n        gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0) * alpha * 0.25;\n    }\n\n    if (v_placement_zoom >= u_maxzoom) {\n        gl_FragColor = vec4(0.0, 0.0, 1.0, 1.0) * alpha * 0.2;\n    }\n}\n",vertexSource:"attribute vec2 a_pos;\nattribute vec2 a_extrude;\nattribute vec2 a_data;\n\nuniform mat4 u_matrix;\nuniform float u_scale;\n\nvarying float v_max_zoom;\nvarying float v_placement_zoom;\n\nvoid main() {\n    gl_Position = u_matrix * vec4(a_pos + a_extrude / u_scale, 0.0, 1.0);\n\n    v_max_zoom = a_data.x;\n    v_placement_zoom = a_data.y;\n}\n"},debug:{fragmentSource:"uniform lowp vec4 u_color;\n\nvoid main() {\n    gl_FragColor = u_color;\n}\n",vertexSource:"attribute vec2 a_pos;\n\nuniform mat4 u_matrix;\n\nvoid main() {\n    gl_Position = u_matrix * vec4(a_pos, step(32767.0, a_pos.x), 1);\n}\n"},fill:{fragmentSource:"#pragma mapbox: define lowp vec4 color\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize lowp vec4 color\n    #pragma mapbox: initialize lowp float opacity\n\n    gl_FragColor = color * opacity;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",
vertexSource:"attribute vec2 a_pos;\n\nuniform mat4 u_matrix;\n\n#pragma mapbox: define lowp vec4 color\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize lowp vec4 color\n    #pragma mapbox: initialize lowp float opacity\n\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n}\n"},fillOutline:{fragmentSource:"#pragma mapbox: define lowp vec4 outline_color\n#pragma mapbox: define lowp float opacity\n\nvarying vec2 v_pos;\n\nvoid main() {\n    #pragma mapbox: initialize lowp vec4 outline_color\n    #pragma mapbox: initialize lowp float opacity\n\n    float dist = length(v_pos - gl_FragCoord.xy);\n    float alpha = smoothstep(1.0, 0.0, dist);\n    gl_FragColor = outline_color * (alpha * opacity);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"attribute vec2 a_pos;\n\nuniform mat4 u_matrix;\nuniform vec2 u_world;\n\nvarying vec2 v_pos;\n\n#pragma mapbox: define lowp vec4 outline_color\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize lowp vec4 outline_color\n    #pragma mapbox: initialize lowp float opacity\n\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n    v_pos = (gl_Position.xy / gl_Position.w + 1.0) / 2.0 * u_world;\n}\n"},fillOutlinePattern:{fragmentSource:"uniform vec2 u_pattern_tl_a;\nuniform vec2 u_pattern_br_a;\nuniform vec2 u_pattern_tl_b;\nuniform vec2 u_pattern_br_b;\nuniform float u_mix;\n\nuniform sampler2D u_image;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\nvarying vec2 v_pos;\n\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize lowp float opacity\n\n    vec2 imagecoord = mod(v_pos_a, 1.0);\n    vec2 pos = mix(u_pattern_tl_a, u_pattern_br_a, imagecoord);\n    vec4 color1 = texture2D(u_image, pos);\n\n    vec2 imagecoord_b = mod(v_pos_b, 1.0);\n    vec2 pos2 = mix(u_pattern_tl_b, u_pattern_br_b, imagecoord_b);\n    vec4 color2 = texture2D(u_image, pos2);\n\n    // find distance to outline for alpha interpolation\n\n    float dist = length(v_pos - gl_FragCoord.xy);\n    float alpha = smoothstep(1.0, 0.0, dist);\n\n\n    gl_FragColor = mix(color1, color2, u_mix) * alpha * opacity;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec2 u_world;\nuniform vec2 u_pattern_size_a;\nuniform vec2 u_pattern_size_b;\nuniform vec2 u_pixel_coord_upper;\nuniform vec2 u_pixel_coord_lower;\nuniform float u_scale_a;\nuniform float u_scale_b;\nuniform float u_tile_units_to_pixels;\n\nattribute vec2 a_pos;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\nvarying vec2 v_pos;\n\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize lowp float opacity\n\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n\n    v_pos_a = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_a * u_pattern_size_a, u_tile_units_to_pixels, a_pos);\n    v_pos_b = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_b * u_pattern_size_b, u_tile_units_to_pixels, a_pos);\n\n    v_pos = (gl_Position.xy / gl_Position.w + 1.0) / 2.0 * u_world;\n}\n"},fillPattern:{fragmentSource:"uniform vec2 u_pattern_tl_a;\nuniform vec2 u_pattern_br_a;\nuniform vec2 u_pattern_tl_b;\nuniform vec2 u_pattern_br_b;\nuniform float u_mix;\n\nuniform sampler2D u_image;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\n\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize lowp float opacity\n\n    vec2 imagecoord = mod(v_pos_a, 1.0);\n    vec2 pos = mix(u_pattern_tl_a, u_pattern_br_a, imagecoord);\n    vec4 color1 = texture2D(u_image, pos);\n\n    vec2 imagecoord_b = mod(v_pos_b, 1.0);\n    vec2 pos2 = mix(u_pattern_tl_b, u_pattern_br_b, imagecoord_b);\n    vec4 color2 = texture2D(u_image, pos2);\n\n    gl_FragColor = mix(color1, color2, u_mix) * opacity;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec2 u_pattern_size_a;\nuniform vec2 u_pattern_size_b;\nuniform vec2 u_pixel_coord_upper;\nuniform vec2 u_pixel_coord_lower;\nuniform float u_scale_a;\nuniform float u_scale_b;\nuniform float u_tile_units_to_pixels;\n\nattribute vec2 a_pos;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\n\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize lowp float opacity\n\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n\n    v_pos_a = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_a * u_pattern_size_a, u_tile_units_to_pixels, a_pos);\n    v_pos_b = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_b * u_pattern_size_b, u_tile_units_to_pixels, a_pos);\n}\n"},fillExtrusion:{fragmentSource:"varying vec4 v_color;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 color\n\nvoid main() {\n    #pragma mapbox: initialize lowp float base\n    #pragma mapbox: initialize lowp float height\n    #pragma mapbox: initialize lowp vec4 color\n\n    gl_FragColor = v_color;\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec3 u_lightcolor;\nuniform lowp vec3 u_lightpos;\nuniform lowp float u_lightintensity;\nuniform lowp vec4 u_outline_color;\n\nattribute vec2 a_pos;\nattribute vec3 a_normal;\nattribute float a_edgedistance;\n\nvarying vec4 v_color;\n\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n\n#pragma mapbox: define lowp vec4 color\n\nvoid main() {\n    #pragma mapbox: initialize lowp float base\n    #pragma mapbox: initialize lowp float height\n    #pragma mapbox: initialize lowp vec4 color\n\n    float ed = a_edgedistance; // use each attrib in order to not trip a VAO assert\n    float t = mod(a_normal.x, 2.0);\n\n    gl_Position = u_matrix * vec4(a_pos, t > 0.0 ? height : base, 1);\n\n#ifdef OUTLINE\n    color = u_outline_color;\n#endif\n\n    // Relative luminance (how dark/bright is the surface color?)\n    float colorvalue = color.r * 0.2126 + color.g * 0.7152 + color.b * 0.0722;\n\n    v_color = vec4(0.0, 0.0, 0.0, 1.0);\n\n    // Add slight ambient lighting so no extrusions are totally black\n    vec4 ambientlight = vec4(0.03, 0.03, 0.03, 1.0);\n    color += ambientlight;\n\n    // Calculate cos(theta), where theta is the angle between surface normal and diffuse light ray\n    float directional = clamp(dot(a_normal / 16384.0, u_lightpos), 0.0, 1.0);\n\n    // Adjust directional so that\n    // the range of values for highlight/shading is narrower\n    // with lower light intensity\n    // and with lighter/brighter surface colors\n    directional = mix((1.0 - u_lightintensity), max((1.0 - colorvalue + u_lightintensity), 1.0), directional);\n\n    // Add gradient along z axis of side surfaces\n    if (a_normal.y != 0.0) {\n        directional *= clamp((t + base) * pow(height / 150.0, 0.5), mix(0.7, 0.98, 1.0 - u_lightintensity), 1.0);\n    }\n\n    // Assign final color based on surface + ambient light color, diffuse light directional, and light color\n    // with lower bounds adjusted to hue of light\n    // so that shading is tinted with the complementary (opposite) color to the light color\n    v_color.r += clamp(color.r * directional * u_lightcolor.r, mix(0.0, 0.3, 1.0 - u_lightcolor.r), 1.0);\n    v_color.g += clamp(color.g * directional * u_lightcolor.g, mix(0.0, 0.3, 1.0 - u_lightcolor.g), 1.0);\n    v_color.b += clamp(color.b * directional * u_lightcolor.b, mix(0.0, 0.3, 1.0 - u_lightcolor.b), 1.0);\n}\n"},fillExtrusionPattern:{fragmentSource:"uniform vec2 u_pattern_tl_a;\nuniform vec2 u_pattern_br_a;\nuniform vec2 u_pattern_tl_b;\nuniform vec2 u_pattern_br_b;\nuniform float u_mix;\n\nuniform sampler2D u_image;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\nvarying vec4 v_lighting;\n\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n\nvoid main() {\n    #pragma mapbox: initialize lowp float base\n    #pragma mapbox: initialize lowp float height\n\n    vec2 imagecoord = mod(v_pos_a, 1.0);\n    vec2 pos = mix(u_pattern_tl_a, u_pattern_br_a, imagecoord);\n    vec4 color1 = texture2D(u_image, pos);\n\n    vec2 imagecoord_b = mod(v_pos_b, 1.0);\n    vec2 pos2 = mix(u_pattern_tl_b, u_pattern_br_b, imagecoord_b);\n    vec4 color2 = texture2D(u_image, pos2);\n\n    vec4 mixedColor = mix(color1, color2, u_mix);\n\n    gl_FragColor = mixedColor * v_lighting;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec2 u_pattern_size_a;\nuniform vec2 u_pattern_size_b;\nuniform vec2 u_pixel_coord_upper;\nuniform vec2 u_pixel_coord_lower;\nuniform float u_scale_a;\nuniform float u_scale_b;\nuniform float u_tile_units_to_pixels;\nuniform float u_height_factor;\n\nuniform vec3 u_lightcolor;\nuniform lowp vec3 u_lightpos;\nuniform lowp float u_lightintensity;\n\nattribute vec2 a_pos;\nattribute vec3 a_normal;\nattribute float a_edgedistance;\n\nvarying vec2 v_pos_a;\nvarying vec2 v_pos_b;\nvarying vec4 v_lighting;\nvarying float v_directional;\n\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n\nvoid main() {\n    #pragma mapbox: initialize lowp float base\n    #pragma mapbox: initialize lowp float height\n\n    float t = mod(a_normal.x, 2.0);\n    float z = t > 0.0 ? height : base;\n\n    gl_Position = u_matrix * vec4(a_pos, z, 1);\n\n    vec2 pos = a_normal.x == 1.0 && a_normal.y == 0.0 && a_normal.z == 16384.0\n        ? a_pos // extrusion top\n        : vec2(a_edgedistance, z * u_height_factor); // extrusion side\n\n    v_pos_a = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_a * u_pattern_size_a, u_tile_units_to_pixels, pos);\n    v_pos_b = get_pattern_pos(u_pixel_coord_upper, u_pixel_coord_lower, u_scale_b * u_pattern_size_b, u_tile_units_to_pixels, pos);\n\n    v_lighting = vec4(0.0, 0.0, 0.0, 1.0);\n    float directional = clamp(dot(a_normal / 16383.0, u_lightpos), 0.0, 1.0);\n    directional = mix((1.0 - u_lightintensity), max((0.5 + u_lightintensity), 1.0), directional);\n\n    if (a_normal.y != 0.0) {\n        directional *= clamp((t + base) * pow(height / 150.0, 0.5), mix(0.7, 0.98, 1.0 - u_lightintensity), 1.0);\n    }\n\n    v_lighting.rgb += clamp(directional * u_lightcolor, mix(vec3(0.0), vec3(0.3), 1.0 - u_lightcolor), vec3(1.0));\n}\n"},extrusionTexture:{fragmentSource:"uniform sampler2D u_texture;\nuniform float u_opacity;\n\nvarying vec2 v_pos;\n\nvoid main() {\n    gl_FragColor = texture2D(u_texture, v_pos) * u_opacity;\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform int u_xdim;\nuniform int u_ydim;\nattribute vec2 a_pos;\nvarying vec2 v_pos;\n\nvoid main() {\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n\n    v_pos.x = a_pos.x / float(u_xdim);\n    v_pos.y = 1.0 - a_pos.y / float(u_ydim);\n}\n"},line:{fragmentSource:"#pragma mapbox: define lowp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n\nvarying vec2 v_width2;\nvarying vec2 v_normal;\nvarying float v_gamma_scale;\n\nvoid main() {\n    #pragma mapbox: initialize lowp vec4 color\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n\n    // Calculate the distance of the pixel from the line in pixels.\n    float dist = length(v_normal) * v_width2.s;\n\n    // Calculate the antialiasing fade factor. This is either when fading in\n    // the line in case of an offset line (v_width2.t) or when fading out\n    // (v_width2.s)\n    float blur2 = (blur + 1.0 / DEVICE_PIXEL_RATIO) * v_gamma_scale;\n    float alpha = clamp(min(dist - (v_width2.t - blur2), v_width2.s - dist) / blur2, 0.0, 1.0);\n\n    gl_FragColor = color * (alpha * opacity);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"\n\n// the distance over which the line edge fades out.\n// Retina devices need a smaller distance to avoid aliasing.\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\n\n// floor(127 / 2) == 63.0\n// the maximum allowed miter limit is 2.0 at the moment. the extrude normal is\n// stored in a byte (-128..127). we scale regular normals up to length 63, but\n// there are also \"special\" normals that have a bigger length (of up to 126 in\n// this case).\n// #define scale 63.0\n#define scale 0.015873016\n\nattribute vec2 a_pos;\nattribute vec4 a_data;\n\nuniform mat4 u_matrix;\nuniform mediump float u_ratio;\nuniform mediump float u_width;\nuniform vec2 u_gl_units_to_pixels;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying float v_gamma_scale;\n\n#pragma mapbox: define lowp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n\nvoid main() {\n    #pragma mapbox: initialize lowp vec4 color\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n    #pragma mapbox: initialize mediump float gapwidth\n    #pragma mapbox: initialize lowp float offset\n\n    vec2 a_extrude = a_data.xy - 128.0;\n    float a_direction = mod(a_data.z, 4.0) - 1.0;\n\n    // We store the texture normals in the most insignificant bit\n    // transform y so that 0 => -1 and 1 => 1\n    // In the texture normal, x is 0 if the normal points straight up/down and 1 if it's a round cap\n    // y is 1 if the normal points up, and -1 if it points down\n    mediump vec2 normal = mod(a_pos, 2.0);\n    normal.y = sign(normal.y - 0.5);\n    v_normal = normal;\n\n\n    // these transformations used to be applied in the JS and native code bases. \n    // moved them into the shader for clarity and simplicity. \n    gapwidth = gapwidth / 2.0;\n    float width = u_width / 2.0;\n    offset = -1.0 * offset; \n\n    float inset = gapwidth + (gapwidth > 0.0 ? ANTIALIASING : 0.0);\n    float outset = gapwidth + width * (gapwidth > 0.0 ? 2.0 : 1.0) + ANTIALIASING;\n\n    // Scale the extrusion vector down to a normal and then up by the line width\n    // of this vertex.\n    mediump vec2 dist = outset * a_extrude * scale;\n\n    // Calculate the offset when drawing a line that is to the side of the actual line.\n    // We do this by creating a vector that points towards the extrude, but rotate\n    // it when we're drawing round end points (a_direction = -1 or 1) since their\n    // extrude vector points in another direction.\n    mediump float u = 0.5 * a_direction;\n    mediump float t = 1.0 - abs(u);\n    mediump vec2 offset2 = offset * a_extrude * scale * normal.y * mat2(t, -u, u, t);\n\n    // Remove the texture normal bit to get the position\n    vec2 pos = floor(a_pos * 0.5);\n\n    vec4 projected_extrude = u_matrix * vec4(dist / u_ratio, 0.0, 0.0);\n    gl_Position = u_matrix * vec4(pos + offset2 / u_ratio, 0.0, 1.0) + projected_extrude;\n\n    // calculate how much the perspective view squishes or stretches the extrude\n    float extrude_length_without_perspective = length(dist);\n    float extrude_length_with_perspective = length(projected_extrude.xy / gl_Position.w * u_gl_units_to_pixels);\n    v_gamma_scale = extrude_length_without_perspective / extrude_length_with_perspective;\n\n    v_width2 = vec2(outset, inset);\n}\n"},linePattern:{fragmentSource:"uniform vec2 u_pattern_size_a;\nuniform vec2 u_pattern_size_b;\nuniform vec2 u_pattern_tl_a;\nuniform vec2 u_pattern_br_a;\nuniform vec2 u_pattern_tl_b;\nuniform vec2 u_pattern_br_b;\nuniform float u_fade;\n\nuniform sampler2D u_image;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying float v_linesofar;\nvarying float v_gamma_scale;\n\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n\n    // Calculate the distance of the pixel from the line in pixels.\n    float dist = length(v_normal) * v_width2.s;\n\n    // Calculate the antialiasing fade factor. This is either when fading in\n    // the line in case of an offset line (v_width2.t) or when fading out\n    // (v_width2.s)\n    float blur2 = (blur + 1.0 / DEVICE_PIXEL_RATIO) * v_gamma_scale;\n    float alpha = clamp(min(dist - (v_width2.t - blur2), v_width2.s - dist) / blur2, 0.0, 1.0);\n\n    float x_a = mod(v_linesofar / u_pattern_size_a.x, 1.0);\n    float x_b = mod(v_linesofar / u_pattern_size_b.x, 1.0);\n    float y_a = 0.5 + (v_normal.y * v_width2.s / u_pattern_size_a.y);\n    float y_b = 0.5 + (v_normal.y * v_width2.s / u_pattern_size_b.y);\n    vec2 pos_a = mix(u_pattern_tl_a, u_pattern_br_a, vec2(x_a, y_a));\n    vec2 pos_b = mix(u_pattern_tl_b, u_pattern_br_b, vec2(x_b, y_b));\n\n    vec4 color = mix(texture2D(u_image, pos_a), texture2D(u_image, pos_b), u_fade);\n\n    gl_FragColor = color * alpha * opacity;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"// floor(127 / 2) == 63.0\n// the maximum allowed miter limit is 2.0 at the moment. the extrude normal is\n// stored in a byte (-128..127). we scale regular normals up to length 63, but\n// there are also \"special\" normals that have a bigger length (of up to 126 in\n// this case).\n// #define scale 63.0\n#define scale 0.015873016\n\n// We scale the distance before adding it to the buffers so that we can store\n// long distances for long segments. Use this value to unscale the distance.\n#define LINE_DISTANCE_SCALE 2.0\n\n// the distance over which the line edge fades out.\n// Retina devices need a smaller distance to avoid aliasing.\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\n\nattribute vec2 a_pos;\nattribute vec4 a_data;\n\nuniform mat4 u_matrix;\nuniform mediump float u_ratio;\nuniform mediump float u_width;\nuniform vec2 u_gl_units_to_pixels;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying float v_linesofar;\nvarying float v_gamma_scale;\n\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n\nvoid main() {\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n    #pragma mapbox: initialize lowp float offset\n    #pragma mapbox: initialize mediump float gapwidth\n\n    vec2 a_extrude = a_data.xy - 128.0;\n    float a_direction = mod(a_data.z, 4.0) - 1.0;\n    float a_linesofar = (floor(a_data.z / 4.0) + a_data.w * 64.0) * LINE_DISTANCE_SCALE;\n\n    // We store the texture normals in the most insignificant bit\n    // transform y so that 0 => -1 and 1 => 1\n    // In the texture normal, x is 0 if the normal points straight up/down and 1 if it's a round cap\n    // y is 1 if the normal points up, and -1 if it points down\n    mediump vec2 normal = mod(a_pos, 2.0);\n    normal.y = sign(normal.y - 0.5);\n    v_normal = normal;\n\n    // these transformations used to be applied in the JS and native code bases. \n    // moved them into the shader for clarity and simplicity. \n    gapwidth = gapwidth / 2.0;\n    float width = u_width / 2.0;\n    offset = -1.0 * offset; \n\n    float inset = gapwidth + (gapwidth > 0.0 ? ANTIALIASING : 0.0);\n    float outset = gapwidth + width * (gapwidth > 0.0 ? 2.0 : 1.0) + ANTIALIASING;\n\n    // Scale the extrusion vector down to a normal and then up by the line width\n    // of this vertex.\n    mediump vec2 dist = outset * a_extrude * scale;\n\n    // Calculate the offset when drawing a line that is to the side of the actual line.\n    // We do this by creating a vector that points towards the extrude, but rotate\n    // it when we're drawing round end points (a_direction = -1 or 1) since their\n    // extrude vector points in another direction.\n    mediump float u = 0.5 * a_direction;\n    mediump float t = 1.0 - abs(u);\n    mediump vec2 offset2 = offset * a_extrude * scale * normal.y * mat2(t, -u, u, t);\n\n    // Remove the texture normal bit to get the position\n    vec2 pos = floor(a_pos * 0.5);\n\n    vec4 projected_extrude = u_matrix * vec4(dist / u_ratio, 0.0, 0.0);\n    gl_Position = u_matrix * vec4(pos + offset2 / u_ratio, 0.0, 1.0) + projected_extrude;\n\n    // calculate how much the perspective view squishes or stretches the extrude\n    float extrude_length_without_perspective = length(dist);\n    float extrude_length_with_perspective = length(projected_extrude.xy / gl_Position.w * u_gl_units_to_pixels);\n    v_gamma_scale = extrude_length_without_perspective / extrude_length_with_perspective;\n\n    v_linesofar = a_linesofar;\n    v_width2 = vec2(outset, inset);\n}\n"},lineSDF:{fragmentSource:"\nuniform sampler2D u_image;\nuniform float u_sdfgamma;\nuniform float u_mix;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying vec2 v_tex_a;\nvarying vec2 v_tex_b;\nvarying float v_gamma_scale;\n\n#pragma mapbox: define lowp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n\nvoid main() {\n    #pragma mapbox: initialize lowp vec4 color\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n\n    // Calculate the distance of the pixel from the line in pixels.\n    float dist = length(v_normal) * v_width2.s;\n\n    // Calculate the antialiasing fade factor. This is either when fading in\n    // the line in case of an offset line (v_width2.t) or when fading out\n    // (v_width2.s)\n    float blur2 = (blur + 1.0 / DEVICE_PIXEL_RATIO) * v_gamma_scale;\n    float alpha = clamp(min(dist - (v_width2.t - blur2), v_width2.s - dist) / blur2, 0.0, 1.0);\n\n    float sdfdist_a = texture2D(u_image, v_tex_a).a;\n    float sdfdist_b = texture2D(u_image, v_tex_b).a;\n    float sdfdist = mix(sdfdist_a, sdfdist_b, u_mix);\n    alpha *= smoothstep(0.5 - u_sdfgamma, 0.5 + u_sdfgamma, sdfdist);\n\n    gl_FragColor = color * (alpha * opacity);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"// floor(127 / 2) == 63.0\n// the maximum allowed miter limit is 2.0 at the moment. the extrude normal is\n// stored in a byte (-128..127). we scale regular normals up to length 63, but\n// there are also \"special\" normals that have a bigger length (of up to 126 in\n// this case).\n// #define scale 63.0\n#define scale 0.015873016\n\n// We scale the distance before adding it to the buffers so that we can store\n// long distances for long segments. Use this value to unscale the distance.\n#define LINE_DISTANCE_SCALE 2.0\n\n// the distance over which the line edge fades out.\n// Retina devices need a smaller distance to avoid aliasing.\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\n\nattribute vec2 a_pos;\nattribute vec4 a_data;\n\nuniform mat4 u_matrix;\nuniform mediump float u_ratio;\nuniform vec2 u_patternscale_a;\nuniform float u_tex_y_a;\nuniform vec2 u_patternscale_b;\nuniform float u_tex_y_b;\nuniform vec2 u_gl_units_to_pixels;\nuniform mediump float u_width;\n\nvarying vec2 v_normal;\nvarying vec2 v_width2;\nvarying vec2 v_tex_a;\nvarying vec2 v_tex_b;\nvarying float v_gamma_scale;\n\n#pragma mapbox: define lowp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n\nvoid main() {\n    #pragma mapbox: initialize lowp vec4 color\n    #pragma mapbox: initialize lowp float blur\n    #pragma mapbox: initialize lowp float opacity\n    #pragma mapbox: initialize mediump float gapwidth\n    #pragma mapbox: initialize lowp float offset\n\n    vec2 a_extrude = a_data.xy - 128.0;\n    float a_direction = mod(a_data.z, 4.0) - 1.0;\n    float a_linesofar = (floor(a_data.z / 4.0) + a_data.w * 64.0) * LINE_DISTANCE_SCALE;\n\n    // We store the texture normals in the most insignificant bit\n    // transform y so that 0 => -1 and 1 => 1\n    // In the texture normal, x is 0 if the normal points straight up/down and 1 if it's a round cap\n    // y is 1 if the normal points up, and -1 if it points down\n    mediump vec2 normal = mod(a_pos, 2.0);\n    normal.y = sign(normal.y - 0.5);\n    v_normal = normal;\n\n    // these transformations used to be applied in the JS and native code bases. \n    // moved them into the shader for clarity and simplicity. \n    gapwidth = gapwidth / 2.0;\n    float width = u_width / 2.0;\n    offset = -1.0 * offset;\n \n    float inset = gapwidth + (gapwidth > 0.0 ? ANTIALIASING : 0.0);\n    float outset = gapwidth + width * (gapwidth > 0.0 ? 2.0 : 1.0) + ANTIALIASING;\n\n    // Scale the extrusion vector down to a normal and then up by the line width\n    // of this vertex.\n    mediump vec2 dist =outset * a_extrude * scale;\n\n    // Calculate the offset when drawing a line that is to the side of the actual line.\n    // We do this by creating a vector that points towards the extrude, but rotate\n    // it when we're drawing round end points (a_direction = -1 or 1) since their\n    // extrude vector points in another direction.\n    mediump float u = 0.5 * a_direction;\n    mediump float t = 1.0 - abs(u);\n    mediump vec2 offset2 = offset * a_extrude * scale * normal.y * mat2(t, -u, u, t);\n\n    // Remove the texture normal bit to get the position\n    vec2 pos = floor(a_pos * 0.5);\n\n    vec4 projected_extrude = u_matrix * vec4(dist / u_ratio, 0.0, 0.0);\n    gl_Position = u_matrix * vec4(pos + offset2 / u_ratio, 0.0, 1.0) + projected_extrude;\n\n    // calculate how much the perspective view squishes or stretches the extrude\n    float extrude_length_without_perspective = length(dist);\n    float extrude_length_with_perspective = length(projected_extrude.xy / gl_Position.w * u_gl_units_to_pixels);\n    v_gamma_scale = extrude_length_without_perspective / extrude_length_with_perspective;\n\n    v_tex_a = vec2(a_linesofar * u_patternscale_a.x, normal.y * u_patternscale_a.y + u_tex_y_a);\n    v_tex_b = vec2(a_linesofar * u_patternscale_b.x, normal.y * u_patternscale_b.y + u_tex_y_b);\n\n    v_width2 = vec2(outset, inset);\n}\n"},raster:{fragmentSource:"uniform float u_fade_t;\nuniform float u_opacity;\nuniform sampler2D u_image0;\nuniform sampler2D u_image1;\nvarying vec2 v_pos0;\nvarying vec2 v_pos1;\n\nuniform float u_brightness_low;\nuniform float u_brightness_high;\n\nuniform float u_saturation_factor;\nuniform float u_contrast_factor;\nuniform vec3 u_spin_weights;\n\nvoid main() {\n\n    // read and cross-fade colors from the main and parent tiles\n    vec4 color0 = texture2D(u_image0, v_pos0);\n    vec4 color1 = texture2D(u_image1, v_pos1);\n    vec4 color = mix(color0, color1, u_fade_t);\n    color.a *= u_opacity;\n    vec3 rgb = color.rgb;\n\n    // spin\n    rgb = vec3(\n        dot(rgb, u_spin_weights.xyz),\n        dot(rgb, u_spin_weights.zxy),\n        dot(rgb, u_spin_weights.yzx));\n\n    // saturation\n    float average = (color.r + color.g + color.b) / 3.0;\n    rgb += (average - rgb) * u_saturation_factor;\n\n    // contrast\n    rgb = (rgb - 0.5) * u_contrast_factor + 0.5;\n\n    // brightness\n    vec3 u_high_vec = vec3(u_brightness_low, u_brightness_low, u_brightness_low);\n    vec3 u_low_vec = vec3(u_brightness_high, u_brightness_high, u_brightness_high);\n\n    gl_FragColor = vec4(mix(u_high_vec, u_low_vec, rgb) * color.a, color.a);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"uniform mat4 u_matrix;\nuniform vec2 u_tl_parent;\nuniform float u_scale_parent;\nuniform float u_buffer_scale;\n\nattribute vec2 a_pos;\nattribute vec2 a_texture_pos;\n\nvarying vec2 v_pos0;\nvarying vec2 v_pos1;\n\nvoid main() {\n    gl_Position = u_matrix * vec4(a_pos, 0, 1);\n    v_pos0 = (((a_texture_pos / 32767.0) - 0.5) / u_buffer_scale ) + 0.5;\n    v_pos1 = (v_pos0 * u_scale_parent) + u_tl_parent;\n}\n"},symbolIcon:{fragmentSource:"uniform sampler2D u_texture;\nuniform sampler2D u_fadetexture;\nuniform lowp float u_opacity;\n\nvarying vec2 v_tex;\nvarying vec2 v_fade_tex;\n\nvoid main() {\n    lowp float alpha = texture2D(u_fadetexture, v_fade_tex).a * u_opacity;\n    gl_FragColor = texture2D(u_texture, v_tex) * alpha;\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"attribute vec2 a_pos;\nattribute vec2 a_offset;\nattribute vec2 a_texture_pos;\nattribute vec4 a_data;\n\n\n// matrix is for the vertex position.\nuniform mat4 u_matrix;\n\nuniform mediump float u_zoom;\nuniform bool u_rotate_with_map;\nuniform vec2 u_extrude_scale;\n\nuniform vec2 u_texsize;\n\nvarying vec2 v_tex;\nvarying vec2 v_fade_tex;\n\nvoid main() {\n    vec2 a_tex = a_texture_pos.xy;\n    mediump float a_labelminzoom = a_data[0];\n    mediump vec2 a_zoom = a_data.pq;\n    mediump float a_minzoom = a_zoom[0];\n    mediump float a_maxzoom = a_zoom[1];\n\n    // u_zoom is the current zoom level adjusted for the change in font size\n    mediump float z = 2.0 - step(a_minzoom, u_zoom) - (1.0 - step(a_maxzoom, u_zoom));\n\n    vec2 extrude = u_extrude_scale * (a_offset / 64.0);\n    if (u_rotate_with_map) {\n        gl_Position = u_matrix * vec4(a_pos + extrude, 0, 1);\n        gl_Position.z += z * gl_Position.w;\n    } else {\n        gl_Position = u_matrix * vec4(a_pos, 0, 1) + vec4(extrude, 0, 0);\n    }\n\n    v_tex = a_tex / u_texsize;\n    v_fade_tex = vec2(a_labelminzoom / 255.0, 0.0);\n}\n"},symbolSDF:{fragmentSource:"uniform sampler2D u_texture;\nuniform sampler2D u_fadetexture;\nuniform lowp vec4 u_color;\nuniform lowp float u_opacity;\nuniform lowp float u_buffer;\nuniform lowp float u_gamma;\n\nvarying vec2 v_tex;\nvarying vec2 v_fade_tex;\nvarying float v_gamma_scale;\n\nvoid main() {\n    lowp float dist = texture2D(u_texture, v_tex).a;\n    lowp float fade_alpha = texture2D(u_fadetexture, v_fade_tex).a;\n    lowp float gamma = u_gamma * v_gamma_scale;\n    lowp float alpha = smoothstep(u_buffer - gamma, u_buffer + gamma, dist) * fade_alpha;\n\n    gl_FragColor = u_color * (alpha * u_opacity);\n\n#ifdef OVERDRAW_INSPECTOR\n    gl_FragColor = vec4(1.0);\n#endif\n}\n",vertexSource:"const float PI = 3.141592653589793;\n\nattribute vec2 a_pos;\nattribute vec2 a_offset;\nattribute vec2 a_texture_pos;\nattribute vec4 a_data;\n\n\n// matrix is for the vertex position.\nuniform mat4 u_matrix;\n\nuniform mediump float u_zoom;\nuniform bool u_rotate_with_map;\nuniform bool u_pitch_with_map;\nuniform mediump float u_pitch;\nuniform mediump float u_bearing;\nuniform mediump float u_aspect_ratio;\nuniform vec2 u_extrude_scale;\n\nuniform vec2 u_texsize;\n\nvarying vec2 v_tex;\nvarying vec2 v_fade_tex;\nvarying float v_gamma_scale;\n\nvoid main() {\n    vec2 a_tex = a_texture_pos.xy;\n    mediump float a_labelminzoom = a_data[0];\n    mediump vec2 a_zoom = a_data.pq;\n    mediump float a_minzoom = a_zoom[0];\n    mediump float a_maxzoom = a_zoom[1];\n\n    // u_zoom is the current zoom level adjusted for the change in font size\n    mediump float z = 2.0 - step(a_minzoom, u_zoom) - (1.0 - step(a_maxzoom, u_zoom));\n\n    // pitch-alignment: map\n    // rotation-alignment: map | viewport\n    if (u_pitch_with_map) {\n        lowp float angle = u_rotate_with_map ? (a_data[1] / 256.0 * 2.0 * PI) : u_bearing;\n        lowp float asin = sin(angle);\n        lowp float acos = cos(angle);\n        mat2 RotationMatrix = mat2(acos, asin, -1.0 * asin, acos);\n        vec2 offset = RotationMatrix * a_offset;\n        vec2 extrude = u_extrude_scale * (offset / 64.0);\n        gl_Position = u_matrix * vec4(a_pos + extrude, 0, 1);\n        gl_Position.z += z * gl_Position.w;\n    // pitch-alignment: viewport\n    // rotation-alignment: map\n    } else if (u_rotate_with_map) {\n        // foreshortening factor to apply on pitched maps\n        // as a label goes from horizontal <=> vertical in angle\n        // it goes from 0% foreshortening to up to around 70% foreshortening\n        lowp float pitchfactor = 1.0 - cos(u_pitch * sin(u_pitch * 0.75));\n\n        lowp float lineangle = a_data[1] / 256.0 * 2.0 * PI;\n\n        // use the lineangle to position points a,b along the line\n        // project the points and calculate the label angle in projected space\n        // this calculation allows labels to be rendered unskewed on pitched maps\n        vec4 a = u_matrix * vec4(a_pos, 0, 1);\n        vec4 b = u_matrix * vec4(a_pos + vec2(cos(lineangle),sin(lineangle)), 0, 1);\n        lowp float angle = atan((b[1]/b[3] - a[1]/a[3])/u_aspect_ratio, b[0]/b[3] - a[0]/a[3]);\n        lowp float asin = sin(angle);\n        lowp float acos = cos(angle);\n        mat2 RotationMatrix = mat2(acos, -1.0 * asin, asin, acos);\n\n        vec2 offset = RotationMatrix * (vec2((1.0-pitchfactor)+(pitchfactor*cos(angle*2.0)), 1.0) * a_offset);\n        vec2 extrude = u_extrude_scale * (offset / 64.0);\n        gl_Position = u_matrix * vec4(a_pos, 0, 1) + vec4(extrude, 0, 0);\n        gl_Position.z += z * gl_Position.w;\n    // pitch-alignment: viewport\n    // rotation-alignment: viewport\n    } else {\n        vec2 extrude = u_extrude_scale * (a_offset / 64.0);\n        gl_Position = u_matrix * vec4(a_pos, 0, 1) + vec4(extrude, 0, 0);\n    }\n\n    v_gamma_scale = gl_Position.w;\n\n    v_tex = a_tex / u_texsize;\n    v_fade_tex = vec2(a_labelminzoom / 255.0, 0.0);\n}\n"
}}},{path:194}],39:[function(t,e,i){"use strict";var n=function(){this.boundProgram=null,this.boundVertexBuffer=null,this.boundVertexBuffer2=null,this.boundElementBuffer=null,this.boundVertexOffset=null,this.vao=null};n.prototype.bind=function(t,e,i,n,r,a){void 0===t.extVertexArrayObject&&(t.extVertexArrayObject=t.getExtension("OES_vertex_array_object"));var o=!this.vao||this.boundProgram!==e||this.boundVertexBuffer!==i||this.boundVertexBuffer2!==r||this.boundElementBuffer!==n||this.boundVertexOffset!==a;!t.extVertexArrayObject||o?(this.freshBind(t,e,i,n,r,a),this.gl=t):t.extVertexArrayObject.bindVertexArrayOES(this.vao)},n.prototype.freshBind=function(t,e,i,n,r,a){var o,s=e.numAttributes;if(t.extVertexArrayObject)this.vao&&this.destroy(),this.vao=t.extVertexArrayObject.createVertexArrayOES(),t.extVertexArrayObject.bindVertexArrayOES(this.vao),o=0,this.boundProgram=e,this.boundVertexBuffer=i,this.boundVertexBuffer2=r,this.boundElementBuffer=n,this.boundVertexOffset=a;else{o=t.currentNumAttributes||0;for(var l=s;l<o;l++)t.disableVertexAttribArray(l)}for(var c=o;c<s;c++)t.enableVertexAttribArray(c);i.bind(t),i.setVertexAttribPointers(t,e,a),r&&(r.bind(t),r.setVertexAttribPointers(t,e,a)),n&&n.bind(t),t.currentNumAttributes=s},n.prototype.destroy=function(){this.vao&&(this.gl.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)},e.exports=n},{}],40:[function(t,e,i){"use strict";var n=t("./image_source"),r=t("../util/window"),a=function(t){function e(e,i,n,r){t.call(this,e,i,n,r),this.options=i,this.animate=!i.hasOwnProperty("animate")||i.animate}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.load=function(){if(this.canvas=this.canvas||r.document.getElementById(this.options.canvas),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions(this.canvas))return this.fire("error",new Error("Canvas dimensions cannot be less than or equal to zero."));var t;this.play=function(){t=this.map.style.animationLoop.set(1/0),this.map._rerender()},this.pause=function(){this.map.style.animationLoop.cancel(t)},this._finishLoading()},e.prototype.getCanvas=function(){return this.canvas},e.prototype.onAdd=function(t){this.map||(this.map=t,this.load(),this.canvas&&(this.animate&&this.play(),this.setCoordinates(this.coordinates)))},e.prototype.prepare=function(){var t=!1;this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||this.tile&&this._prepareImage(this.map.painter.gl,this.canvas,t)},e.prototype.serialize=function(){return{type:"canvas",canvas:this.canvas,coordinates:this.coordinates}},e.prototype._hasInvalidDimensions=function(){for(var t=0,e=[this.canvas.width,this.canvas.height];t<e.length;t+=1){var i=e[t];if(isNaN(i)||i<=0)return!0}return!1},e}(n);e.exports=a},{"../util/window":112,"./image_source":44}],41:[function(t,e,i){"use strict";function n(t){var e=o.document.createElement("a");return e.href=t,e.href}var r=t("../util/evented"),a=t("../util/util"),o=t("../util/window"),s=t("../data/extent"),l=function(t){function e(e,i,n,r){t.call(this),i=i||{},this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this.dispatcher=n,this.setEventedParent(r),this._data=i.data,void 0!==i.maxzoom&&(this.maxzoom=i.maxzoom),i.type&&(this.type=i.type);var o=s/this.tileSize;this.workerOptions=a.extend({source:this.id,cluster:i.cluster||!1,geojsonVtOptions:{buffer:(void 0!==i.buffer?i.buffer:128)*o,tolerance:(void 0!==i.tolerance?i.tolerance:.375)*o,extent:s,maxZoom:this.maxzoom},superclusterOptions:{maxZoom:Math.min(i.clusterMaxZoom,this.maxzoom-1)||this.maxzoom-1,extent:s,radius:(i.clusterRadius||50)*o,log:!1}},i.workerOptions)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.load=function(){var t=this;this.fire("dataloading",{dataType:"source"}),this._updateWorkerData(function(e){return e?void t.fire("error",{error:e}):(t.fire("data",{dataType:"source"}),void t.fire("source.load"))})},e.prototype.onAdd=function(t){this.load(),this.map=t},e.prototype.setData=function(t){var e=this;return this._data=t,this.fire("dataloading",{dataType:"source"}),this._updateWorkerData(function(t){return t?e.fire("error",{error:t}):void e.fire("data",{dataType:"source"})}),this},e.prototype._updateWorkerData=function(t){var e=this,i=a.extend({},this.workerOptions),r=this._data;"string"==typeof r?i.url=n(r):i.data=JSON.stringify(r),this.workerID=this.dispatcher.send(this.type+".loadData",i,function(i){e._loaded=!0,t(i)})},e.prototype.loadTile=function(t,e){var i=this,n=t.coord.z>this.maxzoom?Math.pow(2,t.coord.z-this.maxzoom):1,r={type:this.type,uid:t.uid,coord:t.coord,zoom:t.coord.z,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,overscaling:n,angle:this.map.transform.angle,pitch:this.map.transform.pitch,showCollisionBoxes:this.map.showCollisionBoxes};t.workerID=this.dispatcher.send("loadTile",r,function(n,r){if(t.unloadVectorData(),!t.aborted)return n?e(n):(t.loadVectorData(r,i.map.painter),t.redoWhenDone&&(t.redoWhenDone=!1,t.redoPlacement(i)),e(null))},this.workerID)},e.prototype.abortTile=function(t){t.aborted=!0},e.prototype.unloadTile=function(t){t.unloadVectorData(),this.dispatcher.send("removeTile",{uid:t.uid,type:this.type,source:this.id},function(){},t.workerID)},e.prototype.onRemove=function(){this.dispatcher.broadcast("removeSource",{type:this.type,source:this.id},function(){})},e.prototype.serialize=function(){return{type:this.type,data:this._data}},e}(r);e.exports=l},{"../data/extent":11,"../util/evented":118,"../util/util":129,"../util/window":112}],42:[function(t,e,i){"use strict";var n=t("../util/ajax"),r=t("geojson-rewind"),a=t("./geojson_wrapper"),o=t("vt-pbf"),s=t("supercluster"),l=t("geojson-vt"),c=t("./vector_tile_worker_source"),u=function(t){function e(e,i,n){t.call(this,e,i),n&&(this.loadGeoJSON=n),this._geoJSONIndexes={}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.loadVectorData=function(t,e){var i=t.source,n=t.coord;if(!this._geoJSONIndexes[i])return e(null,null);var r=this._geoJSONIndexes[i].getTile(Math.min(n.z,t.maxZoom),n.x,n.y);if(!r)return e(null,null);var s=new a(r.features);s.name="_geojsonTileLayer";var l=o({layers:{_geojsonTileLayer:s}});0===l.byteOffset&&l.byteLength===l.buffer.byteLength||(l=new Uint8Array(l)),s.rawData=l.buffer,e(null,s)},e.prototype.loadData=function(t,e){var i=function(i,n){var a=this;return i?e(i):"object"!=typeof n?e(new Error("Input data is not a valid GeoJSON object.")):(r(n,!0),void this._indexData(n,t,function(i,n){return i?e(i):(a._geoJSONIndexes[t.source]=n,void e(null))}))}.bind(this);this.loadGeoJSON(t,i)},e.prototype.loadGeoJSON=function(t,e){if(t.url)n.getJSON(t.url,e);else{if("string"!=typeof t.data)return e(new Error("Input data is not a valid GeoJSON object."));try{return e(null,JSON.parse(t.data))}catch(t){return e(new Error("Input data is not a valid GeoJSON object."))}}},e.prototype.removeSource=function(t){this._geoJSONIndexes[t.source]&&delete this._geoJSONIndexes[t.source]},e.prototype._indexData=function(t,e,i){try{e.cluster?i(null,s(e.superclusterOptions).load(t.features)):i(null,l(t,e.geojsonVtOptions))}catch(t){return i(t)}},e}(c);e.exports=u},{"../util/ajax":109,"./geojson_wrapper":43,"./vector_tile_worker_source":55,"geojson-rewind":140,"geojson-vt":144,supercluster:201,"vt-pbf":210}],43:[function(t,e,i){"use strict";var n=t("point-geometry"),r=t("vector-tile").VectorTileFeature,a=t("../data/extent"),o=function(t){var e=this;if(this.type=t.type,1===t.type){this.rawGeometry=[];for(var i=0;i<t.geometry.length;i++)e.rawGeometry.push([t.geometry[i]])}else this.rawGeometry=t.geometry;this.properties=t.tags,this.extent=a};o.prototype.loadGeometry=function(){var t=this,e=this.rawGeometry;this.geometry=[];for(var i=0;i<e.length;i++){for(var r=e[i],a=[],o=0;o<r.length;o++)a.push(new n(r[o][0],r[o][1]));t.geometry.push(a)}return this.geometry},o.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var t=this.geometry,e=1/0,i=-(1/0),n=1/0,r=-(1/0),a=0;a<t.length;a++)for(var o=t[a],s=0;s<o.length;s++){var l=o[s];e=Math.min(e,l.x),i=Math.max(i,l.x),n=Math.min(n,l.y),r=Math.max(r,l.y)}return[e,n,i,r]},o.prototype.toGeoJSON=function(){r.prototype.toGeoJSON.call(this)};var s=function(t){this.features=t,this.length=t.length,this.extent=a};s.prototype.feature=function(t){return new o(this.features[t])},e.exports=s},{"../data/extent":11,"point-geometry":197,"vector-tile":206}],44:[function(t,e,i){"use strict";var n=t("../util/util"),r=t("../util/window"),a=t("./tile_coord"),o=t("../geo/lng_lat"),s=t("point-geometry"),l=t("../util/evented"),c=t("../util/ajax"),u=t("../data/extent"),h=t("../data/raster_bounds_array"),d=t("../data/buffer"),f=t("../render/vertex_array_object"),p=function(t){function e(e,i,n,r){t.call(this),this.id=e,this.dispatcher=n,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.setEventedParent(r),this.options=i}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.load=function(){var t=this;this.fire("dataloading",{dataType:"source"}),this.url=this.options.url,c.getImage(this.options.url,function(e,i){return e?t.fire("error",{error:e}):(t.image=i,void t._finishLoading())})},e.prototype._finishLoading=function(){this.fire("source.load"),this.map&&this.setCoordinates(this.coordinates)},e.prototype.onAdd=function(t){this.load(),this.map=t,this.image&&this.setCoordinates(this.coordinates)},e.prototype.setCoordinates=function(t){this.coordinates=t;var e=this.map,i=t.map(function(t){return e.transform.locationCoordinate(o.convert(t)).zoomTo(0)}),r=this.centerCoord=n.getCoordinatesCenter(i);return r.column=Math.round(r.column),r.row=Math.round(r.row),this.minzoom=this.maxzoom=r.zoom,this.coord=new a(r.zoom,r.column,r.row),this._tileCoords=i.map(function(t){var e=t.zoomTo(r.zoom);return new s(Math.round((e.column-r.column)*u),Math.round((e.row-r.row)*u))}),this.fire("data",{dataType:"source"}),this},e.prototype._setTile=function(t){this.tile=t;var e=32767,i=new h;i.emplaceBack(this._tileCoords[0].x,this._tileCoords[0].y,0,0),i.emplaceBack(this._tileCoords[1].x,this._tileCoords[1].y,e,0),i.emplaceBack(this._tileCoords[3].x,this._tileCoords[3].y,0,e),i.emplaceBack(this._tileCoords[2].x,this._tileCoords[2].y,e,e),this.tile.buckets={},this.tile.boundsBuffer=d.fromStructArray(i,d.BufferType.VERTEX),this.tile.boundsVAO=new f},e.prototype.prepare=function(){this.tile&&this.image&&this._prepareImage(this.map.painter.gl,this.image)},e.prototype._prepareImage=function(t,e,i){"loaded"!==this.tile.state?(this.tile.state="loaded",this.tile.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.tile.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e)):i?t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e):(e instanceof r.HTMLVideoElement||e instanceof r.ImageData||e instanceof r.HTMLCanvasElement)&&(t.bindTexture(t.TEXTURE_2D,this.tile.texture),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,e))},e.prototype.loadTile=function(t,e){this.coord&&this.coord.toString()===t.coord.toString()?(this._setTile(t),e(null)):(t.state="errored",e(null))},e.prototype.serialize=function(){return{type:"image",urls:this.url,coordinates:this.coordinates}},e}(l);e.exports=p},{"../data/buffer":8,"../data/extent":11,"../data/raster_bounds_array":16,"../geo/lng_lat":19,"../render/vertex_array_object":39,"../util/ajax":109,"../util/evented":118,"../util/util":129,"../util/window":112,"./tile_coord":53,"point-geometry":197}],45:[function(t,e,i){"use strict";var n=t("../util/util"),r=t("../util/ajax"),a=t("../util/browser"),o=t("../util/mapbox").normalizeSourceURL;e.exports=function(t,e){var i=function(t,i){if(t)return e(t);var r=n.pick(i,["tiles","minzoom","maxzoom","attribution"]);i.vector_layers&&(r.vectorLayers=i.vector_layers,r.vectorLayerIds=r.vectorLayers.map(function(t){return t.id})),e(null,r)};t.url?r.getJSON(o(t.url),i):a.frame(i.bind(null,null,t))}},{"../util/ajax":109,"../util/browser":110,"../util/mapbox":125,"../util/util":129}],46:[function(t,e,i){"use strict";var n=t("../data/extent");e.exports=function(t,e,i){return e*(n/(t.tileSize*Math.pow(2,i-t.coord.z)))}},{"../data/extent":11}],47:[function(t,e,i){"use strict";function n(t,e){var i=t.coord,n=e.coord;return i.z-n.z||i.y-n.y||i.w-n.w||i.x-n.x}function r(t){for(var e=t[0]||{},i=1;i<t.length;i++){var n=t[i];for(var r in n){var a=n[r],o=e[r];if(void 0===o)o=e[r]=a;else for(var s=0;s<a.length;s++)o.push(a[s])}}return e}var a=t("./tile_coord");i.rendered=function(t,e,i,a,o,s){var l=t.tilesIn(i);l.sort(n);for(var c=[],u=0;u<l.length;u++){var h=l[u];h.tile.featureIndex&&c.push(h.tile.featureIndex.query({queryGeometry:h.queryGeometry,scale:h.scale,tileSize:h.tile.tileSize,bearing:s,params:a},e))}return r(c)},i.source=function(t,e){for(var i=t.getRenderableIds().map(function(e){return t.getTileByID(e)}),n=[],r={},o=0;o<i.length;o++){var s=i[o],l=new a(Math.min(s.sourceMaxZoom,s.coord.z),s.coord.x,s.coord.y,0).id;r[l]||(r[l]=!0,s.querySourceFeatures(n,e))}return n}},{"./tile_coord":53}],48:[function(t,e,i){"use strict";var n=t("../util/util"),r=t("../util/ajax"),a=t("../util/evented"),o=t("./load_tilejson"),s=t("../util/mapbox").normalizeTileURL,l=function(t){function e(e,i,r,a){t.call(this),this.id=e,this.dispatcher=r,this.setEventedParent(a),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this.options=i,n.extend(this,n.pick(i,["url","scheme","tileSize"]))}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.load=function(){var t=this;this.fire("dataloading",{dataType:"source"}),o(this.options,function(e,i){return e?t.fire("error",e):(n.extend(t,i),t.fire("data",{dataType:"source"}),void t.fire("source.load"))})},e.prototype.onAdd=function(t){this.load(),this.map=t},e.prototype.serialize=function(){return{type:"raster",url:this.url,tileSize:this.tileSize,tiles:this.tiles}},e.prototype.loadTile=function(t,e){function i(i,n){if(delete t.request,t.aborted)return this.state="unloaded",e(null);if(i)return this.state="errored",e(i);t.setExpiryData(n),delete n.cacheControl,delete n.expires;var r=this.map.painter.gl;t.texture=this.map.painter.getTileTexture(n.width),t.texture?(r.bindTexture(r.TEXTURE_2D,t.texture),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,n)):(t.texture=r.createTexture(),r.bindTexture(r.TEXTURE_2D,t.texture),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR_MIPMAP_NEAREST),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,n),t.texture.size=n.width),r.generateMipmap(r.TEXTURE_2D),t.state="loaded",e(null)}var n=s(t.coord.url(this.tiles,null,this.scheme),this.url,this.tileSize);t.request=r.getImage(n,i.bind(this))},e.prototype.abortTile=function(t){t.request&&(t.request.abort(),delete t.request)},e.prototype.unloadTile=function(t){t.texture&&this.map.painter.saveTileTexture(t.texture)},e}(a);e.exports=l},{"../util/ajax":109,"../util/evented":118,"../util/mapbox":125,"../util/util":129,"./load_tilejson":45}],49:[function(t,e,i){"use strict";var n=t("../util/ajax"),r=t("../util/window"),a=[],o=!1,s=null;e.exports.registerForPluginAvailability=function(t){s?t(s):a.push(t)},e.exports.errorCallback=null,e.exports.setRTLTextPlugin=function(t,i){if(o)throw new Error("setRTLTextPlugin cannot be called multiple times.");o=!0,e.exports.errorCallback=i,n.getArrayBuffer(t,function(t,e){if(t)i(t);else{s=r.URL.createObjectURL(new r.Blob([e.data]),{type:"text/javascript"});for(var n=0,o=a;n<o.length;n+=1){var l=o[n];l(s)}}})}},{"../util/ajax":109,"../util/window":112}],50:[function(t,e,i){"use strict";var n=t("../util/util"),r={vector:t("../source/vector_tile_source"),raster:t("../source/raster_tile_source"),geojson:t("../source/geojson_source"),video:t("../source/video_source"),image:t("../source/image_source"),canvas:t("../source/canvas_source")};i.create=function(t,e,i,a){if(e=new r[e.type](t,e,i,a),e.id!==t)throw new Error("Expected Source id to be "+t+" instead of "+e.id);return n.bindAll(["load","abort","unload","serialize","prepare"],e),e},i.getType=function(t){return r[t]},i.setType=function(t,e){r[t]=e}},{"../source/canvas_source":40,"../source/geojson_source":41,"../source/image_source":44,"../source/raster_tile_source":48,"../source/vector_tile_source":54,"../source/video_source":56,"../util/util":129}],51:[function(t,e,i){"use strict";function n(t,e,i){var n=i.zoomTo(Math.min(t.z,e));return{x:(n.column-(t.x+t.w*Math.pow(2,t.z)))*f,y:(n.row-t.y)*f}}function r(t,e){return t%32-e%32}function a(t){return"raster"===t||"image"===t||"video"===t}var o=t("./source"),s=t("./tile"),l=t("../util/evented"),c=t("./tile_coord"),u=t("../util/lru_cache"),h=t("../geo/coordinate"),d=t("../util/util"),f=t("../data/extent"),p=function(t){function e(e,i,n){t.call(this),this.id=e,this.dispatcher=n,this.on("source.load",function(){this._sourceLoaded=!0}),this.on("error",function(){this._sourceErrored=!0}),this.on("data",function(t){this._sourceLoaded&&"source"===t.dataType&&(this.reload(),this.transform&&this.update(this.transform))}),this._source=o.create(e,i,n,this),this._tiles={},this._cache=new u(0,this.unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._isIdRenderable=this._isIdRenderable.bind(this)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.onAdd=function(t){this.map=t,this._source&&this._source.onAdd&&this._source.onAdd(t)},e.prototype.onRemove=function(t){this._source&&this._source.onRemove&&this._source.onRemove(t)},e.prototype.loaded=function(){var t=this;if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;for(var e in this._tiles){var i=t._tiles[e];if("loaded"!==i.state&&"errored"!==i.state)return!1}return!0},e.prototype.getSource=function(){return this._source},e.prototype.loadTile=function(t,e){return this._source.loadTile(t,e)},e.prototype.unloadTile=function(t){if(this._source.unloadTile)return this._source.unloadTile(t)},e.prototype.abortTile=function(t){if(this._source.abortTile)return this._source.abortTile(t)},e.prototype.serialize=function(){return this._source.serialize()},e.prototype.prepare=function(){if(this._sourceLoaded&&this._source.prepare)return this._source.prepare()},e.prototype.getIds=function(){return Object.keys(this._tiles).map(Number).sort(r)},e.prototype.getRenderableIds=function(){return this.getIds().filter(this._isIdRenderable)},e.prototype._isIdRenderable=function(t){return this._tiles[t].hasData()&&!this._coveredTiles[t]},e.prototype.reload=function(){var t=this;this._cache.reset();for(var e in this._tiles)t.reloadTile(e,"reloading")},e.prototype.reloadTile=function(t,e){var i=this._tiles[t];"loading"!==i.state&&(i.state=e),this.loadTile(i,this._tileLoaded.bind(this,i,t))},e.prototype._tileLoaded=function(t,e,i){return i?(t.state="errored",void this._source.fire("error",{tile:t,error:i})):(t.sourceCache=this,t.timeAdded=(new Date).getTime(),this._setTileReloadTimer(e,t),this._source.fire("data",{tile:t,coord:t.coord,dataType:"tile"}),void(this.map&&(this.map.painter.tileExtentVAO.vao=null)))},e.prototype.getTile=function(t){return this.getTileByID(t.id)},e.prototype.getTileByID=function(t){return this._tiles[t]},e.prototype.getZoom=function(t){return t.zoom+t.scaleZoom(t.tileSize/this._source.tileSize)},e.prototype.findLoadedChildren=function(t,e,i){var n=this,r=!1;for(var a in this._tiles){var o=n._tiles[a];if(!(i[a]||!o.hasData()||o.coord.z<=t.z||o.coord.z>e)){var s=Math.pow(2,Math.min(o.coord.z,n._source.maxzoom)-Math.min(t.z,n._source.maxzoom));if(Math.floor(o.coord.x/s)===t.x&&Math.floor(o.coord.y/s)===t.y)for(i[a]=!0,r=!0;o&&o.coord.z-1>t.z;){var l=o.coord.parent(n._source.maxzoom).id;o=n._tiles[l],o&&o.hasData()&&(delete i[a],i[l]=!0)}}}return r},e.prototype.findLoadedParent=function(t,e,i){for(var n=this,r=t.z-1;r>=e;r--){t=t.parent(n._source.maxzoom);var a=n._tiles[t.id];if(a&&a.hasData())return i[t.id]=!0,a;if(n._cache.has(t.id))return i[t.id]=!0,n._cache.get(t.id)}},e.prototype.updateCacheSize=function(t){var e=Math.ceil(t.width/t.tileSize)+1,i=Math.ceil(t.height/t.tileSize)+1,n=e*i,r=5;this._cache.setMaxSize(Math.floor(n*r))},e.prototype.update=function(t){var i=this;if(this._sourceLoaded){var n,r,o,s;this.updateCacheSize(t);var l=(this._source.roundZoom?Math.round:Math.floor)(this.getZoom(t)),u=Math.max(l-e.maxOverzooming,this._source.minzoom),h=Math.max(l+e.maxUnderzooming,this._source.minzoom),f={};this._coveredTiles={};var p;for(p=this.used?this._source.coord?[this._source.coord]:t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}):[],n=0;n<p.length;n++)r=p[n],o=i.addTile(r),f[r.id]=!0,o.hasData()||i.findLoadedChildren(r,h,f)||(s=i.findLoadedParent(r,u,f),s&&i.addTile(s.coord));var m={};if(a(this._source.type))for(var g=Object.keys(f),v=0;v<g.length;v++){var y=g[v];r=c.fromID(y),o=i._tiles[y],o&&("undefined"==typeof o.fadeEndTime||o.fadeEndTime>=Date.now())&&(i.findLoadedChildren(r,h,f)&&(f[y]=!0),s=i.findLoadedParent(r,u,m),s&&i.addTile(s.coord))}var b;for(b in m)f[b]||(i._coveredTiles[b]=!0);for(b in m)f[b]=!0;var _=d.keysDifference(this._tiles,f);for(n=0;n<_.length;n++)i.removeTile(+_[n]);this.transform=t}},e.prototype.addTile=function(t){var e=this._tiles[t.id];if(e)return e;var i=t.wrapped();if(e=this._tiles[i.id],e||(e=this._cache.get(i.id),e&&(e.redoPlacement(this._source),this._cacheTimers[i.id]&&(clearTimeout(this._cacheTimers[i.id]),this._cacheTimers[i.id]=void 0,this._setTileReloadTimer(i.id,e)))),!e){var n=t.z,r=n>this._source.maxzoom?Math.pow(2,n-this._source.maxzoom):1;e=new s(i,this._source.tileSize*r,this._source.maxzoom),this.loadTile(e,this._tileLoaded.bind(this,e,t.id))}return e.uses++,this._tiles[t.id]=e,this._source.fire("dataloading",{tile:e,coord:e.coord,dataType:"tile"}),e},e.prototype._setTileReloadTimer=function(t,e){var i=this,n=e.getExpiry();n&&(this._timers[t]=setTimeout(function(){i.reloadTile(t,"expired"),i._timers[t]=void 0},n-(new Date).getTime()))},e.prototype._setCacheInvalidationTimer=function(t,e){var i=this,n=e.getExpiry();n&&(this._cacheTimers[t]=setTimeout(function(){i._cache.remove(t),i._cacheTimers[t]=void 0},n-(new Date).getTime()))},e.prototype.removeTile=function(t){var e=this._tiles[t];if(e&&(e.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),this._timers[t]=void 0),this._source.fire("data",{tile:e,coord:e.coord,dataType:"tile"}),!(e.uses>0)))if(e.hasData()){var i=e.coord.wrapped().id;this._cache.add(i,e),this._setCacheInvalidationTimer(i,e)}else e.aborted=!0,this.abortTile(e),this.unloadTile(e)},e.prototype.clearTiles=function(){var t=this;for(var e in this._tiles)t.removeTile(e);this._cache.reset()},e.prototype.tilesIn=function(t){for(var e=this,i={},r=this.getIds(),a=1/0,o=1/0,s=-(1/0),l=-(1/0),u=t[0].zoom,d=0;d<t.length;d++){var p=t[d];a=Math.min(a,p.column),o=Math.min(o,p.row),s=Math.max(s,p.column),l=Math.max(l,p.row)}for(var m=0;m<r.length;m++){var g=e._tiles[r[m]],v=c.fromID(r[m]),y=[n(v,g.sourceMaxZoom,new h(a,o,u)),n(v,g.sourceMaxZoom,new h(s,l,u))];if(y[0].x<f&&y[0].y<f&&y[1].x>=0&&y[1].y>=0){for(var b=[],_=0;_<t.length;_++)b.push(n(v,g.sourceMaxZoom,t[_]));var x=i[g.coord.id];void 0===x&&(x=i[g.coord.id]={tile:g,coord:v,queryGeometry:[],scale:Math.pow(2,e.transform.zoom-g.coord.z)}),x.queryGeometry.push(b)}}var w=[];for(var M in i)w.push(i[M]);return w},e.prototype.redoPlacement=function(){for(var t=this,e=this.getIds(),i=0;i<e.length;i++){var n=t.getTileByID(e[i]);n.redoPlacement(t._source)}},e.prototype.getVisibleCoordinates=function(){for(var t=this,e=this.getRenderableIds().map(c.fromID),i=0,n=e;i<n.length;i+=1){var r=n[i];r.posMatrix=t.transform.calculatePosMatrix(r,t._source.maxzoom)}return e},e}(l);p.maxOverzooming=10,p.maxUnderzooming=3,e.exports=p},{"../data/extent":11,"../geo/coordinate":18,"../util/evented":118,"../util/lru_cache":124,"../util/util":129,"./source":50,"./tile":52,"./tile_coord":53}],52:[function(t,e,i){"use strict";var n=t("../util/util"),r=t("../data/bucket"),a=t("../data/feature_index"),o=t("vector-tile"),s=t("pbf"),l=t("../util/vectortile_to_geojson"),c=t("feature-filter"),u=t("../symbol/collision_tile"),h=t("../symbol/collision_box"),d=t("../symbol/symbol_instances"),f=t("../symbol/symbol_quads"),p=function(t,e,i){this.coord=t,this.uid=n.uniqueId(),this.uses=0,this.tileSize=e,this.sourceMaxZoom=i,this.buckets={},this.expires=null,this.cacheControl=null,this.state="loading"};p.prototype.registerFadeDuration=function(t,e){var i=e+this.timeAdded;i<Date.now()||this.fadeEndTime&&i<this.fadeEndTime||(this.fadeEndTime=i,t.set(this.fadeEndTime-Date.now()))},p.prototype.loadVectorData=function(t,e){this.hasData()&&this.unloadVectorData(e),this.state="loaded",t&&(t.rawTileData&&(this.rawTileData=t.rawTileData),this.collisionBoxArray=new h(t.collisionBoxArray),this.collisionTile=new u(t.collisionTile,this.collisionBoxArray),this.symbolInstancesArray=new d(t.symbolInstancesArray),this.symbolQuadsArray=new f(t.symbolQuadsArray),this.featureIndex=new a(t.featureIndex,this.rawTileData,this.collisionTile),this.buckets=r.deserialize(t.buckets,e.style))},p.prototype.reloadSymbolData=function(t,e){var i=this;if("unloaded"!==this.state){this.collisionTile=new u(t.collisionTile,this.collisionBoxArray),this.featureIndex.setCollisionTile(this.collisionTile);for(var a in this.buckets){var o=i.buckets[a];"symbol"===o.layers[0].type&&(o.destroy(),delete i.buckets[a])}n.extend(this.buckets,r.deserialize(t.buckets,e))}},p.prototype.unloadVectorData=function(){var t=this;for(var e in this.buckets)t.buckets[e].destroy();this.buckets={},this.collisionBoxArray=null,this.symbolQuadsArray=null,this.symbolInstancesArray=null,this.collisionTile=null,this.featureIndex=null,this.state="unloaded"},p.prototype.redoPlacement=function(t){var e=this;if("vector"===t.type||"geojson"===t.type)return"loaded"!==this.state?void(this.redoWhenDone=!0):void(this.collisionTile&&(this.state="reloading",t.dispatcher.send("redoPlacement",{type:t.type,uid:this.uid,source:t.id,angle:t.map.transform.angle,pitch:t.map.transform.pitch,showCollisionBoxes:t.map.showCollisionBoxes},function(i,n){e.reloadSymbolData(n,t.map.style),t.fire("data",{tile:e,coord:e.coord,dataType:"tile"}),t.map&&(t.map.painter.tileExtentVAO.vao=null),e.state="loaded",e.redoWhenDone&&(e.redoWhenDone=!1,e.redoPlacement(t))},this.workerID)))},p.prototype.getBucket=function(t){return this.buckets[t.id]},p.prototype.querySourceFeatures=function(t,e){var i=this;if(this.rawTileData){this.vtLayers||(this.vtLayers=new o.VectorTile(new s(this.rawTileData)).layers);var n=this.vtLayers._geojsonTileLayer||this.vtLayers[e.sourceLayer];if(n)for(var r=c(e&&e.filter),a={z:this.coord.z,x:this.coord.x,y:this.coord.y},u=0;u<n.length;u++){var h=n.feature(u);if(r(h)){var d=new l(h,i.coord.z,i.coord.x,i.coord.y);d.tile=a,t.push(d)}}}},p.prototype.hasData=function(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state},p.prototype.setExpiryData=function(t){t.cacheControl&&(this.cacheControl=t.cacheControl),t.expires&&(this.expires=t.expires)},p.prototype.getExpiry=function(){if(this.cacheControl){var t=n.parseCacheControl(this.cacheControl);if(t["max-age"])return this.timeAdded+1e3*t["max-age"]}else if(this.expires)return new Date(this.expires).getTime()},e.exports=p},{"../data/bucket":2,"../data/feature_index":12,"../symbol/collision_box":78,"../symbol/collision_tile":80,"../symbol/symbol_instances":89,"../symbol/symbol_quads":90,"../util/util":129,"../util/vectortile_to_geojson":130,"feature-filter":138,pbf:196,"vector-tile":206}],53:[function(t,e,i){"use strict";function n(t,e){if(t.row>e.row){var i=t;t=e,e=i}return{x0:t.column,y0:t.row,x1:e.column,y1:e.row,dx:e.column-t.column,dy:e.row-t.row}}function r(t,e,i,n,r){var a=Math.max(i,Math.floor(e.y0)),o=Math.min(n,Math.ceil(e.y1));if(t.x0===e.x0&&t.y0===e.y0?t.x0+e.dy/t.dy*t.dx<e.x1:t.x1-e.dy/t.dy*t.dx<e.x0){var s=t;t=e,e=s}for(var l=t.dx/t.dy,c=e.dx/e.dy,u=t.dx>0,h=e.dx<0,d=a;d<o;d++){var f=l*Math.max(0,Math.min(t.dy,d+u-t.y0))+t.x0,p=c*Math.max(0,Math.min(e.dy,d+h-e.y0))+e.x0;r(Math.floor(p),Math.ceil(f),d)}}function a(t,e,i,a,o,s){var l,c=n(t,e),u=n(e,i),h=n(i,t);c.dy>u.dy&&(l=c,c=u,u=l),c.dy>h.dy&&(l=c,c=h,h=l),u.dy>h.dy&&(l=u,u=h,h=l),c.dy&&r(h,c,a,o,s),u.dy&&r(h,u,a,o,s)}function o(t,e,i){for(var n,r="",a=t;a>0;a--)n=1<<a-1,r+=(e&n?1:0)+(i&n?2:0);return r}var s=t("whoots-js"),l=t("../geo/coordinate"),c=function(t,e,i,n){isNaN(n)&&(n=0),this.z=+t,this.x=+e,this.y=+i,this.w=+n,n*=2,n<0&&(n=n*-1-1);var r=1<<this.z;this.id=32*(r*r*n+r*this.y+this.x)+this.z,this.posMatrix=null};c.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y},c.prototype.toCoordinate=function(t){var e=Math.min(this.z,void 0===t?this.z:t),i=Math.pow(2,e),n=this.y,r=this.x+i*this.w;return new l(r,n,e)},c.prototype.url=function(t,e,i){var n=s.getTileBBox(this.x,this.y,this.z),r=o(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",Math.min(this.z,e||this.z)).replace("{x}",this.x).replace("{y}","tms"===i?Math.pow(2,this.z)-this.y-1:this.y).replace("{quadkey}",r).replace("{bbox-epsg-3857}",n)},c.prototype.parent=function(t){return 0===this.z?null:this.z>t?new c(this.z-1,this.x,this.y,this.w):new c(this.z-1,Math.floor(this.x/2),Math.floor(this.y/2),this.w)},c.prototype.wrapped=function(){return new c(this.z,this.x,this.y,0)},c.prototype.children=function(t){if(this.z>=t)return[new c(this.z+1,this.x,this.y,this.w)];var e=this.z+1,i=2*this.x,n=2*this.y;return[new c(e,i,n,this.w),new c(e,i+1,n,this.w),new c(e,i,n+1,this.w),new c(e,i+1,n+1,this.w)]},c.cover=function(t,e,i,n){function r(t,e,r){var a,l,u,h;if(r>=0&&r<=o)for(a=t;a<e;a++)l=Math.floor(a/o),u=(a%o+o)%o,0!==l&&n!==!0||(h=new c(i,u,r,l),s[h.id]=h)}void 0===n&&(n=!0);var o=1<<t,s={};return a(e[0],e[1],e[2],0,o,r),a(e[2],e[3],e[0],0,o,r),Object.keys(s).map(function(t){return s[t]})},c.fromID=function(t){var e=t%32,i=1<<e,n=(t-e)/32,r=n%i,a=(n-r)/i%i,o=Math.floor(n/(i*i));return o%2!==0&&(o=o*-1-1),o/=2,new c(e,r,a,o)},e.exports=c},{"../geo/coordinate":18,"whoots-js":215}],54:[function(t,e,i){"use strict";var n=t("../util/evented"),r=t("../util/util"),a=t("./load_tilejson"),o=t("../util/mapbox").normalizeTileURL,s=function(t){function e(e,i,n,a){if(t.call(this),this.id=e,this.dispatcher=n,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,r.extend(this,r.pick(i,["url","scheme","tileSize"])),this._options=r.extend({type:"vector"},i),512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(a)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.load=function(){var t=this;this.fire("dataloading",{dataType:"source"}),a(this._options,function(e,i){return e?void t.fire("error",e):(r.extend(t,i),t.fire("data",{dataType:"source"}),void t.fire("source.load"))})},e.prototype.onAdd=function(t){this.load(),this.map=t},e.prototype.serialize=function(){return r.extend({},this._options);
},e.prototype.loadTile=function(t,e){function i(i,n){if(!t.aborted){if(i)return e(i);t.setExpiryData(n),t.loadVectorData(n,this.map.painter),t.redoWhenDone&&(t.redoWhenDone=!1,t.redoPlacement(this)),e(null),t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)}}var n=t.coord.z>this.maxzoom?Math.pow(2,t.coord.z-this.maxzoom):1,r={url:o(t.coord.url(this.tiles,this.maxzoom,this.scheme),this.url),uid:t.uid,coord:t.coord,zoom:t.coord.z,tileSize:this.tileSize*n,type:this.type,source:this.id,overscaling:n,angle:this.map.transform.angle,pitch:this.map.transform.pitch,showCollisionBoxes:this.map.showCollisionBoxes};t.workerID&&"expired"!==t.state?"loading"===t.state?t.reloadCallback=e:this.dispatcher.send("reloadTile",r,i.bind(this),t.workerID):t.workerID=this.dispatcher.send("loadTile",r,i.bind(this))},e.prototype.abortTile=function(t){this.dispatcher.send("abortTile",{uid:t.uid,type:this.type,source:this.id},null,t.workerID)},e.prototype.unloadTile=function(t){t.unloadVectorData(),this.dispatcher.send("removeTile",{uid:t.uid,type:this.type,source:this.id},null,t.workerID)},e}(n);e.exports=s},{"../util/evented":118,"../util/mapbox":125,"../util/util":129,"./load_tilejson":45}],55:[function(t,e,i){"use strict";var n=t("../util/ajax"),r=t("vector-tile"),a=t("pbf"),o=t("./worker_tile"),s=t("../util/util"),l=function(t,e,i){this.actor=t,this.layerIndex=e,i&&(this.loadVectorData=i),this.loading={},this.loaded={}};l.prototype.loadTile=function(t,e){function i(t,i){return delete this.loading[n][r],t?e(t):i?(a.vectorTile=i,a.parse(i,this.layerIndex,this.actor,function(t,n,r){if(t)return e(t);var a={};i.expires&&(a.expires=i.expires),i.cacheControl&&(a.cacheControl=i.cacheControl),e(null,s.extend({rawTileData:i.rawData},n,a),r)}),this.loaded[n]=this.loaded[n]||{},void(this.loaded[n][r]=a)):e(null,null)}var n=t.source,r=t.uid;this.loading[n]||(this.loading[n]={});var a=this.loading[n][r]=new o(t);a.abort=this.loadVectorData(t,i.bind(this))},l.prototype.reloadTile=function(t,e){function i(t,i){if(this.reloadCallback){var n=this.reloadCallback;delete this.reloadCallback,this.parse(this.vectorTile,a.layerIndex,a.actor,n)}e(t,i)}var n=this.loaded[t.source],r=t.uid,a=this;if(n&&n[r]){var o=n[r];"parsing"===o.status?o.reloadCallback=e:"done"===o.status&&o.parse(o.vectorTile,this.layerIndex,this.actor,i.bind(o))}},l.prototype.abortTile=function(t){var e=this.loading[t.source],i=t.uid;e&&e[i]&&e[i].abort&&(e[i].abort(),delete e[i])},l.prototype.removeTile=function(t){var e=this.loaded[t.source],i=t.uid;e&&e[i]&&delete e[i]},l.prototype.loadVectorData=function(t,e){function i(t,i){if(t)return e(t);var n=new r.VectorTile(new a(i.data));n.rawData=i.data,n.cacheControl=i.cacheControl,n.expires=i.expires,e(t,n)}var o=n.getArrayBuffer(t.url,i.bind(this));return function(){o.abort()}},l.prototype.redoPlacement=function(t,e){var i=this.loaded[t.source],n=this.loading[t.source],r=t.uid;if(i&&i[r]){var a=i[r],o=a.redoPlacement(t.angle,t.pitch,t.showCollisionBoxes);o.result&&e(null,o.result,o.transferables)}else n&&n[r]&&(n[r].angle=t.angle)},e.exports=l},{"../util/ajax":109,"../util/util":129,"./worker_tile":58,pbf:196,"vector-tile":206}],56:[function(t,e,i){"use strict";var n=t("../util/ajax"),r=t("./image_source"),a=function(t){function e(e,i,n,r){t.call(this,e,i,n,r),this.roundZoom=!0,this.type="video",this.options=i}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.load=function(){var t=this,e=this.options;this.urls=e.urls,n.getVideo(e.urls,function(e,i){if(e)return t.fire("error",{error:e});t.video=i,t.video.loop=!0;var n;t.video.addEventListener("playing",function(){n=t.map.style.animationLoop.set(1/0),t.map._rerender()}),t.video.addEventListener("pause",function(){t.map.style.animationLoop.cancel(n)}),t.map&&t.video.play(),t._finishLoading()})},e.prototype.getVideo=function(){return this.video},e.prototype.onAdd=function(t){this.map||(this.load(),this.map=t,this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},e.prototype.prepare=function(){!this.tile||this.video.readyState<2||this._prepareImage(this.map.painter.gl,this.video)},e.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},e}(r);e.exports=a},{"../util/ajax":109,"./image_source":44}],57:[function(t,e,i){"use strict";var n=t("../util/actor"),r=t("../style/style_layer_index"),a=t("./vector_tile_worker_source"),o=t("./geojson_worker_source"),s=t("./rtl_text_plugin"),l=function(t){var e=this;this.self=t,this.actor=new n(t,this),this.layerIndexes={},this.workerSourceTypes={vector:a,geojson:o},this.workerSources={},this.self.registerWorkerSource=function(t,i){if(e.workerSourceTypes[t])throw new Error('Worker source with name "'+t+'" already registered.');e.workerSourceTypes[t]=i},this.self.registerRTLTextPlugin=function(t){if(s.applyArabicShaping||s.processBidirectionalText)throw new Error("RTL text plugin already registered.");s.applyArabicShaping=t.applyArabicShaping,s.processBidirectionalText=t.processBidirectionalText}};l.prototype.setLayers=function(t,e){this.getLayerIndex(t).replace(e)},l.prototype.updateLayers=function(t,e){this.getLayerIndex(t).update(e.layers,e.removedIds,e.symbolOrder)},l.prototype.loadTile=function(t,e,i){this.getWorkerSource(t,e.type).loadTile(e,i)},l.prototype.reloadTile=function(t,e,i){this.getWorkerSource(t,e.type).reloadTile(e,i)},l.prototype.abortTile=function(t,e){this.getWorkerSource(t,e.type).abortTile(e)},l.prototype.removeTile=function(t,e){this.getWorkerSource(t,e.type).removeTile(e)},l.prototype.removeSource=function(t,e){var i=this.getWorkerSource(t,e.type);void 0!==i.removeSource&&i.removeSource(e)},l.prototype.redoPlacement=function(t,e,i){this.getWorkerSource(t,e.type).redoPlacement(e,i)},l.prototype.loadWorkerSource=function(t,e,i){try{this.self.importScripts(e.url),i()}catch(t){i(t)}},l.prototype.loadRTLTextPlugin=function(t,e,i){try{s.applyArabicShaping||s.processBidirectionalText||this.self.importScripts(e)}catch(t){i(t)}},l.prototype.getLayerIndex=function(t){var e=this.layerIndexes[t];return e||(e=this.layerIndexes[t]=new r),e},l.prototype.getWorkerSource=function(t,e){var i=this;if(this.workerSources[t]||(this.workerSources[t]={}),!this.workerSources[t][e]){var n={send:function(e,n,r,a){i.actor.send(e,n,r,a,t)}};this.workerSources[t][e]=new this.workerSourceTypes[e](n,this.getLayerIndex(t))}return this.workerSources[t][e]},e.exports=function(t){return new l(t)}},{"../style/style_layer_index":71,"../util/actor":108,"./geojson_worker_source":42,"./rtl_text_plugin":49,"./vector_tile_worker_source":55}],58:[function(t,e,i){"use strict";function n(t,e){for(var i=0,n=t.layers;i<n.length;i+=1){var r=n[i];r.recalculate(e)}}function r(t,e){return t.filter(function(t){return!t.isEmpty()}).map(function(t){return t.serialize(e)})}var a=t("../data/feature_index"),o=t("../symbol/collision_tile"),s=t("../symbol/collision_box"),l=t("../util/dictionary_coder"),c=t("../util/util"),u=t("../symbol/symbol_instances"),h=t("../symbol/symbol_quads"),d=function(t){this.coord=t.coord,this.uid=t.uid,this.zoom=t.zoom,this.tileSize=t.tileSize,this.source=t.source,this.overscaling=t.overscaling,this.angle=t.angle,this.pitch=t.pitch,this.showCollisionBoxes=t.showCollisionBoxes};d.prototype.parse=function(t,e,i,d){var f=this;t.layers||(t={layers:{_geojsonTileLayer:t}}),this.status="parsing",this.data=t,this.collisionBoxArray=new s,this.symbolInstancesArray=new u,this.symbolQuadsArray=new h;var p=new l(Object.keys(t.layers).sort()),m=new a(this.coord,this.overscaling);m.bucketLayerIDs={};var g={},v=0,y={featureIndex:m,iconDependencies:{},glyphDependencies:{}},b=e.familiesBySource[this.source];for(var _ in b){var x=t.layers[_];if(x){1===x.version&&c.warnOnce('Vector tile source "'+f.source+'" layer "'+_+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var w=p.encode(_),M=[],z=0;z<x.length;z++){var S=x.feature(z);S.index=z,S.sourceLayerIndex=w,M.push(S)}for(var E=0,k=b[_];E<k.length;E+=1){var T=k[E],P=T[0];if(!(P.minzoom&&f.zoom<P.minzoom||P.maxzoom&&f.zoom>=P.maxzoom||P.layout&&"none"===P.layout.visibility)){for(var O=0,A=T;O<A.length;O+=1){var I=A[O];I.recalculate(f.zoom)}var C=g[P.id]=P.createBucket({index:v,layers:T,zoom:f.zoom,overscaling:f.overscaling,collisionBoxArray:f.collisionBoxArray,symbolQuadsArray:f.symbolQuadsArray,symbolInstancesArray:f.symbolInstancesArray});C.populate(M,y),m.bucketLayerIDs[v]=T.map(function(t){return t.id}),v++}}}}var L=function(t){f.status="done";var e=[];d(null,{buckets:r(c.values(g),e),featureIndex:m.serialize(e),collisionTile:t.serialize(e),collisionBoxArray:f.collisionBoxArray.serialize(),symbolInstancesArray:f.symbolInstancesArray.serialize(),symbolQuadsArray:f.symbolQuadsArray.serialize()},e)};this.symbolBuckets=[];for(var D=e.symbolOrder.length-1;D>=0;D--){var R=g[e.symbolOrder[D]];R&&f.symbolBuckets.push(R)}if(0===this.symbolBuckets.length)return L(new o(this.angle,this.pitch,this.collisionBoxArray));var B=0,j=Object.keys(y.iconDependencies),F=c.mapObject(y.glyphDependencies,function(t){return Object.keys(t).map(Number)}),N=function(t){if(t)return d(t);if(B++,2===B){for(var e=new o(f.angle,f.pitch,f.collisionBoxArray),i=0,r=f.symbolBuckets;i<r.length;i+=1){var a=r[i];n(a,f.zoom),a.prepare(F,j),a.place(e,f.showCollisionBoxes)}L(e)}};Object.keys(F).length?i.send("getGlyphs",{uid:this.uid,stacks:F},function(t,e){F=e,N(t)}):N(),j.length?i.send("getIcons",{icons:j},function(t,e){j=e,N(t)}):N()},d.prototype.redoPlacement=function(t,e,i){var a=this;if(this.angle=t,this.pitch=e,"done"!==this.status)return{};for(var s=new o(this.angle,this.pitch,this.collisionBoxArray),l=0,c=this.symbolBuckets;l<c.length;l+=1){var u=c[l];n(u,a.zoom),u.place(s,i)}var h=[];return{result:{buckets:r(this.symbolBuckets,h),collisionTile:s.serialize(h)},transferables:h}},e.exports=d},{"../data/feature_index":12,"../symbol/collision_box":78,"../symbol/collision_tile":80,"../symbol/symbol_instances":89,"../symbol/symbol_quads":90,"../util/dictionary_coder":115,"../util/util":129}],59:[function(t,e,i){"use strict";var n=function(){this.n=0,this.times=[]};n.prototype.stopped=function(){return this.times=this.times.filter(function(t){return t.time>=(new Date).getTime()}),!this.times.length},n.prototype.set=function(t){return this.times.push({id:this.n,time:t+(new Date).getTime()}),this.n++},n.prototype.cancel=function(t){this.times=this.times.filter(function(e){return e.id!==t})},e.exports=n},{}],60:[function(t,e,i){"use strict";var n=t("../util/evented"),r=t("../util/ajax"),a=t("../util/browser"),o=t("../util/mapbox").normalizeSpriteURL,s=function(){this.x=0,this.y=0,this.width=0,this.height=0,this.pixelRatio=1,this.sdf=!1},l=function(t){function e(e,i){var n=this;t.call(this),this.base=e,this.retina=a.devicePixelRatio>1,this.setEventedParent(i);var s=this.retina?"@2x":"";r.getJSON(o(e,s,".json"),function(t,e){return t?void n.fire("error",{error:t}):(n.data=e,void(n.imgData&&n.fire("data",{dataType:"style"})))}),r.getImage(o(e,s,".png"),function(t,e){if(t)return void n.fire("error",{error:t});n.imgData=a.getImageData(e);for(var i=0;i<n.imgData.length;i+=4){var r=n.imgData[i+3]/255;n.imgData[i+0]*=r,n.imgData[i+1]*=r,n.imgData[i+2]*=r}n.width=e.width,n.data&&n.fire("data",{dataType:"style"})})}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.toJSON=function(){return this.base},e.prototype.loaded=function(){return!(!this.data||!this.imgData)},e.prototype.resize=function(){var t=this;if(a.devicePixelRatio>1!==this.retina){var i=new e(this.base);i.on("data",function(){t.data=i.data,t.imgData=i.imgData,t.width=i.width,t.retina=i.retina})}},e.prototype.getSpritePosition=function(t){if(!this.loaded())return new s;var e=this.data&&this.data[t];return e&&this.imgData?e:new s},e}(n);e.exports=l},{"../util/ajax":109,"../util/browser":110,"../util/evented":118,"../util/mapbox":125}],61:[function(t,e,i){"use strict";var n=t("./style_spec"),r=t("../util/util"),a=t("../util/evented"),o=t("./validate_style"),s=t("./style_declaration"),l=t("./style_transition"),c="-transition",u=function(t){function e(e){t.call(this),this.properties=["anchor","color","position","intensity"],this._specifications=n.light,this.set(e)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.set=function(t){var e=this;if(!this._validate(o.light,t)){this._declarations={},this._transitions={},this._transitionOptions={},this.calculated={},t=r.extend({anchor:this._specifications.anchor.default,color:this._specifications.color.default,position:this._specifications.position.default,intensity:this._specifications.intensity.default},t);for(var i=0,n=this.properties;i<n.length;i+=1){var a=n[i];e._declarations[a]=new s(e._specifications[a],t[a])}return this}},e.prototype.getLight=function(){return{anchor:this.getLightProperty("anchor"),color:this.getLightProperty("color"),position:this.getLightProperty("position"),intensity:this.getLightProperty("intensity")}},e.prototype.getLightProperty=function(t){return r.endsWith(t,c)?this._transitionOptions[t]:this._declarations[t]&&this._declarations[t].value},e.prototype.getLightValue=function(t,e){if("position"===t){var i=this._transitions[t].calculate(e),n=r.sphericalToCartesian(i);return{x:n[0],y:n[1],z:n[2]}}return this._transitions[t].calculate(e)},e.prototype.setLight=function(t){var e=this;if(!this._validate(o.light,t))for(var i in t){var n=t[i];r.endsWith(i,c)?e._transitionOptions[i]=n:null===n||void 0===n?delete e._declarations[i]:e._declarations[i]=new s(e._specifications[i],n)}},e.prototype.recalculate=function(t){var e=this;for(var i in this._declarations)e.calculated[i]=e.getLightValue(i,{zoom:t})},e.prototype._applyLightDeclaration=function(t,e,i,n,a){var o=i.transition?this._transitions[t]:void 0,u=this._specifications[t];if(null!==e&&void 0!==e||(e=new s(u,u.default)),!o||o.declaration.json!==e.json){var h=r.extend({duration:300,delay:0},n,this.getLightProperty(t+c)),d=this._transitions[t]=new l(u,e,o,h);d.instant()||(d.loopID=a.set(d.endTime-Date.now())),o&&a.cancel(o.loopID)}},e.prototype.updateLightTransitions=function(t,e,i){var n,r=this;for(n in this._declarations)r._applyLightDeclaration(n,r._declarations[n],t,e,i)},e.prototype._validate=function(t,e){return o.emitErrors(this,t.call(o,r.extend({value:e,style:{glyphs:!0,sprite:!0},styleSpec:n})))},e}(a);e.exports=u},{"../util/evented":118,"../util/util":129,"./style_declaration":64,"./style_spec":72,"./style_transition":73,"./validate_style":74}],62:[function(t,e,i){"use strict";var n=t("csscolorparser").parseCSSColor,r=t("../util/util"),a=t("mapbox-gl-function"),o={};e.exports=function t(e){if(e&&a.isFunctionDefinition(e))return e.stops?r.extend({},e,{stops:e.stops.map(function(e){return[e[0],t(e[1])]})}):e;if("string"==typeof e){if(!o[e]){var i=n(e);if(!i)throw new Error("Invalid color "+e);o[e]=[i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3]]}return o[e]}if(Array.isArray(e))return e;throw new Error("Invalid color "+e)}},{"../util/util":129,csscolorparser:135,"mapbox-gl-function":164}],63:[function(t,e,i){"use strict";var n=t("../util/evented"),r=t("./style_layer"),a=t("./image_sprite"),o=t("./light"),s=t("../symbol/glyph_source"),l=t("../symbol/sprite_atlas"),c=t("../render/line_atlas"),u=t("../util/util"),h=t("../util/ajax"),d=t("../util/mapbox"),f=t("../util/browser"),p=t("../util/dispatcher"),m=t("./animation_loop"),g=t("./validate_style"),v=t("../source/source"),y=t("../source/query_features"),b=t("../source/source_cache"),_=t("./style_spec"),x=t("mapbox-gl-function"),w=t("../global_worker_pool"),M=t("mapbox-gl-style-spec/lib/deref"),z=t("mapbox-gl-style-spec/lib/diff"),S=t("../source/rtl_text_plugin"),E=u.pick(z.operations,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition"]),k=u.pick(z.operations,["setCenter","setZoom","setBearing","setPitch"]),T=function(t){function e(e,i,n){var r=this;t.call(this),this.map=i,this.animationLoop=i&&i.animationLoop||new m,this.dispatcher=new p(w(),this),this.spriteAtlas=new l(1024,1024),this.lineAtlas=new c(256,512),this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory={},this._loaded=!1,u.bindAll(["_redoPlacement"],this),this._resetUpdates(),n=u.extend({validate:"string"!=typeof e||!d.isMapboxURL(e)},n),this.setEventedParent(i),this.fire("dataloading",{dataType:"style"});var o=this;S.registerForPluginAvailability(function(t){o.dispatcher.broadcast("loadRTLTextPlugin",t,S.errorCallback);for(var e in o.sourceCaches)o.sourceCaches[e].reload()});var v=function(t,e){if(t)return void r.fire("error",{error:t});if(!n.validate||!g.emitErrors(r,g(e))){r._loaded=!0,r.stylesheet=e,r.updateClasses();for(var i in e.sources)r.addSource(i,e.sources[i],n);e.sprite&&(r.sprite=new a(e.sprite,r)),r.glyphSource=new s(e.glyphs),r._resolve(),r.fire("data",{dataType:"style"}),r.fire("style.load")}};"string"==typeof e?h.getJSON(d.normalizeStyleURL(e),v):f.frame(v.bind(this,null,e)),this.on("source.load",function(t){var e=r.sourceCaches[t.sourceId].getSource();if(e&&e.vectorLayerIds)for(var i in r._layers){var n=r._layers[i];n.source===e.id&&r._validateLayer(n)}})}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype._validateLayer=function(t){var e=this.sourceCaches[t.source];if(t.sourceLayer&&e){var i=e.getSource();("geojson"===i.type||i.vectorLayerIds&&i.vectorLayerIds.indexOf(t.sourceLayer)===-1)&&this.fire("error",{error:new Error('Source layer "'+t.sourceLayer+'" does not exist on source "'+i.id+'" as specified by style layer "'+t.id+'"')})}},e.prototype.loaded=function(){var t=this;if(!this._loaded)return!1;if(Object.keys(this._updatedSources).length)return!1;for(var e in this.sourceCaches)if(!t.sourceCaches[e].loaded())return!1;return!(this.sprite&&!this.sprite.loaded())},e.prototype._resolve=function(){var t=this,e=M(this.stylesheet.layers);this._order=e.map(function(t){return t.id}),this._layers={};for(var i=0,n=e;i<n.length;i+=1){var a=n[i];a=r.create(a),a.setEventedParent(t,{layer:{id:a.id}}),t._layers[a.id]=a}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new o(this.stylesheet.light)},e.prototype._serializeLayers=function(t){var e=this;return t.map(function(t){return e._layers[t].serialize()})},e.prototype._applyClasses=function(t,e){var i=this;if(this._loaded){t=t||[],e=e||{transition:!0};var n=this.stylesheet.transition||{},r=this._updatedAllPaintProps?this._layers:this._updatedPaintProps;for(var a in r){var o=i._layers[a],s=i._updatedPaintProps[a];if(i._updatedAllPaintProps||s.all)o.updatePaintTransitions(t,e,n,i.animationLoop,i.zoomHistory);else for(var l in s)i._layers[a].updatePaintTransition(l,t,e,n,i.animationLoop,i.zoomHistory)}this.light.updateLightTransitions(e,n,this.animationLoop)}},e.prototype._recalculate=function(t){var e=this;if(this._loaded){for(var i in this.sourceCaches)e.sourceCaches[i].used=!1;this._updateZoomHistory(t);for(var n=0,r=this._order;n<r.length;n+=1){var a=r[n],o=e._layers[a];o.recalculate(t),!o.isHidden(t)&&o.source&&(e.sourceCaches[o.source].used=!0)}this.light.recalculate(t);var s=300;Math.floor(this.z)!==Math.floor(t)&&this.animationLoop.set(s),this.z=t}},e.prototype._updateZoomHistory=function(t){var e=this.zoomHistory;void 0===e.lastIntegerZoom&&(e.lastIntegerZoom=Math.floor(t),e.lastIntegerZoomTime=0,e.lastZoom=t),Math.floor(e.lastZoom)<Math.floor(t)?(e.lastIntegerZoom=Math.floor(t),e.lastIntegerZoomTime=Date.now()):Math.floor(e.lastZoom)>Math.floor(t)&&(e.lastIntegerZoom=Math.floor(t+1),e.lastIntegerZoomTime=Date.now()),e.lastZoom=t},e.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},e.prototype.update=function(t,e){var i=this;if(this._changed){var n=Object.keys(this._updatedLayers),r=Object.keys(this._removedLayers);(n.length||r.length||this._updatedSymbolOrder)&&this._updateWorkerLayers(n,r);for(var a in this._updatedSources){var o=i._updatedSources[a];"reload"===o?i._reloadSource(a):"clear"===o&&i._clearSource(a)}this._applyClasses(t,e),this._resetUpdates(),this.fire("data",{dataType:"style"})}},e.prototype._updateWorkerLayers=function(t,e){var i=this,n=this._updatedSymbolOrder?this._order.filter(function(t){return"symbol"===i._layers[t].type}):null;this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(t),removedIds:e,symbolOrder:n})},e.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSymbolOrder=!1,this._updatedSources={},this._updatedPaintProps={},this._updatedAllPaintProps=!1},e.prototype.setState=function(t){var e=this;if(this._checkLoaded(),g.emitErrors(this,g(t)))return!1;t=u.extend({},t),t.layers=M(t.layers);var i=z(this.serialize(),t).filter(function(t){return!(t.command in k)});if(0===i.length)return!1;var n=i.filter(function(t){return!(t.command in E)});if(n.length>0)throw new Error("Unimplemented: "+n.map(function(t){return t.command}).join(", ")+".");return i.forEach(function(t){"setTransition"!==t.command&&e[t.command].apply(e,t.args)}),this.stylesheet=t,!0},e.prototype.addSource=function(t,e,i){if(this._checkLoaded(),void 0!==this.sourceCaches[t])throw new Error("There is already a source with this ID");if(!e.type)throw new Error("The type property must be defined, but the only the following properties were given: "+Object.keys(e)+".");var n=["vector","raster","geojson","video","image","canvas"],r=n.indexOf(e.type)>=0;if(!r||!this._validate(g.source,"sources."+t,e,null,i)){var a=this.sourceCaches[t]=new b(t,e,this.dispatcher);a.style=this,a.setEventedParent(this,function(){return{isSourceLoaded:a.loaded(),source:a.serialize(),sourceId:t}}),a.onAdd(this.map),this._changed=!0}},e.prototype.removeSource=function(t){if(this._checkLoaded(),void 0===this.sourceCaches[t])throw new Error("There is no source with this ID");var e=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],e.setEventedParent(null),e.clearTiles(),e.onRemove&&e.onRemove(this.map),this._changed=!0},e.prototype.getSource=function(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()},e.prototype.addLayer=function(t,e,i){this._checkLoaded();var n=t.id;if("object"==typeof t.source&&(this.addSource(n,t.source),t=u.extend(t,{source:n})),!this._validate(g.layer,"layers."+n,t,{arrayIndex:-1},i)){var a=r.create(t);this._validateLayer(a),a.setEventedParent(this,{layer:{id:n}});var o=e?this._order.indexOf(e):this._order.length;if(this._order.splice(o,0,n),this._layers[n]=a,this._removedLayers[n]&&a.source){var s=this._removedLayers[n];delete this._removedLayers[n],this._updatedSources[a.source]=s.type!==a.type?"clear":"reload"}this._updateLayer(a),"symbol"===a.type&&(this._updatedSymbolOrder=!0),this.updateClasses(n)}},e.prototype.moveLayer=function(t,e){this._checkLoaded(),this._changed=!0;var i=this._layers[t];if(!i)return void this.fire("error",{error:new Error("The layer '"+t+"' does not exist in the map's style and cannot be moved.")});var n=this._order.indexOf(t);this._order.splice(n,1);var r=e?this._order.indexOf(e):this._order.length;this._order.splice(r,0,t),"symbol"===i.type&&(this._updatedSymbolOrder=!0,i.source&&!this._updatedSources[i.source]&&(this._updatedSources[i.source]="reload"))},e.prototype.removeLayer=function(t){this._checkLoaded();var e=this._layers[t];if(!e)return void this.fire("error",{error:new Error("The layer '"+t+"' does not exist in the map's style and cannot be removed.")});e.setEventedParent(null);var i=this._order.indexOf(t);this._order.splice(i,1),"symbol"===e.type&&(this._updatedSymbolOrder=!0),this._changed=!0,this._removedLayers[t]=e,delete this._layers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t]},e.prototype.getLayer=function(t){return this._layers[t]},e.prototype.setLayerZoomRange=function(t,e,i){this._checkLoaded();var n=this.getLayer(t);return n?void(n.minzoom===e&&n.maxzoom===i||(null!=e&&(n.minzoom=e),null!=i&&(n.maxzoom=i),this._updateLayer(n))):void this.fire("error",{error:new Error("The layer '"+t+"' does not exist in the map's style and cannot have zoom extent.")})},e.prototype.setFilter=function(t,e){this._checkLoaded();var i=this.getLayer(t);return i?void(null!==e&&void 0!==e&&this._validate(g.filter,"layers."+i.id+".filter",e)||u.deepEqual(i.filter,e)||(i.filter=u.clone(e),this._updateLayer(i))):void this.fire("error",{error:new Error("The layer '"+t+"' does not exist in the map's style and cannot be filtered.")})},e.prototype.getFilter=function(t){return u.clone(this.getLayer(t).filter)},e.prototype.setLayoutProperty=function(t,e,i){this._checkLoaded();var n=this.getLayer(t);return n?void(u.deepEqual(n.getLayoutProperty(e),i)||(n.setLayoutProperty(e,i),this._updateLayer(n))):void this.fire("error",{error:new Error("The layer '"+t+"' does not exist in the map's style and cannot be styled.")})},e.prototype.getLayoutProperty=function(t,e){return this.getLayer(t).getLayoutProperty(e)},e.prototype.setPaintProperty=function(t,e,i,n){this._checkLoaded();var r=this.getLayer(t);if(!r)return void this.fire("error",{error:new Error("The layer '"+t+"' does not exist in the map's style and cannot be styled.")});if(!u.deepEqual(r.getPaintProperty(e,n),i)){var a=r.isPaintValueFeatureConstant(e);r.setPaintProperty(e,i,n);var o=!(i&&x.isFunctionDefinition(i)&&"$zoom"!==i.property&&void 0!==i.property);o&&a||this._updateLayer(r),this.updateClasses(t,e)}},e.prototype.getPaintProperty=function(t,e,i){return this.getLayer(t).getPaintProperty(e,i)},e.prototype.getTransition=function(){return u.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},e.prototype.updateClasses=function(t,e){if(this._changed=!0,t){var i=this._updatedPaintProps;i[t]||(i[t]={}),i[t][e||"all"]=!0}else this._updatedAllPaintProps=!0},e.prototype.serialize=function(){var t=this;return u.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:u.mapObject(this.sourceCaches,function(t){return t.serialize()}),layers:this._order.map(function(e){return t._layers[e].serialize()})},function(t){return void 0!==t})},e.prototype._updateLayer=function(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&(this._updatedSources[t.source]="reload"),this._changed=!0},e.prototype._flattenRenderedFeatures=function(t){for(var e=this,i=[],n=this._order.length-1;n>=0;n--)for(var r=e._order[n],a=0,o=t;a<o.length;a+=1){var s=o[a],l=s[r];if(l)for(var c=0,u=l;c<u.length;c+=1){var h=u[c];i.push(h)}}return i},e.prototype.queryRenderedFeatures=function(t,e,i,n){var r=this;e&&e.filter&&this._validate(g.filter,"queryRenderedFeatures.filter",e.filter);var a={};if(e&&e.layers)for(var o=0,s=e.layers;o<s.length;o+=1){var l=s[o],c=r._layers[l];if(!c)return void r.fire("error",{error:"The layer '"+l+"' does not exist in the map's style and cannot be queried for features."});a[c.source]=!0}var u=[];for(var h in this.sourceCaches)if(!e.layers||a[h]){var d=y.rendered(r.sourceCaches[h],r._layers,t,e,i,n);u.push(d)}return this._flattenRenderedFeatures(u)},e.prototype.querySourceFeatures=function(t,e){e&&e.filter&&this._validate(g.filter,"querySourceFeatures.filter",e.filter);var i=this.sourceCaches[t];return i?y.source(i,e):[]},e.prototype.addSourceType=function(t,e,i){return v.getType(t)?i(new Error('A source type called "'+t+'" already exists.')):(v.setType(t,e),e.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:e.workerSourceURL},i):i(null,null))},e.prototype.getLight=function(){return this.light.getLight()},e.prototype.setLight=function(t,e){this._checkLoaded();var i=this.light.getLight(),n=!1;for(var r in t)if(!u.deepEqual(t[r],i[r])){n=!0;break}if(n){var a=this.stylesheet.transition||{};this.light.setLight(t),this.light.updateLightTransitions(e||{transition:!0},a,this.animationLoop)}},e.prototype._validate=function(t,e,i,n,r){return(!r||r.validate!==!1)&&g.emitErrors(this,t.call(g,u.extend({key:e,style:this.serialize(),value:i,styleSpec:_},n)))},e.prototype._remove=function(){var t=this;for(var e in this.sourceCaches)t.sourceCaches[e].clearTiles();this.dispatcher.remove()},e.prototype._clearSource=function(t){this.sourceCaches[t].clearTiles()},e.prototype._reloadSource=function(t){this.sourceCaches[t].reload()},e.prototype._updateSources=function(t){var e=this;for(var i in this.sourceCaches)e.sourceCaches[i].update(t)},e.prototype._redoPlacement=function(){var t=this;for(var e in this.sourceCaches)t.sourceCaches[e].redoPlacement()},e.prototype.getIcons=function(t,e,i){var n=this,r=function(){n.spriteAtlas.setSprite(n.sprite),n.spriteAtlas.addIcons(e.icons,i)};this.sprite.loaded()?r():this.sprite.on("data",r)},e.prototype.getGlyphs=function(t,e,i){function n(t,e,n){t&&console.error(t),s[n]=e,o--,0===o&&i(null,s)}var r=this,a=e.stacks,o=Object.keys(a).length,s={};for(var l in a)r.glyphSource.getSimpleGlyphs(l,a[l],e.uid,n)},e}(n);e.exports=T},{"../global_worker_pool":22,"../render/line_atlas":35,"../source/query_features":47,"../source/rtl_text_plugin":49,"../source/source":50,"../source/source_cache":51,"../symbol/glyph_source":83,"../symbol/sprite_atlas":88,"../util/ajax":109,"../util/browser":110,"../util/dispatcher":116,"../util/evented":118,"../util/mapbox":125,"../util/util":129,"./animation_loop":59,"./image_sprite":60,"./light":61,"./style_layer":65,"./style_spec":72,"./validate_style":74,"mapbox-gl-function":164,"mapbox-gl-style-spec/lib/deref":165,"mapbox-gl-style-spec/lib/diff":166}],64:[function(t,e,i){"use strict";var n=t("mapbox-gl-function"),r=t("./parse_color"),a=t("../util/util"),o=function(t,e){var i=this;this.value=a.clone(e),this.isFunction=n.isFunctionDefinition(e),this.json=JSON.stringify(this.value),this.minimum=t.minimum,this.isColor="color"===t.type;var o=this.isColor&&this.value?r(this.value):e,s=t.default;if(s&&"color"===t.type&&(s=r(s)),this.function=n[t.function||"piecewise-constant"](o,s),this.isFeatureConstant=this.function.isFeatureConstant,this.isZoomConstant=this.function.isZoomConstant,!this.isFeatureConstant&&!this.isZoomConstant){this.stopZoomLevels=[];for(var l=[],c=0,u=this.value.stops;c<u.length;c+=1){var h=u[c],d=h[0].zoom;i.stopZoomLevels.indexOf(d)<0&&(i.stopZoomLevels.push(d),l.push([d,l.length]))}this.functionInterpolationT=n.interpolated({stops:l,base:e.base,colorSpace:e.colorSpace})}};o.prototype.calculate=function(t,e){var i=this.function(t&&t.zoom,e||{});return this.isColor&&i?r(i):void 0!==this.minimum&&i<this.minimum?this.minimum:i},o.prototype.calculateInterpolationT=function(t,e){return this.functionInterpolationT(t&&t.zoom,e||{})},e.exports=o},{"../util/util":129,"./parse_color":62,"mapbox-gl-function":164}],65:[function(t,e,i){"use strict";function n(t){return t.value}var r=t("../util/util"),a=t("./style_transition"),o=t("./style_declaration"),s=t("./style_spec"),l=t("./validate_style"),c=t("./parse_color"),u=t("../util/evented"),h="-transition",d=function(t){function e(e){var i=this;t.call(this),this.id=e.id,this.metadata=e.metadata,this.type=e.type,this.source=e.source,this.sourceLayer=e["source-layer"],this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,this.filter=e.filter,this.paint={},this.layout={},this._paintSpecifications=s["paint_"+this.type],this._layoutSpecifications=s["layout_"+this.type],this._paintTransitions={},this._paintTransitionOptions={},this._paintDeclarations={},this._layoutDeclarations={},this._layoutFunctions={};var n,r,a={validate:!1};for(var o in e){var l=o.match(/^paint(?:\.(.*))?$/);if(l){var c=l[1]||"";for(n in e[o])i.setPaintProperty(n,e[o][n],c,a)}}for(r in e.layout)i.setLayoutProperty(r,e.layout[r],a);
for(n in this._paintSpecifications)i.paint[n]=i.getPaintValue(n);for(r in this._layoutSpecifications)i._updateLayoutValue(r)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.setLayoutProperty=function(t,e,i){if(null==e)delete this._layoutDeclarations[t];else{var n="layers."+this.id+".layout."+t;if(this._validate(l.layoutProperty,n,t,e,i))return;this._layoutDeclarations[t]=new o(this._layoutSpecifications[t],e)}this._updateLayoutValue(t)},e.prototype.getLayoutProperty=function(t){return this._layoutDeclarations[t]&&this._layoutDeclarations[t].value},e.prototype.getLayoutValue=function(t,e,i){var n=this._layoutSpecifications[t],r=this._layoutDeclarations[t];return r?r.calculate(e,i):n.default},e.prototype.setPaintProperty=function(t,e,i,n){var a="layers."+this.id+(i?'["paint.'+i+'"].':".paint.")+t;if(r.endsWith(t,h))if(this._paintTransitionOptions[i||""]||(this._paintTransitionOptions[i||""]={}),null===e||void 0===e)delete this._paintTransitionOptions[i||""][t];else{if(this._validate(l.paintProperty,a,t,e,n))return;this._paintTransitionOptions[i||""][t]=e}else if(this._paintDeclarations[i||""]||(this._paintDeclarations[i||""]={}),null===e||void 0===e)delete this._paintDeclarations[i||""][t];else{if(this._validate(l.paintProperty,a,t,e,n))return;this._paintDeclarations[i||""][t]=new o(this._paintSpecifications[t],e)}},e.prototype.getPaintProperty=function(t,e){return e=e||"",r.endsWith(t,h)?this._paintTransitionOptions[e]&&this._paintTransitionOptions[e][t]:this._paintDeclarations[e]&&this._paintDeclarations[e][t]&&this._paintDeclarations[e][t].value},e.prototype.getPaintValue=function(t,e,i){var n=this._paintSpecifications[t],r=this._paintTransitions[t];return r?r.calculate(e,i):"color"===n.type&&n.default?c(n.default):n.default},e.prototype.getPaintValueStopZoomLevels=function(t){var e=this._paintTransitions[t];return e?e.declaration.stopZoomLevels:[]},e.prototype.getPaintInterpolationT=function(t,e){var i=this._paintTransitions[t];return i.declaration.calculateInterpolationT(e)},e.prototype.isPaintValueFeatureConstant=function(t){var e=this._paintTransitions[t];return!e||e.declaration.isFeatureConstant},e.prototype.isLayoutValueFeatureConstant=function(t){var e=this._layoutDeclarations[t];return!e||e.isFeatureConstant},e.prototype.isPaintValueZoomConstant=function(t){var e=this._paintTransitions[t];return!e||e.declaration.isZoomConstant},e.prototype.isHidden=function(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||"none"===this.layout.visibility},e.prototype.updatePaintTransitions=function(t,e,i,n,a){for(var o=this,s=r.extend({},this._paintDeclarations[""]),l=0;l<t.length;l++)r.extend(s,o._paintDeclarations[t[l]]);var c;for(c in s)o._applyPaintDeclaration(c,s[c],e,i,n,a);for(c in this._paintTransitions)c in s||o._applyPaintDeclaration(c,null,e,i,n,a)},e.prototype.updatePaintTransition=function(t,e,i,n,r,a){for(var o=this,s=this._paintDeclarations[""][t],l=0;l<e.length;l++){var c=o._paintDeclarations[e[l]];c&&c[t]&&(s=c[t])}this._applyPaintDeclaration(t,s,i,n,r,a)},e.prototype.recalculate=function(t){var e=this;for(var i in this._paintTransitions)e.paint[i]=e.getPaintValue(i,{zoom:t});for(var n in this._layoutFunctions)e.layout[n]=e.getLayoutValue(n,{zoom:t})},e.prototype.serialize=function(){var t=this,e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:r.mapObject(this._layoutDeclarations,n)};for(var i in this._paintDeclarations){var a=""===i?"paint":"paint."+i;e[a]=r.mapObject(t._paintDeclarations[i],n)}return r.filterObject(e,function(t,e){return void 0!==t&&!("layout"===e&&!Object.keys(t).length)})},e.prototype._applyPaintDeclaration=function(t,e,i,n,s,l){var c=i.transition?this._paintTransitions[t]:void 0,u=this._paintSpecifications[t];if(null!==e&&void 0!==e||(e=new o(u,u.default)),!c||c.declaration.json!==e.json){var d=r.extend({duration:300,delay:0},n,this.getPaintProperty(t+h)),f=this._paintTransitions[t]=new a(u,e,c,d,l);f.instant()||(f.loopID=s.set(f.endTime-Date.now())),c&&s.cancel(c.loopID)}},e.prototype._updateLayoutValue=function(t){var e=this._layoutDeclarations[t];e&&e.isFunction?this._layoutFunctions[t]=!0:(delete this._layoutFunctions[t],this.layout[t]=this.getLayoutValue(t))},e.prototype._validate=function(t,e,i,n,r){return(!r||r.validate!==!1)&&l.emitErrors(this,t.call(l,{key:e,layerType:this.type,objectKey:i,value:n,styleSpec:s,style:{glyphs:!0,sprite:!0}}))},e}(u);e.exports=d;var f={circle:t("./style_layer/circle_style_layer"),fill:t("./style_layer/fill_style_layer"),"fill-extrusion":t("./style_layer/fill_extrusion_style_layer"),line:t("./style_layer/line_style_layer"),symbol:t("./style_layer/symbol_style_layer")};d.create=function(t){var e=f[t.type]||d;return new e(t)}},{"../util/evented":118,"../util/util":129,"./parse_color":62,"./style_declaration":64,"./style_layer/circle_style_layer":66,"./style_layer/fill_extrusion_style_layer":67,"./style_layer/fill_style_layer":68,"./style_layer/line_style_layer":69,"./style_layer/symbol_style_layer":70,"./style_spec":72,"./style_transition":73,"./validate_style":74}],66:[function(t,e,i){"use strict";var n=t("../style_layer"),r=t("../../data/bucket/circle_bucket"),a=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.createBucket=function(t){return new r(t)},e}(n);e.exports=a},{"../../data/bucket/circle_bucket":3,"../style_layer":65}],67:[function(t,e,i){"use strict";var n=t("../style_layer"),r=t("../../data/bucket/fill_extrusion_bucket"),a=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getPaintValue=function(e,i,n){var r=t.prototype.getPaintValue.call(this,e,i,n);return"fill-extrusion-color"===e&&r&&(r[3]=1),r},e.prototype.createBucket=function(t){return new r(t)},e}(n);e.exports=a},{"../../data/bucket/fill_extrusion_bucket":5,"../style_layer":65}],68:[function(t,e,i){"use strict";var n=t("../style_layer"),r=t("../../data/bucket/fill_bucket"),a=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getPaintValue=function(e,i,n){var r=this;if("fill-outline-color"===e){if(void 0===this.getPaintProperty("fill-outline-color"))return t.prototype.getPaintValue.call(this,"fill-color",i,n);for(var a=this._paintTransitions["fill-outline-color"];a;){var o=a&&a.declaration&&a.declaration.value;if(!o)return t.prototype.getPaintValue.call(r,"fill-color",i,n);a=a.oldTransition}}return t.prototype.getPaintValue.call(this,e,i,n)},e.prototype.getPaintValueStopZoomLevels=function(e){return"fill-outline-color"===e&&void 0===this.getPaintProperty("fill-outline-color")?t.prototype.getPaintValueStopZoomLevels.call(this,"fill-color"):t.prototype.getPaintValueStopZoomLevels.call(this,e)},e.prototype.getPaintInterpolationT=function(e,i){return"fill-outline-color"===e&&void 0===this.getPaintProperty("fill-outline-color")?t.prototype.getPaintInterpolationT.call(this,"fill-color",i):t.prototype.getPaintInterpolationT.call(this,e,i)},e.prototype.isPaintValueFeatureConstant=function(e){return"fill-outline-color"===e&&void 0===this.getPaintProperty("fill-outline-color")?t.prototype.isPaintValueFeatureConstant.call(this,"fill-color"):t.prototype.isPaintValueFeatureConstant.call(this,e)},e.prototype.isPaintValueZoomConstant=function(e){return"fill-outline-color"===e&&void 0===this.getPaintProperty("fill-outline-color")?t.prototype.isPaintValueZoomConstant.call(this,"fill-color"):t.prototype.isPaintValueZoomConstant.call(this,e)},e.prototype.createBucket=function(t){return new r(t)},e}(n);e.exports=a},{"../../data/bucket/fill_bucket":4,"../style_layer":65}],69:[function(t,e,i){"use strict";var n=t("../style_layer"),r=t("../../data/bucket/line_bucket"),a=t("../../util/util"),o=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getPaintValue=function(e,i,n){var r=t.prototype.getPaintValue.call(this,e,i,n);if(r&&"line-dasharray"===e){var o=this.getPaintValue("line-width",a.extend({},i,{zoom:Math.floor(i.zoom)}),n);r.fromScale*=o,r.toScale*=o}return r},e.prototype.createBucket=function(t){return new r(t)},e}(n);e.exports=o},{"../../data/bucket/line_bucket":6,"../../util/util":129,"../style_layer":65}],70:[function(t,e,i){"use strict";var n=t("../style_layer"),r=t("../../data/bucket/symbol_bucket"),a=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getLayoutValue=function(e,i,n){var r=t.prototype.getLayoutValue.call(this,e,i,n);if("auto"!==r)return r;switch(e){case"text-rotation-alignment":case"icon-rotation-alignment":return"line"===this.getLayoutValue("symbol-placement",i,n)?"map":"viewport";case"text-pitch-alignment":return this.getLayoutValue("text-rotation-alignment",i,n);default:return r}},e.prototype.createBucket=function(t){return new r(t)},e}(n);e.exports=a},{"../../data/bucket/symbol_bucket":7,"../style_layer":65}],71:[function(t,e,i){"use strict";var n=t("./style_layer"),r=t("../util/util"),a=t("feature-filter"),o=t("mapbox-gl-style-spec/lib/group_by_layout"),s=function(t){t&&this.replace(t)};s.prototype.replace=function(t){var e=this;this.symbolOrder=[];for(var i=0,n=t;i<n.length;i+=1){var r=n[i];"symbol"===r.type&&e.symbolOrder.push(r.id)}this._layerConfigs={},this._layers={},this.update(t,[])},s.prototype.update=function(t,e,i){for(var s=this,l=0,c=t;l<c.length;l+=1){var u=c[l];s._layerConfigs[u.id]=u;var h=s._layers[u.id]=n.create(u);h.updatePaintTransitions({},{transition:!1}),h.filter=a(h.filter)}for(var d=0,f=e;d<f.length;d+=1){var p=f[d];delete s._layerConfigs[p],delete s._layers[p]}i&&(this.symbolOrder=i),this.familiesBySource={};for(var m=o(r.values(this._layerConfigs)),g=0,v=m;g<v.length;g+=1){var y=v[g],b=y.map(function(t){return s._layers[t.id]}),_=b[0];if(!_.layout||"none"!==_.layout.visibility){var x=_.source||"",w=s.familiesBySource[x];w||(w=s.familiesBySource[x]={});var M=_.sourceLayer||"_geojsonTileLayer",z=w[M];z||(z=w[M]=[]),z.push(b)}}},e.exports=s},{"../util/util":129,"./style_layer":65,"feature-filter":138,"mapbox-gl-style-spec/lib/group_by_layout":168}],72:[function(t,e,i){"use strict";e.exports=t("mapbox-gl-style-spec/reference/latest.min")},{"mapbox-gl-style-spec/reference/latest.min":191}],73:[function(t,e,i){"use strict";function n(t,e,i){if(void 0!==t&&void 0!==e)return{from:t.to,fromScale:t.toScale,to:e.to,toScale:e.toScale,t:i}}var r=t("../util/util"),a=t("../util/interpolate"),o={lastIntegerZoom:0,lastIntegerZoomTime:0,lastZoom:0},s=function(t,e,i,r,s){this.declaration=e,this.startTime=this.endTime=(new Date).getTime(),this.oldTransition=i,this.duration=r.duration||0,this.delay=r.delay||0,this.zoomTransitioned="piecewise-constant"===t.function&&t.transition,this.interp=this.zoomTransitioned?n:a[t.type],this.zoomHistory=s||o,this.instant()||(this.endTime=this.startTime+this.duration+this.delay),i&&i.endTime<=this.startTime&&delete i.oldTransition};s.prototype.instant=function(){return!this.oldTransition||!this.interp||0===this.duration&&0===this.delay},s.prototype.calculate=function(t,e,i){var n=this._calculateTargetValue(t,e);if(this.instant())return n;if(i=i||Date.now(),i>=this.endTime)return n;var a=this.oldTransition.calculate(t,e,this.startTime),o=r.easeCubicInOut((i-this.startTime-this.delay)/this.duration);return this.interp(a,n,o)},s.prototype._calculateTargetValue=function(t,e){if(!this.zoomTransitioned)return this.declaration.calculate(t,e);var i=t.zoom,n=this.zoomHistory.lastIntegerZoom,r=i>n?2:.5,o=this.declaration.calculate({zoom:i>n?i-1:i+1},e),s=this.declaration.calculate({zoom:i},e),l=Math.min((Date.now()-this.zoomHistory.lastIntegerZoomTime)/this.duration,1),c=Math.abs(i-n),u=a(l,1,c);return void 0!==o&&void 0!==s?{from:o,fromScale:r,to:s,toScale:1,t:u}:void 0},e.exports=s},{"../util/interpolate":121,"../util/util":129}],74:[function(t,e,i){"use strict";e.exports=t("mapbox-gl-style-spec/lib/validate_style.min"),e.exports.emitErrors=function(t,e){if(e&&e.length){for(var i=0;i<e.length;i++)t.fire("error",{error:new Error(e[i].message)});return!0}return!1}},{"mapbox-gl-style-spec/lib/validate_style.min":190}],75:[function(t,e,i){"use strict";var n=t("point-geometry"),r=function(t){function e(e,i,n,r){t.call(this,e,i),this.angle=n,void 0!==r&&(this.segment=r)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.clone=function(){return new e(this.x,this.y,this.angle,this.segment)},e}(n);e.exports=r},{"point-geometry":197}],76:[function(t,e,i){"use strict";function n(t,e,i,n,r){if(void 0===e.segment)return!0;for(var a=e,o=e.segment+1,s=0;s>-i/2;){if(o--,o<0)return!1;s-=t[o].dist(a),a=t[o]}s+=t[o].dist(t[o+1]),o++;for(var l=[],c=0;s<i/2;){var u=t[o-1],h=t[o],d=t[o+1];if(!d)return!1;var f=u.angleTo(h)-h.angleTo(d);for(f=Math.abs((f+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:s,angleDelta:f}),c+=f;s-l[0].distance>n;)c-=l.shift().angleDelta;if(c>r)return!1;o++,s+=h.dist(d)}return!0}e.exports=n},{}],77:[function(t,e,i){"use strict";function n(t,e,i,n,a){for(var o=[],s=0;s<t.length;s++)for(var l,c=t[s],u=0;u<c.length-1;u++){var h=c[u],d=c[u+1];h.x<e&&d.x<e||(h.x<e?h=new r(e,h.y+(d.y-h.y)*((e-h.x)/(d.x-h.x)))._round():d.x<e&&(d=new r(e,h.y+(d.y-h.y)*((e-h.x)/(d.x-h.x)))._round()),h.y<i&&d.y<i||(h.y<i?h=new r(h.x+(d.x-h.x)*((i-h.y)/(d.y-h.y)),i)._round():d.y<i&&(d=new r(h.x+(d.x-h.x)*((i-h.y)/(d.y-h.y)),i)._round()),h.x>=n&&d.x>=n||(h.x>=n?h=new r(n,h.y+(d.y-h.y)*((n-h.x)/(d.x-h.x)))._round():d.x>=n&&(d=new r(n,h.y+(d.y-h.y)*((n-h.x)/(d.x-h.x)))._round()),h.y>=a&&d.y>=a||(h.y>=a?h=new r(h.x+(d.x-h.x)*((a-h.y)/(d.y-h.y)),a)._round():d.y>=a&&(d=new r(h.x+(d.x-h.x)*((a-h.y)/(d.y-h.y)),a)._round()),l&&h.equals(l[l.length-1])||(l=[h],o.push(l)),l.push(d)))))}return o}var r=t("point-geometry");e.exports=n},{"point-geometry":197}],78:[function(t,e,i){"use strict";var n=t("../util/struct_array"),r=t("point-geometry"),a=n({members:[{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Float32",name:"maxScale"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"},{type:"Int16",name:"bbox0"},{type:"Int16",name:"bbox1"},{type:"Int16",name:"bbox2"},{type:"Int16",name:"bbox3"},{type:"Float32",name:"placementScale"}]});Object.defineProperty(a.prototype.StructType.prototype,"anchorPoint",{get:function(){return new r(this.anchorPointX,this.anchorPointY)}}),e.exports=a},{"../util/struct_array":127,"point-geometry":197}],79:[function(t,e,i){"use strict";var n=function(t,e,i,n,r,a,o,s,l,c,u){var h=o.top*s-l,d=o.bottom*s+l,f=o.left*s-l,p=o.right*s+l;if(this.boxStartIndex=t.length,c){var m=d-h,g=p-f;if(m>0)if(m=Math.max(10*s,m),u){var v=e[i.segment+1].sub(e[i.segment])._unit()._mult(g),y=[i.sub(v),i.add(v)];this._addLineCollisionBoxes(t,y,i,0,g,m,n,r,a)}else this._addLineCollisionBoxes(t,e,i,i.segment,g,m,n,r,a)}else t.emplaceBack(i.x,i.y,f,h,p,d,1/0,n,r,a,0,0,0,0,0);this.boxEndIndex=t.length};n.prototype._addLineCollisionBoxes=function(t,e,i,n,r,a,o,s,l){var c=a/2,u=Math.floor(r/c),h=-a/2,d=this.boxes,f=i,p=n+1,m=h;do{if(p--,p<0)return d;m-=e[p].dist(f),f=e[p]}while(m>-r/2);for(var g=e[p].dist(e[p+1]),v=0;v<u;v++){for(var y=-r/2+v*c;m+g<y;){if(m+=g,p++,p+1>=e.length)return d;g=e[p].dist(e[p+1])}var b=y-m,_=e[p],x=e[p+1],w=x.sub(_)._unit()._mult(b)._add(_)._round(),M=Math.max(Math.abs(y-h)-c/2,0),z=r/2/M;t.emplaceBack(w.x,w.y,-a/2,-a/2,a/2,a/2,z,o,s,l,0,0,0,0,0)}return d},e.exports=n},{}],80:[function(t,e,i){"use strict";var n=t("point-geometry"),r=t("../data/extent"),a=t("grid-index"),o=t("../util/intersection_tests"),s=function(t,e,i){if("object"==typeof t){var n=t;i=e,t=n.angle,e=n.pitch,this.grid=new a(n.grid),this.ignoredGrid=new a(n.ignoredGrid)}else this.grid=new a(r,12,6),this.ignoredGrid=new a(r,12,0);this.minScale=.5,this.maxScale=2,this.angle=t,this.pitch=e;var o=Math.sin(t),s=Math.cos(t);if(this.rotationMatrix=[s,-o,o,s],this.reverseRotationMatrix=[s,o,-o,s],this.yStretch=1/Math.cos(e/180*Math.PI),this.yStretch=Math.pow(this.yStretch,1.3),this.collisionBoxArray=i,0===i.length){i.emplaceBack();var l=32767;i.emplaceBack(0,0,0,-l,0,l,l,0,0,0,0,0,0,0,0,0),i.emplaceBack(r,0,0,-l,0,l,l,0,0,0,0,0,0,0,0,0),i.emplaceBack(0,0,-l,0,l,0,l,0,0,0,0,0,0,0,0,0),i.emplaceBack(0,r,-l,0,l,0,l,0,0,0,0,0,0,0,0,0)}this.tempCollisionBox=i.get(0),this.edges=[i.get(1),i.get(2),i.get(3),i.get(4)]};s.prototype.serialize=function(t){var e=this.grid.toArrayBuffer(),i=this.ignoredGrid.toArrayBuffer();return t&&(t.push(e),t.push(i)),{angle:this.angle,pitch:this.pitch,grid:e,ignoredGrid:i}},s.prototype.placeCollisionFeature=function(t,e,i){for(var r=this,a=this.collisionBoxArray,o=this.minScale,s=this.rotationMatrix,l=this.yStretch,c=t.boxStartIndex;c<t.boxEndIndex;c++){var u=a.get(c),h=u.anchorPoint._matMult(s),d=h.x,f=h.y,p=d+u.x1,m=f+u.y1*l,g=d+u.x2,v=f+u.y2*l;if(u.bbox0=p,u.bbox1=m,u.bbox2=g,u.bbox3=v,!e)for(var y=r.grid.query(p,m,g,v),b=0;b<y.length;b++){var _=a.get(y[b]),x=_.anchorPoint._matMult(s);if(o=r.getPlacementScale(o,h,u,x,_),o>=r.maxScale)return o}if(i){var w;if(r.angle){var M=r.reverseRotationMatrix,z=new n(u.x1,u.y1).matMult(M),S=new n(u.x2,u.y1).matMult(M),E=new n(u.x1,u.y2).matMult(M),k=new n(u.x2,u.y2).matMult(M);w=r.tempCollisionBox,w.anchorPointX=u.anchorPoint.x,w.anchorPointY=u.anchorPoint.y,w.x1=Math.min(z.x,S.x,E.x,k.x),w.y1=Math.min(z.y,S.x,E.x,k.x),w.x2=Math.max(z.x,S.x,E.x,k.x),w.y2=Math.max(z.y,S.x,E.x,k.x),w.maxScale=u.maxScale}else w=u;for(var T=0;T<this.edges.length;T++){var P=r.edges[T];if(o=r.getPlacementScale(o,u.anchorPoint,w,P.anchorPoint,P),o>=r.maxScale)return o}}}return o},s.prototype.queryRenderedSymbols=function(t,e){var i={},r=[];if(0===t.length||0===this.grid.length&&0===this.ignoredGrid.length)return r;for(var a=this.collisionBoxArray,s=this.rotationMatrix,l=this.yStretch,c=[],u=1/0,h=1/0,d=-(1/0),f=-(1/0),p=0;p<t.length;p++)for(var m=t[p],g=0;g<m.length;g++){var v=m[g].matMult(s);u=Math.min(u,v.x),h=Math.min(h,v.y),d=Math.max(d,v.x),f=Math.max(f,v.y),c.push(v)}for(var y=this.grid.query(u,h,d,f),b=this.ignoredGrid.query(u,h,d,f),_=0;_<b.length;_++)y.push(b[_]);for(var x=Math.pow(2,Math.ceil(Math.log(e)/Math.LN2*10)/10),w=0;w<y.length;w++){var M=a.get(y[w]),z=M.sourceLayerIndex,S=M.featureIndex;if(void 0===i[z]&&(i[z]={}),!i[z][S]&&!(x<M.placementScale||x>M.maxScale)){var E=M.anchorPoint.matMult(s),k=E.x+M.x1/e,T=E.y+M.y1/e*l,P=E.x+M.x2/e,O=E.y+M.y2/e*l,A=[new n(k,T),new n(P,T),new n(P,O),new n(k,O)];o.polygonIntersectsPolygon(c,A)&&(i[z][S]=!0,r.push(y[w]))}}return r},s.prototype.getPlacementScale=function(t,e,i,n,r){var a=e.x-n.x,o=e.y-n.y,s=(r.x1-i.x2)/a,l=(r.x2-i.x1)/a,c=(r.y1-i.y2)*this.yStretch/o,u=(r.y2-i.y1)*this.yStretch/o;(isNaN(s)||isNaN(l))&&(s=l=1),(isNaN(c)||isNaN(u))&&(c=u=1);var h=Math.min(Math.max(s,l),Math.max(c,u)),d=r.maxScale,f=i.maxScale;return h>d&&(h=d),h>f&&(h=f),h>t&&h>=r.placementScale&&(t=h),t},s.prototype.insertCollisionFeature=function(t,e,i){for(var n=this,r=i?this.ignoredGrid:this.grid,a=this.collisionBoxArray,o=t.boxStartIndex;o<t.boxEndIndex;o++){var s=a.get(o);s.placementScale=e,e<n.maxScale&&r.insert(o,s.bbox0,s.bbox1,s.bbox2,s.bbox3)}},e.exports=s},{"../data/extent":11,"../util/intersection_tests":122,"grid-index":149,"point-geometry":197}],81:[function(t,e,i){"use strict";function n(t,e,i,n,a,o,s,l,c){var u=n?.6*o*s:0,h=Math.max(n?n.right-n.left:0,a?a.right-a.left:0),d=0===t[0].x||t[0].x===c||0===t[0].y||t[0].y===c;e-h*s<e/4&&(e=h*s+e/4);var f=2*o,p=d?e/2*l%e:(h/2+f)*s*l%e;return r(t,p,e,u,i,h*s,d,!1,c)}function r(t,e,i,n,l,c,u,h,d){for(var f=c/2,p=0,m=0;m<t.length-1;m++)p+=t[m].dist(t[m+1]);for(var g=0,v=e-i,y=[],b=0;b<t.length-1;b++){for(var _=t[b],x=t[b+1],w=_.dist(x),M=x.angleTo(_);v+i<g+w;){v+=i;var z=(v-g)/w,S=a(_.x,x.x,z),E=a(_.y,x.y,z);if(S>=0&&S<d&&E>=0&&E<d&&v-f>=0&&v+f<=p){var k=new o(S,E,M,b)._round();n&&!s(t,k,c,n,l)||y.push(k)}}g+=w}return h||y.length||u||(y=r(t,g/2,i,n,l,c,u,!0,d)),y}var a=t("../util/interpolate"),o=t("../symbol/anchor"),s=t("./check_max_angle");e.exports=n},{"../symbol/anchor":75,"../util/interpolate":121,"./check_max_angle":76}],82:[function(t,e,i){"use strict";var n=t("shelf-pack"),r=t("../util/util"),a=4,o=128,s=2048,l=function(){this.width=o,this.height=o,this.bin=new n(this.width,this.height),this.index={},this.ids={},this.data=new Uint8Array(this.width*this.height)};l.prototype.getGlyphs=function(){var t,e,i,n={};for(var r in this.ids)t=r.split("#"),e=t[0],i=t[1],n[e]||(n[e]=[]),n[e].push(i);return n},l.prototype.getRects=function(){var t,e,i,n=this,r={};for(var a in this.ids)t=a.split("#"),e=t[0],i=t[1],r[e]||(r[e]={}),r[e][i]=n.index[a];return r},l.prototype.addGlyph=function(t,e,i,n){var a=this;if(!i)return null;var o=e+"#"+i.id;if(this.index[o])return this.ids[o].indexOf(t)<0&&this.ids[o].push(t),this.index[o];if(!i.bitmap)return null;var s=i.width+2*n,l=i.height+2*n,c=1,u=s+2*c,h=l+2*c;u+=4-u%4,h+=4-h%4;var d=this.bin.packOne(u,h);if(d||(this.resize(),d=this.bin.packOne(u,h)),!d)return r.warnOnce("glyph bitmap overflow"),null;this.index[o]=d,this.ids[o]=[t];for(var f=this.data,p=i.bitmap,m=0;m<l;m++)for(var g=a.width*(d.y+m+c)+d.x+c,v=s*m,y=0;y<s;y++)f[g+y]=p[v+y];return this.dirty=!0,d},l.prototype.resize=function(){var t=this,e=this.width,i=this.height;if(!(e>=s||i>=s)){this.texture&&(this.gl&&this.gl.deleteTexture(this.texture),this.texture=null),this.width*=a,this.height*=a,this.bin.resize(this.width,this.height);for(var n=new ArrayBuffer(this.width*this.height),r=0;r<i;r++){var o=new Uint8Array(t.data.buffer,i*r,e),l=new Uint8Array(n,i*r*a,e);l.set(o)}this.data=new Uint8Array(n)}},l.prototype.bind=function(t){this.gl=t,this.texture?t.bindTexture(t.TEXTURE_2D,this.texture):(this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texImage2D(t.TEXTURE_2D,0,t.ALPHA,this.width,this.height,0,t.ALPHA,t.UNSIGNED_BYTE,null))},l.prototype.updateTexture=function(t){this.bind(t),this.dirty&&(t.texSubImage2D(t.TEXTURE_2D,0,0,0,this.width,this.height,t.ALPHA,t.UNSIGNED_BYTE,this.data),this.dirty=!1)},e.exports=l},{"../util/util":129,"shelf-pack":200}],83:[function(t,e,i){"use strict";function n(t,e,i,n){return n=n||"abc",i.replace("{s}",n[t.length%n.length]).replace("{fontstack}",t).replace("{range}",e)}var r=t("../util/mapbox").normalizeGlyphsURL,a=t("../util/ajax"),o=t("../util/verticalize_punctuation"),s=t("../util/glyphs"),l=t("../symbol/glyph_atlas"),c=t("pbf"),u=function(t,e,i){var n=1;this.advance=t.advance,this.left=t.left-i-n,this.top=t.top+i+n,this.rect=e},h=function(t){this.url=t&&r(t),this.atlases={},this.stacks={},this.loading={}};h.prototype.getSimpleGlyphs=function(t,e,i,n){var r=this;void 0===this.stacks[t]&&(this.stacks[t]={}),void 0===this.atlases[t]&&(this.atlases[t]=new l);for(var a={},s=this.stacks[t],c=this.atlases[t],h=3,d={},f=0,p=function(e){var n=Math.floor(e/256);if(s[n]){var r=s[n].glyphs[e],o=c.addGlyph(i,t,r,h);r&&(a[e]=new u(r,o,h))}else void 0===d[n]&&(d[n]=[],f++),d[n].push(e)},m=0;m<e.length;m++){var g=e[m],v=String.fromCharCode(g);p(g),o.lookup[v]&&p(o.lookup[v].charCodeAt(0))}f||n(void 0,a,t);var y=function(e,o,s){if(!e)for(var l=r.stacks[t][o]=s.stacks[0],p=0;p<d[o].length;p++){var m=d[o][p],g=l.glyphs[m],v=c.addGlyph(i,t,g,h);g&&(a[m]=new u(g,v,h))}f--,f||n(void 0,a,t)};for(var b in d)r.loadRange(t,b,y)},h.prototype.loadRange=function(t,e,i){if(256*e>65535)return i("glyphs > 65535 not supported");void 0===this.loading[t]&&(this.loading[t]={});var r=this.loading[t];if(r[e])r[e].push(i);else{r[e]=[i];var o=256*e+"-"+(256*e+255),l=n(t,o,this.url);a.getArrayBuffer(l,function(t,i){for(var n=!t&&new s(new c(i.data)),a=0;a<r[e].length;a++)r[e][a](t,e,n);delete r[e]})}},h.prototype.getGlyphAtlas=function(t){return this.atlases[t]},e.exports=h},{"../symbol/glyph_atlas":82,"../util/ajax":109,"../util/glyphs":120,"../util/mapbox":125,"../util/verticalize_punctuation":131,pbf:196}],84:[function(t,e,i){"use strict";e.exports=function(t){function e(e){s.push(t[e]),l++}function i(t,e,i){var n=o[t];return delete o[t],o[e]=n,s[n].geometry[0].pop(),s[n].geometry[0]=s[n].geometry[0].concat(i[0]),n}function n(t,e,i){var n=a[e];return delete a[e],a[t]=n,s[n].geometry[0].shift(),s[n].geometry[0]=i[0].concat(s[n].geometry[0]),n}function r(t,e,i){var n=i?e[0][e[0].length-1]:e[0][0];return t+":"+n.x+":"+n.y}for(var a={},o={},s=[],l=0,c=0;c<t.length;c++){var u=t[c],h=u.geometry,d=u.text;if(d){var f=r(d,h),p=r(d,h,!0);if(f in o&&p in a&&o[f]!==a[p]){var m=n(f,p,h),g=i(f,p,s[m].geometry);delete a[f],delete o[p],o[r(d,s[g].geometry,!0)]=g,s[m].geometry=null}else f in o?i(f,p,h):p in a?n(f,p,h):(e(c),a[f]=l-1,o[p]=l-1)}else e(c)}return s.filter(function(t){return t.geometry})}},{}],85:[function(t,e,i){"use strict";function n(t,e,i,n,r,a,o,s,l,c,u){this.anchorPoint=t,this.tl=e,this.tr=i,this.bl=n,this.br=r,this.tex=a,this.anchorAngle=o,this.glyphAngle=s,this.minScale=l,this.maxScale=c,this.writingMode=u}function r(t,e,i,r,a,o,c,u,h){var d,f,p,m,g=e.image.rect,v=a.layout,y=1,b=e.left-y,_=b+g.w/e.image.pixelRatio,x=e.top-y,w=x+g.h/e.image.pixelRatio;if("none"!==v["icon-text-fit"]&&c){var M=_-b,z=w-x,S=v["text-size"]/24,E=c.left*S,k=c.right*S,T=c.top*S,P=c.bottom*S,O=k-E,A=P-T,I=v["icon-text-fit-padding"][0],C=v["icon-text-fit-padding"][1],L=v["icon-text-fit-padding"][2],D=v["icon-text-fit-padding"][3],R="width"===v["icon-text-fit"]?.5*(A-z):0,B="height"===v["icon-text-fit"]?.5*(O-M):0,j="width"===v["icon-text-fit"]||"both"===v["icon-text-fit"]?O:M,F="height"===v["icon-text-fit"]||"both"===v["icon-text-fit"]?A:z;d=new s(E+B-D,T+R-I),f=new s(E+B+C+j,T+R-I),p=new s(E+B+C+j,T+R+L+F),m=new s(E+B-D,T+R+L+F)}else d=new s(b,x),f=new s(_,x),p=new s(_,w),m=new s(b,w);var N=a.getLayoutValue("icon-rotate",u,h)*Math.PI/180;if(o){var q=r[t.segment];if(t.y===q.y&&t.x===q.x&&t.segment+1<r.length){var V=r[t.segment+1];N+=Math.atan2(t.y-V.y,t.x-V.x)+Math.PI}else N+=Math.atan2(t.y-q.y,t.x-q.x)}if(N){var U=Math.sin(N),H=Math.cos(N),X=[H,-U,U,H];d=d.matMult(X),f=f.matMult(X),m=m.matMult(X),p=p.matMult(X)}return[new n(new s(t.x,t.y),d,f,m,p,e.image.rect,0,0,l,1/0)]}function a(t,e,i,r,a,c){for(var u=a.layout["text-rotate"]*Math.PI/180,h=a.layout["text-keep-upright"],d=e.positionedGlyphs,f=[],p=0;p<d.length;p++){var m=d[p],g=m.glyph;if(g){var v=g.rect;if(v){var y,b=(m.x+g.advance/2)*i,_=l;c?(y=[],_=o(y,t,b,r,t.segment,!0),h&&(_=Math.min(_,o(y,t,b,r,t.segment,!1)))):y=[{anchorPoint:new s(t.x,t.y),offset:0,angle:0,maxScale:1/0,minScale:l}];var x=m.x+g.left,w=m.y-g.top,M=x+v.w,z=w+v.h,S=new s(m.x,g.advance/2),E=new s(x,w),k=new s(M,w),T=new s(x,z),P=new s(M,z);0!==m.angle&&(E._sub(S)._rotate(m.angle)._add(S),k._sub(S)._rotate(m.angle)._add(S),T._sub(S)._rotate(m.angle)._add(S),P._sub(S)._rotate(m.angle)._add(S));for(var O=0;O<y.length;O++){var A=y[O],I=E,C=k,L=T,D=P;if(u){var R=Math.sin(u),B=Math.cos(u),j=[B,-R,R,B];I=I.matMult(j),C=C.matMult(j),L=L.matMult(j),D=D.matMult(j)}var F=Math.max(A.minScale,_),N=(t.angle+A.offset+2*Math.PI)%(2*Math.PI),q=(A.angle+A.offset+2*Math.PI)%(2*Math.PI);f.push(new n(A.anchorPoint,I,C,L,D,v,N,q,F,A.maxScale,e.writingMode))}}}}return f}function o(t,e,i,n,r,a){var o=!a;i<0&&(a=!a),a&&r++;var c=new s(e.x,e.y),u=n[r],h=1/0;i=Math.abs(i);for(var d=l;;){var f=c.dist(u),p=i/f,m=Math.atan2(u.y-c.y,u.x-c.x);if(a||(m+=Math.PI),t.push({anchorPoint:c,offset:o?Math.PI:0,minScale:p,maxScale:h,angle:(m+2*Math.PI)%(2*Math.PI)}),p<=d)break;for(c=u;c.equals(u);)if(r+=a?1:-1,u=n[r],!u)return p;var g=u.sub(c)._unit();c=c.sub(g._mult(f)),h=p}return d}var s=t("point-geometry");e.exports={getIconQuads:r,getGlyphQuads:a,SymbolQuad:n};var l=.5},{"point-geometry":197}],86:[function(t,e,i){"use strict";var n=t("../util/token");e.exports=function(t,e){var i=n(t.properties,e["text-field"]);if(i){i=i.toString();var r=e["text-transform"];return"uppercase"===r?i=i.toLocaleUpperCase():"lowercase"===r&&(i=i.toLocaleLowerCase()),i}}},{"../util/token":128}],87:[function(t,e,i){"use strict";function n(t,e,i,n,r){this.codePoint=t,this.x=e,this.y=i,this.glyph=n||null,this.angle=r}function r(t,e,i,n,r,a,o){this.positionedGlyphs=t,this.text=e,this.top=i,this.bottom=n,this.left=r,this.right=a,this.writingMode=o}function a(t,e){for(var i=[],n=0,r=0,a=e;r<a.length;r+=1){var o=a[r];i.push(t.substring(n,o)),n=o}return n<t.length&&i.push(t.substring(n,t.length)),i}function o(t,e,i,n,o,s,l,c,u,h,p){var m=t.trim();p===x.vertical&&(m=b(m));var g,v=[],y=new r(v,m,u[1],u[1],u[0],u[0],p);return g=_.processBidirectionalText?_.processBidirectionalText(m,d(m,c,i,e)):a(m,d(m,c,i,e)),f(y,e,g,n,o,s,l,u,p,c,h),!!v.length&&y}function s(t,e,i,n){var r=0;for(var a in t){var o=n[t.charCodeAt(a)];o&&(r+=o.advance+e)}var s=Math.max(1,Math.ceil(r/i));return r/s}function l(t,e,i,n){var r=Math.pow(t-e,2);return n?t<e?r/2:2*r:r+Math.abs(i)*i}function c(t,e){var i=0;return 10===t&&(i-=1e4),40!==t&&65288!==t||(i+=50),41!==e&&65289!==e||(i+=50),i}function u(t,e,i,n,r,a){for(var o=null,s=l(e,i,r,a),c=0,u=n;c<u.length;c+=1){var h=u[c],d=e-h.x,f=l(d,i,r,a)+h.badness;f<=s&&(o=h,s=f)}return{index:t,x:e,priorBreak:o,badness:s}}function h(t){return t?h(t.priorBreak).concat(t.index):[]}function d(t,e,i,n){if(!i)return[];if(!t)return[];for(var r=[],a=s(t,e,i,n),o=0,l=0;l<t.length;l++){var d=t.charCodeAt(l),f=n[d];f&&!w[d]&&(o+=f.advance+e),l<t.length-1&&(M[d]||y.charAllowsIdeographicBreaking(d))&&r.push(u(l+1,o,a,r,c(d,t.charCodeAt(l+1)),!1))}return h(u(t.length,o,a,r,0,!0))}function f(t,e,i,r,a,o,s,l,c,u,h){var d=-17,f=0,g=d,v=0,b=t.positionedGlyphs;for(var _ in i){var w=i[_].trim();if(w.length){for(var M=b.length,z=0;z<w.length;z++){var S=w.charCodeAt(z),E=e[S];E&&(y.charHasUprightVerticalOrientation(S)&&c!==x.horizontal?(b.push(new n(S,f,0,E,-Math.PI/2)),f+=h+u):(b.push(new n(S,f,g,E,0)),f+=E.advance+u))}if(b.length!==M){var k=f-u;v=Math.max(k,v),p(b,e,M,b.length-1,s)}f=0,g+=r}else g+=r}m(b,s,a,o,v,r,i.length,l);var T=i.length*r;t.top+=-o*T,t.bottom=t.top+T,t.left+=-a*v,t.right=t.left+v}function p(t,e,i,n,r){if(r)for(var a=e[t[n].codePoint].advance,o=(t[n].x+a)*r,s=i;s<=n;s++)t[s].x-=o}function m(t,e,i,n,r,a,o,s){for(var l=(e-i)*r+s[0],c=(-n*o+.5)*a+s[1],u=0;u<t.length;u++)t[u].x+=l,t[u].y+=c}function g(t,e){if(!t||!t.rect)return null;var i=e[0],n=e[1],r=i-t.width/2,a=r+t.width,o=n-t.height/2,s=o+t.height;return new v(t,o,s,r,a)}function v(t,e,i,n,r){this.image=t,this.top=e,this.bottom=i,this.left=n,this.right=r}var y=t("../util/script_detection"),b=t("../util/verticalize_punctuation"),_=t("../source/rtl_text_plugin"),x={horizontal:1,vertical:2};e.exports={shapeText:o,shapeIcon:g,WritingMode:x};var w={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},M={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0}},{"../source/rtl_text_plugin":49,"../util/script_detection":126,"../util/verticalize_punctuation":131}],88:[function(t,e,i){"use strict";function n(t,e,i,n,r,a,o,s,l,c,u){var h,d,f=n*e+i,p=s*a+o;if(u)for(p-=a,d=-1;d<=c;d++,f=((d+c)%c+n)*e+i,p+=a)for(h=-1;h<=l;h++)r[p+h]=t[f+(h+l)%l];else for(d=0;d<c;d++,f+=e,p+=a)for(h=0;h<l;h++)r[p+h]=t[f+h]}var r=t("shelf-pack"),a=t("../util/browser"),o=t("../util/util"),s=function(t,e,i,n,r){this.rect=t,this.width=e,this.height=i,this.sdf=n,this.pixelRatio=r},l=function(t,e){this.width=t,this.height=e,this.bin=new r(t,e),this.images={},
this.data=!1,this.texture=0,this.filter=0,this.pixelRatio=1,this.dirty=!0};l.prototype.allocateImage=function(t,e){t/=this.pixelRatio,e/=this.pixelRatio;var i=2,n=t+i+(4-(t+i)%4),r=e+i+(4-(e+i)%4),a=this.bin.packOne(n,r);return a?a:(o.warnOnce("SpriteAtlas out of space."),null)},l.prototype.getImage=function(t,e){if(this.images[t])return this.images[t];if(!this.sprite)return null;var i=this.sprite.getSpritePosition(t);if(!i.width||!i.height)return null;var n=this.allocateImage(i.width,i.height);if(!n)return null;var r=new s(n,i.width/i.pixelRatio,i.height/i.pixelRatio,i.sdf,i.pixelRatio/this.pixelRatio);return this.images[t]=r,this.copy(n,i,e),r},l.prototype.getPosition=function(t,e){var i=this.getImage(t,e),n=i&&i.rect;if(!n)return null;var r=i.width*i.pixelRatio,a=i.height*i.pixelRatio,o=1;return{size:[i.width,i.height],tl:[(n.x+o)/this.width,(n.y+o)/this.height],br:[(n.x+o+r)/this.width,(n.y+o+a)/this.height]}},l.prototype.allocate=function(){var t=this;if(!this.data){var e=Math.floor(this.width*this.pixelRatio),i=Math.floor(this.height*this.pixelRatio);this.data=new Uint32Array(e*i);for(var n=0;n<this.data.length;n++)t.data[n]=0}},l.prototype.copy=function(t,e,i){if(this.sprite.imgData){var r=new Uint32Array(this.sprite.imgData.buffer);this.allocate();var a=this.data,o=1;n(r,this.sprite.width,e.x,e.y,a,this.width*this.pixelRatio,(t.x+o)*this.pixelRatio,(t.y+o)*this.pixelRatio,e.width,e.height,i),this.dirty=!0}},l.prototype.setSprite=function(t){t&&(this.pixelRatio=a.devicePixelRatio>1?2:1,this.canvas&&(this.canvas.width=this.width*this.pixelRatio,this.canvas.height=this.height*this.pixelRatio)),this.sprite=t},l.prototype.addIcons=function(t,e){for(var i=this,n=0;n<t.length;n++)i.getImage(t[n]);e(null,this.images)},l.prototype.bind=function(t,e){var i=!1;this.texture?t.bindTexture(t.TEXTURE_2D,this.texture):(this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),i=!0);var n=e?t.LINEAR:t.NEAREST;n!==this.filter&&(t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,n),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,n),this.filter=n),this.dirty&&(this.allocate(),i?t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.width*this.pixelRatio,this.height*this.pixelRatio,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(this.data.buffer)):t.texSubImage2D(t.TEXTURE_2D,0,0,0,this.width*this.pixelRatio,this.height*this.pixelRatio,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(this.data.buffer)),this.dirty=!1)},e.exports=l},{"../util/browser":110,"../util/util":129,"shelf-pack":200}],89:[function(t,e,i){"use strict";var n=t("../util/struct_array"),r=t("point-geometry"),a=n({members:[{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"glyphQuadStartIndex"},{type:"Uint16",name:"glyphQuadEndIndex"},{type:"Uint16",name:"iconQuadStartIndex"},{type:"Uint16",name:"iconQuadEndIndex"},{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int8",name:"index"},{type:"Uint8",name:"writingModes"}]});Object.defineProperty(a.prototype.StructType.prototype,"anchorPoint",{get:function(){return new r(this.anchorPointX,this.anchorPointY)}}),e.exports=a},{"../util/struct_array":127,"point-geometry":197}],90:[function(t,e,i){"use strict";var n=t("../util/struct_array"),r=t("point-geometry"),a=t("./quads").SymbolQuad,o=n({members:[{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Float32",name:"tlX"},{type:"Float32",name:"tlY"},{type:"Float32",name:"trX"},{type:"Float32",name:"trY"},{type:"Float32",name:"blX"},{type:"Float32",name:"blY"},{type:"Float32",name:"brX"},{type:"Float32",name:"brY"},{type:"Int16",name:"texH"},{type:"Int16",name:"texW"},{type:"Int16",name:"texX"},{type:"Int16",name:"texY"},{type:"Float32",name:"anchorAngle"},{type:"Float32",name:"glyphAngle"},{type:"Float32",name:"maxScale"},{type:"Float32",name:"minScale"},{type:"Uint8",name:"writingMode"}]});Object.defineProperty(o.prototype.StructType.prototype,"anchorPoint",{get:function(){return new r(this.anchorPointX,this.anchorPointY)}}),Object.defineProperty(o.prototype.StructType.prototype,"SymbolQuad",{get:function(){return new a(this.anchorPoint,new r(this.tlX,this.tlY),new r(this.trX,this.trY),new r(this.blX,this.blY),new r(this.brX,this.brY),{x:this.texX,y:this.texY,h:this.texH,w:this.texW,height:this.texH,width:this.texW},this.anchorAngle,this.glyphAngle,this.minScale,this.maxScale,this.writingMode)}}),e.exports=o},{"../util/struct_array":127,"./quads":85,"point-geometry":197}],91:[function(t,e,i){"use strict";var n=t("../util/dom"),r=t("point-geometry"),a={scrollZoom:t("./handler/scroll_zoom"),boxZoom:t("./handler/box_zoom"),dragRotate:t("./handler/drag_rotate"),dragPan:t("./handler/drag_pan"),keyboard:t("./handler/keyboard"),doubleClickZoom:t("./handler/dblclick_zoom"),touchZoomRotate:t("./handler/touch_zoom_rotate")};e.exports=function(t,e){function i(t){v("mouseout",t)}function o(e){t.stop(),w=n.mousePos(b,e),v("mousedown",e),x=!0}function s(e){var i=t.dragRotate&&t.dragRotate.isActive();_&&!i&&v("contextmenu",_),_=null,x=!1,v("mouseup",e)}function l(e){if(!(t.dragPan&&t.dragPan.isActive()||t.dragRotate&&t.dragRotate.isActive())){for(var i=e.toElement||e.target;i&&i!==b;)i=i.parentNode;i===b&&v("mousemove",e)}}function c(e){t.stop(),y("touchstart",e),!e.touches||e.touches.length>1||(M?(clearTimeout(M),M=null,v("dblclick",e)):M=setTimeout(f,300))}function u(t){y("touchmove",t)}function h(t){y("touchend",t)}function d(t){y("touchcancel",t)}function f(){M=null}function p(t){var e=n.mousePos(b,t);e.equals(w)&&v("click",t)}function m(t){v("dblclick",t),t.preventDefault()}function g(e){var i=t.dragRotate&&t.dragRotate.isActive();x||i?x&&(_=e):v("contextmenu",e),e.preventDefault()}function v(e,i){var r=n.mousePos(b,i);return t.fire(e,{lngLat:t.unproject(r),point:r,originalEvent:i})}function y(e,i){var a=n.touchPos(b,i),o=a.reduce(function(t,e,i,n){return t.add(e.div(n.length))},new r(0,0));return t.fire(e,{lngLat:t.unproject(o),point:o,lngLats:a.map(function(e){return t.unproject(e)},this),points:a,originalEvent:i})}var b=t.getCanvasContainer(),_=null,x=!1,w=null,M=null;for(var z in a)t[z]=new a[z](t,e),e.interactive&&e[z]&&t[z].enable(e[z]);b.addEventListener("mouseout",i,!1),b.addEventListener("mousedown",o,!1),b.addEventListener("mouseup",s,!1),b.addEventListener("mousemove",l,!1),b.addEventListener("touchstart",c,!1),b.addEventListener("touchend",h,!1),b.addEventListener("touchmove",u,!1),b.addEventListener("touchcancel",d,!1),b.addEventListener("click",p,!1),b.addEventListener("dblclick",m,!1),b.addEventListener("contextmenu",g,!1)}},{"../util/dom":117,"./handler/box_zoom":97,"./handler/dblclick_zoom":98,"./handler/drag_pan":99,"./handler/drag_rotate":100,"./handler/keyboard":101,"./handler/scroll_zoom":102,"./handler/touch_zoom_rotate":103,"point-geometry":197}],92:[function(t,e,i){"use strict";var n=t("../util/util"),r=t("../util/interpolate"),a=t("../util/browser"),o=t("../geo/lng_lat"),s=t("../geo/lng_lat_bounds"),l=t("point-geometry"),c=t("../util/evented"),u=function(t){function e(e,i){t.call(this),this.moving=!1,this.transform=e,this._bearingSnap=i.bearingSnap}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getCenter=function(){return this.transform.center},e.prototype.setCenter=function(t,e){return this.jumpTo({center:t},e),this},e.prototype.panBy=function(t,e,i){return this.panTo(this.transform.center,n.extend({offset:l.convert(t).mult(-1)},e),i),this},e.prototype.panTo=function(t,e,i){return this.easeTo(n.extend({center:t},e),i)},e.prototype.getZoom=function(){return this.transform.zoom},e.prototype.setZoom=function(t,e){return this.jumpTo({zoom:t},e),this},e.prototype.zoomTo=function(t,e,i){return this.easeTo(n.extend({zoom:t},e),i)},e.prototype.zoomIn=function(t,e){return this.zoomTo(this.getZoom()+1,t,e),this},e.prototype.zoomOut=function(t,e){return this.zoomTo(this.getZoom()-1,t,e),this},e.prototype.getBearing=function(){return this.transform.bearing},e.prototype.setBearing=function(t,e){return this.jumpTo({bearing:t},e),this},e.prototype.rotateTo=function(t,e,i){return this.easeTo(n.extend({bearing:t},e),i)},e.prototype.resetNorth=function(t,e){return this.rotateTo(0,n.extend({duration:1e3},t),e),this},e.prototype.snapToNorth=function(t,e){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,e):this},e.prototype.getPitch=function(){return this.transform.pitch},e.prototype.setPitch=function(t,e){return this.jumpTo({pitch:t},e),this},e.prototype.fitBounds=function(t,e,i){e=n.extend({padding:0,offset:[0,0],maxZoom:this.getMaxZoom()},e),t=s.convert(t);var r=l.convert(e.offset),a=this.transform,o=a.project(t.getNorthWest()),c=a.project(t.getSouthEast()),u=c.sub(o),h=(a.width-2*e.padding-2*Math.abs(r.x))/u.x,d=(a.height-2*e.padding-2*Math.abs(r.y))/u.y;return e.center=a.unproject(o.add(c).div(2)),e.zoom=Math.min(a.scaleZoom(a.scale*Math.min(h,d)),e.maxZoom),e.bearing=0,e.linear?this.easeTo(e,i):this.flyTo(e,i)},e.prototype.jumpTo=function(t,e){this.stop();var i=this.transform,n=!1,r=!1,a=!1;return"zoom"in t&&i.zoom!==+t.zoom&&(n=!0,i.zoom=+t.zoom),"center"in t&&(i.center=o.convert(t.center)),"bearing"in t&&i.bearing!==+t.bearing&&(r=!0,i.bearing=+t.bearing),"pitch"in t&&i.pitch!==+t.pitch&&(a=!0,i.pitch=+t.pitch),this.fire("movestart",e).fire("move",e),n&&this.fire("zoomstart",e).fire("zoom",e).fire("zoomend",e),r&&this.fire("rotate",e),a&&this.fire("pitch",e),this.fire("moveend",e)},e.prototype.easeTo=function(t,e){var i=this;this.stop(),t=n.extend({offset:[0,0],duration:500,easing:n.ease},t);var a,s,c=this.transform,u=l.convert(t.offset),h=this.getZoom(),d=this.getBearing(),f=this.getPitch(),p="zoom"in t?+t.zoom:h,m="bearing"in t?this._normalizeBearing(t.bearing,d):d,g="pitch"in t?+t.pitch:f;"center"in t?(a=o.convert(t.center),s=c.centerPoint.add(u)):"around"in t?(a=o.convert(t.around),s=c.locationPoint(a)):(s=c.centerPoint.add(u),a=c.pointLocation(s));var v=c.locationPoint(a);return t.animate===!1&&(t.duration=0),this.zooming=p!==h,this.rotating=d!==m,this.pitching=g!==f,t.smoothEasing&&0!==t.duration&&(t.easing=this._smoothOutEasing(t.duration)),t.noMoveStart||(this.moving=!0,this.fire("movestart",e)),this.zooming&&this.fire("zoomstart",e),clearTimeout(this._onEaseEnd),this._ease(function(t){this.zooming&&(c.zoom=r(h,p,t)),this.rotating&&(c.bearing=r(d,m,t)),this.pitching&&(c.pitch=r(f,g,t)),c.setLocationAtPoint(a,v.add(s.sub(v)._mult(t))),this.fire("move",e),this.zooming&&this.fire("zoom",e),this.rotating&&this.fire("rotate",e),this.pitching&&this.fire("pitch",e)},function(){t.delayEndEvents?i._onEaseEnd=setTimeout(i._easeToEnd.bind(i,e),t.delayEndEvents):i._easeToEnd(e)},t),this},e.prototype._easeToEnd=function(t){var e=this.zooming;this.moving=!1,this.zooming=!1,this.rotating=!1,this.pitching=!1,e&&this.fire("zoomend",t),this.fire("moveend",t)},e.prototype.flyTo=function(t,e){function i(t){var e=(z*z-M*M+(t?-1:1)*T*T*S*S)/(2*(t?z:M)*T*S);return Math.log(Math.sqrt(e*e+1)-e)}function a(t){return(Math.exp(t)-Math.exp(-t))/2}function s(t){return(Math.exp(t)+Math.exp(-t))/2}function c(t){return a(t)/s(t)}this.stop(),t=n.extend({offset:[0,0],speed:1.2,curve:1.42,easing:n.ease},t);var u=this.transform,h=l.convert(t.offset),d=this.getZoom(),f=this.getBearing(),p=this.getPitch(),m="center"in t?o.convert(t.center):this.getCenter(),g="zoom"in t?+t.zoom:d,v="bearing"in t?this._normalizeBearing(t.bearing,f):f,y="pitch"in t?+t.pitch:p;Math.abs(u.center.lng)+Math.abs(m.lng)>180&&(u.center.lng>0&&m.lng<0?m.lng+=360:u.center.lng<0&&m.lng>0&&(m.lng-=360));var b=u.zoomScale(g-d),_=u.point,x="center"in t?u.project(m).sub(h.div(b)):_,w=t.curve,M=Math.max(u.width,u.height),z=M/b,S=x.sub(_).mag();if("minZoom"in t){var E=n.clamp(Math.min(t.minZoom,d,g),u.minZoom,u.maxZoom),k=M/u.zoomScale(E-d);w=Math.sqrt(k/S*2)}var T=w*w,P=i(0),O=function(t){return s(P)/s(P+w*t)},A=function(t){return M*((s(P)*c(P+w*t)-a(P))/T)/S},I=(i(1)-P)/w;if(Math.abs(S)<1e-6){if(Math.abs(M-z)<1e-6)return this.easeTo(t);var C=z<M?-1:1;I=Math.abs(Math.log(z/M))/w,A=function(){return 0},O=function(t){return Math.exp(C*w*t)}}if("duration"in t)t.duration=+t.duration;else{var L="screenSpeed"in t?+t.screenSpeed/w:+t.speed;t.duration=1e3*I/L}return this.moving=!0,this.zooming=!0,f!==v&&(this.rotating=!0),p!==y&&(this.pitching=!0),this.fire("movestart",e),this.fire("zoomstart",e),this._ease(function(t){var i=t*I,n=A(i),a=1/O(i);u.zoom=d+u.scaleZoom(a),u.center=u.unproject(_.add(x.sub(_).mult(n)).mult(a)),this.rotating&&(u.bearing=r(f,v,t)),this.pitching&&(u.pitch=r(p,y,t)),this.fire("move",e),this.fire("zoom",e),this.rotating&&this.fire("rotate",e),this.pitching&&this.fire("pitch",e)},function(){this.moving=!1,this.zooming=!1,this.rotating=!1,this.pitching=!1,this.fire("zoomend",e),this.fire("moveend",e)},t),this},e.prototype.isEasing=function(){return!!this._abortFn},e.prototype.isMoving=function(){return this.moving},e.prototype.stop=function(){return this._abortFn&&(this._abortFn(),this._finishEase()),this},e.prototype._ease=function(t,e,i){this._finishFn=e,this._abortFn=a.timed(function(e){t.call(this,i.easing(e)),1===e&&this._finishEase()},i.animate===!1?0:i.duration,this)},e.prototype._finishEase=function(){delete this._abortFn;var t=this._finishFn;delete this._finishFn,t.call(this)},e.prototype._normalizeBearing=function(t,e){t=n.wrap(t,-180,180);var i=Math.abs(t-e);return Math.abs(t-360-e)<i&&(t-=360),Math.abs(t+360-e)<i&&(t+=360),t},e.prototype._smoothOutEasing=function(t){var e=n.ease;if(this._prevEase){var i=this._prevEase,r=(Date.now()-i.start)/i.duration,a=i.easing(r+.01)-i.easing(r),o=.27/Math.sqrt(a*a+1e-4)*.01,s=Math.sqrt(.0729-o*o);e=n.bezier(o,s,.25,1)}return this._prevEase={start:(new Date).getTime(),duration:t,easing:e},e},e}(c);e.exports=u},{"../geo/lng_lat":19,"../geo/lng_lat_bounds":20,"../util/browser":110,"../util/evented":118,"../util/interpolate":121,"../util/util":129,"point-geometry":197}],93:[function(t,e,i){"use strict";var n=t("../../util/dom"),r=t("../../util/util"),a=function(t){this.options=t,r.bindAll(["_updateEditLink","_updateData","_updateCompact"],this)};a.prototype.getDefaultPosition=function(){return"bottom-right"},a.prototype.onAdd=function(t){var e=this.options&&this.options.compact;return this._map=t,this._container=n.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),e&&this._container.classList.add("compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("data",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===e&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},a.prototype.onRemove=function(){this._container.parentNode.removeChild(this._container),this._map.off("data",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0},a.prototype._updateEditLink=function(){if(this._editLink||(this._editLink=this._container.querySelector(".mapbox-improve-map")),this._editLink){var t=this._map.getCenter();this._editLink.href="https://www.mapbox.com/map-feedback/#/"+t.lng+"/"+t.lat+"/"+Math.round(this._map.getZoom()+1)}},a.prototype._updateData=function(t){"source"===t.dataType&&(this._updateAttributions(),this._updateEditLink())},a.prototype._updateAttributions=function(){if(this._map.style){var t=[],e=this._map.style.sourceCaches;for(var i in e){var n=e[i].getSource();n.attribution&&t.indexOf(n.attribution)<0&&t.push(n.attribution)}t.sort(function(t,e){return t.length-e.length}),t=t.filter(function(e,i){for(var n=i+1;n<t.length;n++)if(t[n].indexOf(e)>=0)return!1;return!0}),this._container.innerHTML=t.join(" | "),this._editLink=null}},a.prototype._updateCompact=function(){var t=this._map.getCanvasContainer().offsetWidth<=640;this._container.classList[t?"add":"remove"]("compact")},e.exports=a},{"../../util/dom":117,"../../util/util":129}],94:[function(t,e,i){"use strict";function n(t){void 0!==r?t(r):void 0!==s.navigator.permissions?s.navigator.permissions.query({name:"geolocation"}).then(function(e){r="denied"!==e.state,t(r)}):(r=!!s.navigator.geolocation,t(r))}var r,a=t("../../util/evented"),o=t("../../util/dom"),s=t("../../util/window"),l=t("../../util/util"),c={enableHighAccuracy:!1,timeout:6e3},u="mapboxgl-ctrl",h=function(t){function e(e){t.call(this),this.options=e||{},l.bindAll(["_onSuccess","_onError","_finish","_setupUI"],this)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.onAdd=function(t){return this._map=t,this._container=o.create("div",u+" "+u+"-group"),n(this._setupUI),this._container},e.prototype.onRemove=function(){this._container.parentNode.removeChild(this._container),this._map=void 0},e.prototype._onSuccess=function(t){this._map.jumpTo({center:[t.coords.longitude,t.coords.latitude],zoom:17,bearing:0,pitch:0}),this.fire("geolocate",t),this._finish()},e.prototype._onError=function(t){this.fire("error",t),this._finish()},e.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},e.prototype._setupUI=function(t){t!==!1&&(this._container.addEventListener("contextmenu",function(t){return t.preventDefault()}),this._geolocateButton=o.create("button",u+"-icon "+u+"-geolocate",this._container),this._geolocateButton.type="button",this._geolocateButton.setAttribute("aria-label","Geolocate"),this.options.watchPosition&&this._geolocateButton.setAttribute("aria-pressed",!1),this._geolocateButton.addEventListener("click",this._onClickGeolocate.bind(this)))},e.prototype._onClickGeolocate=function(){var t=l.extend(c,this.options&&this.options.positionOptions||{});this.options.watchPosition?void 0!==this._geolocationWatchID?(this._geolocateButton.classList.remove("watching"),this._geolocateButton.setAttribute("aria-pressed",!1),s.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0):(this._geolocateButton.classList.add("watching"),this._geolocateButton.setAttribute("aria-pressed",!0),this._geolocationWatchID=s.navigator.geolocation.watchPosition(this._onSuccess,this._onError,t)):(s.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,t),this._timeoutId=setTimeout(this._finish,1e4))},e}(a);e.exports=h},{"../../util/dom":117,"../../util/evented":118,"../../util/util":129,"../../util/window":112}],95:[function(t,e,i){"use strict";function n(t){return new a.MouseEvent(t.type,{button:2,buttons:2,bubbles:!0,cancelable:!0,detail:t.detail,view:t.view,screenX:t.screenX,screenY:t.screenY,clientX:t.clientX,clientY:t.clientY,movementX:t.movementX,movementY:t.movementY,ctrlKey:t.ctrlKey,shiftKey:t.shiftKey,altKey:t.altKey,metaKey:t.metaKey})}var r=t("../../util/dom"),a=t("../../util/window"),o=t("../../util/util"),s="mapboxgl-ctrl",l=function(){o.bindAll(["_rotateCompassArrow"],this)};l.prototype._rotateCompassArrow=function(){var t="rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassArrow.style.transform=t},l.prototype.onAdd=function(t){return this._map=t,this._container=r.create("div",s+" "+s+"-group",t.getContainer()),this._container.addEventListener("contextmenu",this._onContextMenu.bind(this)),this._zoomInButton=this._createButton(s+"-icon "+s+"-zoom-in","Zoom In",t.zoomIn.bind(t)),this._zoomOutButton=this._createButton(s+"-icon "+s+"-zoom-out","Zoom Out",t.zoomOut.bind(t)),this._compass=this._createButton(s+"-icon "+s+"-compass","Reset North",t.resetNorth.bind(t)),this._compassArrow=r.create("span","arrow",this._compass),this._compass.addEventListener("mousedown",this._onCompassDown.bind(this)),this._onCompassMove=this._onCompassMove.bind(this),this._onCompassUp=this._onCompassUp.bind(this),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._container},l.prototype.onRemove=function(){this._container.parentNode.removeChild(this._container),this._map.off("rotate",this._rotateCompassArrow),this._map=void 0},l.prototype._onContextMenu=function(t){t.preventDefault()},l.prototype._onCompassDown=function(t){0===t.button&&(r.disableDrag(),a.document.addEventListener("mousemove",this._onCompassMove),a.document.addEventListener("mouseup",this._onCompassUp),this._map.getCanvasContainer().dispatchEvent(n(t)),t.stopPropagation())},l.prototype._onCompassMove=function(t){0===t.button&&(this._map.getCanvasContainer().dispatchEvent(n(t)),t.stopPropagation())},l.prototype._onCompassUp=function(t){0===t.button&&(a.document.removeEventListener("mousemove",this._onCompassMove),a.document.removeEventListener("mouseup",this._onCompassUp),r.enableDrag(),this._map.getCanvasContainer().dispatchEvent(n(t)),t.stopPropagation())},l.prototype._createButton=function(t,e,i){var n=r.create("button",t,this._container);return n.type="button",n.setAttribute("aria-label",e),n.addEventListener("click",function(){i()}),n},e.exports=l},{"../../util/dom":117,"../../util/util":129,"../../util/window":112}],96:[function(t,e,i){"use strict";function n(t,e,i){var n=i&&i.maxWidth||100,o=t._container.clientHeight/2,s=a(t.unproject([0,o]),t.unproject([n,o]));if(i&&"imperial"===i.unit){var l=3.2808*s;if(l>5280){var c=l/5280;r(e,n,c,"mi")}else r(e,n,l,"ft")}else r(e,n,s,"m")}function r(t,e,i,n){var r=o(i),a=r/i;"m"===n&&r>=1e3&&(r/=1e3,n="km"),t.style.width=e*a+"px",t.innerHTML=r+n}function a(t,e){var i=6371e3,n=Math.PI/180,r=t.lat*n,a=e.lat*n,o=Math.sin(r)*Math.sin(a)+Math.cos(r)*Math.cos(a)*Math.cos((e.lng-t.lng)*n),s=i*Math.acos(Math.min(o,1));return s}function o(t){var e=Math.pow(10,(""+Math.floor(t)).length-1),i=t/e;return i=i>=10?10:i>=5?5:i>=3?3:i>=2?2:1,e*i}var s=t("../../util/dom"),l=t("../../util/util"),c=function(t){this.options=t,l.bindAll(["_onMove"],this)};c.prototype.getDefaultPosition=function(){return"bottom-left"},c.prototype._onMove=function(){n(this._map,this._container,this.options)},c.prototype.onAdd=function(t){return this._map=t,this._container=s.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",t.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},c.prototype.onRemove=function(){this._container.parentNode.removeChild(this._container),this._map.off("move",this._onMove),this._map=void 0},e.exports=c},{"../../util/dom":117,"../../util/util":129}],97:[function(t,e,i){"use strict";var n=t("../../util/dom"),r=t("../../geo/lng_lat_bounds"),a=t("../../util/util"),o=t("../../util/window"),s=function(t){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),a.bindAll(["_onMouseDown","_onMouseMove","_onMouseUp","_onKeyDown"],this)};s.prototype.isEnabled=function(){return!!this._enabled},s.prototype.isActive=function(){return!!this._active},s.prototype.enable=function(){this.isEnabled()||(this._el.addEventListener("mousedown",this._onMouseDown,!1),this._enabled=!0)},s.prototype.disable=function(){this.isEnabled()&&(this._el.removeEventListener("mousedown",this._onMouseDown),this._enabled=!1)},s.prototype._onMouseDown=function(t){t.shiftKey&&0===t.button&&(o.document.addEventListener("mousemove",this._onMouseMove,!1),o.document.addEventListener("keydown",this._onKeyDown,!1),o.document.addEventListener("mouseup",this._onMouseUp,!1),n.disableDrag(),this._startPos=n.mousePos(this._el,t),this._active=!0)},s.prototype._onMouseMove=function(t){var e=this._startPos,i=n.mousePos(this._el,t);this._box||(this._box=n.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));var r=Math.min(e.x,i.x),a=Math.max(e.x,i.x),o=Math.min(e.y,i.y),s=Math.max(e.y,i.y);n.setTransform(this._box,"translate("+r+"px,"+o+"px)"),this._box.style.width=a-r+"px",this._box.style.height=s-o+"px"},s.prototype._onMouseUp=function(t){if(0===t.button){var e=this._startPos,i=n.mousePos(this._el,t),a=(new r).extend(this._map.unproject(e)).extend(this._map.unproject(i));this._finish(),e.x===i.x&&e.y===i.y?this._fireEvent("boxzoomcancel",t):this._map.fitBounds(a,{linear:!0}).fire("boxzoomend",{originalEvent:t,boxZoomBounds:a})}},s.prototype._onKeyDown=function(t){27===t.keyCode&&(this._finish(),this._fireEvent("boxzoomcancel",t))},s.prototype._finish=function(){this._active=!1,o.document.removeEventListener("mousemove",this._onMouseMove,!1),o.document.removeEventListener("keydown",this._onKeyDown,!1),o.document.removeEventListener("mouseup",this._onMouseUp,!1),this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.parentNode.removeChild(this._box),this._box=null),n.enableDrag()},s.prototype._fireEvent=function(t,e){return this._map.fire(t,{originalEvent:e})},e.exports=s},{"../../geo/lng_lat_bounds":20,"../../util/dom":117,"../../util/util":129,"../../util/window":112}],98:[function(t,e,i){"use strict";var n=function(t){this._map=t,this._onDblClick=this._onDblClick.bind(this)};n.prototype.isEnabled=function(){return!!this._enabled},n.prototype.enable=function(){this.isEnabled()||(this._map.on("dblclick",this._onDblClick),this._enabled=!0)},n.prototype.disable=function(){this.isEnabled()&&(this._map.off("dblclick",this._onDblClick),this._enabled=!1)},n.prototype._onDblClick=function(t){this._map.zoomTo(this._map.getZoom()+(t.originalEvent.shiftKey?-1:1),{around:t.lngLat},t)},e.exports=n},{}],99:[function(t,e,i){"use strict";var n=t("../../util/dom"),r=t("../../util/util"),a=t("../../util/window"),o=.3,s=r.bezier(0,0,o,1),l=1400,c=2500,u=function(t){this._map=t,this._el=t.getCanvasContainer(),r.bindAll(["_onDown","_onMove","_onUp","_onTouchEnd","_onMouseUp"],this)};u.prototype.isEnabled=function(){return!!this._enabled},u.prototype.isActive=function(){return!!this._active},u.prototype.enable=function(){this.isEnabled()||(this._el.addEventListener("mousedown",this._onDown),this._el.addEventListener("touchstart",this._onDown),this._enabled=!0)},u.prototype.disable=function(){this.isEnabled()&&(this._el.removeEventListener("mousedown",this._onDown),this._el.removeEventListener("touchstart",this._onDown),this._enabled=!1)},u.prototype._onDown=function(t){this._ignoreEvent(t)||this.isActive()||(t.touches?(a.document.addEventListener("touchmove",this._onMove),a.document.addEventListener("touchend",this._onTouchEnd)):(a.document.addEventListener("mousemove",this._onMove),a.document.addEventListener("mouseup",this._onMouseUp)),this._active=!1,this._startPos=this._pos=n.mousePos(this._el,t),this._inertia=[[Date.now(),this._pos]])},u.prototype._onMove=function(t){if(!this._ignoreEvent(t)){this.isActive()||(this._active=!0,this._fireEvent("dragstart",t),this._fireEvent("movestart",t));var e=n.mousePos(this._el,t),i=this._map;i.stop(),this._drainInertiaBuffer(),this._inertia.push([Date.now(),e]),i.transform.setLocationAtPoint(i.transform.pointLocation(this._pos),e),this._fireEvent("drag",t),this._fireEvent("move",t),this._pos=e,t.preventDefault()}},u.prototype._onUp=function(t){var e=this;if(this.isActive()){this._active=!1,this._fireEvent("dragend",t),this._drainInertiaBuffer();var i=function(){return e._fireEvent("moveend",t)},n=this._inertia;if(n.length<2)return void i();var r=n[n.length-1],a=n[0],u=r[1].sub(a[1]),h=(r[0]-a[0])/1e3;if(0===h||r[1].equals(a[1]))return void i();var d=u.mult(o/h),f=d.mag();f>l&&(f=l,d._unit()._mult(f));var p=f/(c*o),m=d.mult(-p/2);this._map.panBy(m,{duration:1e3*p,easing:s,noMoveStart:!0},{originalEvent:t})}},u.prototype._onMouseUp=function(t){this._ignoreEvent(t)||(this._onUp(t),a.document.removeEventListener("mousemove",this._onMove),a.document.removeEventListener("mouseup",this._onMouseUp))},u.prototype._onTouchEnd=function(t){this._ignoreEvent(t)||(this._onUp(t),a.document.removeEventListener("touchmove",this._onMove),a.document.removeEventListener("touchend",this._onTouchEnd))},u.prototype._fireEvent=function(t,e){return this._map.fire(t,{originalEvent:e})},u.prototype._ignoreEvent=function(t){var e=this._map;if(e.boxZoom&&e.boxZoom.isActive())return!0;if(e.dragRotate&&e.dragRotate.isActive())return!0;if(t.touches)return t.touches.length>1;if(t.ctrlKey)return!0;var i=1,n=0;return"mousemove"===t.type?t.buttons&0===i:t.button!==n},u.prototype._drainInertiaBuffer=function(){for(var t=this._inertia,e=Date.now(),i=160;t.length>0&&e-t[0][0]>i;)t.shift()},e.exports=u},{"../../util/dom":117,"../../util/util":129,"../../util/window":112}],100:[function(t,e,i){"use strict";var n=t("../../util/dom"),r=t("../../util/util"),a=t("../../util/window"),o=.25,s=r.bezier(0,0,o,1),l=180,c=720,u=function(t,e){this._map=t,this._el=t.getCanvasContainer(),this._bearingSnap=e.bearingSnap,this._pitchWithRotate=e.pitchWithRotate!==!1,r.bindAll(["_onDown","_onMove","_onUp"],this)};u.prototype.isEnabled=function(){return!!this._enabled},u.prototype.isActive=function(){return!!this._active},u.prototype.enable=function(){this.isEnabled()||(this._el.addEventListener("mousedown",this._onDown),this._enabled=!0)},u.prototype.disable=function(){this.isEnabled()&&(this._el.removeEventListener("mousedown",this._onDown),this._enabled=!1)},u.prototype._onDown=function(t){this._ignoreEvent(t)||this.isActive()||(a.document.addEventListener("mousemove",this._onMove),a.document.addEventListener("mouseup",this._onUp),this._active=!1,this._inertia=[[Date.now(),this._map.getBearing()]],this._startPos=this._pos=n.mousePos(this._el,t),this._center=this._map.transform.centerPoint,t.preventDefault())},u.prototype._onMove=function(t){if(!this._ignoreEvent(t)){this.isActive()||(this._active=!0,this._fireEvent("rotatestart",t),this._fireEvent("movestart",t));var e=this._map;e.stop();var i=this._pos,r=n.mousePos(this._el,t),a=.8*(i.x-r.x),o=(i.y-r.y)*-.5,s=e.getBearing()-a,l=e.getPitch()-o,c=this._inertia,u=c[c.length-1];this._drainInertiaBuffer(),c.push([Date.now(),e._normalizeBearing(s,u[1])]),e.transform.bearing=s,this._pitchWithRotate&&(e.transform.pitch=l),this._fireEvent("rotate",t),this._fireEvent("move",t),this._pos=r}},u.prototype._onUp=function(t){var e=this;if(!this._ignoreEvent(t)&&(a.document.removeEventListener("mousemove",this._onMove),a.document.removeEventListener("mouseup",this._onUp),this.isActive())){this._active=!1,this._fireEvent("rotateend",t),this._drainInertiaBuffer();var i=this._map,n=i.getBearing(),r=this._inertia,u=function(){Math.abs(n)<e._bearingSnap?i.resetNorth({noMoveStart:!0},{originalEvent:t}):e._fireEvent("moveend",t)};if(r.length<2)return void u();var h=r[0],d=r[r.length-1],f=r[r.length-2],p=i._normalizeBearing(n,f[1]),m=d[1]-h[1],g=m<0?-1:1,v=(d[0]-h[0])/1e3;if(0===m||0===v)return void u();var y=Math.abs(m*(o/v));y>l&&(y=l);var b=y/(c*o),_=g*y*(b/2);p+=_,Math.abs(i._normalizeBearing(p,0))<this._bearingSnap&&(p=i._normalizeBearing(0,p)),i.rotateTo(p,{duration:1e3*b,easing:s,noMoveStart:!0},{originalEvent:t})}},u.prototype._fireEvent=function(t,e){return this._map.fire(t,{originalEvent:e})},u.prototype._ignoreEvent=function(t){var e=this._map;if(e.boxZoom&&e.boxZoom.isActive())return!0;if(e.dragPan&&e.dragPan.isActive())return!0;if(t.touches)return t.touches.length>1;var i=t.ctrlKey?1:2,n=t.ctrlKey?0:2,r=t.button;return"undefined"!=typeof InstallTrigger&&2===t.button&&t.ctrlKey&&a.navigator.platform.toUpperCase().indexOf("MAC")>=0&&(r=0),"mousemove"===t.type?t.buttons&0===i:r!==n},u.prototype._drainInertiaBuffer=function(){for(var t=this._inertia,e=Date.now(),i=160;t.length>0&&e-t[0][0]>i;)t.shift()},e.exports=u},{"../../util/dom":117,"../../util/util":129,"../../util/window":112}],101:[function(t,e,i){"use strict";function n(t){return t*(2-t)}var r=100,a=15,o=10,s=function(t){this._map=t,this._el=t.getCanvasContainer(),this._onKeyDown=this._onKeyDown.bind(this)};s.prototype.isEnabled=function(){return!!this._enabled},s.prototype.enable=function(){this.isEnabled()||(this._el.addEventListener("keydown",this._onKeyDown,!1),this._enabled=!0)},s.prototype.disable=function(){this.isEnabled()&&(this._el.removeEventListener("keydown",this._onKeyDown),this._enabled=!1)},s.prototype._onKeyDown=function(t){
if(!(t.altKey||t.ctrlKey||t.metaKey)){var e=0,i=0,s=0,l=0,c=0;switch(t.keyCode){case 61:case 107:case 171:case 187:e=1;break;case 189:case 109:case 173:e=-1;break;case 37:t.shiftKey?i=-1:(t.preventDefault(),l=-1);break;case 39:t.shiftKey?i=1:(t.preventDefault(),l=1);break;case 38:t.shiftKey?s=1:(t.preventDefault(),c=-1);break;case 40:t.shiftKey?s=-1:(c=1,t.preventDefault())}var u=this._map,h=u.getZoom(),d={duration:300,delayEndEvents:500,easing:n,zoom:e?Math.round(h)+e*(t.shiftKey?2:1):h,bearing:u.getBearing()+i*a,pitch:u.getPitch()+s*o,offset:[-l*r,-c*r],center:u.getCenter()};u.easeTo(d,{originalEvent:t})}},e.exports=s},{}],102:[function(t,e,i){"use strict";var n=t("../../util/dom"),r=t("../../util/util"),a=t("../../util/browser"),o=t("../../util/window"),s=o.navigator.userAgent.toLowerCase(),l=s.indexOf("firefox")!==-1,c=s.indexOf("safari")!==-1&&s.indexOf("chrom")===-1,u=function(t){this._map=t,this._el=t.getCanvasContainer(),r.bindAll(["_onWheel","_onTimeout"],this)};u.prototype.isEnabled=function(){return!!this._enabled},u.prototype.enable=function(t){this.isEnabled()||(this._el.addEventListener("wheel",this._onWheel,!1),this._el.addEventListener("mousewheel",this._onWheel,!1),this._enabled=!0,this._aroundCenter=t&&"center"===t.around)},u.prototype.disable=function(){this.isEnabled()&&(this._el.removeEventListener("wheel",this._onWheel),this._el.removeEventListener("mousewheel",this._onWheel),this._enabled=!1)},u.prototype._onWheel=function(t){var e;"wheel"===t.type?(e=t.deltaY,l&&t.deltaMode===o.WheelEvent.DOM_DELTA_PIXEL&&(e/=a.devicePixelRatio),t.deltaMode===o.WheelEvent.DOM_DELTA_LINE&&(e*=40)):"mousewheel"===t.type&&(e=-t.wheelDeltaY,c&&(e/=3));var i=a.now(),r=i-(this._time||0);this._pos=n.mousePos(this._el,t),this._time=i,0!==e&&e%4.000244140625===0?this._type="wheel":0!==e&&Math.abs(e)<4?this._type="trackpad":r>400?(this._type=null,this._lastValue=e,this._timeout=setTimeout(this._onTimeout,40)):this._type||(this._type=Math.abs(r*e)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,e+=this._lastValue)),t.shiftKey&&e&&(e/=4),this._type&&this._zoom(-e,t),t.preventDefault()},u.prototype._onTimeout=function(){this._type="wheel",this._zoom(-this._lastValue)},u.prototype._zoom=function(t,e){if(0!==t){var i=this._map,n=2/(1+Math.exp(-Math.abs(t/100)));t<0&&0!==n&&(n=1/n);var r=i.ease?i.ease.to:i.transform.scale,a=i.transform.scaleZoom(r*n);i.zoomTo(a,{duration:"wheel"===this._type?200:0,around:this._aroundCenter?i.getCenter():i.unproject(this._pos),delayEndEvents:200,smoothEasing:!0},{originalEvent:e})}},e.exports=u},{"../../util/browser":110,"../../util/dom":117,"../../util/util":129,"../../util/window":112}],103:[function(t,e,i){"use strict";var n=t("../../util/dom"),r=t("../../util/util"),a=t("../../util/window"),o=.15,s=r.bezier(0,0,o,1),l=12,c=2.5,u=.15,h=4,d=function(t){this._map=t,this._el=t.getCanvasContainer(),r.bindAll(["_onStart","_onMove","_onEnd"],this)};d.prototype.isEnabled=function(){return!!this._enabled},d.prototype.enable=function(t){this.isEnabled()||(this._el.addEventListener("touchstart",this._onStart,!1),this._enabled=!0,this._aroundCenter=t&&"center"===t.around)},d.prototype.disable=function(){this.isEnabled()&&(this._el.removeEventListener("touchstart",this._onStart),this._enabled=!1)},d.prototype.disableRotation=function(){this._rotationDisabled=!0},d.prototype.enableRotation=function(){this._rotationDisabled=!1},d.prototype._onStart=function(t){if(2===t.touches.length){var e=n.mousePos(this._el,t.touches[0]),i=n.mousePos(this._el,t.touches[1]);this._startVec=e.sub(i),this._startScale=this._map.transform.scale,this._startBearing=this._map.transform.bearing,this._gestureIntent=void 0,this._inertia=[],a.document.addEventListener("touchmove",this._onMove,!1),a.document.addEventListener("touchend",this._onEnd,!1)}},d.prototype._onMove=function(t){if(2===t.touches.length){var e=n.mousePos(this._el,t.touches[0]),i=n.mousePos(this._el,t.touches[1]),r=e.add(i).div(2),a=e.sub(i),o=a.mag()/this._startVec.mag(),s=this._rotationDisabled?0:180*a.angleWith(this._startVec)/Math.PI,l=this._map;if(this._gestureIntent){var c={duration:0,around:l.unproject(r)};"rotate"===this._gestureIntent&&(c.bearing=this._startBearing+s),"zoom"!==this._gestureIntent&&"rotate"!==this._gestureIntent||(c.zoom=l.transform.scaleZoom(this._startScale*o)),l.stop(),this._drainInertiaBuffer(),this._inertia.push([Date.now(),o,r]),l.easeTo(c,{originalEvent:t})}else{var d=Math.abs(1-o)>u,f=Math.abs(s)>h;f?this._gestureIntent="rotate":d&&(this._gestureIntent="zoom"),this._gestureIntent&&(this._startVec=a,this._startScale=l.transform.scale,this._startBearing=l.transform.bearing)}t.preventDefault()}},d.prototype._onEnd=function(t){a.document.removeEventListener("touchmove",this._onMove),a.document.removeEventListener("touchend",this._onEnd),this._drainInertiaBuffer();var e=this._inertia,i=this._map;if(e.length<2)return void i.snapToNorth({},{originalEvent:t});var n=e[e.length-1],r=e[0],u=i.transform.scaleZoom(this._startScale*n[1]),h=i.transform.scaleZoom(this._startScale*r[1]),d=u-h,f=(n[0]-r[0])/1e3,p=n[2];if(0===f||u===h)return void i.snapToNorth({},{originalEvent:t});var m=d*o/f;Math.abs(m)>c&&(m=m>0?c:-c);var g=1e3*Math.abs(m/(l*o)),v=u+m*g/2e3;v<0&&(v=0),i.easeTo({zoom:v,duration:g,easing:s,around:this._aroundCenter?i.getCenter():i.unproject(p)},{originalEvent:t})},d.prototype._drainInertiaBuffer=function(){for(var t=this._inertia,e=Date.now(),i=160;t.length>2&&e-t[0][0]>i;)t.shift()},e.exports=d},{"../../util/dom":117,"../../util/util":129,"../../util/window":112}],104:[function(t,e,i){"use strict";var n=t("../util/util"),r=t("../util/window"),a=function(){n.bindAll(["_onHashChange","_updateHash"],this)};a.prototype.addTo=function(t){return this._map=t,r.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},a.prototype.remove=function(){return r.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),delete this._map,this},a.prototype._onHashChange=function(){var t=r.location.hash.replace("#","").split("/");return t.length>=3&&(this._map.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:+(t[3]||0),pitch:+(t[4]||0)}),!0)},a.prototype._updateHash=function(){var t=this._map.getCenter(),e=this._map.getZoom(),i=this._map.getBearing(),n=this._map.getPitch(),a=Math.max(0,Math.ceil(Math.log(e)/Math.LN2)),o="#"+Math.round(100*e)/100+"/"+t.lat.toFixed(a)+"/"+t.lng.toFixed(a);(i||n)&&(o+="/"+Math.round(10*i)/10),n&&(o+="/"+Math.round(n)),r.history.replaceState("","",o)},e.exports=a},{"../util/util":129,"../util/window":112}],105:[function(t,e,i){"use strict";function n(t){t.parentNode&&t.parentNode.removeChild(t)}var r=t("../util/util"),a=t("../util/browser"),o=t("../util/window"),s=t("../util/dom"),l=t("../style/style"),c=t("../style/animation_loop"),u=t("../render/painter"),h=t("../geo/transform"),d=t("./hash"),f=t("./bind_handlers"),p=t("./camera"),m=t("../geo/lng_lat"),g=t("../geo/lng_lat_bounds"),v=t("point-geometry"),y=t("./control/attribution_control"),b=t("mapbox-gl-supported"),_=0,x=20,w={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:_,maxZoom:x,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,bearingSnap:7,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0},M=function(t){function e(e){var i=this;e=r.extend({},w,e);var n=new h(e.minZoom,e.maxZoom,e.renderWorldCopies);if(t.call(this,n,e),this._interactive=e.interactive,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=e.preserveDrawingBuffer,this._trackResize=e.trackResize,this._bearingSnap=e.bearingSnap,"string"==typeof e.container){if(this._container=o.document.getElementById(e.container),!this._container)throw new Error("Container '"+e.container+"' not found.")}else this._container=e.container;this.animationLoop=new c,e.maxBounds&&this.setMaxBounds(e.maxBounds),r.bindAll(["_onWindowOnline","_onWindowResize","_contextLost","_contextRestored","_update","_render","_onData","_onDataLoading"],this),this._setupContainer(),this._setupPainter(),this.on("move",this._update.bind(this,!1)),this.on("zoom",this._update.bind(this,!0)),this.on("moveend",function(){i.animationLoop.set(300),i._rerender()}),"undefined"!=typeof o&&(o.addEventListener("online",this._onWindowOnline,!1),o.addEventListener("resize",this._onWindowResize,!1)),f(this,e),this._hash=e.hash&&(new d).addTo(this),this._hash&&this._hash._onHashChange()||this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),this._classes=[],this.resize(),e.classes&&this.setClasses(e.classes),e.style&&this.setStyle(e.style),e.attributionControl&&this.addControl(new y),this.on("style.load",function(){this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this.style.update(this._classes,{transition:!1})}),this.on("data",this._onData),this.on("dataloading",this._onDataLoading)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var i={showTileBoundaries:{},showCollisionBoxes:{},showOverdrawInspector:{},repaint:{},vertices:{}};return e.prototype.addControl=function(t,e){void 0===e&&t.getDefaultPosition&&(e=t.getDefaultPosition()),void 0===e&&(e="top-right");var i=t.onAdd(this),n=this._controlPositions[e];return e.indexOf("bottom")!==-1?n.insertBefore(i,n.firstChild):n.appendChild(i),this},e.prototype.removeControl=function(t){return t.onRemove(this),this},e.prototype.addClass=function(t,e){return r.warnOnce("Style classes are deprecated and will be removed in an upcoming release of Mapbox GL JS."),this._classes.indexOf(t)>=0||""===t?this:(this._classes.push(t),this._classOptions=e,this.style&&this.style.updateClasses(),this._update(!0))},e.prototype.removeClass=function(t,e){r.warnOnce("Style classes are deprecated and will be removed in an upcoming release of Mapbox GL JS.");var i=this._classes.indexOf(t);return i<0||""===t?this:(this._classes.splice(i,1),this._classOptions=e,this.style&&this.style.updateClasses(),this._update(!0))},e.prototype.setClasses=function(t,e){r.warnOnce("Style classes are deprecated and will be removed in an upcoming release of Mapbox GL JS.");for(var i={},n=0;n<t.length;n++)""!==t[n]&&(i[t[n]]=!0);return this._classes=Object.keys(i),this._classOptions=e,this.style&&this.style.updateClasses(),this._update(!0)},e.prototype.hasClass=function(t){return r.warnOnce("Style classes are deprecated and will be removed in an upcoming release of Mapbox GL JS."),this._classes.indexOf(t)>=0},e.prototype.getClasses=function(){return r.warnOnce("Style classes are deprecated and will be removed in an upcoming release of Mapbox GL JS."),this._classes},e.prototype.resize=function(){var t=this._containerDimensions(),e=t[0],i=t[1];this._resizeCanvas(e,i),this.transform.resize(e,i),this.painter.resize(e,i);var n=this.painter.gl,a=n.getParameter(n.MAX_RENDERBUFFER_SIZE)/2;return(this._canvas.width>a||this._canvas.height>a)&&r.warnOnce("Map is larger than maximum size supported by this system ("+a+"px by "+a+"px)."),this.fire("movestart").fire("move").fire("resize").fire("moveend")},e.prototype.getBounds=function(){var t=new g(this.transform.pointLocation(new v(0,this.transform.height)),this.transform.pointLocation(new v(this.transform.width,0)));return(this.transform.angle||this.transform.pitch)&&(t.extend(this.transform.pointLocation(new v(this.transform.size.x,0))),t.extend(this.transform.pointLocation(new v(0,this.transform.size.y)))),t},e.prototype.setMaxBounds=function(t){if(t){var e=g.convert(t);this.transform.lngRange=[e.getWest(),e.getEast()],this.transform.latRange=[e.getSouth(),e.getNorth()],this.transform._constrain(),this._update()}else null!==t&&void 0!==t||(this.transform.lngRange=[],this.transform.latRange=[],this._update());return this},e.prototype.setMinZoom=function(t){if(t=null===t||void 0===t?_:t,t>=_&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this._update(),this.getZoom()<t&&this.setZoom(t),this;throw new Error("minZoom must be between "+_+" and the current maxZoom, inclusive")},e.prototype.getMinZoom=function(){return this.transform.minZoom},e.prototype.setMaxZoom=function(t){if(t=null===t||void 0===t?x:t,t>=this.transform.minZoom)return this.transform.maxZoom=t,this._update(),this.getZoom()>t&&this.setZoom(t),this;throw new Error("maxZoom must be greater than the current minZoom")},e.prototype.getMaxZoom=function(){return this.transform.maxZoom},e.prototype.project=function(t){return this.transform.locationPoint(m.convert(t))},e.prototype.unproject=function(t){return this.transform.pointLocation(v.convert(t))},e.prototype.queryRenderedFeatures=function(){function t(t){return t instanceof v||Array.isArray(t)}var e,i={};return 2===arguments.length?(e=arguments[0],i=arguments[1]):1===arguments.length&&t(arguments[0])?e=arguments[0]:1===arguments.length&&(i=arguments[0]),this.style.queryRenderedFeatures(this._makeQueryGeometry(e),i,this.transform.zoom,this.transform.angle)},e.prototype._makeQueryGeometry=function(t){var e=this;void 0===t&&(t=[v.convert([0,0]),v.convert([this.transform.width,this.transform.height])]);var i,n=t instanceof v||"number"==typeof t[0];if(n){var r=v.convert(t);i=[r]}else{var a=[v.convert(t[0]),v.convert(t[1])];i=[a[0],new v(a[1].x,a[0].y),a[1],new v(a[0].x,a[1].y),a[0]]}return i=i.map(function(t){return e.transform.pointCoordinate(t)})},e.prototype.querySourceFeatures=function(t,e){return this.style.querySourceFeatures(t,e)},e.prototype.setStyle=function(t,e){var i=(!e||e.diff!==!1)&&this.style&&t&&!(t instanceof l)&&"string"!=typeof t;if(i)try{return this.style.setState(t)&&this._update(!0),this}catch(t){r.warnOnce("Unable to perform style diff: "+(t.message||t.error||t)+".  Rebuilding the style from scratch.")}return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.off("rotate",this.style._redoPlacement),this.off("pitch",this.style._redoPlacement)),t?(t instanceof l?this.style=t:this.style=new l(t,this),this.style.setEventedParent(this,{style:this.style}),this.on("rotate",this.style._redoPlacement),this.on("pitch",this.style._redoPlacement),this):(this.style=null,this)},e.prototype.getStyle=function(){if(this.style)return this.style.serialize()},e.prototype.addSource=function(t,e){return this.style.addSource(t,e),this._update(!0),this},e.prototype.isSourceLoaded=function(t){var e=this.style&&this.style.sourceCaches[t];return void 0===e?void this.fire("error",{error:new Error("There is no source with ID '"+t+"'")}):e.loaded()},e.prototype.addSourceType=function(t,e,i){return this.style.addSourceType(t,e,i)},e.prototype.removeSource=function(t){return this.style.removeSource(t),this._update(!0),this},e.prototype.getSource=function(t){return this.style.getSource(t)},e.prototype.addLayer=function(t,e){return this.style.addLayer(t,e),this._update(!0),this},e.prototype.moveLayer=function(t,e){return this.style.moveLayer(t,e),this._update(!0),this},e.prototype.removeLayer=function(t){return this.style.removeLayer(t),this._update(!0),this},e.prototype.getLayer=function(t){return this.style.getLayer(t)},e.prototype.setFilter=function(t,e){return this.style.setFilter(t,e),this._update(!0),this},e.prototype.setLayerZoomRange=function(t,e,i){return this.style.setLayerZoomRange(t,e,i),this._update(!0),this},e.prototype.getFilter=function(t){return this.style.getFilter(t)},e.prototype.setPaintProperty=function(t,e,i,n){return this.style.setPaintProperty(t,e,i,n),this._update(!0),this},e.prototype.getPaintProperty=function(t,e,i){return this.style.getPaintProperty(t,e,i)},e.prototype.setLayoutProperty=function(t,e,i){return this.style.setLayoutProperty(t,e,i),this._update(!0),this},e.prototype.getLayoutProperty=function(t,e){return this.style.getLayoutProperty(t,e)},e.prototype.setLight=function(t){return this.style.setLight(t),this._update(!0),this},e.prototype.getLight=function(){return this.style.getLight()},e.prototype.getContainer=function(){return this._container},e.prototype.getCanvasContainer=function(){return this._canvasContainer},e.prototype.getCanvas=function(){return this._canvas},e.prototype._containerDimensions=function(){var t=0,e=0;return this._container&&(t=this._container.offsetWidth||400,e=this._container.offsetHeight||300),[t,e]},e.prototype._setupContainer=function(){var t=this._container;t.classList.add("mapboxgl-map");var e=this._canvasContainer=s.create("div","mapboxgl-canvas-container",t);this._interactive&&e.classList.add("mapboxgl-interactive"),this._canvas=s.create("canvas","mapboxgl-canvas",e),this._canvas.style.position="absolute",this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",0),this._canvas.setAttribute("aria-label","Map");var i=this._containerDimensions();this._resizeCanvas(i[0],i[1]);var n=this._controlContainer=s.create("div","mapboxgl-control-container",t),r=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(t){r[t]=s.create("div","mapboxgl-ctrl-"+t,n)})},e.prototype._resizeCanvas=function(t,e){var i=o.devicePixelRatio||1;this._canvas.width=i*t,this._canvas.height=i*e,this._canvas.style.width=t+"px",this._canvas.style.height=e+"px"},e.prototype._setupPainter=function(){var t=r.extend({failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer},b.webGLContextAttributes),e=this._canvas.getContext("webgl",t)||this._canvas.getContext("experimental-webgl",t);return e?void(this.painter=new u(e,this.transform)):void this.fire("error",{error:new Error("Failed to initialize WebGL")})},e.prototype._contextLost=function(t){t.preventDefault(),this._frameId&&a.cancelFrame(this._frameId),this.fire("webglcontextlost",{originalEvent:t})},e.prototype._contextRestored=function(t){this._setupPainter(),this.resize(),this._update(),this.fire("webglcontextrestored",{originalEvent:t})},e.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!(!this.style||!this.style.loaded())},e.prototype._update=function(t){return this.style?(this._styleDirty=this._styleDirty||t,this._sourcesDirty=!0,this._rerender(),this):this},e.prototype._render=function(){return this.style&&this._styleDirty&&(this._styleDirty=!1,this.style.update(this._classes,this._classOptions),this._classOptions=null,this.style._recalculate(this.transform.zoom)),this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.rotating,zooming:this.zooming}),this.fire("render"),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire("load")),this._frameId=null,this.animationLoop.stopped()||(this._styleDirty=!0),(this._sourcesDirty||this._repaint||this._styleDirty)&&this._rerender(),this},e.prototype.remove=function(){this._hash&&this._hash.remove(),a.cancelFrame(this._frameId),this.setStyle(null),"undefined"!=typeof o&&o.removeEventListener("resize",this._onWindowResize,!1);var t=this.painter.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),n(this._canvasContainer),n(this._controlContainer),this._container.classList.remove("mapboxgl-map"),this.fire("remove")},e.prototype._rerender=function(){this.style&&!this._frameId&&(this._frameId=a.frame(this._render))},e.prototype._onWindowOnline=function(){this._update()},e.prototype._onWindowResize=function(){this._trackResize&&this.stop().resize()._update()},i.showTileBoundaries.get=function(){return!!this._showTileBoundaries},i.showTileBoundaries.set=function(t){this._showTileBoundaries!==t&&(this._showTileBoundaries=t,this._update())},i.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},i.showCollisionBoxes.set=function(t){this._showCollisionBoxes!==t&&(this._showCollisionBoxes=t,this.style._redoPlacement())},i.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},i.showOverdrawInspector.set=function(t){this._showOverdrawInspector!==t&&(this._showOverdrawInspector=t,this._update())},i.repaint.get=function(){return!!this._repaint},i.repaint.set=function(t){this._repaint=t,this._update()},i.vertices.get=function(){return!!this._vertices},i.vertices.set=function(t){this._vertices=t,this._update()},e.prototype._onData=function(t){this._update("style"===t.dataType),this.fire(t.dataType+"data",t)},e.prototype._onDataLoading=function(t){this.fire(t.dataType+"dataloading",t)},Object.defineProperties(e.prototype,i),e}(p);e.exports=M},{"../geo/lng_lat":19,"../geo/lng_lat_bounds":20,"../geo/transform":21,"../render/painter":36,"../style/animation_loop":59,"../style/style":63,"../util/browser":110,"../util/dom":117,"../util/util":129,"../util/window":112,"./bind_handlers":91,"./camera":92,"./control/attribution_control":93,"./hash":104,"mapbox-gl-supported":193,"point-geometry":197}],106:[function(t,e,i){"use strict";var n=t("../util/dom"),r=t("../geo/lng_lat"),a=t("point-geometry"),o=function(t,e){this._offset=a.convert(e&&e.offset||[0,0]),this._update=this._update.bind(this),this._onMapClick=this._onMapClick.bind(this),t||(t=n.create("div")),t.classList.add("mapboxgl-marker"),this._element=t,this._popup=null};o.prototype.addTo=function(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),this._update(),this._map.on("click",this._onMapClick),this},o.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map=null),n.remove(this._element),this._popup&&this._popup.remove(),this},o.prototype.getLngLat=function(){return this._lngLat},o.prototype.setLngLat=function(t){return this._lngLat=r.convert(t),this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},o.prototype.getElement=function(){return this._element},o.prototype.setPopup=function(t){return this._popup&&(this._popup.remove(),this._popup=null),t&&(this._popup=t,this._popup.setLngLat(this._lngLat)),this},o.prototype._onMapClick=function(t){var e=t.originalEvent.target,i=this._element;this._popup&&(e===i||i.contains(e))&&this.togglePopup()},o.prototype.getPopup=function(){return this._popup},o.prototype.togglePopup=function(){var t=this._popup;t&&(t.isOpen()?t.remove():t.addTo(this._map))},o.prototype._update=function(t){if(this._map){var e=this._map.project(this._lngLat)._add(this._offset);t&&"moveend"!==t.type||(e=e.round()),n.setTransform(this._element,"translate("+e.x+"px, "+e.y+"px)")}},e.exports=o},{"../geo/lng_lat":19,"../util/dom":117,"point-geometry":197}],107:[function(t,e,i){"use strict";function n(t){if(t){if("number"==typeof t){var e=Math.round(Math.sqrt(.5*Math.pow(t,2)));return{top:new c(0,t),"top-left":new c(e,e),"top-right":new c(-e,e),bottom:new c(0,-t),"bottom-left":new c(e,-e),"bottom-right":new c(-e,-e),left:new c(t,0),right:new c(-t,0)}}if(r(t)){var i=c.convert(t);return{top:i,"top-left":i,"top-right":i,bottom:i,"bottom-left":i,"bottom-right":i,left:i,right:i}}return{top:c.convert(t.top||[0,0]),"top-left":c.convert(t["top-left"]||[0,0]),"top-right":c.convert(t["top-right"]||[0,0]),bottom:c.convert(t.bottom||[0,0]),"bottom-left":c.convert(t["bottom-left"]||[0,0]),"bottom-right":c.convert(t["bottom-right"]||[0,0]),left:c.convert(t.left||[0,0]),right:c.convert(t.right||[0,0])}}return n(new c(0,0))}function r(t){return t instanceof c||Array.isArray(t)}var a=t("../util/util"),o=t("../util/evented"),s=t("../util/dom"),l=t("../geo/lng_lat"),c=t("point-geometry"),u=t("../util/window"),h={closeButton:!0,closeOnClick:!0},d=function(t){function e(e){t.call(this),this.options=a.extend(Object.create(h),e),a.bindAll(["_update","_onClickClose"],this)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.addTo=function(t){return this._map=t,this._map.on("move",this._update),this.options.closeOnClick&&this._map.on("click",this._onClickClose),this._update(),this},e.prototype.isOpen=function(){return!!this._map},e.prototype.remove=function(){return this._content&&this._content.parentNode&&this._content.parentNode.removeChild(this._content),this._container&&(this._container.parentNode.removeChild(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("click",this._onClickClose),delete this._map),this.fire("close"),this},e.prototype.getLngLat=function(){return this._lngLat},e.prototype.setLngLat=function(t){return this._lngLat=l.convert(t),this._update(),this},e.prototype.setText=function(t){return this.setDOMContent(u.document.createTextNode(t))},e.prototype.setHTML=function(t){var e,i=u.document.createDocumentFragment(),n=u.document.createElement("body");for(n.innerHTML=t;e=n.firstChild,e;)i.appendChild(e);return this.setDOMContent(i)},e.prototype.setDOMContent=function(t){return this._createContent(),this._content.appendChild(t),this._update(),this},e.prototype._createContent=function(){this._content&&this._content.parentNode&&this._content.parentNode.removeChild(this._content),this._content=s.create("div","mapboxgl-popup-content",this._container),this.options.closeButton&&(this._closeButton=s.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClickClose))},e.prototype._update=function(){if(this._map&&this._lngLat&&this._content){this._container||(this._container=s.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=s.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content));var t=this.options.anchor,e=n(this.options.offset),i=this._map.project(this._lngLat).round();if(!t){var r=this._container.offsetWidth,a=this._container.offsetHeight;t=i.y+e.bottom.y<a?["top"]:i.y>this._map.transform.height-a?["bottom"]:[],i.x<r/2?t.push("left"):i.x>this._map.transform.width-r/2&&t.push("right"),t=0===t.length?"bottom":t.join("-")}var o=i.add(e[t]),l={top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},c=this._container.classList;for(var u in l)c.remove("mapboxgl-popup-anchor-"+u);c.add("mapboxgl-popup-anchor-"+t),s.setTransform(this._container,l[t]+" translate("+o.x+"px,"+o.y+"px)")}},e.prototype._onClickClose=function(){this.remove()},e}(o);e.exports=d},{"../geo/lng_lat":19,"../util/dom":117,"../util/evented":118,"../util/util":129,"../util/window":112,"point-geometry":197}],108:[function(t,e,i){"use strict";var n=function(t,e,i){this.target=t,this.parent=e,this.mapId=i,this.callbacks={},this.callbackID=0,this.receive=this.receive.bind(this),this.target.addEventListener("message",this.receive,!1)};n.prototype.send=function(t,e,i,n,r){var a=i?this.mapId+":"+this.callbackID++:null;i&&(this.callbacks[a]=i),this.target.postMessage({targetMapId:r,sourceMapId:this.mapId,type:t,id:String(a),data:e},n)},n.prototype.receive=function(t){var e,i=this,n=t.data,r=n.id;if(!n.targetMapId||this.mapId===n.targetMapId){var a=function(t,e,n){i.target.postMessage({sourceMapId:i.mapId,type:"<response>",id:String(r),error:t?String(t):null,data:e},n)};if("<response>"===n.type)e=this.callbacks[n.id],delete this.callbacks[n.id],e&&e(n.error||null,n.data);else if("undefined"!=typeof n.id&&this.parent[n.type])this.parent[n.type](n.sourceMapId,n.data,a);else if("undefined"!=typeof n.id&&this.parent.getWorkerSource){var o=n.type.split("."),s=this.parent.getWorkerSource(n.sourceMapId,o[0]);s[o[1]](n.data,a)}else this.parent[n.type](n.data)}},n.prototype.remove=function(){this.target.removeEventListener("message",this.receive,!1)},e.exports=n},{}],109:[function(t,e,i){"use strict";function n(t){var e=r.document.createElement("a");return e.href=t,e.protocol===r.document.location.protocol&&e.host===r.document.location.host}var r=t("./window");i.getJSON=function(t,e){var i=new r.XMLHttpRequest;return i.open("GET",t,!0),i.setRequestHeader("Accept","application/json"),i.onerror=function(t){e(t)},i.onload=function(){if(i.status>=200&&i.status<300&&i.response){var t;try{t=JSON.parse(i.response)}catch(t){return e(t)}e(null,t)}else e(new Error(i.statusText))},i.send(),i},i.getArrayBuffer=function(t,e){var i=new r.XMLHttpRequest;return i.open("GET",t,!0),i.responseType="arraybuffer",i.onerror=function(t){e(t)},i.onload=function(){return 0===i.response.byteLength&&200===i.status?e(new Error("http status 200 returned without content.")):void(i.status>=200&&i.status<300&&i.response?e(null,{data:i.response,cacheControl:i.getResponseHeader("Cache-Control"),expires:i.getResponseHeader("Expires")}):e(new Error(i.statusText)))},i.send(),i};var a="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";i.getImage=function(t,e){return i.getArrayBuffer(t,function(t,i){if(t)return e(t);var n=new r.Image,o=r.URL||r.webkitURL;n.onload=function(){e(null,n),o.revokeObjectURL(n.src)};var s=new r.Blob([new Uint8Array(i.data)],{type:"image/png"});n.cacheControl=i.cacheControl,n.expires=i.expires,n.src=i.data.byteLength?o.createObjectURL(s):a})},i.getVideo=function(t,e){var i=r.document.createElement("video");i.onloadstart=function(){e(null,i)};for(var a=0;a<t.length;a++){var o=r.document.createElement("source");n(t[a])||(i.crossOrigin="Anonymous"),o.src=t[a],i.appendChild(o)}return i}},{"./window":112}],110:[function(t,e,i){"use strict";var n=t("./window");e.exports.now=function(){return n.performance&&n.performance.now?n.performance.now.bind(n.performance):Date.now.bind(Date)}();var r=n.requestAnimationFrame||n.mozRequestAnimationFrame||n.webkitRequestAnimationFrame||n.msRequestAnimationFrame;i.frame=function(t){return r(t)};var a=n.cancelAnimationFrame||n.mozCancelAnimationFrame||n.webkitCancelAnimationFrame||n.msCancelAnimationFrame;i.cancelFrame=function(t){a(t)},i.timed=function(t,n,r){function a(l){o||(l=e.exports.now(),l>=s+n?t.call(r,1):(t.call(r,(l-s)/n),i.frame(a)))}if(!n)return t.call(r,1),null;var o=!1,s=e.exports.now();return i.frame(a),function(){o=!0}},i.getImageData=function(t){var e=n.document.createElement("canvas"),i=e.getContext("2d");return e.width=t.width,e.height=t.height,i.drawImage(t,0,0),i.getImageData(0,0,t.width,t.height).data},i.supported=t("mapbox-gl-supported"),i.hardwareConcurrency=n.navigator.hardwareConcurrency||4,Object.defineProperty(i,"devicePixelRatio",{get:function(){return n.devicePixelRatio}}),i.supportsWebp=!1;var o=n.document.createElement("img");o.onload=function(){i.supportsWebp=!0},o.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="},{"./window":112,"mapbox-gl-supported":193}],111:[function(t,e,i){"use strict";var n=t("webworkify"),r=t("../window"),a=r.URL.createObjectURL(new n(t("../../source/worker"),{bare:!0}));e.exports=function(){return new r.Worker(a)}},{"../../source/worker":57,"../window":112,webworkify:213}],112:[function(t,e,i){"use strict";e.exports=self},{}],113:[function(t,e,i){"use strict";function n(t,e){return e.area-t.area}var r=t("quickselect"),a=t("./util").calculateSignedArea;e.exports=function(t,e){var i=t.length;if(i<=1)return[t];for(var o,s,l=[],c=0;c<i;c++){var u=a(t[c]);0!==u&&(t[c].area=Math.abs(u),void 0===s&&(s=u<0),s===u<0?(o&&l.push(o),o=[t[c]]):o.push(t[c]))}if(o&&l.push(o),e>1)for(var h=0;h<l.length;h++)l[h].length<=e||(r(l[h],e,1,l[h].length-1,n),l[h]=l[h].slice(0,e));return l}},{"./util":129,quickselect:199}],114:[function(t,e,i){"use strict";var n={API_URL:"https://api.mapbox.com",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null};e.exports=n},{}],115:[function(t,e,i){"use strict";
var n=function(t){var e=this;this._stringToNumber={},this._numberToString=[];for(var i=0;i<t.length;i++){var n=t[i];e._stringToNumber[n]=i,e._numberToString[i]=n}};n.prototype.encode=function(t){return this._stringToNumber[t]},n.prototype.decode=function(t){return this._numberToString[t]},e.exports=n},{}],116:[function(t,e,i){"use strict";var n=t("./util"),r=t("./actor"),a=function(t,e){var i=this;this.workerPool=t,this.actors=[],this.currentActor=0,this.id=n.uniqueId();for(var a=this.workerPool.acquire(this.id),o=0;o<a.length;o++){var s=a[o],l=new r(s,e,i.id);l.name="Worker "+o,i.actors.push(l)}};a.prototype.broadcast=function(t,e,i){i=i||function(){},n.asyncAll(this.actors,function(i,n){i.send(t,e,n)},i)},a.prototype.send=function(t,e,i,n,r){return("number"!=typeof n||isNaN(n))&&(n=this.currentActor=(this.currentActor+1)%this.actors.length),this.actors[n].send(t,e,i,r),n},a.prototype.remove=function(){this.actors.forEach(function(t){t.remove()}),this.actors=[],this.workerPool.release(this.id)},e.exports=a},{"./actor":108,"./util":129}],117:[function(t,e,i){"use strict";function n(t){for(var e=0;e<t.length;e++)if(t[e]in l)return t[e];return t[0]}function r(t){t.preventDefault(),t.stopPropagation(),o.removeEventListener("click",r,!0)}var a=t("point-geometry"),o=t("./window");i.create=function(t,e,i){var n=o.document.createElement(t);return e&&(n.className=e),i&&i.appendChild(n),n};var s,l=o.document.documentElement.style,c=n(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);i.disableDrag=function(){c&&(s=l[c],l[c]="none")},i.enableDrag=function(){c&&(l[c]=s)};var u=n(["transform","WebkitTransform"]);i.setTransform=function(t,e){t.style[u]=e},i.suppressClick=function(){o.addEventListener("click",r,!0),o.setTimeout(function(){o.removeEventListener("click",r,!0)},0)},i.mousePos=function(t,e){var i=t.getBoundingClientRect();return e=e.touches?e.touches[0]:e,new a(e.clientX-i.left-t.clientLeft,e.clientY-i.top-t.clientTop)},i.touchPos=function(t,e){for(var i=t.getBoundingClientRect(),n=[],r="touchend"===e.type?e.changedTouches:e.touches,o=0;o<r.length;o++)n.push(new a(r[o].clientX-i.left-t.clientLeft,r[o].clientY-i.top-t.clientTop));return n},i.remove=function(t){t.parentNode&&t.parentNode.removeChild(t)}},{"./window":112,"point-geometry":197}],118:[function(t,e,i){"use strict";var n=t("./util"),r=function(){};r.prototype.on=function(t,e){return this._listeners=this._listeners||{},this._listeners[t]=this._listeners[t]||[],this._listeners[t].push(e),this},r.prototype.off=function(t,e){if(this._listeners&&this._listeners[t]){var i=this._listeners[t].indexOf(e);i!==-1&&this._listeners[t].splice(i,1)}return this},r.prototype.once=function(t,e){var i=this,n=function(r){i.off(t,n),e.call(i,r)};return this.on(t,n),this},r.prototype.fire=function(t,e){var i=this;if(this.listens(t)){e=n.extend({},e,{type:t,target:this});for(var r=this._listeners&&this._listeners[t]?this._listeners[t].slice():[],a=0;a<r.length;a++)r[a].call(i,e);this._eventedParent&&this._eventedParent.fire(t,n.extend({},e,this._eventedParentData))}else n.endsWith(t,"error")&&console.error(e&&e.error||e||"Empty error event");return this},r.prototype.listens=function(t){return this._listeners&&this._listeners[t]||this._eventedParent&&this._eventedParent.listens(t)},r.prototype.setEventedParent=function(t,e){return this._eventedParent=t,this._eventedParentData="function"==typeof e?e():e,this},e.exports=r},{"./util":129}],119:[function(t,e,i){"use strict";function n(t,e){return e.max-t.max}function r(t,e,i,n){this.p=new l(t,e),this.h=i,this.d=a(this.p,n),this.max=this.d+this.h*Math.SQRT2}function a(t,e){for(var i=!1,n=1/0,r=0;r<e.length;r++)for(var a=e[r],o=0,s=a.length,l=s-1;o<s;l=o++){var u=a[o],h=a[l];u.y>t.y!=h.y>t.y&&t.x<(h.x-u.x)*(t.y-u.y)/(h.y-u.y)+u.x&&(i=!i),n=Math.min(n,c(t,u,h))}return(i?1:-1)*Math.sqrt(n)}function o(t){for(var e=0,i=0,n=0,a=t[0],o=0,s=a.length,l=s-1;o<s;l=o++){var c=a[o],u=a[l],h=c.x*u.y-u.x*c.y;i+=(c.x+u.x)*h,n+=(c.y+u.y)*h,e+=3*h}return new r(i/e,n/e,0,t)}var s=t("tinyqueue"),l=t("point-geometry"),c=t("./intersection_tests").distToSegmentSquared;e.exports=function(t,e,i){e=e||1;for(var a,l,c,u,h=t[0],d=0;d<h.length;d++){var f=h[d];(!d||f.x<a)&&(a=f.x),(!d||f.y<l)&&(l=f.y),(!d||f.x>c)&&(c=f.x),(!d||f.y>u)&&(u=f.y)}for(var p=c-a,m=u-l,g=Math.min(p,m),v=g/2,y=new s(null,n),b=a;b<c;b+=g)for(var _=l;_<u;_+=g)y.push(new r(b+v,_+v,v,t));for(var x=o(t),w=y.length;y.length;){var M=y.pop();M.d>x.d&&(x=M,i&&console.log("found best %d after %d probes",Math.round(1e4*M.d)/1e4,w)),M.max-x.d<=e||(v=M.h/2,y.push(new r(M.p.x-v,M.p.y-v,v,t)),y.push(new r(M.p.x+v,M.p.y-v,v,t)),y.push(new r(M.p.x-v,M.p.y+v,v,t)),y.push(new r(M.p.x+v,M.p.y+v,v,t)),w+=4)}return i&&(console.log("num probes: "+w),console.log("best distance: "+x.d)),x.p}},{"./intersection_tests":122,"point-geometry":197,tinyqueue:202}],120:[function(t,e,i){"use strict";function n(t,e){this.stacks=t.readFields(r,[],e)}function r(t,e,i){if(1===t){var n=i.readMessage(a,{glyphs:{}});e.push(n)}}function a(t,e,i){if(1===t)e.name=i.readString();else if(2===t)e.range=i.readString();else if(3===t){var n=i.readMessage(o,{});e.glyphs[n.id]=n}}function o(t,e,i){1===t?e.id=i.readVarint():2===t?e.bitmap=i.readBytes():3===t?e.width=i.readVarint():4===t?e.height=i.readVarint():5===t?e.left=i.readSVarint():6===t?e.top=i.readSVarint():7===t&&(e.advance=i.readVarint())}e.exports=n},{}],121:[function(t,e,i){"use strict";function n(t,e,i){return t*(1-i)+e*i}e.exports=n,n.number=n,n.vec2=function(t,e,i){return[n(t[0],e[0],i),n(t[1],e[1],i)]},n.color=function(t,e,i){return[n(t[0],e[0],i),n(t[1],e[1],i),n(t[2],e[2],i),n(t[3],e[3],i)]},n.array=function(t,e,i){return t.map(function(t,r){return n(t,e[r],i)})}},{}],122:[function(t,e,i){"use strict";function n(t,e){for(var i=0;i<t.length;i++)if(f(e,t[i]))return!0;for(var n=0;n<e.length;n++)if(f(t,e[n]))return!0;return!!l(t,e)}function r(t,e,i){for(var n=0;n<t.length;n++)for(var r=t[n],a=0;a<e.length;a++)for(var o=e[a],s=0;s<o.length;s++){var l=o[s];if(f(r,l))return!0;if(u(l,r,i))return!0}return!1}function a(t,e){if(1===t.length&&1===t[0].length)return d(e,t[0][0]);for(var i=0;i<e.length;i++)for(var n=e[i],r=0;r<n.length;r++)if(d(t,n[r]))return!0;for(var a=0;a<t.length;a++){for(var o=t[a],s=0;s<o.length;s++)if(d(e,o[s]))return!0;for(var c=0;c<e.length;c++)if(l(o,e[c]))return!0}return!1}function o(t,e,i){for(var n=0;n<e.length;n++)for(var r=e[n],a=0;a<t.length;a++){var o=t[a];if(o.length>=3)for(var l=0;l<r.length;l++)if(f(o,r[l]))return!0;if(s(o,r,i))return!0}return!1}function s(t,e,i){if(t.length>1){if(l(t,e))return!0;for(var n=0;n<e.length;n++)if(u(e[n],t,i))return!0}for(var r=0;r<t.length;r++)if(u(t[r],e,i))return!0;return!1}function l(t,e){if(0===t.length||0===e.length)return!1;for(var i=0;i<t.length-1;i++)for(var n=t[i],r=t[i+1],a=0;a<e.length-1;a++){var o=e[a],s=e[a+1];if(c(n,r,o,s))return!0}return!1}function c(t,e,i,n){return p(t,i,n)!==p(e,i,n)&&p(t,e,i)!==p(t,e,n)}function u(t,e,i){var n=i*i;if(1===e.length)return t.distSqr(e[0])<n;for(var r=1;r<e.length;r++){var a=e[r-1],o=e[r];if(h(t,a,o)<n)return!0}return!1}function h(t,e,i){var n=e.distSqr(i);if(0===n)return t.distSqr(e);var r=((t.x-e.x)*(i.x-e.x)+(t.y-e.y)*(i.y-e.y))/n;return r<0?t.distSqr(e):r>1?t.distSqr(i):t.distSqr(i.sub(e)._mult(r)._add(e))}function d(t,e){for(var i,n,r,a=!1,o=0;o<t.length;o++){i=t[o];for(var s=0,l=i.length-1;s<i.length;l=s++)n=i[s],r=i[l],n.y>e.y!=r.y>e.y&&e.x<(r.x-n.x)*(e.y-n.y)/(r.y-n.y)+n.x&&(a=!a)}return a}function f(t,e){for(var i=!1,n=0,r=t.length-1;n<t.length;r=n++){var a=t[n],o=t[r];a.y>e.y!=o.y>e.y&&e.x<(o.x-a.x)*(e.y-a.y)/(o.y-a.y)+a.x&&(i=!i)}return i}var p=t("./util").isCounterClockwise;e.exports={multiPolygonIntersectsBufferedMultiPoint:r,multiPolygonIntersectsMultiPolygon:a,multiPolygonIntersectsBufferedMultiLine:o,polygonIntersectsPolygon:n,distToSegmentSquared:h}},{"./util":129}],123:[function(t,e,i){"use strict";var n={"Latin-1 Supplement":function(t){return t>=128&&t<=255},"Hangul Jamo":function(t){return t>=4352&&t<=4607},"Unified Canadian Aboriginal Syllabics":function(t){return t>=5120&&t<=5759},"Unified Canadian Aboriginal Syllabics Extended":function(t){return t>=6320&&t<=6399},"General Punctuation":function(t){return t>=8192&&t<=8303},"Letterlike Symbols":function(t){return t>=8448&&t<=8527},"Number Forms":function(t){return t>=8528&&t<=8591},"Miscellaneous Technical":function(t){return t>=8960&&t<=9215},"Control Pictures":function(t){return t>=9216&&t<=9279},"Optical Character Recognition":function(t){return t>=9280&&t<=9311},"Enclosed Alphanumerics":function(t){return t>=9312&&t<=9471},"Geometric Shapes":function(t){return t>=9632&&t<=9727},"Miscellaneous Symbols":function(t){return t>=9728&&t<=9983},"Miscellaneous Symbols and Arrows":function(t){return t>=11008&&t<=11263},"CJK Radicals Supplement":function(t){return t>=11904&&t<=12031},"Kangxi Radicals":function(t){return t>=12032&&t<=12255},"Ideographic Description Characters":function(t){return t>=12272&&t<=12287},"CJK Symbols and Punctuation":function(t){return t>=12288&&t<=12351},Hiragana:function(t){return t>=12352&&t<=12447},Katakana:function(t){return t>=12448&&t<=12543},Bopomofo:function(t){return t>=12544&&t<=12591},"Hangul Compatibility Jamo":function(t){return t>=12592&&t<=12687},Kanbun:function(t){return t>=12688&&t<=12703},"Bopomofo Extended":function(t){return t>=12704&&t<=12735},"CJK Strokes":function(t){return t>=12736&&t<=12783},"Katakana Phonetic Extensions":function(t){return t>=12784&&t<=12799},"Enclosed CJK Letters and Months":function(t){return t>=12800&&t<=13055},"CJK Compatibility":function(t){return t>=13056&&t<=13311},"CJK Unified Ideographs Extension A":function(t){return t>=13312&&t<=19903},"Yijing Hexagram Symbols":function(t){return t>=19904&&t<=19967},"CJK Unified Ideographs":function(t){return t>=19968&&t<=40959},"Yi Syllables":function(t){return t>=40960&&t<=42127},"Yi Radicals":function(t){return t>=42128&&t<=42191},"Hangul Jamo Extended-A":function(t){return t>=43360&&t<=43391},"Hangul Syllables":function(t){return t>=44032&&t<=55215},"Hangul Jamo Extended-B":function(t){return t>=55216&&t<=55295},"Private Use Area":function(t){return t>=57344&&t<=63743},"CJK Compatibility Ideographs":function(t){return t>=63744&&t<=64255},"Vertical Forms":function(t){return t>=65040&&t<=65055},"CJK Compatibility Forms":function(t){return t>=65072&&t<=65103},"Small Form Variants":function(t){return t>=65104&&t<=65135},"Halfwidth and Fullwidth Forms":function(t){return t>=65280&&t<=65519}};e.exports=n},{}],124:[function(t,e,i){"use strict";var n=function(t,e){this.max=t,this.onRemove=e,this.reset()};n.prototype.reset=function(){var t=this;for(var e in this.data)t.onRemove(t.data[e]);return this.data={},this.order=[],this},n.prototype.add=function(t,e){if(this.has(t))this.order.splice(this.order.indexOf(t),1),this.data[t]=e,this.order.push(t);else if(this.data[t]=e,this.order.push(t),this.order.length>this.max){var i=this.get(this.order[0]);i&&this.onRemove(i)}return this},n.prototype.has=function(t){return t in this.data},n.prototype.keys=function(){return this.order},n.prototype.get=function(t){if(!this.has(t))return null;var e=this.data[t];return delete this.data[t],this.order.splice(this.order.indexOf(t),1),e},n.prototype.remove=function(t){if(!this.has(t))return this;var e=this.data[t];return delete this.data[t],this.onRemove(e),this.order.splice(this.order.indexOf(t),1),this},n.prototype.setMaxSize=function(t){var e=this;for(this.max=t;this.order.length>this.max;){var i=e.get(e.order[0]);i&&e.onRemove(i)}return this},e.exports=n},{}],125:[function(t,e,i){"use strict";function n(t,e){var i=o(l.API_URL);if(t.protocol=i.protocol,t.authority=i.authority,!l.REQUIRE_ACCESS_TOKEN)return s(t);if(e=e||l.ACCESS_TOKEN,!e)throw new Error("An API access token is required to use Mapbox GL. "+u);if("s"===e[0])throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+u);return t.params.push("access_token="+e),s(t)}function r(t){return 0===t.indexOf("mapbox:")}function a(t){for(var e=0;e<t.length;e++)0===t[e].indexOf("access_token=tk.")&&(t[e]="access_token="+(l.ACCESS_TOKEN||""))}function o(t){var e=t.match(d);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function s(t){var e=t.params.length?"?"+t.params.join("&"):"";return t.protocol+"://"+t.authority+t.path+e}var l=t("./config"),c=t("./browser"),u="See https://www.mapbox.com/developers/api/#access-tokens";i.isMapboxURL=r,i.normalizeStyleURL=function(t,e){if(!r(t))return t;var i=o(t);return i.path="/styles/v1"+i.path,n(i,e)},i.normalizeGlyphsURL=function(t,e){if(!r(t))return t;var i=o(t);return i.path="/fonts/v1"+i.path,n(i,e)},i.normalizeSourceURL=function(t,e){if(!r(t))return t;var i=o(t);return i.path="/v4/"+i.authority+".json",i.params.push("secure"),n(i,e)},i.normalizeSpriteURL=function(t,e,i,a){var l=o(t);return r(t)?(l.path="/styles/v1"+l.path+"/sprite"+e+i,n(l,a)):(l.path+=""+e+i,s(l))};var h=/(\.(png|jpg)\d*)(?=$)/;i.normalizeTileURL=function(t,e,i){if(!e||!r(e))return t;var n=o(t),l=c.devicePixelRatio>=2||512===i?"@2x":"",u=c.supportsWebp?".webp":"$1";return n.path=n.path.replace(h,""+l+u),a(n.params),s(n)};var d=/^(\w+):\/\/([^\/?]+)(\/[^?]+)?\??(.+)?/},{"./browser":110,"./config":114}],126:[function(t,e,i){"use strict";var n=t("./is_char_in_unicode_block");e.exports.allowsIdeographicBreaking=function(t){for(var e=0,n=t;e<n.length;e+=1){var r=n[e];if(!i.charAllowsIdeographicBreaking(r.charCodeAt(0)))return!1}return!0},e.exports.allowsVerticalWritingMode=function(t){for(var e=0,n=t;e<n.length;e+=1){var r=n[e];if(i.charHasUprightVerticalOrientation(r.charCodeAt(0)))return!0}return!1},e.exports.charAllowsIdeographicBreaking=function(t){return!!(!(t<11904)&&(n["Bopomofo Extended"](t)||n.Bopomofo(t)||n["CJK Compatibility Forms"](t)||n["CJK Compatibility Ideographs"](t)||n["CJK Compatibility"](t)||n["CJK Radicals Supplement"](t)||n["CJK Strokes"](t)||n["CJK Symbols and Punctuation"](t)||n["CJK Unified Ideographs Extension A"](t)||n["CJK Unified Ideographs"](t)||n["Enclosed CJK Letters and Months"](t)||n["Halfwidth and Fullwidth Forms"](t)||n.Hiragana(t)||n["Ideographic Description Characters"](t)||n["Kangxi Radicals"](t)||n["Katakana Phonetic Extensions"](t)||n.Katakana(t)||n["Vertical Forms"](t)||n["Yi Radicals"](t)||n["Yi Syllables"](t)))},i.charHasUprightVerticalOrientation=function(t){return!!(746===t||747===t||!(t<4352)&&(n["Bopomofo Extended"](t)||n.Bopomofo(t)||n["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||n["CJK Compatibility Ideographs"](t)||n["CJK Compatibility"](t)||n["CJK Radicals Supplement"](t)||n["CJK Strokes"](t)||!(!n["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||12336===t)||n["CJK Unified Ideographs Extension A"](t)||n["CJK Unified Ideographs"](t)||n["Enclosed CJK Letters and Months"](t)||n["Hangul Compatibility Jamo"](t)||n["Hangul Jamo Extended-A"](t)||n["Hangul Jamo Extended-B"](t)||n["Hangul Jamo"](t)||n["Hangul Syllables"](t)||n.Hiragana(t)||n["Ideographic Description Characters"](t)||n.Kanbun(t)||n["Kangxi Radicals"](t)||n["Katakana Phonetic Extensions"](t)||n.Katakana(t)&&12540!==t||!(!n["Halfwidth and Fullwidth Forms"](t)||65288===t||65289===t||65293===t||t>=65306&&t<=65310||65339===t||65341===t||65343===t||t>=65371&&t<=65503||65507===t||t>=65512&&t<=65519)||!(!n["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||n["Unified Canadian Aboriginal Syllabics"](t)||n["Unified Canadian Aboriginal Syllabics Extended"](t)||n["Vertical Forms"](t)||n["Yijing Hexagram Symbols"](t)||n["Yi Syllables"](t)||n["Yi Radicals"](t)))},i.charHasNeutralVerticalOrientation=function(t){return!!(n["Latin-1 Supplement"](t)&&(167===t||169===t||174===t||177===t||188===t||189===t||190===t||215===t||247===t)||n["General Punctuation"](t)&&(8214===t||8224===t||8225===t||8240===t||8241===t||8251===t||8252===t||8258===t||8263===t||8264===t||8265===t||8273===t)||n["Letterlike Symbols"](t)||n["Number Forms"](t)||n["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||9003===t||t>=9085&&t<=9114||t>=9150&&t<=9165||9167===t||t>=9169&&t<=9179||t>=9186&&t<=9215)||n["Control Pictures"](t)&&9251!==t||n["Optical Character Recognition"](t)||n["Enclosed Alphanumerics"](t)||n["Geometric Shapes"](t)||n["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||n["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||n["CJK Symbols and Punctuation"](t)||n.Katakana(t)||n["Private Use Area"](t)||n["CJK Compatibility Forms"](t)||n["Small Form Variants"](t)||n["Halfwidth and Fullwidth Forms"](t)||8734===t||8756===t||8757===t||t>=9984&&t<=10087||t>=10102&&t<=10131||65532===t||65533===t)},i.charHasRotatedVerticalOrientation=function(t){return!(i.charHasUprightVerticalOrientation(t)||i.charHasNeutralVerticalOrientation(t))}},{"./is_char_in_unicode_block":123}],127:[function(t,e,i){"use strict";function n(t){var e=JSON.stringify(t);if(g[e])return g[e];var i=void 0===t.alignment?1:t.alignment,n=0,o=0,l=["Uint8"],h=t.members.map(function(t){l.indexOf(t.type)<0&&l.push(t.type);var e=a(t.type),s=n=r(n,Math.max(i,e)),c=t.components||1;return o=Math.max(o,e),n+=e*c,{name:t.name,type:t.type,components:c,offset:s}}),f=r(n,Math.max(o,i)),p=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(d);p.prototype.alignment=i,p.prototype.size=f;for(var v=0,y=h;v<y.length;v+=1)for(var b=y[v],_=0;_<b.components;_++){var x=b.name+(1===b.components?"":_);Object.defineProperty(p.prototype,x,{get:c(b,_),set:u(b,_)})}var w=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(m);return w.prototype.members=h,w.prototype.StructType=p,w.prototype.bytesPerElement=f,w.prototype.emplaceBack=s(h,f),w.prototype._usedTypes=l,g[e]=w,w}function r(t,e){return Math.ceil(t/e)*e}function a(t){return h[t].BYTES_PER_ELEMENT}function o(t){return t.toLowerCase()}function s(t,e){for(var i=[],n=[],r="var i = this.length;\nthis.resize(this.length + 1);\n",s=0,l=t;s<l.length;s+=1){var c=l[s],u=a(c.type);i.indexOf(u)<0&&(i.push(u),r+="var o"+u.toFixed(0)+" = i * "+(e/u).toFixed(0)+";\n");for(var h=0;h<c.components;h++){var d="v"+n.length,f="o"+u.toFixed(0)+" + "+(c.offset/u+h).toFixed(0);r+="this."+o(c.type)+"["+f+"] = "+d+";\n",n.push(d)}}return r+="return i;",new Function(n.toString(),r)}function l(t,e){var i="this._pos"+a(t.type).toFixed(0),n=(t.offset/a(t.type)+e).toFixed(0),r=i+" + "+n;return"this._structArray."+o(t.type)+"["+r+"]"}function c(t,e){return new Function("return "+l(t,e)+";")}function u(t,e){return new Function("x",l(t,e)+" = x;")}e.exports=n;var h={Int8:Int8Array,Uint8:Uint8Array,Uint8Clamped:Uint8ClampedArray,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array,Float64:Float64Array},d=function(t,e){this._structArray=t,this._pos1=e*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},f=128,p=5,m=function(t){this.isTransferred=!1,void 0!==t?(this.arrayBuffer=t.arrayBuffer,this.length=t.length,this.capacity=this.arrayBuffer.byteLength/this.bytesPerElement,this._refreshViews()):(this.capacity=-1,this.resize(0))};m.serialize=function(){return{members:this.prototype.members,alignment:this.prototype.StructType.prototype.alignment,bytesPerElement:this.prototype.bytesPerElement}},m.prototype.serialize=function(t){return this._trim(),t&&(this.isTransferred=!0,t.push(this.arrayBuffer)),{length:this.length,arrayBuffer:this.arrayBuffer}},m.prototype.get=function(t){return new this.StructType(this,t)},m.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},m.prototype.resize=function(t){if(this.length=t,t>this.capacity){this.capacity=Math.max(t,Math.floor(this.capacity*p),f),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var e=this.uint8;this._refreshViews(),e&&this.uint8.set(e)}},m.prototype._refreshViews=function(){for(var t=this,e=0,i=this._usedTypes;e<i.length;e+=1){var n=i[e];t[o(n)]=new h[n](t.arrayBuffer)}},m.prototype.toArray=function(t,e){for(var i=this,n=[],r=t;r<e;r++){var a=i.get(r);n.push(a)}return n};var g={}},{}],128:[function(t,e,i){"use strict";function n(t,e){return e.replace(/{([^{}]+)}/g,function(e,i){return i in t?t[i]:""})}e.exports=n},{}],129:[function(t,e,i){"use strict";var n=t("@mapbox/unitbezier"),r=t("../geo/coordinate");t("point-geometry");i.easeCubicInOut=function(t){if(t<=0)return 0;if(t>=1)return 1;var e=t*t,i=e*t;return 4*(t<.5?i:3*(t-e)+i-.75)},i.bezier=function(t,e,i,r){var a=new n(t,e,i,r);return function(t){return a.solve(t)}},i.ease=i.bezier(.25,.1,.25,1),i.clamp=function(t,e,i){return Math.min(i,Math.max(e,t))},i.wrap=function(t,e,i){var n=i-e,r=((t-e)%n+n)%n+e;return r===e?i:r},i.asyncAll=function(t,e,i){if(!t.length)return i(null,[]);var n=t.length,r=new Array(t.length),a=null;t.forEach(function(t,o){e(t,function(t,e){t&&(a=t),r[o]=e,0===--n&&i(a,r)})})},i.values=function(t){var e=[];for(var i in t)e.push(t[i]);return e},i.keysDifference=function(t,e){var i=[];for(var n in t)n in e||i.push(n);return i},i.extend=function(t,e,i,n){for(var r=arguments,a=1;a<arguments.length;a++){var o=r[a];for(var s in o)t[s]=o[s]}return t},i.pick=function(t,e){for(var i={},n=0;n<e.length;n++){var r=e[n];r in t&&(i[r]=t[r])}return i};var a=1;i.uniqueId=function(){return a++},i.bindAll=function(t,e){t.forEach(function(t){e[t]&&(e[t]=e[t].bind(e))})},i.getCoordinatesCenter=function(t){for(var e=1/0,i=1/0,n=-(1/0),a=-(1/0),o=0;o<t.length;o++)e=Math.min(e,t[o].column),i=Math.min(i,t[o].row),n=Math.max(n,t[o].column),a=Math.max(a,t[o].row);var s=n-e,l=a-i,c=Math.max(s,l);return new r((e+n)/2,(i+a)/2,0).zoomTo(Math.floor(-Math.log(c)/Math.LN2))},i.endsWith=function(t,e){return t.indexOf(e,t.length-e.length)!==-1},i.mapObject=function(t,e,i){var n=this,r={};for(var a in t)r[a]=e.call(i||n,t[a],a,t);return r},i.filterObject=function(t,e,i){var n=this,r={};for(var a in t)e.call(i||n,t[a],a,t)&&(r[a]=t[a]);return r},i.deepEqual=function(t,e){if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(!i.deepEqual(t[n],e[n]))return!1;return!0}if("object"==typeof t&&null!==t&&null!==e){if("object"!=typeof e)return!1;var r=Object.keys(t);if(r.length!==Object.keys(e).length)return!1;for(var a in t)if(!i.deepEqual(t[a],e[a]))return!1;return!0}return t===e},i.clone=function(t){return Array.isArray(t)?t.map(i.clone):"object"==typeof t&&t?i.mapObject(t,i.clone):t},i.arraysIntersect=function(t,e){for(var i=0;i<t.length;i++)if(e.indexOf(t[i])>=0)return!0;return!1};var o={};i.warnOnce=function(t){o[t]||("undefined"!=typeof console&&console.warn(t),o[t]=!0)},i.isCounterClockwise=function(t,e,i){return(i.y-t.y)*(e.x-t.x)>(e.y-t.y)*(i.x-t.x)},i.calculateSignedArea=function(t){for(var e,i,n=0,r=0,a=t.length,o=a-1;r<a;o=r++)e=t[r],i=t[o],n+=(i.x-e.x)*(e.y+i.y);return n},i.isClosedPolygon=function(t){if(t.length<4)return!1;var e=t[0],n=t[t.length-1];return!(Math.abs(e.x-n.x)>0||Math.abs(e.y-n.y)>0)&&Math.abs(i.calculateSignedArea(t))>.01},i.sphericalToCartesian=function(t){var e=t[0],i=t[1],n=t[2];return i+=90,i*=Math.PI/180,n*=Math.PI/180,[e*Math.cos(i)*Math.sin(n),e*Math.sin(i)*Math.sin(n),e*Math.cos(n)]},i.parseCacheControl=function(t){var e=/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,i={};if(t.replace(e,function(t,e,n,r){var a=n||r;return i[e]=!a||a.toLowerCase(),""}),i["max-age"]){var n=parseInt(i["max-age"],10);isNaN(n)?delete i["max-age"]:i["max-age"]=n}return i}},{"../geo/coordinate":18,"@mapbox/unitbezier":134,"point-geometry":197}],130:[function(t,e,i){"use strict";var n=function(t,e,i,n){this.type="Feature",this._vectorTileFeature=t,t._z=e,t._x=i,t._y=n,this.properties=t.properties,null!=t.id&&(this.id=t.id)},r={geometry:{}};r.geometry.get=function(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},r.geometry.set=function(t){this._geometry=t},n.prototype.toJSON=function(){var t=this,e={geometry:this.geometry};for(var i in this)"_geometry"!==i&&"_vectorTileFeature"!==i&&(e[i]=t[i]);return e},Object.defineProperties(n.prototype,r),e.exports=n},{}],131:[function(t,e,i){"use strict";var n=t("./script_detection");e.exports=function(t){for(var i="",r=0;r<t.length;r++){var a=t.charCodeAt(r+1)||null,o=t.charCodeAt(r-1)||null,s=(!a||!n.charHasRotatedVerticalOrientation(a)||e.exports.lookup[t[r+1]])&&(!o||!n.charHasRotatedVerticalOrientation(o)||e.exports.lookup[t[r-1]]);i+=s&&e.exports.lookup[t[r]]?e.exports.lookup[t[r]]:t[r]}return i},e.exports.lookup={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""}},{"./script_detection":126}],132:[function(t,e,i){"use strict";var n=t("./web_worker"),r=function(){this.active={}};r.prototype.acquire=function(e){var i=this;if(!this.workers){var r=t("../mapbox-gl").workerCount;for(this.workers=[];this.workers.length<r;)i.workers.push(new n)}return this.active[e]=!0,this.workers.slice()},r.prototype.release=function(t){delete this.active[t],0===Object.keys(this.active).length&&(this.workers.forEach(function(t){t.terminate()}),this.workers=null)},e.exports=r},{"../mapbox-gl":24,"./web_worker":111}],133:[function(e,i,n){!function(e,r){"object"==typeof n&&"undefined"!=typeof i?i.exports=r():"function"==typeof t&&t.amd?t(r):e.glMatrix=r()}(this,function(){"use strict";function t(){var t=new Float32Array(3);return t[0]=0,t[1]=0,t[2]=0,t}function e(t,e,i){var n=e[0],r=e[1],a=e[2];return t[0]=n*i[0]+r*i[3]+a*i[6],t[1]=n*i[1]+r*i[4]+a*i[7],t[2]=n*i[2]+r*i[5]+a*i[8],t}function i(){var t=new Float32Array(4);return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t}function n(t,e,i){var n=e[0],r=e[1],a=e[2],o=e[3];return t[0]=i[0]*n+i[4]*r+i[8]*a+i[12]*o,t[1]=i[1]*n+i[5]*r+i[9]*a+i[13]*o,t[2]=i[2]*n+i[6]*r+i[10]*a+i[14]*o,t[3]=i[3]*n+i[7]*r+i[11]*a+i[15]*o,t}function r(){var t=new Float32Array(4);return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t}function a(t,e,i){var n=e[0],r=e[1],a=e[2],o=e[3],s=Math.sin(i),l=Math.cos(i);return t[0]=n*l+a*s,t[1]=r*l+o*s,t[2]=n*-s+a*l,t[3]=r*-s+o*l,t}function o(t,e,i){var n=e[0],r=e[1],a=e[2],o=e[3],s=i[0],l=i[1];return t[0]=n*s,t[1]=r*s,t[2]=a*l,t[3]=o*l,t}function s(){var t=new Float32Array(9);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function l(t,e){var i=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=i,t[2]=0,t[3]=-i,t[4]=n,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function c(){var t=new Float32Array(16);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function u(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function h(t,e){var i=e[0],n=e[1],r=e[2],a=e[3],o=e[4],s=e[5],l=e[6],c=e[7],u=e[8],h=e[9],d=e[10],f=e[11],p=e[12],m=e[13],g=e[14],v=e[15],y=i*s-n*o,b=i*l-r*o,_=i*c-a*o,x=n*l-r*s,w=n*c-a*s,M=r*c-a*l,z=u*m-h*p,S=u*g-d*p,E=u*v-f*p,k=h*g-d*m,T=h*v-f*m,P=d*v-f*g,O=y*P-b*T+_*k+x*E-w*S+M*z;return O?(O=1/O,t[0]=(s*P-l*T+c*k)*O,t[1]=(r*T-n*P-a*k)*O,t[2]=(m*M-g*w+v*x)*O,t[3]=(d*w-h*M-f*x)*O,t[4]=(l*E-o*P-c*S)*O,t[5]=(i*P-r*E+a*S)*O,t[6]=(g*_-p*M-v*b)*O,t[7]=(u*M-d*_+f*b)*O,t[8]=(o*T-s*E+c*z)*O,t[9]=(n*E-i*T-a*z)*O,t[10]=(p*w-m*_+v*y)*O,t[11]=(h*_-u*w-f*y)*O,t[12]=(s*S-o*k-l*z)*O,t[13]=(i*k-n*S+r*z)*O,t[14]=(m*b-p*x-g*y)*O,t[15]=(u*x-h*b+d*y)*O,t):null}function d(t,e,i){var n=e[0],r=e[1],a=e[2],o=e[3],s=e[4],l=e[5],c=e[6],u=e[7],h=e[8],d=e[9],f=e[10],p=e[11],m=e[12],g=e[13],v=e[14],y=e[15],b=i[0],_=i[1],x=i[2],w=i[3];return t[0]=b*n+_*s+x*h+w*m,t[1]=b*r+_*l+x*d+w*g,t[2]=b*a+_*c+x*f+w*v,t[3]=b*o+_*u+x*p+w*y,b=i[4],_=i[5],x=i[6],w=i[7],t[4]=b*n+_*s+x*h+w*m,t[5]=b*r+_*l+x*d+w*g,t[6]=b*a+_*c+x*f+w*v,t[7]=b*o+_*u+x*p+w*y,b=i[8],_=i[9],x=i[10],w=i[11],t[8]=b*n+_*s+x*h+w*m,t[9]=b*r+_*l+x*d+w*g,t[10]=b*a+_*c+x*f+w*v,t[11]=b*o+_*u+x*p+w*y,b=i[12],_=i[13],x=i[14],w=i[15],t[12]=b*n+_*s+x*h+w*m,t[13]=b*r+_*l+x*d+w*g,t[14]=b*a+_*c+x*f+w*v,t[15]=b*o+_*u+x*p+w*y,t}function f(t,e,i){var n,r,a,o,s,l,c,u,h,d,f,p,m=i[0],g=i[1],v=i[2];return e===t?(t[12]=e[0]*m+e[4]*g+e[8]*v+e[12],t[13]=e[1]*m+e[5]*g+e[9]*v+e[13],t[14]=e[2]*m+e[6]*g+e[10]*v+e[14],t[15]=e[3]*m+e[7]*g+e[11]*v+e[15]):(n=e[0],r=e[1],a=e[2],o=e[3],s=e[4],l=e[5],c=e[6],u=e[7],h=e[8],d=e[9],f=e[10],p=e[11],t[0]=n,t[1]=r,t[2]=a,t[3]=o,t[4]=s,t[5]=l,t[6]=c,t[7]=u,t[8]=h,t[9]=d,t[10]=f,t[11]=p,t[12]=n*m+s*g+h*v+e[12],t[13]=r*m+l*g+d*v+e[13],t[14]=a*m+c*g+f*v+e[14],t[15]=o*m+u*g+p*v+e[15]),t}function p(t,e,i){var n=i[0],r=i[1],a=i[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*a,t[9]=e[9]*a,t[10]=e[10]*a,t[11]=e[11]*a,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function m(t,e,i){var n=Math.sin(i),r=Math.cos(i),a=e[4],o=e[5],s=e[6],l=e[7],c=e[8],u=e[9],h=e[10],d=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=a*r+c*n,t[5]=o*r+u*n,t[6]=s*r+h*n,t[7]=l*r+d*n,t[8]=c*r-a*n,t[9]=u*r-o*n,t[10]=h*r-s*n,t[11]=d*r-l*n,t}function g(t,e,i){var n=Math.sin(i),r=Math.cos(i),a=e[0],o=e[1],s=e[2],l=e[3],c=e[4],u=e[5],h=e[6],d=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*r+c*n,t[1]=o*r+u*n,t[2]=s*r+h*n,t[3]=l*r+d*n,t[4]=c*r-a*n,t[5]=u*r-o*n,t[6]=h*r-s*n,t[7]=d*r-l*n,t}function v(t,e,i,n,r){var a=1/Math.tan(e/2),o=1/(n-r);return t[0]=a/i,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(r+n)*o,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*r*n*o,t[15]=0,t}function y(t,e,i,n,r,a,o){var s=1/(e-i),l=1/(n-r),c=1/(a-o);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+i)*s,t[13]=(r+n)*l,t[14]=(o+a)*c,t[15]=1,t}var b=(t(),i(),{vec3:{transformMat3:e},vec4:{transformMat4:n},mat2:{create:r,rotate:a,scale:o},mat3:{create:s,fromRotation:l},mat4:{create:c,identity:u,translate:f,scale:p,multiply:d,perspective:v,rotateX:m,rotateZ:g,invert:h,ortho:y}});return b})},{}],134:[function(t,e,i){function n(t,e,i,n){this.cx=3*t,this.bx=3*(i-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(n-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=n,this.p2x=i,this.p2y=n}e.exports=n,n.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},n.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},n.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},n.prototype.solveCurveX=function(t,e){"undefined"==typeof e&&(e=1e-6);var i,n,r,a,o;for(r=t,o=0;o<8;o++){if(a=this.sampleCurveX(r)-t,Math.abs(a)<e)return r;var s=this.sampleCurveDerivativeX(r);if(Math.abs(s)<1e-6)break;r-=a/s}if(i=0,n=1,r=t,r<i)return i;if(r>n)return n;for(;i<n;){if(a=this.sampleCurveX(r),Math.abs(a-t)<e)return r;t>a?i=r:n=r,r=.5*(n-i)+i}return r},n.prototype.solve=function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}},{}],
135:[function(t,e,i){function n(t){return t=Math.round(t),t<0?0:t>255?255:t}function r(t){return t<0?0:t>1?1:t}function a(t){return n("%"===t[t.length-1]?parseFloat(t)/100*255:parseInt(t))}function o(t){return r("%"===t[t.length-1]?parseFloat(t)/100:parseFloat(t))}function s(t,e,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?t+(e-t)*i*6:2*i<1?e:3*i<2?t+(e-t)*(2/3-i)*6:t}function l(t){var e=t.replace(/ /g,"").toLowerCase();if(e in c)return c[e].slice();if("#"===e[0]){if(4===e.length){var i=parseInt(e.substr(1),16);return i>=0&&i<=4095?[(3840&i)>>4|(3840&i)>>8,240&i|(240&i)>>4,15&i|(15&i)<<4,1]:null}if(7===e.length){var i=parseInt(e.substr(1),16);return i>=0&&i<=16777215?[(16711680&i)>>16,(65280&i)>>8,255&i,1]:null}return null}var r=e.indexOf("("),l=e.indexOf(")");if(r!==-1&&l+1===e.length){var u=e.substr(0,r),h=e.substr(r+1,l-(r+1)).split(","),d=1;switch(u){case"rgba":if(4!==h.length)return null;d=o(h.pop());case"rgb":return 3!==h.length?null:[a(h[0]),a(h[1]),a(h[2]),d];case"hsla":if(4!==h.length)return null;d=o(h.pop());case"hsl":if(3!==h.length)return null;var f=(parseFloat(h[0])%360+360)%360/360,p=o(h[1]),m=o(h[2]),g=m<=.5?m*(p+1):m+p-m*p,v=2*m-g;return[n(255*s(v,g,f+1/3)),n(255*s(v,g,f)),n(255*s(v,g,f-1/3)),d];default:return null}}return null}var c={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};try{i.parseCSSColor=l}catch(t){}},{}],136:[function(t,e,i){"use strict";function n(t,e,i){i=i||2;var n=e&&e.length,a=n?e[0]*i:t.length,s=r(t,0,a,i,!0),l=[];if(!s)return l;var c,u,d,f,p,m,g;if(n&&(s=h(t,e,s,i)),t.length>80*i){c=d=t[0],u=f=t[1];for(var v=i;v<a;v+=i)p=t[v],m=t[v+1],p<c&&(c=p),m<u&&(u=m),p>d&&(d=p),m>f&&(f=m);g=Math.max(d-c,f-u)}return o(s,l,i,c,u,g),l}function r(t,e,i,n,r){var a,o;if(r===A(t,e,i,n)>0)for(a=e;a<i;a+=n)o=T(a,t[a],t[a+1],o);else for(a=i-n;a>=e;a-=n)o=T(a,t[a],t[a+1],o);return o&&w(o,o.next)&&(P(o),o=o.next),o}function a(t,e){if(!t)return t;e||(e=t);var i,n=t;do if(i=!1,n.steiner||!w(n,n.next)&&0!==x(n.prev,n,n.next))n=n.next;else{if(P(n),n=e=n.prev,n===n.next)return null;i=!0}while(i||n!==e);return e}function o(t,e,i,n,r,h,d){if(t){!d&&h&&m(t,n,r,h);for(var f,p,g=t;t.prev!==t.next;)if(f=t.prev,p=t.next,h?l(t,n,r,h):s(t))e.push(f.i/i),e.push(t.i/i),e.push(p.i/i),P(t),t=p.next,g=p.next;else if(t=p,t===g){d?1===d?(t=c(t,e,i),o(t,e,i,n,r,h,2)):2===d&&u(t,e,i,n,r,h):o(a(t),e,i,n,r,h,1);break}}}function s(t){var e=t.prev,i=t,n=t.next;if(x(e,i,n)>=0)return!1;for(var r=t.next.next;r!==t.prev;){if(b(e.x,e.y,i.x,i.y,n.x,n.y,r.x,r.y)&&x(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function l(t,e,i,n){var r=t.prev,a=t,o=t.next;if(x(r,a,o)>=0)return!1;for(var s=r.x<a.x?r.x<o.x?r.x:o.x:a.x<o.x?a.x:o.x,l=r.y<a.y?r.y<o.y?r.y:o.y:a.y<o.y?a.y:o.y,c=r.x>a.x?r.x>o.x?r.x:o.x:a.x>o.x?a.x:o.x,u=r.y>a.y?r.y>o.y?r.y:o.y:a.y>o.y?a.y:o.y,h=v(s,l,e,i,n),d=v(c,u,e,i,n),f=t.nextZ;f&&f.z<=d;){if(f!==t.prev&&f!==t.next&&b(r.x,r.y,a.x,a.y,o.x,o.y,f.x,f.y)&&x(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(f=t.prevZ;f&&f.z>=h;){if(f!==t.prev&&f!==t.next&&b(r.x,r.y,a.x,a.y,o.x,o.y,f.x,f.y)&&x(f.prev,f,f.next)>=0)return!1;f=f.prevZ}return!0}function c(t,e,i){var n=t;do{var r=n.prev,a=n.next.next;!w(r,a)&&M(r,n,n.next,a)&&S(r,a)&&S(a,r)&&(e.push(r.i/i),e.push(n.i/i),e.push(a.i/i),P(n),P(n.next),n=t=a),n=n.next}while(n!==t);return n}function u(t,e,i,n,r,s){var l=t;do{for(var c=l.next.next;c!==l.prev;){if(l.i!==c.i&&_(l,c)){var u=k(l,c);return l=a(l,l.next),u=a(u,u.next),o(l,e,i,n,r,s),void o(u,e,i,n,r,s)}c=c.next}l=l.next}while(l!==t)}function h(t,e,i,n){var o,s,l,c,u,h=[];for(o=0,s=e.length;o<s;o++)l=e[o]*n,c=o<s-1?e[o+1]*n:t.length,u=r(t,l,c,n,!1),u===u.next&&(u.steiner=!0),h.push(y(u));for(h.sort(d),o=0;o<h.length;o++)f(h[o],i),i=a(i,i.next);return i}function d(t,e){return t.x-e.x}function f(t,e){if(e=p(t,e)){var i=k(e,t);a(i,i.next)}}function p(t,e){var i,n=e,r=t.x,a=t.y,o=-(1/0);do{if(a<=n.y&&a>=n.next.y){var s=n.x+(a-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(s<=r&&s>o){if(o=s,s===r){if(a===n.y)return n;if(a===n.next.y)return n.next}i=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!i)return null;if(r===o)return i.prev;var l,c=i,u=i.x,h=i.y,d=1/0;for(n=i.next;n!==c;)r>=n.x&&n.x>=u&&b(a<h?r:o,a,u,h,a<h?o:r,a,n.x,n.y)&&(l=Math.abs(a-n.y)/(r-n.x),(l<d||l===d&&n.x>i.x)&&S(n,t)&&(i=n,d=l)),n=n.next;return i}function m(t,e,i,n){var r=t;do null===r.z&&(r.z=v(r.x,r.y,e,i,n)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,g(r)}function g(t){var e,i,n,r,a,o,s,l,c=1;do{for(i=t,t=null,a=null,o=0;i;){for(o++,n=i,s=0,e=0;e<c&&(s++,n=n.nextZ);e++);for(l=c;s>0||l>0&&n;)0===s?(r=n,n=n.nextZ,l--):0!==l&&n?i.z<=n.z?(r=i,i=i.nextZ,s--):(r=n,n=n.nextZ,l--):(r=i,i=i.nextZ,s--),a?a.nextZ=r:t=r,r.prevZ=a,a=r;i=n}a.nextZ=null,c*=2}while(o>1);return t}function v(t,e,i,n,r){return t=32767*(t-i)/r,e=32767*(e-n)/r,t=16711935&(t|t<<8),t=252645135&(t|t<<4),t=858993459&(t|t<<2),t=1431655765&(t|t<<1),e=16711935&(e|e<<8),e=252645135&(e|e<<4),e=858993459&(e|e<<2),e=1431655765&(e|e<<1),t|e<<1}function y(t){var e=t,i=t;do e.x<i.x&&(i=e),e=e.next;while(e!==t);return i}function b(t,e,i,n,r,a,o,s){return(r-o)*(e-s)-(t-o)*(a-s)>=0&&(t-o)*(n-s)-(i-o)*(e-s)>=0&&(i-o)*(a-s)-(r-o)*(n-s)>=0}function _(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!z(t,e)&&S(t,e)&&S(e,t)&&E(t,e)}function x(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function w(t,e){return t.x===e.x&&t.y===e.y}function M(t,e,i,n){return!!(w(t,e)&&w(i,n)||w(t,n)&&w(i,e))||x(t,e,i)>0!=x(t,e,n)>0&&x(i,n,t)>0!=x(i,n,e)>0}function z(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&M(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}function S(t,e){return x(t.prev,t,t.next)<0?x(t,e,t.next)>=0&&x(t,t.prev,e)>=0:x(t,e,t.prev)<0||x(t,t.next,e)<0}function E(t,e){var i=t,n=!1,r=(t.x+e.x)/2,a=(t.y+e.y)/2;do i.y>a!=i.next.y>a&&r<(i.next.x-i.x)*(a-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next;while(i!==t);return n}function k(t,e){var i=new O(t.i,t.x,t.y),n=new O(e.i,e.x,e.y),r=t.next,a=e.prev;return t.next=e,e.prev=t,i.next=r,r.prev=i,n.next=i,i.prev=n,a.next=n,n.prev=a,n}function T(t,e,i,n){var r=new O(t,e,i);return n?(r.next=n.next,r.prev=n,n.next.prev=r,n.next=r):(r.prev=r,r.next=r),r}function P(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function O(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function A(t,e,i,n){for(var r=0,a=e,o=i-n;a<i;a+=n)r+=(t[o]-t[a])*(t[a+1]+t[o+1]),o=a;return r}e.exports=n,n.deviation=function(t,e,i,n){var r=e&&e.length,a=r?e[0]*i:t.length,o=Math.abs(A(t,0,a,i));if(r)for(var s=0,l=e.length;s<l;s++){var c=e[s]*i,u=s<l-1?e[s+1]*i:t.length;o-=Math.abs(A(t,c,u,i))}var h=0;for(s=0;s<n.length;s+=3){var d=n[s]*i,f=n[s+1]*i,p=n[s+2]*i;h+=Math.abs((t[d]-t[p])*(t[f+1]-t[d+1])-(t[d]-t[f])*(t[p+1]-t[d+1]))}return 0===o&&0===h?0:Math.abs((h-o)/o)},n.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},n=0,r=0;r<t.length;r++){for(var a=0;a<t[r].length;a++)for(var o=0;o<e;o++)i.vertices.push(t[r][a][o]);r>0&&(n+=t[r-1].length,i.holes.push(n))}return i}},{}],137:[function(t,e,i){function n(t){var e,i,r,c,u,h;switch(typeof t){case"object":if(null===t)return null;if(a(t)){for(r="[",i=t.length-1,e=0;e<i;e++)r+=n(t[e])+",";return i>-1&&(r+=n(t[e])),r+"]"}for(c=o(t).sort(),i=c.length,r="{",u=c[e=0],h=i>0&&void 0!==t[u];e<i;)h?(r+='"'+u.replace(s,l)+'":'+n(t[u]),u=c[++e],h=e<i&&void 0!==t[u],h&&(r+=",")):(u=c[++e],h=e<i&&void 0!==t[u]);return r+"}";case"undefined":return null;case"string":return'"'+t.replace(s,l)+'"';default:return t}}var r={}.toString,a=Array.isArray||function(t){return"[object Array]"===r.call(t)},o=Object.keys||function(t){var e=[];for(var i in t)t.hasOwnProperty(i)&&e.push(i);return e},s=/[\u0000-\u001f"\\]/g,l=function(t){var e=t.charCodeAt(0);switch(e){case 34:return'\\"';case 92:return"\\\\";case 12:return"\\f";case 10:return"\\n";case 13:return"\\r";case 9:return"\\t";case 8:return"\\b";default:return e>15?"\\u00"+e.toString(16):"\\u000"+e.toString(16)}};e.exports=function(t){if(void 0!==t)return""+n(t)},e.exports.stringSearch=s,e.exports.stringReplace=l},{}],138:[function(t,e,i){"use strict";function n(t){return new Function("f","var p = (f && f.properties || {}); return "+r(t))}function r(t){if(!t)return"true";var e=t[0];if(t.length<=1)return"any"===e?"false":"true";var i="=="===e?o(t[1],t[2],"===",!1):"!="===e?o(t[1],t[2],"!==",!1):"<"===e||">"===e||"<="===e||">="===e?o(t[1],t[2],e,!0):"any"===e?s(t.slice(1),"||"):"all"===e?s(t.slice(1),"&&"):"none"===e?u(s(t.slice(1),"||")):"in"===e?l(t[1],t.slice(2)):"!in"===e?u(l(t[1],t.slice(2))):"has"===e?c(t[1]):"!has"===e?u(c([t[1]])):"true";return"("+i+")"}function a(t){return"$type"===t?"f.type":"$id"===t?"f.id":"p["+JSON.stringify(t)+"]"}function o(t,e,i,n){var r=a(t),o="$type"===t?d.indexOf(e):JSON.stringify(e);return(n?"typeof "+r+"=== typeof "+o+"&&":"")+r+i+o}function s(t,e){return t.map(r).join(e)}function l(t,e){"$type"===t&&(e=e.map(function(t){return d.indexOf(t)}));var i=JSON.stringify(e.sort(h)),n=a(t);return e.length<=200?i+".indexOf("+n+") !== -1":"function(v, a, i, j) {while (i <= j) { var m = (i + j) >> 1;    if (a[m] === v) return true; if (a[m] > v) j = m - 1; else i = m + 1;}return false; }("+n+", "+i+",0,"+(e.length-1)+")"}function c(t){return JSON.stringify(t)+" in p"}function u(t){return"!("+t+")"}function h(t,e){return t<e?-1:t>e?1:0}e.exports=n;var d=["Unknown","Point","LineString","Polygon"]},{}],139:[function(t,e,i){function n(t){if("Polygon"===t.type)return r(t.coordinates);if("MultiPolygon"===t.type){for(var e=0,i=0;i<t.coordinates.length;i++)e+=r(t.coordinates[i]);return e}return null}function r(t){var e=0;if(t&&t.length>0){e+=Math.abs(a(t[0]));for(var i=1;i<t.length;i++)e-=Math.abs(a(t[i]))}return e}function a(t){var e=0;if(t.length>2){for(var i,n,r=0;r<t.length-1;r++)i=t[r],n=t[r+1],e+=o(n[0]-i[0])*(2+Math.sin(o(i[1]))+Math.sin(o(n[1])));e=e*s.RADIUS*s.RADIUS/2}return e}function o(t){return t*Math.PI/180}var s=t("wgs84");e.exports.geometry=n,e.exports.ring=a},{wgs84:214}],140:[function(t,e,i){function n(t,e){switch(t&&t.type||null){case"FeatureCollection":return t.features=t.features.map(r(n,e)),t;case"Feature":return t.geometry=n(t.geometry,e),t;case"Polygon":case"MultiPolygon":return a(t,e);default:return t}}function r(t,e){return function(i){return t(i,e)}}function a(t,e){return"Polygon"===t.type?t.coordinates=o(t.coordinates,e):"MultiPolygon"===t.type&&(t.coordinates=t.coordinates.map(r(o,e))),t}function o(t,e){e=!!e,t[0]=s(t[0],!e);for(var i=1;i<t.length;i++)t[i]=s(t[i],e);return t}function s(t,e){return l(t)===e?t:t.reverse()}function l(t){return c.ring(t)>=0}var c=t("geojson-area");e.exports=n},{"geojson-area":139}],141:[function(t,e,i){"use strict";function n(t,e,i,n,o,l,c,u){if(i/=e,n/=e,c>=i&&u<=n)return t;if(c>n||u<i)return null;for(var h=[],d=0;d<t.length;d++){var f,p,m=t[d],g=m.geometry,v=m.type;if(f=m.min[o],p=m.max[o],f>=i&&p<=n)h.push(m);else if(!(f>n||p<i)){var y=1===v?r(g,i,n,o):a(g,i,n,o,l,3===v);y.length&&h.push(s(m.tags,v,y,m.id))}}return h.length?h:null}function r(t,e,i,n){for(var r=[],a=0;a<t.length;a++){var o=t[a],s=o[n];s>=e&&s<=i&&r.push(o)}return r}function a(t,e,i,n,r,a){for(var s=[],l=0;l<t.length;l++){var c,u,h,d=0,f=0,p=null,m=t[l],g=m.area,v=m.dist,y=m.outer,b=m.length,_=[];for(u=0;u<b-1;u++)c=p||m[u],p=m[u+1],d=f||c[n],f=p[n],d<e?f>i?(_.push(r(c,p,e),r(c,p,i)),a||(_=o(s,_,g,v,y))):f>=e&&_.push(r(c,p,e)):d>i?f<e?(_.push(r(c,p,i),r(c,p,e)),a||(_=o(s,_,g,v,y))):f<=i&&_.push(r(c,p,i)):(_.push(c),f<e?(_.push(r(c,p,e)),a||(_=o(s,_,g,v,y))):f>i&&(_.push(r(c,p,i)),a||(_=o(s,_,g,v,y))));c=m[b-1],d=c[n],d>=e&&d<=i&&_.push(c),h=_[_.length-1],a&&h&&(_[0][0]!==h[0]||_[0][1]!==h[1])&&_.push(_[0]),o(s,_,g,v,y)}return s}function o(t,e,i,n,r){return e.length&&(e.area=i,e.dist=n,void 0!==r&&(e.outer=r),t.push(e)),[]}e.exports=n;var s=t("./feature")},{"./feature":143}],142:[function(t,e,i){"use strict";function n(t,e){var i=[];if("FeatureCollection"===t.type)for(var n=0;n<t.features.length;n++)r(i,t.features[n],e);else"Feature"===t.type?r(i,t,e):r(i,{geometry:t},e);return i}function r(t,e,i){if(null!==e.geometry){var n,s,l,u,h=e.geometry,d=h.type,f=h.coordinates,p=e.properties,m=e.id;if("Point"===d)t.push(c(p,1,[o(f)],m));else if("MultiPoint"===d)t.push(c(p,1,a(f),m));else if("LineString"===d)t.push(c(p,2,[a(f,i)],m));else if("MultiLineString"===d||"Polygon"===d){for(l=[],n=0;n<f.length;n++)u=a(f[n],i),"Polygon"===d&&(u.outer=0===n),l.push(u);t.push(c(p,"Polygon"===d?3:2,l,m))}else if("MultiPolygon"===d){for(l=[],n=0;n<f.length;n++)for(s=0;s<f[n].length;s++)u=a(f[n][s],i),u.outer=0===s,l.push(u);t.push(c(p,3,l,m))}else{if("GeometryCollection"!==d)throw new Error("Input data is not a valid GeoJSON object.");for(n=0;n<h.geometries.length;n++)r(t,{geometry:h.geometries[n],properties:p},i)}}}function a(t,e){for(var i=[],n=0;n<t.length;n++)i.push(o(t[n]));return e&&(l(i,e),s(i)),i}function o(t){var e=Math.sin(t[1]*Math.PI/180),i=t[0]/360+.5,n=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return n=n<0?0:n>1?1:n,[i,n,0]}function s(t){for(var e,i,n=0,r=0,a=0;a<t.length-1;a++)e=i||t[a],i=t[a+1],n+=e[0]*i[1]-i[0]*e[1],r+=Math.abs(i[0]-e[0])+Math.abs(i[1]-e[1]);t.area=Math.abs(n/2),t.dist=r}e.exports=n;var l=t("./simplify"),c=t("./feature")},{"./feature":143,"./simplify":145}],143:[function(t,e,i){"use strict";function n(t,e,i,n){var a={id:n||null,type:e,geometry:i,tags:t||null,min:[1/0,1/0],max:[-(1/0),-(1/0)]};return r(a),a}function r(t){var e=t.geometry,i=t.min,n=t.max;if(1===t.type)a(i,n,e);else for(var r=0;r<e.length;r++)a(i,n,e[r]);return t}function a(t,e,i){for(var n,r=0;r<i.length;r++)n=i[r],t[0]=Math.min(n[0],t[0]),e[0]=Math.max(n[0],e[0]),t[1]=Math.min(n[1],t[1]),e[1]=Math.max(n[1],e[1])}e.exports=n},{}],144:[function(t,e,i){"use strict";function n(t,e){return new r(t,e)}function r(t,e){e=this.options=l(Object.create(this.options),e);var i=e.debug;i&&console.time("preprocess data");var n=1<<e.maxZoom,r=u(t,e.tolerance/(n*e.extent));this.tiles={},this.tileCoords=[],i&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",e.indexMaxZoom,e.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),r=f(r,e.buffer/e.extent,o),r.length&&this.splitTile(r,0,0,0),i&&(r.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function a(t,e,i){return 32*((1<<t)*i+e)+t}function o(t,e,i){return[i,(i-t[0])*(e[1]-t[1])/(e[0]-t[0])+t[1],1]}function s(t,e,i){return[(i-t[1])*(e[0]-t[0])/(e[1]-t[1])+t[0],i,1]}function l(t,e){for(var i in e)t[i]=e[i];return t}function c(t,e,i){var n=t.source;if(1!==n.length)return!1;var r=n[0];if(3!==r.type||r.geometry.length>1)return!1;var a=r.geometry[0].length;if(5!==a)return!1;for(var o=0;o<a;o++){var s=h.point(r.geometry[0][o],e,t.z2,t.x,t.y);if(s[0]!==-i&&s[0]!==e+i||s[1]!==-i&&s[1]!==e+i)return!1}return!0}e.exports=n;var u=t("./convert"),h=t("./transform"),d=t("./clip"),f=t("./wrap"),p=t("./tile");r.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,solidChildren:!1,tolerance:3,extent:4096,buffer:64,debug:0},r.prototype.splitTile=function(t,e,i,n,r,l,u){for(var h=[t,e,i,n],f=this.options,m=f.debug,g=null;h.length;){n=h.pop(),i=h.pop(),e=h.pop(),t=h.pop();var v=1<<e,y=a(e,i,n),b=this.tiles[y],_=e===f.maxZoom?0:f.tolerance/(v*f.extent);if(!b&&(m>1&&console.time("creation"),b=this.tiles[y]=p(t,v,i,n,_,e===f.maxZoom),this.tileCoords.push({z:e,x:i,y:n}),m)){m>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",e,i,n,b.numFeatures,b.numPoints,b.numSimplified),console.timeEnd("creation"));var x="z"+e;this.stats[x]=(this.stats[x]||0)+1,this.total++}if(b.source=t,r){if(e===f.maxZoom||e===r)continue;var w=1<<r-e;if(i!==Math.floor(l/w)||n!==Math.floor(u/w))continue}else if(e===f.indexMaxZoom||b.numPoints<=f.indexMaxPoints)continue;if(f.solidChildren||!c(b,f.extent,f.buffer)){b.source=null,m>1&&console.time("clipping");var M,z,S,E,k,T,P=.5*f.buffer/f.extent,O=.5-P,A=.5+P,I=1+P;M=z=S=E=null,k=d(t,v,i-P,i+A,0,o,b.min[0],b.max[0]),T=d(t,v,i+O,i+I,0,o,b.min[0],b.max[0]),k&&(M=d(k,v,n-P,n+A,1,s,b.min[1],b.max[1]),z=d(k,v,n+O,n+I,1,s,b.min[1],b.max[1])),T&&(S=d(T,v,n-P,n+A,1,s,b.min[1],b.max[1]),E=d(T,v,n+O,n+I,1,s,b.min[1],b.max[1])),m>1&&console.timeEnd("clipping"),t.length&&(h.push(M||[],e+1,2*i,2*n),h.push(z||[],e+1,2*i,2*n+1),h.push(S||[],e+1,2*i+1,2*n),h.push(E||[],e+1,2*i+1,2*n+1))}else r&&(g=e)}return g},r.prototype.getTile=function(t,e,i){var n=this.options,r=n.extent,o=n.debug,s=1<<t;e=(e%s+s)%s;var l=a(t,e,i);if(this.tiles[l])return h.tile(this.tiles[l],r);o>1&&console.log("drilling down to z%d-%d-%d",t,e,i);for(var u,d=t,f=e,p=i;!u&&d>0;)d--,f=Math.floor(f/2),p=Math.floor(p/2),u=this.tiles[a(d,f,p)];if(!u||!u.source)return null;if(o>1&&console.log("found parent tile z%d-%d-%d",d,f,p),c(u,r,n.buffer))return h.tile(u,r);o>1&&console.time("drilling down");var m=this.splitTile(u.source,d,f,p,t,e,i);if(o>1&&console.timeEnd("drilling down"),null!==m){var g=1<<t-m;l=a(m,Math.floor(e/g),Math.floor(i/g))}return this.tiles[l]?h.tile(this.tiles[l],r):null}},{"./clip":141,"./convert":142,"./tile":146,"./transform":147,"./wrap":148}],145:[function(t,e,i){"use strict";function n(t,e){var i,n,a,o,s=e*e,l=t.length,c=0,u=l-1,h=[];for(t[c][2]=1,t[u][2]=1;u;){for(n=0,i=c+1;i<u;i++)a=r(t[i],t[c],t[u]),a>n&&(o=i,n=a);n>s?(t[o][2]=n,h.push(c),h.push(o),c=o):(u=h.pop(),c=h.pop())}}function r(t,e,i){var n=e[0],r=e[1],a=i[0],o=i[1],s=t[0],l=t[1],c=a-n,u=o-r;if(0!==c||0!==u){var h=((s-n)*c+(l-r)*u)/(c*c+u*u);h>1?(n=a,r=o):h>0&&(n+=c*h,r+=u*h)}return c=s-n,u=l-r,c*c+u*u}e.exports=n},{}],146:[function(t,e,i){"use strict";function n(t,e,i,n,a,o){for(var s={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:i,y:n,z2:e,transformed:!1,min:[2,1],max:[-1,0]},l=0;l<t.length;l++){s.numFeatures++,r(s,t[l],a,o);var c=t[l].min,u=t[l].max;c[0]<s.min[0]&&(s.min[0]=c[0]),c[1]<s.min[1]&&(s.min[1]=c[1]),u[0]>s.max[0]&&(s.max[0]=u[0]),u[1]>s.max[1]&&(s.max[1]=u[1])}return s}function r(t,e,i,n){var r,o,s,l,c=e.geometry,u=e.type,h=[],d=i*i;if(1===u)for(r=0;r<c.length;r++)h.push(c[r]),t.numPoints++,t.numSimplified++;else for(r=0;r<c.length;r++)if(s=c[r],n||!(2===u&&s.dist<i||3===u&&s.area<d)){var f=[];for(o=0;o<s.length;o++)l=s[o],(n||l[2]>d)&&(f.push(l),t.numSimplified++),t.numPoints++;3===u&&a(f,s.outer),h.push(f)}else t.numPoints+=s.length;if(h.length){var p={geometry:h,type:u,tags:e.tags||null};null!==e.id&&(p.id=e.id),t.features.push(p)}}function a(t,e){var i=o(t);i<0===e&&t.reverse()}function o(t){for(var e,i,n=0,r=0,a=t.length,o=a-1;r<a;o=r++)e=t[r],i=t[o],n+=(i[0]-e[0])*(e[1]+i[1]);return n}e.exports=n},{}],147:[function(t,e,i){"use strict";function n(t,e){if(t.transformed)return t;var i,n,a,o=t.z2,s=t.x,l=t.y;for(i=0;i<t.features.length;i++){var c=t.features[i],u=c.geometry,h=c.type;if(1===h)for(n=0;n<u.length;n++)u[n]=r(u[n],e,o,s,l);else for(n=0;n<u.length;n++){var d=u[n];for(a=0;a<d.length;a++)d[a]=r(d[a],e,o,s,l)}}return t.transformed=!0,t}function r(t,e,i,n,r){var a=Math.round(e*(t[0]*i-n)),o=Math.round(e*(t[1]*i-r));return[a,o]}i.tile=n,i.point=r},{}],148:[function(t,e,i){"use strict";function n(t,e,i){var n=t,a=o(t,1,-1-e,e,0,i,-1,2),s=o(t,1,1-e,2+e,0,i,-1,2);return(a||s)&&(n=o(t,1,-e,1+e,0,i,-1,2)||[],a&&(n=r(a,1).concat(n)),s&&(n=n.concat(r(s,-1)))),n}function r(t,e){for(var i=[],n=0;n<t.length;n++){var r,o=t[n],l=o.type;if(1===l)r=a(o.geometry,e);else{r=[];for(var c=0;c<o.geometry.length;c++)r.push(a(o.geometry[c],e))}i.push(s(o.tags,l,r,o.id))}return i}function a(t,e){var i=[];i.area=t.area,i.dist=t.dist;for(var n=0;n<t.length;n++)i.push([t[n][0]+e,t[n][1],t[n][2]]);return i}var o=t("./clip"),s=t("./feature");e.exports=n},{"./clip":141,"./feature":143}],149:[function(t,e,i){"use strict";function n(t,e,i){var n=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var a=new Int32Array(this.arrayBuffer);t=a[0],e=a[1],i=a[2],this.d=e+2*i;for(var o=0;o<this.d*this.d;o++){var s=a[r+o],l=a[r+o+1];n.push(s===l?null:a.subarray(s,l))}var c=a[r+n.length],u=a[r+n.length+1];this.keys=a.subarray(c,u),this.bboxes=a.subarray(u),this.insert=this._insertReadonly}else{this.d=e+2*i;for(var h=0;h<this.d*this.d;h++)n.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=i,this.scale=e/t,this.uid=0;var d=i/e*t;this.min=-d,this.max=t+d}e.exports=n;var r=3;n.prototype.insert=function(t,e,i,n,r){this._forEachCell(e,i,n,r,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(i),this.bboxes.push(n),this.bboxes.push(r)},n.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},n.prototype._insertCell=function(t,e,i,n,r,a){this.cells[r].push(a)},n.prototype.query=function(t,e,i,n){var r=this.min,a=this.max;if(t<=r&&e<=r&&a<=i&&a<=n)return Array.prototype.slice.call(this.keys);var o=[],s={};return this._forEachCell(t,e,i,n,this._queryCell,o,s),o},n.prototype._queryCell=function(t,e,i,n,r,a,o){var s=this.cells[r];if(null!==s)for(var l=this.keys,c=this.bboxes,u=0;u<s.length;u++){var h=s[u];if(void 0===o[h]){var d=4*h;t<=c[d+2]&&e<=c[d+3]&&i>=c[d+0]&&n>=c[d+1]?(o[h]=!0,a.push(l[h])):o[h]=!1}}},n.prototype._forEachCell=function(t,e,i,n,r,a,o){for(var s=this._convertToCellCoord(t),l=this._convertToCellCoord(e),c=this._convertToCellCoord(i),u=this._convertToCellCoord(n),h=s;h<=c;h++)for(var d=l;d<=u;d++){var f=this.d*d+h;if(r.call(this,t,e,i,n,f,a,o))return}},n.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},n.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=r+this.cells.length+1+1,i=0,n=0;n<this.cells.length;n++)i+=this.cells[n].length;var a=new Int32Array(e+i+this.keys.length+this.bboxes.length);a[0]=this.extent,a[1]=this.n,a[2]=this.padding;for(var o=e,s=0;s<t.length;s++){var l=t[s];a[r+s]=o,a.set(l,o),o+=l.length}return a[r+t.length]=o,a.set(this.keys,o),o+=this.keys.length,a[r+t.length+1]=o,a.set(this.bboxes,o),o+=this.bboxes.length,a.buffer}},{}],150:[function(t,e,i){i.read=function(t,e,i,n,r){var a,o,s=8*r-n-1,l=(1<<s)-1,c=l>>1,u=-7,h=i?r-1:0,d=i?-1:1,f=t[e+h];for(h+=d,a=f&(1<<-u)-1,f>>=-u,u+=s;u>0;a=256*a+t[e+h],h+=d,u-=8);for(o=a&(1<<-u)-1,a>>=-u,u+=n;u>0;o=256*o+t[e+h],h+=d,u-=8);if(0===a)a=1-c;else{if(a===l)return o?NaN:(f?-1:1)*(1/0);o+=Math.pow(2,n),a-=c}return(f?-1:1)*o*Math.pow(2,a-n)},i.write=function(t,e,i,n,r,a){var o,s,l,c=8*a-r-1,u=(1<<c)-1,h=u>>1,d=23===r?Math.pow(2,-24)-Math.pow(2,-77):0,f=n?0:a-1,p=n?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,o=u):(o=Math.floor(Math.log(e)/Math.LN2),e*(l=Math.pow(2,-o))<1&&(o--,l*=2),e+=o+h>=1?d/l:d*Math.pow(2,1-h),e*l>=2&&(o++,l/=2),o+h>=u?(s=0,o=u):o+h>=1?(s=(e*l-1)*Math.pow(2,r),o+=h):(s=e*Math.pow(2,h-1)*Math.pow(2,r),o=0));r>=8;t[i+f]=255&s,f+=p,s/=256,r-=8);for(o=o<<r|s,c+=r;c>0;t[i+f]=255&o,f+=p,o/=256,c-=8);t[i+f-p]|=128*m}},{}],151:[function(t,e,i){"use strict";function n(t,e,i,n,a){return new r(t,e,i,n,a)}function r(t,e,i,n,r){e=e||a,i=i||o,r=r||Array,this.nodeSize=n||64,this.points=t,this.ids=new r(t.length),this.coords=new r(2*t.length);for(var l=0;l<t.length;l++)this.ids[l]=l,this.coords[2*l]=e(t[l]),this.coords[2*l+1]=i(t[l]);s(this.ids,this.coords,this.nodeSize,0,this.ids.length-1,0)}function a(t){return t[0]}function o(t){return t[1]}var s=t("./sort"),l=t("./range"),c=t("./within");e.exports=n,r.prototype={range:function(t,e,i,n){return l(this.ids,this.coords,t,e,i,n,this.nodeSize)},within:function(t,e,i){return c(this.ids,this.coords,t,e,i,this.nodeSize)}}},{"./range":152,"./sort":153,"./within":154}],152:[function(t,e,i){"use strict";function n(t,e,i,n,r,a,o){for(var s,l,c=[0,t.length-1,0],u=[];c.length;){var h=c.pop(),d=c.pop(),f=c.pop();if(d-f<=o)for(var p=f;p<=d;p++)s=e[2*p],l=e[2*p+1],s>=i&&s<=r&&l>=n&&l<=a&&u.push(t[p]);else{var m=Math.floor((f+d)/2);s=e[2*m],l=e[2*m+1],s>=i&&s<=r&&l>=n&&l<=a&&u.push(t[m]);var g=(h+1)%2;(0===h?i<=s:n<=l)&&(c.push(f),c.push(m-1),c.push(g)),(0===h?r>=s:a>=l)&&(c.push(m+1),c.push(d),c.push(g))}}return u}e.exports=n},{}],153:[function(t,e,i){"use strict";function n(t,e,i,a,o,s){if(!(o-a<=i)){var l=Math.floor((a+o)/2);r(t,e,l,a,o,s%2),n(t,e,i,a,l-1,s+1),n(t,e,i,l+1,o,s+1)}}function r(t,e,i,n,o,s){for(;o>n;){if(o-n>600){var l=o-n+1,c=i-n+1,u=Math.log(l),h=.5*Math.exp(2*u/3),d=.5*Math.sqrt(u*h*(l-h)/l)*(c-l/2<0?-1:1),f=Math.max(n,Math.floor(i-c*h/l+d)),p=Math.min(o,Math.floor(i+(l-c)*h/l+d));r(t,e,i,f,p,s)}var m=e[2*i+s],g=n,v=o;for(a(t,e,n,i),e[2*o+s]>m&&a(t,e,n,o);g<v;){for(a(t,e,g,v),g++,v--;e[2*g+s]<m;)g++;for(;e[2*v+s]>m;)v--}e[2*n+s]===m?a(t,e,n,v):(v++,a(t,e,v,o)),v<=i&&(n=v+1),i<=v&&(o=v-1)}}function a(t,e,i,n){o(t,i,n),o(e,2*i,2*n),o(e,2*i+1,2*n+1)}function o(t,e,i){var n=t[e];t[e]=t[i],t[i]=n}e.exports=n},{}],154:[function(t,e,i){"use strict";function n(t,e,i,n,a,o){for(var s=[0,t.length-1,0],l=[],c=a*a;s.length;){var u=s.pop(),h=s.pop(),d=s.pop();if(h-d<=o)for(var f=d;f<=h;f++)r(e[2*f],e[2*f+1],i,n)<=c&&l.push(t[f]);else{var p=Math.floor((d+h)/2),m=e[2*p],g=e[2*p+1];r(m,g,i,n)<=c&&l.push(t[p]);var v=(u+1)%2;(0===u?i-a<=m:n-a<=g)&&(s.push(d),s.push(p-1),s.push(v)),(0===u?i+a>=m:n+a>=g)&&(s.push(p+1),s.push(h),s.push(v))}}return l}function r(t,e,i,n){var r=t-i,a=e-n;return r*r+a*a}e.exports=n},{}],155:[function(t,e,i){function n(t){return!!t&&"object"==typeof t}function r(t,e){for(var i=-1,n=t.length;++i<n;)if(e(t[i],i,t))return!0;return!1}function a(t,e,i,r,s,l){return t===e||(null==t||null==e||!u(t)&&!n(e)?t!==t&&e!==e:o(t,e,a,i,r,s,l))}function o(t,e,i,n,r,a,o){var u=h(t),f=h(e),g=m,v=m;u||(g=S.call(t),g==p?g=_:g!=_&&(u=d(t))),f||(v=S.call(e),v==p?v=_:v!=_&&(f=d(e)));var y=g==_,b=v==_,x=g==v;if(x&&!u&&!y)return l(t,e,g);if(!r){var w=y&&z.call(t,"__wrapped__"),M=b&&z.call(e,"__wrapped__");if(w||M)return i(w?t.value():t,M?e.value():e,n,r,a,o)}if(!x)return!1;a||(a=[]),o||(o=[]);for(var E=a.length;E--;)if(a[E]==t)return o[E]==e;a.push(t),o.push(e);var k=(u?s:c)(t,e,i,n,r,a,o);return a.pop(),o.pop(),k}function s(t,e,i,n,a,o,s){var l=-1,c=t.length,u=e.length;if(c!=u&&!(a&&u>c))return!1;for(;++l<c;){var h=t[l],d=e[l],f=n?n(a?d:h,a?h:d,l):void 0;if(void 0!==f){if(f)continue;return!1}if(a){if(!r(e,function(t){return h===t||i(h,t,n,a,o,s)}))return!1}else if(h!==d&&!i(h,d,n,a,o,s))return!1}return!0}function l(t,e,i){switch(i){case g:case v:return+t==+e;case y:return t.name==e.name&&t.message==e.message;case b:return t!=+t?e!=+e:t==+e;case x:case w:return t==e+""}return!1}function c(t,e,i,n,r,a,o){var s=f(t),l=s.length,c=f(e),u=c.length;if(l!=u&&!r)return!1;for(var h=l;h--;){var d=s[h];if(!(r?d in e:z.call(e,d)))return!1}for(var p=r;++h<l;){d=s[h];var m=t[d],g=e[d],v=n?n(r?g:m,r?m:g,d):void 0;if(!(void 0===v?i(m,g,n,r,a,o):v))return!1;p||(p="constructor"==d)}if(!p){var y=t.constructor,b=e.constructor;if(y!=b&&"constructor"in t&&"constructor"in e&&!("function"==typeof y&&y instanceof y&&"function"==typeof b&&b instanceof b))return!1}return!0}function u(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}var h=t("lodash.isarray"),d=t("lodash.istypedarray"),f=t("lodash.keys"),p="[object Arguments]",m="[object Array]",g="[object Boolean]",v="[object Date]",y="[object Error]",b="[object Number]",_="[object Object]",x="[object RegExp]",w="[object String]",M=Object.prototype,z=M.hasOwnProperty,S=M.toString;e.exports=a},{"lodash.isarray":159,"lodash.istypedarray":161,"lodash.keys":162}],156:[function(t,e,i){function n(t,e,i){if("function"!=typeof t)return r;if(void 0===e)return t;switch(i){case 1:return function(i){return t.call(e,i)};case 3:return function(i,n,r){return t.call(e,i,n,r)};case 4:return function(i,n,r,a){return t.call(e,i,n,r,a)};case 5:return function(i,n,r,a,o){return t.call(e,i,n,r,a,o)}}return function(){return t.apply(e,arguments)}}function r(t){return t}e.exports=n},{}],157:[function(t,e,i){function n(t){return!!t&&"object"==typeof t}function r(t,e){var i=null==t?void 0:t[e];return s(i)?i:void 0}function a(t){return o(t)&&f.call(t)==l}function o(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function s(t){return null!=t&&(a(t)?p.test(h.call(t)):n(t)&&c.test(t))}var l="[object Function]",c=/^\[object .+?Constructor\]$/,u=Object.prototype,h=Function.prototype.toString,d=u.hasOwnProperty,f=u.toString,p=RegExp("^"+h.call(d).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");
e.exports=r},{}],158:[function(t,e,i){function n(t){return a(t)&&m.call(t,"callee")&&(!v.call(t,"callee")||g.call(t)==h)}function r(t){return null!=t&&s(t.length)&&!o(t)}function a(t){return c(t)&&r(t)}function o(t){var e=l(t)?g.call(t):"";return e==d||e==f}function s(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=u}function l(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function c(t){return!!t&&"object"==typeof t}var u=9007199254740991,h="[object Arguments]",d="[object Function]",f="[object GeneratorFunction]",p=Object.prototype,m=p.hasOwnProperty,g=p.toString,v=p.propertyIsEnumerable;e.exports=n},{}],159:[function(t,e,i){function n(t){return!!t&&"object"==typeof t}function r(t,e){var i=null==t?void 0:t[e];return l(i)?i:void 0}function a(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=y}function o(t){return s(t)&&m.call(t)==u}function s(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function l(t){return null!=t&&(o(t)?g.test(f.call(t)):n(t)&&h.test(t))}var c="[object Array]",u="[object Function]",h=/^\[object .+?Constructor\]$/,d=Object.prototype,f=Function.prototype.toString,p=d.hasOwnProperty,m=d.toString,g=RegExp("^"+f.call(p).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),v=r(Array,"isArray"),y=9007199254740991,b=v||function(t){return n(t)&&a(t.length)&&m.call(t)==c};e.exports=b},{}],160:[function(t,e,i){function n(t,e,i,n){i="function"==typeof i?a(i,n,3):void 0;var o=i?i(t,e):void 0;return void 0===o?r(t,e,i):!!o}var r=t("lodash._baseisequal"),a=t("lodash._bindcallback");e.exports=n},{"lodash._baseisequal":155,"lodash._bindcallback":156}],161:[function(t,e,i){function n(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=o}function r(t){return!!t&&"object"==typeof t}function a(t){return r(t)&&n(t.length)&&!!A[C.call(t)]}var o=9007199254740991,s="[object Arguments]",l="[object Array]",c="[object Boolean]",u="[object Date]",h="[object Error]",d="[object Function]",f="[object Map]",p="[object Number]",m="[object Object]",g="[object RegExp]",v="[object Set]",y="[object String]",b="[object WeakMap]",_="[object ArrayBuffer]",x="[object DataView]",w="[object Float32Array]",M="[object Float64Array]",z="[object Int8Array]",S="[object Int16Array]",E="[object Int32Array]",k="[object Uint8Array]",T="[object Uint8ClampedArray]",P="[object Uint16Array]",O="[object Uint32Array]",A={};A[w]=A[M]=A[z]=A[S]=A[E]=A[k]=A[T]=A[P]=A[O]=!0,A[s]=A[l]=A[_]=A[c]=A[x]=A[u]=A[h]=A[d]=A[f]=A[p]=A[m]=A[g]=A[v]=A[y]=A[b]=!1;var I=Object.prototype,C=I.toString;e.exports=a},{}],162:[function(t,e,i){function n(t){return function(e){return null==e?void 0:e[t]}}function r(t){return null!=t&&o(y(t))}function a(t,e){return t="number"==typeof t||f.test(t)?+t:-1,e=null==e?v:e,t>-1&&t%1==0&&t<e}function o(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=v}function s(t){for(var e=c(t),i=e.length,n=i&&t.length,r=!!n&&o(n)&&(d(t)||h(t)),s=-1,l=[];++s<i;){var u=e[s];(r&&a(u,n)||m.call(t,u))&&l.push(u)}return l}function l(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}function c(t){if(null==t)return[];l(t)||(t=Object(t));var e=t.length;e=e&&o(e)&&(d(t)||h(t))&&e||0;for(var i=t.constructor,n=-1,r="function"==typeof i&&i.prototype===t,s=Array(e),c=e>0;++n<e;)s[n]=n+"";for(var u in t)c&&a(u,e)||"constructor"==u&&(r||!m.call(t,u))||s.push(u);return s}var u=t("lodash._getnative"),h=t("lodash.isarguments"),d=t("lodash.isarray"),f=/^\d+$/,p=Object.prototype,m=p.hasOwnProperty,g=u(Object,"keys"),v=9007199254740991,y=n("length"),b=g?function(t){var e=null==t?void 0:t.constructor;return"function"==typeof e&&e.prototype===t||"function"!=typeof t&&r(t)?s(t):l(t)?g(t):[]}:s;e.exports=b},{"lodash._getnative":157,"lodash.isarguments":158,"lodash.isarray":159}],163:[function(t,e,i){function n(t){return t>v?Math.pow(t,1/3):t/g+p}function r(t){return t>m?t*t*t:g*(t-p)}function a(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function o(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function s(t){var e=o(t[0]),i=o(t[1]),r=o(t[2]),a=n((.4124564*e+.3575761*i+.1804375*r)/h),s=n((.2126729*e+.7151522*i+.072175*r)/d),l=n((.0193339*e+.119192*i+.9503041*r)/f);return[116*s-16,500*(a-s),200*(s-l),t[3]]}function l(t){var e=(t[0]+16)/116,i=isNaN(t[1])?e:e+t[1]/500,n=isNaN(t[2])?e:e-t[2]/200;return e=d*r(e),i=h*r(i),n=f*r(n),[a(3.2404542*i-1.5371385*e-.4985314*n),a(-.969266*i+1.8760108*e+.041556*n),a(.0556434*i-.2040259*e+1.0572252*n),t[3]]}function c(t){var e=s(t),i=e[0],n=e[1],r=e[2],a=Math.atan2(r,n)*b;return[a<0?a+360:a,Math.sqrt(n*n+r*r),i,t[3]]}function u(t){var e=t[0]*y,i=t[1],n=t[2];return l([n,Math.cos(e)*i,Math.sin(e)*i,t[3]])}var h=.95047,d=1,f=1.08883,p=4/29,m=6/29,g=3*m*m,v=m*m*m,y=Math.PI/180,b=180/Math.PI;e.exports={lab:{forward:s,reverse:l},hcl:{forward:c,reverse:u}}},{}],164:[function(t,e,i){"use strict";function n(t){return t}function r(t,e){var i;if(d(t)){var c,u=t.stops&&"object"==typeof t.stops[0][0],h=u||void 0!==t.property,p=u||!h,m=t.stops&&typeof(u?t.stops[0][0].property:t.stops[0][0]),g=t.type||e||("string"===m?"categorical":"exponential");if("exponential"===g)c=s;else if("interval"===g)c=o;else if("categorical"===g)c=a;else{if("identity"!==g)throw new Error('Unknown function type "'+g+'"');c=l}var v;if(t.colorSpace&&"rgb"!==t.colorSpace){if(!f[t.colorSpace])throw new Error("Unknown color space: "+t.colorSpace);var y=f[t.colorSpace];t=JSON.parse(JSON.stringify(t));for(var b=0;b<t.stops.length;b++)t.stops[b]=[t.stops[b][0],y.forward(t.stops[b][1])];v=y.reverse}else v=n;if(u){var _={},x=[];for(b=0;b<t.stops.length;b++){var w=t.stops[b];void 0===_[w[0].zoom]&&(_[w[0].zoom]={zoom:w[0].zoom,type:t.type,property:t.property,stops:[]}),_[w[0].zoom].stops.push([w[0].value,w[1]])}for(var M in _)x.push([_[M].zoom,r(_[M])]);i=function(e,i){return v(s({stops:x,base:t.base},e)(e,i))},i.isFeatureConstant=!1,i.isZoomConstant=!1}else p?(i=function(e){return v(c(t,e))},i.isFeatureConstant=!0,i.isZoomConstant=!1):(i=function(e,i){return v(c(t,i[t.property]))},i.isFeatureConstant=!1,i.isZoomConstant=!0)}else i=function(){return t},i.isFeatureConstant=!0,i.isZoomConstant=!0;return i}function a(t,e){for(var i=0;i<t.stops.length;i++)if(e===t.stops[i][0])return t.stops[i][1];return t.stops[0][1]}function o(t,e){for(var i=0;i<t.stops.length&&!(e<t.stops[i][0]);i++);return t.stops[Math.max(i-1,0)][1]}function s(t,e){for(var i=void 0!==t.base?t.base:1,n=0;!(n>=t.stops.length)&&!(e<=t.stops[n][0]);)n++;return 0===n?t.stops[n][1]:n===t.stops.length?t.stops[n-1][1]:c(e,i,t.stops[n-1][0],t.stops[n][0],t.stops[n-1][1],t.stops[n][1])}function l(t,e){return e}function c(t,e,i,n,r,a){return"function"==typeof r?function(){var o=r.apply(void 0,arguments),s=a.apply(void 0,arguments);return c(t,e,i,n,o,s)}:r.length?h(t,e,i,n,r,a):u(t,e,i,n,r,a)}function u(t,e,i,n,r,a){var o,s=n-i,l=t-i;return o=1===e?l/s:(Math.pow(e,l)-1)/(Math.pow(e,s)-1),r*(1-o)+a*o}function h(t,e,i,n,r,a){for(var o=[],s=0;s<r.length;s++)o[s]=u(t,e,i,n,r[s],a[s]);return o}function d(t){return"object"==typeof t&&(t.stops||"identity"===t.type)}var f=t("./color_spaces");e.exports.isFunctionDefinition=d,e.exports.interpolated=function(t){return r(t,"exponential")},e.exports["piecewise-constant"]=function(t){return r(t,"interval")}},{"./color_spaces":163}],165:[function(t,e,i){"use strict";function n(t,e){var i={};for(var n in t)"ref"!==n&&(i[n]=t[n]);return a.forEach(function(t){t in e&&(i[t]=e[t])}),i}function r(t){t=t.slice();var e,i=Object.create(null);for(e=0;e<t.length;e++)i[t[e].id]=t[e];for(e=0;e<t.length;e++)"ref"in t[e]&&(t[e]=n(t[e],i[t[e].ref]));return t}var a=t("./util/ref_properties");e.exports=r},{"./util/ref_properties":171}],166:[function(t,e,i){"use strict";function n(t,e,i,n){t=t||{},e=e||{};var r;for(r in t)t.hasOwnProperty(r)&&(e.hasOwnProperty(r)||(i.push({command:u.removeSource,args:[r]}),n[r]=!0));for(r in e)e.hasOwnProperty(r)&&(t.hasOwnProperty(r)?c(t[r],e[r])||(i.push({command:u.removeSource,args:[r]}),i.push({command:u.addSource,args:[r,e[r]]}),n[r]=!0):i.push({command:u.addSource,args:[r,e[r]]}))}function r(t,e,i,n,r,a){t=t||{},e=e||{};var o;for(o in t)t.hasOwnProperty(o)&&(c(t[o],e[o])||i.push({command:a,args:[n,o,e[o],r]}));for(o in e)e.hasOwnProperty(o)&&!t.hasOwnProperty(o)&&(c(t[o],e[o])||i.push({command:a,args:[n,o,e[o],r]}))}function a(t){return t.id}function o(t,e){return t[e.id]=e,t}function s(t,e,i){t=t||[],e=e||[];var n,s,l,h,d,f,p,m=t.map(a),g=e.map(a),v=t.reduce(o,{}),y=e.reduce(o,{}),b=m.slice(),_=Object.create(null);for(n=0,s=0;n<m.length;n++)l=m[n],y.hasOwnProperty(l)?s++:(i.push({command:u.removeLayer,args:[l]}),b.splice(b.indexOf(l,s),1));for(n=0,s=0;n<g.length;n++)l=g[g.length-1-n],b[b.length-1-n]!==l&&(v.hasOwnProperty(l)?(i.push({command:u.removeLayer,args:[l]}),b.splice(b.lastIndexOf(l,b.length-s),1)):s++,f=b[b.length-n],i.push({command:u.addLayer,args:[y[l],f]}),b.splice(b.length-n,0,l),_[l]=!0);for(n=0;n<g.length;n++)if(l=g[n],h=v[l],d=y[l],!_[l]&&!c(h,d))if(c(h.source,d.source)&&c(h["source-layer"],d["source-layer"])&&c(h.type,d.type)){r(h.layout,d.layout,i,l,null,u.setLayoutProperty),r(h.paint,d.paint,i,l,null,u.setPaintProperty),c(h.filter,d.filter)||i.push({command:u.setFilter,args:[l,d.filter]}),c(h.minzoom,d.minzoom)&&c(h.maxzoom,d.maxzoom)||i.push({command:u.setLayerZoomRange,args:[l,d.minzoom,d.maxzoom]});for(p in h)h.hasOwnProperty(p)&&"layout"!==p&&"paint"!==p&&"filter"!==p&&"metadata"!==p&&"minzoom"!==p&&"maxzoom"!==p&&(0===p.indexOf("paint.")?r(h[p],d[p],i,l,p.slice(6),u.setPaintProperty):c(h[p],d[p])||i.push({command:u.setLayerProperty,args:[l,p,d[p]]}));for(p in d)d.hasOwnProperty(p)&&!h.hasOwnProperty(p)&&"layout"!==p&&"paint"!==p&&"filter"!==p&&"metadata"!==p&&"minzoom"!==p&&"maxzoom"!==p&&(0===p.indexOf("paint.")?r(h[p],d[p],i,l,p.slice(6),u.setPaintProperty):c(h[p],d[p])||i.push({command:u.setLayerProperty,args:[l,p,d[p]]}))}else i.push({command:u.removeLayer,args:[l]}),f=b[b.lastIndexOf(l)+1],i.push({command:u.addLayer,args:[d,f]})}function l(t,e){if(!t)return[{command:u.setStyle,args:[e]}];var i=[];try{if(!c(t.version,e.version))return[{command:u.setStyle,args:[e]}];c(t.center,e.center)||i.push({command:u.setCenter,args:[e.center]}),c(t.zoom,e.zoom)||i.push({command:u.setZoom,args:[e.zoom]}),c(t.bearing,e.bearing)||i.push({command:u.setBearing,args:[e.bearing]}),c(t.pitch,e.pitch)||i.push({command:u.setPitch,args:[e.pitch]}),c(t.sprite,e.sprite)||i.push({command:u.setSprite,args:[e.sprite]}),c(t.glyphs,e.glyphs)||i.push({command:u.setGlyphs,args:[e.glyphs]}),c(t.transition,e.transition)||i.push({command:u.setTransition,args:[e.transition]}),c(t.light,e.light)||i.push({command:u.setLight,args:[e.light]});var r={},a=[];n(t.sources,e.sources,a,r);var o=[];t.layers&&t.layers.forEach(function(t){r[t.source]?i.push({command:u.removeLayer,args:[t.id]}):o.push(t)}),i=i.concat(a),s(o,e.layers,i)}catch(t){console.warn("Unable to compute style diff:",t),i=[{command:u.setStyle,args:[e]}]}return i}var c=t("lodash.isequal"),u={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};e.exports=l,e.exports.operations=u},{"lodash.isequal":160}],167:[function(t,e,i){"use strict";function n(t,e){this.message=(t?t+": ":"")+r.apply(r,Array.prototype.slice.call(arguments,2)),null!==e&&void 0!==e&&e.__line__&&(this.line=e.__line__)}var r=t("util").format;e.exports=n},{util:205}],168:[function(t,e,i){"use strict";function n(t){return o(a.map(function(e){return t[e]}))}function r(t){var e,i,r={};for(e=0;e<t.length;e++){i=n(t[e]);var a=r[i];a||(a=r[i]=[]),a.push(t[e])}var o=[];for(i in r)o.push(r[i]);return o}var a=t("./util/ref_properties"),o=t("fast-stable-stringify");e.exports=r},{"./util/ref_properties":171,"fast-stable-stringify":137}],169:[function(t,e,i){"use strict";e.exports=function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)t[n]=i[n]}return t}},{}],170:[function(t,e,i){"use strict";e.exports=function(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}},{}],171:[function(t,e,i){"use strict";e.exports=["type","source","source-layer","minzoom","maxzoom","filter","layout"]},{}],172:[function(t,e,i){"use strict";e.exports=function(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}},{}],173:[function(t,e,i){"use strict";var n=t("../error/validation_error"),r=t("../util/get_type"),a=t("../util/extend");e.exports=function(e){var i=t("./validate_function"),o=t("./validate_object"),s={"*":function(){return[]},array:t("./validate_array"),boolean:t("./validate_boolean"),number:t("./validate_number"),color:t("./validate_color"),constants:t("./validate_constants"),enum:t("./validate_enum"),filter:t("./validate_filter"),function:t("./validate_function"),layer:t("./validate_layer"),object:t("./validate_object"),source:t("./validate_source"),light:t("./validate_light"),string:t("./validate_string")},l=e.value,c=e.valueSpec,u=e.key,h=e.styleSpec,d=e.style;if("string"===r(l)&&"@"===l[0]){if(h.$version>7)return[new n(u,l,"constants have been deprecated as of v8")];if(!(l in d.constants))return[new n(u,l,'constant "%s" not found',l)];e=a({},e,{value:d.constants[l]})}return c.function&&"object"===r(l)?i(e):c.type&&s[c.type]?s[c.type](e):o(a({},e,{valueSpec:c.type?h[c.type]:c}))}},{"../error/validation_error":167,"../util/extend":169,"../util/get_type":170,"./validate_array":174,"./validate_boolean":175,"./validate_color":176,"./validate_constants":177,"./validate_enum":178,"./validate_filter":179,"./validate_function":180,"./validate_layer":182,"./validate_light":184,"./validate_number":185,"./validate_object":186,"./validate_source":188,"./validate_string":189}],174:[function(t,e,i){"use strict";var n=t("../util/get_type"),r=t("./validate"),a=t("../error/validation_error");e.exports=function(t){var e=t.value,i=t.valueSpec,o=t.style,s=t.styleSpec,l=t.key,c=t.arrayElementValidator||r;if("array"!==n(e))return[new a(l,e,"array expected, %s found",n(e))];if(i.length&&e.length!==i.length)return[new a(l,e,"array length %d expected, length %d found",i.length,e.length)];if(i["min-length"]&&e.length<i["min-length"])return[new a(l,e,"array length at least %d expected, length %d found",i["min-length"],e.length)];var u={type:i.value};s.$version<7&&(u.function=i.function),"object"===n(i.value)&&(u=i.value);for(var h=[],d=0;d<e.length;d++)h=h.concat(c({array:e,arrayIndex:d,value:e[d],valueSpec:u,style:o,styleSpec:s,key:l+"["+d+"]"}));return h}},{"../error/validation_error":167,"../util/get_type":170,"./validate":173}],175:[function(t,e,i){"use strict";var n=t("../util/get_type"),r=t("../error/validation_error");e.exports=function(t){var e=t.value,i=t.key,a=n(e);return"boolean"!==a?[new r(i,e,"boolean expected, %s found",a)]:[]}},{"../error/validation_error":167,"../util/get_type":170}],176:[function(t,e,i){"use strict";var n=t("../error/validation_error"),r=t("../util/get_type"),a=t("csscolorparser").parseCSSColor;e.exports=function(t){var e=t.key,i=t.value,o=r(i);return"string"!==o?[new n(e,i,"color expected, %s found",o)]:null===a(i)?[new n(e,i,'color expected, "%s" found',i)]:[]}},{"../error/validation_error":167,"../util/get_type":170,csscolorparser:135}],177:[function(t,e,i){"use strict";var n=t("../error/validation_error"),r=t("../util/get_type");e.exports=function(t){var e=t.key,i=t.value,a=t.styleSpec;if(a.$version>7)return i?[new n(e,i,"constants have been deprecated as of v8")]:[];var o=r(i);if("object"!==o)return[new n(e,i,"object expected, %s found",o)];var s=[];for(var l in i)"@"!==l[0]&&s.push(new n(e+"."+l,i[l],'constants must start with "@"'));return s}},{"../error/validation_error":167,"../util/get_type":170}],178:[function(t,e,i){"use strict";var n=t("../error/validation_error"),r=t("../util/unbundle_jsonlint");e.exports=function(t){var e=t.key,i=t.value,a=t.valueSpec,o=[];return Array.isArray(a.values)?a.values.indexOf(r(i))===-1&&o.push(new n(e,i,"expected one of [%s], %s found",a.values.join(", "),i)):Object.keys(a.values).indexOf(r(i))===-1&&o.push(new n(e,i,"expected one of [%s], %s found",Object.keys(a.values).join(", "),i)),o}},{"../error/validation_error":167,"../util/unbundle_jsonlint":172}],179:[function(t,e,i){"use strict";var n=t("../error/validation_error"),r=t("./validate_enum"),a=t("../util/get_type"),o=t("../util/unbundle_jsonlint");e.exports=function t(e){var i,s=e.value,l=e.key,c=e.styleSpec,u=[];if("array"!==a(s))return[new n(l,s,"array expected, %s found",a(s))];if(s.length<1)return[new n(l,s,"filter array must have at least 1 element")];switch(u=u.concat(r({key:l+"[0]",value:s[0],valueSpec:c.filter_operator,style:e.style,styleSpec:e.styleSpec})),o(s[0])){case"<":case"<=":case">":case">=":s.length>=2&&"$type"==s[1]&&u.push(new n(l,s,'"$type" cannot be use with operator "%s"',s[0]));case"==":case"!=":3!=s.length&&u.push(new n(l,s,'filter array for operator "%s" must have 3 elements',s[0]));case"in":case"!in":s.length>=2&&(i=a(s[1]),"string"!==i?u.push(new n(l+"[1]",s[1],"string expected, %s found",i)):"@"===s[1][0]&&u.push(new n(l+"[1]",s[1],"filter key cannot be a constant")));for(var h=2;h<s.length;h++)i=a(s[h]),"$type"==s[1]?u=u.concat(r({key:l+"["+h+"]",value:s[h],valueSpec:c.geometry_type,style:e.style,styleSpec:e.styleSpec})):"string"===i&&"@"===s[h][0]?u.push(new n(l+"["+h+"]",s[h],"filter value cannot be a constant")):"string"!==i&&"number"!==i&&"boolean"!==i&&u.push(new n(l+"["+h+"]",s[h],"string, number, or boolean expected, %s found",i));break;case"any":case"all":case"none":for(h=1;h<s.length;h++)u=u.concat(t({key:l+"["+h+"]",value:s[h],style:e.style,styleSpec:e.styleSpec}));break;case"has":case"!has":i=a(s[1]),2!==s.length?u.push(new n(l,s,'filter array for "%s" operator must have 2 elements',s[0])):"string"!==i?u.push(new n(l+"[1]",s[1],"string expected, %s found",i)):"@"===s[1][0]&&u.push(new n(l+"[1]",s[1],"filter key cannot be a constant"))}return u}},{"../error/validation_error":167,"../util/get_type":170,"../util/unbundle_jsonlint":172,"./validate_enum":178}],180:[function(t,e,i){"use strict";var n=t("../error/validation_error"),r=t("../util/get_type"),a=t("./validate"),o=t("./validate_object"),s=t("./validate_array"),l=t("./validate_number"),c=t("../util/unbundle_jsonlint");e.exports=function(t){function e(t){if("identity"===m)return[new n(t.key,t.value,'identity function may not have a "stops" property')];var e=[],a=t.value;return e=e.concat(s({key:t.key,value:a,valueSpec:t.valueSpec,style:t.style,styleSpec:t.styleSpec,arrayElementValidator:i})),"array"===r(a)&&0===a.length&&e.push(new n(t.key,a,"array must have at least one stop")),e}function i(t){var e=[],i=t.value,s=t.key;if("array"!==r(i))return[new n(s,i,"array expected, %s found",r(i))];if(2!==i.length)return[new n(s,i,"array length %d expected, length %d found",2,i.length)];if(b){if("object"!==r(i[0]))return[new n(s,i,"object expected, %s found",r(i[0]))];if(void 0===i[0].zoom)return[new n(s,i,"object stop key must have zoom")];if(void 0===i[0].value)return[new n(s,i,"object stop key must have value")];if(f&&f>c(i[0].zoom))return[new n(s,i[0].zoom,"stop zoom values must appear in ascending order")];c(i[0].zoom)!==f&&(f=c(i[0].zoom),d=void 0),e=e.concat(o({key:s+"[0]",value:i[0],valueSpec:{zoom:{}},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{zoom:l,value:u}}))}else e=e.concat(u({key:s+"[0]",value:i[0],valueSpec:{},style:t.style,styleSpec:t.styleSpec}));return e=e.concat(a({key:s+"[1]",value:i[1],valueSpec:p,style:t.style,styleSpec:t.styleSpec})),"number"===r(i[0])&&"piecewise-constant"===p.function&&i[0]%1!==0&&e.push(new n(s+"[0]",i[0],"zoom level for piecewise-constant functions must be an integer")),e}function u(t){var e=r(t.value),i=c(t.value);if(h){if(e!==h)return[new n(t.key,t.value,"%s stop domain type must match previous stop domain type %s",e,h)]}else h=e,m||"string"!==e||(m="categorical");return"number"!==e&&"string"!==e?[new n(t.key,t.value,"property value must be a number or string")]:"number"!==e&&"categorical"!==m?[new n(t.key,t.value,"number expected, %s found",e)]:"categorical"!==m||"number"!==e||isFinite(i)&&Math.floor(i)===i?"number"===e&&void 0!==d&&i<d?[new n(t.key,t.value,"stop domain values must appear in ascending order")]:(d=i,"categorical"===m&&i in g?[new n(t.key,t.value,"stop domain values must be unique")]:(g[i]=!0,[])):[new n(t.key,t.value,"integer expected, found %s",i)]}var h,d,f,p=t.valueSpec,m=c(t.value.type),g={},v="categorical"!==m&&void 0===t.value.property,y=!v,b="array"===r(t.value.stops)&&"array"===r(t.value.stops[0])&&"object"===r(t.value.stops[0][0]),_=o({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:e}});return"identity"===m||t.value.stops||_.push(new n(t.key,t.value,'missing required property "stops"')),"exponential"===m&&"piecewise-constant"===t.valueSpec.function&&_.push(new n(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(y&&!t.valueSpec["property-function"]?_.push(new n(t.key,t.value,"property functions not supported")):v&&!t.valueSpec["zoom-function"]&&_.push(new n(t.key,t.value,"zoom functions not supported"))),"categorical"!==m&&!b||void 0!==t.value.property||_.push(new n(t.key,t.value,'"property" property is required')),_}},{"../error/validation_error":167,"../util/get_type":170,"../util/unbundle_jsonlint":172,"./validate":173,"./validate_array":174,"./validate_number":185,"./validate_object":186}],181:[function(t,e,i){"use strict";var n=t("../error/validation_error"),r=t("./validate_string");e.exports=function(t){var e=t.value,i=t.key,a=r(t);return a.length?a:(e.indexOf("{fontstack}")===-1&&a.push(new n(i,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&a.push(new n(i,e,'"glyphs" url must include a "{range}" token')),a)}},{"../error/validation_error":167,"./validate_string":189}],182:[function(t,e,i){"use strict";var n=t("../error/validation_error"),r=t("../util/unbundle_jsonlint"),a=t("./validate_object"),o=t("./validate_filter"),s=t("./validate_paint_property"),l=t("./validate_layout_property"),c=t("../util/extend");e.exports=function(t){var e=[],i=t.value,u=t.key,h=t.style,d=t.styleSpec;i.type||i.ref||e.push(new n(u,i,'either "type" or "ref" is required'));var f=r(i.type),p=r(i.ref);if(i.id)for(var m=0;m<t.arrayIndex;m++){var g=h.layers[m];r(g.id)===r(i.id)&&e.push(new n(u,i.id,'duplicate layer id "%s", previously used at line %d',i.id,g.id.__line__))}if("ref"in i){["type","source","source-layer","filter","layout"].forEach(function(t){t in i&&e.push(new n(u,i[t],'"%s" is prohibited for ref layers',t))});var v;h.layers.forEach(function(t){t.id==p&&(v=t)}),v?v.ref?e.push(new n(u,i.ref,"ref cannot reference another ref layer")):f=r(v.type):e.push(new n(u,i.ref,'ref layer "%s" not found',p))}else if("background"!==f)if(i.source){var y=h.sources&&h.sources[i.source];y?"vector"==y.type&&"raster"==f?e.push(new n(u,i.source,'layer "%s" requires a raster source',i.id)):"raster"==y.type&&"raster"!=f?e.push(new n(u,i.source,'layer "%s" requires a vector source',i.id)):"vector"!=y.type||i["source-layer"]||e.push(new n(u,i,'layer "%s" must specify a "source-layer"',i.id)):e.push(new n(u,i.source,'source "%s" not found',i.source))}else e.push(new n(u,i,'missing required property "source"'));return e=e.concat(a({key:u,value:i,valueSpec:d.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(){return[]},filter:o,layout:function(t){return a({layer:i,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(t){return l(c({layerType:f},t))}}})},paint:function(t){return a({layer:i,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(t){return s(c({layerType:f},t))}}})}}}))}},{"../error/validation_error":167,"../util/extend":169,"../util/unbundle_jsonlint":172,"./validate_filter":179,"./validate_layout_property":183,"./validate_object":186,"./validate_paint_property":187}],183:[function(t,e,i){"use strict";var n=t("./validate"),r=t("../error/validation_error");e.exports=function(t){var e=t.key,i=t.style,a=t.styleSpec,o=t.value,s=t.objectKey,l=a["layout_"+t.layerType];if(!l)return[];if(t.valueSpec||l[s]){var c=[];return"symbol"===t.layerType&&("icon-image"===s&&i&&!i.sprite?c.push(new r(e,o,'use of "icon-image" requires a style "sprite" property')):"text-field"===s&&i&&!i.glyphs&&c.push(new r(e,o,'use of "text-field" requires a style "glyphs" property'))),c.concat(n({key:t.key,value:o,valueSpec:t.valueSpec||l[s],style:i,styleSpec:a}))}return[new r(e,o,'unknown property "%s"',s)]}},{"../error/validation_error":167,"./validate":173}],184:[function(t,e,i){"use strict";var n=t("../error/validation_error"),r=t("../util/get_type"),a=t("./validate");e.exports=function(t){var e=t.value,i=t.styleSpec,o=i.light,s=t.style,l=[],c=r(e);if(void 0===e)return l;if("object"!==c)return l=l.concat([new n("light",e,"object expected, %s found",c)]);for(var u in e){var h=u.match(/^(.*)-transition$/);l=h&&o[h[1]]&&o[h[1]].transition?l.concat(a({key:u,value:e[u],valueSpec:i.transition,style:s,styleSpec:i})):o[u]?l.concat(a({key:u,value:e[u],valueSpec:o[u],style:s,styleSpec:i})):l.concat([new n(u,e[u],'unknown property "%s"',u)])}return l}},{"../error/validation_error":167,"../util/get_type":170,"./validate":173}],185:[function(t,e,i){"use strict";var n=t("../util/get_type"),r=t("../error/validation_error");e.exports=function(t){var e=t.key,i=t.value,a=t.valueSpec,o=n(i);return"number"!==o?[new r(e,i,"number expected, %s found",o)]:"minimum"in a&&i<a.minimum?[new r(e,i,"%s is less than the minimum value %s",i,a.minimum)]:"maximum"in a&&i>a.maximum?[new r(e,i,"%s is greater than the maximum value %s",i,a.maximum)]:[]}},{"../error/validation_error":167,"../util/get_type":170}],186:[function(t,e,i){"use strict";var n=t("../error/validation_error"),r=t("../util/get_type"),a=t("./validate");e.exports=function(t){var e=t.key,i=t.value,o=t.valueSpec||{},s=t.objectElementValidators||{},l=t.style,c=t.styleSpec,u=[],h=r(i);if("object"!==h)return[new n(e,i,"object expected, %s found",h)];for(var d in i){var f,p=d.split(".")[0],m=o[p]||o["*"];if(s[p])f=s[p];else if(o[p])f=a;else if(s["*"])f=s["*"];else{if(!o["*"]){u.push(new n(e,i[d],'unknown property "%s"',d));continue}f=a}u=u.concat(f({key:(e?e+".":e)+d,value:i[d],valueSpec:m,style:l,styleSpec:c,object:i,objectKey:d}))}for(p in o)o[p].required&&void 0===o[p].default&&void 0===i[p]&&u.push(new n(e,i,'missing required property "%s"',p));return u}},{"../error/validation_error":167,"../util/get_type":170,"./validate":173}],187:[function(t,e,i){"use strict";var n=t("./validate"),r=t("../error/validation_error");e.exports=function(t){var e=t.key,i=t.style,a=t.styleSpec,o=t.value,s=t.objectKey,l=a["paint_"+t.layerType];if(!l)return[];var c=s.match(/^(.*)-transition$/);return c&&l[c[1]]&&l[c[1]].transition?n({key:e,value:o,valueSpec:a.transition,style:i,styleSpec:a}):t.valueSpec||l[s]?n({key:t.key,value:o,valueSpec:t.valueSpec||l[s],style:i,styleSpec:a}):[new r(e,o,'unknown property "%s"',s)]}},{"../error/validation_error":167,"./validate":173}],188:[function(t,e,i){"use strict";var n=t("../error/validation_error"),r=t("../util/unbundle_jsonlint"),a=t("./validate_object"),o=t("./validate_enum");e.exports=function(t){var e=t.value,i=t.key,s=t.styleSpec,l=t.style;if(!e.type)return[new n(i,e,'"type" is required')];var c=r(e.type);switch(c){case"vector":case"raster":var u=[];if(u=u.concat(a({key:i,value:e,valueSpec:s.source_tile,style:t.style,styleSpec:s})),"url"in e)for(var h in e)["type","url","tileSize"].indexOf(h)<0&&u.push(new n(i+"."+h,e[h],'a source with a "url" property may not include a "%s" property',h));return u;case"geojson":return a({key:i,value:e,valueSpec:s.source_geojson,style:l,styleSpec:s});case"video":return a({key:i,value:e,valueSpec:s.source_video,style:l,styleSpec:s});case"image":return a({key:i,value:e,valueSpec:s.source_image,style:l,styleSpec:s});case"canvas":return a({key:i,value:e,valueSpec:s.source_canvas,style:l,styleSpec:s});default:return o({key:i+".type",value:e.type,valueSpec:{values:["vector","raster","geojson","video","image","canvas"]},style:l,styleSpec:s})}}},{"../error/validation_error":167,"../util/unbundle_jsonlint":172,"./validate_enum":178,"./validate_object":186}],189:[function(t,e,i){"use strict";var n=t("../util/get_type"),r=t("../error/validation_error");e.exports=function(t){var e=t.value,i=t.key,a=n(e);return"string"!==a?[new r(i,e,"string expected, %s found",a)]:[]}},{"../error/validation_error":167,"../util/get_type":170}],190:[function(t,e,i){"use strict";function n(t,e){e=e||l;var i=[];return i=i.concat(s({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:c,"*":function(){return[]}}})),e.$version>7&&t.constants&&(i=i.concat(o({key:"constants",value:t.constants,style:t,styleSpec:e}))),r(i)}function r(t){return[].concat(t).sort(function(t,e){return t.line-e.line})}function a(t){return function(){return r(t.apply(this,arguments))}}var o=t("./validate/validate_constants"),s=t("./validate/validate"),l=t("../reference/latest.min"),c=t("./validate/validate_glyphs_url");n.source=a(t("./validate/validate_source")),n.light=a(t("./validate/validate_light")),n.layer=a(t("./validate/validate_layer")),n.filter=a(t("./validate/validate_filter")),n.paintProperty=a(t("./validate/validate_paint_property")),n.layoutProperty=a(t("./validate/validate_layout_property")),e.exports=n},{"../reference/latest.min":191,"./validate/validate":173,"./validate/validate_constants":177,"./validate/validate_filter":179,"./validate/validate_glyphs_url":181,"./validate/validate_layer":182,"./validate/validate_layout_property":183,"./validate/validate_light":184,"./validate/validate_paint_property":187,"./validate/validate_source":188}],191:[function(t,e,i){e.exports=t("./v8.min.json")},{"./v8.min.json":192}],192:[function(t,e,i){e.exports={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_tile","source_geojson","source_video","source_image","source_canvas"],source_tile:{type:{required:!0,type:"enum",values:{vector:{},raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},buffer:{type:"number",default:128,maximum:512,minimum:0},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_canvas:{type:{required:!0,type:"enum",values:{canvas:{}
}},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}},animate:{type:"boolean",default:"true"},canvas:{type:"string",required:!0}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},"fill-extrusion":{},raster:{},background:{}}},metadata:{type:"*"},ref:{type:"string"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"},"paint.*":{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_fill-extrusion","layout_symbol","layout_raster","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible"}},layout_fill:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible"}},layout_circle:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible"}},layout_line:{"line-cap":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{butt:{},round:{},square:{}},default:"butt"},"line-join":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{bevel:{},round:{},miter:{}},default:"miter"},"line-miter-limit":{type:"number",default:2,function:"interpolated","zoom-function":!0,requires:[{"line-join":"miter"}]},"line-round-limit":{type:"number",default:1.05,function:"interpolated","zoom-function":!0,requires:[{"line-join":"round"}]},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible"}},layout_symbol:{"symbol-placement":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{point:{},line:{}},default:"point"},"symbol-spacing":{type:"number",default:250,minimum:1,function:"interpolated","zoom-function":!0,units:"pixels",requires:[{"symbol-placement":"line"}]},"symbol-avoid-edges":{type:"boolean",function:"piecewise-constant","zoom-function":!0,default:!1},"icon-allow-overlap":{type:"boolean",function:"piecewise-constant","zoom-function":!0,default:!1,requires:["icon-image"]},"icon-ignore-placement":{type:"boolean",function:"piecewise-constant","zoom-function":!0,default:!1,requires:["icon-image"]},"icon-optional":{type:"boolean",function:"piecewise-constant","zoom-function":!0,default:!1,requires:["icon-image","text-field"]},"icon-rotation-alignment":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"]},"icon-size":{type:"number",default:1,minimum:0,function:"interpolated","zoom-function":!0,requires:["icon-image"]},"icon-text-fit":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"]},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",function:"interpolated","zoom-function":!0,requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}]},"icon-image":{type:"string",function:"piecewise-constant","zoom-function":!0,tokens:!0},"icon-rotate":{type:"number",default:0,period:360,function:"interpolated","zoom-function":!0,"property-function":!0,units:"degrees",requires:["icon-image"]},"icon-padding":{type:"number",default:2,minimum:0,function:"interpolated","zoom-function":!0,units:"pixels",requires:["icon-image"]},"icon-keep-upright":{type:"boolean",function:"piecewise-constant","zoom-function":!0,default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":"line"}]},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],function:"interpolated","zoom-function":!0,"property-function":!0,requires:["icon-image"]},"text-pitch-alignment":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"]},"text-rotation-alignment":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"]},"text-field":{type:"string",function:"piecewise-constant","zoom-function":!0,default:"",tokens:!0},"text-font":{type:"array",value:"string",function:"piecewise-constant","zoom-function":!0,default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"]},"text-size":{type:"number",default:16,minimum:0,units:"pixels",function:"interpolated","zoom-function":!0,requires:["text-field"]},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",function:"interpolated","zoom-function":!0,requires:["text-field"]},"text-line-height":{type:"number",default:1.2,units:"ems",function:"interpolated","zoom-function":!0,requires:["text-field"]},"text-letter-spacing":{type:"number",default:0,units:"ems",function:"interpolated","zoom-function":!0,requires:["text-field"]},"text-justify":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{left:{},center:{},right:{}},default:"center",requires:["text-field"]},"text-anchor":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field"]},"text-max-angle":{type:"number",default:45,units:"degrees",function:"interpolated","zoom-function":!0,requires:["text-field",{"symbol-placement":"line"}]},"text-rotate":{type:"number",default:0,period:360,units:"degrees",function:"interpolated","zoom-function":!0,requires:["text-field"]},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",function:"interpolated","zoom-function":!0,requires:["text-field"]},"text-keep-upright":{type:"boolean",function:"piecewise-constant","zoom-function":!0,default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":"line"}]},"text-transform":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"]},"text-offset":{type:"array",value:"number",units:"ems",function:"interpolated","zoom-function":!0,length:2,default:[0,0],requires:["text-field"]},"text-allow-overlap":{type:"boolean",function:"piecewise-constant","zoom-function":!0,default:!1,requires:["text-field"]},"text-ignore-placement":{type:"boolean",function:"piecewise-constant","zoom-function":!0,default:!1,requires:["text-field"]},"text-optional":{type:"boolean",function:"piecewise-constant","zoom-function":!0,default:!1,requires:["text-field","icon-image"]},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"}},function_stop:{type:"array",minimum:0,maximum:22,value:["number","color"],length:2},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},transition:!1},position:{type:"array",default:[1.15,210,30],length:3,value:"number",transition:!0,function:"interpolated","zoom-function":!0,"property-function":!1},color:{type:"color",default:"#ffffff",function:"interpolated","zoom-function":!0,"property-function":!1,transition:!0},intensity:{type:"number",default:.5,minimum:0,maximum:1,function:"interpolated","zoom-function":!0,"property-function":!1,transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_fill-extrusion","paint_symbol","paint_raster","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",function:"piecewise-constant","zoom-function":!0,default:!0},"fill-opacity":{type:"number",function:"interpolated","zoom-function":!0,"property-function":!0,default:1,minimum:0,maximum:1,transition:!0},"fill-color":{type:"color",default:"#000000",function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,requires:[{"!":"fill-pattern"}]},"fill-outline-color":{type:"color",function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}]},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],function:"interpolated","zoom-function":!0,transition:!0,units:"pixels"},"fill-translate-anchor":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{},viewport:{}},default:"map",requires:["fill-translate"]},"fill-pattern":{type:"string",function:"piecewise-constant","zoom-function":!0,transition:!0}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",function:"interpolated","zoom-function":!0,"property-function":!1,default:1,minimum:0,maximum:1,transition:!0},"fill-extrusion-color":{type:"color",default:"#000000",function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,requires:[{"!":"fill-extrusion-pattern"}]},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],function:"interpolated","zoom-function":!0,transition:!0,units:"pixels"},"fill-extrusion-translate-anchor":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"]},"fill-extrusion-pattern":{type:"string",function:"piecewise-constant","zoom-function":!0,transition:!0},"fill-extrusion-height":{type:"number",function:"interpolated","zoom-function":!0,"property-function":!0,default:0,minimum:0,units:"meters",transition:!0},"fill-extrusion-base":{type:"number",function:"interpolated","zoom-function":!0,"property-function":!0,default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"]}},paint_line:{"line-opacity":{type:"number",function:"interpolated","zoom-function":!0,"property-function":!0,default:1,minimum:0,maximum:1,transition:!0},"line-color":{type:"color",default:"#000000",function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,requires:[{"!":"line-pattern"}]},"line-translate":{type:"array",value:"number",length:2,default:[0,0],function:"interpolated","zoom-function":!0,transition:!0,units:"pixels"},"line-translate-anchor":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{},viewport:{}},default:"map",requires:["line-translate"]},"line-width":{type:"number",default:1,minimum:0,function:"interpolated","zoom-function":!0,transition:!0,units:"pixels"},"line-gap-width":{type:"number",default:0,minimum:0,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels"},"line-offset":{type:"number",default:0,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels"},"line-blur":{type:"number",default:0,minimum:0,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels"},"line-dasharray":{type:"array",value:"number",function:"piecewise-constant","zoom-function":!0,minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}]},"line-pattern":{type:"string",function:"piecewise-constant","zoom-function":!0,transition:!0}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels"},"circle-color":{type:"color",default:"#000000",function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0},"circle-blur":{type:"number",default:0,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],function:"interpolated","zoom-function":!0,transition:!0,units:"pixels"},"circle-translate-anchor":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{},viewport:{}},default:"map",requires:["circle-translate"]},"circle-pitch-scale":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{},viewport:{}},default:"map"},"circle-stroke-width":{type:"number",default:0,minimum:0,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0,units:"pixels"},"circle-stroke-color":{type:"color",default:"#000000",function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,function:"interpolated","zoom-function":!0,"property-function":!0,transition:!0}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,function:"interpolated","zoom-function":!0,transition:!0,requires:["icon-image"]},"icon-color":{type:"color",default:"#000000",function:"interpolated","zoom-function":!0,transition:!0,requires:["icon-image"]},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",function:"interpolated","zoom-function":!0,transition:!0,requires:["icon-image"]},"icon-halo-width":{type:"number",default:0,minimum:0,function:"interpolated","zoom-function":!0,transition:!0,units:"pixels",requires:["icon-image"]},"icon-halo-blur":{type:"number",default:0,minimum:0,function:"interpolated","zoom-function":!0,transition:!0,units:"pixels",requires:["icon-image"]},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],function:"interpolated","zoom-function":!0,transition:!0,units:"pixels",requires:["icon-image"]},"icon-translate-anchor":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"]},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,function:"interpolated","zoom-function":!0,transition:!0,requires:["text-field"]},"text-color":{type:"color",default:"#000000",function:"interpolated","zoom-function":!0,transition:!0,requires:["text-field"]},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",function:"interpolated","zoom-function":!0,transition:!0,requires:["text-field"]},"text-halo-width":{type:"number",default:0,minimum:0,function:"interpolated","zoom-function":!0,transition:!0,units:"pixels",requires:["text-field"]},"text-halo-blur":{type:"number",default:0,minimum:0,function:"interpolated","zoom-function":!0,transition:!0,units:"pixels",requires:["text-field"]},"text-translate":{type:"array",value:"number",length:2,default:[0,0],function:"interpolated","zoom-function":!0,transition:!0,units:"pixels",requires:["text-field"]},"text-translate-anchor":{type:"enum",function:"piecewise-constant","zoom-function":!0,values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"]}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,function:"interpolated","zoom-function":!0,transition:!0},"raster-hue-rotate":{type:"number",default:0,period:360,function:"interpolated","zoom-function":!0,transition:!0,units:"degrees"},"raster-brightness-min":{type:"number",function:"interpolated","zoom-function":!0,default:0,minimum:0,maximum:1,transition:!0},"raster-brightness-max":{type:"number",function:"interpolated","zoom-function":!0,default:1,minimum:0,maximum:1,transition:!0},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,function:"interpolated","zoom-function":!0,transition:!0},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,function:"interpolated","zoom-function":!0,transition:!0},"raster-fade-duration":{type:"number",default:300,minimum:0,function:"interpolated","zoom-function":!0,transition:!0,units:"milliseconds"}},paint_background:{"background-color":{type:"color",default:"#000000",function:"interpolated","zoom-function":!0,transition:!0,requires:[{"!":"background-pattern"}]},"background-pattern":{type:"string",function:"piecewise-constant","zoom-function":!0,transition:!0},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,function:"interpolated","zoom-function":!0,transition:!0}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}}}},{}],193:[function(t,e,i){"use strict";function n(t){return!!(r()&&a()&&o()&&s()&&l()&&c()&&u()&&h(t&&t.failIfMajorPerformanceCaveat))}function r(){return"undefined"!=typeof window&&"undefined"!=typeof document}function a(){return Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray}function o(){return Function.prototype&&Function.prototype.bind}function s(){return Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions}function l(){return"JSON"in window&&"parse"in JSON&&"stringify"in JSON}function c(){return"Worker"in window}function u(){return"Uint8ClampedArray"in window}function h(t){return void 0===f[t]&&(f[t]=d(t)),f[t]}function d(t){var e=document.createElement("canvas"),i=Object.create(n.webGLContextAttributes);return i.failIfMajorPerformanceCaveat=t,e.probablySupportsContext?e.probablySupportsContext("webgl",i)||e.probablySupportsContext("experimental-webgl",i):e.supportsContext?e.supportsContext("webgl",i)||e.supportsContext("experimental-webgl",i):e.getContext("webgl",i)||e.getContext("experimental-webgl",i)}"undefined"!=typeof e&&e.exports?e.exports=n:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=n);var f={};n.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}},{}],194:[function(t,e,i){(function(t){function e(t,e){for(var i=0,n=t.length-1;n>=0;n--){var r=t[n];"."===r?t.splice(n,1):".."===r?(t.splice(n,1),i++):i&&(t.splice(n,1),i--)}if(e)for(;i--;i)t.unshift("..");return t}function n(t,e){if(t.filter)return t.filter(e);for(var i=[],n=0;n<t.length;n++)e(t[n],n,t)&&i.push(t[n]);return i}var r=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,a=function(t){return r.exec(t).slice(1)};i.resolve=function(){for(var i="",r=!1,a=arguments.length-1;a>=-1&&!r;a--){var o=a>=0?arguments[a]:t.cwd();if("string"!=typeof o)throw new TypeError("Arguments to path.resolve must be strings");o&&(i=o+"/"+i,r="/"===o.charAt(0))}return i=e(n(i.split("/"),function(t){return!!t}),!r).join("/"),(r?"/":"")+i||"."},i.normalize=function(t){var r=i.isAbsolute(t),a="/"===o(t,-1);return t=e(n(t.split("/"),function(t){return!!t}),!r).join("/"),t||r||(t="."),t&&a&&(t+="/"),(r?"/":"")+t},i.isAbsolute=function(t){return"/"===t.charAt(0)},i.join=function(){var t=Array.prototype.slice.call(arguments,0);return i.normalize(n(t,function(t,e){if("string"!=typeof t)throw new TypeError("Arguments to path.join must be strings");return t}).join("/"))},i.relative=function(t,e){function n(t){for(var e=0;e<t.length&&""===t[e];e++);for(var i=t.length-1;i>=0&&""===t[i];i--);return e>i?[]:t.slice(e,i-e+1)}t=i.resolve(t).substr(1),e=i.resolve(e).substr(1);for(var r=n(t.split("/")),a=n(e.split("/")),o=Math.min(r.length,a.length),s=o,l=0;l<o;l++)if(r[l]!==a[l]){s=l;break}for(var c=[],l=s;l<r.length;l++)c.push("..");return c=c.concat(a.slice(s)),c.join("/")},i.sep="/",i.delimiter=":",i.dirname=function(t){var e=a(t),i=e[0],n=e[1];return i||n?(n&&(n=n.substr(0,n.length-1)),i+n):"."},i.basename=function(t,e){var i=a(t)[2];return e&&i.substr(-1*e.length)===e&&(i=i.substr(0,i.length-e.length)),i},i.extname=function(t){return a(t)[3]};var o="b"==="ab".substr(-1)?function(t,e,i){return t.substr(e,i)}:function(t,e,i){return e<0&&(e=t.length+e),t.substr(e,i)}}).call(this,t("_process"))},{_process:198}],195:[function(t,e,i){"use strict";function n(t){var e;t&&t.length&&(e=t,t=e.length);var i=new Uint8Array(t||0);return e&&i.set(e),i.readUInt32LE=a.readUInt32LE,i.writeUInt32LE=a.writeUInt32LE,i.readInt32LE=a.readInt32LE,i.writeInt32LE=a.writeInt32LE,i.readFloatLE=a.readFloatLE,i.writeFloatLE=a.writeFloatLE,i.readDoubleLE=a.readDoubleLE,i.writeDoubleLE=a.writeDoubleLE,i.toString=a.toString,i.write=a.write,i.slice=a.slice,i.copy=a.copy,i._isBuffer=!0,i}function r(t){for(var e,i,n=t.length,r=[],a=0;a<n;a++){if(e=t.charCodeAt(a),e>55295&&e<57344){if(!i){e>56319||a+1===n?r.push(239,191,189):i=e;continue}if(e<56320){r.push(239,191,189),i=e;continue}e=i-55296<<10|e-56320|65536,i=null}else i&&(r.push(239,191,189),i=null);e<128?r.push(e):e<2048?r.push(e>>6|192,63&e|128):e<65536?r.push(e>>12|224,e>>6&63|128,63&e|128):r.push(e>>18|240,e>>12&63|128,e>>6&63|128,63&e|128)}return r}e.exports=n;var a,o,s,l=t("ieee754");a={readUInt32LE:function(t){return(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},writeUInt32LE:function(t,e){this[e]=t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24},readInt32LE:function(t){return(this[t]|this[t+1]<<8|this[t+2]<<16)+(this[t+3]<<24)},readFloatLE:function(t){return l.read(this,t,!0,23,4)},readDoubleLE:function(t){return l.read(this,t,!0,52,8)},writeFloatLE:function(t,e){return l.write(this,t,e,!0,23,4)},writeDoubleLE:function(t,e){return l.write(this,t,e,!0,52,8)},toString:function(t,e,i){var n="",r="";e=e||0,i=Math.min(this.length,i||this.length);for(var a=e;a<i;a++){var o=this[a];o<=127?(n+=decodeURIComponent(r)+String.fromCharCode(o),r=""):r+="%"+o.toString(16)}return n+=decodeURIComponent(r)},write:function(t,e){for(var i=t===o?s:r(t),n=0;n<i.length;n++)this[e+n]=i[n]},slice:function(t,e){return this.subarray(t,e)},copy:function(t,e){e=e||0;for(var i=0;i<this.length;i++)t[e+i]=this[i]}},a.writeInt32LE=a.writeUInt32LE,n.byteLength=function(t){return o=t,s=r(t),s.length},n.isBuffer=function(t){return!(!t||!t._isBuffer)}},{ieee754:150}],196:[function(t,e,n){(function(i){"use strict";function n(t){this.buf=g.isBuffer(t)?t:new g(t||0),this.pos=0,this.length=this.buf.length}function r(t,e){var i,n=e.buf;if(i=n[e.pos++],t+=268435456*(127&i),i<128)return t;if(i=n[e.pos++],t+=34359738368*(127&i),i<128)return t;if(i=n[e.pos++],t+=4398046511104*(127&i),i<128)return t;if(i=n[e.pos++],t+=562949953421312*(127&i),i<128)return t;if(i=n[e.pos++],t+=72057594037927940*(127&i),i<128)return t;if(i=n[e.pos++],t+=0x8000000000000000*(127&i),i<128)return t;throw new Error("Expected varint not more than 10 bytes")}function a(t,e){e.realloc(10);for(var i=e.pos+10;t>=1;){if(e.pos>=i)throw new Error("Given varint doesn't fit into 10 bytes");var n=255&t;e.buf[e.pos++]=n|(t>=128?128:0),t/=128}}function o(t,e,i){var n=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.ceil(Math.log(e)/(7*Math.LN2));i.realloc(n);for(var r=i.pos-1;r>=t;r--)i.buf[r+n]=i.buf[r]}function s(t,e){for(var i=0;i<t.length;i++)e.writeVarint(t[i])}function l(t,e){for(var i=0;i<t.length;i++)e.writeSVarint(t[i])}function c(t,e){for(var i=0;i<t.length;i++)e.writeFloat(t[i])}function u(t,e){for(var i=0;i<t.length;i++)e.writeDouble(t[i])}function h(t,e){for(var i=0;i<t.length;i++)e.writeBoolean(t[i])}function d(t,e){for(var i=0;i<t.length;i++)e.writeFixed32(t[i])}function f(t,e){for(var i=0;i<t.length;i++)e.writeSFixed32(t[i])}function p(t,e){for(var i=0;i<t.length;i++)e.writeFixed64(t[i])}function m(t,e){for(var i=0;i<t.length;i++)e.writeSFixed64(t[i])}e.exports=n;var g=i.Buffer||t("./buffer");n.Varint=0,n.Fixed64=1,n.Bytes=2,n.Fixed32=5;var v=4294967296,y=1/v,b=Math.pow(2,63);n.prototype={destroy:function(){this.buf=null},readFields:function(t,e,i){for(i=i||this.length;this.pos<i;){var n=this.readVarint(),r=n>>3,a=this.pos;t(r,e,this),this.pos===a&&this.skip(n)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=this.buf.readUInt32LE(this.pos);return this.pos+=4,t},readSFixed32:function(){var t=this.buf.readInt32LE(this.pos);return this.pos+=4,t},readFixed64:function(){var t=this.buf.readUInt32LE(this.pos)+this.buf.readUInt32LE(this.pos+4)*v;return this.pos+=8,t},readSFixed64:function(){var t=this.buf.readUInt32LE(this.pos)+this.buf.readInt32LE(this.pos+4)*v;return this.pos+=8,t},readFloat:function(){var t=this.buf.readFloatLE(this.pos);return this.pos+=4,t},readDouble:function(){var t=this.buf.readDoubleLE(this.pos);return this.pos+=8,t},readVarint:function(){var t,e,i=this.buf;return e=i[this.pos++],t=127&e,e<128?t:(e=i[this.pos++],t|=(127&e)<<7,e<128?t:(e=i[this.pos++],t|=(127&e)<<14,e<128?t:(e=i[this.pos++],t|=(127&e)<<21,e<128?t:r(t,this))))},readVarint64:function(){var t=this.pos,e=this.readVarint();if(e<b)return e;for(var i=this.pos-2;255===this.buf[i];)i--;i<t&&(i=t),e=0;for(var n=0;n<i-t+1;n++){var r=127&~this.buf[t+n];e+=n<4?r<<7*n:r*Math.pow(2,7*n)}return-e-1},readSVarint:function(){var t=this.readVarint();return t%2===1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.buf.toString("utf8",this.pos,t);return this.pos=t,e},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.slice(this.pos,t);return this.pos=t,e},readPackedVarint:function(){for(var t=this.readVarint()+this.pos,e=[];this.pos<t;)e.push(this.readVarint());return e},readPackedSVarint:function(){for(var t=this.readVarint()+this.pos,e=[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(){for(var t=this.readVarint()+this.pos,e=[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(){for(var t=this.readVarint()+this.pos,e=[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(){for(var t=this.readVarint()+this.pos,e=[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(){for(var t=this.readVarint()+this.pos,e=[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(){for(var t=this.readVarint()+this.pos,e=[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(){for(var t=this.readVarint()+this.pos,e=[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(){for(var t=this.readVarint()+this.pos,e=[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(t){var e=7&t;if(e===n.Varint)for(;this.buf[this.pos++]>127;);else if(e===n.Bytes)this.pos=this.readVarint()+this.pos;else if(e===n.Fixed32)this.pos+=4;else{if(e!==n.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var i=new g(e);this.buf.copy(i),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.slice(0,this.length)},writeFixed32:function(t){this.realloc(4),this.buf.writeUInt32LE(t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),this.buf.writeInt32LE(t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),this.buf.writeInt32LE(t&-1,this.pos),this.buf.writeUInt32LE(Math.floor(t*y),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),this.buf.writeInt32LE(t&-1,this.pos),this.buf.writeInt32LE(Math.floor(t*y),this.pos+4),this.pos+=8},writeVarint:function(t){return t=+t,t>268435455?void a(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),void(t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127)))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t);var e=g.byteLength(t);this.writeVarint(e),this.realloc(e),this.buf.write(t,this.pos),this.pos+=e},writeFloat:function(t){this.realloc(4),this.buf.writeFloatLE(t,this.pos),this.pos+=4},writeDouble:function(t){this.realloc(8),this.buf.writeDoubleLE(t,this.pos),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=t[i]},writeRawMessage:function(t,e){this.pos++;var i=this.pos;t(e,this);var n=this.pos-i;n>=128&&o(i,n,this),this.pos=i-1,this.writeVarint(n),this.pos+=n},writeMessage:function(t,e,i){this.writeTag(t,n.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(t,e){this.writeMessage(t,s,e)},writePackedSVarint:function(t,e){this.writeMessage(t,l,e)},writePackedBoolean:function(t,e){this.writeMessage(t,h,e)},writePackedFloat:function(t,e){this.writeMessage(t,c,e)},writePackedDouble:function(t,e){this.writeMessage(t,u,e)},writePackedFixed32:function(t,e){this.writeMessage(t,d,e)},writePackedSFixed32:function(t,e){this.writeMessage(t,f,e)},writePackedFixed64:function(t,e){this.writeMessage(t,p,e)},writePackedSFixed64:function(t,e){this.writeMessage(t,m,e)},writeBytesField:function(t,e){this.writeTag(t,n.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,n.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,n.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,n.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,n.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,n.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,n.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,n.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,n.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,n.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}}}).call(this,"undefined"!=typeof i?i:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./buffer":195}],197:[function(t,e,i){"use strict";function n(t,e){this.x=t,this.y=e}e.exports=n,n.prototype={clone:function(){return new n(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,i=t.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[0]*this.x+t[1]*this.y,i=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=i,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),i=Math.sin(t),n=e*this.x-i*this.y,r=i*this.x+e*this.y;return this.x=n,this.y=r,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},n.convert=function(t){return t instanceof n?t:Array.isArray(t)?new n(t[0],t[1]):t}},{}],198:[function(t,e,i){function n(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined");
}function a(t){if(h===setTimeout)return setTimeout(t,0);if((h===n||!h)&&setTimeout)return h=setTimeout,setTimeout(t,0);try{return h(t,0)}catch(e){try{return h.call(null,t,0)}catch(e){return h.call(this,t,0)}}}function o(t){if(d===clearTimeout)return clearTimeout(t);if((d===r||!d)&&clearTimeout)return d=clearTimeout,clearTimeout(t);try{return d(t)}catch(e){try{return d.call(null,t)}catch(e){return d.call(this,t)}}}function s(){g&&p&&(g=!1,p.length?m=p.concat(m):v=-1,m.length&&l())}function l(){if(!g){var t=a(s);g=!0;for(var e=m.length;e;){for(p=m,m=[];++v<e;)p&&p[v].run();v=-1,e=m.length}p=null,g=!1,o(t)}}function c(t,e){this.fun=t,this.array=e}function u(){}var h,d,f=e.exports={};!function(){try{h="function"==typeof setTimeout?setTimeout:n}catch(t){h=n}try{d="function"==typeof clearTimeout?clearTimeout:r}catch(t){d=r}}();var p,m=[],g=!1,v=-1;f.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];m.push(new c(t,e)),1!==m.length||g||a(l)},c.prototype.run=function(){this.fun.apply(null,this.array)},f.title="browser",f.browser=!0,f.env={},f.argv=[],f.version="",f.versions={},f.on=u,f.addListener=u,f.once=u,f.off=u,f.removeListener=u,f.removeAllListeners=u,f.emit=u,f.binding=function(t){throw new Error("process.binding is not supported")},f.cwd=function(){return"/"},f.chdir=function(t){throw new Error("process.chdir is not supported")},f.umask=function(){return 0}},{}],199:[function(t,e,i){"use strict";function n(t,e,i,o,s){for(i=i||0,o=o||t.length-1,s=s||a;o>i;){if(o-i>600){var l=o-i+1,c=e-i+1,u=Math.log(l),h=.5*Math.exp(2*u/3),d=.5*Math.sqrt(u*h*(l-h)/l)*(c-l/2<0?-1:1),f=Math.max(i,Math.floor(e-c*h/l+d)),p=Math.min(o,Math.floor(e+(l-c)*h/l+d));n(t,e,f,p,s)}var m=t[e],g=i,v=o;for(r(t,i,e),s(t[o],m)>0&&r(t,i,o);g<v;){for(r(t,g,v),g++,v--;s(t[g],m)<0;)g++;for(;s(t[v],m)>0;)v--}0===s(t[i],m)?r(t,i,v):(v++,r(t,v,o)),v<=e&&(i=v+1),e<=v&&(o=v-1)}}function r(t,e,i){var n=t[e];t[e]=t[i],t[i]=n}function a(t,e){return t<e?-1:t>e?1:0}e.exports=n},{}],200:[function(e,i,n){!function(e,r){"object"==typeof n&&"undefined"!=typeof i?i.exports=r():"function"==typeof t&&t.amd?t(r):e.ShelfPack=r()}(this,function(){function t(t,e,i){i=i||{},this.w=t||64,this.h=e||64,this.autoResize=!!i.autoResize,this.shelves=[],this.stats={},this.count=function(t){this.stats[t]=(0|this.stats[t])+1}}function e(t,e,i){this.x=0,this.y=t,this.w=this.free=e,this.h=i}return t.prototype.pack=function(t,e){t=[].concat(t),e=e||{};for(var i,n,r,a=[],o=0;o<t.length;o++)if(i=t[o].w||t[o].width,n=t[o].h||t[o].height,i&&n){if(r=this.packOne(i,n),!r)continue;e.inPlace&&(t[o].x=r.x,t[o].y=r.y),a.push(r)}if(this.shelves.length>0){for(var s=0,l=0,c=0;c<this.shelves.length;c++){var u=this.shelves[c];l+=u.h,s=Math.max(u.w-u.free,s)}this.resize(s,l)}return a},t.prototype.packOne=function(t,i){for(var n,r,a=0,o={shelf:-1,waste:1/0},s=0;s<this.shelves.length;s++){if(n=this.shelves[s],a+=n.h,i===n.h&&t<=n.free)return this.count(i),n.alloc(t,i);i>n.h||t>n.free||i<n.h&&t<=n.free&&(r=n.h-i,r<o.waste&&(o.waste=r,o.shelf=s))}if(o.shelf!==-1)return n=this.shelves[o.shelf],this.count(i),n.alloc(t,i);if(i<=this.h-a&&t<=this.w)return n=new e(a,this.w,i),this.shelves.push(n),this.count(i),n.alloc(t,i);if(this.autoResize){var l,c,u,h;return l=c=this.h,u=h=this.w,(u<=l||t>u)&&(h=2*Math.max(t,u)),(l<u||i>l)&&(c=2*Math.max(i,l)),this.resize(h,c),this.packOne(t,i)}return null},t.prototype.clear=function(){this.shelves=[],this.stats={}},t.prototype.resize=function(t,e){this.w=t,this.h=e;for(var i=0;i<this.shelves.length;i++)this.shelves[i].resize(t);return!0},e.prototype.alloc=function(t,e){if(t>this.free||e>this.h)return null;var i=this.x;return this.x+=t,this.free-=t,{x:i,y:this.y,w:t,h:e,width:t,height:e}},e.prototype.resize=function(t){return this.free+=t-this.w,this.w=t,!0},t})},{}],201:[function(t,e,i){"use strict";function n(t){return new r(t)}function r(t){this.options=f(Object.create(this.options),t),this.trees=new Array(this.options.maxZoom+1)}function a(t,e,i,n){return{x:t,y:e,zoom:1/0,id:n,numPoints:i}}function o(t,e){var i=t.geometry.coordinates;return a(c(i[0]),u(i[1]),1,e)}function s(t){return{type:"Feature",properties:l(t),geometry:{type:"Point",coordinates:[h(t.x),d(t.y)]}}}function l(t){var e=t.numPoints,i=e>=1e4?Math.round(e/1e3)+"k":e>=1e3?Math.round(e/100)/10+"k":e;return{cluster:!0,point_count:e,point_count_abbreviated:i}}function c(t){return t/360+.5}function u(t){var e=Math.sin(t*Math.PI/180),i=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return i<0?0:i>1?1:i}function h(t){return 360*(t-.5)}function d(t){var e=(180-360*t)*Math.PI/180;return 360*Math.atan(Math.exp(e))/Math.PI-90}function f(t,e){for(var i in e)t[i]=e[i];return t}function p(t){return t.x}function m(t){return t.y}var g=t("kdbush");e.exports=n,r.prototype={options:{minZoom:0,maxZoom:16,radius:40,extent:512,nodeSize:64,log:!1},load:function(t){var e=this.options.log;e&&console.time("total time");var i="prepare "+t.length+" points";e&&console.time(i),this.points=t;var n=t.map(o);e&&console.timeEnd(i);for(var r=this.options.maxZoom;r>=this.options.minZoom;r--){var a=+Date.now();this.trees[r+1]=g(n,p,m,this.options.nodeSize,Float32Array),n=this._cluster(n,r),e&&console.log("z%d: %d clusters in %dms",r,n.length,+Date.now()-a)}return this.trees[this.options.minZoom]=g(n,p,m,this.options.nodeSize,Float32Array),e&&console.timeEnd("total time"),this},getClusters:function(t,e){for(var i=this.trees[this._limitZoom(e)],n=i.range(c(t[0]),u(t[3]),c(t[2]),u(t[1])),r=[],a=0;a<n.length;a++){var o=i.points[n[a]];r.push(o.id!==-1?this.points[o.id]:s(o))}return r},getTile:function(t,e,i){var n=this.trees[this._limitZoom(t)],r=Math.pow(2,t),a=this.options.extent,o=this.options.radius,s=o/a,l=(i-s)/r,c=(i+1+s)/r,u={features:[]};return this._addTileFeatures(n.range((e-s)/r,l,(e+1+s)/r,c),n.points,e,i,r,u),0===e&&this._addTileFeatures(n.range(1-s/r,l,1,c),n.points,r,i,r,u),e===r-1&&this._addTileFeatures(n.range(0,l,s/r,c),n.points,-1,i,r,u),u.features.length?u:null},_addTileFeatures:function(t,e,i,n,r,a){for(var o=0;o<t.length;o++){var s=e[t[o]];a.features.push({type:1,geometry:[[Math.round(this.options.extent*(s.x*r-i)),Math.round(this.options.extent*(s.y*r-n))]],tags:s.id!==-1?this.points[s.id].properties:l(s)})}},_limitZoom:function(t){return Math.max(this.options.minZoom,Math.min(t,this.options.maxZoom+1))},_cluster:function(t,e){for(var i=[],n=this.options.radius/(this.options.extent*Math.pow(2,e)),r=0;r<t.length;r++){var o=t[r];if(!(o.zoom<=e)){o.zoom=e;for(var s=this.trees[e+1],l=s.within(o.x,o.y,n),c=!1,u=o.numPoints,h=o.x*u,d=o.y*u,f=0;f<l.length;f++){var p=s.points[l[f]];e<p.zoom&&(c=!0,p.zoom=e,h+=p.x*p.numPoints,d+=p.y*p.numPoints,u+=p.numPoints)}i.push(c?a(h/u,d/u,u,-1):o)}}return i}}},{kdbush:151}],202:[function(t,e,i){"use strict";function n(t,e){if(!(this instanceof n))return new n(t,e);if(this.data=t||[],this.length=this.data.length,this.compare=e||r,t)for(var i=Math.floor(this.length/2);i>=0;i--)this._down(i)}function r(t,e){return t<e?-1:t>e?1:0}function a(t,e,i){var n=t[e];t[e]=t[i],t[i]=n}e.exports=n,n.prototype={push:function(t){this.data.push(t),this.length++,this._up(this.length-1)},pop:function(){var t=this.data[0];return this.data[0]=this.data[this.length-1],this.length--,this.data.pop(),this._down(0),t},peek:function(){return this.data[0]},_up:function(t){for(var e=this.data,i=this.compare;t>0;){var n=Math.floor((t-1)/2);if(!(i(e[t],e[n])<0))break;a(e,n,t),t=n}},_down:function(t){for(var e=this.data,i=this.compare,n=this.length;;){var r=2*t+1,o=r+1,s=t;if(r<n&&i(e[r],e[s])<0&&(s=r),o<n&&i(e[o],e[s])<0&&(s=o),s===t)return;a(e,s,t),t=s}}}},{}],203:[function(t,e,i){"function"==typeof Object.create?e.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(t,e){t.super_=e;var i=function(){};i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t}},{}],204:[function(t,e,i){e.exports=function(t){return t&&"object"==typeof t&&"function"==typeof t.copy&&"function"==typeof t.fill&&"function"==typeof t.readUInt8}},{}],205:[function(t,e,n){(function(e,i){function r(t,e){var i={seen:[],stylize:o};return arguments.length>=3&&(i.depth=arguments[2]),arguments.length>=4&&(i.colors=arguments[3]),m(e)?i.showHidden=e:e&&n._extend(i,e),x(i.showHidden)&&(i.showHidden=!1),x(i.depth)&&(i.depth=2),x(i.colors)&&(i.colors=!1),x(i.customInspect)&&(i.customInspect=!0),i.colors&&(i.stylize=a),l(i,t,i.depth)}function a(t,e){var i=r.styles[e];return i?"["+r.colors[i][0]+"m"+t+"["+r.colors[i][1]+"m":t}function o(t,e){return t}function s(t){var e={};return t.forEach(function(t,i){e[t]=!0}),e}function l(t,e,i){if(t.customInspect&&e&&E(e.inspect)&&e.inspect!==n.inspect&&(!e.constructor||e.constructor.prototype!==e)){var r=e.inspect(i,t);return b(r)||(r=l(t,r,i)),r}var a=c(t,e);if(a)return a;var o=Object.keys(e),m=s(o);if(t.showHidden&&(o=Object.getOwnPropertyNames(e)),S(e)&&(o.indexOf("message")>=0||o.indexOf("description")>=0))return u(e);if(0===o.length){if(E(e)){var g=e.name?": "+e.name:"";return t.stylize("[Function"+g+"]","special")}if(w(e))return t.stylize(RegExp.prototype.toString.call(e),"regexp");if(z(e))return t.stylize(Date.prototype.toString.call(e),"date");if(S(e))return u(e)}var v="",y=!1,_=["{","}"];if(p(e)&&(y=!0,_=["[","]"]),E(e)){var x=e.name?": "+e.name:"";v=" [Function"+x+"]"}if(w(e)&&(v=" "+RegExp.prototype.toString.call(e)),z(e)&&(v=" "+Date.prototype.toUTCString.call(e)),S(e)&&(v=" "+u(e)),0===o.length&&(!y||0==e.length))return _[0]+v+_[1];if(i<0)return w(e)?t.stylize(RegExp.prototype.toString.call(e),"regexp"):t.stylize("[Object]","special");t.seen.push(e);var M;return M=y?h(t,e,i,m,o):o.map(function(n){return d(t,e,i,m,n,y)}),t.seen.pop(),f(M,v,_)}function c(t,e){if(x(e))return t.stylize("undefined","undefined");if(b(e)){var i="'"+JSON.stringify(e).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return t.stylize(i,"string")}return y(e)?t.stylize(""+e,"number"):m(e)?t.stylize(""+e,"boolean"):g(e)?t.stylize("null","null"):void 0}function u(t){return"["+Error.prototype.toString.call(t)+"]"}function h(t,e,i,n,r){for(var a=[],o=0,s=e.length;o<s;++o)A(e,String(o))?a.push(d(t,e,i,n,String(o),!0)):a.push("");return r.forEach(function(r){r.match(/^\d+$/)||a.push(d(t,e,i,n,r,!0))}),a}function d(t,e,i,n,r,a){var o,s,c;if(c=Object.getOwnPropertyDescriptor(e,r)||{value:e[r]},c.get?s=c.set?t.stylize("[Getter/Setter]","special"):t.stylize("[Getter]","special"):c.set&&(s=t.stylize("[Setter]","special")),A(n,r)||(o="["+r+"]"),s||(t.seen.indexOf(c.value)<0?(s=g(i)?l(t,c.value,null):l(t,c.value,i-1),s.indexOf("\n")>-1&&(s=a?s.split("\n").map(function(t){return"  "+t}).join("\n").substr(2):"\n"+s.split("\n").map(function(t){return"   "+t}).join("\n"))):s=t.stylize("[Circular]","special")),x(o)){if(a&&r.match(/^\d+$/))return s;o=JSON.stringify(""+r),o.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(o=o.substr(1,o.length-2),o=t.stylize(o,"name")):(o=o.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),o=t.stylize(o,"string"))}return o+": "+s}function f(t,e,i){var n=0,r=t.reduce(function(t,e){return n++,e.indexOf("\n")>=0&&n++,t+e.replace(/\u001b\[\d\d?m/g,"").length+1},0);return r>60?i[0]+(""===e?"":e+"\n ")+" "+t.join(",\n  ")+" "+i[1]:i[0]+e+" "+t.join(", ")+" "+i[1]}function p(t){return Array.isArray(t)}function m(t){return"boolean"==typeof t}function g(t){return null===t}function v(t){return null==t}function y(t){return"number"==typeof t}function b(t){return"string"==typeof t}function _(t){return"symbol"==typeof t}function x(t){return void 0===t}function w(t){return M(t)&&"[object RegExp]"===T(t)}function M(t){return"object"==typeof t&&null!==t}function z(t){return M(t)&&"[object Date]"===T(t)}function S(t){return M(t)&&("[object Error]"===T(t)||t instanceof Error)}function E(t){return"function"==typeof t}function k(t){return null===t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||"symbol"==typeof t||"undefined"==typeof t}function T(t){return Object.prototype.toString.call(t)}function P(t){return t<10?"0"+t.toString(10):t.toString(10)}function O(){var t=new Date,e=[P(t.getHours()),P(t.getMinutes()),P(t.getSeconds())].join(":");return[t.getDate(),D[t.getMonth()],e].join(" ")}function A(t,e){return Object.prototype.hasOwnProperty.call(t,e)}var I=/%[sdj%]/g;n.format=function(t){if(!b(t)){for(var e=[],i=0;i<arguments.length;i++)e.push(r(arguments[i]));return e.join(" ")}for(var i=1,n=arguments,a=n.length,o=String(t).replace(I,function(t){if("%%"===t)return"%";if(i>=a)return t;switch(t){case"%s":return String(n[i++]);case"%d":return Number(n[i++]);case"%j":try{return JSON.stringify(n[i++])}catch(t){return"[Circular]"}default:return t}}),s=n[i];i<a;s=n[++i])o+=g(s)||!M(s)?" "+s:" "+r(s);return o},n.deprecate=function(t,r){function a(){if(!o){if(e.throwDeprecation)throw new Error(r);e.traceDeprecation?console.trace(r):console.error(r),o=!0}return t.apply(this,arguments)}if(x(i.process))return function(){return n.deprecate(t,r).apply(this,arguments)};if(e.noDeprecation===!0)return t;var o=!1;return a};var C,L={};n.debuglog=function(t){if(x(C)&&(C=e.env.NODE_DEBUG||""),t=t.toUpperCase(),!L[t])if(new RegExp("\\b"+t+"\\b","i").test(C)){var i=e.pid;L[t]=function(){var e=n.format.apply(n,arguments);console.error("%s %d: %s",t,i,e)}}else L[t]=function(){};return L[t]},n.inspect=r,r.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},r.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},n.isArray=p,n.isBoolean=m,n.isNull=g,n.isNullOrUndefined=v,n.isNumber=y,n.isString=b,n.isSymbol=_,n.isUndefined=x,n.isRegExp=w,n.isObject=M,n.isDate=z,n.isError=S,n.isFunction=E,n.isPrimitive=k,n.isBuffer=t("./support/isBuffer");var D=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];n.log=function(){console.log("%s - %s",O(),n.format.apply(n,arguments))},n.inherits=t("inherits"),n._extend=function(t,e){if(!e||!M(e))return t;for(var i=Object.keys(e),n=i.length;n--;)t[i[n]]=e[i[n]];return t}}).call(this,t("_process"),"undefined"!=typeof i?i:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":204,_process:198,inherits:203}],206:[function(t,e,i){e.exports.VectorTile=t("./lib/vectortile.js"),e.exports.VectorTileFeature=t("./lib/vectortilefeature.js"),e.exports.VectorTileLayer=t("./lib/vectortilelayer.js")},{"./lib/vectortile.js":207,"./lib/vectortilefeature.js":208,"./lib/vectortilelayer.js":209}],207:[function(t,e,i){"use strict";function n(t,e){this.layers=t.readFields(r,{},e)}function r(t,e,i){if(3===t){var n=new a(i,i.readVarint()+i.pos);n.length&&(e[n.name]=n)}}var a=t("./vectortilelayer");e.exports=n},{"./vectortilelayer":209}],208:[function(t,e,i){"use strict";function n(t,e,i,n,a){this.properties={},this.extent=i,this.type=0,this._pbf=t,this._geometry=-1,this._keys=n,this._values=a,t.readFields(r,this,e)}function r(t,e,i){1==t?e.id=i.readVarint():2==t?a(i,e):3==t?e.type=i.readVarint():4==t&&(e._geometry=i.pos)}function a(t,e){for(var i=t.readVarint()+t.pos;t.pos<i;){var n=e._keys[t.readVarint()],r=e._values[t.readVarint()];e.properties[n]=r}}function o(t){var e=t.length;if(e<=1)return[t];for(var i,n,r=[],a=0;a<e;a++){var o=s(t[a]);0!==o&&(void 0===n&&(n=o<0),n===o<0?(i&&r.push(i),i=[t[a]]):i.push(t[a]))}return i&&r.push(i),r}function s(t){for(var e,i,n=0,r=0,a=t.length,o=a-1;r<a;o=r++)e=t[r],i=t[o],n+=(i.x-e.x)*(e.y+i.y);return n}var l=t("point-geometry");e.exports=n,n.types=["Unknown","Point","LineString","Polygon"],n.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,i=t.readVarint()+t.pos,n=1,r=0,a=0,o=0,s=[];t.pos<i;){if(!r){var c=t.readVarint();n=7&c,r=c>>3}if(r--,1===n||2===n)a+=t.readSVarint(),o+=t.readSVarint(),1===n&&(e&&s.push(e),e=[]),e.push(new l(a,o));else{if(7!==n)throw new Error("unknown command "+n);e&&e.push(e[0].clone())}}return e&&s.push(e),s},n.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,i=1,n=0,r=0,a=0,o=1/0,s=-(1/0),l=1/0,c=-(1/0);t.pos<e;){if(!n){var u=t.readVarint();i=7&u,n=u>>3}if(n--,1===i||2===i)r+=t.readSVarint(),a+=t.readSVarint(),r<o&&(o=r),r>s&&(s=r),a<l&&(l=a),a>c&&(c=a);else if(7!==i)throw new Error("unknown command "+i)}return[o,l,s,c]},n.prototype.toGeoJSON=function(t,e,i){function r(t){for(var e=0;e<t.length;e++){var i=t[e],n=180-360*(i.y+u)/l;t[e]=[360*(i.x+c)/l-180,360/Math.PI*Math.atan(Math.exp(n*Math.PI/180))-90]}}var a,s,l=this.extent*Math.pow(2,i),c=this.extent*t,u=this.extent*e,h=this.loadGeometry(),d=n.types[this.type];switch(this.type){case 1:var f=[];for(a=0;a<h.length;a++)f[a]=h[a][0];h=f,r(h);break;case 2:for(a=0;a<h.length;a++)r(h[a]);break;case 3:for(h=o(h),a=0;a<h.length;a++)for(s=0;s<h[a].length;s++)r(h[a][s])}1===h.length?h=h[0]:d="Multi"+d;var p={type:"Feature",geometry:{type:d,coordinates:h},properties:this.properties};return"id"in this&&(p.id=this.id),p}},{"point-geometry":197}],209:[function(t,e,i){"use strict";function n(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(r,this,e),this.length=this._features.length}function r(t,e,i){15===t?e.version=i.readVarint():1===t?e.name=i.readString():5===t?e.extent=i.readVarint():2===t?e._features.push(i.pos):3===t?e._keys.push(i.readString()):4===t&&e._values.push(a(i))}function a(t){for(var e=null,i=t.readVarint()+t.pos;t.pos<i;){var n=t.readVarint()>>3;e=1===n?t.readString():2===n?t.readFloat():3===n?t.readDouble():4===n?t.readVarint64():5===n?t.readVarint():6===n?t.readSVarint():7===n?t.readBoolean():null}return e}var o=t("./vectortilefeature.js");e.exports=n,n.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new o(this._pbf,e,this.extent,this._keys,this._values)}},{"./vectortilefeature.js":208}],210:[function(t,e,i){function n(t){var e=[];for(var i in t.layers)e.push(a(t.layers[i]));var n=new u;return h.tile.write({layers:e},n),n.finish()}function r(t){var e={};for(var i in t)e[i]=new d(t[i].features),e[i].name=i;return n({layers:e})}function a(t){for(var e={name:t.name||"",version:t.version||1,extent:t.extent||4096,keys:[],values:[],features:[]},i={},n={},r=0;r<t.length;r++){var a=t.feature(r);a.geometry=l(a.loadGeometry());var o=[];for(var s in a.properties){var u=i[s];"undefined"==typeof u&&(e.keys.push(s),u=e.keys.length-1,i[s]=u);var h=c(a.properties[s]),d=n[h.key];"undefined"==typeof d&&(e.values.push(h),d=e.values.length-1,n[h.key]=d),o.push(u),o.push(d)}a.tags=o,e.features.push(a)}return e}function o(t,e){return(e<<3)+(7&t)}function s(t){return t<<1^t>>31}function l(t){for(var e=[],i=0,n=0,r=t.length,a=0;a<r;a++){var l=t[a];e.push(o(1,1));for(var c=0;c<l.length;c++){1===c&&e.push(o(2,l.length-1));var u=l[c].x-i,h=l[c].y-n;e.push(s(u),s(h)),i+=u,n+=h}}return e}function c(t){var e,i=typeof t;return"string"===i?e={string_value:t}:"boolean"===i?e={bool_value:t}:"number"===i?e=t%1!==0?{double_value:t}:t<0?{sint_value:t}:{uint_value:t}:(t=JSON.stringify(t),e={string_value:t}),e.key=i+":"+t,e}var u=t("pbf"),h=t("./vector-tile-pb"),d=t("./lib/geojson_wrapper");e.exports=n,e.exports.fromVectorTileJs=n,e.exports.fromGeojsonVt=r,e.exports.GeoJSONWrapper=d},{"./lib/geojson_wrapper":211,"./vector-tile-pb":212,pbf:196}],211:[function(t,e,i){"use strict";function n(t){this.features=t,this.length=t.length}function r(t){this.id="number"==typeof t.id?t.id:void 0,this.type=t.type,this.rawGeometry=1===t.type?[t.geometry]:t.geometry,this.properties=t.tags,this.extent=4096}var a=t("point-geometry"),o=t("vector-tile").VectorTileFeature;e.exports=n,n.prototype.feature=function(t){return new r(this.features[t])},r.prototype.loadGeometry=function(){var t=this.rawGeometry;this.geometry=[];for(var e=0;e<t.length;e++){for(var i=t[e],n=[],r=0;r<i.length;r++)n.push(new a(i[r][0],i[r][1]));this.geometry.push(n)}return this.geometry},r.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var t=this.geometry,e=1/0,i=-(1/0),n=1/0,r=-(1/0),a=0;a<t.length;a++)for(var o=t[a],s=0;s<o.length;s++){var l=o[s];e=Math.min(e,l.x),i=Math.max(i,l.x),n=Math.min(n,l.y),r=Math.max(r,l.y)}return[e,n,i,r]},r.prototype.toGeoJSON=o.prototype.toGeoJSON},{"point-geometry":197,"vector-tile":206}],212:[function(t,e,i){"use strict";function n(t,e){return t.readFields(r,{layers:[]},e)}function r(t,e,i){3===t&&e.layers.push(d(i,i.readVarint()+i.pos))}function a(t,e){var i;if(void 0!==t.layers)for(i=0;i<t.layers.length;i++)e.writeMessage(3,p,t.layers[i])}function o(t,e){return t.readFields(s,{},e)}function s(t,e,i){1===t?e.string_value=i.readString():2===t?e.float_value=i.readFloat():3===t?e.double_value=i.readDouble():4===t?e.int_value=i.readVarint():5===t?e.uint_value=i.readVarint():6===t?e.sint_value=i.readSVarint():7===t&&(e.bool_value=i.readBoolean())}function l(t,e){void 0!==t.string_value&&e.writeStringField(1,t.string_value),void 0!==t.float_value&&e.writeFloatField(2,t.float_value),void 0!==t.double_value&&e.writeDoubleField(3,t.double_value),void 0!==t.int_value&&e.writeVarintField(4,t.int_value),void 0!==t.uint_value&&e.writeVarintField(5,t.uint_value),void 0!==t.sint_value&&e.writeSVarintField(6,t.sint_value),void 0!==t.bool_value&&e.writeBooleanField(7,t.bool_value)}function c(t,e){var i=t.readFields(u,{},e);return void 0===i.type&&(i.type="Unknown"),i}function u(t,e,i){1===t?e.id=i.readVarint():2===t?e.tags=i.readPackedVarint():3===t?e.type=i.readVarint():4===t&&(e.geometry=i.readPackedVarint())}function h(t,e){void 0!==t.id&&e.writeVarintField(1,t.id),void 0!==t.tags&&e.writePackedVarint(2,t.tags),void 0!==t.type&&e.writeVarintField(3,t.type),void 0!==t.geometry&&e.writePackedVarint(4,t.geometry)}function d(t,e){return t.readFields(f,{features:[],keys:[],values:[]},e)}function f(t,e,i){15===t?e.version=i.readVarint():1===t?e.name=i.readString():2===t?e.features.push(c(i,i.readVarint()+i.pos)):3===t?e.keys.push(i.readString()):4===t?e.values.push(o(i,i.readVarint()+i.pos)):5===t&&(e.extent=i.readVarint())}function p(t,e){void 0!==t.version&&e.writeVarintField(15,t.version),void 0!==t.name&&e.writeStringField(1,t.name);var i;if(void 0!==t.features)for(i=0;i<t.features.length;i++)e.writeMessage(2,h,t.features[i]);if(void 0!==t.keys)for(i=0;i<t.keys.length;i++)e.writeStringField(3,t.keys[i]);if(void 0!==t.values)for(i=0;i<t.values.length;i++)e.writeMessage(4,l,t.values[i]);void 0!==t.extent&&e.writeVarintField(5,t.extent)}var m=i.tile={read:n,write:a};m.GeomType={Unknown:0,Point:1,LineString:2,Polygon:3},m.value={read:o,write:l},m.feature={read:c,write:h},m.layer={read:d,write:p}},{}],213:[function(t,e,i){var n=arguments[3],r=arguments[4],a=arguments[5],o=JSON.stringify;e.exports=function(t,e){function i(t){g[t]=!0;for(var e in r[t][1]){var n=r[t][1][e];g[n]||i(n)}}for(var s,l=Object.keys(a),c=0,u=l.length;c<u;c++){var h=l[c],d=a[h].exports;if(d===t||d&&d.default===t){s=h;break}}if(!s){s=Math.floor(Math.pow(16,8)*Math.random()).toString(16);for(var f={},c=0,u=l.length;c<u;c++){var h=l[c];f[h]=h}r[s]=[Function(["require","module","exports"],"("+t+")(self)"),f]}var p=Math.floor(Math.pow(16,8)*Math.random()).toString(16),m={};m[s]=s,r[p]=[Function(["require"],"var f = require("+o(s)+");(f.default ? f.default : f)(self);"),m];var g={};i(p);var v="("+n+")({"+Object.keys(g).map(function(t){return o(t)+":["+r[t][0]+","+o(r[t][1])+"]"}).join(",")+"},{},["+o(p)+"])",y=window.URL||window.webkitURL||window.mozURL||window.msURL,b=new Blob([v],{type:"text/javascript"});if(e&&e.bare)return b;var _=y.createObjectURL(b),x=new Worker(_);return x.objectURL=_,x}},{}],214:[function(t,e,i){e.exports.RADIUS=6378137,e.exports.FLATTENING=1/298.257223563,e.exports.POLAR_RADIUS=6356752.3142},{}],215:[function(e,i,n){!function(e,r){"object"==typeof n&&"undefined"!=typeof i?r(n):"function"==typeof t&&t.amd?t(["exports"],r):r(e.WhooTS=e.WhooTS||{})}(this,function(t){function e(t,e,n,r,a,o){o=o||{};var s=t+"?"+["bbox="+i(n,r,a),"format="+(o.format||"image/png"),"service="+(o.service||"WMS"),"version="+(o.version||"1.1.1"),"request="+(o.request||"GetMap"),"srs="+(o.srs||"EPSG:3857"),"width="+(o.width||256),"height="+(o.height||256),"layers="+e].join("&");return s}function i(t,e,i){e=Math.pow(2,i)-e-1;var r=n(256*t,256*e,i),a=n(256*(t+1),256*(e+1),i);return r[0]+","+r[1]+","+a[0]+","+a[1]}function n(t,e,i){var n=2*Math.PI*6378137/256/Math.pow(2,i),r=t*n-2*Math.PI*6378137/2,a=e*n-2*Math.PI*6378137/2;return[r,a]}t.getURL=e,t.getTileBBox=i,t.getMercCoords=n,Object.defineProperty(t,"__esModule",{value:!0})})},{}],216:[function(t,e,i){e.exports={version:"0.32.1"}},{}]},{},[24])(24)})}).call(e,i(233).Buffer,i(85))},function(t,e){function i(){throw new Error("setTimeout has not been defined")}function n(){throw new Error("clearTimeout has not been defined")}function r(t){if(u===setTimeout)return setTimeout(t,0);if((u===i||!u)&&setTimeout)return u=setTimeout,setTimeout(t,0);try{return u(t,0)}catch(e){try{return u.call(null,t,0)}catch(e){return u.call(this,t,0)}}}function a(t){if(h===clearTimeout)return clearTimeout(t);if((h===n||!h)&&clearTimeout)return h=clearTimeout,clearTimeout(t);try{return h(t)}catch(e){try{return h.call(null,t)}catch(e){return h.call(this,t)}}}function o(){m&&f&&(m=!1,f.length?p=f.concat(p):g=-1,p.length&&s())}function s(){if(!m){var t=r(o);m=!0;for(var e=p.length;e;){for(f=p,p=[];++g<e;)f&&f[g].run();g=-1,e=p.length}f=null,m=!1,a(t)}}function l(t,e){this.fun=t,this.array=e}function c(){}var u,h,d=t.exports={};!function(){try{u="function"==typeof setTimeout?setTimeout:i}catch(t){u=i}try{h="function"==typeof clearTimeout?clearTimeout:n}catch(t){h=n}}();var f,p=[],m=!1,g=-1;d.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)e[i-1]=arguments[i];p.push(new l(t,e)),1!==p.length||m||r(s)},l.prototype.run=function(){this.fun.apply(null,this.array)},d.title="browser",d.browser=!0,d.env={},d.argv=[],d.version="",d.versions={},d.on=c,d.addListener=c,d.once=c,d.off=c,d.removeListener=c,d.removeAllListeners=c,d.emit=c,d.binding=function(t){throw new Error("process.binding is not supported")},d.cwd=function(){return"/"},d.chdir=function(t){throw new Error("process.chdir is not supported")},d.umask=function(){return 0}},function(t,e,i){(function(e,i){!function(e){"use strict";function n(t,e,i,n){var r=e&&e.prototype instanceof a?e:a,o=Object.create(r.prototype),s=new f(n||[]);return o._invoke=u(t,i,s),o}function r(t,e,i){try{return{type:"normal",arg:t.call(e,i)}}catch(t){return{type:"throw",arg:t}}}function a(){}function o(){}function s(){}function l(t){["next","throw","return"].forEach(function(e){t[e]=function(t){return this._invoke(e,t)}})}function c(t){function e(i,n,a,o){var s=r(t[i],t,n);if("throw"!==s.type){var l=s.arg,c=l.value;return c&&"object"==typeof c&&y.call(c,"__await")?Promise.resolve(c.__await).then(function(t){e("next",t,a,o)},function(t){e("throw",t,a,o)}):Promise.resolve(c).then(function(t){l.value=t,a(l)},o)}o(s.arg)}function n(t,i){function n(){return new Promise(function(n,r){e(t,i,n,r)})}return a=a?a.then(n,n):n()}"object"==typeof i&&i.domain&&(e=i.domain.bind(e));var a;this._invoke=n}function u(t,e,i){var n=z;return function(a,o){if(n===E)throw new Error("Generator is already running");if(n===k){if("throw"===a)throw o;return m()}for(;;){var s=i.delegate;if(s){if("return"===a||"throw"===a&&s.iterator[a]===g){i.delegate=null;var l=s.iterator.return;if(l){var c=r(l,s.iterator,o);if("throw"===c.type){a="throw",o=c.arg;continue}}if("return"===a)continue}var c=r(s.iterator[a],s.iterator,o);if("throw"===c.type){i.delegate=null,a="throw",o=c.arg;continue}a="next",o=g;var u=c.arg;if(!u.done)return n=S,u;i[s.resultName]=u.value,i.next=s.nextLoc,i.delegate=null}if("next"===a)i.sent=i._sent=o;else if("throw"===a){if(n===z)throw n=k,o;i.dispatchException(o)&&(a="next",o=g)}else"return"===a&&i.abrupt("return",o);n=E;var c=r(t,e,i);if("normal"===c.type){n=i.done?k:S;var u={value:c.arg,done:i.done};if(c.arg!==T)return u;i.delegate&&"next"===a&&(o=g)}else"throw"===c.type&&(n=k,a="throw",o=c.arg)}}}function h(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function d(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function f(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(h,this),this.reset(!0)}function p(t){if(t){var e=t[_];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var i=-1,n=function e(){for(;++i<t.length;)if(y.call(t,i))return e.value=t[i],e.done=!1,e;return e.value=g,e.done=!0,e};return n.next=n}}return{next:m}}function m(){return{value:g,done:!0}}var g,v=Object.prototype,y=v.hasOwnProperty,b="function"==typeof Symbol?Symbol:{},_=b.iterator||"@@iterator",x=b.toStringTag||"@@toStringTag",w="object"==typeof t,M=e.regeneratorRuntime;if(M)return void(w&&(t.exports=M));M=e.regeneratorRuntime=w?t.exports:{},M.wrap=n;var z="suspendedStart",S="suspendedYield",E="executing",k="completed",T={},P={};P[_]=function(){return this};var O=Object.getPrototypeOf,A=O&&O(O(p([])));A&&A!==v&&y.call(A,_)&&(P=A);var I=s.prototype=a.prototype=Object.create(P);o.prototype=I.constructor=s,s.constructor=o,s[x]=o.displayName="GeneratorFunction",M.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===o||"GeneratorFunction"===(e.displayName||e.name))},M.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,x in t||(t[x]="GeneratorFunction")),t.prototype=Object.create(I),t},M.awrap=function(t){return{__await:t}},l(c.prototype),M.AsyncIterator=c,M.async=function(t,e,i,r){var a=new c(n(t,e,i,r));return M.isGeneratorFunction(e)?a:a.next().then(function(t){return t.done?t.value:a.next()})},l(I),I[x]="Generator",I.toString=function(){return"[object Generator]"},M.keys=function(t){var e=[];for(var i in t)e.push(i);return e.reverse(),function i(){for(;e.length;){var n=e.pop();if(n in t)return i.value=n,i.done=!1,i}return i.done=!0,i}},M.values=p,f.prototype={constructor:f,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=g,this.done=!1,this.delegate=null,this.tryEntries.forEach(d),!t)for(var e in this)"t"===e.charAt(0)&&y.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=g)},stop:function(){this.done=!0;var t=this.tryEntries[0],e=t.completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(t){function e(e,n){return a.type="throw",a.arg=t,i.next=e,!!n}if(this.done)throw t;for(var i=this,n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n],a=r.completion;if("root"===r.tryLoc)return e("end");if(r.tryLoc<=this.prev){var o=y.call(r,"catchLoc"),s=y.call(r,"finallyLoc");if(o&&s){if(this.prev<r.catchLoc)return e(r.catchLoc,!0);if(this.prev<r.finallyLoc)return e(r.finallyLoc)}else if(o){if(this.prev<r.catchLoc)return e(r.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return e(r.finallyLoc)}}}},abrupt:function(t,e){for(var i=this.tryEntries.length-1;i>=0;--i){var n=this.tryEntries[i];if(n.tryLoc<=this.prev&&y.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var r=n;break}}r&&("break"===t||"continue"===t)&&r.tryLoc<=e&&e<=r.finallyLoc&&(r=null);var a=r?r.completion:{};return a.type=t,a.arg=e,r?this.next=r.finallyLoc:this.complete(a),T},complete:function(t,e){if("throw"===t.type)throw t.arg;"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=t.arg,this.next="end"):"normal"===t.type&&e&&(this.next=e)},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e];if(i.finallyLoc===t)return this.complete(i.completion,i.afterLoc),
d(i),T}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e];if(i.tryLoc===t){var n=i.completion;if("throw"===n.type){var r=n.arg;d(i)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,i){return this.delegate={iterator:p(t),resultName:e,nextLoc:i},T}}}("object"==typeof e?e:"object"==typeof window?window:"object"==typeof self?self:this)}).call(e,i(85),i(470))},function(t,e){t.exports={linear:function(t,e,i,n,r){return+i+(r-t)/(e-t)*(n-i)},exp:function(t,e,i,n,r){return Math.exp((Math.log(i)*(e-r)-Math.log(n)*(t-r))/(e-t))},stepBefore:function(t,e,i,n,r){return n},stepAfter:function(t,e,i,n,r){return i},stepMiddle:function(t,e,i,n,r){return r<(t+e)/2?i:n}}},function(t,e,i){function n(t){return i(r(t))}function r(t){var e=a[t];if(!(e+1))throw new Error("Cannot find module '"+t+"'.");return e}var a={"./bubblesize/bubblesize.js":86,"./buttonlist/buttonlist.js":22,"./buttonlist/optionsbuttonlist/optionsbuttonlist.js":117,"./colorlegend/colorlegend.js":87,"./datanotes/datanotes.js":35,"./datawarning/datawarning.js":40,"./dialogs/_dialog.js":11,"./dialogs/about/about.js":118,"./dialogs/axes/axes.js":119,"./dialogs/axesmc/axesmc.js":120,"./dialogs/colors/colors.js":121,"./dialogs/dialogs.js":23,"./dialogs/find/find.js":122,"./dialogs/label/label.js":123,"./dialogs/mapoptions/mapoptions.js":124,"./dialogs/moreoptions/moreoptions.js":125,"./dialogs/opacity/opacity.js":126,"./dialogs/presentation/presentation.js":127,"./dialogs/show/show.js":128,"./dialogs/side/side.js":129,"./dialogs/size/size.js":130,"./dialogs/speed/speed.js":131,"./dialogs/stack/stack.js":132,"./dialogs/timedisplay/timedisplay.js":133,"./dialogs/zoom/zoom.js":134,"./draggablelist/draggablelist.js":135,"./indicatorpicker/indicatorpicker.js":48,"./minmaxinputs/minmaxinputs.js":88,"./simplecheckbox/simplecheckbox.js":59,"./simpleslider/simpleslider.js":67,"./sizeslider/sizeslider.js":136,"./steppedspeedslider/steppedspeedslider.js":49,"./timeslider/timeslider.js":26,"./treemenu/treemenu.js":27,"./zoombuttonlist/zoombuttonlist.js":137};n.keys=function(){return Object.keys(a)},n.resolve=r,t.exports=n,n.id=473},function(t,e,i){function n(t){return i(r(t))}function r(t){var e=a[t];if(!(e+1))throw new Error("Cannot find module '"+t+"'.");return e}var a={"./about/about.html":436,"./axes/axes.html":437,"./axesmc/axesmc.html":438,"./colors/colors.html":439,"./find/find.html":440,"./label/label.html":441,"./mapoptions/mapoptions.html":442,"./moreoptions/moreoptions.html":443,"./opacity/opacity.html":444,"./presentation/presentation.html":445,"./show/show.html":446,"./side/side.html":447,"./size/size.html":448,"./speed/speed.html":449,"./stack/stack.html":450,"./timedisplay/timedisplay.html":451,"./zoom/zoom.html":452};n.keys=function(){return Object.keys(a)},n.resolve=r,t.exports=n,n.id=474},function(t,e,i){function n(t){return i(r(t))}function r(t){var e=a[t];if(!(e+1))throw new Error("Cannot find module '"+t+"'.");return e}var a={"./_dialog.js":11,"./about/about.js":118,"./axes/axes.js":119,"./axesmc/axesmc.js":120,"./colors/colors.js":121,"./dialogs.js":23,"./find/find.js":122,"./label/label.js":123,"./mapoptions/mapoptions.js":124,"./moreoptions/moreoptions.js":125,"./opacity/opacity.js":126,"./presentation/presentation.js":127,"./show/show.js":128,"./side/side.js":129,"./size/size.js":130,"./speed/speed.js":131,"./stack/stack.js":132,"./timedisplay/timedisplay.js":133,"./zoom/zoom.js":134};n.keys=function(){return Object.keys(a)},n.resolve=r,t.exports=n,n.id=475},function(t,e,i){function n(t){return i(r(t))}function r(t){var e=a[t];if(!(e+1))throw new Error("Cannot find module '"+t+"'.");return e}var a={"./axis":90,"./axis.js":90,"./color":140,"./color.js":140,"./data":141,"./data.js":141,"./dataconnected":61,"./dataconnected.js":61,"./entities":142,"./entities.js":142,"./group":143,"./group.js":143,"./hook":42,"./hook.js":42,"./label":144,"./label.js":144,"./locale":145,"./locale.js":145,"./marker":146,"./marker.js":146,"./side":147,"./side.js":147,"./size":148,"./size.js":148,"./stack":149,"./stack.js":149,"./time":150,"./time.js":150,"./ui":151,"./ui.js":151};n.keys=function(){return Object.keys(a)},n.resolve=r,t.exports=n,n.id=476},function(t,e,i){function n(t){return i(r(t))}function r(t){var e=a[t];if(!(e+1))throw new Error("Cannot find module '"+t+"'.");return e}var a={"./csv-time_in_columns/csv-time_in_columns.js":213,"./csv/csv.js":152,"./inline/inline.js":214};n.keys=function(){return Object.keys(a)},n.resolve=r,t.exports=n,n.id=477},,function(t,e,i){"use strict";function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e.default=t,e}function r(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0}),i(193);var a=i(34),o=r(a),s=i(1),l=n(s),c=i(15),u=(r(c),i(192)),h=r(u);i(194);var d=i(71),f=(r(d),i(185)),p=(r(f),i(184)),m=(r(p),i(191)),g=(r(m),i(183)),v=(r(g),i(186)),y=(r(v),i(189)),b=(r(y),i(190)),_=(r(b),i(188)),x=(r(_),i(187)),w=(r(x),i(182)),M=(r(w),i(181)),z=(r(M),window.location.href.split("/")),S=z.splice(0,z.indexOf("preview")).join("/")+"/preview/";o.default.ext_resources=l.deepExtend({host:S,preloadPath:"data/",dataPath:"data/waffles/"},o.default.ext_resources),e.default=h.default,t.exports=h.default}])});
//# sourceMappingURL=vizabi.min.js.map